"use strict";L.Map.Modal=L.Handler.extend({includes:L.Evented?L.Evented.prototype:L.Mixin.Events,statics:{BASE_CLS:"leaflet-modal",HIDE:"modal.hide",SHOW_START:"modal.showStart",SHOW:"modal.show",CHANGED:"modal.changed",classNameToSelector:function(t){return(" "+t).split(" ").join(".").replace(/^\s+|\s+$/g,"")}},options:{OVERLAY_CLS:"overlay",MODAL_CLS:"modal",MODAL_CONTENT_CLS:"modal-content",INNER_CONTENT_CLS:"modal-inner",SHOW_CLS:"show",CLOSE_CLS:"close",closeTitle:"close",zIndex:1e4,transitionDuration:300,wrapperTemplate:['<div class="{OVERLAY_CLS}"></div>','<div class="{MODAL_CLS}"><div class="{MODAL_CONTENT_CLS}">','<span class="{CLOSE_CLS}" title="{closeTitle}">&times;</span>','<div class="{INNER_CONTENT_CLS}">{_content}</div>',"</div></div>"].join(""),template:"{content}",content:""},initialize:function(t,i){L.Handler.prototype.initialize.call(this,t),L.Util.setOptions(this,i),this._visible=!1;var n=this._container=L.DomUtil.create("div",L.Map.Modal.BASE_CLS,t._container);n.style.zIndex=this.options.zIndex,n.style.position="absolute",this._map._controlContainer.appendChild(n),L.DomEvent.disableClickPropagation(n).disableScrollPropagation(n),L.DomEvent.on(n,"contextmenu",L.DomEvent.stopPropagation),this.enable()},addHooks:function(){L.DomEvent.on(document,"keydown",this._onKeyDown,this),this._map.on({modal:this._show},this)},removeHooks:function(){L.DomEvent.off(document,"keydown",this._onKeyDown,this),this._map.off({modal:this._show},this)},hide:function(){return this._hide(),this},isVisible:function(){return this._visible},update:function(t){t?this._show(t):this._updatePosition()},setContent:function(t){this._getInnerContentContainer().innerHTML=t,this.update()},_updatePosition:function(){var t=this._getContentContainer(),i=this._map.getSize();t.offsetHeight<i.y?t.style.marginTop=(i.y-t.offsetHeight)/2+"px":t.style.marginTop=""},_show:function(t){this._visible&&this._hide(),t=L.Util.extend({},this.options,t),this._render(t),this._setContainerSize(t),this._updatePosition(),L.Util.requestAnimFrame(function(){var t=this._getContentContainer();L.DomEvent.on(t,"transitionend",this._onTransitionEnd,this),L.DomEvent.disableClickPropagation(t),L.DomUtil.addClass(this._container,this.options.SHOW_CLS),L.Browser.any3d||L.Util.requestAnimFrame(this._onTransitionEnd,this)},this);var i=this._container.querySelector("."+this.options.CLOSE_CLS);i&&L.DomEvent.on(i,"click",this._onCloseClick,this);var n=this._container.querySelector("."+this.options.MODAL_CLS);n&&L.DomEvent.on(n,"mousedown",this._onMouseDown,this),"function"==typeof t.onShow&&this._map.once(L.Map.Modal.SHOW,t.onShow),"function"==typeof t.onHide&&this._map.once(L.Map.Modal.HIDE,t.onHide),this._map.fire(L.Map.Modal.SHOW_START,{modal:this})},_onTransitionEnd:function(t){var i={modal:this},n=this._map;this._visible?n.fire(L.Map.Modal.CHANGED,i):L.DomUtil.hasClass(this._container,this.options.SHOW_CLS)?(this._visible=!0,n.fire(L.Map.Modal.SHOW,i)):n.fire(L.Map.Modal.HIDE,i)},_onCloseClick:function(t){L.DomEvent.stop(t),this._hide()},_render:function(t){if(this._container.innerHTML=L.Util.template(t.wrapperTemplate,L.Util.extend({},t,{_content:L.Util.template(t.template,t)})),t.element){var i=this._container.querySelector(L.Map.Modal.classNameToSelector(this.options.MODAL_CONTENT_CLS));i&&i.appendChild(t.element)}},_getContentContainer:function(){return this._container.querySelector(L.Map.Modal.classNameToSelector(this.options.MODAL_CONTENT_CLS))},_getInnerContentContainer:function(){return this._container.querySelector(L.Map.Modal.classNameToSelector(this.options.INNER_CONTENT_CLS))},_setContainerSize:function(t){var i=this._getContentContainer();t.width&&(i.style.width=t.width+"px"),t.height&&(i.style.height=t.height+"px")},_hideInternal:function(){this._visible=!1,L.DomUtil.removeClass(this._container,this.options.SHOW_CLS)},_hide:function(){this._visible&&(this._hideInternal(),L.Util.requestAnimFrame(this._onTransitionEnd,this))},_onMouseDown:function(t){L.DomEvent.stop(t);var i=t.target||t.srcElement;L.DomUtil.hasClass(i,this.options.MODAL_CLS)&&this._hide()},_onKeyDown:function(t){27===(t.keyCode||t.which)&&this._hide()}}),L.Map.addInitHook("addHandler","modal",L.Map.Modal),L.Map.include({openModal:function(t){return this.fire("modal",t)},closeModal:function(){return this.modal.hide(),this}});
