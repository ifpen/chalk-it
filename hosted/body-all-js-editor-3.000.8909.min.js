function DatanodeDependency(){var e={},t=new Map,n=new Map,o=new Map,s=new Map,r=new Map,i=[],a=[];function c(e,t){var n,o,s,r=[];[n,o]=l();var i=new Set;if(e.forEach((function(e){let t=new Set(n.getDescendants(e));t.add(e),r.push(t)})),1==e.length&&0==t.length)t.push(r[0]);else for(let e=0;e<r.length;e++){i=r[e];for(let t=e+1;t<r.length;t++){0!=new Set([...i].filter((e=>r[t].has(e)))).size&&(i=union(i,r[t]))}if(0==t.length)t.push(i);else{for(let e in t){let n=new Set([...i].filter((n=>t[e].has(n))));if(0!=n.size){n.size<i.size&&(i=union(i,t[e]),t.splice(e,1,i)),s=!0;break}s=!1}s||t.push(i)}i=new Set}let a=0;return t.forEach((function(e){e.id=e.values().next().value+Math.random(),e.index=a,a++})),t}function d(){const e=f();i=c(e,[]),offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("All disconnected Graphs: ",i),a=[],i.some((function(e){1==e.size&&e.forEach((function(e,t,n){a.push(t)}))}))}function u(e){return a.includes(e)}function f(){const e=g(),t=e.nodes();let n=[];for(let o in t)(0==e.indegree(t[o])||-1!==t[o].indexOf("pastValue_"))&&n.push(t[o]);return n}function l(){let t=new Graph,n=!1;for(let o in e){let s=o,r=[];e[o].forEach((function(e){r.push(e)})),t.add(s,r);for(let e in r)r[e]===s&&(n=!0)}return[t,n]}function h(){let t=new Graph,n=!1;for(let o in e){let s=o,r=[];e[o].forEach((function(e){let t=!0,n=e.match(/pastValue_(.+)/);if(n){let e=n[1];o==e&&(t=!1)}t&&r.push(e)})),t.add(s,r);for(let e in r)r[e]===s&&(n=!0)}return[t,n]}function g(){let t=new GraphDS;for(let n in e){let o=n;t.addNode(o),e[n].forEach((function(e){t.addEdge(o,e)}))}return t}return{dependencyStructure:e,addNode:function(t){e[t]=new Set},removeNode:function(t){delete e[t];for(let n in e)e[n].has(t)&&e[n].delete(t)},addEdge:function(t,n){e[t].add(n)},removeEdge:function(t,n){e[t].delete(n)},removeMissedDependantDatanodes:function(t,n){for(let o in e)t.has(o)||e[o].has(n)&&e[o].delete(n)},getSuccessors:function(t){return e[t].values()},getPredecessorsSet:function(t){let n=new Set;for(let o in e)e[o].has(t)&&n.add(o);return n},hasSuccessors:function(t){return e[t].size>0},hasPredecessors:function(t){let n=!1;for(let o in e)if(e[o].has(t)){n=!0;break}return n},getSourceNodes:function(){const e=g(),t=e.nodes();let n=[];for(let o in t)0==e.indegree(t[o])&&n.push(t[o]);return n},getSourceNodesWithMemory:f,getDescendantsinBFS:function(e){},getDescendants:function(e,t){let n,o;return[n,o]=t?h():l(),startNodesDesc=new Set,e.forEach((function(e){elemDesc=new Set(n.getDescendants(e)),startNodesDesc=union(startNodesDesc,elemDesc)})),startNodesDesc},getDisconnectedGraphs:c,getBelongingDisconnectedGraph:function(e,t){let n;return t.some((function(t){t.has(e)&&(offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("node ",e," is found in disconnected graph: ",t),n=t)})),n},computeAllDisconnectedGraphs:d,getAllDisconnectedGraphs:function(){return i},resetGraphList:function(){i=[],a=[]},isNode:function(t){return!_.isUndefined(e[t])},renameNode:function(t,n){for(let o in e)e[o].has(t)&&(e[o].delete(t),e[o].add(n));const o=e[t];delete e[t],e[n]=o},topologicalSort:function(){let e=g();return e.nodes().forEach((function(t){datanodesManager.foundDatanode(t)||e.removeNode(t)})),e.topologicalSort()},detectCycles:function(){let e,t;return[e,t]=h(),{hasCycle:e.hasCycle(),getCycles:e.getCycles(),hasLoop:t}},getExtraStartNodesList:function(){return t},addExtraStartNodesList:function(e,n){t.has(e)&&xdashNotifications.manageNotification("info",e,e+" is called many consecutif times while scheduler is in progress"),t.set(e,n)},clearExtraStartNodesList:function(){t.clear()},getSetvarList:function(){return n},addSetvarList:function(e,t){n.has(e)&&n.get(e)!==t&&xdashNotifications.manageNotification("warning",e,'Possible undeterminism: setVariable of "'+e+'" is used more than once in other dataNodes as: "'+n.get(e)+'" and "'+t+'"'),n.set(e,t)},clearSetvarList:function(){n.clear()},getProcessedSetvarList:function(){return o},addProcessedSetvarList:function(e){for(const[t,n]of e.entries())o.set(t,n)},clearProcessedSetvarList:function(){o.clear()},getMemorydataNodeList:function(){return s},addMemorydataNodeList:function(e){s.set(e,"memory")},getCurrentGraphList:function(){return r},addCurrentGraphList:function(e,t){r.has(e),r.set(e,t)},clearCurrentGraphList:function(){r.clear()},clearMemorydataNodeList:function(e){_.isUndefined(e)?s.clear():e.forEach((e=>{s.has(e)&&s.delete(e)}))},getAllsingletonNodes:function(){return offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("SingletonNodeList: ",a),a},isSingletonNode:u,updateDisconnectedGraphsList:function(e,t){switch(t){case"add":case"default":d();break;case"delete":u(e)?function(e){i.some((function(t){if(t.has(e)){t.delete(e);let n=a.indexOf(e);a.splice(n,1)}}))}(e):d()}}}}
function GraphVisu(e){var t,o,n,a,r,d=null,i=[],c=[],l={},s=[],u=[];let g=[],p=[],f=[],h=0;function m(e){const t=datanodesManager.getDataNodeByName(e)?.latestData();return jsonDataToBasicHtmlElement(t,{jsonFormat:PREVIEW_JSON_FORMAT})}function v(e){y();var i={scale:n,offset:{x:t,y:o},animation:{duration:a,easingFunction:r}};d.focus(e,i)}function y(){t=0,o=0,a=1e3,n=3,positionx=300,positiony=300,r="easeInOutQuint"}function b(){y();var e={offset:{x:t,y:o},duration:a,easingFunction:r};d.fit({animation:e})}return $("#inputSearchGraph").on("input",(function(e){var t,o=$(this).val();h=0;for(let e=0;e<u.length;e++)i.update([{id:l[u[e].label],font:{color:"#0843b9",background:"#e3ecff"}}]),u[e].label.toLowerCase().match(o)&&o.length>2&&(i.update([{id:l[u[e].label],font:{color:"white",background:"black"}}]),t=u[e].label,h++);1===h?v(l[t]):b()})),$("#exportGraph").on("click",(function(){var e=document.getElementById("canvas");console.log("mynetworkCanvas",e),e.toBlob((function(e){var t=document.createElement("a");document.body.appendChild(t),t.download="network.png",t.href=window.URL.createObjectURL(e),t.click()}))})),$("#openFullScreen").on("click",(function(){var e=document.getElementById("dependencyGraphBody");e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen()})),$("#zoomIn").on("click",(function(){d.setScale(d.getScale()+.3)})),$("#zoomOut").on("click",(function(){d.setScale(d.getScale()-.3)})),{showDepGraph:function(t){let o=datanodesManager.getAllDataNodes(),n=[];for(let e in o)n[e]=o[e].name();let a=[];for(var r=0;r<n.length;r++)a.push({id:r,label:n[r],title:m(n[r]),type:datanodesManager.getDataNodeByName(n[r]).type(),disconnected:e.isSingletonNode(n[r]),widgetConnection:datanodesManager.isConnectedWithWidgt(n[r])[0]}),l[n[r]]=r;u=a;let s=[],p=[];for(var f=0;f<n.length;f++){p=Array.from(e.dependencyStructure[n[f]]);for(var h=0;h<p.length;h++)s.push({from:f,to:l[p[h]],arrows:"to"})}i=new vis.DataSet(a),c=new vis.DataSet(s),function(e,t){var o=$('<div id="dependencyGraphBody" class="modal-body" style="vertical-align: middle; overflow: auto; display: block; margin: auto; width: 938px; height: 625px; border: 1px solid lightgray;"></div>');document.getElementById("dependencyGraph").hasChildNodes()||o.appendTo($("#dependencyGraph"));var n=document.getElementById("dependencyGraphBody"),a={layout:{randomSeed:3},nodes:{borderWidth:1,font:{size:15,color:"#0843b9"},color:{border:"#478dec",background:"#e3ecff"},shape:"box",margin:15},edges:{color:"#9fb8ed"},interaction:{hover:!0,zoomView:!0},physics:{forceAtlas2Based:{theta:.2,gravitationalConstant:-65,centralGravity:.015,springLength:70,damping:.7,avoidOverlap:.95},minVelocity:20,solver:"forceAtlas2Based",timestep:.1}};d=new vis.Network(n,e,a),$("#dependencyGraphBody canvas").attr("id","canvas"),d.on("doubleClick",(function(e){var t=e.nodes[0];let o=datanodesManager.getAllDataNodes();datanodesManager.editNodeFromGraph(o[t])}));var r=document.getElementById("dependencyGraphBody").getElementsByTagName("canvas")[0];d.on("hoverNode",(function(){r.style.cursor="pointer"})),d.on("blurNode",(function(){r.style.cursor="default"})),d.on("stabilizationIterationsDone",(function(){!function(e){if(g=[],"string"==typeof e)i.update([{id:l[e],color:{background:"orange"}}]),v(l[e]);else if("object"==typeof e){e=JSON.parse(e.target.attributes.name.value);for(let t=0;t<e.length;t++)g.push({id:l[e[t]],color:{background:"orangered"}});i.update(g),1===e.length&&v(l[e[0]])}}(t)})),vis.Network.prototype.setScale=function(e){var t={position:{x:0,y:0},scale:e,animation:{duration:300}};t.scale>=0&&this.view.moveTo(t)}}({nodes:i,edges:c},t)},selectNodeFromTagList:function(e){var t=document.getElementById(e),o=[];if(t.classList.contains("active")){t.classList.remove("active");for(let t=0;t<p.length;t++)p[t].type===e&&(p[t].color={background:"#e3ecff"},o.push(p[t]));i.update(p),b(),-1!==s.indexOf(e)&&s.splice(s.indexOf(e),1);for(let e=0;e<o.length;e++)p.splice(p.indexOf(o[e]),1)}else{h=0,-1===s.indexOf(e)&&s.push(e),t.classList.add("active");for(let t=0;t<u.length;t++)u[t].type===e&&(p.push({id:l[u[t].label],type:e,color:{background:"yellow"}}),h++);i.update(p),1===h?v(p[0].id.toString()):b()}},selectConnectedWithWidget:function(e){var t=document.getElementById(e),o=[];if(t.classList.contains("active")){t.classList.remove("active");for(let t=0;t<f.length;t++)"green"===f[t].color.border&&"connectedtowidget"===e&&(f[t].color={border:"#478dec"},f[t].borderWidth=1,o.push(f[t])),"red"===f[t].color.border&&"notconnectedtowidget"===e&&(f[t].color={border:"#478dec"},f[t].borderWidth=1,o.push(f[t]));i.update(f),b();for(let e=0;e<o.length;e++)f.splice(f.indexOf(o[e]),1)}else{h=0,t.classList.add("active");for(let t=0;t<u.length;t++)!0===u[t].widgetConnection&&"connectedtowidget"===e&&(f.push({id:l[u[t].label],borderWidth:3,color:{border:"green"}}),h++),!1===u[t].widgetConnection&&"notconnectedtowidget"===e&&(f.push({id:l[u[t].label],borderWidth:3,color:{border:"red"}}),h++);i.update(f),1===h?v(f[f.length-1].id.toString()):b()}},closeGraph:function(){for(g=[],p=[],f=[],h=0,$("#inputSearchGraph").val("");s.length;){for(var e=0;e<s.length;e++){document.getElementById(s[e]).classList.remove("active")}s.pop()}document.getElementById("connectedtowidget").classList.remove("active"),document.getElementById("notconnectedtowidget").classList.remove("active")}}}
function DatanodesListModel(e,a,t,n){var o=this;function r(a){var r=new DatanodeModel(o,e,t,n);return r.deserialize(a)?(o.addDatanode(r),!0):(o.error(!0),!1)}this.datanodes=ko.observableArray(),this.datasourceData={},this.processDatanodeUpdate=function(e,a){o.datasourceData[e]=a},this.renameDatanodeData=function(e,a){o.datasourceData[a]=o.datasourceData[e],delete o.datasourceData[e]},this._datanodeTypes=ko.observable(),this.datanodeTypes=ko.computed({read:function(){o._datanodeTypes();var a=[];return _.each(e,(function(e){var t=e.type_name,n=t;_.isUndefined(e.display_name)||(n=e.display_name),a.push({name:t,display_name:n})})),a}}),this.serialize=function(){return{datanodes:o.datanodes().map((e=>e.serialize())).sort(((e,a)=>e.name.localeCompare(a.name)))}},this.deserialize=function(e,a,s){a&&o.clear(),o.error=ko.observable(!1);for(let a=0;a<e.datanodes.length;a++)"REST_web-service_from_datasource"===e.datanodes[a].type||"FMI_web-service_from_datasource"===e.datanodes[a].type||"Map_matching_from_datasource"===e.datanodes[a].type||"Clock_web-service"===e.datanodes[a].type||"Generic_file_reader_plugin"===e.datanodes[a].type||e.datanodes[a].type;const d=e.datanodes;d.sort((function(e,a){return"Memory_plugin"===e.type&&"Memory_plugin"!==a.type?1:"Memory_plugin"!==e.type&&"Memory_plugin"===a.type?-1:void 0}));const i=[];var c,l;d.forEach((e=>{if(function(e){for(var a=!1,t=0;t<o.datanodes().length;t++)if(a=!1,o.datanodes()[t].name()==e){a=!0;break}return a}(e.name))i.push(e);else if(!r(e))throw new Error(`Datanode "${e.name}" is invalid.`)})),0!==i.length&&(c=i,l=xdsjson.getDuplicateDataList(c,"Please check data to be loaded after choosing rename or overwite option"),new DialogBoxForDuplicateData(l,"List of duplicate data name","Load","Close",(function(){for(let e=0;e<c.length;e++)if($("#data-checkbox-"+e).is(":checked"))if(c[e].name=$("#data-check-"+e)[0].value,$("#data-rename-"+e).is(":checked"))r(c[e]);else{const a=o.datanodes().find((a=>a.name()===c[e].name));a&&(o.deleteDatanode(a),o.datanodes.remove(a)),r(c[e])}})));const u={};for(const e in t.dependencyStructure)if(!o.datanodes().find((a=>e===a.name()))){const a=Array.from(t.getSuccessors(e));u[e]=a}if(Object.keys(u).length){const e=Object.entries(u).map((([e,a])=>`'${e}' is referenced in formula of '${a}' but doesn't exist in list of datanodes.`)).join("\n");swal("Missing dataNodes!",e,"error")}t.computeAllDisconnectedGraphs();let m=null,p=null;return o.datanodes().forEach((e=>{_.isUndefined(e.settings().sampleTime)||0==e.settings().sampleTime?p=e:(m=e,e.sampleTime(e.settings().sampleTime),n.registerDatanode(e.sampleTime(),e.name(),"globalFirstUpdate"))})),m&&n.registerDatanode(m.sampleTime(),m.name()),p&&o.launchGlobalFirstUpdate(p),s&&s(),!o.error()},this.launchGlobalFirstUpdate=function(e){var a=t.getSourceNodesWithMemory();0!=a.length&&e.schedulerStart(a,a[0],"globalFirstUpdate")},this.clear=function(){if(t.clearExtraStartNodesList(),t.clearSetvarList(),t.clearProcessedSetvarList(),t.clearCurrentGraphList(),_.each(o.datanodes(),(function(e){o.deleteDatanode(e)})),Object.keys(t.dependencyStructure).length)for(var e in t.dependencyStructure)t.removeNode(e),console.log("extra nodes are deleted");t.resetGraphList(),o.datanodes.removeAll()},this.load=function(e,t,n){a.showLoadingIndicator(!0),o.deserialize(e,t,(function(){return a.showLoadingIndicator(!1),_.isFunction(n)&&n(),!o.error()}))},this.addDatanode=function(e){for(var a=!1,t=0;t<o.datanodes().length;t++)if(a=!1,o.datanodes()[t].name()==e.name()){a=!0;break}a||o.datanodes.unshift(e)},this.deleteDatanode=function(e){var a=e.name();delete o.datasourceData[a],e.dispose()}}
function FormulaInterpreter(e,a,t,n){var s=this;s.bCalculatedSettings=!0,this.callValueFunction=function(t){return datanodesManager.setCurrentDataNode(a.name()),t.call(void 0,e.datasourceData)},this.processCalculatedSetting=function(e,t){var n=!1;let o=t.split("\n");for(let e=0;e<o.length;e++)for(var i=new RegExp("dataNodes.([\\w\\-]{1,}\\.{0,}[\\w\\-]{0,})|dataNodes\\[['\"]([\\w\\\\\\-]{1,})['\"]\\]((\\[['\"]([\\w\\W]){1,}['\"](?=\\])\\])){0,1}","g");matches=i.exec(o[e]);){let t,o;if(_.isUndefined(matches[1])){t=matches[2].split('"]')[0],o=matches[0];let e=1,a=matches[0].split('"]').length-1;if(a>2)for(let t=0;t<a-2;t++)for(o=matches[0].substring(0,matches[0].length-e),e++;!o.endsWith('"]',o.length);)o=matches[0].substring(0,matches[0].length-e),e++}else t=matches[1].split(".")[0],o=matches[0];try{let e=new Function("dataNodes",o);s.callValueFunction(e)}catch(o){a.statusCallback("Error",o.message);const i="var "+t+" in line "+e+" : "+o.message;a.notificationCallback("error",a.settings().name,i,"Error evaluation at datanode : '"+a.name()+"'"),n=!0,s.bCalculatedSettings=!1}}if(!n&&_.isFunction(a.calculatedSettingScripts[e])){let n;try{n=s.callValueFunction(a.calculatedSettingScripts[e])}catch(e){a.statusCallback("Error",e.message),a.notificationCallback("error",a.settings().name,e.message,"Parse error"),n=null,s.bCalculatedSettings=!1}if(!_.isUndefined(a.datanodeInstance)&&_.isFunction(a.datanodeInstance.onCalculatedValueChanged)){if(!_.isEmpty(t))if(_.isUndefined(n)){const t="Parse error while parsing formula in : '"+a.name()+"'";a.notificationCallback("warning",a.settings().name,t,"Parse error"),a.statusCallback("Error","Parse error");try{a.datanodeInstance.onCalculatedValueChanged(e,void 0)}catch(e){console.log(e.toString())}}else if(!_.isNull(n)){const t=!0,s="Success while parsing formula in : '"+a.name()+"'";a.notificationCallback("success",a.settings().name,s,"Parse success",t);try{a.datanodeInstance.onCalculatedValueChanged(e,n)}catch(e){console.log(e.toString())}}}else console.log("datanodeInstance or onCalculatedValueChanged function is not defined")}return!0},this.updateCalculatedSettings=function(e,o,i){if(s.bCalculatedSettings=!0,a.datanodeRefreshNotifications={},a.calculatedSettingScripts={},_.isUndefined(a.type()))return!1;var r=t[a.type()].settings,l=new RegExp("dataNodes.([\\w_-]+)|dataNodes\\[['\"]([^'\"]+)","g");const d=/(setVariables\((\[.+?\]),(\[.*?\])\))|(setVariable\((.+?)),((.*?)[^,])\)|(executeDataNode\(((.*?)[^,])\))|(.executeDataNodes\((\[.+?\])\))|(.setVariableProperty\((.+?),(\[.*?\]),(.*?)[^,]\))/g,c=/(?=["'])(?:"[^"\\]*(?:\\[\s\S][^"\\]*)*"|'[^'\\]*(?:\\[\s\S][^'\\]*)*')|(#.*$)/gm;var u=a.settings(),g=!0;return _.each(r,(function(t){if("calculated"==t.type||"custom2"==t.type){var r=u[t.name];if(!_.isUndefined(r)){if(r=(r=(r="custom2"==t.type?r.replace(c,(function(e,a){return null==a?e:""})):r.replace(/\/\*[\s\S]*?\*\/|([^\\:]|^)\/\/.*$/gm,"$1")).replace(/datasources/g,"dataNodes")).replace(/headersFromDatasourceWS/g,"headersFromDataNodeWS"),_.isArray(r)&&(r="["+r.join(",")+"]"),(r.match(/;/g)||[]).length<=1&&-1==r.indexOf("return"))if(_.isEmpty(r)){if(!_.isUndefined(a.settings().method)&&"POST"==a.settings().method){const e="Cannot have an empty body with a POST method";a.notificationCallback("warning",u.name,e,"Cannot have an empty body with a POST method in datanode : '"+a.name()+"'")}}else r="return "+r;let m,f;if("custom2"!=t.type)try{m=new Function("dataNodes",r)}catch(e){const n=e+".\n Formula interpreted as literal text";a.notificationCallback("warning",u.name,n,"Syntax error at datanode : '"+a.name()+"'");const s=u[t.name].replace(/"/g,'\\"').replace(/[\r\n]/g," \\\n");m=new Function("dataNodes",'return "'+s+'";')}let h=new Set;for(;f=l.exec(r);){const o=f[1]||f[2];if(a.name()===o){const e='DataNode "'+o+'": Please remove from formula the expression dataNodes["'+a.name()+'"].';return a.statusCallback("Error"),swal("Loop detection",e,"error"),s.bCalculatedSettings=!1,void(g=!1)}n.isNode(o)||n.addNode(o);let i=o.match(/pastValue_(.+)/);if(i){let e=i[1];a.name()==e&&(add_edge=!1)}if(n.addEdge(o,a.name()),h.add(o),!e&&!datanodesManager.foundDatanode(o)){const e="DataNode '"+o+"' does not exist in dataNodes list";return a.statusCallback("Error",e),a.notificationCallback("error",a.name(),e,"Error in formula"),void(s.bCalculatedSettings=!1)}let r="";if(n.detectCycles().hasCycle)return n.removeEdge(o,a.name()),r='Cycle detected while computing dataNode "'+o+'" while parsing formula in : "'+a.name()+'"',a.statusCallback("Error"),swal("Cycle detection",r,"error"),s.bCalculatedSettings=!1,void(g=!1);let l=a.datanodeRefreshNotifications[o];_.isUndefined(l)&&(l=[],a.datanodeRefreshNotifications[o]=l),-1==_.indexOf(l,t.name)&&l.push(t.name)}let p=r.split("\n"),C=/\.(goToPage|viewPage|viewProject|\w+Widget)/;"custom2"===t.type&&(C=/\.(output|as_|dashboard|scheduler|goToPage|viewPage|viewProject|\w+Widget)/);for(let e=0;e<p.length;e++)if(p[e]=p[e].replace(/\s/g,""),d.lastIndex=0,_.isNull(d.exec(p[e]))&&_.isNull(p[e].match(C))&&(line=p[e].replace(/(['"])(?:\\.|(?!\1)[^\\\n])*\1/g,""),!_.isNull(line.match(/(chalkit|xDashApi)\.[^\s()]+\(/)))){const e="Syntax error in chalkit API";a.notificationCallback("warning",a.name(),e)}if(n.removeMissedDependantDatanodes(h,a.name()),!i&&!a.settings().autoStart&&a.settings().explicitTrig)return void(offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("init: don't process calculate"));if("custom2"!=t.type&&(a.calculatedSettingScripts[t.name]=m,o&&!s.processCalculatedSetting(t.name,r)))return s.bCalculatedSettings=!1,void(g=!1)}}if("option"==t.type&&t.from_datanode){let e=u[t.name];if(!datanodesManager.foundDatanode(e)){const t="DataNode '"+e+"' does not exist in dataNodes list";return a.statusCallback("Error",t),a.notificationCallback("error",a.name(),t),void(s.bCalculatedSettings=!1)}if(a.name()===e){const t='DataNode "'+e+'": Please select another datanode target.';return a.statusCallback("Error"),swal("Loop detection",t,"error"),s.bCalculatedSettings=!1,void(g=!1)}n.isNode(a.name())||n.addNode(a.name());let o=a.name().match(/pastValue_(.+)/);if(o){e==o[1]&&(add_edge=!1)}n.addEdge(e,a.name()),n.removeMissedDependantDatanodes(new Set([e]),a.name())}})),g}}
function TimeManager(){var e,n,r=[],i=0,o=0,t=[];function a(e,n){_.isUndefined(n)&&(n=e);var r;if(e<n){var i=e;e=n,n=i}return 0==(r=e%n)?n:a(n,r)}function d(e){var n=e;for(var i in r)n=a(r[i],n),offSchedLogUser||xDashConfig.disableSchedulerLog||console.log(o);return n}function l(n){e&&clearInterval(e),e=setInterval((function(){c(!1)}),n),c(!0)}function c(r){if(r)offSchedLogUser||xDashConfig.disableSchedulerLog||console.log(n," timer initialization");else{if(n){var o=datanodesManager.getDataNodeByName(n);o?o.schedulerStart(t,n,"timer"):(clearInterval(e),console.log("initiatorDatanodeModel is undefined"))}else clearInterval(e),console.log("initiatorDatanode is undefined");i+=1}}return{registerDatanode:function(e,a,c){r[a]=e,-1==t.indexOf(a)&&t.push(a),n=t[0],o=d(e),i=0,"globalFirstUpdate"!=c&&l(1e3*o)},unregisterDatanode:function(a){delete r[a];var c=t.indexOf(a);-1!=c?(t.splice(c,1),i=0,0==Object.keys(r).length?(n=void 0,clearInterval(e),e=void 0,o=0):(n=t[0],l(1e3*(o=d())))):offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("error in datanode "+a)},isRegisteredDatanode:function(e){return!_.isUndefined(r[e])},getBasePeriod:function(){return o},getHyperPeriod:function(){},getCurrentTick:function(){return i},getCurrentTime:function(){return i*o}}}
var schedulerProfiling={},schedulerProfilingItem={};function DatanodeScheduler(e,a,t,o,d){if(!_.isUndefined(datanodesManager)){var n=new Set(a),s=new Set,i=new Set,r=new Set,c=new Set,l=new Set;datanodesManager.getAllDataNodes().forEach((function(e){l.add(e.name()),xDashConfig.disableSchedulerProfiling||(schedulerProfiling[e.name()]=[])}));var g=e.getDescendants(a,!0),u=difference(l,g),f=new Set;return u.forEach((function(e){"OK"==datanodesManager.getDataNodeByName(e).status()&&f.add(e)})),{launchSchedule:function(){m()},operationCompleted:function(a,t){let d,c=!0;switch(t){case"OK":i.add(a),s.delete(a),datanodesManager.getDataNodeByName(a).is_specific_exec||e.dependencyStructure[a].forEach((function(e){var a;D(e)&&(p(e)?datanodesManager.getDataNodeByName(e).is_specific_exec?(a=e,i.has(a)||n.add(e)):offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("operation "+e+" not added because already executed"):n.add(e))})),offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("operation "+a+" completed with status "+t),xDashConfig.disableSchedulerProfiling||(schedulerProfilingItem.completion=Date.now(),schedulerProfilingItem.status=t,schedulerProfiling[a].push(schedulerProfilingItem)),n.size&&(c=!1,m());break;case"Error":r.add(a),s.delete(a),d=e.getDescendants([a]),d.forEach((function(e){r.add(e),datanodesManager.getDataNodeByName(e).statusCallback("None"),datanodesManager.getDataNodeByName(e).updateCallback("","None")})),n=difference(n,r),offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("operation "+a+" completed with status "+t),xDashConfig.disableSchedulerProfiling||(schedulerProfilingItem.completion=Date.now(),schedulerProfilingItem.status=t,schedulerProfiling[a].push(schedulerProfilingItem));break;case"NOP":if("OK"===datanodesManager.getDataNodeByName(a).status()){i.add(a),s.delete(a),e.dependencyStructure[a].forEach((function(e){D(e)&&(p(e)?offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("operation "+e+" not added because already executed"):n.add(e))})),offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("operation "+a+" completed with status "+t),xDashConfig.disableSchedulerProfiling||(schedulerProfilingItem.completion=Date.now(),schedulerProfilingItem.status=t,schedulerProfiling[a].push(schedulerProfilingItem)),n.size&&(c=!1,m());break}"None"===datanodesManager.getDataNodeByName(a).status()||"Error"===datanodesManager.getDataNodeByName(a).status()?(r.add(a),s.delete(a),d=e.getDescendants([a]),d.forEach((function(e){r.add(e)})),n=difference(n,r),offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("operation "+a+" completed with status "+t),xDashConfig.disableSchedulerProfiling||(schedulerProfilingItem.completion=Date.now(),schedulerProfilingItem.status=t,schedulerProfiling[a].push(schedulerProfilingItem))):console.log("datanode with explicitTrig ended with status ",datanodesManager.getDataNodeByName(a).status());break;default:return{initiatorNode:o,schedulingInstanceTerminated:!1}}return 0==s.size&&0==n.size&&c?{initiatorNode:o,schedulingInstanceTerminated:!0}:{initiatorNode:o,schedulingInstanceTerminated:!1}},stopAllOperations:function(){n.forEach((function(e){n.delete(e)})),s.forEach((function(e){s.delete(e),datanodesManager.getDataNodeByName(e).completeExecution("NOP"),datanodesManager.getDataNodeByName(e).statusCallback("None"),datanodesManager.getDataNodeByName(e).updateCallback(void 0,"None")}));let e=new Set;for(let a in datanodesManager.getAllDataNodes()){datanodesManager.getAllDataNodes()[a].schedulerStatus("Stop");const t=datanodesManager.getAllDataNodes()[a].getXHR();_.isUndefined(t)||e.add(t)}e.forEach((function(a){a.abort(),e.delete(a)})),null!=datanodesManager.getDataNodeByName(o).execInstance()&&datanodesManager.getDataNodeByName(o).schedulerEnd()},stopOperation:function(e){if(s.has(e)){s.delete(e),datanodesManager.getDataNodeByName(e).completeExecution("NOP"),datanodesManager.getDataNodeByName(e).statusCallback("None"),datanodesManager.getDataNodeByName(e).updateCallback(void 0,"None"),datanodesManager.getDataNodeByName(e).schedulerStatus("Stop");const a=datanodesManager.getDataNodeByName(e).getXHR();_.isUndefined(a)||a.abort()}},getInitiatorNode:function(){return o},getSchedulerCallOrigin:function(){return d},clear:function(){}}}function h(e){return!_.includes(t,e)&&"globalFirstUpdate"!==d}function N(e){if(!_.includes(t,e))return!1;switch(d){case"triggerButton":case"vignette":case"memory":case"setValue":case"setVariable":case"setFile":case"refresh":return!0;default:return!1}}function m(){var a=!0,o=!1;n.forEach((function(l){if(0!=n.size){if(_.isUndefined(datanodesManager.getDataNodeByName(l)))return offSchedLogUser||xDashConfig.disableSchedulerLog||console.log(l+" is not treated because it does not exist"),n.delete(l),void r.add(l);if(datanodesManager.getDataNodeByName(l).is_specific_exec&&!function(e){if(!_.includes(t,e))return!1;switch(d){case"unidentified":case"edit":case"setVariable":case"globalFirstUpdate":return!0;default:return!1}}(l))return console.log(l+" is a memory and will be treated at the end of schedule."),n.delete(l),e.addMemorydataNodeList(l),c.add(l),void datanodesManager.getDataNodeByName(l).completeExecution("NOP");switch(datanodesManager.getDataNodeByName(l).statusForScheduler()){case"Ready":if(datanodesManager.foundDatanode(l)){let t=D(l);datanodesManager.getDataNodeByName(l).is_specific_exec&&(t=!0),t?(n.delete(l),s.add(l),offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("operation "+l+" released"),xDashConfig.disableSchedulerProfiling||(schedulerProfilingItem={release:Date.now()}),a=h(l),o=N(l),datanodesManager.getDataNodeByName(l).updateNow(a,o,t,d)):(n.delete(l),c.add(l),"refresh"==d||"triggerButton"==d?(swal("Update is not available","Predecessors: "+function(a){let t="[";const o=e.getPredecessorsSet(a),d=union(i,f);return difference(o,d).forEach((e=>{t=t+' "'+e+'" '})),t+" ]"}(l)+' of operation "'+l+'" need to be executed first.',"info"),datanodesManager.getDataNodeByName(l).completeExecution("NOP")):"edit"==d||"unidentified"==d?(c.delete(l),s.add(l),offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("operation "+l+" released"),xDashConfig.disableSchedulerProfiling||(schedulerProfilingItem={release:Date.now()}),a=h(l),o=N(l),datanodesManager.getDataNodeByName(l).updateNow(a,o,t,d)):(offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("operation "+l+" is ready but cannot be executed because of its predecessors."),datanodesManager.getDataNodeByName(l).completeExecution("NOP")))}else{const a=Array.from(e.getSuccessors(l));offSchedLogUser||xDashConfig.disableSchedulerLog||console.log(l+" is referenced in '"+a+"' but not defined as a datanode."),datanodesManager.getDataNodeByName(l).completeExecution("NOP")}break;case"Wait":n.delete(l),c.add(l),D(l)?offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("operation "+l+" is waiting for initialization to be done."):offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("operation "+l+" cannot be executed because of its predecessors."),datanodesManager.getDataNodeByName(l).completeExecution("NOP");break;case"NotReady":case"Stop":n.delete(l),r.add(l),offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("operation "+l+" cannot not be scheduled because it needs initialization.");e.getDescendants([l]).forEach((function(e){r.add(e)})),n=difference(n,r),datanodesManager.getDataNodeByName(l).completeExecution("Error")}}else offSchedLogUser||xDashConfig.disableSchedulerLog||console.log(l+" is already treated")}))}function D(a){const t=e.getPredecessorsSet(a),o=union(i,f);return!!isSuperset(o,t)}function p(e){return!!union(i,f).has(e)}}
DatanodeModel=function(e,t,a,n){var o=this;function s(){_.isUndefined(o.datanodeInstance)||(_.isFunction(o.datanodeInstance.onDispose)&&o.datanodeInstance.onDispose(),o.datanodeInstance=void 0)}this.datanodeRefreshNotifications={},this.calculatedSettingScripts={},this.formulaInterpreter=new FormulaInterpreter(e,o,t,a),this.execInstance=ko.observable(null),this.is_specific_exec=!1,this.name=ko.observable(),this.latestData=ko.observable(),this.status=ko.observable("None"),this.last_updated=ko.observable("never"),this.last_error=ko.observable(),this.last_error_msg=ko.observable("none"),this.error=ko.observable(),this.isSchedulerStartSafe=ko.observable(!1),this.sampleTime=ko.observable(0),this.statusForScheduler=ko.observable("Ready"),this.schedulerStatus=ko.observable("Running"),this.iconType=ko.observable(),this.settings=ko.observable({}),this.settings.subscribe((function(e){if(!_.isUndefined(o.datanodeInstance)&&_.isFunction(o.datanodeInstance.onSettingsChanged)){if(!o.formulaInterpreter.updateCalculatedSettings(!0,!1,!1))return void o.error(!0);o.datanodeInstance.onSettingsChanged(e,o.status())?o.error(!1):o.error(!0)}})),this.completeExecution=function(e){const t=o.name();var a,n={};_.isUndefined(datanodesManager.getDataNodeByName(t))||"Stop"==datanodesManager.getDataNodeByName(t).schedulerStatus()&&"NOP"!==e||(a=_.isUndefined(e)?o.status():e,null!==o.execInstance()?n=o.execInstance().operationCompleted(t,a):"Error"===a?offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("scheduling is already terminated. "+t+" is ended with status = "+o.status()):(offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("statusCallback of "+t+" is called before scheduling instance created. Status = "+o.status()),n={schedulingInstanceTerminated:!1}),n.schedulingInstanceTerminated&&(null==o.execInstance()?offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("scheduling is already terminated. "+t+" is ended with status = "+o.status()):datanodesManager.getDataNodeByName(n.initiatorNode).schedulerEnd()))},this.statusCallback=function(e,t){o.status(e),"OK"==e?(o.last_error_msg("No error message"),$('[data-toggle="tooltip"]').tooltip("fixTitle")):"Pending"!==e&&"None"!==e&&"Running"!==e&&o.completeExecution(),_.isUndefined(t)||"Error"!=e||(o.last_error_msg(t),$('[data-toggle="tooltip"]').tooltip("fixTitle"))},this.statusForSchedulerCallback=function(e){o.statusForScheduler(e),"Ready"===e?(offSchedLogUser||xDashConfig.disableSchedulerLog||console.log(o.name()+" is ready now."),o.schedulerStart([o.name()],o.name(),"ReadyNow")):"NotReady"===e?(offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("initialization of "+o.name()+" is interrupted due to error."),o.status("Error"),o.updateCallback(void 0,"Error")):"Stop"===e&&(offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("initialization of "+o.name()+" need to be redone due to stop."),o.status("None"),o.updateCallback("","None"))},this.notificationCallback=function(e,t,a,n,o){xdashNotifications?xdashNotifications.manageNotification(e,t,a,o):(console.log("no notification lib was found. "),_.isUndefined(n)||_.isNull(n)||swal(n,a,e))},this.updateCallback=function(t,a){const n=o.name(),s=new Date;e.processDatanodeUpdate(n,t),o.latestData(t),o.last_updated(s.toLocaleTimeString()),"Error"!==a&&"None"!==a&&"Running"!==a&&o.completeExecution();const i=angular.element(document.body).scope().$root;i.alldatanodes=datanodesManager.getAllDataNodes(),i.safeApply(),widgetConnector.refreshDatanodeConsumers(t,o.name(),o.status(),o.last_updated())},this.type=ko.observable(),this.type.subscribe((function(e){if(s(),e in t&&_.isFunction(t[e].newInstance)){var n=t[e],i=!0;function r(){const e=o.name();return a.isNode(e)||a.addNode(e),n.newInstance(o.settings(),(function(e){if(o.datanodeInstance=e,!o.formulaInterpreter.updateCalculatedSettings(!0,!1,!1))return i=!1,!1}),o.updateCallback,o.statusCallback,o.notificationCallback,o.statusForSchedulerCallback)||(i=!1),!!i}let d=!1;_.isUndefined(n.external_scripts)||_.isUndefined(n.external_scripts[0])||""!==n.external_scripts[0]&&(d=!0),d?head.js(n.external_scripts.slice(0),r):r(),i||o.error(!0)}else swal("DataNode Plugin Error","The required '"+e+"' plugin does not exist in this Chalk'it version !","error"),o.error(!0)})),this.serialize=function(){return{name:o.name(),type:o.type(),settings:o.settings()}},this.deserialize=function(e){o.settings(e.settings),o.name(e.name),o.type(e.type),"Memory_plugin"===e.type&&(o.is_specific_exec=!0);let a="icn-";return _.isUndefined(t[e.type])?a+="json-variable":a+=t[e.type].icon_type.replace(/\.[^/.]+$/,""),o.iconType(a),o.error(),!0},this.getDataRepresentation=function(e){return new Function("data","return "+e+";").call(void 0,o.latestData())},this.schedulerStart=function(e,t,s){var i,r,d=o.name();offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("schedulerStart with sourceNodesArg:",e," and initiatorNodeArg:",t),_.isUndefined(e)?(i=[d],r=d):(i=e,r=t),_.isUndefined(s)&&(s="unidentified");let c=_fillRunningList(i);c.disconSourceNodes.forEach((function(t,o){if(a.addCurrentGraphList(c.disconSourceNodes,o),datanodesManager.foundDatanode(t[0]))if(null==datanodesManager.getDataNodeByName(t[0]).execInstance()){let e=Object.assign({},t);i=_updateSourceNodes(t,s),r=i[0],offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("new scheduler instance with sourceNodes:",i," and initiator:",r);var d=new DatanodeScheduler(a,i,e,r,s);if(currentGraph=c.disconGraphs[o],null!=currentGraph?currentGraph.forEach((function(e){if(!datanodesManager.foundDatanode(e))return text="Datanode '"+e+"' does not exist but referenced in another datanode",void(offSchedLogUser||xDashConfig.disableSchedulerLog||console.log(text));{const t=a.getMemorydataNodeList();if(t.size){const e=Array.from(t.keys()).filter((e=>currentGraph.has(e)));e.length>0&&(offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("Start schedule from memory datanodes list: "+e),a.clearMemorydataNodeList(e),datanodesManager.getDataNodeByName(e[0]).updateNow(!0,!0,!0,"memory"))}null!=datanodesManager.getDataNodeByName(e).execInstance()?offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("Instance of ",e," is already running"):(datanodesManager.getDataNodeByName(e).execInstance(d),datanodesManager.getDataNodeByName(e).schedulerStatus("Running"))}})):offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("error in building disconnected graphs"),!offSchedLogUser&&!xDashConfig.disableSchedulerLog){console.log("scheduling instance created, clkTick:"+n.getCurrentTick()+", clkTime(s):"+n.getCurrentTime());let e=datanodesManager.getDataNodeByName(i[0]).execInstance().getInitiatorNode();console.log("scheduling instance of started with "+e)}datanodesManager.getDataNodeByName(i[0]).execInstance().launchSchedule()}else if("globalFirstUpdate"===s&&0!=n.getCurrentTick())for(var l in e)offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("operation "+e[l]+", called from "+s+", is added to extraStartNodes list"),a.addExtraStartNodesList(e[l],s);else"timer"===s&&0!=n.getCurrentTick()?offSchedLogUser||xDashConfig.disableSchedulerLog||(console.log("Execution of operation "+t[0]+" is ignored at clkTick:"+n.getCurrentTick()+" because scheduling instance is not terminated yet"),console.log("Try to increase sample time of operation "+t[0])):"timer"!==s&&"globalFirstUpdate"!==s&&(offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("operation "+t[0]+", called from "+s+", is added to extraStartNodes list"),a.addExtraStartNodesList(t[0],s));else offSchedLogUser||xDashConfig.disableSchedulerLog||(text="Datanode '"+t[0]+"' does not exist but referenced in another datanode",console.log(text))}))},this.schedulerEnd=function(){o.name()!==o.execInstance().getInitiatorNode()&&(offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("scheduling instance will not be terminated by the initiator "+o.execInstance().getInitiatorNode()));const e=o.execInstance().getSchedulerCallOrigin();if(null!=o.execInstance()){const t=a.getAllDisconnectedGraphs();offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("get belonging disconnected graph (from schedulerEnd)"),graph=a.getBelongingDisconnectedGraph(o.name(),t),null!=graph&&graph.forEach((function(e){datanodesManager.foundDatanode(e)?null==datanodesManager.getDataNodeByName(e).execInstance()?offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("Instance of ",e," is already terminated"):(datanodesManager.getDataNodeByName(e).execInstance(null),datanodesManager.getDataNodeByName(e).isSchedulerStartSafe(!0)):offSchedLogUser||xDashConfig.disableSchedulerLog||(text="Datanode '"+e+"' does not exist but referenced in another datanode",console.log(text))})),offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("scheduling instance terminated by "+o.name());const n=a.getMemorydataNodeList(),s=a.getSetvarList(),i=a.getProcessedSetvarList(),r=new Map(Array.from(s).filter((([e])=>!i.has(e))));let d=!0;const c=a.getCurrentGraphList(),l=Array.from(c.keys()),g=c.get(l[0]);if(c.size&&(d=!1,g===l[0].length-1&&(d=!0)),d)if("timer"!==e&&a.clearCurrentGraphList(),r.size){offSchedLogUser||xDashConfig.disableSchedulerLog||(console.log("Start schedule from setVariable list: "+Array.from(r.keys())),console.log("triggered by : "+Array.from(r.values())));const e=Array.from(r.keys());if(a.addProcessedSetvarList(r),a.clearSetvarList(),n.size){const e=Array.from(n.keys()).filter((e=>r.has(e)));a.clearMemorydataNodeList(e)}o.schedulerStart(e,e[0],"setVariable")}else{a.clearSetvarList(),a.clearProcessedSetvarList();const e=a.getExtraStartNodesList();if(e.size){offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("Start schedule from extraStartNodesList:"+Array.from(e.keys()));const t=Array.from(e.keys()),n=e.get(t[0]);a.clearExtraStartNodesList(),o.schedulerStart(t,t[0],n)}}else offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("Problem : request for ending a scheduling instance whereas no instance exists")}},this.updateNow=function(e,t,s,i){var r=!1;if(o.sampleTime()<1&&o.sampleTime()>=.1?Math.floor(10*n.getCurrentTime())%(10*o.sampleTime())==0&&(r=!0):o.sampleTime()>=1?n.getCurrentTime()%o.sampleTime()==0&&(r=!0):0!=o.sampleTime()&&console.log("sampleTime cannot be lesser than 0.1s"),0==o.sampleTime()||r){if(!function(e,t,a){return e&&o.settings().explicitTrig?(o.completeExecution("NOP"),offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("Called from predecessor, but ExplicitTrigger of ",o.settings().name+" is true"),!1):"timer"===a&&o.settings().explicitTrig?(o.completeExecution("NOP"),offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("Called from timer, but ExplicitTrigger of ",o.settings().name+" is true"),!1):!!(_.isUndefined(o.settings().autoStart)||o.settings().autoStart||t||e||"timer"===a&&"OK"===o.status())||(o.completeExecution("NOP"),offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("AutoStart of ",o.settings().name+" is false"),!1)}(e,t,i))return;if(!_.isUndefined(o.datanodeInstance)&&_.isFunction(o.datanodeInstance.updateNow)){if(!o.formulaInterpreter.updateCalculatedSettings(!1,s,t))return void o.error(!0);if(s)if(o.formulaInterpreter.bCalculatedSettings){let e=Array.from(a.getPredecessorsSet(o.name()));var d=o.datanodeInstance.updateNow(t,e);_.isUndefined(d)||d.notTobeExecuted&&o.completeExecution("NOP")}else o.notificationCallback("info",o.settings().name,"Scheduling of this operation is interrupted because of its last error","Scheduler interruption"),o.updateCallback(void 0,"Error");else o.settings().explicitTrig&&!o.settings().autoStart||swal("Update is not available",'Predecessors of operation "'+o.settings().name+'" need to be executed first.',"info"),o.completeExecution("NOP"),o.updateCallback(void 0,"None")}}else offSchedLogUser||xDashConfig.disableSchedulerLog||console.log(o.name()+" is not executed because currentTime: "+n.getCurrentTime()+" is not multiple of sampleTime: "+o.sampleTime()),o.completeExecution("NOP")},this.dispose=function(){const e=o.name();a.removeNode(e),o.sampleTime()&&n.unregisterDatanode(e),null!=o.execInstance()&&(e!==o.execInstance().getInitiatorNode()?o.execInstance().stopOperation(e):(o.notificationCallback("info",e,"Scheduling is aborted because datanode "+e+" is part of scheduling operations","Scheduler stop"),o.execInstance().stopAllOperations())),s()},this.canSetValue=function(){return o.datanodeInstance.canSetValue()},this.setValue=function(e,t,a){_.isFunction(o.datanodeInstance.getValue)?t!=o.datanodeInstance.getValue(e)&&setDirtyFlagSafe(!0):setDirtyFlagSafe(!0),o.datanodeInstance.setValue(e,t),a||o.schedulerStart([o.name()],o.name(),"setValue")},this.setValueSpec=function(t,a){const n=o.name();o.setValue(t,a),newData=JSON.parse(o.settings().json_var);var s=new Date,i=o.dataPreviewFormat.format(newData);newData=i.newData,o.beautifulString(i.previewData),e.processDatanodeUpdate(n,newData),o.latestData(newData),o.last_updated(s.toLocaleTimeString()),setDirtyFlagSafe(!0)},this.setFile=function(e){o.datanodeInstance.setFile(e)&&(o.schedulerStart([o.name()],o.name(),"setFile"),setDirtyFlagSafe(!0))},this.isSettingNameChanged=function(e){if(!_.isUndefined(o.datanodeInstance))return o.datanodeInstance.isSettingNameChanged(e)},this.getSavedSettings=function(){if(!_.isUndefined(o.datanodeInstance)&&_.isFunction(o.datanodeInstance.getSavedSettings))return o.datanodeInstance.getSavedSettings()},this.isSettingSampleTimeChanged=function(e){if(!_.isUndefined(o.datanodeInstance)&&_.isFunction(o.datanodeInstance.isSettingSampleTimeChanged))return o.datanodeInstance.isSettingSampleTimeChanged(e)},this.getXHR=function(){if(!_.isUndefined(o.datanodeInstance)&&_.isFunction(o.datanodeInstance.getXHR))return o.datanodeInstance.getXHR()},_fillRunningList=function(e){let t={disconSourceNodes:[],disconGraphs:[],indicesDisconGraphs:[]};const n=a.getAllDisconnectedGraphs();return e.forEach((function(e){offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("get belonging disconnected graph (from schedulerStart)"),graph=a.getBelongingDisconnectedGraph(e,n),null!=graph?t.indicesDisconGraphs.includes(graph.index)?t.disconSourceNodes[t.indicesDisconGraphs.indexOf(graph.index)].push(e):(t.indicesDisconGraphs.push(graph.index),t.disconSourceNodes.push([e]),t.disconGraphs.push(graph)):offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("error in building disconnected graphs")})),a.addCurrentGraphList(t.disconSourceNodes,0),t},_updateSourceNodes=function(e,t){let n=new Set(e);if(descendants=a.getDescendants(e),descendants.forEach((e=>{-1!==e.indexOf("pastValue_")&&descendants.delete(e)})),"setVariable"===t){let e=new Set,t=new Set;n.forEach((t=>{t.startsWith("pastValue_")||e.add(t)})),n.forEach((a=>{if(a.startsWith("pastValue_")){let n=a.substring(10);e.has(n)&&(t.add(a),t.add(n))}})),t.forEach((e=>{descendants.delete(e)}))}return new Set(Array.from(descendants).filter((e=>n.has(e)))).forEach((function(t){e.splice(e.indexOf(t),1)})),e.sort(((e,t)=>(meetsCondition_a=-1!==e.indexOf("pastValue_"),meetsCondition_b=-1!==t.indexOf("pastValue_"),meetsCondition_a&&!meetsCondition_b?-1:!meetsCondition_a&&meetsCondition_b?1:0)))}};
function DialogBox(e,c,i,n,t,o){var a,d,l=$('<div class="modalDialog modalDialogOpen" style="z-index:1000"></div>');_.isUndefined($(".code-mirror-wrapper")[0])||($(l)[0].style.zIndex=6e3),_.isUndefined($(".showSweetAlert")[0])||($(l)[0].style.zIndex=99999);var s=$('<div class="modalDialog__wrapper"></div>');function p(){$(document).unbind("keydown",h),l.fadeOut(200,(function(){$(this).remove()}))}function h(e){27===e.keyCode&&(n||r())}$(document).on("keydown",h),s.append('<div class="modalDialog__header"><h2>'+c+"</h2></div>"),$('<div class="modalDialog__content"></div>').appendTo(s).append(e);var u=$('<div class="modalDialog__footer"></div>').appendTo(s);function r(){var e=!1;_.isFunction(t)&&(e=a?t(a):d?t(d):t()),e||p()}n&&($('<input id="dialog-cancel" type="button" class="btn btn-rounded-fill cancel"  value="'+n+'"></input>').appendTo(u).click((function(){_.isFunction(o)?o():_.isUndefined(o)||(a=o),p()})),_.isUndefined(o)||_.isFunction(o)||(d=o)),i&&$('<input id="dialog-ok" type="button" class="btn btn-rounded-fill primary" value="'+i+'"></input>').appendTo(u).click(r),l.append(s),$("body").append(l),l.fadeIn(200)}function DialogBoxForToolboxEdit(e,c,i,n,t){DialogBox(e,c,i,n,t)}function DialogBoxForData(e,c,i,n,t){DialogBox(e,c,i,n,t),_.isUndefined($("#check-all"))||($("#check-all").click((function(e){this.checked&&($(".check-option1").each((function(){this.checked=!0})),$("#uncheck-all")[0].checked=!1)})),$("#uncheck-all").click((function(e){this.checked&&($(".check-option1").each((function(){this.checked=!1})),$("#check-all")[0].checked=!1)})),$(".check-option1").click((function(){$("#check-all")[0].checked=!1,$("#uncheck-all")[0].checked=!1})))}function DialogBoxForDuplicateData(e,c,i,n,t){if(DialogBoxForData(e,c,i,n,t),!_.isUndefined($(".data-check-input")[0])){$(".data-check-input").each((function(){$(".data-check-input").on("change paste input",(function(e){for(var c=this.id.substring(this.id.length-1,this.id.length),i=!1,n=0;n<datanodesManager.getAllDataNodes().length;n++)if(datanodesManager.getAllDataNodes()[n].name()==this.value){i=!0;break}i?($("#data-overwrite-"+c)[0].checked=!0,$("#data-checkbox-"+c)[0].checked=!1):($("#data-rename-"+c)[0].checked=!0,$("#data-checkbox-"+c)[0].checked=!0)}))}))}}function copyURLtoClipboard(){document.getElementById("swal-input").select(),document.execCommand("copy"),$("#swal-p")[0].style.visibility="visible",setTimeout((function(){$("#swal-p")[0].style.visibility="hidden"}),1500)}function DialogBoxForHtmlExport(e,c,i,n,t,o){DialogBox(e,c,i,n,t,o),_.isUndefined(o)?($("#select-export-settings")[0].value=htmlExport.exportOptions,$("#check-scale-export")[0].checked=htmlExport.checkExportOptions):($("#select-export-settings")[0].value=o[0].exportOptions,$("#check-scale-export")[0].checked=o[0].checkExportOptions,$("#check-scale-export").attr("disabled",!0))}
PluginEditor=function(e){function n(e,n){var a,t=$('<div class="validation--error"></div>').html(n);_.isUndefined($("#setting-value-container-data_path")[0])||(a=$("#setting-value-container-data_path")[0].childNodes[$("#setting-value-container-data_path")[0].childNodes.length-1]),"data_path"==e&&(_.isUndefined(a)||(a.style.display="table-cell"),t[0].style.display="table-cell",t[0].style.height="25px"),"name"!=e&&"url"!=e||(_.isUndefined(a)||(a.style.display=""),t[0].style.display=""),$("#setting-value-container-"+e).append(t)}function t(n,a,t,i,s,l){var o=$('<textarea autocorrect="off" autocomplete="off" spellcheck="false" class="calculated-value-input" style="display:none; width:78%"></textarea>');t.multi_input?o.change((function(){var e=[];$(n).find("textarea").each((function(){var n=$(this).val();n&&(e=e.concat(n))})),a.settings[t.name]=e})):o.change((function(){a.settings[t.name]=$(this).val()})),i&&o.val(i);var d=$('<div class="codemirror-wrapper__top"></div>'),r=$('<div class="calculated-setting-row codemirror-wrapper"></div>');r.append(d);var c=e.displayMiniJSEditor(r,o.val(),a,(function(e){o.val(e),o.change()}));r.append(o);var p=$('<a>Full Screen view<i class="basic icn-full-screen""></i></a>').mousedown((function(n){n.preventDefault(),e.displayJSEditor(o.val(),a,t,l,(function(e){c.setValue(e),o.val(e),o.change()}))}));if(d.append(p),s){var u=$('<li class="remove-setting-row"><i class="icon-minus icon"></i><label></label></li>').mousedown((function(e){e.preventDefault(),r.remove(),$(n).find("textarea:first").change()}));d.prepend(u)}$(n).append(r),_.isUndefined(t.description1)||$(n).append($('<div class="setting-description" style="display:block;">'+t.description1+"</div>"))}var i={type:"",iconType:"",settings:{}};function s(e,n,s,l){var o,d;if(i={type:n,iconType:"",settings:{}},!_.isUndefined(l))return d=l,i.type=d,i.settings={},$(".input-wrapper-current").remove(),o=e[d],i.iconType=o.icon_type,void(_.isUndefined(o)||(angular.element(document.body).scope().$root.dataNodeDescription=o.description,_.isUndefined(o.preFillBody)?r(o.settings,o.typeahead_source,o.typeahead_data_segment):r(o.settings,o.typeahead_source,o.typeahead_data_segment,o.preFillBody)));function r(e,n,a,l){!function(){let e=$("#data-form-content")[0];for(;e.firstChild;)e.removeChild(e.firstChild)}(),_.each(e,(function(e){!_.isUndefined(e.default_value)&&_.isUndefined(s[e.name])&&(s[e.name]=e.default_value),"body"==e.name&&1==s.bodyPrefill&&(_.isUndefined(e.default_value)?s[e.name]="":""===s[e.name]&&(s[e.name]=e.default_value));var o,d=e.name;switch(_.isUndefined(e.display_name)||(d=e.display_name),o=function(e,n){let a=$('<div id="setting-row-'+e+'" class="form-row"></div>').appendTo("#data-form-content");return a.append('<div class="form-label"><label class="control-label">'+n+"</label></div>"),$('<div id="setting-value-container-'+e+'" class="form-value"></div>').appendTo(a)}(e.name,d),e.type){case"array":{var r=$('<div style="display:inline-table"></div>').appendTo(o),c=$('<div class="form-table-value-subtable" style="width:80%"></div>').appendTo(r),p=$('<table class="sub-table"></table>').appendTo(c),u=$("<thead></thead>").hide().appendTo(p),f=$("<tr></tr>").appendTo(u),m=$("<tbody></tbody>").appendTo(p),v=[];function g(){i.settings[e.name].length>0?u.show():u.hide()}function h(n){var a=$("<tr></tr>").appendTo(m),t={},s=!1;_.isArray(i.settings[e.name])||(i.settings[e.name]=[],s=!0);var l=2*i.settings[e.name].length;i.settings[e.name].push(t),_.each(e.settings,(function(i){var o=$("<td></td>").appendTo(a),d="";_.isUndefined(n[i.name])||(d=n[i.name]),t[i.name]=d;var r="table-row-value-"+e.name+l;$("<input id="+r+' class="table--row-value" type="text">').appendTo(o).val(d).change((function(){t[i.name]=$(this).val()})),s&&$("input#"+r)[0].setAttribute("readonly","readonly"),l++})),s?a.append($('<td class="table-row-operation"></td>').append($('<ul class="board-toolbar"></ul>').append($("<li></li>").append($('<i class=" icon"></i>'))))):a.append($('<td class="table-row-operation"></td>').append($('<ul class="board-toolbar"></ul>').append($("<li></li>").append($('<i class="icon-trash icon"></i>').click((function(){var n=i.settings[e.name].indexOf(t);-1!=n&&(i.settings[e.name].splice(n,1),a.remove(),g())})))))),c.scrollTop(c[0].scrollHeight),g()}if(_.each(e.settings,(function(e){var n=e.name;_.isUndefined(e.display_name)||(n=e.display_name),$("<th>"+n+"</th>").appendTo(f)})),e.name in s&&(v=s[e.name]),$('<label class="board-toolbar datasource-input-suffix"><i class="fa-plus fa"></i>ADD</label>').appendTo(r).click((function(){var n={};_.each(e.settings,(function(e){n[e.name]=""})),h(n)})),_.each(v,(function(e,n){h(e)})),0==v.length){var y={};_.each(e.settings,(function(e){y[e.name]=""})),i.settings.req_data_type="none",$("select#select-option-req_data_type")[0].value="none",h(y)}break}case"boolean":{i.settings[e.name]=s[e.name];let E=$("<div></div>").appendTo(o);var b=$('<div class="onoffswitch" style="display:inline-block"><label class="onoffswitch-label" for="'+e.name+'-onoff"><div class="onoffswitch-inner"><span class="on">YES</span><span class="off">NO</span></div><div class="onoffswitch-switch"></div></label></div>').appendTo(E),w=$('<input type="checkbox" name="onoffswitch" class="onoffswitch-checkbox" id="'+e.name+'-onoff">').prependTo(b).change((function(){i.settings[e.name]=this.checked}));e.name in s&&w.prop("checked",s[e.name]);break}case"browseText":case"browseBinary":{const M="browseBinary"===e.type;i.settings[e.name]=s[e.name],i.settings.content=s.content;const F=document.createElement("input");if(F.type="text",F.style.float="left",e.name in s){const O=s[e.name],P=Path2FileName(O);F.value=P}const D=document.createElement("input");D.type="file",D.style.display="none",e.accept&&(D.accept=e.accept);const J=$('<label class="board-toolbar datasource-input-suffix"><i class="fa-folder-open fa"></i>Browse...</label>');D.addEventListener("change",(function(n){if(!n.target.files.length)return;const a=n.target.files[0],t=a.name;F.value=t;const s=new FileReader;s.addEventListener("load",(function(n){const s=n.target.result;i.settings.content={name:t,type:a.type,isBinary:M,content:M?btoa([].reduce.call(new Uint8Array(s),(function(e,n){return e+String.fromCharCode(n)}),"")):s},i.settings[e.name]=t})),M?s.readAsArrayBuffer(a):s.readAsText(a)})),$(F).on("click",(()=>D.click())),J.on("click",(()=>D.click())),o.append([F,D,J]);break}case"json":if(i.settings[e.name]=s[e.name],i.settings.content=s.content,_.isUndefined($("#var-body")[0]))if((w=$('<input type="text" title="'+e.display_name+'" class="input__wrapper--text" id="var-body" autocorrect="off" autocomplete="off" spellcheck="false" />')).appendTo(o).change((function(){if(i.settings[e.name]=$(this).val(),!e.short_display){let e=datanodesManager.getJsonEditor();datanodesManager.getJsonEd().updateEditor(e,$(this).val())}})),!e.short_display)$('<div class="btn-wrapper btn-wrapper--no-label input-wrapper-current" id="btn-json">').appendTo($("#data-form-content")),$('<div class="tree__preview__container input-wrapper-current" style="height:unset"><div id="full-screen-json" class="tree__preview__container--top"><a><p>Full Screen view</p><i class="basic icn-full-screen"></i></a></div><div id="tree-preview" style="height: 36vh;"></div></div>').appendTo($("#data-form-content")),$("#full-screen-json").on("click",(function(){var e=document.getElementById("tree-preview");e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen()})),datanodesManager.getJsonEd().displayJSONEdit(w.val(),(function(e){w.val(e),w.change()}));if(e.name in s&&($("#var-body").val(s[e.name]),!e.short_display)){let V=datanodesManager.getJsonEditor();datanodesManager.getJsonEd().updateEditor(V,s[e.name])}break;case"option":var T=s[e.name],k="select-option-"+e.name;w=$('<select id="'+k+'"></select>').appendTo($('<div class="styled-select"></div>').appendTo(o)).change((function(){i.settings[e.name]=$(this).val(),_.isUndefined($("#value-dn_name")[0])||(i.settings.name="pastValue_"+$(this).val(),$("#value-dn_name")[0].value="pastValue_"+$(this).val()),("FMI_webservice"===e.name&&i.settings.bodyPrefill||"req_data_type"===e.name)&&l()}));if(e.from_datanode){let q=datanodesManager.getAllDataNodes();q.length&&(q=q.filter((e=>"Memory_plugin"!==e.type())),q.sort(((e,n)=>e.name().localeCompare(n.name()))),q.some((e=>e.name()===T))||(T=void 0),_.each(q,(function(e){let n=e.name(),a=e.name();_.isUndefined(T)&&(T=a),$("<option></option>").text(n).attr("value",a).appendTo(w)})),_.isUndefined($("#value-dn_name")[0])||(i.settings.name="pastValue_"+T,$("#value-dn_name")[0].value="pastValue_"+T))}else _.each(e.options,(function(e){let n,a;_.isObject(e)?(n=e.name,a=e.value):n=e,_.isUndefined(a)&&(a=n),_.isUndefined(T)&&(T=a),$("<option></option>").text(n).attr("value",a).appendTo(w)}));i.settings[e.name]=T,e.name in s&&w.val(s[e.name]);break;case"custom1":case"custom2":i.settings[e.name]=s[e.name],e.implementation(o,e,s,i);break;default:if(i.settings[e.name]=s[e.name],"calculated"==e.type){if(e.name in s){var x=s[e.name];if(e.multi_input&&_.isArray(x))for(var S=!1,U=0;U<x.length;U++)t(o,i,e,x[U],S),S=!0;else t(o,i,e,x,!1)}else t(o,i,e,null,!1);if(e.multi_input){var C=$('<ul class="board-toolbar"><li class="add-setting-row"><i class="fa-plus fa"></i><label>ADD</label></li></ul>').mousedown((function(n){n.preventDefault(),t(o,i,e,null,!0)}));$(o).siblings(".form-label").append(C)}}else{let A="";if(A=e.disabled&&"Generated memory name"===e.display_name?'<input type="text" id="value-dn_name" title="'+e.display_name+'" class="input__wrapper--text disabled" disabled />':'<input type="text" title="'+e.display_name+'" class="input__wrapper--text" />',w=$(A).appendTo(o).change((function(){if("name"==e.name&&($('<input type="text">')[0].maxLength=40),"number"==e.type)i.settings[e.name]=Number($(this).val());else{var n=!1,a="";for(var a in widgetConnector.widgetsConnection){for(var t in widgetConnector.widgetsConnection[a].sliders)if("None"!=widgetConnector.widgetsConnection[a].sliders[t].name&&!_.isUndefined(widgetConnector.widgetsConnection[a].sliders[t].connectedDataNodeS)&&widgetConnector.widgetsConnection[a].sliders[t].connectedDataNodeS===i.settings[e.name]){n=!0;break}if(n)break}n&&swal("'"+i.settings[e.name]+"' is now missing","Connections with widget '"+widgetConnector.widgetsConnection[a].modelJsonId+"' may be removed!","warning"),i.settings[e.name]=$(this).val()}})),e.name in s&&w.val(s[e.name]),n&&e.typeahead_data_field&&w.addClass("typeahead_data_field-"+e.typeahead_data_field),n&&e.typeahead_field){var N=[];w.keyup((function(e){e.which>=65&&e.which<=91&&w.trigger("change")})),$(w).autocomplete({source:N,select:function(e,n){w.val(n.item.value),w.trigger("change")}}),w.change((function(t){var i=w.val(),s=_.template(n)({input:i});$.get(s,(function(n){if(a&&(n=n[a]),n=_.select(n,(function(n){return n[e.typeahead_field][0]==i[0]})),N=_.map(n,(function(n){return n[e.typeahead_field]})),$(w).autocomplete("option","source",N),1==n.length)for(var t in n=n[0])if(n.hasOwnProperty(t)){var s=$(_.template("input.typeahead_data_field-<%= field %>")({field:t}));s&&(s.val(n[t]),s.val()!=w.val()&&s.trigger("change"))}}))}))}}}_.isUndefined(e.suffix)||o.append($('<div class="input--suffix">'+e.suffix+"</div>")),_.isUndefined(e.description)||o.append($('<div class="setting-description">'+e.description+"</div>"))}))}for(var c=[{name:"JSON",searchString:["Variable"]},{name:"Scripting",searchString:["Python","JavaScript"]},{name:"APIs",searchString:["REST"]},{name:"Files",searchString:["Generic","CSV file","Unzip"]},{name:"Streams & Real-time",searchString:["Clock","Delay","Memory","WebSocket","MQTT","Geoloc"]},{name:"Others",searchString:""}],p=[],u=0;u<c.length;u++)p[c[u].name]=[];if(_.each(e,(function(e){let n=c.length-1;for(let t=0;t<c.length;t++){var a=!1;for(let i=0;i<c[t].searchString.length;i++)if(-1!=e.display_name.search(c[t].searchString[i])){n=t,a=!0;break}if(a)break}p[c[n].name].push({name:e.display_name,type:e.type_name})})),0==$("#datanode-list").children().length){$("#datanode-list")[0].innerHTML="",$('<div class="panel--content--top"><h1>New</h1><button ng-click="editorView.newDatanodePanel.view=!editorView.newDatanodePanel.view" class="btn btn-icon-only"><i class="basic icn-miniarrowleft"></i></button></div>').appendTo($("#datanode-list"));for(let e=0;e<c.length;e++)if(p[c[e].name].length>0){var f=$('<div class="add__new__datanode--list--wrap"></div>').appendTo($("#datanode-list"));$("<span>"+c[e].name+"</span>").appendTo(f);let n=$("<ul></ul>").appendTo(f);for(let t=0;t<p[c[e].name].length;t++)a=$('<a title="Open '+c[e].name+" : "+p[c[e].name][t].name+' dataNode" ng-click="openDataNodeTypePlugin(\''+p[c[e].name][t].type+"')\"></a>").appendTo($("<li></li>").appendTo(n)),a.text(p[c[e].name][t].name),$('<i class="basic icn-miniarrowright"></i>').appendTo(a)}angular.element(document.body).scope().$root.myDataNodeHTML=$("#datanode-list").html()}}return{createPluginEditor:function(e,n,a,t){s(e,n,a,t)},getNewSettings:function(){return i},saveSettings:function(e,a,t){return function(e,a,t){$(".validation--error").remove(),i=a;for(var s=0;s<e.settings.length;s++){var l=e.settings[s];if(l.required&&(_.isUndefined(i.settings[l.name])||""==i.settings[l.name]))return n(l.name,"This is required."),!0;if("integer"==l.type&&i.settings[l.name]%1!=0)return n(l.name,"Must be a whole number."),!0;if("number"==l.type&&(o=i.settings[l.name],isNaN(parseFloat(o))||!isFinite(o)))return n(l.name,"Must be a number."),!0;if("text"==l.type&&"name"==l.name){if(-1!==i.settings[l.name].indexOf("\\"))return n(l.name,"Backslash '\\' is forbidden."),!0;if((-1!==i.settings[l.name].indexOf("pastValue_")||-1!==i.settings[l.name].indexOf("past."))&&"Memory_plugin"!==i.type)return n(l.name,"'pastValue_' is forbidden. It is dedicated to memory dataNode."),!0}}var o;"JSON_var_plugin"==i.type&&datanodesManager.getJsonEd().updateVal();return"Map_matching_from_datanode"!=i.type||navigator.onLine?_.isFunction(t)?!1!==t(i):void 0:(swal("Need internet connection for '"+i.settings.name+"'","Please verify your connection then reload the page","error"),!1)}(e,a,t)}}};
var JSONEdit=function(){let e,t="code";return{displayJSONEdit:function(o,n){$('<button class = "btn btn-rounded" onclick="var json = datanodesManager.getJsonEd();json.loadJSON()"> <i class = "basic icn-upload"></i>Import Json</button>').appendTo($("#btn-json")),$('<button class = "btn btn-rounded" onclick="var json = datanodesManager.getJsonEd();json.saveJSON()"> <i class = "basic icn-download"></i>Export Json</button>').appendTo($("#btn-json")),$('<div id="jsonedit"style="height:100%"></div>').appendTo($("#tree-preview")),function(o,n){function r(){let t={};try{t=e.get();const o=JSON.stringify(t);n(o)}catch(e){return void swal("Error",e.message,"error")}}const s=$("#jsonedit");$("#jsonedit")[0].innerHTML="";const a={mode:"code",modes:["code","tree"],onError:function(e){swal("Error",e.toString(),"error")},onModeChange:function(e,o){"tree"==e?($("#var-body").prop("disabled",!0),$("#jsonedit").off("focusout"),t="tree"):"code"==e&&($("#var-body").prop("disabled",!1),$("#jsonedit").on("focusout",r),t="code")},language:"en"};e=new JSONEditor(s[0],a),datanodesManager.setJsonEditor(e);try{o&&e.set(JSON.parse(o))}catch(e){swal("JSON Parse error",e.message,"error")}$("#jsonedit").on("focusout",r)}(o,n)},loadJSON:function(){if(e=datanodesManager.getJsonEditor(),window.File&&window.FileReader&&window.FileList&&window.Blob){const t=document.createElement("input");t.type="file",t.setAttribute("accept",".json"),$(t).on("change",(function(t){const o=t.target.files;if(o&&o.length>0){const t=o[0],n=new FileReader;n.addEventListener("load",(function(t){try{e.setText(t.target.result);const o=e.get(),n=JSON.stringify(o);$("#var-body").val(n),$("#var-body").change()}catch(e){swal("JSON Parse error",e.message,"error")}})),n.readAsText(t)}})),$(t).trigger("click")}else swal("Unable to load a file in this browser.","","error")},saveJSON:function(){e=datanodesManager.getJsonEditor(),swal({title:"Export JSON",text:"Save as ...",type:"input",showConfirmButton:!1,showConfirmButton1:!0,showCancelButton:!0,confirmButtonText:"Save",closeOnConfirm:!1,closeOnConfirm1:!1,inputPlaceholder:"please write JSON file name here ..."},(function(t){if(!1===t)return!1;if(""===t)return swal.showInputError("JSON file name is required!"),!1;if(null!=t){let o=t;-1==o.indexOf(".")?o+=".json":"json"==o.split(".").pop().toLowerCase()||(o=o.split(".")[0]+".json");const n=new Blob([e.getText()],{type:"application/json;charset=utf-8"});saveAs(n,o),swal.close()}}))},getJsonEd:function(){return e},updateEditor:function(e,t){datanodesManager.setJsonEditor(e);try{t&&e.set(JSON.parse(t))}catch(e){swal("JSON Parse error",e.message,"error")}},updateVal:function(){if("tree"==t){const t=e.get(),o=JSON.stringify(t);$("#var-body").val(o),$("#var-body").change()}}}};
JSEditor=function(){function e(e){e}function t(e,t,o,n,i){var a=t.settings.name,d="";"JSON_formula_plugin"===t.type?d='// Example: Convert temp from C to F and truncate to 2 decimal places.\n// return (dataNodes["MyDataNode"].sensor.tempInF * 1.8 + 32).toFixed(2);\n':"Python_inline_plugin"===t.type&&(d="#example: create 2 datanodes py_a a,d py_b then use them as follow:\n#return {'a':dataNodes[\"py_a\"],'b':dataNodes[\"py_b\"]}; \n#simple example:\nreturn {'key':'value'}; \n "),e||(e=d);var r=$('<div id="code-window-js" class="code-window cancel__box cancel__box--xl"></div>'),c=$('<div class="code-mirror-wrapper" id="codeWrapper"></div>'),s=$('<div class="cancel__box__bottom"></div>'),l=$('<div class="cancel__box__body"></div>'),p=$('<div class="cancel__box__top"><div class="code-window-header cm-s-ambiance"><span>This javaScript code will be re-evaluated any time this dataNode is updated, and the value you <code><span class="cm-keyword">return</span></code> will update the workspace. You can assume this code is wrapped in a function of the form <code><span class="cm-keyword">function</span>(<span class="cm-def">dataNodes</span>)</code> where dataNodes is a collection of javaScript objects (keyed by their name) defining the workspace. <br>Press <code><span class="cm-keyword">ctrl-space</span></code> to activate dataNodes autocompletion, <code><span class="cm-keyword">Tab</span></code> to go deeper into JSON and <code><span class="cm-keyword">Escape</span></code> to leave it.<br>Press <code><span class="cm-keyword">ctrl-K</span></code> to autoformat (beautify) selection. </span><br>To debug this script effectively, insert the keyword <code><span class="cm-keyword">debugger</span></code> at the points where you want to set breakpoints. Then, open the <code><span class="cm-def">DevTools</span></code> during script execution to pause and inspect the code at those breakpoints.</div></div>'),g=$('<div class="cancel__box__container"></div>');l.append([c]),g.append([p,l,s]),r.append([g]);var u=$('<div id="codeWindowContainer" class="cancel__container open"></div>');u.append($('<div class="cancel__overlay"></div>')),u.append(r),$("body").append(u);var h=[],m=checkES6(),w=checkES7(),v=checkES8(),C=checkES9(),f=checkES10(),b=5;function y(){E.operation((function(){for(var e=0;e<h.length;++e)E.removeLineWidget(h[e]);h.length=0;var t="/*jshint esversion:"+b+"*/\n"+E.getValue();JSHINT(t);for(e=0;e<JSHINT.errors.length;++e){var o=JSHINT.errors[e];if(o){var n=document.createElement("div"),i=n.appendChild(document.createElement("span"));i.innerHTML="!!",i.className="lint-error-icon",n.appendChild(document.createTextNode(o.reason)),n.className="lint-error",h.push(E.addLineWidget(o.line-1,n,{coverGutter:!1,noHScroll:!0}))}}JSHINT.errors.length&&E.focus()}));var e=E.getScrollInfo(),t=E.charCoords({line:E.getCursor().line+1,ch:0},"local").top;e.top+e.clientHeight<t&&E.scrollTo(null,t-e.clientHeight+3)}function S(e,t){t.pick(),e.execCommand("autocomplete")}m&&(b=6),w&&(b=7),v&&(b=8),C&&(b=9),f&&(b=10);var N,k=datanodesManager.getAllDataNodes().sort(((e,t)=>e.name().localeCompare(t.name()))),x=CodeMirror(c.get(0),{value:e,mode:{name:"javascript",globalVars:!0},theme:"eclipse",indentUnit:4,lineNumbers:!0,matchBrackets:!0,autoCloseBrackets:!0,lineWrapping:!0,showCursorWhenSelecting:!0,extraKeys:{"Ctrl-Space":"autocomplete","Alt-C":e=>e.toggleComment(),"Ctrl-K":e=>e.autoFormatRange(e.getCursor(!0),e.getCursor(!1))},hintOptions:{hint:JSEditorCompletion.createCompletionFct(k),completeSingle:!1,extraKeys:{Tab:S,Right:S,Left:function(e,t){const o=e.getCursor(),n=o.line,i=e.getLine(n),a=o.ch,d=JSEditorCompletion.getPrecedingPathLength(i,a);d&&(e.replaceRange("",CodeMirror.Pos(n,a-d),CodeMirror.Pos(n,a)),t.close(),e.execCommand("autocomplete"))}}}}),E=x.doc.cm;if(E.on("change",(function(){clearTimeout(N),N=setTimeout(y,500)})),setTimeout(y,100),[bFoundConnection,prop]=datanodesManager.isConnectedWithWidgt(a),bFoundConnection){var T='<div style="display: table-cell; padding: 10px"><span>Connected widget(s): </span></div>';_.each(prop,(e=>{T=T+'<div style="display: table-cell; padding: 10px"><input type="radio" id="'+e+'_radio" name="dataWidgetRadio" value="'+e+'" onchange="datanodesManager.previewWidget(this.value)"><label for="'+e+'_radio">'+e+"</label></div>"}));var j=$('<button id="dialog-widget" class="btn btn-rounded-fill primary" js-reset-toggle="">Show widget</button>').click((function(){if("Show widget"==$("#dialog-widget").text()){$("#code-window-js").width("80%"),$("#dialog-widget").text("Hide widget");var e="";_.each(prop,(t=>{e=e+'<div id="widget-preview-zone-'+t+'" style="background-color:white; border:1px dashed rgba(0, 0, 0, 0.5)" ></div>'}));var t=$('<div id="code-widget-window-js"  style="width: 49%;float: right;z-index:5000;overflow:auto;height:100%"><div id="widgets-selection-header" class="code-window-header cm-s-ambiance" style="position:relative"><div style="display: table-row">'+T+'</div></div><div id="widgets-preview-top" class="code-widget-window-preview"> '+e+"</div></div>");c.append(t),$("#"+prop[0]+"_radio").prop("checked",!0);_.each(prop,(e=>{!function(e){var t=[];$("#widgets-preview-top > div").each(((e,o)=>{t.push(o.id),$("#"+o.id).hide()})),$("#widget-preview-zone-"+e).show();var o=Math.min($("#"+e).height(),$("#code-widget-window-js").height()-40-$("#widgets-selection-header").height()),n=Math.min($("#"+e).width(),$("#code-widget-window-js").width()-40);$("#widget-preview-zone-"+e).width(n),$("#widget-preview-zone-"+e).height(o);var i=e.substring(0,e.length-1),a=widgetsPluginsHandler.copyWidget("widget-preview-zone-"+e,i,null,e,!0);null!=widgetConnector.widgetsConnection[e]&&(widgetConnector.widgetsConnection[e].widgetObjEdit=null,widgetConnector.widgetsConnection[e].widgetObjConnect=a)}(e)}));var o=prop[0];datanodesManager.previewWidget(o),$(".code-mirror-wrapper")[0].childNodes[0].style.float="left",$(".code-mirror-wrapper")[0].childNodes[0].style.width="50%"}else $("#dialog-widget").text("Show widget"),_.each(prop,(e=>{null!=widgetConnector.widgetsConnection[e]&&(widgetConnector.widgetsConnection[e].widgetObjEdit=null,widgetConnector.widgetsConnection[e].widgetObjConnect=null)})),$("#code-widget-window-js").remove(),$("#code-window-js").width("80%"),$(".code-mirror-wrapper")[0].childNodes[0].style.float="unset",$(".code-mirror-wrapper")[0].childNodes[0].style.width="unset"}));s.append(j);var H=$('<button id="apply-widget" class="btn btn-rounded-fill primary" js-reset-toggle="">Apply</button>').click((function(){t.settings[o.name]=x.getValue(),angular.element(document.getElementById("dash-datanode-ctrl")).scope().saveDataNodeSettings(!0)}));s.append(H)}var J=$('<button id="dialog-cancel" class="btn btn-rounded-fill primary" js-reset-toggle="">Close </button>').click((function(){if(i){var e=x.getValue();i(e),"Hide widget"==$("#dialog-widget").text()&&(instanceId=prop[0],null!=widgetConnector.widgetsConnection[instanceId]&&(widgetConnector.widgetsConnection[instanceId].widgetObjEdit=null,widgetConnector.widgetsConnection[instanceId].widgetObjConnect=null))}$("#codeWindowContainer").remove()}));s.append(J)}return{displayJSEditor:function(e,o,n,i,a){t(e,o,n,0,a)},displayMiniJSEditor:function(e,t,o,n){return function(e,t,o,n){o.settings.name;var i="";"JSON_formula_plugin"===o.type?i='// Example: Convert temp from C to F and truncate to 2 decimal places.\n// return (dataNodes["MyDataNode"].sensor.tempInF * 1.8 + 32).toFixed(2);\n':"Python_inline_plugin"===o.type&&(i=""),t||(t=i);var a=$('<div class="codemirror-wrapper__content"></div>');e.append(a);var d=[],r=checkES6(),c=checkES7(),s=checkES8(),l=checkES9(),p=checkES10(),g=5;function u(){C.operation((function(){for(var e=0;e<d.length;++e)C.removeLineWidget(d[e]);d.length=0;var t="/*jshint esversion:"+g+"*/\n"+C.getValue();for(JSHINT(t),e=0;e<JSHINT.errors.length;++e){var o=JSHINT.errors[e];if(o){var n=document.createElement("div"),i=n.appendChild(document.createElement("span"));i.innerHTML="!!",i.className="lint-error-icon",n.appendChild(document.createTextNode(o.reason)),n.className="lint-error",d.push(C.addLineWidget(o.line-1,n,{coverGutter:!1,noHScroll:!0}))}}JSHINT.errors.length&&C.focus()}));var e=C.getScrollInfo(),t=C.charCoords({line:C.getCursor().line+1,ch:0},"local").top;e.top+e.clientHeight<t&&C.scrollTo(null,t-e.clientHeight+3)}function h(e,t){t.pick(),e.execCommand("autocomplete")}r&&(g=6),c&&(g=7),s&&(g=8),l&&(g=9),p&&(g=10);var m,w=datanodesManager.getAllDataNodes().sort(((e,t)=>e.name().localeCompare(t.name()))),v=CodeMirror(a.get(0),{value:t,mode:{name:"javascript",globalVars:!0},theme:"eclipse",indentUnit:4,lineNumbers:!0,matchBrackets:!0,autoCloseBrackets:!0,lineWrapping:!0,showCursorWhenSelecting:!0,extraKeys:{"Ctrl-Space":"autocomplete","Alt-C":e=>e.toggleComment(),"Ctrl-K":e=>e.autoFormatRange(e.getCursor(!0),e.getCursor(!1))},hintOptions:{hint:JSEditorCompletion.createCompletionFct(w),completeSingle:!1,extraKeys:{Tab:h,Right:h,Left:function(e,t){const o=e.getCursor(),n=o.line,i=e.getLine(n),a=o.ch,d=JSEditorCompletion.getPrecedingPathLength(i,a);d&&(e.replaceRange("",CodeMirror.Pos(n,a-d),CodeMirror.Pos(n,a)),t.close(),e.execCommand("autocomplete"))}}}}),C=v.doc.cm;C.on("change",(function(){clearTimeout(m),m=setTimeout(u,500);var e=v.getValue();n(e)})),m=setTimeout(u,500);var f=v.getValue();return setTimeout((function(){v.refresh()}),1),n(f),v}(e,t,o,n)},setAssetRoot:function(t){e(t)}}};
JSEditorCompletion=function(){const t=75;function e(t,e,i){const a=s(e,i,!0);if(a){if(i<a.end)return r(t,a.start,a.end);{const r=f(e,a.end,i);if(r){const e=l(t,a.name);if(e){const t=d(e,r.path);let i=[];return Array.isArray(t)?i=[...t.keys()].map((e=>o(`[${e}]`,t[e]))):"object"!=typeof t&&"function"!=typeof t||null===t||(i=Object.keys(t).map((e=>o(`[${n(e)}]`,t[e])))),{list:i,from:r.completionStart,to:r.completionEnd}}return}}}const u=c(e,i);if(u){const e=t.filter((t=>t.name().startsWith(u.prefix)));return r(e.length>0?e:t,u.start,u.end)}const p=e.substring(0,i),h=/(?<=[^\w]|^)d(?:a(?:t(?:a(?:N(?:o(?:d(?:es?)?)?)?)?)?)?)?$/.exec(p);return h?r(t,h.index,i):r(t,i)}function n(t){return JSON.stringify(t)}function r(t,e,r){return void 0===r&&(r=e),{list:t.map((t=>o(`dataNodes[${n(t.name())}]`,t.latestData()))),from:e,to:r}}function o(e,n){return{text:e,render:function(r,o,s){const c=document.createElement("div"),a=document.createElement("b");if(a.innerText=e,c.appendChild(a),void 0!==n){const e=document.createElement("span");e.innerText=" - ",c.appendChild(e);const r=document.createElement("i");r.innerText=i(n,t),c.appendChild(r)}r.appendChild(c)}}}function i(e,n=t){let r=JSON.stringify(e);if(r.length>n){let t;t=Array.isArray(e)?"...]":"object"!=typeof e&&"function"!=typeof e||null===e?"string"==typeof e||e instanceof String?'..."':"...":"...}",r=r.substr(0,n-t.length)+t}return r}function s(t,e,n=!1){const r=/dataNodes\s*\[\s*(["'])((?:(?=(\\?))\3.)*?)\1\s*\]/g;let o,i;for(;o=r.exec(t);){const t=o[0],n=o.index,r=n+t.length;if(i={name:a(o[2]),start:n,end:r},e>=n&&e<=r)return i}return n&&i&&i.end<=e?i:void 0}function c(t,e){const n=t.substring(0,e),r=/dataNodes\s*\[\s*["']([^"']*)/g;let o;for(;o=r.exec(n);){const t=o[0],n=o.index,r=n+t.length;if(r===e)return{prefix:o[1],start:n,end:r}}}function a(t){if(t){let e="",n=!1;for(let r of t)n?(n=!1,e+="b"===r?"\b":"f"===r?"\f":"n"===r?"\n":"r"===r?"\r":"t"===r?"\t":"v"===r?"\v":r):"\\"===r?n=!0:e+=r;return e}return t}function u(t){const e=/^\s*\[\s*(?:([0-9]+)|(["'])((?:(?=(\\?))\4.)*?)\2)\s*\]/,n=[];let r,o=0;for(;r=e.exec(t);){if(r[1])try{n.push(parseInt(r[1],10))}catch(e){return void console.error(`Invalid number '${r[1]}' in path '${t}'`)}else{if(!r[3])return void console.error(`No matched group in match '${r[0]}' in path '${t}'`);n.push(a(r[3]))}const e=r[0];o+=e.length,t=t.substring(e.length)}return{path:n,length:o}}function f(t,e,n){const r=t.substring(e,n),o=u(r);if(o){const t=o.length,n=e+t,i=r.substr(t);let s;if(s=/^\s*(?:\[\s*(?:["']\s*)?)?$/.exec(i))return{completionStart:n,completionEnd:n+s[0].length,path:o.path}}}function l(t,e){const n=t.find((t=>t.name()===e));return n?n.latestData():void 0}function d(t,e){let n=t;for(let t of e){if(null==n||"string"==typeof n||n instanceof String)return;n=n[t]}return n}return{getPrecedingPathLength:function(t,e){const n=t.substring(0,e);let r;if(r=/^.*(\s*\[\s*(?:[0-9]+|(["'])(?:(?=(\\?))\3.)*?)\2\s*\]\s*)$/.exec(n)){let n=r[1].length;const o="dataNodes";return t.substring(0,e-n).endsWith(o)&&(n+=o.length),n}},createCompletionFct:function(t){return function(n,r){if(!t||0===t.length)return;const o=n.getCursor(),i=o.line,s=n.getLine(i),c=o.ch,a=e(t,s,c);return a&&(a.from=CodeMirror.Pos(i,a.from),a.to=CodeMirror.Pos(i,a.to)),a}},_locateDataNodes:s,_locateDataNodesPrefix:c,_decodePath:u,_locatePath:f,_getDsData:l,_resolvePath:d,_quoteString:n,_valueToText:i,_complete:e}}();
var xdsjson=function(){function a(a,e){var t=$('<div class="datalist"></div>');t.append("<p>"+e+"</p>");var n=$('<ul class="datalist__elems list-unstyled"></ul>');if(!_.isUndefined(a))for(var o=0;o<a.length;o++){var l="";l=_.isFunction(a[o].name)?a[o].name():a[o],_.isUndefined(l)||n.append('<li><label for="data-checkbox-'+o+'"><input type="checkbox" class="check-option1" id="data-checkbox-'+o+'">'+l+"</label></li>")}t.append(n);var d=$('<ul class="datalist__actions list-unstyled"></ul>');return d.append('<li><label for="check-all"><input type="checkbox" class="check-option2" id="check-all">Check all</label></li>'),d.append('<li><label for="uncheck-all"><input type="checkbox" class="check-option2" id="uncheck-all">Uncheck all</label></li>'),t.append(d),t}return{saveJson:function(){!function(e){const t=datanodesManager.getAllDataNodes().sort(((a,e)=>a.name().localeCompare(e.name()))),n=a(t,"Please check data to be saved in the xdsjson file: ");new DialogBoxForData(n,"List of data","Save","Cancel",(function(){const a=t.filter(((a,e)=>$("#data-checkbox-"+e).is(":checked"))).map((a=>a.name()));if(!a.length)return!0;e(a)}))}((a=>{const e=datanodesManager.serialize();e.datanodes=e.datanodes.filter((e=>a.includes(e.name))).sort(((a,e)=>a.name.localeCompare(e.name)));const t={meta:{[XdashDataUpdateEngine.VERSION_METADATA_KEY]:XdashDataUpdateEngine.CURRENT_VERSION,date:Date(),name:"",description:"",groupName:"",tags:[]},data:e};angular.element(document.body).scope().$root.xDashFullVersion?fileManager.saveOnServer("datanode",null,t):fileManager.saveOnLocal(t)}))},clearAllData:function(){swal({title:"Are you sure?",text:"All dataNodes will be deleted and their connections with widgets!",type:"warning",showCancelButton:!0,showConfirmButton:!1,showConfirmButton1:!0,confirmButtonText:"Yes",cancelButtonText:"Abandon",closeOnConfirm:!0,closeOnConfirm1:!0,closeOnCancel:!0},(function(a){if(a){datanodesManager.clear();var e=angular.element(document.body).scope().$root;e.alldatanodes=datanodesManager.getAllDataNodes(),e.filtredNodes=e.alldatanodes.length,e.showOneDatasource=!1,e.updateFlagDirty(!0),e.safeApply()}}))},getDuplicateDataList:function(a,e){var t=document.createElement("div"),n='<p style="margin-bottom:5px;">'+e+"</p>";if(n+='<div style="height:220px;overflow:auto;width:80%; max-width:80%; margin-bottom:15px;border: 1px solid white; background:var(--fill-background-color); color:black;float:left">',!_.isUndefined(a))for(var o=0;o<a.length;o++)_.isUndefined(a[o].name)||(n=(n=(n=n+'<li style="list-style-type: none;padding: 5px 10px;"><input type="checkbox" class="check-option1" id=data-checkbox-'+o+">")+'<input type="text" style="width:70%" class="data-check-input" value="'+a[o].name+'" id="data-check-'+o+'">')+'<input type="radio" class="data-radio" style="margin: 0px 0px 0px 5px;" name="data-radio-'+o+'" id="data-rename-'+o+'">',n=(n+='<span class="data-radio-span">rename</span>')+'<input type="radio" class="data-radio" name="data-radio-'+o+'" checked id="data-overwrite-'+o+'">',n+='<span class="data-radio-span" >overwrite</span>',n+="</li>");return n+="</div>",n+='<div style="width: 16%; float:right">',n+='<div style="list-style-type: none;padding-left: 8px;"><input type="checkbox" class="check-option2"  id="check-all"><span> Check all</span></div>',n+='<div style="list-style-type: none;padding-left: 8px;"><input type="checkbox" class="check-option2"  id="uncheck-all"><span> Uncheck all</span></div>',n+="</div>",t.innerHTML=n,t},getDataList:a,openJsonManager:function(a){let e;try{e=JSON.parse(a)}catch(a){return console.error(a),void swal("Unable to load file","Project loading will be interrupted.","error")}const t=e.meta?e:{meta:{},data:{datanodes:e.datanodes}};if(!xdashUpdateEngine.hasCurrentVersion(t))try{const a=xdashUpdateEngine.update(t,!1);xdashUpdateEngine.displayNotifications(a,!1)}catch(a){return console.error(a),void swal({title:"Import failed",icon:"warning",text:a?.message??"The data could not be updated and may be invalid."})}const n=()=>{const a=angular.element(document.body).scope().$root;a.alldatanodes=datanodesManager.getAllDataNodes(),a.filtredNodes=a.alldatanodes.length,a.safeApply(),a.updateFlagDirty(!0)};0===datanodesManager.getAllDataNodes().length?datanodesManager.load(t.data,!0,n):swal({title:"Loading dataNodes from xdsjson file",text:"Do you want to append the xdsjson file to your existing list or overwrite it?",type:"warning",showCancelButton1:!0,showConfirmButton:!1,showConfirmButton1:!0,confirmButtonText:"Append",cancelButtonText:"Overwrite",closeOnConfirm:!0,closeOnConfirm1:!0,closeOnCancel1:!0},(function(a){const e=!a;datanodesManager.load(t.data,e,n)})),datanodesManager.showLoadingIndicator(!1)}}}();
var panelDash={fullScreenWidth:window.outerWidth};
var geoJsonColors=["#800080","#FF00FF","#000080","#0000FF","#008080","#00FFFF","#FFFF00","#800000"],geoConversion=function(){function e(e,t,r,n){for(var o=[],i={type:"FeatureCollection",features:[]},s=0;s<t.length;s++)o.push([t[s],e[s]]);var u={type:"Feature",geometry:{type:"LineString",coordinates:o},properties:{style:{color:geoJsonColors[n],weight:4,opacity:.9},description:'<span style="color: '+geoJsonColors[n]+'">'+r+"</span>"}};return u&&i.features.push(u),i}return{geoJson2dqTrip:function(e){var t={longitude:[],latitude:[]};for(i=0;i<e.features.length&&"LineString"==e.features[i].geometry.type;i++){var r=e.features[i].geometry.coordinates;for(k=0;k<r.length;k++)curLat=Number(r[k][1]),curLng=Number(r[k][0]),t.latitude.push(curLat),t.longitude.push(curLng)}return t},dqTrip2geoJson:function(t,r,n){var o=t.longitude,i=t.latitude,s=r+"_gpsTrace",u=null;return _.isUndefined(o)||_.isUndefined(i)||(u=e(i,o,s,n)),u},dqTrip2Csv:function(e){for(var t="latitude,longitude\n",r=0;r<e.longitude.length;r++)t=t+e.latitude[r]+","+e.longitude[r]+"\n";return t},hereMm2geoJson:function(t,r,n){if(_.isUndefined(t))return{};if(t=={})return{};if(_.isUndefined(t.RouteLinks))return{};for(var o,i,s=[],u=[],p=0;p<t.RouteLinks.length;p++)for(var a=t.RouteLinks[p].shape.split(" "),l=0;l<a.length;l+=2)o=Number(a[l]),s.push(o),i=Number(a[l+1]),u.push(i);return e(s,u,r+"_here",n)},graphHopper2geoJson:function(e,t,r,n){var o={};if(e.paths){for(var i=0;i<e.paths.length;i++){var s=e.paths[i];if(s.points_encoded){var u=graphhopper.util.decodePath(s.points,undefined);s.points={type:"LineString",coordinates:u}}}o={type:"FeatureCollection",features:[{type:"Feature",geometry:e.paths[0].points,properties:{style:{color:geoJsonColors[n],weight:4,opacity:.9},description:'<span style="color: '+geoJsonColors[n]+'">'+t+"_mapMatch_"+r+"</span>"}}]}}return o}}}();function Point(e,t,r){this.label=e,this.x=360*(r+180),this.y=180*(t+90),this.distance=function(e){var t=e.x-this.x,r=e.y-this.y;return Math.sqrt(t*t+r*r)},this.slope=function(e){var t=e.x-this.x;return(e.y-this.y)/t},this.toString=function(){return this.label}}function Points(e){return this.points=e,upper=function(e){for(var t=e[0],r=1;r<e.length;r++){var n=e[r];(n.y>t.y||n.y==t.y&&n.x<t.x)&&(t=n)}return t}(e),{pointSort:function(e,t){if(e==upper)return-1;if(t==upper)return 1;var r=upper.slope(e),n=upper.slope(t);return r==n?e.distance(upper)<t.distance(upper)?-1:1:r<=0&&n>0?-1:r>0&&n<=0?1:r>n?-1:1}}}
function widgetsPluginsHandlerClass(){var i=[],e=[],n=[],t=[],o=0;function s(i){for(var n in e){var t=_.keys(e[n].pluginDefinition.widgetsDefinitionList);if(_.includes(t,i))return e[n]}}return{loadWidgetPlugin:function(s){var d=s.pluginDefinition;n[o]=d,i[o]=d.name,e[o]=s,_.each(_.keys(d.widgetsDefinitionList),(i=>{t[i]=d.widgetsDefinitionList[i]})),o++},createWidget:function(i,e,n,t){var o=s(e);if(!_.isUndefined(o))return o.createWidget(i,e,n,t);console.log(e+" does not exist. Create widget failed")},copyWidget:function(i,e,n,t,o){var d=s(e);if(!_.isUndefined(d))return d.copyWidget(i,e,n,t,o);console.log(e+" does not exist. Copy widget failed")},widgetToolbarDefinitions:t}}var widgetsPluginsHandler=new widgetsPluginsHandlerClass;
function startIntroGallery(){var e=introJs();e.onbeforechange((function(e){if("my-projects-cards-explorer"===e.id)navHelper.gotoMyProjects()})),e.onafterchange((function(e){console.log("onafterchange:"+e.id),e.id})),e.addSteps([{element:"#my-projects-cards-explorer",intro:"Here you will find all your saved projects",disableInteraction:!0},{element:"#my-personnal-projects-list",intro:"Projects can be managed here",disableInteraction:!0},{element:"#unexisting",intro:"live-demo project will be opened",disableInteraction:!0}])}function startIntroProject(){var e=introJs();e.setOptions({exitOnOverlayClick:!1,showBullets:!1,showStepNumbers:!0,tooltipPosition:"right",steps:[{element:"#dashboard-editor",intro:"This is dashboard edition area"},{element:"#editor-widget-toolbox",intro:"This is the widgets toolbox"},{element:"#widget__groups--wrapper--icons",intro:"Widgets are added to the dashboard edition area from the widgets toolbox"},{element:"#widgetGroups",intro:"Available widgets are arranged according to 5 main groups"},{element:"#kpiCard",intro:"Widgets are placed into the dashboard editor using click or drag and drop"},{element:"#editor-datanodes-list",intro:"This is the dataNodes editor"},{element:"#editor-left-side-panel",intro:"DataNodes are added, configured, listed and controlled here"},{element:"#li_flatUiHorizontalSliderj",intro:"This is widget connection and configuration menu"},{element:"#datanodes-widget-connect",intro:"Widget connection to dataNodes, configuration, placement, z-order, etc. features are provided by this menu"},{element:"#panel--right",intro:"Here, widget and dataNode connection is configured"}]}),e.onbeforechange((async function(e){switch(e.id){case"editor-widget-toolbox":"backward"==this._direction&&document.getElementById("editor-widget-toolbox").click();break;case"widget__groups--wrapper--icons":if("forward"==this._direction){document.getElementById("editor-widget-toolbox").click(),0!==angular.element(document.getElementById("widget__wrap")).scope().displayedWdgtIndex&&document.getElementById("collapse-basic").click()}else"backward"==this._direction&&document.getElementById("collapse-basic").click();break;case"widgetGroups":"forward"==this._direction?document.getElementById("collapse-basic").click():"backward"==this._direction&&document.getElementById("collapse-gauges").click();break;case"kpiCard":"forward"==this._direction?document.getElementById("collapse-gauges").click():"backward"==this._direction&&document.getElementById("editor-widget-toolbox").click();break;case"editor-datanodes-list":"forward"==this._direction&&document.getElementById("editor-datanodes-list").click();break;case"editor-left-side-panel":"backward"==this._direction&&document.getElementById("showHideWidgetMenu").click();break;case"li_flatUiHorizontalSliderj":"forward"==this._direction&&document.getElementById("showHideWidgetMenu").click();break;case"datanodes-widget-connect":"backward"==this._direction&&(document.getElementById("open-datanodes-widget-connect").click(),document.getElementById("editor-datanodes-list").click(),document.getElementById("showHideWidgetMenu").click());break;case"panel--right":"forward"==this._direction&&document.getElementById("open-datanodes-widget-connect").click()}})),e.onafterchange((async function(e){var t=document.querySelectorAll(".introjs-helperLayer")[0],o=document.querySelectorAll(".introjs-tooltipReferenceLayer")[0];setTimeout((()=>{let i=e.getBoundingClientRect();t.style.setProperty("left",parseInt(i.left)-5+"px"),o.style.setProperty("left",parseInt(i.left)-5+"px"),t.style.setProperty("top",parseInt(i.top)-5+"px"),o.style.setProperty("top",parseInt(i.top)-5+"px"),t.style.setProperty("width",parseInt(i.width)+10+"px"),o.style.setProperty("width",parseInt(i.width)+10+"px"),t.style.setProperty("height",parseInt(i.height)+10+"px"),o.style.setProperty("height",parseInt(i.height)+10+"px")}),300)})),e.onchange((function(e){})),e.oncomplete((function(){document.getElementById("open-datanodes-widget-connect").click()})),e.start()}
let bRescaleNeededForModeSwitch=!1,currentDashboardScrollTop=0;function showEditMode(e,o){"widgets"==tabActive?"edit-dashboard"!=modeActive?("play-dashboard"==modeActive&&(currentDashboardScrollTop=$("#DropperDroitec").scrollTop()),$("#dashboard-preview-div").hide(0,(function(){$("#dashboard-editor-div").show(0,(function(){$("#dashboard-editor-div").removeClass("ng-hide"),switchToEditMode(e,o),setIsPlayModeStatus(!1)}))}))):switchToEditMode(e,o):console.log("showEditMode called while tabActive="+tabActive)}function showPlayMode(e){switchToPlayMode(e)}function switchToEditMode(e,o){if(bFirstExec){const e=getMedia();widgetEditor.setLastMedia(e)}e&&widgetEditor.resizeDashboard(),gridMgr.updateGrid(),document.dispatchEvent(tabWidgetsLoadedEvt),bFirstExec&&(bFirstExec=!1,widgetEditor.computeDropperMaxWidth()),modeActive="edit-dashboard",_.isUndefined(o)||o(),$("#DropperDroite").scrollTop(currentDashboardScrollTop)}function switchToPlayMode(){let e={};"edit-dashboard"==modeActive?(widgetEditor.updateSnapshotDashZoneDims(),e=xdash.serialize(),currentDashboardScrollTop=$("#DropperDroite").scrollTop(),widgetPreview.setScalingInformation(null,widgetEditor.getCurrentDashZoneDims().scalingMethod,layoutMgr.getRows(),layoutMgr.getCols()),widgetEditor.unselectAllWidgets(),$("#dashboard-editor-div").hide(0,(function(){$("#dashboard-preview-div").show(0,(function(){$("#dashboard-preview-div").removeClass("ng-hide");try{widgetPreview.loadPlayMode(e)}catch(e){console.log(e)}layoutMgr.makeColsTrasparent(),modeActive="play-dashboard",setIsPlayModeStatus(!0),$("#DropperDroitec").scrollTop(currentDashboardScrollTop),document.dispatchEvent(tabPlayLoadedEvt)}))}))):console.log("bad modeActive : "+modeActive+". Unable to switch to Play mode")}function setIsPlayModeStatus(e){const o=angular.element(document.body).scope().$root;o.bIsPlayMode!=e&&(o.bIsPlayMode=e,o.$apply())}function setEditPlaySwitchDisableStatus(e){const o=angular.element(document.body).scope().$root;o.bDisableEditPlaySwitch!=e&&(o.bDisableEditPlaySwitch=e,o.$apply())}
var offSchedLogUser=!0,ratioScroll=0,models={};modelsHiddenParams={},modelsTempParams={},modelsParameters={},modelsLayout={};try{var tabWidgetsLoadedEvt=new Event("widgets-tab-loaded"),tabPlayLoadedEvt=new Event("play-tab-loaded")}catch(e){}Date.prototype.today=function(){return(this.getDate()<10?"0":"")+this.getDate()+"/"+(this.getMonth()+1<10?"0":"")+(this.getMonth()+1)+"/"+this.getFullYear()},Date.prototype.timeNow=function(){return(this.getHours()<10?"0":"")+this.getHours()+":"+(this.getMinutes()<10?"0":"")+this.getMinutes()+":"+(this.getSeconds()<10?"0":"")+this.getSeconds()+":"+this.getMilliseconds()};var bFirstExec=!0,ua=navigator.userAgent.toLowerCase(),isAndroid=ua.indexOf("android")>-1;function isTouchDevice(){return"ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0}var isTouchDevice=isTouchDevice();function activeTab(){tabActive="widgets",setEditPlaySwitchDisableStatus(!1),"no-dashboard"==modeActive?(bRescaleNeededForModeSwitch=!0,showEditMode(!0,(function(){}))):console.log("tabActive="+tabActive+". modeActive="+modeActive)}function rescaleWidget(e,t){e[t].rescale()}function setDirtyFlagSafe(e){try{if("undefined"!=typeof execOutsideEditor){if(!execOutsideEditor)angular.element(document.body).scope().$root.updateFlagDirty(e)}else angular.element(document.body).scope().$root.updateFlagDirty(e)}catch(e){}}$((function(){$(window).on("resize",(function(){var e=angular.element(document.body).scope().$root;"play"==tabActive?isAndroid||isTouchDevice||widgetPreview.resizeDashboard():e.moduleOpened||"widgets"==tabActive&&("edit-dashboard"==modeActive?(widgetEditor.resizeDashboard(),gridMgr.updateGrid()):"play-dashboard"==modeActive&&widgetPreview.resizeDashboard())})),isAndroid||isTouchDevice||$(window).on("orientationchange",(function(){"play"==tabActive&&widgetPreview.resizeDashboard()}))})),window.mobileAndTabletCheck=function(){let e=!1;var t;return t=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(e=!0),e};
class WidgetPrototypesManager{static SCHEMA_VERSION="http://json-schema.org/draft-07/schema#";static ID_URI_SCHEME="json-schema:";static SCHEMA_ANYTHING={$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:anything"};static SCHEMA_STRING={$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:string",type:"string"};static SCHEMA_NUMBER={$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:number",type:"number"};static SCHEMA_STRING_ARRAY={$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:string_array",type:"array",items:{type:"string"}};static SCHEMA_NUMBER_ARRAY={$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:number_array",type:"array",items:{type:"number"}};static SCHEMA_BOOLEAN_ARRAY={$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:boolean_array",type:"array",items:{type:"boolean"}};static SCHEMA_NUMBER_ARRAY_2D={$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:number_array_2d",type:"array",items:{type:"array",items:{type:"number"}}};static SCHEMA_PRIMITIVE_ARRAY={$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:primitives_array",type:"array",items:{anyOf:[{type:"string"},{type:"number"},{type:"boolean"}]}};static SCHEMA_INTEGER={$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:integer",type:"integer"};static SCHEMA_BOOLEAN={$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:boolean",type:"boolean"};static SCHEMA_ANY_PRIMITIVE={$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:primitives",anyOf:[{type:"string"},{type:"number"},{type:"boolean"}]};static SCHEMA_ANY_OBJECT={$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:object",type:"object"};static SCHEMA_FILE_LIKE={$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:file",type:"object",properties:{content:{type:"string"},name:{type:"string"},type:{type:"string"},charset:{type:"string"},isBinary:{type:"boolean"}},required:["content"]};static SCHEMA_NUMBER_OR_STRING={$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:number_or_string",anyOf:[{type:"string"},{type:"number"}]};constructor(){this.ajv=new ajv7}getOrCompile(t){if(Array.isArray(t)){for(const e of t){const t=e.$id;this.ajv.getSchema(t)||this.ajv.addSchema(e)}return this.ajv.getSchema(t[0].$id)}const e=t.$id,a=this.ajv.getSchema(e);return a||this.ajv.compile(t)}formatErrors(t){const e=this;function a(t){return["anyOf","oneOf","allOf"].includes(t.keyword)}function r(t,e){let a=t.message;return"anyOf"===t.keyword?a="One the the following must be true":"const"===t.keyword&&void 0!==t.params.allowedValue&&(a=`${a} "${t.params.allowedValue}"`),new WidgetActuatorValidationError(t.instancePath?`"${t.instancePath}": ${a}`:a,e)}function s(t,a){return r(t,a=e.formatErrors(a))}let o,i=[];for(t=_.sortBy(t,(t=>t.schemaPath.length));o=t.find(a);){const e=o.schemaPath,a=[],r=[];for(const s of t)s!==o&&(s.schemaPath.startsWith(e)?a.push(s):r.push(s));i.push(s(o,a)),t=r}return i=[...i,...t.map((t=>r(t,[])))],i=i.sort(((t,e)=>t.compareTo(e))),i.filter(((t,e,a)=>0===e||0!==t.compareTo(a[e-1])))}}var widgetPrototypesManager=new WidgetPrototypesManager;
window.addEventListener("click",(e=>{var t=angular.element(document.body);let n=angular.element(document.getElementById("dash-ctrl")).scope();var a=t.scope().$root,l=angular.element(document.getElementById("dashboard-editor")).scope().vm,s=angular.element(document.getElementById("dataListDisplay")).scope(),i=angular.element(document.getElementById("isNavOpen_Project")).scope(),p=angular.element(document.getElementById("isExportOpen_Project")).scope(),d=angular.element(document.getElementById("isShareOpen_Page")).scope(),r=angular.element(document.getElementById("isLogoutOpen")).scope(),o=angular.element(document.getElementById("isLogoutOpen_Project")).scope(),g=angular.element(document.getElementById("isDataSortNavOpen")).scope();if(n.editorView.newDatanodePanel.view&&"widget-overlay"!==e.target.className&&widgetEditor.unselectAllWidgets(),"showHideWidgetMenu"!==e.target.id&&"introjs-button introjs-nextbutton"!==e.target.className&&"introjs-button introjs-prevbutton"!==e.target.className&&"introjs-showElement"!==e.target.className&&l.menuWidgetVisible&&(l.menuWidgetVisible=!1,a.safeApply()),"isExportOpen_Project"!==e.target.id&&(_.isUndefined(p)||!0===p.isExportOpen&&(p.isExportOpen=!1,a.safeApply())),"isShareOpen_Page"!==e.target.id&&(_.isUndefined(d)||!0===d.isShareOpen&&(d.isShareOpen=!1,a.safeApply())),!_.isNull(e.target.parentElement)&&("dataNavDisplay"!==e.target.parentElement.id&&a.displayedNavIndex>=0&&(a.displayedNavIndex=-1,a.safeApply()),"dataListDisplay"!==e.target.parentElement.id&&!0===s.isDataListNavOpen&&(s.isDataListNavOpen=!1,a.safeApply()),"isNavOpen_Project"!==e.target.parentElement.id&&!0===i.isNavOpen&&(i.isNavOpen=!1,a.safeApply()),"isLogoutOpen"!==e.target.id&&"isLogoutOpen"!==e.target.parentElement.id&&(_.isUndefined(r)||!0===r.isNavOpen&&(r.isNavOpen=!1,a.safeApply())),"isLogoutOpen_Project"!==e.target.id&&"isLogoutOpen_Project"!==e.target.parentElement.id&&(_.isUndefined(o)||!0===o.isNavOpen&&(o.isNavOpen=!1,a.safeApply())),"isDataSortNavOpen"!==e.target.parentElement.id&&!0===g.isDataSortNavOpen&&(g.isDataSortNavOpen=!1,a.safeApply()),"tagDisplay"!==e.target.id&&"tagDisplay"!==e.target.parentElement.id&&(_.isUndefined(a.displayedIndex)||a.displayedIndex>=0&&(a.displayedIndex=-1,a.safeApply()),!_.isUndefined(a.displayedIndexG))))for(let e=0;e<a.displayedIndexG.length;e++)a.displayedIndexG[e]>=0&&(a.displayedIndexG[e]=-1,a.displayedIndex=-1,a.safeApply());var m=0;if(angular.element(document.getElementById("my-personnal-projects-list")).scope()){_.isUndefined(angular.element(document.getElementById("my-personnal-projects-list")).scope().allFilesFiltred[0])||(m=angular.element(document.getElementById("my-personnal-projects-list")).scope().allFilesFiltred[0].FileList.length);for(var c=0;c<m;c++){var y=angular.element(document.getElementById("isNavOpen_Recent_All_Gallery"+c)).scope();_.isUndefined(y)||e.target.parentElement.id!=="isNavOpen_Recent_All_Gallery"+c&&!0===y.isNavOpen&&(y.isNavOpen=!1,a.safeApply())}let t=angular.element(document.getElementById("my-personnal-projects-list")).scope().grpFiles;for(const n in t){if("string"==typeof t[n])continue;let l=t[n].length;for(let t=0;t<l;t++){let l=angular.element(document.getElementById("isNavOpen_Group_"+n+t)).scope();_.isUndefined(l)||e.target.parentElement.id!=="isNavOpen_Group_"+n+t&&!0===l.isNavOpen&&(l.isNavOpen=!1,a.safeApply())}}}}));
var workOnViewport=!0;function unitW(t){var e=(t*(100/document.documentElement.clientWidth)).toPrecision(23);return e+="vw"}function unitH(t){var e=(t*(100/document.documentElement.clientHeight)).toPrecision(23);return e+="vh"}function convertVwtoPx(t){return(t=rmUnit(t))/100*document.documentElement.clientWidth}function convertVhtoPx(t){return(t=rmUnit(t))/100*document.documentElement.clientHeight}function convertViewportToPx(t){return{left:convertVwtoPx(t.left),top:convertVhtoPx(t.top),width:convertVwtoPx(t.width),height:convertVhtoPx(t.height),minWidth:t.minWidth,minHeight:t.minHeight}}function inheritWcWidthFromPx(t){return(t-2)*(100/document.documentElement.clientWidth)+"vw"}function inheritWcHeightFromPx(t){return(t-2)*(100/document.documentElement.clientHeight)+"vh"}function inheritWcWidthFromIdInst(t){var e=t;return"play"==tabActive&&(e+="c"),inheritWcWidthFromPx($("#"+e).width)}function inheritWcHeightFromIdInst(t){var e=t;return"play"==tabActive&&(e+="c"),inheritWcHeightFromPx($("#"+e).height)}function getMedia(){return window.matchMedia("(min-width: 768px)").matches?"large":"small"}function isMediaChanged(t){var e=!1;return"small"==t&&window.matchMedia("(min-width: 768px)").matches?(t="large",e=!0):"large"==t&&window.matchMedia("(max-width: 767px)").matches?(t="small",e=!0):e=!1,{bChanged:e,lastMedia:t}}function getFontFactor(){return"play"==tabActive?window.matchMedia("(min-width: 768px)").matches?1:widgetPreview.getCols()||1:"widgets"==tabActive?window.matchMedia("(min-width: 768px)").matches?1:layoutMgr.getCols()||1:1}
function basePlugin(i=void 0){i&&(this.pluginDefinition=i),this.widgetsCount={},Object.keys(this.pluginDefinition.widgetsDefinitionList).forEach((i=>this.widgetsCount[i]=0)),this.createWidget=function(i,t,n,e){this.widgetsCount[t]++;const s=this.pluginDefinition.widgetsDefinitionList[t].factory;return new("function"==typeof s?s:this[s])(i,this.widgetsCount[t],n,e)},this.copyWidget=function(i,t,n,e,s){return this.createWidget(i,t,e,s)},this.clear=function(){Object.keys(this.pluginDefinition.widgetsDefinitionList).forEach((i=>this.widgetsCount[i]=0))}}
function baseWidget(e,o,t,r){this.idDivContainer=e,this.idWidget=o,this.idInstance=t,this.bIsInteractive=r,this.getColorValueFromCSSProperty=function(e){let o=e;if(o.includes("var(--")){const t=e.substring(4,e.length-1);o=window.getComputedStyle(document.documentElement).getPropertyValue(t)}return o},this.setColorValueFromModelParameters=function(e,o){let r=o;_.isUndefined(modelsParameters[t][e])?modelsParameters[t][e]=o:r=modelsParameters[t][e];return this.getColorValueFromCSSProperty(r)},this.labelFontSize=function(){return"font-size: calc(7px + "+modelsParameters[t].labelFontSize*getFontFactor()+"vw + 0.4vh); "},this.valueFontSize=function(){return"font-size: calc(7px + "+modelsParameters[t].valueFontSize*getFontFactor()+"vw + 0.4vh); "},this.valueFormat=function(e){const o=parseInt(modelsParameters[t].decimalDigits,10);if(isNaN(o))return e;let r=e;if(-1!=o&&!isNaN(e)){if(r=parseFloat(e),isNaN(r))return e;r=Math.round10(r,-o)}return r},this.fontSize=function(){return"font-size: calc(7px + "+modelsParameters[t].fontsize*getFontFactor()+"vw + 0.4vh); "},this.labelColor=function(){return"color:"+this.setColorValueFromModelParameters("labelColor","var(--widget-label-color)")+"; "},this.valueColor=function(){return"color:"+this.setColorValueFromModelParameters("valueColor","var(--widget-color)")+"; "},this.labelFontFamily=function(){_.isUndefined(modelsParameters[t].labelFontFamily)&&(modelsParameters[t].labelFontFamily="Helvetica Neue");return"font-family: "+modelsParameters[t].labelFontFamily+", Helvetica, Arial, sans-serif; "},this.valueFontFamily=function(){_.isUndefined(modelsParameters[t].valueFontFamily)&&(modelsParameters[t].valueFontFamily="Helvetica Neue");return"font-family: "+modelsParameters[t].valueFontFamily+", Helvetica, Arial, sans-serif; "},this.border=function(){let e="border: none; ";if(modelsParameters[t].displayBorder){const o=this.setColorValueFromModelParameters("borderColor","var(--widget-border-color)");e="border: "+this.setColorValueFromModelParameters("borderWidth","2px")+" solid "+o+"; "}else e+=NaN,e+="-moz-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0);",e+="box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0);";return e},this.captionHelper=function(e,o,r){o?modelsParameters[t].label=e:r?modelsParameters[t].inheritLabelFromData=!1:modelsParameters[t].label=e},this.backgroundColor=function(){return"background-color:"+this.setColorValueFromModelParameters("backgroundColor","#ffffff")+"; "},this.getTransformedText=function(e){let o=modelsParameters[t][e]||"";if(o){if(!($("<div>").html(o).children().length>0)){o=(new DOMParser).parseFromString("<!doctype html><body>"+o,"text/html").body.textContent}}return o},this.buttonFontFamily=function(){_.isUndefined(modelsParameters[t].buttonFontFamily)&&(modelsParameters[t].buttonFontFamily="Helvetica Neue");return"font-family: "+modelsParameters[t].buttonFontFamily+", Helvetica, Arial, sans-serif; "},this.setButtonColorStyle=function(){const e=this.setColorValueFromModelParameters("buttonDefaultColor","var(--widget-button-color)"),o=this.setColorValueFromModelParameters("buttonHoverColor","var(--widget-button-hover-color)"),l=this.setColorValueFromModelParameters("buttonActiveColor","var(--widget-button-active-color)"),a=this.setColorValueFromModelParameters("buttonTextColor","var(--widget-button-text)"),s="styleNormalFor"+t+"widgetCustomColor";let n=document.getElementById(s);const i="."+t+"widgetCustomColor{ color: "+a+";background-color: "+e+";border-color: "+e+"; }";if(null==n?(n=document.createElement("style"),n.type="text/css",n.id=s,n.innerHTML=i,document.getElementsByTagName("head")[0].appendChild(n)):n.innerHTML=i,r){const e="styleHoverFor"+t+"widgetCustomColor";let r=document.getElementById(e);const a="."+t+"widgetCustomColor:hover{ background-color: "+o+";border-color: "+o+";}";null==r?(r=document.createElement("style"),r.type="text/css",r.id=e,r.innerHTML=a,document.getElementsByTagName("head")[0].appendChild(r)):r.innerHTML=a;const s="styleActiveFor"+t+"widgetCustomColor";let n=document.getElementById(s);const i="."+t+"widgetCustomColor:active{ background-color: "+l+";border-color: "+l+";}";null==n?(n=document.createElement("style"),n.type="text/css",n.id=s,n.innerHTML=i,document.getElementsByTagName("head")[0].appendChild(n)):n.innerHTML=i}},this.displayIcon=function(){return _.isUndefined(modelsParameters[t].displayIcon)&&(modelsParameters[t].displayIcon=!1),modelsParameters[t].displayIcon},this.fontAwesomeIcon=function(){return _.isUndefined(modelsParameters[t].fontAwesomeIcon)&&(modelsParameters[t].fontAwesomeIcon=""),modelsParameters[t].fontAwesomeIcon},this.validationButtonDefaultColor=function(){return"background-color:"+this.setColorValueFromModelParameters("validationBtnDefaultColor","var(--widget-button-primary-color)")+"; "},this.validationButtonHoverColor=function(){return"background-color:"+this.setColorValueFromModelParameters("validationBtnHoverColor","var(--widget-button-hover-color)")+"; "},this.validationButtonActiveColor=function(){return"background-color:"+this.setColorValueFromModelParameters("validationBtnActiveColor","var(--widget-button-active-color)")+"; "},this.validationButtonBorderColor=function(){let e="border: none; ";if(modelsParameters[t].displayBorder){e="border: 2px solid "+this.setColorValueFromModelParameters("validationBtnDefaultColor","var(--widget-border-color)")+"; "}else e+="-webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0);",e+="-moz-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0);",e+="box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0);";return e},this.graphColor=function(){return this.setColorValueFromModelParameters("graphColor","var(--widget-label-color)")},this.subLabelFontFamily=function(){_.isUndefined(modelsParameters[t].subLabelFontFamily)&&(modelsParameters[t].subLabelFontFamily="Helvetica Neue");return"font-family: "+modelsParameters[t].subLabelFontFamily+", Helvetica, Arial, sans-serif; "},this.subLabelColor=function(){return"color:"+this.setColorValueFromModelParameters("subLabelColor","var(--widget-subtext-color)")+"; "},this.subLabelFontSize=function(){return"font-size: calc(7px + "+modelsParameters[t].subLabelFontSize*getFontFactor()+"vw + 0.4vh); "},this.checkedColor=function(){_.isUndefined(modelsParameters[t].checkboxColor)||delete modelsParameters[t].checkboxColor;return"color: "+this.setColorValueFromModelParameters("checkedColor","var(--widget-input-checked-color)")+"; "},this.uncheckedColor=function(){return"color: "+this.setColorValueFromModelParameters("uncheckedColor","var(--widget-input-unchecked-color)")+"; "},this.switchOnColor=function(){return"background-color: "+this.setColorValueFromModelParameters("switchOnColor","var(--widget-input-checked-color)")+"; "},this.switchOffColor=function(){return"background-color: "+this.setColorValueFromModelParameters("switchOffColor","var(--widget-input-unchecked-color)")+"; "},this.switchShadowColor=function(){return"box-shadow: 0 0 1px "+this.setColorValueFromModelParameters("switchOnColor","var(--widget-input-checked-color)")+"; "},this.progressBarRangeColor=function(){return"background-color: "+this.setColorValueFromModelParameters("progressBarRangeColor","var(--widget-range-color)")+"; "},this.progressBarSegmentColor=function(){return"background-color: "+this.setColorValueFromModelParameters("progressBarSegmentColor","var(--widget-segment-color)")+"; "},this.sliderRangeColor=function(){return"background-color: "+this.setColorValueFromModelParameters("sliderRangeColor","var(--widget-range-color)")+"; "},this.sliderSegmentColor=function(){return"background-color: "+this.setColorValueFromModelParameters("sliderSegmentColor","var(--widget-segment-color)")+"; "},this.sliderHandleDefaultColor=function(){return"background-color: "+this.setColorValueFromModelParameters("sliderHandleDefaultColor","var(--widget-handle-default-color)")+"; "},this.sliderHandleHoverColor=function(){return"background-color: "+this.setColorValueFromModelParameters("sliderHandleHoverColor","var(--widget-handle-hover-color)")+"; "},this.sliderHandleActiveColor=function(){return"background-color: "+this.setColorValueFromModelParameters("sliderHandleActiveColor","var(--widget-handle-active-color)")+"; "},this.valueBorderColor=function(){return"border-color: "+this.setColorValueFromModelParameters("valueBorderColor","var(--widget-border-color)")+"; "},this.textSize=function(){return"font-size: calc(7px + "+modelsParameters[t].textSize*getFontFactor()+"vw + 0.4vh); "},this.textColor=function(){return"color: "+this.setColorValueFromModelParameters("textColor","var(--widget-color)")+"; "},this.subTextColor=function(){return"color: "+this.setColorValueFromModelParameters("subTextColor","var(--widget-color)")+"; "},this.browseButtonTextColor=function(){const e=this.setColorValueFromModelParameters("browseButtonTextColor","var(--widget-button-text)");let o=" color: "+e+"; ";return o+=" border-color: "+e+"; ",o},this.browseButtonDefaultColor=function(){return" background-color: "+this.setColorValueFromModelParameters("browseButtonDefaultColor","var(--widget-button-color)")+"; "},this.browseButtonHoverColor=function(){return" background-color: "+this.setColorValueFromModelParameters("browseButtonHoverColor","var(--widget-button-hover-color)")+"; "},this.browseButtonActiveColor=function(){return" background-color: "+this.setColorValueFromModelParameters("browseButtonActiveColor","var(--widget-button-active-color)")+"; "},this.deleteButtonDefaultColor=function(){const e=this.setColorValueFromModelParameters("deleteButtonDefaultColor","var(--widget-delete-button-default-color)");let o=" background-color: "+e+"; ";return o+=" box-shadow: 0 0 2px 3px "+e+"; ",o},this.deleteButtonActiveColor=function(){const e=this.setColorValueFromModelParameters("deleteButtonActiveColor","var(--widget-delete-button-active-color)");let o=" background-color: "+e+"; ";return o+=" box-shadow: 0 0 2px 3px "+e+"; ",o},this.deleteButtonHoverColor=function(){const e=this.setColorValueFromModelParameters("deleteButtonHoverColor","var(--widget-delete-button-hover-color)");let o=" background-color: "+e+"; ";return o+=" box-shadow: 0 0 2px 3px "+e+"; ",o},this.listBackgroundColor=function(){return" background-color: "+this.setColorValueFromModelParameters("listBackgroundColor","var(--widget-select-drop-color)")+"; "},this.selectValueColor=function(){return" color: "+this.setColorValueFromModelParameters("selectValueColor","var(--widget-select-option-highlighted-text)")+"; "},this.selectValueBackgroundColor=function(){return" background-color: "+this.setColorValueFromModelParameters("selectValueBackgroundColor","var(--widget-select-option-highlighted-color)")+"; "},this.valueDefaultColor=function(){return" color: "+this.setColorValueFromModelParameters("valueDefaultColor","var(--widget-label-color)")+"; "},this.valueFocusColor=function(){return" color: "+this.setColorValueFromModelParameters("valueFocusColor","var(--widget-multiselect-checked-text)")+"; "},this.valueHoverColor=function(){return" color: "+this.setColorValueFromModelParameters("valueHoverColor","var(--widget-multiselect-hover-text)")+"; "},this.checkboxDefaultColor=function(){return" background-color: "+this.setColorValueFromModelParameters("checkboxDefaultColor","var(--widget-multiselect-color)")+"; "},this.checkboxFocusColor=function(){return" background-color: "+this.setColorValueFromModelParameters("checkboxFocusColor","var(--widget-multiselect-checked-color)")+"; "},this.checkboxHoverColor=function(){return" background-color: "+this.setColorValueFromModelParameters("checkboxHoverColor","var(--widget-multiselect-hover-color)")+"; "},this.checkboxHoverBorderColor=function(){return" border-color: "+this.setColorValueFromModelParameters("checkboxHoverBorderColor","var(--widget-multiselect-hover-border-color)")+"; "},this.checkboxFocusBorderColor=function(){return" border-color: "+this.setColorValueFromModelParameters("checkboxFocusBorderColor","var(--widget-multiselect-checked-border-color)")+"; "},this.checkboxWidth=function(){_.isUndefined(modelsParameters[t].checkboxWidth)&&(modelsParameters[t].checkboxWidth=7);return" width: "+modelsParameters[t].checkboxWidth+"rem; "},this.checkboxHeight=function(){_.isUndefined(modelsParameters[t].checkboxHeight)&&(modelsParameters[t].checkboxHeight=1.5);return" line-height: "+modelsParameters[t].checkboxHeight+"; "},this.checkboxBorder=function(){let e="border: none; ";if(modelsParameters[t].displayBorder){e=" border: 1.5px solid "+this.setColorValueFromModelParameters("checkboxBorderColor","var(--widget-multiselect-border-color)")+"; "}else e+="-webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0);",e+="-moz-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0);",e+="box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0);";return e},this.selectFontSize=function(){_.isUndefined(modelsParameters[t].selectValueFontSize)&&(modelsParameters[t].selectValueFontSize=modelsParameters[t].labelFontSize);return"font-size: calc(7px + "+modelsParameters[t].selectValueFontSize*getFontFactor()+"vw + 0.4vh); "},this.selectValueFontFamily=function(){_.isUndefined(modelsParameters[t].selectValueFontFamily)&&(modelsParameters[t].selectValueFontFamily="Helvetica Neue");return"font-family: "+modelsParameters[t].selectValueFontFamily+", Helvetica, Arial, sans-serif; "},this.selectedValueColor=function(){return" color: "+this.setColorValueFromModelParameters("selectedValueColor","var(--widget-select-option-highlighted-text)")+"; "},this.selectedItemDefaultColor=function(){return" background-color: "+this.setColorValueFromModelParameters("selectedItemDefaultColor","var(--widget-select-option-highlighted-color)")+"; "},this.selectedItemHoverColor=function(){return" background-color: "+this.setColorValueFromModelParameters("selectedItemHoverColor","var(--widget-select-option-highlighted-color)")+"; "},this.valueAlign=function(){_.isUndefined(modelsParameters[t].ValueAlign)||delete modelsParameters[t].ValueAlign,_.isUndefined(modelsParameters[t].valueAlign)&&(modelsParameters[t].valueAlign="left");return" text-align: "+modelsParameters[t].valueAlign+"; "},this.tableBackgroundColor=function(e){_.isUndefined(modelsParameters[t].backgroundColor)&&(modelsParameters[t].backgroundColor={primary:"var(--widget-color-0)",secondary:"var(--widget-table-striped-odd)"});return" background-color: "+this.getColorValueFromCSSProperty(modelsParameters[t].backgroundColor[e])+"; "},this.undefinedValueColor=function(){return this.setColorValueFromModelParameters("UndefinedValueColor","var(--widget-calendar-d3-undefined-value)")},this.plotTextColor=function(){return this.setColorValueFromModelParameters("textColor","var(--widget-color)")},this.thicknessBackgroundColor=function(){return' background-color="'+this.setColorValueFromModelParameters("thicknessBackgroundColor","var(--widget-segment-color)")+'" '},this.thicknessColor=function(){return' foreground-color="'+this.setColorValueFromModelParameters("thicknessColor","var(--widget-range-color)")+'" '},this.tipBackgroundColor=function(){return this.setColorValueFromModelParameters("tipBackgroundColor","var(--widget-button-color)")},this.tipBorderColor=function(){return this.setColorValueFromModelParameters("tipBorderColor","var(--widget-button-text)")},this.onColor=function(){return this.setColorValueFromModelParameters("onColor","var(--widget-led-light-on)")},this.offColor=function(){return this.setColorValueFromModelParameters("offColor","var(--widget-led-light-off)")}}baseWidget.prototype.getActuatorDescriptions=function(e=null){return[]},baseWidget.prototype.getByName=function(e){if(this.hasOwnProperty(e))return this[e]},baseWidget.prototype.getInteractive=function(){return this.bIsInteractive},baseWidget.prototype.setInteractive=function(e){e!=this.bIsInteractive&&(this.bIsInteractive=e,this.render())},baseWidget.prototype.rescale=function(){},baseWidget.prototype.render=function(){};class WidgetActuator{setValue(e){}getValue(){}addValueChangedHandler(e){}removeValueChangedHandler(e){}setCaption(e,o){}clearCaption(){}}class WidgetActuatorBase extends WidgetActuator{static NOOP_CALLBACK=function(e,o,t=void 0){};constructor(e){super(),this.widget=e}updateCallback=WidgetActuatorBase.NOOP_CALLBACK;addValueChangedHandler(e){this.updateDataFromWidget=e}removeValueChangedHandler(e){this.updateDataFromWidget=WidgetActuatorBase.NOOP_CALLBACK}}class WidgetActuatorDescription{static TRIGGER=0;static READ=1;static WRITE=2;static READ_WRITE=WidgetActuatorDescription.READ|WidgetActuatorDescription.WRITE;constructor(e,o,t,r=null,l=null){this._name=e,this._summary=o,this._readwrite=t,this._schema=r,this._validator=l}get name(){return this._name}get summary(){return this._summary}get direction(){return this._readwrite}get jsonSchema(){return this._schema}get validator(){return this._validator}}class WidgetActuatorValidationError{constructor(e,o=void 0){this._msg=e,this._nested=o||[]}get msg(){return this._msg}get nested(){return this._nested}toString(){return this._print().join("\n")}_print(e=""){return[e+"- "+this._msg,...this._nested.flatMap((o=>o._print(e+"   ")))]}compareTo(e){const o=this.msg.localeCompare(e.msg);if(0!==o)return o;const t=this.nested.length,r=t-e.nested.length;if(0!==r)return r;for(let o=0;o<t;o++){const t=this.nested[o].compareTo(e.nested[o]);if(0!==t)return t}return 0}}
function scoringWidgetsPluginClass(){var e=this,r=0;this.scoringFullCircularGauge=function(i,a,t,n){return r++,new e.scoringCircularGaugeWidget(i,r,t,n,"full")},this.scoringSemiCircularGauge=function(i,a,t,n){return r++,new e.scoringCircularGaugeWidget(i,r,t,n,"semi")},this.scoringArchCircularGauge=function(i,a,t,n){return r++,new e.scoringCircularGaugeWidget(i,r,t,n,"arch")},this.clear=function(){r=0},this.scoringCircularGaugeWidget=function(e,r,i,a,t){this.constructor(e,r,i,a,t);var n=this;this.enable=function(){},this.disable=function(){},this.rescale=function(){this.render()},this.render=function(){var a=document.createElement("div");a.setAttribute("style","text-align: center; height: inherit; width: inherit; cursor: inherit"),a.setAttribute("id","div-for-ng-gauge"+r),$("#"+e).html(a);var o=Math.min($("#div-for-ng-gauge"+r).width(),$("#div-for-ng-gauge"+r).height()),l="gaugeValues.val"+r,u=angular.element('<ng-gauge id="ng-gauge'+r+'" style="'+this.valueColor()+'" size="'+o+'" type="'+t+'" thick="'+modelsParameters[i].thick+'" min="'+modelsParameters[i].min+'" max="'+modelsParameters[i].max+'" value="'+l+'"" cap="round" label="'+modelsParameters[i].label+'" duration="'+modelsParameters[i].duration+'"'+this.thicknessColor()+this.thicknessBackgroundColor()+'" append="'+modelsParameters[i].unit+'"></ng-gauge>'),g=document.getElementById("div-for-ng-gauge"+r);angular.element(g).append(u),angular.element(document.body).injector().invoke(["$compile","$rootScope",function(e,a){var t=angular.element(u).scope();a.gaugeValues||(a.gaugeValues={}),a.gaugeValues["val"+r]=modelsHiddenParams[i].value,e(u)(t)}]),this.bIsInteractive?n.enable():n.disable()};const o=new WidgetActuatorDescription("value","Numeric value",WidgetActuatorDescription.READ,WidgetPrototypesManager.SCHEMA_NUMBER);this.getActuatorDescriptions=function(){return[o]},this.value={updateCallback:function(){},setValue:function(e){modelsHiddenParams[i].value=e,angular.element(document.body).injector().invoke(["$compile","$rootScope",function(i,a){a.gaugeValues["val"+r]=e,a.safeApply()}])},getValue:function(){return $("#ng-gauge"+r)[0].value},addValueChangedHandler:function(e){this.updateCallback=e,n.enable()},removeValueChangedHandler:function(e){n.disable()},setCaption:function(e,r){modelsParameters[i].inheritLabelFromData&&n.captionHelper(e,n.bIsInteractive,r)},clearCaption:function(){modelsParameters[i].inheritLabelFromData&&(modelsParameters[i].label=""),n.render()}},n.render()},this.scoringCircularGaugeWidget.prototype=baseWidget.prototype,this.pluginDefinition={name:"scoring",widgetsDefinitionList:{scoringFullCircularGauge:{factory:"scoringFullCircularGauge",title:"Full-circular gauge",icn:"full-circular-gauge",help:"wdg/wdg-scoring-gauge/"},scoringSemiCircularGauge:{factory:"scoringSemiCircularGauge",title:"Semi-circular gauge",icn:"semi-circular-gauge",help:"wdg/wdg-scoring-gauge/"},scoringArchCircularGauge:{factory:"scoringArchCircularGauge",title:"Arch-circular gauge",icn:"widgets icn-arch-circular-gauge",help:"wdg/wdg-scoring-gauge/"}}},this.constructor()}modelsHiddenParams.scoringFullCircularGauge={value:75},modelsHiddenParams.scoringSemiCircularGauge={value:75},modelsHiddenParams.scoringArchCircularGauge={value:75},modelsParameters.scoringFullCircularGauge={label:"",inheritLabelFromData:!0,min:0,max:100,unit:"",valueColor:"var(--widget-color)",thick:10,thicknessColor:"var(--widget-range-color)",duration:1500,thicknessBackgroundColor:"var(--widget-segment-color)"},modelsParameters.scoringSemiCircularGauge={label:"",inheritLabelFromData:!0,min:0,max:100,unit:"",valueColor:"var(--widget-color)",thick:10,thicknessColor:"var(--widget-range-color)",duration:1500,thicknessBackgroundColor:"var(--widget-segment-color)"},modelsParameters.scoringArchCircularGauge={label:"",inheritLabelFromData:!0,min:0,max:100,unit:"",valueColor:"var(--widget-color)",thick:10,thicknessColor:"var(--widget-range-color)",duration:1500,thicknessBackgroundColor:"var(--widget-segment-color)"},modelsLayout.scoringFullCircularGauge={height:"15vh",width:"11vw"},modelsLayout.scoringSemiCircularGauge={height:"15vh",width:"11vw"},modelsLayout.scoringArchCircularGauge={height:"15vh",width:"11vw"},scoringWidgetsPluginClass.prototype=basePlugin.prototype;var scoringWidgetsPlugin=new scoringWidgetsPluginClass;widgetsPluginsHandler.loadWidgetPlugin(scoringWidgetsPlugin);
function annotationMarkdownWidgetsPluginClass(){this.markdownAnnotationWidget=function(t,n,e,i){this.constructor(t,n,e,i);var a=this;_.isUndefined(modelsParameters[e].textAlign)&&(modelsHiddenParams[e].textAlign="left"),this.enable=function(){},this.disable=function(){},this.rescale=function(){this.render()},_.isUndefined(modelsParameters[e].centerVertically)&&(modelsParameters[e].centerVertically=!0),this.hasScrollBar=function(t){return t.get(0).scrollHeight>t.get(0).clientHeight},this.render=function(){var i=document.createElement("div"),o="",r='<div id="annotationMarkdownDiv'+n+'" class="defaultCSS" style="overflow: auto; background-color: transparent; box-shadow: none; width: inherit; height: inherit; color:'+modelsParameters[e].textColor+"; text-align: "+modelsParameters[e].textAlign+"; padding: 4px; resize: inherit; border-radius: 6px; "+this.fontSize()+this.valueFontFamily()+this.border()+'"><div style="'+o+'">'+marked.parse(modelsHiddenParams[e].text||"")+"</div></div>";i.innerHTML=r,i.setAttribute("style","width: inherit; height: inherit; background-color:"+modelsParameters[e].backgroundColor),$("#"+t).html(i);var d=a.hasScrollBar($("#annotationMarkdownDiv"+n));modelsParameters[e].centerVertically&&!d&&(o=" position: relative; top: 50%; -webkit-transform: translateY(-50%); -ms-transform: translateY(-50%); transform: translateY(-50%);",$("#annotationMarkdownDiv"+n+" div").attr("style",o))};const o=new WidgetActuatorDescription("text","Markdown content",WidgetActuatorDescription.READ,WidgetPrototypesManager.SCHEMA_STRING);this.getActuatorDescriptions=function(){return[o]},this.text={setValue:function(t){modelsHiddenParams[e].text=t,a.render()},getValue:function(){return modelsHiddenParams[e].text},addValueChangedHandler:function(t){a.enable()},removeValueChangedHandler:function(t){a.disable()}},a.render()},this.markdownAnnotationWidget.prototype=baseWidget.prototype,this.pluginDefinition={name:"annotation",widgetsDefinitionList:{annotationMarkdown:{factory:"markdownAnnotationWidget",title:"Markdown",icn:"markdown",help:"wdg/wdg-annotation-video/#markdown"}}},this.constructor()}modelsHiddenParams.annotationMarkdown={text:""},modelsParameters.annotationMarkdown={fontsize:.3,backgroundColor:"rgba(0, 0, 0, 0)",textColor:"var(--widget-color)",valueFontFamily:"var(--widget-font-family)",textAlign:"left",displayBorder:!1,centerVertically:!0},modelsLayout.annotationMarkdown={height:"30vh",width:"30vw",minWidth:"50px",minHeight:"32px"},annotationMarkdownWidgetsPluginClass.prototype=basePlugin.prototype;var annotationMarkdownWidgetsPlugin=new annotationMarkdownWidgetsPluginClass;widgetsPluginsHandler.loadWidgetPlugin(annotationMarkdownWidgetsPlugin);
function genericHtmlWidgetPluginClass(){this.genericHtmlWidget=function(t,e,i,n){this.constructor(t,e,i,n);var r=this;_.isUndefined(modelsParameters[i].textAlign)&&(modelsHiddenParams[i].textAlign="left"),this.enable=function(){},this.disable=function(){},this.rescale=function(){this.render()},_.isUndefined(modelsParameters[i].centerVertically)&&(modelsParameters[i].centerVertically=!0),this.hasScrollBar=function(t){return t.get(0).scrollHeight>t.get(0).clientHeight},this.render=function(){var n=document.createElement("div"),l="",a='<div id="htmlDiv'+e+'" class="defaultCSS" style="overflow: auto; background-color: transparent; box-shadow: none; width: inherit; height: inherit; color:'+modelsParameters[i].textColor+"; text-align: "+modelsParameters[i].textAlign+"; padding: 4px; resize: inherit; border-radius: 6px; "+this.fontSize()+this.valueFontFamily()+this.border()+'"><div style="'+l+'">'+modelsHiddenParams[i].html+"</div></div>";n.innerHTML=a,n.setAttribute("style","width: inherit; height: inherit; background-color:"+modelsParameters[i].backgroundColor),$("#"+t).html(n);var o=r.hasScrollBar($("#htmlDiv"+e));modelsParameters[i].centerVertically&&!o&&(l=" position: relative; top: 50%; -webkit-transform: translateY(-50%); -ms-transform: translateY(-50%); transform: translateY(-50%);",$("#htmlDiv"+e+" div").attr("style",l))};const l=new WidgetActuatorDescription("html","Html content",WidgetActuatorDescription.READ,WidgetPrototypesManager.SCHEMA_STRING);this.getActuatorDescriptions=function(){return[l]},this.html={setValue:function(t){modelsHiddenParams[i].html=t,r.render()},getValue:function(){return modelsHiddenParams[i].html},addValueChangedHandler:function(t){r.enable()},removeValueChangedHandler:function(t){r.disable()}},r.render()},this.genericHtmlWidget.prototype=baseWidget.prototype,this.pluginDefinition={name:"annotation",widgetsDefinitionList:{annotationHtml:{factory:"genericHtmlWidget",title:"Generic HTML",icn:"generic-html",help:"wdg/wdg-annotation-video/#generic-html"}}},this.constructor()}modelsHiddenParams.annotationHtml={html:""},modelsParameters.annotationHtml={fontsize:.3,backgroundColor:"rgba(0, 0, 0, 0)",textColor:"var(--widget-color)",valueFontFamily:"var(--widget-font-family)",textAlign:"left",displayBorder:!1,centerVertically:!0},modelsLayout.annotationHtml={height:"30vh",width:"30vw",minWidth:"50px",minHeight:"32px"},genericHtmlWidgetPluginClass.prototype=basePlugin.prototype;var genericHtmlWidgetPlugin=new genericHtmlWidgetPluginClass;widgetsPluginsHandler.loadWidgetPlugin(genericHtmlWidgetPlugin);
modelsHiddenParams.anyDisplay={content:""},modelsParameters.anyDisplay={fontsize:.3,backgroundColor:"rgba(0, 0, 0, 0)",textColor:"var(--widget-color)",valueFontFamily:"Helvetica Neue",textAlign:"left",displayBorder:!1,centerVertically:!0},modelsLayout.anyDisplay={height:"30vh",width:"30vw",minWidth:"50px",minHeight:"32px"},function(){class e extends WidgetActuatorBase{setValue(e){modelsHiddenParams[this.widget.idInstance].content=e,this.widget.render()}}class t extends baseWidget{static _CONTENT_DESCRIPTOR=new WidgetActuatorDescription("content","Any content to display",WidgetActuatorDescription.READ,WidgetPrototypesManager.SCHEMA_ANYTHING);constructor(t,n,i,s){super(t,n,i,s),this.content=new e(this),this.render()}#e(e){return e.scrollHeight>e.clientHeight}#t(e,t){const n=t instanceof HTMLImageElement||t instanceof HTMLIFrameElement||t instanceof HTMLVideoElement||t instanceof HTMLAudioElement,i=document.createElement("div");i.id=`htmlDiv${this.idWidget}`,i.class="defaultCSS",i.style=`${this.fontSize()} ${this.valueFontFamily()} ${this.border()}`,i.style.overflow=n?"none":"auto",i.style.width="inherit",i.style.height="inherit",i.style.padding="4px",i.style.resize="inherit",i.style.color=this.plotTextColor(),i.style["background-color"]="transparent",i.style["box-shadow"]="none",i.style["text-align"]=modelsParameters[this.idInstance].textAlign,i.style["border-radius"]="6px";const s=document.createElement("div");n&&(s.style.width="100%",s.style.height="100%");const a=document.createElement("div");if(a.style.width="inherit",a.style.height="inherit",a.style["background-color"]=modelsParameters[this.idInstance].backgroundColor,i.append(s),s.append(t),a.append(i),e.replaceChildren(a),modelsParameters[this.idInstance].centerVertically&&!this.#e(i)){const e="translateY(-50%)";s.style.position="relative",s.style.top="50%",s.style.transform=e,s.style["-webkit-transform"]=e,s.style["-ms-transform"]=e}}rescale(){this.render()}render(){const e=modelsHiddenParams[this.idInstance].content,t=document.getElementById(this.idDivContainer),n=jsonDataToBasicHtmlElement(e);this.#t(t,n)}getActuatorDescriptions(){return[t._CONTENT_DESCRIPTOR]}}const n={name:"any widget",widgetsDefinitionList:{anyDisplay:{factory:t,title:"'any' widget",icn:"generic-html",help:"wdg/wdg-basics/#any-widget"}}};widgetsPluginsHandler.loadWidgetPlugin(new basePlugin(n))}();
function kpiWidgetsPluginClass(){this.kpiCardWidget=function(e,t,a,i){this.constructor(e,t,a,i);var l=this,r="";this.enable=function(){},this.disable=function(){},this.rescale=function(){this.render()},this.render=function(){var i=document.createElement("div");modelsParameters[a].borderShadow?i.setAttribute("class","card-kpi-container card-shadow"):i.setAttribute("class","card-kpi-container ");var n='<div class="card-kpi">';n+='<div class="card-body">',n+='<div class="row align-items-center">';var s="";if(modelsParameters[a].displayLabel){const e=this.getTransformedText("label");s=(s+='<h5 class="card-mt-0 text-truncate"')+' style="text-align:center;'+this.labelFontSize()+this.labelColor()+this.labelFontFamily()+'">'+e,s+="</h5>"}var o="";o=(o=o+'<div id="card-value-'+t+'" class="card-value" style="text-align:center;')+this.valueFontSize()+this.valueColor()+this.valueFontFamily()+'"></div>',n="top"==modelsParameters[a].valuePosition?o+s:s+o,n+="</div>",n+="</div>",n+="</div>",i.innerHTML=n,$("#"+e).html(i),$("#card-value-"+t)[0].innerText=l.valueFormat(modelsHiddenParams[a].value),r='<span id ="unit-span'+t+'" style="text-align: left; color: '+modelsParameters[a].unitColor+"; font-size: calc(7px + "+modelsParameters[a].unitFontSize*getFontFactor()+'vw + 0.4vh);">'+modelsParameters[a].unit+"</span>",""!=modelsParameters[a].unit&&modelsParameters[a].displayUnit&&$("#card-value-"+t).append(r),this.bIsInteractive?l.enable():l.disable()};const n=new WidgetActuatorDescription("value","Current value",WidgetActuatorDescription.READ,WidgetPrototypesManager.SCHEMA_ANY_PRIMITIVE);this.getActuatorDescriptions=function(){return[n]},this.value={updateCallback:function(){},setValue:function(e){modelsHiddenParams[a].value=e,$("#card-value-"+t)[0].innerText=l.valueFormat(modelsHiddenParams[a].value),""!=modelsParameters[a].unit&&modelsParameters[a].displayUnit&&$("#card-value-"+t).append(r)},getValue:function(){return modelsHiddenParams[a].value},addValueChangedHandler:function(e){this.updateCallback=e,l.enable()},removeValueChangedHandler:function(e){l.disable()},setCaption:function(e,t){modelsParameters[a].inheritLabelFromData&&(l.captionHelper(e,l.bIsInteractive,t),l.render())},clearCaption:function(){modelsParameters[a].inheritLabelFromData&&(modelsParameters[a].label=""),l.render()}},l.render()},this.kpiCardWidget.prototype=baseWidget.prototype,this.pluginDefinition={name:"kpiCard",widgetsDefinitionList:{kpiCard:{factory:"kpiCardWidget",title:"KPI value",icn:"kpi"}}},this.constructor()}modelsHiddenParams.kpiCard={value:"--"},modelsParameters.kpiCard={label:"labelText",inheritLabelFromData:!0,displayLabel:!0,labelFontSize:.5,labelColor:"var(--widget-label-color)",labelFontFamily:"var(--widget-font-family)",valuePosition:"bottom",valueFontSize:2,valueColor:"var(--widget-color)",valueFontFamily:"var(--widget-font-family)",decimalDigits:3,unit:"unitText",displayUnit:!1,unitFontSize:.5,unitColor:"var(--widget-label-color)",borderShadow:!1},modelsLayout.kpiCard={height:"16vh",width:"18vw",minWidth:"64px",minHeight:"32px"},kpiWidgetsPluginClass.prototype=basePlugin.prototype;var kpiWidgetsPlugin=new kpiWidgetsPluginClass;widgetsPluginsHandler.loadWidgetPlugin(kpiWidgetsPlugin);
function advancedKpiWidgetsPluginClass(){this.advancedKpiCardWidget=function(a,e,t,i){this.constructor(a,e,t,i);var s=this;this.enable=function(){},this.disable=function(){},this.rescale=function(){this.render()},this.initEcharts=function(a){modelsTempParams[t].echartsInstance=echarts.init(document.getElementById(a))},this.getEchartsData=function(){let a=Date.now()+1e3;return{name:a.toString(),value:[a,modelsHiddenParams[t].value]}},this.pushEchartsListData=function(a){modelsTempParams[t].echartsListData.push(a)},this.shiftEchartsListData=function(){modelsTempParams[t].echartsListData.shift()},this.getEchartsListData=function(){return modelsTempParams[t].echartsListData},this.getEchartsOptions=function(){return{xAxis:{type:"time",boundaryGap:!1,axisLabel:!1,axisLine:!1,splitLine:{show:!1}},yAxis:{type:"value",boundaryGap:["",""],axisLabel:!1,axisLine:!1,splitLine:{show:!1}},visualMap:{type:"continuous",show:!1,realtime:!0,inRange:{color:s.graphColor()}},grid:{left:0,top:0,right:0,bottom:0},series:[{type:"line",smooth:.25,showSymbol:!1,areaStyle:{color:new echarts.graphic.LinearGradient(0,0,0,1,[{offset:0,color:s.graphColor()},{offset:1,color:"#ffffff"}])},data:modelsTempParams[t].echartsListData}],animationDuration:0,animationDurationUpdate:1e3,animationEasing:"linear",animationEasingUpdate:"linear"}},this.initEchartsOptions=function(){let a=this.getEchartsOptions();try{modelsTempParams[t].echartsInstance.setOption(a)}catch(a){console.log(a)}},this.setEchartsOptions=function(a){modelsTempParams[t].echartsInstance.setOption({series:[{data:a}]})},this.updateEcharts=function(a){if(i)_.isUndefined(modelsTempParams[t].windowValue)&&(modelsTempParams[t].windowValue=modelsHiddenParams[t].window),this.initEcharts(a),this.initEchartsOptions(),-1==modelsHiddenParams[t].window?(this.pushEchartsListData(this.getEchartsData()),this.setEchartsOptions(this.getEchartsListData())):modelsHiddenParams[t].window>=0&&(0==modelsTempParams[t].windowValue&&this.shiftEchartsListData(),this.pushEchartsListData(this.getEchartsData()),this.setEchartsOptions(this.getEchartsListData()),0!=modelsTempParams[t].windowValue&&--modelsTempParams[t].windowValue),s.enable();else{this.initEcharts(a),this.initEchartsOptions();var e=modelsTempParams[t].echartsInstance.getDataURL();modelsTempParams[t].echartsInstance.dispose(),$("#"+a).html('<img src="'+e+'"/>'),s.disable()}},this.render=function(){var n=document.createElement("div");modelsParameters[t].borderShadow?n.setAttribute("class","card-kpi-container card-shadow"):n.setAttribute("class","card-kpi-container");var r='<div class="card-kpi">';r=(r+='<div class="card-body">')+'<div id="items-'+e+'" class="row align-items-center">';var d="";d=(d=d+'<h5 id="advanced-card-label-'+e+'" class="card-mt-0 text-truncate"')+' style="text-align:center; margin-bottom: 4rem;'+this.labelFontSize()+this.labelColor()+this.labelFontFamily()+'"></h5>';var o="";o=(o=o+'<div id="advanced-card-value-'+e+'" class="card-value" style="text-align:center; margin-bottom: 1.7rem;')+this.valueFontSize()+this.valueColor()+this.valueFontFamily()+'"></div>';var l="";l=(l=l+'<div id="advanced-card-sub-label-'+e+'" class="card-value" style="text-align:center; margin-bottom: 2rem; ')+this.subLabelFontSize()+this.subLabelColor()+this.subLabelFontFamily()+'"></div>';var c="",m="echarts"+e;if(i&&(m+="c"),c=c+'<div id="'+m+'" style="text-align:left; height: 11.9vh; width: 100%; background-color: transparent"></div>',r="top"==modelsParameters[t].valuePosition?o+l+d+c:d+o+l+c,r+="</div>",r+="</div>",r+="</div>",n.innerHTML=r,$("#"+a).html(n),modelsParameters[t].displayLabel){const a=this.getTransformedText("label");$("#advanced-card-label-"+e)[0].innerHTML=a}else $("#advanced-card-label-"+e).hide();$("#advanced-card-value-"+e)[0].innerText=s.valueFormat(modelsHiddenParams[t].value),$("#advanced-card-sub-label-"+e)[0].innerText=s.valueFormat(modelsHiddenParams[t].subLabel),this.updateEcharts(m)};const n={$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:advancedKpiCardWidget",type:"object",properties:{value:{type:["string","number","boolean"]},subLabel:{type:["string","number","boolean"]}},required:["value","subLabel"]},r=new WidgetActuatorDescription("extendedValue","Current value and sub-label",WidgetActuatorDescription.READ,n);this.getActuatorDescriptions=function(){return[r]},this.extendedValue={updateCallback:function(){},setValue:function(a){modelsHiddenParams[t]=a},getValue:function(){return modelsHiddenParams[t]},addValueChangedHandler:function(a){this.updateCallback=a,s.enable()},removeValueChangedHandler:function(a){s.disable()},setCaption:function(a,e){modelsParameters[t].inheritLabelFromData&&(s.captionHelper(a,s.bIsInteractive,e),s.render())},clearCaption:function(){modelsParameters[t].inheritLabelFromData&&(modelsParameters[t].label=""),s.render()}},s.render()},this.advancedKpiCardWidget.prototype=baseWidget.prototype,this.pluginDefinition={name:"advancedKpiCard",widgetsDefinitionList:{advancedKpiCard:{factory:"advancedKpiCardWidget",title:"Advanced KPI value",icn:"kpi-advanced"}}},this.constructor()}modelsHiddenParams.advancedKpiCard={value:"--",subLabel:"--"},modelsParameters.advancedKpiCard={label:"labelText",inheritLabelFromData:!0,displayLabel:!0,labelFontSize:.5,labelColor:"var(--widget-label-color)",labelFontFamily:"var(--widget-font-family)",valuePosition:"bottom",valueFontSize:3,valueColor:"var(--widget-color)",valueFontFamily:"var(--widget-font-family)",decimalDigits:3,subLabelFontSize:.5,subLabelColor:"var(--widget-subtext-color)",subLabelFontFamily:"var(--widget-font-family)",borderShadow:!1,graphColor:"var(--widget-label-color)"},modelsTempParams.advancedKpiCard={echartsInstance:"",echartsListData:[]},modelsLayout.advancedKpiCard={height:"33vh",width:"14vw",minWidth:"64px",minHeight:"32px"},advancedKpiWidgetsPluginClass.prototype=basePlugin.prototype;var advancedKpiWidgetsPlugin=new advancedKpiWidgetsPluginClass;widgetsPluginsHandler.loadWidgetPlugin(advancedKpiWidgetsPlugin);
function doubleSliderWidgetsPluginClass(){this.doubleSliderFlatUiWidget=function(e,a,l,i){this.constructor(e,a,l,i);var n=this;this.enable=function(){},this.disable=function(){},this.getCleanedOptions=function(e){return{floor:e.minRange,ceil:e.maxRange,step:e.step,precision:e.precision,enforceStep:e.enforceStep,disableAnimation:e.disableAnimation,onEnd:e.onEnd}},this.updateMinValue=function(){n.bIsInteractive&&(n.minValue.updateCallback(n.minValue,n.minValue.getValue()),modelsHiddenParams[l].minValue=n.minValue.getValue())},this.updateMaxValue=function(){n.bIsInteractive&&(n.maxValue.updateCallback(n.maxValue,n.maxValue.getValue()),modelsHiddenParams[l].maxValue=n.maxValue.getValue())},this.rescale=function(){this.render()},this.render=function(){var i=document.createElement("div");i.setAttribute("style","display: table; height: inherit; width: inherit; cursor: inherit"),i.setAttribute("id","div-for-ng-slider"+a),$("#"+e).html(i);Math.min($("#div-for-ng-slider"+a).width(),$("#div-for-ng-slider"+a).height());var t="sliderValues.values_"+l,o="30%",r="labelText",d='<div><rzslider id="ng-slider'+a+'" ng-click="changeValue()" rz-slider-model="'+t+'.minValue"  rz-slider-high="'+t+'.maxValue"  rz-slider-options="getModel('+("sliderValues.params_"+l)+')" ></rzslider></div>',s="",u="calc(7px + 0.5vw + 0.4vh)";1==modelsParameters[l].displayLabel&&(_.isUndefined(modelsParameters[l].label)||(r=this.getTransformedText("label")),_.isUndefined(modelsParameters[l].labelWidthProportion)||(o=modelsParameters[l].labelWidthProportion),_.isUndefined(modelsParameters[l].labelFontSize)||(u=this.labelFontSize()),s='<span class="label-h-slider" id="h-slider-span" style="heigh: auto; width:'+o+"; "+u+this.labelColor()+this.labelFontFamily()+';">'+r+"</span>");var m=angular.element(s+'<div style="display: table-cell; vertical-align: middle; padding-bottom: 18px;"> '+d+"</div>");modelsParameters[l].onEnd=function(e,a,l,i){"max"==i&&n.updateMaxValue(),"min"==i&&n.updateMinValue()};var c=document.getElementById("div-for-ng-slider"+a);angular.element(c).append(m),angular.element(document.body).injector().invoke(["$compile","$rootScope",function(e,a){var i=angular.element(m).scope();a.sliderValues||(a.sliderValues={}),a.sliderValues["values_"+l]={minValue:modelsHiddenParams[l].minValue,maxValue:modelsHiddenParams[l].maxValue},a.getModel=function(e){var a=angular.copy(e);return n.bIsInteractive?(_.isUndefined(a.minRange)||(a.floor=a.minRange),_.isUndefined(a.maxRange)||(a.ceil=a.maxRange)):(a.ceil=a.maxRange,a.floor=a.minRange,a.readOnly=!0),a},a.changeValue=function(){},a.sliderValues["params_"+l]=n.getCleanedOptions(modelsParameters[l]),e(m)(i)}]),document.styleSheets[0].addRule("#ng-slider"+a+" > .rz-bar-wrapper > .rz-bar",this.sliderSegmentColor()),document.styleSheets[0].addRule("#ng-slider"+a+" > .rz-bar-wrapper > .rz-selection",this.sliderRangeColor()),document.styleSheets[0].addRule("#ng-slider"+a+" > .rz-pointer",this.sliderHandleDefaultColor()),document.styleSheets[0].addRule("#ng-slider"+a+" > .rz-pointer:hover",this.sliderHandleHoverColor()),document.styleSheets[0].addRule("#ng-slider"+a+" > .rz-pointer:active",this.sliderHandleActiveColor())};const t=new WidgetActuatorDescription("minValue","Selected minimum value",WidgetActuatorDescription.READ_WRITE,WidgetPrototypesManager.SCHEMA_NUMBER),o=new WidgetActuatorDescription("maxValue","Selected maximum value",WidgetActuatorDescription.READ_WRITE,WidgetPrototypesManager.SCHEMA_NUMBER),r=new WidgetActuatorDescription("minRange","Minimum allowed value",WidgetActuatorDescription.READ,WidgetPrototypesManager.SCHEMA_NUMBER),d=new WidgetActuatorDescription("maxRange","Maximum allowed value",WidgetActuatorDescription.READ,WidgetPrototypesManager.SCHEMA_NUMBER);this.getActuatorDescriptions=function(e=void 0){const a=e||modelsParameters[l],i=[t,o];return a&&a.rangeActuator&&(i.push(r),i.push(d)),i},this.minValue={updateCallback:function(){},setValue:function(e){var a=Number(e);modelsHiddenParams[l].minValue=a,angular.element(document.body).injector().invoke(["$compile","$rootScope",function(e,i){i.sliderValues["values_"+l].minValue=a,i.safeApply()}])},getValue:function(){var e=0;return angular.element(document.body).injector().invoke(["$compile","$rootScope",function(a,i){e=i.sliderValues["values_"+l].minValue}]),e},addValueChangedHandler:function(e){this.updateCallback=e,n.enable()},removeValueChangedHandler:function(e){n.disable()},setCaption:function(e,a){},clearCaption:function(){}},this.maxValue={updateCallback:function(){},setValue:function(e){var a=Number(e);modelsHiddenParams[l].maxValue=a,angular.element(document.body).injector().invoke(["$compile","$rootScope",function(e,i){i.sliderValues["values_"+l].maxValue=a,i.safeApply()}])},getValue:function(){var e;return angular.element(document.body).injector().invoke(["$compile","$rootScope",function(a,i){e=i.sliderValues["values_"+l].maxValue}]),e},addValueChangedHandler:function(e){this.updateCallback=e,n.enable()},removeValueChangedHandler:function(e){n.disable()},setCaption:function(e,a){},clearCaption:function(){}},n.maxRange={updateCallback:function(){},setValue:function(e){var a=Number(e);modelsParameters[l].maxRange=a,angular.element(document.body).injector().invoke(["$compile","$rootScope",function(e,a){a.sliderValues["params_"+l]=n.getCleanedOptions(modelsParameters[l]),a.safeApply()}]),modelsParameters[l].forceValuesToMinAndMax&&(n.maxValue.setValue(modelsParameters[l].maxRange),n.updateMaxValue())},getValue:function(){var e;return angular.element(document.body).injector().invoke(["$compile","$rootScope",function(a,i){e=modelsParameters[l].maxRange}]),e},addValueChangedHandler:function(e){this.updateCallback=e,n.enable()},removeValueChangedHandler:function(e){n.disable()}},n.minRange={updateCallback:function(){},setValue:function(e){var a=Number(e);modelsParameters[l].minRange=a,angular.element(document.body).injector().invoke(["$compile","$rootScope",function(e,a){a.sliderValues["params_"+l]=n.getCleanedOptions(modelsParameters[l]),a.safeApply()}]),modelsParameters[l].forceValuesToMinAndMax&&(n.minValue.setValue(modelsParameters[l].minRange),n.updateMinValue())},getValue:function(){var e;return angular.element(document.body).injector().invoke(["$compile","$rootScope",function(a,i){e=modelsParameters[l].minRange}]),e},addValueChangedHandler:function(e){this.updateCallback=e,n.enable()},removeValueChangedHandler:function(e){n.disable()}},n.render()},this.doubleSliderFlatUiWidget.prototype=baseWidget.prototype,this.pluginDefinition={name:"flatUiDoubleSlider",widgetsDefinitionList:{flatUiDoubleSlider:{factory:"doubleSliderFlatUiWidget",title:"Double slider",icn:"double-slider",help:"wdg/wdg-basics/#double-slider"}}},this.constructor()}modelsHiddenParams.flatUiDoubleSlider={minValue:25,maxValue:75},modelsParameters.flatUiDoubleSlider={label:"labelText",displayLabel:!0,labelFontSize:.5,labelColor:"var(--widget-label-color)",labelWidthProportion:"30%",minRange:0,maxRange:100,step:.1,precision:2,enforceStep:!1,disableAnimation:!1,rangeActuator:!1,forceValuesToMinAndMax:!1,sliderSegmentColor:"var(--widget-segment-color)",sliderRangeColor:"var(--widget-range-color)",sliderHandleDefaultColor:"var(--widget-handle-default-color)",sliderHandleHoverColor:"var(--widget-handle-hover-color)",sliderHandleActiveColor:"var(--widget-handle-active-color)"},modelsLayout.flatUiDoubleSlider={height:"8vh",width:"24vw",minWidth:"200px",minHeight:"24px"},doubleSliderWidgetsPluginClass.prototype=basePlugin.prototype;var doubleSliderWidgetsPlugin=new doubleSliderWidgetsPluginClass;widgetsPluginsHandler.loadWidgetPlugin(doubleSliderWidgetsPlugin);
function datePickerWidgetsPluginClass(){var e=this;this.datePickerWidget=function(e,t,a,i,l){this.constructor(e,t,a,i);var r=this;this.dateFieldShow=function(){var e=$("#ng-datepicker"+t);e.hasClass("daterangepicker-hide")&&e.removeClass("daterangepicker-hide")},this.dateFieldHide=function(){var e=$("#ng-datepicker"+t);e.hasClass("daterangepicker-hide")||e.addClass("daterangepicker-hide")},this.enable=function(){$("#"+a+"c").on("click",(function(e,t){widgetPreview.elevateZIndex(a,e),r.dateFieldShow()}))},this.disable=function(){r.dateFieldHide()},this.updateValue=function(e){r.dateValue.updateCallback(r.dateValue,r.dateValue.getValue()),r.dateFieldHide()},this.getShortDate=function(e){var t=String(e.getDate()).padStart(2,"0"),a=String(e.getMonth()+1).padStart(2,"0"),i=e.getFullYear();return e=i+"-"+a+"-"+t},this.rescale=function(){this.render()},this.render=function(){var i=document.createElement("div"),l=!1,d=" ",n="display: table;";modelsHiddenParams[a].visibility&&(l=!0,d="display: none; ",n=""),i.setAttribute("style",n+"text-align: left; height: inherit; width: inherit; cursor: inherit"),i.setAttribute("id","div-for-ng-datepicker"+t),$("#"+e).html(i);var o=$("#div-for-ng-datepicker"+t).height(),s="datepickerValues.val"+a,c="100%",p="labelText",u=($("#div-for-ng-datepicker"+t).width(),""),h="calc(7px + 0.5vw + 0.4vh)",g="calc(7px + 0.5vw + 0.4vh)";if(1==modelsParameters[a].displayLabel&&(_.isUndefined(modelsParameters[a].label)||(p=this.getTransformedText("label")),_.isUndefined(modelsParameters[a].labelWidthProportion)||(c=modelsParameters[a].labelWidthProportion,(100-parseInt(c))*$("#div-for-ng-datepicker"+t).width()/100),_.isUndefined(modelsParameters[a].labelFontSize)||(h=this.labelFontSize()),_.isUndefined(modelsParameters[a].valueFontSize)||(g="calc(7px + "+modelsParameters[a].valueFontSize*getFontFactor()+"vw + 0.4vh)"),u='<span class="value-span" id="date-label-span'+t+'" style="width:'+c+"; "+h+this.labelColor()+this.labelFontFamily()+'">'+p+"</span>",l)){var m=80*$("#div-for-ng-datepicker"+t).width()/100,v=20*$("#div-for-ng-datepicker"+t).height()/100;u='<span class="value-span" id="date-label-span'+t+'" style="width:'+m+"px;height:"+v+"px;text-align: center;padding-bottom: 0px; "+h+this.labelColor()+this.labelFontFamily()+'">'+p+"</span>"}var b="disabled",f="cursor: inherit; ";if(this.bIsInteractive){b="";f="cursor: pointer; "}var k=this.border(),P='<datepicker id="ng-datepicker'+t+'" date-format="yyyy-MM-dd" datepicker-show="'+l+'" selector="form-control"><div style="cursor: inherit"><input  id="'+("calender-input"+t)+'" class="value-input form-control " style="'+f+" height: "+o+"px; border-radius: 6px; "+d+k+"float: right; font-size: "+g+";"+this.valueColor()+this.valueFontFamily()+this.backgroundColor()+"padding-right: "+g.replace("(","(3*(").replace(")","))")+";text-align: "+modelsParameters[a].valueTextAlign+'; " ng-model="'+s+'.currentDate" '+b+' placeholder="Choose a date"/><span class="form-control-feedback" style="cursor: inherit; display: table;margin-top:0; top:0; padding-right: '+g+"; height: "+o+'px;"><i class="fa fa-lg fa-calendar" style="display: table-cell; vertical-align: middle; font-size:'+g+'"></i></span></div></datepicker>',y=u+'<div style="cursor: inherit; height: 100%"> '+P+"</div> ";if(l){var w="height: 100%; width: 100%";modelsParameters[a].displayLabel&&(w="height: 80%; width: 80%"),y='<div style="'+w+'"> '+P+"</div> "+u}var F=angular.element(y),S=document.getElementById("div-for-ng-datepicker"+t);angular.element(S).append(F),angular.element(document.body).injector().invoke(["$compile","$rootScope",function(e,t){var i=angular.element(F).scope();if(t.datepickerValues||(t.datepickerValues={}),t.datepickerValues["val"+a]||(t.datepickerValues["val"+a]={currentDate:r.getShortDate(new Date)}),modelsHiddenParams[a]){if(!modelsHiddenParams[a].value){var l=new Date;modelsHiddenParams[a].value=r.getShortDate(l)}t.datepickerValues["val"+a]={currentDate:modelsHiddenParams[a].value}}t.$watch("datepickerValues.val"+a,(function(){r.updateValue()}),!0),e(F)(i)}]),r.dateFieldHide(),this.bIsInteractive?r.enable():r.disable()};const d=new WidgetActuatorDescription("dateValue","Selected date as YYYY-MM-DD",WidgetActuatorDescription.READ_WRITE,{$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:datePickerWidgetSemi",type:"string",pattern:"^\\d\\d\\d\\d-[0-1]\\d-[0-3]\\d$"});this.getActuatorDescriptions=function(){return[d]},this.dateValue={updateCallback:function(){},setValue:function(e){var t=Date.parse(e);_.isNaN(t)||(modelsHiddenParams[a].value=r.getShortDate(new Date(t)),angular.element(document.body).injector().invoke(["$compile","$rootScope",function(e,t){t.datepickerValues["val"+a]&&(t.datepickerValues["val"+a].currentDate=modelsHiddenParams[a].value,t.safeApply())}]))},getValue:function(){var e=null;return angular.element(document.body).injector().invoke(["$compile","$rootScope",function(t,i){i.datepickerValues["val"+a]&&(e=i.datepickerValues["val"+a].currentDate,modelsHiddenParams[a].value=e)}]),e},addValueChangedHandler:function(e){this.updateCallback=e},removeValueChangedHandler:function(e){},setCaption:function(e,i){modelsParameters[a].inheritLabelFromData&&(r.captionHelper(e,r.bIsInteractive,i),$("#date-label-span"+t).text(modelsParameters[a].label))},clearCaption:function(){modelsParameters[a].inheritLabelFromData&&(modelsParameters[a].label=""),r.render()}},r.render()},this.datePickerWidgetSemi=function(t,a,i,l){return new e.datePickerWidget(t,a,i,l,"semi")},this.datePickerWidgetFull=function(t,a,i,l){return new e.datePickerWidget(t,a,i,l,"full")},this.datePickerWidget.prototype=baseWidget.prototype,this.pluginDefinition={name:"datepicker",widgetsDefinitionList:{datepickerSimple:{factory:"datePickerWidgetSemi",title:"Simple calender",icn:"calendar",help:"wdg/wdg-geo-time/#simple-calendar"}}},this.constructor()}modelsHiddenParams.datepickerSimple={value:"",visibility:!1},modelsHiddenParams.datepickerVisible={value:"",visibility:!0},modelsParameters.datepickerSimple={label:"labelText",inheritLabelFromData:!0,displayLabel:!0,labelFontSize:.5,labelColor:"var(--widget-label-color)",labelWidthProportion:"30%",valueFontSize:.5,valueColor:"var(--widget-color)",valueFontFamily:"var(--widget-font-family)",valueTextAlign:"left",displayBorder:!0,borderColor:"var(--widget-border-color)",backgroundColor:"var(--widget-input-color)"},modelsParameters.datepickerVisible={label:"labelText",inheritLabelFromData:!1,displayLabel:!0,labelFontSize:.5,labelColor:"var(--widget-label-color)",labelFontFamily:"var(--widget-font-family)",valueFontSize:.5,valueColor:"var(--widget-color)",valueFontFamily:"var(--widget-font-family)"},modelsLayout.datepickerSimple={height:"5vh",width:"19vw",minWidth:"150px",minHeight:"32px"},modelsLayout.datepickerVisible={height:"45vh",width:"22vw",minWidth:"150px",minHeight:"190px"},datePickerWidgetsPluginClass.prototype=basePlugin.prototype;var datePickerWidgetsPlugin=new datePickerWidgetsPluginClass;widgetsPluginsHandler.loadWidgetPlugin(datePickerWidgetsPlugin);
function dateRangePickerWidgetsPluginClass(){this.dateRangePickerWidget=function(e,a,t,i){this.constructor(e,a,t,i);const r=this;this.formatDateValue="",this.updateDateValue=function(e){this.bIsInteractive&&(r.endDateValue.updateCallback(r.endDateValue,r.endDateValue.getValue()),modelsHiddenParams[t].endDateValue=r.endDateValue.getValue(),r.startDateValue.updateCallback(r.startDateValue,r.startDateValue.getValue()),modelsHiddenParams[t].startDateValue=r.startDateValue.getValue())},this.rescale=function(){this.render()},this.render=function(){const i=document.createElement("div");i.setAttribute("style","display: table;text-align: left; height: inherit; width: inherit; cursor: inherit"),i.setAttribute("id","div-for-daterangepicker"+a),$("#"+e).html(i);let d="0%",n="labelText",l=$("#div-for-daterangepicker"+a).width(),s="",o="calc(7px + 0.5vw + 0.4vh)",u="calc(7px + 0.5vw + 0.4vh)";_.isUndefined(modelsParameters[t].inheritLabelFromData)||delete modelsParameters[t].inheritLabelFromData,1==modelsParameters[t].displayLabel&&(_.isUndefined(modelsParameters[t].label)||(n=this.getTransformedText("label")),_.isUndefined(modelsParameters[t].labelWidthProportion)||(d=modelsParameters[t].labelWidthProportion,l=(100-parseInt(d))*$("#div-for-daterangepicker"+a).width()/100),_.isUndefined(modelsParameters[t].labelFontSize)||(o=this.labelFontSize()),_.isUndefined(modelsParameters[t].valueFontSize)||(u="calc(7px + "+modelsParameters[t].valueFontSize*getFontFactor()+"vw + 0.4vh)"),s='<span class="value-span" id="date-label-span'+a+'" style="width:'+d+"; "+o+this.labelColor()+this.labelFontFamily()+';">'+n+"</span>");let c="disabled",m="cursor: inherit; ";this.bIsInteractive&&(c="",m="cursor: pointer; ");const g=this.border(),p=$("#div-for-daterangepicker"+a).height(),h=s+'<div style="height:100% width: '+l+'px;">'+('<div id="daterangepicker'+a+'" ><input type="text" autocomplete="off" '+c+' placeholder="Choose a date range" id="daterangepickerInput'+a+'" style="'+m+" height: "+p+"px; border-radius: 6px; "+g+"float: right;padding-right: "+u.replace("(","(3*(").replace(")","))")+";text-align: "+modelsParameters[t].valueTextAlign+"; font-size: "+u+"; "+this.valueColor()+this.valueFontFamily()+this.backgroundColor()+'" class="value-input form-control ng-pristine ng-untouched ng-valid ng-empty" /><span class="form-control-feedback" style="'+m+"height: "+p+"px; display:table; margin-top: 0; top:0; padding-right: "+u+'"><i class="fa fa-lg fa-calendar" style="display: table-cell; vertical-align: middle;'+m+"font-size: "+u+';" ></i></span></div>')+"</div>";i.innerHTML=h,modelsParameters[t].displayTimePicker?r.formatDateValue=modelsParameters[t].displayTimePicker24Hour?"YYYY-MM-DD hh:mm":"YYYY-MM-DD hh:mm A":r.formatDateValue="YYYY-MM-DD";let D="",P="";D=""!==modelsHiddenParams[t].startDateValue?modelsHiddenParams[t].startDateValue:moment().startOf("hour"),P=""!==modelsHiddenParams[t].endDateValue?modelsHiddenParams[t].endDateValue:moment().startOf("hour").add(32,"hour"),$('input[id="daterangepickerInput'+a+'"]').daterangepicker({opens:"right",singleDatePicker:!1,showDropdowns:!0,autoUpdateInput:!0,timePicker:modelsParameters[t].displayTimePicker,timePicker24Hour:modelsParameters[t].displayTimePicker24Hour,startDate:D,endDate:P,locale:{format:r.formatDateValue}}),$('input[id="daterangepickerInput'+a+'"]').on("apply.daterangepicker",(function(e,a){modelsHiddenParams[t].startDateValue=a.startDate.format(r.formatDateValue),modelsHiddenParams[t].endDateValue=a.endDate.format(r.formatDateValue),r.updateDateValue()}))};const d={$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:dateRangeWidget_date",type:"string",pattern:"^\\d\\d\\d\\d-[0-1]\\d-[0-3]\\d$"},n=new WidgetActuatorDescription("startDateValue","Selected start date as YYYY-MM-DD",WidgetActuatorDescription.READ_WRITE,d),l=new WidgetActuatorDescription("endDateValue","Selected end date as YYYY-MM-DD",WidgetActuatorDescription.READ_WRITE,d);this.getActuatorDescriptions=function(){return[n,l]},this.startDateValue={updateCallback:function(){},setValue:function(e){moment(e,r.formatDateValue,!0).isValid()&&(modelsHiddenParams[t].startDateValue=e,$('input[id="daterangepickerInput'+a+'"]').data("daterangepicker").setStartDate(modelsHiddenParams[t].startDateValue))},getValue:function(){return modelsHiddenParams[t].startDateValue},addValueChangedHandler:function(e){this.updateCallback=e},removeValueChangedHandler:function(e){},setCaption:function(e,a){},clearCaption:function(){}},this.endDateValue={updateCallback:function(){},setValue:function(e){moment(e,r.formatDateValue,!0).isValid()&&(modelsHiddenParams[t].endDateValue=e,$('input[id="daterangepickerInput'+a+'"]').data("daterangepicker").setEndDate(modelsHiddenParams[t].endDateValue))},getValue:function(){return modelsHiddenParams[t].endDateValue},addValueChangedHandler:function(e){this.updateCallback=e},removeValueChangedHandler:function(e){},setCaption:function(e,a){},clearCaption:function(){}},r.render()},this.dateRangePickerWidget.prototype=baseWidget.prototype,this.pluginDefinition={name:"dateRangePicker",widgetsDefinitionList:{dateRangePicker:{factory:"dateRangePickerWidget",title:"Date-range calendar",icn:"date-range-calendar",help:"wdg/wdg-geo-time/#advanced-calendar"}}},this.constructor()}modelsHiddenParams.dateRangePicker={startDateValue:"",endDateValue:""},modelsParameters.dateRangePicker={label:"labelText",displayLabel:!0,displayTimePicker:!1,displayTimePicker24Hour:!1,labelFontSize:.5,labelColor:"var(--widget-label-color)",labelFontFamily:"var(--widget-font-family)",labelWidthProportion:"25%",valueFontSize:.5,valueColor:"var(--widget-color)",valueFontFamily:"var(--widget-font-family)",valueTextAlign:"left",displayBorder:!0,borderColor:"var(--widget-border-color)",backgroundColor:"var(--widget-input-color)"},modelsLayout.dateRangePicker={height:"5vh",width:"24vw",minWidth:"170px",minHeight:"32px"},dateRangePickerWidgetsPluginClass.prototype=basePlugin.prototype;var dateRangePickerWidgetsPlugin=new dateRangePickerWidgetsPluginClass;widgetsPluginsHandler.loadWidgetPlugin(dateRangePickerWidgetsPlugin);
function timePickerWidgetsPluginClass(){this.timepickerWidget=function(e,t,i,a){this.constructor(e,t,i,a);var l=this;this.enable=function(){},this.disable=function(){},this.updateValue=function(e){l.timeValue.updateCallback(l.timeValue,l.timeValue.getValue()),modelsHiddenParams[i].timeValue=l.timeValue.getValue()},this.rescale=function(){this.render()},this.render=function(){var a=document.createElement("div");a.setAttribute("style","display: table;text-align: left; height: inherit; width: inherit; cursor: inherit"),a.setAttribute("id","div-for-ng-timepicker"+t),$("#"+e).html(a);var r="";r=this.bIsInteractive?"clockpicker ":" ";var n="0%",o="labelText",s=$("#div-for-ng-timepicker"+t).width(),d="",c="calc(7px + 0.5vw + 0.4vh)",u="calc(7px + 0.5vw + 0.4vh)";1==modelsParameters[i].displayLabel&&(_.isUndefined(modelsParameters[i].label)||(o=this.getTransformedText("label")),_.isUndefined(modelsParameters[i].labelWidthProportion)||(n=modelsParameters[i].labelWidthProportion,s=(100-parseInt(n))*$("#div-for-ng-timepicker"+t).width()/100),_.isUndefined(modelsParameters[i].labelFontSize)||(c=this.labelFontSize()),_.isUndefined(modelsParameters[i].valueFontSize)||(u="calc(7px + "+modelsParameters[i].valueFontSize*getFontFactor()+"vw + 0.4vh)"),d='<span class="value-span" id="time-label-span'+t+'" style="width:'+n+"; "+c+this.labelColor()+this.labelFontFamily()+';">'+o+"</span>");var m="disabled",p="cursor: inherit; ";this.bIsInteractive&&(m="",p="cursor: pointer; ");var g=this.border(),h=$("#div-for-ng-timepicker"+t).height(),f=d+'<div style="height:100% width: '+s+'px;">'+('<div id="clockpicker'+t+'" ><div class="'+r+'"><input autocomplete="off" '+m+' placeholder="Select Time" id="clockpickerInput'+t+'" style="'+p+" height: "+h+"px; border-radius: 6px; "+g+"float: right;padding-right: "+u.replace("(","(3*(").replace(")","))")+";text-align: "+modelsParameters[i].valueTextAlign+"; font-size: "+u+"; "+this.valueColor()+this.valueFontFamily()+this.backgroundColor()+'" class="value-input form-control ng-pristine ng-untouched ng-valid ng-empty"><span class="form-control-feedback" style="'+p+"height: "+h+"px; display:table; margin-top: 0; top:0; padding-right: "+u+'"><i class="fa fa-lg fa-clock" style="display: table-cell; vertical-align: middle;'+p+"font-size: "+u+';" ></i></span></div></div>')+"</div>";a.innerHTML=f,$("#clockpicker"+t).clockpicker({autoclose:!0,default:"12:00",init:function(){this.value=modelsHiddenParams[i].timeValue},beforeShow:function(){},afterShow:function(){},beforeHide:function(){},afterHide:function(){},beforeHourSelect:function(){},afterHourSelect:function(){},beforeDone:function(){},afterDone:function(){}}).find("input").change((function(){modelsHiddenParams[i].timeValue=this.value,l.updateValue()})),$("#clockpickerInput"+t)[0].value=modelsHiddenParams[i].timeValue,$("#check-minutes").click((function(e){e.stopPropagation(),input.clockpicker("show").clockpicker("toggleView","minutes")})),this.bIsInteractive?l.enable():l.disable()};const r=new WidgetActuatorDescription("timeValue","Selected time as MM:HH",WidgetActuatorDescription.READ_WRITE,{$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:timepickerWidget",type:"string",pattern:"^[0-2]\\d:[0-5]\\d$"});this.getActuatorDescriptions=function(){return[r]},this.timeValue={updateCallback:function(){},setValue:function(e){modelsHiddenParams[i].timeValue=e,$("#clockpickerInput"+t)[0].value=e},getValue:function(){return modelsHiddenParams[i].timeValue},addValueChangedHandler:function(e){this.updateCallback=e,l.enable()},removeValueChangedHandler:function(e){l.disable()},setCaption:function(e,a){modelsParameters[i].inheritLabelFromData&&(l.captionHelper(e,l.bIsInteractive,a),$("#time-label-span"+t).text(modelsParameters[i].label))},clearCaption:function(){modelsParameters[i].inheritLabelFromData&&(modelsParameters[i].label=""),l.render()}},l.render()},this.timepickerWidget.prototype=baseWidget.prototype,this.pluginDefinition={name:"timepicker",widgetsDefinitionList:{timepickerSimple:{factory:"timepickerWidget",title:"Simple clock",icn:"clock",help:"wdg/wdg-geo-time/#simple-clock"}}},this.constructor()}modelsHiddenParams.timepickerSimple={timeValue:""},modelsParameters.timepickerSimple={label:"labelText",inheritLabelFromData:!0,displayLabel:!0,labelFontSize:.5,labelColor:"var(--widget-label-color)",labelFontFamily:"var(--widget-font-family)",labelWidthProportion:"30%",valueFontSize:.5,valueColor:"var(--widget-color)",valueFontFamily:"var(--widget-font-family)",valueTextAlign:"left",displayBorder:!0,borderColor:"var(--widget-border-color)",backgroundColor:"var(--widget-input-color)"},modelsLayout.timepickerSimple={height:"5vh",width:"19vw",minWidth:"150px",minHeight:"32px"},timePickerWidgetsPluginClass.prototype=basePlugin.prototype;var timePickerWidgetsPlugin=new timePickerWidgetsPluginClass;widgetsPluginsHandler.loadWidgetPlugin(timePickerWidgetsPlugin);
function calendarD3WidgetPluginClass(){this.calendarD3Widget=function(t,e,a,n){this.constructor(t,e,a,n);const i=this;this.enable=function(){},this.disable=function(){},this.updateValue=function(t){i.SelectedDate.updateCallback(i.SelectedDate,i.SelectedDate.getValue())},this.rescale=function(){this.render()},this.render=function(){const n=document.createElement("div");n.setAttribute("style","display: table;text-align: left; height: inherit; width: inherit; cursor: inherit"),n.setAttribute("id","div-for-calendarD3"+e),$("#"+t).html(n);const l=n.getBoundingClientRect(),r=l.width,d=l.height,o=d3.timeFormat("%Y-%m-%d"),s=d3.timeParse("%Y-%m-%d"),c=modelsHiddenParams[a].CalendarValues,u=c?.values||"";let p;if(!_.isUndefined(u)&&u.length)p=u;else{const t=d3.timeDay.range(new Date(2020,5,2),Date.now());p=t.map((t=>({date:o(t),value:void 0})))}p=p.map((t=>({date:s(t.date),value:t.value}))).sort(((t,e)=>t.date.getTime()-e.date.getTime()));const g=_.isUndefined(c.start)?p[0].date:s(c.start),y=_.isUndefined(c.end)?p[p.length-1].date:s(c.end),h=d3.timeDay.range(g,y),m=_.difference(h.map((function(t){return t.getTime()})),p.map((function(t){return t.date.getTime()})));m.length>0&&(m.forEach((function(t){p.push({date:new Date(t),value:void 0})})),p=p.sort((function(t,e){return t.date.getTime()-e.date.getTime()})));let f,D,w,M,Y,k,b,v,C,V,x,P,S,W=modelsParameters[a].AllYearsVisible?"full":"single",A="monday",H=t=>"SMTWTFS"[t],E="%b",F="+%",T=(d3.interpolateRdYlGn,p[0].date.getFullYear()),U=p[p.length-1].date.getFullYear(),L=U,R=40,j=0,I=0;function O(){"single"===W?(f=p.filter((t=>L==t.date.getFullYear())).map((t=>t.date)),D=p.filter((t=>L==t.date.getFullYear())).map((t=>t.value))):(f=p.map((t=>t.date)),D=p.map((t=>t.value))),w=d3.range(f.length),P=d3.groups(w,(t=>f[t].getFullYear())).reverse(),M="sunday"===A?t=>t:t=>(t+6)%7,Y="sunday"===A?d3.timeSunday:d3.timeMonday,k="weekday"===A?5:7;let t=d/((k+2)*P.length),e=(r-R)/53;S=Math.min(t,e),b=S*(k+2),j=(r-(R+53*S))/2,(j<0||"single"===W)&&(j=0),I=(d-b*P.length)/2,(I<0||"single"===W)&&(I=0),v=d3.quantile(D,.9975),C=d3.scaleSequential([0,v],["#d5f4c7","red"]).unknown("none"),E=d3.timeFormat(E),V=d3.timeFormat("%B %-d, %Y"),x=C.tickFormat(100,F),title=t=>`${V(f[t])}\n${x(D[t])}`}function q(t){const e=Math.max(0,Math.min(k,M(t.getDay()))),a=Y.count(d3.timeYear(t),t);return`${0===e?`M${a*S},0`:e===k?`M${(a+1)*S},0`:`M${(a+1)*S},0V${e*S}H${a*S}`}V${k*S}`}O(),d3.selection.prototype.conditionalDraw=function(){const t=22*S+R,e=b*P.length/2;return"single"===W?this.attr("x",t).attr("y",e).style("opacity",0).transition().duration(500):this};const B=d3.select(n).append("svg").attr("style","width: inherit; height: inherit;").attr("font-family","sans-serif").attr("font-size",S);if(d3.select("body").append("div").attr("class","tooltip").attr("id","tooltipCalendar").style("display","none").style("pointer-events","none").style("background","#fff").style("color","#000").style("border","2px solid #000").style("opacity",0),"single"===W){const t="M 1 1 L 12 10 L 1 19 L 1 1",e="M 12 1 L 1 10 L 12 19 L 12 1",a=B.append("path").attr("d",t).style("fill-rule","evenodd").attr("transform","translate("+(28*S+R)+", "+b*P.length+") ").attr("stroke-width","0.0").attr("stroke","black").attr("fill","#888888"),n=B.append("path").attr("d",e).style("fill-rule","evenodd").attr("transform","translate("+(22*S+R)+", "+b*P.length+") ").attr("stroke-width","0.0").attr("stroke","black").attr("fill","#888888");a.on("click",(function(){N(1,a,n)})),n.on("click",(function(){N(-1,a,n)})),a.attr("opacity",.2)}async function N(t,e,a){const n=22*S+R,i=b*P.length/2,l=L+t;l>U||l<T||(L=l,await B.selectAll(".year").selectAll("*").transition().duration(500).attr("x",n).attr("y",i).style("opacity",0).end(),B.selectAll(".year").remove(),l==T?(a.attr("opacity",.2),e.attr("opacity",1)):l==U?(a.attr("opacity",1),e.attr("opacity",.2)):(a.attr("opacity",1),e.attr("opacity",1)),O(),z())}function z(){const t=B.selectAll("g").data(P).join("g");t.attr("class","year").attr("transform",((t,e)=>"translate("+(R+j)+`,${b*e+1.5*S+I})`)),t.append("text").conditionalDraw().attr("x",-5).attr("y",-5).attr("font-weight","bold").attr("text-anchor","end").text((([t])=>t)).style("opacity",1),t.append("g").attr("text-anchor","end").selectAll("text").data("weekday"===A?d3.range(1,6):d3.range(7)).join("text").conditionalDraw().attr("x",-5).attr("y",(t=>(M(t)+.5)*S)).attr("dy","0.31em").text(H).style("opacity",1),t.append("g").selectAll("rect").data("weekday"===A?([,t])=>t.filter((t=>![0,6].includes(f[t].getDay()))):([,t])=>t).join("rect").attr("width",S-1).attr("height",S-1).attr("fill",(function(t,e){return _.isUndefined(D[t])?i.undefinedValueColor():C(D[t])})).on("mouseover",(function(t,e){_.isUndefined(D[e])||(d3.select(this).attr("height",S-2).attr("width",S-2).attr("transform","translate(1,1)").style("stroke","black").style("stroke-width",1).style("stroke-opacity",1),d3.select("#tooltipCalendar").style("display","block").style("opacity",1).html("<center>"+o(f[e])+"</center>Value : "+D[e]).style("left",t.pageX+10+"px").style("top",t.pageY+10+"px"))})).on("mouseout",(function(t,e){_.isUndefined(D[e])||(d3.select(this).style("stroke","black").style("stroke-width",0).style("stroke-opacity",0).attr("transform","translate(0,0)").attr("width",S-1).attr("height",S-1),d3.select("#tooltipCalendar").style("display","none").style("opacity",0))})).on("click",(function(t,e){modelsHiddenParams[a].SelectedDate=o(f[e]),i.updateValue()})).conditionalDraw().style("opacity",1).attr("x",(t=>Y.count(d3.timeYear(f[t]),f[t])*S+.5)).attr("y",(t=>M(f[t].getDay())*S+.5));const e=t.append("g").selectAll("g").data((([,t])=>d3.timeMonths(d3.timeMonth(f[t[0]]),f[t[t.length-1]]))).join("g");e.filter(((t,e)=>e)).append("path").attr("fill","none").attr("stroke","#fff").attr("stroke-width",2).attr("d",q),e.append("text").text(E).conditionalDraw().style("opacity",1).attr("x",(t=>Y.count(d3.timeYear(t),Y.ceil(t))*S+3)).attr("y",-5).style("opacity",1)}function q(t){const e=Math.max(0,Math.min(k,M(t.getDay()))),a=Y.count(d3.timeYear(t),t);return`${0===e?`M${a*S},0`:e===k?`M${(a+1)*S},0`:`M${(a+1)*S},0V${e*S}H${a*S}`}V${k*S}`}z()};const l={$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:calendarD3Widget_input",type:"object",properties:{start:{type:"string"},end:{type:"string"},values:{type:"array",items:{type:"object",properties:{date:{type:"string"},value:{type:"number"}}}}}},r=new WidgetActuatorDescription("CalendarValues","Calendar Values Object{start : YYYY-MM-DD, end : YYYY-MM-DD, values : Array[{date : YYYY-MM-DD, value : number}]}",WidgetActuatorDescription.READ,l),d={$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:calendarD3Widget_dateSelected",type:"string"},o=new WidgetActuatorDescription("SelectedDate","Selected date as YYYY-MM-DD",WidgetActuatorDescription.WRITE,d);this.getActuatorDescriptions=function(){return[r,o]},this.CalendarValues={updateCallback:function(){},setValue:function(t){modelsHiddenParams[a].CalendarValues=t,i.render()},getValue:function(){return modelsHiddenParams[a].timeValue},addValueChangedHandler:function(t){this.updateCallback=t,i.enable()},removeValueChangedHandler:function(t){i.disable()}},this.SelectedDate={updateCallback:function(){},setValue:function(t){modelsHiddenParams[a].SelectedDate=t},getValue:function(){return modelsHiddenParams[a].SelectedDate},addValueChangedHandler:function(t){this.updateCallback=t},removeValueChangedHandler:function(t){}},i.render()},this.calendarD3Widget.prototype=baseWidget.prototype,this.pluginDefinition={name:"calendarD3",widgetsDefinitionList:{calendarD3:{factory:"calendarD3Widget",title:"Year Calenddar",icn:"year-calendar",help:"wdg/wdg-geo-time/#simple-clock"}}},this.constructor()}modelsHiddenParams.calendarD3={CalendarValues:[],SelectedDate:""},modelsParameters.calendarD3={AllYearsVisible:!0,UndefinedValueColor:"var(--widget-calendar-d3-undefined-value)"},modelsLayout.calendarD3={height:"5vh",width:"19vw",minWidth:"100px",minHeight:"100px"},calendarD3WidgetPluginClass.prototype=basePlugin.prototype;var calendarD3Plugin=new calendarD3WidgetPluginClass;widgetsPluginsHandler.loadWidgetPlugin(calendarD3Plugin);
function flatUiComplexWidgetsPluginClass(){this.selectFlatUiWidget=function(e,t,l,a){this.constructor(e,t,l,a);const i=this;this.enable=function(){$("#select"+t).off("click").on("click",(function(e,t){const a=i.selectedValue.getValue();modelsHiddenParams[l].selectedValue=a,i.selectedValue.updateCallback(i.selectedValue,a)})),$("#select"+t).prop("disabled",!1),document.styleSheets[0].addRule("#s2id_select"+t+" > .select2-choice > .select2-chosen",this.selectedValueColor()),document.styleSheets[0].addRule("#s2id_select"+t+" > .select2-choice",this.selectedItemDefaultColor()),document.styleSheets[0].addRule("#s2id_select"+t+" > .select2-choice:hover",this.selectedItemHoverColor())},this.disable=function(){$("#select"+t).prop("disabled",!0)},this.rescale=function(){this.render()},this.render=function(){const a=document.createElement("div");a.setAttribute("id","select-widget-html"+t),a.setAttribute("class","select-widget-html");let s=Math.min($("#"+e).height(),$("#"+e).width()/2),o="";if(modelsParameters[l].displayLabel){const a=this.getTransformedText("label");if(s=Math.min($("#"+e).height(),$("#"+e).width()/4),_.isUndefined(modelsParameters[l].selectWidthProportion))o='<span id="select-span'+t+'" class="select-span" style="max-width: 45%; '+this.labelFontSize()+this.labelColor()+this.labelFontFamily()+'">'+a+"</span>";else{const e=Math.max(0,100-parseFloat(modelsParameters[l].selectWidthProportion))+"%";o='<span id="select-span'+t+'" class="select-span" style="width:'+e+"; "+this.labelFontSize()+this.labelColor()+this.labelFontFamily()+'">'+a+"</span>"}}const r=modelsHiddenParams[l].keys,n=modelsHiddenParams[l].values,d=Math.min(n.length,r.length);o+='<select data-toggle="select" id="select'+t+'" class="select-div form-control select select-primary select-block mbl" '+('style="display: table; height: '+s+'px; "')+">";for(let e=0;e<d;e++)o+=`<option value="${n[e]}">${r[e]}</option>`;o+="</select>",a.innerHTML=o,a.setAttribute("id","select-div-container"+t),a.setAttribute("style","height: "+s+"px; "+this.selectFontSize()+this.selectValueFontFamily()),$("#"+e).html(a),this.bIsInteractive?i.enable():i.disable();new MutationObserver((function(e,l){for(const a of e)if("childList"===a.type&&a.addedNodes.length){const e=document.querySelector("#s2id_select"+t+" > a > span:first-child");if(e){const t=e.getAttribute("id").split("-"),a=t[t.length-1];document.styleSheets[0].addRule("#select2-results-"+a,i.selectValueFontFamily()),l.disconnect()}}})).observe(document.body,{childList:!0,subtree:!0}),$("#select"+t)[0].value=String(modelsHiddenParams[l].selectedValue),$("#select"+t).select2()};const s=new WidgetActuatorDescription("selectedValue","Selected value",WidgetActuatorDescription.READ_WRITE,WidgetPrototypesManager.SCHEMA_NUMBER),o=new WidgetActuatorDescription("selectedValue","Selected value",WidgetActuatorDescription.READ_WRITE,WidgetPrototypesManager.SCHEMA_STRING),r=new WidgetActuatorDescription("selectedValue","Selected value",WidgetActuatorDescription.READ_WRITE,WidgetPrototypesManager.SCHEMA_BOOLEAN),n=new WidgetActuatorDescription("selectedValue","Selected value",WidgetActuatorDescription.READ_WRITE,WidgetPrototypesManager.SCHEMA_NUMBER_OR_STRING),d=new WidgetActuatorDescription("keys","Labels of the selectable options",WidgetActuatorDescription.READ,WidgetPrototypesManager.SCHEMA_STRING_ARRAY),c=new WidgetActuatorDescription("values","Selectable values. Must match 'keys'.",WidgetActuatorDescription.READ,WidgetPrototypesManager.SCHEMA_STRING_ARRAY),u=new WidgetActuatorDescription("values","Selectable values. Must match 'keys'.",WidgetActuatorDescription.READ,WidgetPrototypesManager.SCHEMA_NUMBER_ARRAY),h=new WidgetActuatorDescription("values","Selectable values. Must match 'keys'.",WidgetActuatorDescription.READ,WidgetPrototypesManager.SCHEMA_BOOLEAN_ARRAY),m=new WidgetActuatorDescription("keyValuePairs","Array of selectable key-value objects; Key being the displayed label",WidgetActuatorDescription.READ,{$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:selectFlatUiWidget_keyValuePairs_isNumber",type:"array",items:{type:"object",properties:{key:{type:["string","number","boolean"]},value:{type:"number"}},required:["key"]}}),g=new WidgetActuatorDescription("keyValuePairs","Array of selectable key-value objects; Key being the displayed label",WidgetActuatorDescription.READ,{$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:selectFlatUiWidget_keyValuePairs",type:"array",items:{type:"object",properties:{key:{type:["string","number","boolean"]},value:{type:"string"}},required:["key"]}}),p=new WidgetActuatorDescription("keyValuePairs","Array of selectable key-value objects; Key being the displayed label",WidgetActuatorDescription.READ,{$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:selectFlatUiWidget_keyValuePairs",type:"array",items:{type:"object",properties:{key:{type:["string","number","boolean"]},value:{type:"boolean"}},required:["key"]}});this.getActuatorDescriptions=function(e=null){const t=e||modelsParameters[l],a=[];t&&t.isKeyValuePairs?a.push(t.isNumber?m:t.isBoolean?p:g):(a.push(d),a.push(t&&t.isNumber?u:t.isBoolean?h:c));let i=n;return t&&(i=t.isNumber?s:t.isBoolean?r:o),a.push(i),a},this.selectedValue={updateCallback:function(){},setValue:function(e){modelsHiddenParams[l].selectedValue=e,i.render()},getValue:function(){const e=$("#select"+t)[0].value;return modelsParameters[l].isNumber?Number(e):modelsParameters[l].isBoolean?"false"!==e&&Boolean(e):e},addValueChangedHandler:function(e){this.updateCallback=e,""!=$("#select"+t)[0].value&&e(this,$("#select"+t)[0].value),i.enable()},removeValueChangedHandler:function(e){i.disable()},setCaption:function(e,a){modelsParameters[l].inheritLabelFromData&&(i.captionHelper(e,i.bIsInteractive,a),$("#select-span"+t).text(modelsParameters[l].label))},clearCaption:function(){modelsParameters[l].inheritLabelFromData&&(modelsParameters[l].label=""),i.render()}},modelsParameters[l].isKeyValuePairs?this.keyValuePairs={setValue:function(e){modelsHiddenParams[l].keys=[],modelsHiddenParams[l].values=[];const t='"keyValuePairs" must be an array of key or an array of key/value pairs (in widget'+l+")",a='Example1: [{"key":"choice1"}, {"key":"choice2"}] \n or Example2: [{"key":"choice1", "value":"1"}, {"key":"choice2", "value":"2"}]';if(Array.isArray(e)){for(const i of e){if(_.isUndefined(i.key))return void swal(t,a,"info");modelsHiddenParams[l].keys.push(i.key),modelsHiddenParams[l].values.push(i.value??i.key)}i.render()}else swal(t,a,"info")},getValue:function(){},addValueChangedHandler:function(e){i.enable()},removeValueChangedHandler:function(e){i.disable()}}:(this.keys={setValue:function(e){const t='"keys" must be an array (in widget'+l+")",a='Example: ["choice1","choice2"]';Array.isArray(e)?e.length&&"object"==typeof e[0]?swal(t,a,"info"):(modelsHiddenParams[l].keys=e,i.render()):swal(t,a,"info")},getValue:function(){},addValueChangedHandler:function(e){i.enable()},removeValueChangedHandler:function(e){i.disable()}},this.values={setValue:function(e){const t='"value" must be an array (in widget'+l+")",a="Example: [1, 2]";null==e&&(e=modelsHiddenParams[l].keys),Array.isArray(e)?e.length&&"object"==typeof e[0]?swal(t,a,"info"):(modelsHiddenParams[l].values=e,i.render()):swal(t,a,"info")},getValue:function(){},addValueChangedHandler:function(e){i.enable()},removeValueChangedHandler:function(e){i.disable()}}),i.render()},this.selectFlatUiWidget.prototype=baseWidget.prototype,this.multiSelectFlatUiWidget=function(e,t,l,a){this.constructor(e,t,l,a);const i=this;this.enable=function(){$("#multi-select"+t).on("click",(function(e){i.selectedValue.updateCallback(i.selectedValue,i.selectedValue.getValue())})),$("#multi-select"+t)[0].style.opacity="1"},this.disable=function(){$("#multi-select"+t)[0].style.opacity="0.7"},this.rescale=function(){this.render()},this.hasScrollBar=function(e){return e.get(0).scrollHeight>e.get(0).clientHeight},this.render=function(){const a=document.createElement("div"),s=$("#"+e).height();a.setAttribute("style","width: inherit; height: "+s+"px; cursor: inherit;");let o='<div class="multi-select-div" id="multi-select'+t+'" style="height: '+s+"px; "+this.valueDefaultColor()+this.border()+'">';const r=modelsHiddenParams[l].value;let n="";if(n=this.bIsInteractive?"cursor: pointer; ":"cursor: inherit; ",_.isUndefined(modelsParameters[l].valueFontSize)&&(modelsParameters[l].valueFontSize=.4),Array.isArray(r))for(const e of r)o+="<label >",o+='<input type="checkbox" value="'+e+'" />',o+='<span id="multi-select-label'+t+'" style="'+n+this.valueFontFamily()+this.valueFontSize()+this.checkboxWidth()+this.checkboxHeight()+'" tabindex="-1">'+e+"</span>",o+="</label>";o+="</div>",a.innerHTML=o,$("#"+e).html(a);i.hasScrollBar($("#multi-select"+t))||$("#multi-select"+t+".multi-select-div").css("align-content","center");const d=window.mobileAndTabletCheck();("ontouchstart"in document.documentElement||d)&&($("#multi-select"+t)[0].style.height="auto"),modelsParameters[l].resetPastSelection||_.isEmpty(modelsHiddenParams[l].selectedValue)||$("#multi-select"+t+" > label > input[type='checkbox']").each((function(){for(const e of modelsHiddenParams[l].selectedValue)$(this).val()==e&&$(this).attr("checked",!0)})),document.styleSheets[0].addRule("#multi-select-label"+t,this.valueDefaultColor()),document.styleSheets[0].addRule("#multi-select-label"+t,this.checkboxDefaultColor()),document.styleSheets[0].addRule("#multi-select-label"+t,this.checkboxBorder()),document.styleSheets[0].addRule("#multi-select-label"+t+":hover",this.valueHoverColor()),document.styleSheets[0].addRule("#multi-select-label"+t+":hover",this.checkboxHoverColor()),document.styleSheets[0].addRule("#multi-select-label"+t+":hover",this.checkboxHoverBorderColor()),document.styleSheets[0].addRule('input[type="checkbox"]:checked + #multi-select-label'+t,this.valueFocusColor()),document.styleSheets[0].addRule('input[type="checkbox"]:checked + #multi-select-label'+t,this.checkboxFocusColor()),document.styleSheets[0].addRule('input[type="checkbox"]:checked + #multi-select-label'+t,this.checkboxFocusBorderColor()),this.bIsInteractive?i.enable():i.disable()};const s=new WidgetActuatorDescription("value","Available choices",WidgetActuatorDescription.READ,WidgetPrototypesManager.SCHEMA_PRIMITIVE_ARRAY),o=new WidgetActuatorDescription("selectedValue","Currently selected choices",WidgetActuatorDescription.READ_WRITE,WidgetPrototypesManager.SCHEMA_STRING_ARRAY);this.getActuatorDescriptions=function(){return[s,o]},this.value={updateCallback:function(){},setValue:function(e){modelsHiddenParams[l].value=e,i.render(),i.selectedValue.updateCallback(i.selectedValue,i.selectedValue.getValue())},getValue:function(){return modelsParameters[l].isNumber?Number(modelsHiddenParams[l].value):modelsParameters[l].isBoolean?"false"!==modelsHiddenParams[l].value&&Boolean(modelsHiddenParams[l].value):modelsHiddenParams[l].value},addValueChangedHandler:function(e){this.updateCallback=e},removeValueChangedHandler:function(e){},setCaption:function(e,t){},clearCaption:function(){}},this.selectedValue={updateCallback:function(){},setValue:function(e){$("#multi-select"+t+" > label > input[type='checkbox']").each((function(){for(const t of e)$(this).val()===t&&$(this).attr("checked",!0)})),modelsHiddenParams[l].selectedValue=e},getValue:function(){const e=[];return $("#multi-select"+t+" > label > input[type='checkbox']:checked").each((function(){if(modelsParameters[l].isNumber)e.push(Number($(this).val()));else if(modelsParameters[l].isBoolean){const t="false"!==$(this).val()&&Boolean($(this).val());e.push(t)}else e.push($(this).val())})),e},addValueChangedHandler:function(e){this.updateCallback=e},removeValueChangedHandler:function(e){},setCaption:function(e,t){},clearCaption:function(){}},i.render()},this.multiSelectFlatUiWidget.prototype=baseWidget.prototype,this.listFlatUiWidget=function(e,t,l,a){this.constructor(e,t,l,a);const i=this;this.enable=function(){let e=!1,l=!1;$("#list"+t).on("keyup",(function(e){l&&(65!=e.keyCode&&97!=e.keyCode&&17!=e.keyCode||(i.selectedValue.updateCallback(i.selectedValue,i.selectedValue.getValue()),l=!1))})),$("#list"+t).on("click keyup",(function(a){l=!1,a.ctrlKey?e||(e=!0,$("#list"+t).one("keyup",(function(t){i.selectedValue.updateCallback(i.selectedValue,i.selectedValue.getValue()),e=!1,l=!0}))):(i.selectedValue.updateCallback(i.selectedValue,i.selectedValue.getValue()),e||(e=!0,$("#list"+t).one("keyup",(function(t){65!=t.keyCode&&97!=t.keyCode&&17!=t.keyCode||(i.selectedValue.updateCallback(i.selectedValue,i.selectedValue.getValue()),e=!1,l=!0)}))))})),$("#list"+t)[0].style.opacity="1"},this.disable=function(){$("#list"+t)[0].style.opacity="0.7"},this.rescale=function(){this.render()},this.render=function(){const a=document.createElement("div"),s=$("#"+e).height();a.setAttribute("style","width: inherit; height: "+s+"px; cursor: inherit;");const o=this.border();let r='<select class="form-control" id="list'+t+'" multiple size="10" style="width: 100%; height: '+s+"px;/*background-color: rgba(255, 255, 255, 0)*/; border-radius: 6px; color: "+modelsParameters[l].listValueColor+"; "+o+"; "+this.valueFontFamily()+"box-sizing: border-box; font-size: calc(7px + "+modelsParameters[l].listValueFontSize*getFontFactor()+'vw + 0.4vh); cursor: inherit; max-width : 2000px">';const n=modelsHiddenParams[l].value;let d="";if(d=this.bIsInteractive?"cursor: pointer; ":"cursor: inherit; ",Array.isArray(n))for(const e of n)r+='<option style="'+d+'">'+e+"</option>";r+="</select>",a.innerHTML=r,$("#"+e).html(a);const c=window.mobileAndTabletCheck();("ontouchstart"in document.documentElement||c)&&($("#list"+t)[0].style.height="auto"),_.isEmpty(modelsHiddenParams[l].selectedValue)||$("#list"+t).val(modelsHiddenParams[l].selectedValue),document.styleSheets[0].addRule("#list"+t+" option",modelsParameters[l].listValueColor),document.styleSheets[0].addRule("#list"+t+" option",this.listBackgroundColor()),document.styleSheets[0].addRule("#list"+t+" option:checked",this.selectValueColor()),document.styleSheets[0].addRule("#list"+t+" option:checked",this.selectValueBackgroundColor()),this.bIsInteractive?i.enable():i.disable()};const s=new WidgetActuatorDescription("value","Available choices",WidgetActuatorDescription.READ,WidgetPrototypesManager.SCHEMA_PRIMITIVE_ARRAY),o=new WidgetActuatorDescription("selectedValue","Currently selected choices",WidgetActuatorDescription.READ_WRITE,{$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:listFlatUiWidget_selectedValue",anyOf:[{type:"string"},{type:"array",items:{type:"string"}}]});this.getActuatorDescriptions=function(){return[s,o]},this.value={updateCallback:function(){},setValue:function(e){pastSelect=JSON.stringify(modelsHiddenParams[l].selectedValue),modelsHiddenParams[l].value=e,i.render(),selected=JSON.stringify(i.selectedValue.getValue()),selected!==pastSelect&&i.selectedValue.updateCallback(i.selectedValue,i.selectedValue.getValue())},getValue:function(){return modelsHiddenParams[l].value},addValueChangedHandler:function(e){this.updateCallback=e},removeValueChangedHandler:function(e){},setCaption:function(e,t){},clearCaption:function(){}},this.selectedValue={updateCallback:function(){},setValue:function(e){$("#list"+t).val(e),modelsHiddenParams[l].selectedValue=e},getValue:function(){const e=document.getElementById("list"+t),a=$("#list"+t).val(),i=e.selectedOptions;let s=0;if(Array.isArray(modelsHiddenParams[l].value)&&(s=modelsHiddenParams[l].value.length),0===i.length)return"";for(const e of i)if(e.index<0||e.index>=s)return"";return a},addValueChangedHandler:function(e){this.updateCallback=e},removeValueChangedHandler:function(e){},setCaption:function(e,t){},clearCaption:function(){}},i.render()},this.listFlatUiWidget.prototype=baseWidget.prototype,this.tableFlatUiWidget=function(e,t,l,a){this.constructor(e,t,l,a);const i=this;this.enable=function(){$("#table"+t).editableTableWidget(),$("#table"+t+" td").on("change",(function(e,t){const a=$(this),s=a.parent(),o=a.index();let r=s.index(),n=.5;_.isUndefined(modelsParameters[l].tableValueFontSize)||(n=modelsParameters[l].tableValueFontSize),modelsParameters[l].headerLine&&(r+=1),_.isNaN(Number(t))||(t=Number(t)),modelsHiddenParams[l].value[r][o]=t,a.html('<span style="'+i.valueColor()+i.valueFontFamily()+" font-size: calc(7px + "+n*getFontFactor()+'vw)">'+t+"<span>"),i.value.updateCallback(i.value,i.value.getValue())}))},this.disable=function(){$("#table"+t+" td").on("change",(function(e,t){}))},this.buildTable=function(e){let t,a="",i=0,s=.5;_.isUndefined(modelsParameters[l].tableValueFontSize)||(s=modelsParameters[l].tableValueFontSize);let o=Array.isArray(e);if(o){let r=e[0];if(o=Array.isArray(r),o){if(modelsParameters[l].headerLine){i=1,a+="<thead><tr>";for(const t of e[0])a+='<th style="'+this.valueAlign()+'"><span style="'+this.valueColor()+this.valueFontFamily()+" font-size: calc(7px + "+s*getFontFactor()+'vw);"><b>'+t+"</b></span></th>";a+="</tr></thead>"}a+="<tbody>";for(let o=i;o<e.length;o++){modelsParameters[l].striped?o%2!=0&&(a+='<tr style="'+this.tableBackgroundColor("secondary")+'">'):a+="<tr>";for(let i=0;i<e[o].length;i++){let r=[];try{r="*"==modelsParameters[l].editableCols?modelsParameters[l].indexColumn?_.range(1,e[o].length):_.range(e[o].length):JSON.parse(modelsParameters[l].editableCols)}catch(e){}let n="";-1==_.indexOf(r,i)?t="false":(t="true",this.bIsInteractive&&(n="cursor: cell;")),a+='<td style="'+n+this.valueAlign()+'" data-editable="'+t+'"><span style="'+this.valueColor()+this.valueFontFamily()+" font-size: calc(7px + "+s*getFontFactor()+'vw)">'+e[o][i]+"</span></td>"}a+="</tr>"}a+="</tbody>"}else{a+="<tbody><tr>";for(let t=i;t<e.length;t++)r=e[t],a+='<td style="'+this.valueAlign()+'"><span style="'+this.valueColor()+this.valueFontFamily()+" font-size: calc(7px + "+s*getFontFactor()+'vw)">'+r+"</span></td>";a+="</tr></tbody>"}}return a},this.rescale=function(){this.render()},this.render=function(){const a=document.createElement("div"),s="cursor: "+(this.bIsInteractive?"auto":"inherit")+"; width: inherit; height: inherit; overflow: auto";a.setAttribute("style",s);let o=`<table style="margin: 0; height: 100%; ${this.tableBackgroundColor("primary")}" class="table`;modelsParameters[l].bordered&&(o+=" table-bordered "),modelsParameters[l].noBorder&&(o+=" no-border "),o+=' table-responsive" id="table'+t+'" >';const r=modelsHiddenParams[l].value;let n=i.buildTable(r);""===n&&(n="<tbody><tr><td/><td/><td/></tr><tr><td/><td/><td/></tr></tbody>"),o+=n+"</table>",a.innerHTML=o,$("#"+e).html(a),this.bIsInteractive?i.enable():i.disable()};const s={$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:tableFlatUiWidget",anyOf:[{type:"array",items:{anyOf:[{type:"string"},{type:"number"},{type:"boolean"}]}},{type:"array",items:{type:"array",items:{anyOf:[{type:"string"},{type:"number"},{type:"boolean"}]}}}]},o=new WidgetActuatorDescription("value","Table content as an array or array of arrays",WidgetActuatorDescription.READ,s),r=new WidgetActuatorDescription("value","Table content as an array or array of arrays",WidgetActuatorDescription.READ_WRITE,s);this.getActuatorDescriptions=function(e=null){const t=e||modelsParameters[l];let a=[];try{a=JSON.parse(t.editableCols)}catch(e){}return Array.isArray(a)&&a.length?[r]:[o]},this.value={updateCallback:function(){},setValue:function(e){modelsHiddenParams[l].value=e,i.render()},getValue:function(){return modelsHiddenParams[l].value},addValueChangedHandler:function(e){this.updateCallback=e},removeValueChangedHandler:function(e){},setCaption:function(e,t){},clearCaption:function(){}},i.render()},this.tableFlatUiWidget.prototype=baseWidget.prototype,this.pluginDefinition={name:"flatUi",widgetsDefinitionList:{flatUiSelect:{factory:"selectFlatUiWidget",title:"Select",icn:"select",help:"wdg/wdg-basics/#select"},flatUiMultiSelect:{factory:"multiSelectFlatUiWidget",title:"Multi-select",icn:"multi-select",help:"wdg/wdg-basics/#multi-select"},flatUiList:{factory:"listFlatUiWidget",title:"List",icn:"list",help:"wdg/wdg-basics/#list"},flatUiTable:{factory:"tableFlatUiWidget",title:"Table",icn:"board",help:"wdg/wdg-basics/#editable-table"},flatUiEditableTable:{factory:"tableFlatUiWidget",title:"Editable table",icn:"board",help:"wdg/wdg-basics/#table"}}},this.constructor()}modelsHiddenParams.flatUiSelect={keys:[],values:[],selectedValue:""},modelsHiddenParams.flatUiMultiSelect={value:[],selectedValue:""},modelsHiddenParams.flatUiList={value:[],selectedValue:""},modelsHiddenParams.flatUiEditableTable={value:null},modelsHiddenParams.flatUiTable={value:null},modelsParameters.flatUiSelect={label:"labelText",inheritLabelFromData:!0,displayLabel:!0,labelFontSize:.5,labelColor:"var(--widget-label-color)",labelFontFamily:"var(--widget-font-family)",selectWidthProportion:"70%",isNumber:!1,isBoolean:!1,selectValueFontFamily:"var(--widget-font-family)",selectValueFontSize:.5,selectedValueColor:"var(--widget-select-option-highlighted-text)",selectedItemDefaultColor:"var(--widget-select-option-highlighted-color)",selectedItemHoverColor:"var(--widget-select-option-highlighted-color)",isKeyValuePairs:!1},modelsParameters.flatUiMultiSelect={addControls:!1,resetPastSelection:!1,valueFontSize:.4,valueFontFamily:"var(--widget-font-family)",checkboxWidth:7,checkboxHeight:1.5,valueDefaultColor:"var(--widget-label-color)",checkboxDefaultColor:"var(--widget-multiselect-color)",checkboxBorderColor:"var(--widget-multiselect-border-color)",valueHoverColor:"var(--widget-multiselect-hover-text)",checkboxHoverColor:"var(--widget-multiselect-hover-color)",checkboxHoverBorderColor:"var(--widget-multiselect-hover-border-color)",valueFocusColor:"var(--widget-multiselect-checked-text)",checkboxFocusColor:"var(--widget-multiselect-checked-color)",checkboxFocusBorderColor:"var(--widget-multiselect-checked-border-color)",displayBorder:!0,borderColor:"var(--widget-border-color)",isNumber:!1,isBoolean:!1},modelsParameters.flatUiList={addControls:!1,listValueFontSize:.5,listValueColor:"var(--widget-select-drop-text)",listBackgroundColor:"var(--widget-select-drop-color)",selectValueColor:"var(--widget-select-option-highlighted-text)",selectValueBackgroundColor:"var(--widget-select-option-highlighted-color)",valueFontFamily:"var(--widget-font-family)",borderColor:"var(--widget-border-color)",displayBorder:!0},modelsParameters.flatUiTable={headerLine:!1,indexColumn:!1,tableValueFontSize:.5,striped:!0,valueColor:"var(--widget-table-value-color)",valueFontFamily:"var(--widget-font-family)",valueAlign:"left",bordered:!0,noBorder:!1,editableCols:"[]",backgroundColor:{primary:"var(--widget-color-0)",secondary:"var(--widget-table-striped-odd)"}},modelsParameters.flatUiEditableTable={headerLine:!1,indexColumn:!1,tableValueFontSize:.5,striped:!0,valueColor:"var(--widget-table-value-color)",valueFontFamily:"var(--widget-font-family)",valueAlign:"left",bordered:!0,noBorder:!1,editableCols:"*",backgroundColor:{primary:"var(--widget-color-0)",secondary:"var(--widget-table-striped-odd)"}},modelsLayout.flatUiSelect={height:"5vh",width:"19vw",minWidth:"40px",minHeight:"27px"},modelsLayout.flatUiMultiSelect={height:"16vh",width:"11vw",minWidth:"80px",minHeight:"75px"},modelsLayout.flatUiList={height:"16vh",width:"11vw",minWidth:"80px",minHeight:"75px"},modelsLayout.flatUiEditableTable={height:"10vh",width:"11vw",minWidth:"88px",minHeight:"79px"},modelsLayout.flatUiTable={height:"10vh",width:"11vw",minWidth:"88px",minHeight:"79px"},flatUiComplexWidgetsPluginClass.prototype=basePlugin.prototype;var flatUiComplexWidgetsPlugin=new flatUiComplexWidgetsPluginClass;widgetsPluginsHandler.loadWidgetPlugin(flatUiComplexWidgetsPlugin);
function flatUiBooleanWidgetsPluginClass(){this.checkboxFlatUiWidget=function(e,t,i,l){this.constructor(e,t,i,l);const a=this;this.enable=function(){$("#checkbox"+t).off("click").on("click",(function(e,t){a.value.updateCallback(a.value,a.value.getValue())})),$("#checkbox"+t).radiocheck("enable")},this.disable=function(){$("#checkbox"+t).unbind("click"),$("#checkbox"+t).radiocheck("disable")},this.rescale=function(){this.render()},this.render=function(){let l=20,s=20;_.isNull($(".icons").height())||(l=$(".icons").height()),_.isNull($(".icons").width())||(s=$(".icons").width()),_.isUndefined(modelsParameters[i].checkboxSize)&&(modelsParameters[i].checkboxSize=1);const o=modelsParameters[i].checkboxSize*s,c=modelsParameters[i].checkboxSize*l;let d="";const n=document.createElement("div");n.setAttribute("id","checkbox-widget-html"+t);modelsParameters[i].checkboxSize,$("#"+e).height();n.setAttribute("style","width: inherit; cursor: inherit; display: flex; justify-content: center;");const r=_.isUndefined(modelsParameters[i].labelPosition)||"right"!==modelsParameters[i].labelPosition?"left":"right",h="left"===r?"rtl":"ltr";if(document.styleSheets[0].addRule("#checkbox-widget-html"+t,"direction: "+h),modelsParameters[i].displayLabel){const e=this.getTransformedText("label");let l='style = "cursor: inherit; padding-top:'+c+"px;";l+="right"===r?" padding-right: "+o+'px; padding-left: 0px; margin-right: 6px;"':" padding-left: "+o+'px; padding-right: 0px; margin-left: 6px;"',d+='<label class="checkbox" id="label'+t+'" '+l+' for="checkbox'+t+'">',d+='<input type="checkbox" class="nohover" data-toggle="radio" style="zoom:'+modelsParameters[i].checkboxSize+'" value="" id="checkbox'+t+'" disabled>',d+="</input>",d+="</label>";const a='style="display: flex; align-items: center; '+this.labelFontSize()+this.labelColor()+this.labelFontFamily()+'"';d+='<span id="checkbox-span'+t+'" class="checkbox-span" '+a+">"+e+"</span>"}else{d+='<label class="checkbox" id="label'+t+'" '+('style = "cursor: inherit; padding-top:'+c+"px; padding-left: "+o+'px; padding-right: 0px;"')+' for="checkbox'+t+'">',d+='<input type="checkbox" class="nohover" data-toggle="radio" style="zoom:'+modelsParameters[i].checkboxSize+' value="" id="checkbox'+t+'" disabled>',d+="</input>",d+="</label>"}n.innerHTML=d,$("#"+e).html(n),$('[data-toggle="checkbox"]').radiocheck(),$('[data-toggle="radio"]').radiocheck(),1==modelsHiddenParams[i].value?$("#checkbox"+t).radiocheck("check"):0==modelsHiddenParams[i].value&&$("#checkbox"+t).radiocheck("uncheck"),document.styleSheets[0].addRule("#label"+t+" .icons *","zoom: "+modelsParameters[i].checkboxSize),document.styleSheets[0].addRule("#label"+t+" .icons .icon-checked",this.checkedColor()),document.styleSheets[0].addRule("#label"+t+" .icons .icon-unchecked",this.uncheckedColor()),this.bIsInteractive?a.enable():a.disable()};const s=new WidgetActuatorDescription("value","Current value",WidgetActuatorDescription.READ_WRITE,WidgetPrototypesManager.SCHEMA_BOOLEAN);this.getActuatorDescriptions=function(){return[s]},this.value={updateCallback:function(){},setValue:function(e){modelsHiddenParams[i].value=e,$("#checkbox"+t)[0].checked=e},getValue:function(){return $("#checkbox"+t)[0].checked},addValueChangedHandler:function(e){this.updateCallback=e,a.enable()},removeValueChangedHandler:function(e){a.disable()},setCaption:function(e,t){modelsParameters[i].inheritLabelFromData&&(a.captionHelper(e,a.bIsInteractive,t),a.render())},clearCaption:function(){modelsParameters[i].inheritLabelFromData&&(modelsParameters[i].label=""),a.render()}},a.render()},this.checkboxFlatUiWidget.prototype=baseWidget.prototype,this.switchFlatUiWidget=function(e,t,i,l){this.constructor(e,t,i,l);const a=this;this.enable=function(i){$("#switch"+t).on("click",(function(i,l){if(a.value.updateCallback(a.value,a.value.getValue()),$("#switch"+t)[0].checked){const i=$("#switch-label"+t).height(),l=$("#"+e).width(),a=Math.min(l,i)-8,s=$("#slide"+t).width()-a-8;document.styleSheets[0].addRule("#slide"+t+":before","transform: translateX("+s+"px);")}else document.styleSheets[0].addRule("#slide"+t+":before","transform: translateX(0px);")})),$("#switch"+t).prop("disabled",!1)},this.disable=function(){$("#switch"+t).unbind("click"),$("#switch"+t).prop("disabled",!0)},this.updateSwitchStatus=function(){if(1==modelsHiddenParams[i].value){if(!$("#switch"+t)[0].checked){$("#switch"+t).prop("checked",!0);const i=$("#switch-label"+t).height(),l=$("#"+e).width(),a=Math.min(l,i)-8,s=$("#slide"+t).width()-a-8;document.styleSheets[0].addRule("#slide"+t+":before","transform: translateX("+s+"px);"),document.styleSheets[0].addRule("input:checked + #slide"+t,this.switchOnColor()),document.styleSheets[0].addRule("input:focus + #slide"+t,this.switchOnColor())}}else 0==modelsHiddenParams[i].value&&$("#switch"+t)[0].checked&&($("#switch"+t).prop("checked",!1),document.styleSheets[0].addRule("#slide"+t+":before","transform: translateX(0px);"))},this.rescale=function(){this.render()},this.render=function(){let l=1;_.isUndefined(modelsParameters[i].switchWidthProportion)||(l=Math.min(1,parseFloat(modelsParameters[i].switchWidthProportion)/100));const s=$("#"+e).height();let o=Math.min(s,260);o=Math.min(o,l*$("#"+e).width()/3),o=Math.ceil(o);const c=$("#"+e).width(),d=document.createElement("div");d.setAttribute("id","switch-widget-html"+t),d.setAttribute("class","switch-widget-html"),d.setAttribute("style","height: "+s+"px;");const n=_.isUndefined(modelsParameters[i].labelPosition)||"right"!==modelsParameters[i].labelPosition?"left":"right",r="left"===n?"rtl":"ltr";let h;if(document.styleSheets[0].addRule("#switch-widget-html"+t,"direction: "+r),_.isUndefined(modelsParameters[i].switchWidthProportion))h='<div class="switch-div" style="width: 100%;">';else{h='<div class="switch-div" style="width: '+(Math.min(100,parseFloat(modelsParameters[i].switchWidthProportion))+"%")+';">'}let u="";if(u=this.bIsInteractive?"cursor: pointer;":"cursor: inherit;",h+='<label id="switch-label'+t+'" class="switch-label" style="height:'+o+'px;">',h+='<input type="checkbox" id="switch'+t+'">',h+='<div id="slide'+t+'"class="slider round" style="'+u+'">',h+="</div>",h+="</label>",h+="</div>",modelsParameters[i].displayLabel){const e=this.getTransformedText("label");h+='<span id="switch-span'+t+'" class="switch-span" style="'+this.labelFontSize()+this.labelColor()+this.labelFontFamily()+" text-align: "+n+';">'+e+"</span>"}d.innerHTML=h,$("#"+e).html(d),document.styleSheets[0].addRule("input + #slide"+t,this.switchOffColor()),document.styleSheets[0].addRule("input:checked + #slide"+t,this.switchOnColor()),document.styleSheets[0].addRule("input:focus + #slide"+t,this.switchShadowColor());const m=Math.min(c,o)-8;if(document.styleSheets[0].addRule("#slide"+t+":before","width: "+m+"px;"),document.styleSheets[0].addRule("#slide"+t+":before","height: "+m+"px;"),null==modelsHiddenParams[i].value&&(modelsHiddenParams[i].value=!1),1==modelsHiddenParams[i].value){$("#switch"+t).prop("checked",!0);const e=$("#slide"+t).width()-m-8;document.styleSheets[0].addRule("#slide"+t+":before","transform: translateX("+e+"px);")}else 0==modelsHiddenParams[i].value&&($("#switch"+t).prop("checked",!1),document.styleSheets[0].addRule("#slide"+t+":before","transform: translateX(0px);"));this.bIsInteractive?a.enable():a.disable(),$("#switch"+t)[0].checked=modelsHiddenParams[i].value};const s=new WidgetActuatorDescription("value","Current value",WidgetActuatorDescription.READ_WRITE,WidgetPrototypesManager.SCHEMA_BOOLEAN);this.getActuatorDescriptions=function(){return[s]},this.value={updateCallback:function(){},setValue:function(e){modelsHiddenParams[i].value=e,a.updateSwitchStatus()},getValue:function(){return $("#switch"+t)[0].checked},addValueChangedHandler:function(e){this.updateCallback=e},removeValueChangedHandler:function(e){},setCaption:function(e,t){modelsParameters[i].inheritLabelFromData&&(a.captionHelper(e,a.bIsInteractive,t),a.render())},clearCaption:function(){modelsParameters[i].inheritLabelFromData&&(modelsParameters[i].label=""),a.render()}},a.render()},this.switchFlatUiWidget.prototype=baseWidget.prototype,this.pluginDefinition={name:"flatUiBoolean",widgetsDefinitionList:{flatUiCheckbox:{factory:"checkboxFlatUiWidget",title:"Checkbox",icn:"checkbox",help:"wdg/wdg-basics/#checkbox"},flatUiSwitch:{factory:"switchFlatUiWidget",title:"Switch",icn:"switch",help:"wdg/wdg-basics/#switch"}}},this.constructor()}modelsHiddenParams.flatUiCheckbox={value:!1},modelsHiddenParams.flatUiSwitch={value:!1},modelsParameters.flatUiCheckbox={label:"labelText",inheritLabelFromData:!0,displayLabel:!0,labelPosition:"right",labelFontSize:.5,labelColor:"var(--widget-label-color)",labelFontFamily:"var(--widget-font-family)",checkboxSize:1,checkedColor:"var(--widget-input-checked-color)",uncheckedColor:"var(--widget-input-unchecked-color)"},modelsParameters.flatUiSwitch={label:"labelText",inheritLabelFromData:!0,displayLabel:!0,labelPosition:"right",labelFontSize:.5,labelColor:"var(--widget-label-color)",labelFontFamily:"var(--widget-font-family)",switchWidthProportion:"30%",switchOnColor:"var(--widget-input-checked-color)",switchOffColor:"var(--widget-input-unchecked-color)"},modelsLayout.flatUiCheckbox={height:"5vh",width:"9vw",minWidth:"32px",minHeight:"24px"},modelsLayout.flatUiSwitch={height:"5vh",width:"10vw",minWidth:"50px",minHeight:"24px"},flatUiBooleanWidgetsPluginClass.prototype=basePlugin.prototype;var flatUiBooleanWidgetsPlugin=new flatUiBooleanWidgetsPluginClass;widgetsPluginsHandler.loadWidgetPlugin(flatUiBooleanWidgetsPlugin);
function flatUiAddressCompletionWidgetsPluginClass(){this.hereAutocompleteValueFlatUiWidget=function(e,t,a,i){this.constructor(e,t,a,i);var l=this;this.updateValue=function(e){if(!_.includes([9,16,17,18,20,33,34,35,36,37,38,39,40],e.which)&&(10==e.which||13==e.which||27==e.which)){var i=$("#ac-value"+t)[0].value;modelsHiddenParams[a].value=i,l.value.updateCallback(l.value,i),e.preventDefault()}},this.enable=function(){$("#ac-value"+t).prop("disabled",!1),$("#ac-value"+t).bind("typeahead:selected",(function(e,t,i){modelsHiddenParams[a].value=t.word,l.value.updateCallback(l.value,t.word)})),$("#ac-value"+t).on("keyup",(function(e,t){l.updateValue(e)})),$("#ac-value"+t).on("click",(function(e,t){widgetPreview.elevateZIndex(a,e)})),l.initTypeahead()},this.disable=function(){$("#ac-value"+t).prop("disabled",!0)},this.formatHereSuggestTable=function(e){var t=[];if(_.isUndefined(e))return t;if(_.isEmpty(e))return t;if(_.isUndefined(e.items))return t;if(_.isEmpty(e.items))return t;for(var a=0;a<e.items.length;a++)t[a]=[],t[a][0]=e.items[a].address.houseNumber,t[a][1]=e.items[a].address.street,t[a][2]=e.items[a].address.postalCode,t[a][3]=e.items[a].address.city,t[a][4]=e.items[a].address.county,t[a][5]=e.items[a].address.state,t[a][6]=e.items[a].address.countryName;return t},this.formatSuggestWords=function(e){var t,a,i,l=[];if(e.length<1)return"";for(var s=0;s<e.length;s++){l[s]="",i=!0;for(var o=0;o<=6;o++)a=i?"":", ",t=e[s][o],_.isNull(t)||_.isUndefined(t)||(l[s]=l[s]+a+t,i=!1)}var r=[];if(_.isArray(l))for(s=0;s<l.length;s++)r[s]={word:l[s]};return r},this.initTypeahead=function(){var e="";_.isUndefined(modelsParameters[a].countryIsoCodes)||(e="&country="+modelsParameters[a].countryIsoCodes),$("#ac-value"+t).typeahead("destroy"),$("#ac-value"+t).typeahead(null,{name:"suggestions",displayKey:"word",source:function(t,a){$.ajax({url:"https://xdashgateway.azure-api.net/autocomplete/suggest.json?query="+t+"&language=fr"+e,method:"GET",dataType:"json",success:function(e){var t=l.formatHereSuggestTable(e),i=l.formatSuggestWords(t);_.isUndefined(i)||a($.map(i,(function(e){return e})))}})}})},this.rescale=function(){this.render()},this.render=function(){let i=Math.min($("#"+e).height(),$("#"+e).width()/2);const s=document.createElement("div");s.setAttribute("id","ac-value-widget-html"+t),s.setAttribute("class","ac-value-widget-html");let o="";if(modelsParameters[a].displayLabel){let l="";if(i=Math.min($("#"+e).height(),$("#"+e).width()/4),_.isUndefined(modelsParameters[a].valueWidthProportion))l="max-width: 45%; ";else{l="width: "+(Math.max(0,100-parseFloat(modelsParameters[a].valueWidthProportion))+"%")+"; "}const s=this.getTransformedText("label");o+='<span id ="ac-value-span'+t+'" class="ac-value-span" style="'+this.labelFontSize()+this.labelColor()+this.labelFontFamily()+l+'">'+s+"</span>"}const r=this.border();o+='<div id="ac-value-no-input-group">',o+='<input id="ac-value'+t+'" type="text" placeholder="Type an address" autocomplete="off" spellcheck="false" class="value-input form-control" style="height: '+i+"px; "+r+"; float: right; "+this.valueFontSize()+this.valueColor()+this.valueFontFamily()+this.backgroundColor()+'text-align: left;">',o+="</input>",o+="</div>",s.innerHTML=o,this.bIsInteractive?s.setAttribute("style","height: "+i+"px; cursor: text;"):s.setAttribute("style","height: "+i+"px;"),$("#"+e).html(s),$("#ac-value"+t)[0].value=modelsHiddenParams[a].value,this.bIsInteractive?l.enable():l.disable()};const s=new WidgetActuatorDescription("value","Current value",WidgetActuatorDescription.READ_WRITE,WidgetPrototypesManager.SCHEMA_STRING);this.getActuatorDescriptions=function(){return[s]},this.value={updateCallback:function(){},setValue:function(e){modelsHiddenParams[a].value=e,$("#ac-value"+t)[0].value=modelsHiddenParams[a].value},getValue:function(){return modelsHiddenParams[a].value},addValueChangedHandler:function(e){this.updateCallback=e,l.enable()},removeValueChangedHandler:function(e){l.disable()},setCaption:function(e,i){modelsParameters[a].inheritLabelFromData&&(l.captionHelper(e,l.bIsInteractive,i),$("#ac-value-span"+t).text(modelsParameters[a].label))},clearCaption:function(){modelsParameters[a].inheritLabelFromData&&(modelsParameters[a].label=""),l.render()}},l.render()},this.hereAutocompleteValueFlatUiWidget.prototype=baseWidget.prototype,this.pluginDefinition={name:"flatUiAddressCompletion",widgetsDefinitionList:{flatUiHereAutocompleteValue:{factory:"hereAutocompleteValueFlatUiWidget",title:"Address auto-completion",iconWidth:70,icn:"address-autocompletion",help:"wdg/wdg-geo-time/#address-autocompletion"}}},this.constructor()}modelsHiddenParams.flatUiHereAutocompleteValue={value:""},modelsParameters.flatUiHereAutocompleteValue={label:"labelText",inheritLabelFromData:!0,displayLabel:!0,labelFontSize:.5,labelColor:"var(--widget-label-color)",labelFontFamily:"var(--widget-font-family)",valueWidthProportion:"70%",valueFontSize:.5,valueColor:"var(--widget-color)",valueFontFamily:"var(--widget-font-family)",displayBorder:!0,borderColor:"var(--widget-border-color)",backgroundColor:"var(--widget-input-color)",countryIsoCodes:"FRA"},modelsLayout.flatUiHereAutocompleteValue={height:"5vh",width:"19vw",minWidth:"150px",minHeight:"32px"},flatUiAddressCompletionWidgetsPluginClass.prototype=basePlugin.prototype;var flatUiAddressCompletionWidgetsPlugin=new flatUiAddressCompletionWidgetsPluginClass;widgetsPluginsHandler.loadWidgetPlugin(flatUiAddressCompletionWidgetsPlugin);
function flatUiWidgetsPluginClass(){const e=this;!function(e){e.fn.addSliderSegments=function(){return this.each((function(){var t=e(this),a=t.slider("option"),i=(a.max-a.min)/a.step;if("vertical"===a.orientation){for(var l="",r=1;r<=i-1;r++)l+='<div class="ui-slider-segment" style="top:'+100/i*r+'%;"></div>';t.prepend(l)}else{var o='<div class="ui-slider-segment" style="margin-left: '+(100/i+"%")+';"></div>';t.prepend(o.repeat(i-1))}}))}}(jQuery),this.buttonFlatUiWidget=function(e,t,a,i){this.constructor(e,t,a,i);const l=this;this.numberOfTriggers=modelsParameters[a].numberOfTriggers,this.enable=function(){},this.disable=function(){},this.readFileEvt=function(){const e=$("#button"+t+"_select_file");e.on("change",(function(e){const t=new FileReader,i=e.target.files[0],r=i.size;let o="";o=r<1024?`${r} bytes`:r<1048576?`${(r/1024).toFixed(1)} KB`:`${(r/1048576).toFixed(1)} MB`;const n={type:i.type,size:o,name:i.name};t.addEventListener("load",(function(e){const t=e.target.result;t instanceof ArrayBuffer?(n.content=btoa([].reduce.call(new Uint8Array(t),(function(e,t){return e+String.fromCharCode(t)}),"")),n.isBinary=!0):(n.content=t,n.isBinary=!1),l.notifyNewValue(n)})),modelsParameters[a].binaryFileInput?t.readAsArrayBuffer(i):t.readAsText(i)})),$("#button"+t).mousedown((function(t){t.preventDefault(),e.trigger("click")}))},this.notifyNewValue=function(e){this.fileContent=e;for(let e=1;e<=this.numberOfTriggers;e++){const t=this[`trigger${e}`];t.updateCallback(t)}},this.rescale=function(){this.render()},this.render=function(){const i=document.createElement("div");i.setAttribute("id","button-widget-html"+t),i.setAttribute("class","button-widget-html");const r=Math.min($("#"+e).height(),$("#"+e).width()/2);let o=.5;_.isUndefined(modelsParameters[a].buttonFontSize)||(o=modelsParameters[a].buttonFontSize);const n='style="height: inherit; font-size: calc(7px + '+o*getFontFactor()+"vw + 0.4vh); "+this.buttonFontFamily()+'" class="btn btn-table-cell btn-lg '+a+"widgetCustomColor";this.setButtonColorStyle();let s="";const d=this.getTransformedText("text");let u=d;if(this.displayIcon()){u='<i class="'+this.fontAwesomeIcon()+'"></i>'+" "+d}if(this.bIsInteractive){if(modelsParameters[a].fileInput||modelsParameters[a].binaryFileInput){s+="<a "+n+'" id="button'+t+'">'+u+("<input onclick=\"displaySpinnerOnInputFileButton('"+t+'\')" type="file" style="display : none;" id="button'+t+'_select_file"></input>')+"</a>"}else s+="<a onclick=\"updateDataNodeFromWidgetwithspinButton( '"+a+"', '"+t+"')\" "+n+'" id="button'+t+'">'+u+"</a>";l.enable()}else s+="<a "+n+' /*disabled*/" id="button'+t+'">'+u+"</a>",l.disable();i.innerHTML=s,i.setAttribute("style","height: "+r+"px;"),$("#"+e).html(i),(modelsParameters[a].fileInput||modelsParameters[a].binaryFileInput)&&l.readFileEvt()},this.getActuatorDescriptions=function(e=null){const t=e||modelsParameters[a],i=[];if(t&&t.numberOfTriggers){const e=t.fileInput||t.binaryFileInput;for(let a=1;a<=t.numberOfTriggers;a++){const t="trigger"+a;e?i.push(new WidgetActuatorDescription(t,"File content",WidgetActuatorDescription.WRITE)):i.push(new WidgetActuatorDescription(t,"Node to trigger/re-evaluate",WidgetActuatorDescription.TRIGGER,WidgetPrototypesManager.SCHEMA_ANYTHING))}}return i};for(let e=1;e<=this.numberOfTriggers;e++){this["trigger"+e]={setValue:function(e){},getValue:function(){return l.fileContent},updateCallback:function(){},addValueChangedHandler:function(e){this.updateCallback=e,l.enable()},removeValueChangedHandler:function(e){l.disable()}}}l.render()},this.buttonFlatUiWidget.prototype=baseWidget.prototype,this.horizontalSliderFlatUiWidget=function(e,t,a,i){this.constructor(e,t,a,i);var l=this;l.updateValue=function(e){var i=Number($("#hslider-value"+t)[0].value);$("#slider"+t).slider({value:i}),modelsHiddenParams[a].value=i,l.value.updateCallback(l.value,l.value.getValue()),e.preventDefault()},this.enable=function(){$("#slider"+t).on("slidestop",(function(e,t){l.value.setValue(t.value),l.value.updateCallback(l.value,t)})),$("#slider"+t).on("slide",(function(e,t){l.value.setValue(t.value)})),$("#slider"+t).slider("enable"),modelsParameters[a].validationOnFocusOut&&$("#hslider-value"+t).on("focusout",(function(e,t){l.updateValue(e)})),modelsParameters[a].displayValue&&($("#hslider-value"+t).prop("disabled",!1),$("#hslider-value"+t).on("keypress",(function(e,t){13==e.which&&l.updateValue(e)})))},this.disable=function(){$("#slider"+t).on("slide",(function(e,t){})),$("#slider"+t).on("slidestop",(function(e,t){})),$("#slider"+t).slider("disable"),modelsParameters[a].displayValue&&$("#hslider-value"+t).prop("disabled",!0)},this.insertLabel=function(e){const t=this.getTransformedText("label"),i=document.createElement("span");i.setAttribute("class","label-h-slider"),i.setAttribute("id","h-slider-span"),_.isUndefined(modelsParameters[a].labelWidthProportion)?i.setAttribute("style","width: 20%; "+this.labelFontSize()+this.labelColor()+this.labelFontFamily()):i.setAttribute("style","width:"+modelsParameters[a].labelWidthProportion+"; "+this.labelFontSize()+this.labelColor()+this.labelFontFamily()),i.innerHTML=t,e.appendChild(i)},this.insertValue=function(i){var l;l=modelsParameters[a].displayLabel?Math.min($("#"+e).height(),$("#"+e).width()/6):Math.min($("#"+e).height(),$("#"+e).width()/8);var r=document.createElement("div");r.setAttribute("class","h-slider-value-div"),r.setAttribute("id","div-for-hslider-value"+t),_.isUndefined(modelsParameters[a].valueWidthProportion)?r.setAttribute("style","width:30%;"):r.setAttribute("style","width:"+modelsParameters[a].valueWidthProportion+";");var o="";o=this.bIsInteractive?"cursor: text;":"cursor: inherit;";var n='<input id="hslider-value'+t+'" type="text" placeholder="" class="hslider-input form-control" style="height: '+l+"px; "+this.valueFontSize()+this.valueColor()+this.valueFontFamily()+o+'" disabled></input>';r.innerHTML=n,i.appendChild(r)},this.rescale=function(){this.render()},this.render=function(){var i=document.createElement("div");i.setAttribute("class","sliderInput"),i.setAttribute("style","display: table");var r=document.createElement("div");r.setAttribute("id","h-slider-div"),_.isUndefined(modelsParameters[a].sliderWidthProportion)?r.setAttribute("style","width:50%;"):r.setAttribute("style","width:"+modelsParameters[a].sliderWidthProportion+";");var o=document.createElement("div");if(o.setAttribute("id","slider"+t),r.appendChild(o),modelsParameters[a].displayLabel&&this.insertLabel(i),i.appendChild(r),modelsParameters[a].displayValue&&this.insertValue(i),""!=modelsParameters[a].unit&&modelsParameters[a].displayUnit){const e=document.createElement("span");e.setAttribute("class","value-span"),e.setAttribute("style","max-width: 45%; font-size: calc(7px + "+modelsParameters[a].unitFontSize*getFontFactor()+"vw + 0.4vh);"),e.setAttribute("id","unit-span"+t),e.innerHTML=modelsParameters[a].unit,i.appendChild(e)}$("#"+e).html(i);var n=$("#slider"+t);n.length>0&&n.slider({min:modelsParameters[a].min,max:modelsParameters[a].max,step:modelsParameters[a].step,value:modelsHiddenParams[a].value,orientation:"horizontal",range:"min"}).addSliderSegments(),$("#slider"+t).addClass("h-slider-div-div"),document.styleSheets[0].addRule("#slider"+t,this.sliderSegmentColor()),document.styleSheets[0].addRule("#slider"+t+" > .ui-slider-range",this.sliderRangeColor()),document.styleSheets[0].addRule("#slider"+t+" > .ui-slider-handle",this.sliderHandleDefaultColor()),document.styleSheets[0].addRule("#slider"+t+" > .ui-slider-handle:hover",this.sliderHandleHoverColor()),document.styleSheets[0].addRule("#slider"+t+" > .ui-slider-handle:active",this.sliderHandleActiveColor()),document.styleSheets[0].addRule("#hslider-value"+t,this.valueBorderColor()),this.bIsInteractive?l.enable():l.disable(),modelsParameters[a].displayValue&&(modelsParameters[a].min>modelsHiddenParams[a].value?$("#hslider-value"+t)[0].value=modelsParameters[a].min:$("#hslider-value"+t)[0].value=modelsHiddenParams[a].value)};const r=new WidgetActuatorDescription("value","Current value",WidgetActuatorDescription.READ_WRITE,WidgetPrototypesManager.SCHEMA_NUMBER),o=new WidgetActuatorDescription("min","Value lower bound",WidgetActuatorDescription.READ,WidgetPrototypesManager.SCHEMA_NUMBER),n=new WidgetActuatorDescription("max","Value upper bound",WidgetActuatorDescription.READ,WidgetPrototypesManager.SCHEMA_NUMBER);this.getActuatorDescriptions=function(e=null){const t=e||modelsParameters[a],i=[r];return t&&t.rangeActuator&&(i.push(o),i.push(n)),i},this.value={updateCallback:function(){},setValue:function(e){modelsHiddenParams[a].value=e,$("#slider"+t).slider({value:e}),modelsParameters[a].displayValue&&($("#hslider-value"+t)[0].value=e)},getValue:function(){return modelsHiddenParams[a].value},addValueChangedHandler:function(e){this.updateCallback=e,l.enable()},removeValueChangedHandler:function(e){l.disable()},setCaption:function(e,t){modelsParameters[a].inheritLabelFromData&&(l.captionHelper(e,l.bIsInteractive,t),l.render())},clearCaption:function(){modelsParameters[a].inheritLabelFromData&&(modelsParameters[a].label=""),l.render()}},this.max={updateCallback:function(){},setValue:function(e){const t=Number(e);modelsParameters[a].max=t,l.render()},getValue:function(){return modelsParameters[a].max},addValueChangedHandler:function(e){this.updateCallback=e,l.enable()},removeValueChangedHandler:function(e){l.disable()}},this.min={updateCallback:function(){},setValue:function(e){const t=Number(e);modelsParameters[a].min=t,l.render()},getValue:function(){return modelsParameters[a].min},addValueChangedHandler:function(e){this.updateCallback=e,l.enable()},removeValueChangedHandler:function(e){l.disable()}},l.render()},this.horizontalSliderFlatUiWidget.prototype=baseWidget.prototype,this.verticalSliderFlatUiWidget=function(e,t,a,i){this.constructor(e,t,a,i);var l=this;this.enable=function(e){$("#vertical-slider"+t).on("slidestop",(function(e,t){l.value.setValue(t.value),l.value.updateCallback(l.value,t)})),$("#vertical-slider"+t).on("slide",(function(e,t){l.value.setValue(t.value)})),$("#vertical-slider"+t).slider("enable")},this.disable=function(){$("#vertical-slider"+t).on("slidestop",(function(e,t){})),$("#vertical-slider"+t).on("slide",(function(e,t){})),$("#vertical-slider"+t).slider("disable")},this.insertLabel=function(e){const t=this.getTransformedText("label"),a=document.createElement("div");a.setAttribute("class","v-slider-div");const i=document.createElement("span");i.setAttribute("class","v-slider-span label-v-slider"),i.setAttribute("style",this.labelFontSize()+this.labelColor()+this.labelFontFamily()),i.innerHTML=t,a.appendChild(i),e.appendChild(a)},this.rescale=function(){this.render()},this.render=function(){var i=document.createElement("div");i.setAttribute("class","sliderInput");var r=document.createElement("div");r.setAttribute("id","vertical-slider"+t),r.setAttribute("class","v-slider-div-div"),r.setAttribute("style","height: calc(100% - 24px);"),i.appendChild(r),modelsParameters[a].displayLabel&&""!=modelsParameters[a].label&&(r.setAttribute("style","height: 80%;"),this.insertLabel(i)),$("#"+e).html(i);var o=$("#vertical-slider"+t);o.length>0&&o.slider({min:modelsParameters[a].min,max:modelsParameters[a].max,step:modelsParameters[a].step,value:modelsHiddenParams[a].value,orientation:"vertical",range:"min"}).addSliderSegments(o.slider("option").max,"vertical"),document.styleSheets[0].addRule("#vertical-slider"+t,this.sliderSegmentColor()),document.styleSheets[0].addRule("#vertical-slider"+t+" > .ui-slider-range",this.sliderRangeColor()),document.styleSheets[0].addRule("#vertical-slider"+t+" > .ui-slider-handle",this.sliderHandleDefaultColor()),document.styleSheets[0].addRule("#vertical-slider"+t+" > .ui-slider-handle:hover",this.sliderHandleHoverColor()),document.styleSheets[0].addRule("#vertical-slider"+t+" > .ui-slider-handle:active",this.sliderHandleActiveColor()),this.bIsInteractive?l.enable():l.disable()};const r=new WidgetActuatorDescription("value","Current value",WidgetActuatorDescription.READ_WRITE,WidgetPrototypesManager.SCHEMA_NUMBER),o=new WidgetActuatorDescription("min","Value lower bound",WidgetActuatorDescription.READ,WidgetPrototypesManager.SCHEMA_NUMBER),n=new WidgetActuatorDescription("max","Value upper bound",WidgetActuatorDescription.READ,WidgetPrototypesManager.SCHEMA_NUMBER);this.getActuatorDescriptions=function(e=null){const t=e||modelsParameters[a],i=[r];return t&&t.rangeActuator&&(i.push(o),i.push(n)),i},this.value={updateCallback:function(){},setValue:function(e){modelsHiddenParams[a].value=e,$("#vertical-slider"+t).slider({value:e})},getValue:function(){return modelsHiddenParams[a].value},addValueChangedHandler:function(e){this.updateCallback=e,l.enable()},removeValueChangedHandler:function(e){l.disable()},setCaption:function(e,t){modelsParameters[a].inheritLabelFromData&&(l.captionHelper(e,l.bIsInteractive,t),l.render())},clearCaption:function(){modelsParameters[a].inheritLabelFromData&&(modelsParameters[a].label=""),l.render()}},this.max={updateCallback:function(){},setValue:function(e){const t=Number(e);modelsParameters[a].max=t},getValue:function(){return modelsParameters[a].max},addValueChangedHandler:function(e){this.updateCallback=e,l.enable()},removeValueChangedHandler:function(e){l.disable()}},this.min={updateCallback:function(){},setValue:function(e){const t=Number(e);modelsParameters[a].min=t},getValue:function(){return modelsParameters[a].min},addValueChangedHandler:function(e){this.updateCallback=e,l.enable()},removeValueChangedHandler:function(e){l.disable()}},l.render()},this.verticalSliderFlatUiWidget.prototype=baseWidget.prototype,this.progressBarFlatUiWidget=function(e,t,a,i){this.constructor(e,t,a,i);var l=this;this.enable=function(){modelsParameters[a].displayValue&&$("#progress-bar-value"+t).prop("disabled",!1)},this.disable=function(){modelsParameters[a].displayValue&&$("#progress-bar-value"+t).prop("disabled",!0)},this.insertLabel=function(e){const t=this.getTransformedText("label"),i=document.createElement("span");i.setAttribute("class","label-progress-bar"),i.setAttribute("id","progress-bar-span"),_.isUndefined(modelsParameters[a].labelWidthProportion)?i.setAttribute("style","width: 20%; "+this.labelFontSize()+this.labelColor()+this.labelFontFamily()):i.setAttribute("style","width:"+modelsParameters[a].labelWidthProportion+"; "+this.labelFontSize()+this.labelColor()+this.labelFontFamily()),i.innerHTML=t,e.appendChild(i)},this.insertValue=function(i){var l;l=modelsParameters[a].displayLabel?Math.min($("#"+e).height(),$("#"+e).width()/6):Math.min($("#"+e).height(),$("#"+e).width()/8);var r=document.createElement("div");r.setAttribute("class","progress-bar-value-div"),r.setAttribute("id","div-for-progress-bar-value"+t),_.isUndefined(modelsParameters[a].valueWidthProportion)?r.setAttribute("style","width:30%;"):r.setAttribute("style","width:"+modelsParameters[a].valueWidthProportion+";");var o="";o=this.bIsInteractive?"cursor: text;":"cursor: inherit;";var n='<input id="progress-bar-value'+t+'" type="text" placeholder="" class="hslider-input form-control" style="height: '+l+"px; "+this.valueFontSize()+this.valueColor()+this.valueFontFamily()+o+'" disabled></input>';r.innerHTML=n,i.appendChild(r)},this.updateProgressBarWidth=function(){if(!_.isUndefined(modelsHiddenParams[a].value)){var e,i=modelsHiddenParams[a].value,l=$("#progress-bar"+t+" div"),r=modelsParameters[a].min,o=modelsParameters[a].max;e=i<=r?0:Math.ceil((i-r)/(o-r)*100),l.css("width",e+"%")}},this.updateProgressBarValue=function(){modelsParameters[a].displayValue&&(modelsParameters[a].min>modelsHiddenParams[a].value?$("#progress-bar-value"+t)[0].value=modelsParameters[a].min:$("#progress-bar-value"+t)[0].value=modelsHiddenParams[a].value)},this.rescale=function(){this.render()},this.render=function(){var i=document.createElement("div");i.setAttribute("class","progress-bar-widget");var r=document.createElement("div");r.setAttribute("id","progress-bar-div"),_.isUndefined(modelsParameters[a].progressBarWidthProportion)?r.setAttribute("style","width:50%;"):r.setAttribute("style","width:"+modelsParameters[a].progressBarWidthProportion+";");var o=document.createElement("div");o.setAttribute("id","progress-bar"+t),o.setAttribute("class","progress");var n=document.createElement("div");n.setAttribute("class","progress-bar"),n.setAttribute("role","progressbar"),o.appendChild(n),r.appendChild(o),modelsParameters[a].displayLabel&&this.insertLabel(i),i.appendChild(r),modelsParameters[a].displayValue&&this.insertValue(i),$("#"+e).html(i),$("#progress-bar"+t).addClass("progress-bar-div-div"),document.styleSheets[0].addRule("#progress-bar"+t,this.progressBarSegmentColor()),document.styleSheets[0].addRule("#progress-bar"+t+" > .progress-bar",this.progressBarRangeColor()),this.bIsInteractive?l.enable():l.disable(),this.updateProgressBarWidth(),this.updateProgressBarValue()};const r=new WidgetActuatorDescription("value","Current progress",WidgetActuatorDescription.READ,WidgetPrototypesManager.SCHEMA_NUMBER),o=new WidgetActuatorDescription("min","Base progress value",WidgetActuatorDescription.READ,WidgetPrototypesManager.SCHEMA_NUMBER),n=new WidgetActuatorDescription("max","Final progress value",WidgetActuatorDescription.READ,WidgetPrototypesManager.SCHEMA_NUMBER);this.getActuatorDescriptions=function(e=null){const t=e||modelsParameters[a],i=[r];return t&&t.rangeActuator&&(i.push(o),i.push(n)),i},this.value={updateCallback:function(){},setValue:function(e){modelsHiddenParams[a].value=e,modelsParameters[a].displayValue&&($("#progress-bar-value"+t)[0].value=e),l.render()},getValue:function(){return modelsHiddenParams[a].value},addValueChangedHandler:function(e){this.updateCallback=e,l.enable()},removeValueChangedHandler:function(e){l.disable()},setCaption:function(e,t){modelsParameters[a].inheritLabelFromData&&(l.captionHelper(e,l.bIsInteractive,t),l.render())},clearCaption:function(){modelsParameters[a].inheritLabelFromData&&(modelsParameters[a].label=""),l.render()}},this.max={updateCallback:function(){},setValue:function(e){const t=Number(e);modelsParameters[a].max=t,l.render()},getValue:function(){return modelsParameters[a].max},addValueChangedHandler:function(e){this.updateCallback=e,l.enable()},removeValueChangedHandler:function(e){l.disable()}},this.min={updateCallback:function(){},setValue:function(e){const t=Number(e);modelsParameters[a].min=t,l.render()},getValue:function(){return modelsParameters[a].min},addValueChangedHandler:function(e){this.updateCallback=e,l.enable()},removeValueChangedHandler:function(e){l.disable()}},l.render()},this.progressBarFlatUiWidget.prototype=baseWidget.prototype,this.valueFlatUiWidgetModel=function(e,t,a,i,l,r){const o=l;o.updateValue=function(e){const i=$("#"+r+t)[0].value;modelsHiddenParams[a].value=i,o.value.updateCallback(o.value,o.value.getValue()),e.preventDefault()},o.enable=function(){const e=$(`#${r}${t}`);if(e.prop("disabled",!1),e.off("keypress").on("keypress",(function(e){13===e.which&&o.updateValue(e)})),e.off("focusout"),modelsParameters[a].validationOnFocusOut&&e.on("focusout",(e=>o.updateValue(e))),modelsParameters[a].validationButton){const e=$(`#${r}-valid-btn${t}`);e.prop("disabled",!1),e.off("click").on("click",(e=>o.updateValue(e)))}},o.disable=function(){modelsParameters[a].validationButton},o.rescale=function(){this.render()},o.render=function(){let i=Math.min($("#"+e).height(),$("#"+e).width()/2);const l=document.createElement("div");l.setAttribute("id",r+"-widget-html"+t),l.setAttribute("class","value-widget-html");let n="",s="left";if(modelsParameters[a].displayLabel){"left"==modelsParameters[a].labelTextPosition||"right"==modelsParameters[a].labelTextPosition?s="display: table-cell":"top"==modelsParameters[a].labelTextPosition?s="display: table-header-group":"bottom"==modelsParameters[a].labelTextPosition&&(s="display: table-footer-group");const l=this.getTransformedText("label");if(i=Math.min($("#"+e).height(),$("#"+e).width()/4),_.isUndefined(modelsParameters[a].valueWidthProportion))n='<span id ="'+r+"-span"+t+'" class="value-span" style="max-width: 45%;'+ +this.labelFontSize()+this.labelColor()+this.labelFontFamily()+this.valueFontSize()+" text-align:"+modelsParameters[a].labelTextAlign+";"+s+'">'+l+"</span>";else{const e=Math.max(0,100-parseFloat(modelsParameters[a].valueWidthProportion))+"%";n='<span id ="'+r+"-span"+t+'" class="value-span" style="width:'+e+"; "+this.labelFontSize()+this.labelColor()+this.labelFontFamily()+" text-align:"+modelsParameters[a].labelTextAlign+";"+s+'">'+l+"</span>"}}let d,u="disabled ";switch(u="",r){case"text-input":d=modelsParameters[a].isPassword?"password":"text";break;case"numeric-input":d="number";break;case"value-display":d="text"}let c="",m="";"value-display"===r&&(c="readonly ",m="opacity: 1; ");let p="",h="",b="";modelsParameters[a].validationButton?(p='<div class="input-group">',h="border-bottom-right-radius: 0; border-top-right-radius: 0; ",b='<span class="input-group-btn"><button id="'+r+"-valid-btn"+t+'" class="/*ui-value-button*/ btn btn-primary" type="button" style="height:'+i+"px; width:"+i+'px; "><span class="fa fa-check" style="color: #ffffff"/></button></span>'):(p='<div id="value-no-input-group">',h="float: right;");let v="left";_.isUndefined(modelsParameters[a].valueTextAlign)||(v=modelsParameters[a].valueTextAlign),inputContent="<input "+c+' id="'+r+t+'" type='+d+' placeholder="" class="value-input form-control" style="height: '+i+"px; "+m+this.valueColor()+this.backgroundColor()+this.valueFontFamily()+this.border()+this.valueFontSize()+h+" text-align:"+v+';"</input>',inputContent+=b,p+=inputContent,p+="</div>","right"==modelsParameters[a].labelTextPosition?n=p+n:n+=p,"text-input"!=r&&""!=modelsParameters[a].unit&&modelsParameters[a].displayUnit&&(n=n+'<span id ="unit-span'+t+'" class="value-span" style="max-width: 45%; font-size: calc(7px + '+modelsParameters[a].unitFontSize*getFontFactor()+'vw + 0.4vh);">'+modelsParameters[a].unit+"</span>"),l.innerHTML=n,"value-display"!==r&&(document.styleSheets[0].addRule("#"+r+"-valid-btn"+t,this.validationButtonBorderColor()),document.styleSheets[0].addRule("#"+r+"-valid-btn"+t,this.validationButtonDefaultColor()),document.styleSheets[0].addRule("#"+r+"-valid-btn"+t+":hover"," outline: none; "+this.validationButtonHoverColor()),document.styleSheets[0].addRule("#"+r+"-valid-btn"+t+":focus"," outline: none; "),document.styleSheets[0].addRule("#"+r+"-valid-btn"+t+":active",this.validationButtonActiveColor())),this.bIsInteractive?l.setAttribute("style","height: "+i+"px; cursor: auto;"):l.setAttribute("style","height: "+i+"px;"),$("#"+e).html(l),$("#"+r+t)[0].value=modelsHiddenParams[a].value,this.bIsInteractive?o.enable():o.disable()},o.value={updateCallback:function(){},setValue:function(e){modelsHiddenParams[a].value=e,$("#"+r+t)[0].value=e},getValue:function(){switch(r){case"value-display":return modelsParameters[a].isNumber?Number(modelsHiddenParams[a].value):modelsHiddenParams[a].value;case"text-input":return modelsHiddenParams[a].value;case"numeric-input":return Number(modelsHiddenParams[a].value)}},addValueChangedHandler:function(e){this.updateCallback=e,o.enable()},removeValueChangedHandler:function(e){o.disable()},setCaption:function(e,i){modelsParameters[a].inheritLabelFromData&&(o.captionHelper(e,o.bIsInteractive,i),$("#"+r+"-span"+t).text(modelsParameters[a].label))},clearCaption:function(){modelsParameters[a].inheritLabelFromData&&(modelsParameters[a].label=""),o.render()}},o.render()},this.textInputFlatUiWidget=function(t,a,i,l){this.constructor(t,a,i,l),e.valueFlatUiWidgetModel(t,a,i,l,this,"text-input");const r=new WidgetActuatorDescription("value","Current string",WidgetActuatorDescription.READ_WRITE,WidgetPrototypesManager.SCHEMA_STRING);this.getActuatorDescriptions=()=>[r]},this.textInputFlatUiWidget.prototype=baseWidget.prototype,this.numericInputFlatUiWidget=function(t,a,i,l){this.constructor(t,a,i,l),e.valueFlatUiWidgetModel(t,a,i,l,this,"numeric-input");const r=new WidgetActuatorDescription("value","Current number",WidgetActuatorDescription.READ_WRITE,WidgetPrototypesManager.SCHEMA_NUMBER);this.getActuatorDescriptions=()=>[r]},this.numericInputFlatUiWidget.prototype=baseWidget.prototype,this.valueDisplayFlatUiWidget=function(t,a,i,l){this.constructor(t,a,i,l),e.valueFlatUiWidgetModel(t,a,i,l,this,"value-display");const r=new WidgetActuatorDescription("value","Displayed value",WidgetActuatorDescription.READ,WidgetPrototypesManager.SCHEMA_NUMBER_OR_STRING);this.getActuatorDescriptions=()=>[r]},this.valueDisplayFlatUiWidget.prototype=baseWidget.prototype,this.pluginDefinition={name:"flatUi",widgetsDefinitionList:{flatUiHorizontalSlider:{factory:"horizontalSliderFlatUiWidget",title:"Horizontal slider",icn:"horizontal-slider",help:"wdg-basics/#horizontal-slider"},flatUiVerticalSlider:{factory:"verticalSliderFlatUiWidget",title:"Vertical slider",icn:"vertical-slider",help:"wdg/wdg-basics/#vertical-slider"},flatUiProgressBar:{factory:"progressBarFlatUiWidget",title:"Progress bar",icn:"progress-bar",help:"wdg-basics/#progress-bar"},flatUiTextInput:{factory:"textInputFlatUiWidget",title:"Text Input",icn:"text-input",help:"wdg/wdg-basics/#text-input"},flatUiNumericInput:{factory:"numericInputFlatUiWidget",title:"Numeric Input",icn:"numeric-input",help:"wdg/wdg-basics/#numeric-input"},flatUiValueDisplay:{factory:"valueDisplayFlatUiWidget",title:"Value Display",icn:"value",help:"wdg/wdg-basics/#value-display"},flatUiButton:{factory:"buttonFlatUiWidget",title:"Trigger button",icn:"trigger",help:"wdg/wdg-basics/#push-button"},flatUiFileInputButton:{factory:"buttonFlatUiWidget",title:"Load file button",icn:"button",help:"wdg/wdg-basics/#push-button"}}},this.constructor()}String.prototype.repeat=function(e){return new Array(Math.round(e)+1).join(this)},modelsHiddenParams.flatUiHorizontalSlider={value:0},modelsHiddenParams.flatUiVerticalSlider={value:0},modelsHiddenParams.flatUiProgressBar={value:0},modelsHiddenParams.flatUiTextInput={value:""},modelsHiddenParams.flatUiNumericInput={value:""},modelsHiddenParams.flatUiValueDisplay={value:""},modelsParameters.flatUiHorizontalSlider={label:"labelText",inheritLabelFromData:!0,displayLabel:!0,labelFontSize:.5,labelColor:"var(--widget-label-color)",labelFontFamily:"var(--widget-font-family)",rangeActuator:!1,min:0,max:100,step:1,displayValue:!0,validationOnFocusOut:!0,valueFontSize:.5,valueFontFamily:"var(--widget-font-family)",valueBorderColor:"var(--widget-border-color)",labelWidthProportion:"20%",sliderWidthProportion:"60%",valueWidthProportion:"20%",sliderRangeColor:"var(--widget-range-color)",sliderSegmentColor:"var(--widget-segment-color)",sliderHandleDefaultColor:"var(--widget-handle-default-color)",sliderHandleHoverColor:"var(--widget-handle-hover-color)",sliderHandleActiveColor:"var(--widget-handle-active-color)",valueColor:"var(--widget-color)",unit:"unitText",displayUnit:!1,unitFontSize:.5},modelsParameters.flatUiVerticalSlider={label:"labelText",inheritLabelFromData:!0,displayLabel:!0,labelFontSize:.5,labelColor:"var(--widget-label-color)",labelFontFamily:"var(--widget-font-family)",rangeActuator:!1,min:0,max:100,step:1,sliderRangeColor:"var(--widget-range-color)",sliderSegmentColor:"var(--widget-segment-color)",sliderHandleDefaultColor:"var(--widget-handle-default-color)",sliderHandleHoverColor:"var(--widget-handle-hover-color)",sliderHandleActiveColor:"var(--widget-handle-active-color)"},modelsParameters.flatUiProgressBar={label:"labelText",inheritLabelFromData:!0,displayLabel:!0,labelFontSize:.5,labelColor:"var(--widget-label-color)",labelFontFamily:"var(--widget-font-family)",rangeActuator:!1,min:0,max:100,displayValue:!1,valueFontSize:.5,valueFontFamily:"var(--widget-font-family)",labelWidthProportion:"20%",progressBarWidthProportion:"60%",valueWidthProportion:"20%",progressBarRangeColor:"var(--widget-range-color)",progressBarSegmentColor:"var(--widget-segment-color)",valueColor:"var(--widget-color)"},modelsParameters.flatUiTextInput={label:"labelText",inheritLabelFromData:!0,displayLabel:!0,labelFontSize:.5,labelColor:"var(--widget-label-color)",labelFontFamily:"var(--widget-font-family)",labelTextAlign:"left",labelTextPosition:"left",valueWidthProportion:"70%",validationButton:!1,validationBtnDefaultColor:"var(--widget-button-primary-color)",validationBtnActiveColor:"var(--widget-button-active-color)",validationBtnHoverColor:"var(--widget-button-hover-color)",validationOnFocusOut:!0,isPassword:!1,valueFontSize:.5,valueColor:"var(--widget-input-text)",valueFontFamily:"var(--widget-font-family)",valueTextAlign:"left",displayBorder:!0,borderColor:"var(--widget-border-color)",backgroundColor:"var(--widget-input-color)"},modelsParameters.flatUiNumericInput={label:"labelText",inheritLabelFromData:!0,displayLabel:!0,labelFontSize:.5,labelColor:"var(--widget-label-color)",labelFontFamily:"var(--widget-font-family)",labelTextAlign:"left",labelTextPosition:"left",valueWidthProportion:"70%",validationButton:!1,validationBtnDefaultColor:"var(--widget-button-primary-color)",validationBtnActiveColor:"var(--widget-button-active-color)",validationBtnHoverColor:"var(--widget-button-hover-color)",validationOnFocusOut:!0,valueFontSize:.5,valueColor:"var(--widget-input-text)",valueFontFamily:"var(--widget-font-family)",valueTextAlign:"left",displayBorder:!0,borderColor:"var(--widget-border-color)",backgroundColor:"var(--widget-input-color)",unit:"unitText",displayUnit:!1,unitFontSize:.5},modelsParameters.flatUiValueDisplay={label:"labelText",inheritLabelFromData:!0,displayLabel:!0,labelFontSize:.5,labelColor:"var(--widget-label-color)",labelFontFamily:"var(--widget-font-family)",labelTextAlign:"left",valueWidthProportion:"70%",valueFontSize:.5,valueColor:"var(--widget-input-text)",valueFontFamily:"var(--widget-font-family)",valueTextAlign:"left",displayBorder:!0,borderColor:"var(--widget-border-color)",backgroundColor:"var(--widget-input-color)",unit:"unitText",displayUnit:!1,unitFontSize:.5},modelsParameters.flatUiButton={text:"Push button",numberOfTriggers:1,fileInput:!1,binaryFileInput:!1,buttonFontSize:.3,displayIcon:!1,fontAwesomeIcon:"",buttonFontFamily:"var(--widget-font-family)",buttonTextColor:"var(--widget-button-primary-text)",buttonDefaultColor:"var(--widget-button-primary-color)",buttonActiveColor:"var(--widget-button-active-color)",buttonHoverColor:"var(--widget-button-hover-color)"},modelsParameters.flatUiFileInputButton={text:"File load button",numberOfTriggers:1,fileInput:!0,binaryFileInput:!1,buttonFontSize:.3,displayIcon:!1,fontAwesomeIcon:"",buttonFontFamily:"var(--widget-font-family)",buttonTextColor:"var(--widget-button-primary-text)",buttonDefaultColor:"var(--widget-button-primary-color)",buttonActiveColor:"var(--widget-button-active-color)",buttonHoverColor:"var(--widget-button-hover-color)"},modelsLayout.flatUiHorizontalSlider={height:"5vh",width:"24vw",minWidth:"200px",minHeight:"24px"},modelsLayout.flatUiVerticalSlider={height:"20vh",width:"5vw",minWidth:"32px",minHeight:"50px"},modelsLayout.flatUiProgressBar={height:"5vh",width:"24vw",minWidth:"200px",minHeight:"24px"},modelsLayout.flatUiTextInput={height:"5vh",width:"19vw",minWidth:"150px",minHeight:"24px"},modelsLayout.flatUiNumericInput={height:"5vh",width:"19vw",minWidth:"150px",minHeight:"24px"},modelsLayout.flatUiValueDisplay={height:"5vh",width:"19vw",minWidth:"150px",minHeight:"24px"},modelsLayout.flatUiButton={height:"7vh",width:"9vw",minWidth:"55px",minHeight:"24px"},modelsLayout.flatUiFileInputButton={height:"7vh",width:"9vw",minWidth:"55px",minHeight:"24px"},flatUiWidgetsPluginClass.prototype=basePlugin.prototype;var flatUiWidgetsPlugin=new flatUiWidgetsPluginClass;widgetsPluginsHandler.loadWidgetPlugin(flatUiWidgetsPlugin);
function saveToFileButtonWidgetsPluginClass(){this.buttonSaveToFileWidget=function(t,e,i,o){this.constructor(t,e,i,o);var n=this;this.enable=function(){},this.disable=function(){},this.saveFile=function(){const t=modelsParameters[i].fileName;let e=modelsHiddenParams[i].value;if(!e)return;e="data:text/plain;charset=utf-8,"+e;const o=encodeURI(e),n=document.createElement("a");n.setAttribute("href",o),n.setAttribute("download",t),n.click()},this.rescale=function(){this.render()},this.render=function(){var o=document.createElement("div");o.setAttribute("id","button-save-to-file-widget-html"+e),o.setAttribute("class","button-widget-html");var a=Math.min($("#"+t).height(),$("#"+t).width()/2),l=.5;_.isUndefined(modelsParameters[i].buttonFontSize)||(l=modelsParameters[i].buttonFontSize);var s='style="text-align: center; vertical-align: middle;font-size: calc(7px + '+l*getFontFactor()+"vw + 0.4vh); height: "+a+"px; display:table-cell; "+this.buttonFontFamily()+'" class="btn btn-block btn-lg '+i+"widgetCustomColor";this.setButtonColorStyle();const r=this.getTransformedText("text");var u;u="<a "+s+'" id="button-save-to-file'+e+'">  '+r+"  </a>",o.innerHTML=u,o.setAttribute("style","height: "+a+"px;"),$("#"+t).html(o),$("#button-save-to-file"+e).on("click",(function(){n.saveFile()}))};const a=new WidgetActuatorDescription("value","File content",WidgetActuatorDescription.READ,WidgetPrototypesManager.SCHEMA_STRING);this.getActuatorDescriptions=function(){return[a]},this.value={updateCallback:function(){},setValue:function(t){modelsHiddenParams[i].value=t},getValue:function(){return modelsHiddenParams[i].value},addValueChangedHandler:function(t){this.updateCallback=t,n.enable()},removeValueChangedHandler:function(t){n.disable()}},n.render()},this.buttonSaveToFileWidget.prototype=baseWidget.prototype,this.pluginDefinition={name:"saveToFileButton",widgetsDefinitionList:{saveToFileButton:{factory:"buttonSaveToFileWidget",title:"Save to file button",icn:"export-to-file",help:"wdg/wdg-basics/#save-to-file-button"}}},this.constructor()}modelsHiddenParams.saveToFileButton={value:""},modelsParameters.saveToFileButton={text:"Save to file",fileName:"export.txt",buttonFontSize:.3,buttonFontFamily:"var(--widget-font-family)",buttonTextColor:"var(--widget-button-primary-text)",buttonDefaultColor:"var(--widget-button-primary-color)",buttonActiveColor:"var(--widget-button-active-color)",buttonHoverColor:"var(--widget-button-hover-color)"},modelsLayout.saveToFileButton={height:"6vh",width:"8vw",minWidth:"55px",minHeight:"24px"},saveToFileButtonWidgetsPluginClass.prototype=basePlugin.prototype;var saveToFileButtonWidgetsPlugin=new saveToFileButtonWidgetsPluginClass;widgetsPluginsHandler.loadWidgetPlugin(saveToFileButtonWidgetsPlugin);
function loadFileWidgetsPluginClass(){this.loadFileWidget=function(e,t,o,l){this.constructor(e,t,o,l);const i=this;function a(e,t){const o="Error reading "+e.name+": "+t,l=new PNotify({title:"Loading file",text:o,type:"error",styling:"bootstrap3"});$(".ui-pnotify-container").on("click",(()=>l.remove())),console.error(o)}this.enable=function(){},this.disable=function(){},this.updateValue=function(e){},this.readFile=function(e){if(e.size>104857600)return void a(e,"Unable to load file due to large size over 100MB");const t={type:e.type,size:e.size,name:e.name,content:""},l=new FileReader;l.addEventListener("error",(function(t){i.removeSpinner(),l.abort(),a(e,t.error)})),l.addEventListener("load",(function(e){i.removeSpinner();const o=e.target.result;o instanceof ArrayBuffer?(t.content=base64ArrayBuffer(o),t.isBinary=!0):(t.content=o,t.isBinary=!1),i.notifyNewValue(t)})),this.addSpinner(),modelsParameters[o].binaryFileInput?l.readAsArrayBuffer(e):l.readAsText(e)},this.notifyNewValue=function(e){modelsTempParams[o].outputFile=e,i.outputFile.updateCallback(i.outputFile),i.updateFileDisplay()},this.rescale=function(){this.render()},this.updateFileDisplay=function(){const e=modelsTempParams[o].outputFile;if(e&&e.content&&"string"==typeof e.content){const o=e.name??"",l=e.isBinary?b64StrSize(e.content):e.content.length,a=formatFileSize(l);$("#file-content"+t).length?($("#file-name-"+t).text(o),$("#file-size-"+t).text(a)):i.addFileDiv(o,a)}},this.addFileDiv=function(e,l){if($("#loaded-file"+t).length)return;let a='<div id="loaded-file'+t+'" class="loaded-file">';a+='<div class="loaded-file__icon-wrapper">',a+='<i class="fa fa-file" aria-hidden="true"></i>',a+="</div>",a+='<div class="loaded-file__info-file-wrapper">',a+='<span id="file-name-'+t+'" title="'+e+'" class="loaded-file__info-file-wrapper__name" style="'+this.labelFontFamily()+this.textSize()+this.textColor()+'">'+e+"</span>",a+='<span id="file-size-'+t+'" title="'+l+'" class="loaded-file__info-file-wrapper__size" style="'+this.labelFontFamily()+this.textSize()+this.subTextColor()+'">'+l+"</span>",a+="</div>",a+='<div id="close-file-btn'+t+'" class="loaded-file__close-btn-wrapper">',a+='<i class="fa fa-times" aria-hidden="true"></i>',a+="</div>",a+="</div>",$("#load-file-widget-html"+t).append(a),document.styleSheets[0].addRule("#close-file-btn"+t+" > i",this.deleteButtonDefaultColor()),document.styleSheets[0].addRule("#close-file-btn"+t+" > i:hover",this.deleteButtonHoverColor()),document.styleSheets[0].addRule("#close-file-btn"+t+" > i:active",this.deleteButtonActiveColor()),document.styleSheets[0].addRule("#close-file-btn"+t+" > i","color: "+modelsParameters[o].deleteButtonIconColor),document.styleSheets[0].addRule("#close-file-btn"+t+" > i:hover","color: "+modelsParameters[o].deleteButtonIconHoverColor),$("#close-file-btn"+t).on("click",(function(){i.outputFile.setValue({}),i.outputFile.updateCallback(i.outputFile)}))},this.addSpinner=function(){const e=document.getElementById("load-file-widget-html"+t),o=document.createElement("div"),l=document.createElement("i");o.setAttribute("id","icon-wrapper"+t),o.setAttribute("class","load-spinner-wrapper"),l.setAttribute("class","fa fa-spinner fa-spin load-spinner-wrapper__icon"),o.append(l),e.append(o)},this.removeSpinner=function(){document.getElementById("icon-wrapper"+t).remove()},this.render=function(){const a=document.createElement("div");a.setAttribute("id","load-file-widget-html"+t),_.isUndefined(modelsParameters[o].displayBrowseButton)&&(modelsParameters[o].displayBrowseButton=!0),modelsParameters[o].displayBorder?a.setAttribute("class","load-file-widget-html load-file-widget-html--border"):a.setAttribute("class","load-file-widget-html");let r="";if(modelsParameters[o].displayLabel){const e=this.getTransformedText("label");r+='<div id="load-file-label'+t+'" class="label-wrapper" style="'+this.labelFontSize()+this.labelColor()+this.labelFontFamily()+" text-align: "+modelsParameters[o].labelAlign+'">',r+="<p>"+e+"</p>",r+="</div>"}r+='<div id="drag-area'+t+'" class="drag-area">',r+='<div id="drag-area-icon'+t+'" class="drag-area__icon-wrapper">',r+='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor">\n          <path d="M28.992 21.44c-0.704-0.512-1.536-0.768-2.176-0.896v-10.752c0-0.192-0.064-0.32-0.192-0.448l-8.512-8.448c-0.128-0.128-0.256-0.192-0.448-0.192h-11.84c-0.32 0-0.64 0.256-0.64 0.64v29.312c0 0.32 0.256 0.576 0.64 0.576h20.352c0.32 0 0.64-0.256 0.64-0.576v-2.624h0.704c0.512 0 1.344-0.192 1.984-0.768 0.704-0.576 1.152-1.472 1.152-2.88-0.064-1.344-0.768-2.368-1.664-2.944zM24.704 9.088h-6.912v-6.912l6.912 6.912zM25.664 30.208h-19.392v-28.352h10.432v7.68c0 0.32 0.256 0.576 0.64 0.576h8.32v7.872c-0.064-0.064-0.064-0.128-0.128-0.192-0.896-1.28-2.432-2.368-4.992-2.368-3.712 0-5.44 2.048-6.016 3.456-2.624 0.192-4.864 1.92-4.864 4.352s1.792 4.736 4.8 4.736h11.2v2.24zM28.736 26.496c-0.448 0.384-0.96 0.512-1.28 0.512h-12.928c-2.368 0-3.712-1.792-3.712-3.712 0-1.728 1.792-3.264 4.16-3.264 0.256 0 0.512-0.192 0.576-0.448 0.256-0.96 1.6-3.008 5.056-3.008 2.112 0 3.392 0.896 4.096 1.92 0.768 1.024 0.96 2.176 0.96 2.496 0 0.064 0 0.128 0.064 0.192 0.064 0.192 0.256 0.384 0.512 0.384 0.192 0 0.384 0.064 0.576 0.128 0.512 0.128 1.088 0.32 1.6 0.64 0.704 0.448 1.152 1.152 1.152 2.112-0.064 1.088-0.384 1.728-0.832 2.048z"></path>\n          <path d="M20.992 19.712c-0.192-0.192-0.576-0.192-0.768 0l-2.048 2.048c-0.192 0.192-0.192 0.576 0 0.768s0.576 0.192 0.768 0l1.088-1.088v3.648c0 0.32 0.256 0.576 0.576 0.576s0.512-0.256 0.512-0.576v-3.648l1.088 1.088c0.192 0.192 0.576 0.192 0.768 0s0.192-0.576 0-0.768l-1.984-2.048z"></path>\n        </svg>',r+="</div>",r+='<div id="drag-area-text'+t+'" class="drag-area__text-wrapper">',r+='<span style="'+this.labelFontFamily()+this.textSize()+this.textColor()+'">Drag & drop file here</span>',r+='<span style="'+this.labelFontFamily()+this.textSize()+this.subTextColor()+'">Limit 100MB per file</span>',r+="</div>",modelsParameters[o].displayBrowseButton&&(r+='<div id="browse-btn'+t+'" class="drag-area__browse-btn-wrapper">',r+='<input type="file" name="file" id="browse-btn-input'+t+'_select_file" />',r+='<label id="browse-btn-label'+t+'" style="'+this.labelFontFamily()+this.textSize()+this.browseButtonTextColor()+'" for="browse-btn-input'+t+'_select_file">Browse files</label>',r+="</div>",r+="</div>"),a.innerHTML=r,$("#"+e).html(a),document.styleSheets[0].addRule("#drag-area"+t," background-color: "+modelsParameters[o].backgroundColor),document.styleSheets[0].addRule("#load-file-widget-html"+t," border-color: "+modelsParameters[o].borderColor),document.styleSheets[0].addRule("#load-file-widget-html"+t," background-color: "+modelsParameters[o].labelBackgroundColor),document.styleSheets[0].addRule("#browse-btn-label"+t,this.browseButtonDefaultColor()),document.styleSheets[0].addRule("#browse-btn-label"+t+":hover",this.browseButtonHoverColor()),document.styleSheets[0].addRule("#browse-btn-label"+t+":active",this.browseButtonActiveColor()),modelsTempParams[o].counter=0,$("#drag-area"+t).on("dragenter",(function(e){e.preventDefault(),e.stopPropagation(),modelsTempParams[o].counter++,$("#drag-area"+t).css({opacity:".5"})})),$("#drag-area"+t).on("dragover",(function(e){e.preventDefault(),e.stopPropagation()})),$("#drag-area"+t).on("dragleave",(function(e){e.preventDefault(),e.stopPropagation(),modelsTempParams[o].counter--,0===modelsTempParams[o].counter&&$("#drag-area"+t).css({opacity:""})})),$("#drag-area"+t).on("drop",(function(e){$("#drag-area"+t).css({opacity:""}),e.originalEvent.dataTransfer&&e.originalEvent.dataTransfer.files.length&&(e.preventDefault(),e.stopPropagation(),i.readFile(e.originalEvent.dataTransfer.files[0]))})),$("#browse-btn-input"+t+"_select_file").on("change",(function(e){i.readFile(e.target.files[0])})),_.isUndefined(modelsTempParams[o].outputFile)||this.updateFileDisplay();const n=document.getElementById(e),d=n.clientWidth,s=d<290,c=d<240,u=document.getElementById("drag-area"+t),p=document.getElementById("drag-area-text"+t),f=document.getElementById("drag-area-icon"+t);if(this.updateWidgetContent=function(){s?document.styleSheets[0].addRule(`#loaded-file${t} .loaded-file__icon-wrapper`,"display: none"):document.styleSheets[0].addRule(`#loaded-file${t} .loaded-file__icon-wrapper`,"display: block"),f.classList.toggle("drag-area__icon-wrapper--hidden",s),u.classList.toggle("drag-area--column",c),p.children[0].textContent=c?"Drag & Drop":"Drag & drop file here",p.children[1].classList.toggle("drag-area__text-wrapper__span--hidden",c)},l)this.updateWidgetContent();else{new ResizeObserver((()=>{this.updateWidgetContent()})).observe(n)}};const r=new WidgetActuatorDescription("outputFile","File content",WidgetActuatorDescription.READ_WRITE,WidgetPrototypesManager.SCHEMA_FILE_LIKE);this.getActuatorDescriptions=function(){return[r]},this.outputFile={updateCallback:function(){},setValue:function(e){modelsTempParams[o].outputFile=e,i.render()},getValue:function(){return modelsTempParams[o].outputFile},addValueChangedHandler:function(e){this.updateCallback=e,i.enable()},removeValueChangedHandler:function(e){i.disable()},setCaption:function(e,t){},clearCaption:function(){}},i.render()},this.loadFileWidget.prototype=baseWidget.prototype,this.pluginDefinition={name:"loadFile",widgetsDefinitionList:{loadFile:{factory:"loadFileWidget",title:"Load file control",icn:"load-file",help:"wdg/wdg-basics/#load-file"}}},this.constructor()}modelsParameters.loadFile={label:"Choose a file",displayLabel:!0,labelFontSize:.1,labelColor:"var(--widget-label-color)",labelFontFamily:"var(--widget-font-family)",labelAlign:"left",textColor:"var(--widget-color)",subTextColor:"var(--widget-color)",textSize:.1,binaryFileInput:!1,displayBorder:!0,borderColor:"var(--widget-border-color)",backgroundColor:"var(--widget-dropzone-background-color)",displayBrowseButton:!0,labelBackgroundColor:"var(--widget-dropzone-label-background-color)",browseButtonTextColor:"var(--widget-button-text)",browseButtonDefaultColor:"var(--widget-button-color)",browseButtonActiveColor:"var(--widget-button-active-color)",browseButtonHoverColor:"var(--widget-button-hover-color)",deleteButtonDefaultColor:"var(--widget-delete-button-default-color)",deleteButtonActiveColor:"var(--widget-delete-button-active-color)",deleteButtonHoverColor:"var(--widget-delete-button-hover-color)",deleteButtonIconColor:"var(--widget-delete-button-icon-color)",deleteButtonIconHoverColor:"var(--widget-delete-button-icon-hover-color)"},modelsLayout.loadFile={height:"15vh",width:"20vw",minWidth:"95px",minHeight:"70px"},loadFileWidgetsPluginClass.prototype=basePlugin.prototype;var loadFileWidgetsPlugin=new loadFileWidgetsPluginClass;widgetsPluginsHandler.loadWidgetPlugin(loadFileWidgetsPlugin);
function spinnerStatusWidgetsPluginClass(){this.spinnerStatusWidget=function(t,e,n,i){this.constructor(t,e,n,i);const s=this;this.enable=function(){},this.disable=function(){},this.addSpinner=function(){const t=document.getElementById("spinner-status-widget-html"+e);if(t.hasChildNodes())return;const i=document.createElement("div"),r=document.createElement("i");i.setAttribute("id","icon-wrapper"+e),i.setAttribute("class","spinner-wrapper"),r.setAttribute("class","fa fa-spinner fa-spin"),i.style.backgroundColor=modelsParameters[n].backgroundColor,i.style.color=modelsParameters[n].color,r.style.cssText=s.fontSize(),i.append(r),t.append(i)},this.removeSpinner=function(){const t=document.getElementById("icon-wrapper"+e);t?.remove()},this.rescale=function(){this.render()},this.render=function(){const n=document.createElement("div");n.setAttribute("id","spinner-status-widget-html"+e),n.setAttribute("class","spinner-status-widget-html"),$("#"+t).html(n),i||s.addSpinner()};const r=new WidgetActuatorDescription("trigger","Node to listen",WidgetActuatorDescription.TRIGGER,WidgetPrototypesManager.SCHEMA_ANYTHING);this.getActuatorDescriptions=function(){return[r]},this.trigger={updateCallback:function(){},setValue:function(t){const e=widgetConnector.widgetsConnection[n].sliders.trigger.dataNode;datanodesManager.getDataNodeByName(e).status.subscribe((t=>{"Pending"==t?(s.render(),s.addSpinner()):s.removeSpinner()}))},getValue:function(){},updateCallback:function(){},addValueChangedHandler:function(t){this.updateCallback=t,s.enable()},removeValueChangedHandler:function(t){s.disable()},setCaption:function(t,e){},clearCaption:function(){}},s.render()},this.spinnerStatusWidget.prototype=baseWidget.prototype,this.pluginDefinition={name:"spinnerStatus",widgetsDefinitionList:{spinnerStatus:{factory:"spinnerStatusWidget",title:"Spinner status",icn:"status",help:"wdg/wdg-basics/#spinner-status"}}},this.constructor()}modelsParameters.spinnerStatus={fontsize:1,color:"var(--widget-color)",backgroundColor:"var(--disabled-color-opacity)"},modelsLayout.spinnerStatus={height:"15vh",width:"10vw",minWidth:"60px",minHeight:"60px"},spinnerStatusWidgetsPluginClass.prototype=basePlugin.prototype;const spinnerStatusWidgetsPlugin=new spinnerStatusWidgetsPluginClass;widgetsPluginsHandler.loadWidgetPlugin(spinnerStatusWidgetsPlugin);
function getLedSvg(t,e,i,a){let r="#008400",o="#00b700";switch(e){case"off":{r=t.offColor();const e=w3color(r);e.darker(5),o=e.toHexString();break}case"on":{o=t.onColor();const e=w3color(o);e.darker(10),r=e.toHexString();break}case"inactive":r="#e6e6e6",o="#a6a6a6"}return'<svg xmlns="http://www.w3.org/2000/svg" xmlns: xlink="http://www.w3.org/1999/xlink" viewBox="-1 -1 51 51"  preserveAspectRatio="xMinYMin meet" class="svg-content"><title>LED '+e+'</title><defs><linearGradient y2="0.154336" y1="1.1441" xlink: href="#linearGradient6506_'+i+'" x2="0.566583" x1="0.577235" id="linearGradient6650_'+i+'"/><linearGradient y2="0.846351" y1="0.057496" xlink: href="#linearGradient5756_'+i+'" x2="0.609143" x1="0.532859" id="linearGradient6646_'+i+'"/><linearGradient y2="1" y1="0.019227" xlink: href="#linearGradient5742_'+i+'" x2="0.500488" x1="0.496181" id="linearGradient6644_'+i+'"/><linearGradient id="linearGradient6506_'+i+'"><stop stop-color="#ffffff" stop-opacity="0" offset="0" id="stop6508_'+i+'" /><stop stop-color="#ffffff" stop-opacity="0.87451" offset="1" id="stop6510_'+i+'" /></linearGradient><linearGradient id="linearGradient5756_'+i+'"><stop stop-color="#828282" offset="0" id="stop5758_'+i+'" /><stop stop-color="#929292" stop-opacity="0.352941" offset="1" id="stop5760_'+i+'" /></linearGradient><linearGradient id="linearGradient5742_'+i+'"><stop stop-color="#adadad" offset="0" id="stop5744_'+i+'" /><stop stop-color="#f0f0f0" offset="1" id="stop5746_'+i+'" /></linearGradient><linearGradient y2="0.553776" x2="0.632943" y1="1" x1="1" id="svg_1_'+i+'"><stop offset="0" stop-opacity="0.984375" stop-color="'+r+'" /><stop offset="0.984505" stop-opacity="0.980469" stop-color="'+o+'" /></linearGradient></defs><g><title>Layer 1</title><g id="layer1_'+i+'"><g transform="matrix(31.25, 0, 0, 31.25, -625.023, -1325)" id="g9447_'+i+'"><path fill="url(#linearGradient6644_'+i+')" stroke-width="0.8" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="4" id="path6596_'+i+'" d="m21.60074,43.19165c0,0.441601 -0.3584,0.799999 -0.800001,0.799999c-0.441599,0 -0.799999,-0.358398 -0.799999,-0.799999c0,-0.441601 0.3584,-0.799999 0.799999,-0.799999c0.441601,0 0.800001,0.358398 0.800001,0.799999z" /><path fill="url(#linearGradient6646_'+i+')" stroke-width="0.8" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="4" id="path6598_'+i+'" d="m21.44627,43.191471c0,0.35638 -0.28924,0.645618 -0.64562,0.645618c-0.35638,0 -0.64562,-0.289238 -0.64562,-0.645618c0,-0.35638 0.28924,-0.645611 0.64562,-0.645611c0.35638,0 0.64562,0.28923 0.64562,0.645611z" /><path fill="url(#svg_1_'+i+')" stroke-width="0.8" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="4" id="path6600_'+i+'" d="m21.378719,43.191639c0,0.31905 -0.25893,0.577991 -0.57798,0.577991c-0.31905,0 -0.57799,-0.258942 -0.57799,-0.577991c0,-0.319038 0.25894,-0.577969 0.57799,-0.577969c0.31905,0 0.57798,0.25893 0.57798,0.577969z" /><path transform="rotate(-34.3336, 20.5508, 42.8652)" fill="url(#linearGradient6650_'+i+')" stroke-width="0.8" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="4" id="path6602_'+i+'" d="m20.7453,42.86636c0,0.065899 -0.087271,0.11937 -0.194811,0.11937c-0.107529,0 -0.194809,-0.053471 -0.194809,-0.11937c0,-0.06588 0.08728,-0.119358 0.194809,-0.119358c0.10754,0 0.194811,0.053478 0.194811,0.119358z" /></g></g></g></svg>'}function ledWidgetsPluginClass(){this.statusLedWidget=function(t,e,i,a){this.constructor(t,e,i,a);const r=this;this.enable=function(){},this.disable=function(){},this.insertLabel=function(t){const a=this.getTransformedText("label"),r=$("<span>",{class:"led-span",id:"led-span"+e,html:a});let o="height: inherit; "+this.labelFontSize()+this.labelColor()+this.labelFontFamily();_.isUndefined(modelsParameters[i].labelWidthProportion)?o+=" width: 20%; ":o+=modelsParameters[i].labelWidthProportion+"; ",r.attr("style",o),t.append(r[0])},this.rescale=function(){this.render()},this.render=function(){const a=document.createElement("div");let o="inactive";this.bIsInteractive&&(o=modelsHiddenParams[i].status?"on":"off");let n=1;modelsParameters[i].displayLabel&&(n=(100-Number(modelsParameters[i].labelWidthProportion.replace("%","")))/100);let s=0,l=0;$("#"+t).width()*n>$("#"+t).height()?s=$("#"+t).height()-2:(s=$("#"+t).width()*n-2,l=($("#"+t).height()-s-2)/2),a.setAttribute("class","led-widget-html"),a.setAttribute("style","height: inherit");const d=document.createElement("div");d.setAttribute("class","svg-container"),d.setAttribute("style","display: inline-block; margin-top: "+l+"px; cursor: inherit; width:"+s+"px; height: "+s+"px");const c=getLedSvg(r,o,e,i);d.innerHTML=c,a.appendChild(d),modelsParameters[i].displayLabel&&this.insertLabel(a),$("#"+t).html(a),this.bIsInteractive?r.enable():r.disable()};const o=new WidgetActuatorDescription("status","Current status (boolean)",WidgetActuatorDescription.READ,WidgetPrototypesManager.SCHEMA_BOOLEAN);this.getActuatorDescriptions=function(){return[o]},this.status={updateCallback:function(){},setValue:function(t){t!=modelsHiddenParams[i].status&&(modelsHiddenParams[i].status=t,r.render())},getValue:function(){return modelsHiddenParams[i]},addValueChangedHandler:function(t){this.updateCallback=t,r.enable()},removeValueChangedHandler:function(t){r.disable()},setCaption:function(t,e){modelsParameters[i].inheritLabelFromData&&r.captionHelper(t,r.bIsInteractive,e)},clearCaption:function(){modelsParameters[i].inheritLabelFromData&&(modelsParameters[i].label=""),r.render()}},r.render()},this.statusLedWidget.prototype=baseWidget.prototype,this.pluginDefinition={name:"led",widgetsDefinitionList:{ledStatus:{factory:"statusLedWidget",title:"Status led",icn:"status"}}},this.constructor()}modelsHiddenParams.ledStatus={status:!1},modelsParameters.ledStatus={label:"labelText",inheritLabelFromData:!0,displayLabel:!0,labelFontSize:.5,labelColor:"var(--widget-label-color)",labelFontFamily:"var(--widget-font-family)",labelWidthProportion:"60%",onColor:"var(--widget-led-light-on)",offColor:"var(--widget-led-light-off)"},modelsLayout.ledStatus={height:"10vh",width:"10vw",minWidth:"40px",minHeight:"40px"},ledWidgetsPluginClass.prototype=basePlugin.prototype;const ledWidgetsPlugin=new ledWidgetsPluginClass;widgetsPluginsHandler.loadWidgetPlugin(ledWidgetsPlugin);
function annotationWidgetsPluginClass(){this.iconInfoAnnotationWidget=function(e,t,i,n){this.constructor(e,t,i,n);var a=this;this.enable=function(){},this.disable=function(){},this.rescale=function(){this.render()},this.render=function(){var n=20;_.isNull($(".icons").height())||(n=$(".icons").height()),_.isNull($(".icons").width())||$(".icons").width();var a=$("#"+e).height(),o=$("#"+e).width(),r=modelsParameters[i].iconSize*n,s=(a-n*modelsParameters[i].iconSize)/2,d=document.createElement("div"),l='<i class="fa fa-'+modelsParameters[i].iconSign+'" style="line-height:normal;zoom:'+modelsParameters[i].iconSize+'"></i>';d.innerHTML=l,d.setAttribute("class","btn"),d.setAttribute("id","annotationiconInfo"+t),d.setAttribute("style","width: "+o+"px; height:"+a+"px; cursor: pointer; margin: auto; color:"+modelsParameters[i].iconColor+"; line-height:"+r+"px;padding-top: "+s+"px; "),$("#"+e).html(d);const c=this.getTransformedText("text");$("#annotationiconInfo"+t).bt(c,{fill:this.tipBackgroundColor(),cssStyles:{color:modelsParameters[i].textColor,fontWeight:modelsParameters[i].fontWeight,fontSize:modelsParameters[i].fontSize,fontFamily:modelsParameters[i].fontFamily},width:modelsParameters[i].tipWidth,shrinkToFit:!0,padding:modelsParameters[i].textPadding,cornerRadius:modelsParameters[i].cornerRadius,spikeLength:modelsParameters[i].spikeLength,spikeGirth:modelsParameters[i].spikeGirth,strokeStyle:this.tipBorderColor(),shadowColor:"rgba(0,0,0,.9)",positions:modelsParameters[i].tipPositions,trigger:modelsParameters[i].tipEventTrigger})};const o=new WidgetActuatorDescription("value","Hover text of the icon",WidgetActuatorDescription.READ,WidgetPrototypesManager.SCHEMA_STRING);this.getActuatorDescriptions=function(e=null){const t=e||modelsParameters[i];return t&&t.enableActuator?[o]:[]},this.value={setValue:function(e){modelsParameters[i].text=e,$("#annotationiconInfo"+t)[0].value=e},getValue:function(){return $("#annotationiconInfo"+t)[0].value},addValueChangedHandler:function(e){a.enable()},removeValueChangedHandler:function(e){a.disable()}},a.render()},this.iconInfoAnnotationWidget.prototype=baseWidget.prototype,this.labelAnnotationWidget=function(e,t,i,n){this.constructor(e,t,i,n);var a=this;_.isUndefined(modelsParameters[i].textAlign)&&(modelsParameters[i].textAlign="left"),this.enable=function(){},this.disable=function(){},this.rescale=function(){this.render()},_.isUndefined(modelsParameters[i].centerVertically)&&(modelsParameters[i].centerVertically=!0),this.render=function(){var n=document.createElement("div"),a="table",o="table-cell";if(!modelsParameters[i].centerVertically)a="flex",o="table";const r=this.getTransformedText("text");let s="font-weight: normal;",d="text-decoration: none;",l="font-style: normal;";modelsParameters[i].textBold&&(s="font-weight: bold;"),modelsParameters[i].textUnderline&&(d="text-decoration: underline;"),modelsParameters[i].textBold&&(l="font-style: italic;");var c='<div id="annotationLabelTextArea'+t+'" style="max-width: 2000px; background-color: transparent;  box-shadow: none; width: inherit;  height: inherit; white-space: pre-wrap; color:'+modelsParameters[i].textColor+"; text-align: "+modelsParameters[i].textAlign+";"+s+d+l+"; background-color: "+modelsParameters[i].backgroundColor+"; padding: 4px; resize: inherit; margin: auto; vertical-align: middle ; border-radius: 6px; "+this.fontSize()+this.valueFontFamily()+this.border()+"display: "+o+'" readonly>'+r+"</textarea>";n.innerHTML=c,n.setAttribute("style","width: inherit; height: inherit; display: "+a+"; justify-content: center;"),$("#"+e).html(n)};const o=new WidgetActuatorDescription("value","Label text",WidgetActuatorDescription.READ,WidgetPrototypesManager.SCHEMA_ANY_PRIMITIVE);this.getActuatorDescriptions=function(e=null){const t=e||modelsParameters[i];return t&&t.enableActuator?[o]:[]},this.value={setValue:function(e){modelsParameters[i].text=e,$("#annotationLabelTextArea"+t)[0].value=e},getValue:function(){return $("#annotationLabelTextArea"+t)[0].value},addValueChangedHandler:function(e){a.enable()},removeValueChangedHandler:function(e){a.disable()}},a.render()},this.labelAnnotationWidget.prototype=baseWidget.prototype,this.imageAnnotationWidget=function(e,t,i,n){this.constructor(e,t,i,n);var a=this;this.enable=function(){},this.disable=function(){},this.renderOriginalSize=function(n,a){var o=$("#"+i);o.width(unitW(n+2)),o.height(unitH(a+2));var r=$("#"+e);r.width(unitW(n)),r.height(unitH(a)),r.css("left","0px"),r.css("top","0px"),$("#imgContainer"+t).attr("style","width: "+unitW(n)+"; height: "+unitH(a)+";")},this.rescale=function(){this.render()},this.render=function(){var n=document.createElement("div");n.setAttribute("style","width: inherit; height: inherit; margin: auto; top: 0; left: 0"),n.setAttribute("id","imgContainer"+t);var o="";if(""!=modelsHiddenParams[i].fileContentBase64){o=o+'<img id="img'+t+'" style="position: relative;';var r=$("#"+e);o+="width: inherit; height: inherit; ",modelsParameters[i].keepRatio?o+="object-fit: contain; ":o+="object-fit: fill; ",r.width(inheritWcWidthFromIdInst(i)),r.height(inheritWcHeightFromIdInst(i)),r.css("left","0px"),r.css("top","0px"),n.setAttribute("style","width: inherit; height: inherit; margin: auto;"),a.bIsInteractive||(o+=" opacity: 0.75"),o=o+'" src="data:'+modelsHiddenParams[i].mimeType+";base64,"+modelsHiddenParams[i].fileContentBase64+'">',o+="</img>"}if(!a.bIsInteractive&&!modelsParameters[i].hideImageURL){o=(o=o+'<div id="image_drop_zone'+t+'" style="z-index: 1000000; position: absolute; display: table; top: 20px; left:20px; height: calc(100%-40px); width: calc(100%-40px)">')+'<div id="image_drop_zone_new'+t+'" style="; cursor: pointer; display: table-cell; vertical-align: middle"><a><center id="image_import_handle'+t+'">Click here to import your image file</center></a></div>',o+="</div>";var s=document.getElementById("_otherUse"),d='<input type="file" id="image-file'+t+'" name="files[]" accept=".jpg,.jpeg,.png,.gif,.webp,.svg,.avif" style="padding-bottom: 15px; display: none" required="">';s.insertAdjacentHTML("beforeend",d)}(n.innerHTML=o,$("#"+e).html(n),a.bIsInteractive||modelsParameters[i].hideImageURL)||document.getElementById("image_import_handle"+t).addEventListener("click",(function(e){e.stopPropagation();return document.getElementById("image-file"+t).addEventListener("change",(function(e){e.stopPropagation();const t=e.target.files[0],n=t.type,o=new FileReader;return o.addEventListener("load",(function(e){e.stopPropagation();const t=e.target,o=getRealMimeType(t.result);modelsHiddenParams[i].mimeType="unknown"===o?n:o,modelsHiddenParams[i].fileContentBase64=encodeURIComponent(base64ArrayBuffer(t.result));var r=new Image;return r.onload=function(){a.renderOriginalSize(r.width,r.height)},r.src="data:"+modelsHiddenParams[i].mimeType+";base64,"+modelsHiddenParams[i].fileContentBase64,a.render(),!1}),!1),o.readAsArrayBuffer(t),modelsParameters[i].hideImageURL=!0,!1}),!1),$("#image-file"+t).trigger("click"),!1}),!0)};const o='^data:(image/[a-zA-Z\\+-]*);base64,([^"]*)$',r=new WidgetActuatorDescription("base64Image","Image file content or image encoded as a data URL",WidgetActuatorDescription.READ,{$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:imageAnnotationWidget",anyOf:[{type:"string",pattern:o},{type:"object",properties:{content:{type:"string"},isBinary:{const:!0},type:{type:"string",pattern:"^image/.*"}},required:["content","isBinary","type"]}]});this.getActuatorDescriptions=function(e=null){const t=e||modelsParameters[i];return t&&t.enableActuator?[r]:[]},this.base64Image={setValue:function(e){if(e){if("string"==typeof e){const t=new RegExp(o).exec(e);null==t||3!=t.length?modelsHiddenParams[i].fileContentBase64=e:(modelsHiddenParams[i].mimeType=t[1],modelsHiddenParams[i].fileContentBase64=t[2])}else"object"==typeof e&&e.isBinary&&(modelsHiddenParams[i].mimeType=e.type,modelsHiddenParams[i].fileContentBase64=e.content);a.render()}},getValue:function(){return modelsHiddenParams[i].fileContentBase64},addValueChangedHandler:function(e){a.enable()},removeValueChangedHandler:function(e){a.disable()}},a.render()},this.imageAnnotationWidget.prototype=baseWidget.prototype,this.videoAnnotationWidget=function(e,t,i,n){this.constructor(e,t,i,n);var a=this;a.showCropBar=!1,a.cropPercentage=100;const o="btn btn-xs btn-block btn-primary "+i+"widgetCustomColor",r="btn btn-xs btn-block btn-primary disabled "+i+"widgetCustomColor",s="start",d="stop";this.enable=function(){$("#video-capture-button-"+t).attr("class",o),$("#video-crop-button-"+t).attr("class",o),$("#video-screenshot-button-"+t).attr("class",o)},this.disable=function(){$("#video-capture-button-"+t).attr("class",r),$("#video-crop-button-"+t).attr("class",r),$("#video-screenshot-button-"+t).attr("class",r)},this.placeCanvas=function(){if(a.canvas&&a.video){const e=a.video.videoWidth,t=a.video.videoHeight,i=a.video.clientWidth,n=a.video.clientHeight;if(e&&t&&i&&n){const o=e/t;let r=Math.round(o*n),s=n;r>i&&(r=i,s=Math.min(n,Math.round(i/o)));const d=Math.round((i-r)/2),l=Math.round((n-s)/2);a.canvas.style.left=d.toString()+"px",a.canvas.style.top=l.toString()+"px"}}},this.handleSuccess=function(e){a.video.srcObject=e,a.video.addEventListener("loadeddata",(function(){a.canvas.width=a.video.videoWidth,a.canvas.height=a.video.videoHeight,a.drawCanvas(),a.placeCanvas()}))},this.handleError=function(e){swal("Annotation Video Widget","navigator.getUserMedia error: "+e,"error")},this.toggleCrop=function(){a.showCropBar=!a.showCropBar,$("#video-crop-button-"+t).toggleClass(i+"widgetCustomColor"),$("#video-crop-button-"+t).toggleClass("btn-warning"),a.showCropBar?$("#cropbar"+t).show():$("#cropbar"+t).hide(),a.drawCanvas(),a.placeCanvas()},this.captureWindow=function(){const e=a.canvas.width,t=a.canvas.height;let i=e,n=t,o=a.ratio;if(!o){if(!a.showCropBar||100===a.cropPercentage)return{x:0,y:0,width:i,height:n};o=e/t}i=Math.round(o*n),i>e&&(i=e,n=i/o),a.showCropBar&&100!==a.cropPercentage&&(i=i*a.cropPercentage/100,n=n*a.cropPercentage/100),i=Math.min(Math.round(i),e),n=Math.min(Math.round(n),t),i=Math.max(1,i),n=Math.max(1,n);return{x:Math.round((e-i)/2),y:Math.round((t-n)/2),width:i,height:n}},this.drawCanvas=function(){const e=a.canvas.width,t=a.canvas.height,i=a.canvas.getContext("2d");if(i.clearRect(0,0,e,t),this.bIsInteractive&&a.video.srcObject&&(a.showCropBar||a.ratio)){const e=a.captureWindow();i.globalAlpha=.6,i.strokeStyle="#FFFF00",i.lineWidth=3,i.strokeRect(e.x,e.y,e.width,e.height)}},this.screenshot=function(){const e=a.captureWindow(),t=document.createElement("canvas");t.width=e.width,t.height=e.height;t.getContext("2d").drawImage(a.video,e.x,e.y,e.width,e.height,0,0,e.width,e.height);const n=t.toDataURL("image/jpeg");modelsHiddenParams[i].screenshotBase64=n,modelsHiddenParams[i].screenshotMimeType="image/jpeg",modelsHiddenParams[i].screenshotData=n.replace("data:image/jpeg;base64,","")},this.handleSliderColors=function(){var e="#slider-crop"+t;$(e).find("div").css("background-color",modelsParameters[i].buttonDefaultColor),$(e).find("a").css("background-color",modelsParameters[i].buttonActiveColor),$(e).find("a").hover((function(){$(this).css("background-color",modelsParameters[i].buttonHoverColor)}),(function(){$(this).css("background-color",modelsParameters[i].buttonActiveColor)}))},this.rescale=function(){this.render()},this.render=function(){const n=document.createElement("div");let o="border: 1px solid black; ";this.bIsInteractive||(o+="background-color: lightgrey; opacity: 0.2 "),videoHeightPx=$("#"+e).height()-45;let r='<div id="videoContainer'+t+'" style="text-align: center; align: center; width: inherit; height: inherit;">';if(r+='<div style="display: flex;">',r=r+'<div style="margin: 0 auto; position: relative; height: '+(videoHeightPx+2)+"px; "+o+'; flex: 100%;">',r=r+'<video id="video'+t+'" class="videostream" style="position: absolute; top: 0; left: 0;" width="100%" height="'+videoHeightPx+'px" autoplay></video>',r=r+'<canvas id="canvas'+t+'" style="max-width: 100%; max-height: 100%; position: absolute; top: 0; left: 0; z-index: 10;"></canvas>',r+="</div>",r=r+'<div id="cropbar'+t+'" style="flex: 5px;" hidden><div class="v-slider-div-div" id="slider-crop'+t+'" style="height: '+(videoHeightPx+2)+'px;"></div></div>',r+="</div>",r+='<div style="display:table; width:100%"><div class="container"><div style="margin: 0px" class="row">',r=r+'<div class="col-3" style="padding: 1px"><button id="video-capture-button-'+t+'">'+s+"</button></div>",r=r+'<div class="col-6" style="padding: 1px"><button id="video-screenshot-button-'+t+'">screenshot</button></div>',r=r+'<div class="col-3" style="padding: 1px"><button id="video-crop-button-'+t+'">crop</button></div>',r+="</div></div></div></div>",n.innerHTML=r,n.setAttribute("style","width: inherit; height: inherit; text-align:center; align: center"),$("#"+e).html(n),this.setButtonColorStyle(),this.bIsInteractive?a.enable():a.disable(),$("#slider-crop"+t).slider({orientation:"vertical",range:"min",min:0,max:100,value:100,slide:function(e,t){a.cropPercentage=t.value,a.drawCanvas()}}),$("#cropbar"+t).hide(),this.handleSliderColors(),a.video=document.getElementById("video"+t),a.canvas=document.getElementById("canvas"+t),modelsParameters[i].enforceCaptureRatio?a.ratio=modelsParameters[i].captureRatio:a.ratio&&delete a.ratio,this.bIsInteractive){const e=document.getElementById("video-capture-button-"+t);e.onclick=function(){a.video.srcObject?a.video.paused?(a.video.play(),e.textContent=d):(a.video.pause(),e.textContent=s):navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"},audio:!1}).then((t=>{a.handleSuccess(t),e.textContent=d})).catch(a.handleError)};document.getElementById("video-crop-button-"+t).onclick=function(){a.toggleCrop()};document.getElementById("video-screenshot-button-"+t).onclick=function(){_.isUndefined(a.video)||(modelsParameters[i].pauseOnCapture&&(a.video.pause(),e.textContent=s),a.screenshot(),a.base64Image.updateCallback(a.base64Image,a.base64Image.getValue()),a.mimeType.updateCallback(a.mimeType,a.mimeType.getValue()),a.imageData.updateCallback(a.imageData,a.imageData.getValue()))}}};const l=new WidgetActuatorDescription("base64Image","Sceenshot as a data URL",WidgetActuatorDescription.WRITE,WidgetPrototypesManager.SCHEMA_STRING),c=new WidgetActuatorDescription("mimeType","MIME type of the screenshot",WidgetActuatorDescription.WRITE,WidgetPrototypesManager.SCHEMA_STRING),g=new WidgetActuatorDescription("imageData","Sceenshot image raw data encoded as base 64",WidgetActuatorDescription.WRITE,WidgetPrototypesManager.SCHEMA_STRING);this.getActuatorDescriptions=function(){return[l,c,g]},this.base64Image={updateCallback:function(){},setValue:function(e){},getValue:function(){return modelsHiddenParams[i].screenshotBase64},addValueChangedHandler:function(e){this.updateCallback=e,a.enable()},removeValueChangedHandler:function(e){a.disable()}},this.mimeType={updateCallback:function(){},setValue:function(e){},getValue:function(){return modelsHiddenParams[i].screenshotMimeType},addValueChangedHandler:function(e){this.updateCallback=e,a.enable()},removeValueChangedHandler:function(e){a.disable()}},this.imageData={updateCallback:function(){},setValue:function(e){},getValue:function(){return modelsHiddenParams[i].screenshotData},addValueChangedHandler:function(e){this.updateCallback=e,a.enable()},removeValueChangedHandler:function(e){a.disable()}},a.render()},this.videoAnnotationWidget.prototype=baseWidget.prototype,this.pluginDefinition={name:"annotation",widgetsDefinitionList:{annotationIconInfo:{factory:"iconInfoAnnotationWidget",title:"Info",icn:"info"},annotationLabel:{factory:"labelAnnotationWidget",title:"Label",icn:"label",help:"wdg/wdg-annotation-video/#label"},annotationRectangle:{factory:"labelAnnotationWidget",title:"Form",icn:"label",help:"wdg/wdg-annotation-video/#label"},annotationImage:{factory:"imageAnnotationWidget",title:"Import Image",icn:"image",help:"wdg/wdg-annotation-video/#image"},annotationImageConnected:{factory:"imageAnnotationWidget",title:"Connect Image",icn:"image",help:"wdg/wdg-annotation-video/#image"},annotationVideo:{factory:"videoAnnotationWidget",title:"Camera",icn:"camera",help:"wdg/wdg-annotation-video/#camera"}}},this.constructor()}modelsHiddenParams.annotationIconInfo={},modelsHiddenParams.annotationLabel={},modelsHiddenParams.annotationRectangle={},modelsHiddenParams.annotationImage={fileContentBase64:"",mimeType:""},modelsHiddenParams.annotationImageConnected={fileContentBase64:"",mimeType:""},modelsHiddenParams.annotationVideo={screenshotBase64:"",screenshotMimeType:"",screenshotData:""},modelsParameters.annotationIconInfo={text:"Type texte",enableActuator:!1,fontSize:"medium",fontWeight:"bold",fontFamily:"var(--widget-font-family)",textColor:"var(--widget-button-text)",textPadding:10,tipBackgroundColor:"var(--widget-button-color)",tipBorderColor:"var(--widget-button-text)",tipWidth:200,tipPositions:["right"],tipEventTrigger:"hover",iconColor:"var(--widget-label-color)",iconSize:1,iconSign:"info-circle",cornerRadius:10,spikeLength:15,spikeGirth:5},modelsParameters.annotationLabel={text:"Type texte",enableActuator:!1,fontsize:.5,backgroundColor:"rgba(0, 0, 0, 0)",textColor:"var(--widget-label-color)",valueFontFamily:"var(--widget-font-family)",textAlign:"left",textBold:!1,textUnderline:!1,textItalic:!1,displayBorder:!1,borderColor:"var(--widget-border-color)",borderWidth:"2px",centerVertically:!0},modelsParameters.annotationRectangle={text:"",enableActuator:!1,fontsize:.5,backgroundColor:"rgba(228, 228, 228, 1)",textColor:"var(--widget-label-color)",valueFontFamily:"var(--widget-font-family)",textAlign:"left",displayBorder:!1,borderColor:"var(--widget-border-color)",centerVertically:!0},modelsParameters.annotationImage={keepRatio:!0,hideImageURL:!1,enableActuator:!1},modelsParameters.annotationImageConnected={keepRatio:!0,hideImageURL:!0,enableActuator:!0},modelsParameters.annotationVideo={enforceCaptureRatio:!1,captureRatio:1,pauseOnCapture:!1,buttonTextColor:"var(--widget-button-text)",buttonDefaultColor:"var(--widget-button-color)",buttonActiveColor:"var(--widget-button-active-color)",buttonHoverColor:"var(--widget-button-active-color)"},modelsLayout.annotationIconInfo={height:"4vh",width:"2vw"},modelsLayout.annotationLabel={height:"5vh",width:"12vw",minWidth:"5px",minHeight:"5px"},modelsLayout.annotationRectangle={height:"5vh",width:"12vw",minWidth:"5px",minHeight:"5px"},modelsLayout.annotationImage={height:"20vh",width:"17vw"},modelsLayout.annotationImageConnected={height:"20vh",width:"17vw"},modelsLayout.annotationVideo={height:"30vh",width:"20vw"},annotationWidgetsPluginClass.prototype=basePlugin.prototype;var annotationWidgetsPlugin=new annotationWidgetsPluginClass;widgetsPluginsHandler.loadWidgetPlugin(annotationWidgetsPlugin);
const USE_PLOTLY_VALIDATION=!1,colorway=["var(--widget-color-2)","var(--widget-color-5)","var(--widget-color-6)","var(--widget-color-7)","var(--widget-color-8)","var(--widget-color-9)","var(--widget-color-10)","var(--widget-color-11)","var(--widget-color-12)","var(--widget-color-13)"],textColor="var(--widget-color)",gridColor="var(--widget-plotly-background-color)",axisParams={title:"",tickfont:{color:textColor}},plotlyBackground={paper_bgcolor:"rgba(0,0,0,0)",plot_bgcolor:"rgba(0,0,0,0)"},plotlyColorParams={...plotlyBackground,colorway:colorway,legend:{font:{color:textColor}}},genericPlotlyGridColor={xaxis:{gridcolor:gridColor},yaxis:{gridcolor:gridColor},zaxis:{gridcolor:gridColor}},genericPlotlyColor={template:{layout:{...genericPlotlyGridColor,colorway:colorway,font:{color:textColor}}}},_SCHEMA_PLOTLY_DATA={$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:plotly_data",type:"array",items:{type:"object",properties:{type:{type:"string"}},required:["type"]}},_SCHEMA_PLOTLY_LAYOUT={$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:plotly_layout",type:"object"};modelsParameters.plotlyLine={numberOfAxis:1,layout:{...plotlyColorParams,title:"",xaxis:{title:"x",tickfont:{color:textColor}},yaxis:{title:"y",tickfont:{color:textColor}},showlegend:!0,margin:{l:50,r:50,b:100,t:100,pad:4}},hideModeBar:!1},modelsParameters.plotlyBar={numberOfAxis:1,layout:{...plotlyColorParams,title:"",barmode:"group",xaxis:{title:"x",tickfont:{color:textColor}},yaxis:{title:"y",tickfont:{color:textColor}},showlegend:!0,margin:{l:50,r:50,b:100,t:100,pad:4}},hideModeBar:!1},modelsParameters.plotlyPie={layout:{...plotlyColorParams,title:"",showlegend:!0,margin:{l:50,r:50,b:100,t:100,pad:4}},hideModeBar:!1},modelsParameters.plotly3dSurface={layout:{...plotlyColorParams,title:"",scene:{xaxis:{title:"x"},yaxis:{title:"y"},zaxis:{title:"z"}},showlegend:!0,margin:{l:50,r:50,b:100,t:100,pad:4}},hideModeBar:!1},modelsParameters.plotlyGeneric={enforceTextColor:!0,textColor:textColor,enforceBackgroundTransparency:!0,hideModeBar:!1},modelsParameters.plotlyPyGeneric={enforceTextColor:!0,textColor:textColor,enforceBackgroundTransparency:!0,hideModeBar:!1},modelsParameters.plotlyRealTime={enforceTextColor:!0,textColor:textColor,enforceBackgroundTransparency:!0,hideModeBar:!1},modelsHiddenParams.plotlyLine={...modelsParameters.plotlyLine,data:[{type:"scatter",x:[0,1,2],y:[0,4,0],name:"trace 0"}],selection:[{}]},modelsHiddenParams.plotlyBar={...modelsParameters.plotlyBar,data:[{type:"bar",x:["first","second"],y:[1,2]}],selection:[{}]},modelsHiddenParams.plotlyPie={...modelsParameters.plotlyPie,data:[{type:"pie",labels:["half1","half2"],values:[.5,.5],sort:!1}],selection:[{}]},modelsHiddenParams.plotly3dSurface={...modelsParameters.plotly3dSurface,data:[{type:"surface",x:[1,2,3],y:[1,2,3],z:[[4,5,6],[16,19,20],[10,18,23]]}],selection:[{}]},modelsHiddenParams.plotlyRealTime={data:[{y:[],mode:"lines"}],layout:{...plotlyBackground,...genericPlotlyColor},selection:[{}]},modelsHiddenParams.plotlyGeneric={data:[{}],layout:{...plotlyBackground,...genericPlotlyColor},selection:[{}]},modelsHiddenParams.plotlyPyGeneric={fig:{layout:{...plotlyBackground,...genericPlotlyColor}},selection:[{}]},modelsTempParams.plotlyLine={lastData:{},lastLayout:{}},modelsTempParams.plotlyBar={lastData:{},lastLayout:{}},modelsTempParams.plotlyPie={lastData:{},lastLayout:{}},modelsTempParams.plotly3dSurface={lastData:{},lastLayout:{}},modelsTempParams.plotlyGeneric={lastData:{},lastLayout:{}},modelsTempParams.plotlyPyGeneric={lastData:{},lastLayout:{}},modelsTempParams.plotlyRealTime={lastData:{},lastLayout:{}},modelsLayout.plotlyLine={height:"30vh",width:"30vw",minWidth:"100px",minHeight:"100px"},modelsLayout.plotlyBar={height:"30vh",width:"30vw",minWidth:"100px",minHeight:"100px"},modelsLayout.plotlyPie={height:"30vh",width:"30vw",minWidth:"100px",minHeight:"100px"},modelsLayout.plotly3dSurface={height:"30vh",width:"30vw",minWidth:"378px",minHeight:"305px"},modelsLayout.plotlyGeneric={height:"30vh",width:"30vw",minWidth:"50px",minHeight:"32px"},modelsLayout.plotlyPyGeneric={height:"30vh",width:"30vw",minWidth:"50px",minHeight:"32px"},modelsLayout.plotlyRealTime={height:"30vh",width:"30vw",minWidth:"100px",minHeight:"100px"};const _SCHEMA_PLOTLY_NUMERIC_DATA={$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:plotly_numeric_data",anyOf:[{type:"number"},{type:"array",items:{type:"number"}}]},_SCHEMA_PLOTLY_ANY_DATA={$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:plotly_any_data",anyOf:[{type:"string"},{type:"number"},{type:"boolean"},{type:"array",items:{anyOf:[{type:"string"},{type:"number"},{type:"boolean"}]}}]};function _createPlotlyAnyDataDescriptor(e){return new WidgetActuatorDescription(e,"Array of values to plot",WidgetActuatorDescription.READ,_SCHEMA_PLOTLY_ANY_DATA)}function _createPlotlyNumericDataDescriptor(e){return new WidgetActuatorDescription(e,"Array of numeric values to plot",WidgetActuatorDescription.READ,_SCHEMA_PLOTLY_NUMERIC_DATA)}function _isAxisLinear(e,t){return e&&e[t]&&"linear"===e[t].type}function plotlyWidgetsPluginClass(){let e=0;function t(e,t,a,o){this.bIsInteractive=o;let r="plotly"+t;o&&(r+="c");const l=this;this.getColorValueFromCSSProperty=function(e){let t=e;if(t.includes("var(--")){const a=e.substring(4,e.length-1);t=window.getComputedStyle(document.documentElement).getPropertyValue(a)}return t},this.checkNested=function(e,t,...a){return void 0!==e&&(!(0!=a.length||!e.hasOwnProperty(t))||this.checkNested(e[t],...a))},this.getTransformedText=function(e){if(e){if(!($("<div>").html(e).children().length>0)){e=(new DOMParser).parseFromString("<!doctype html><body>"+e,"text/html").body.textContent}}return e},this.render=function(){const e=modelsParameters[a]?.layout;e?.title&&(e.title=_.isObject(e.title)?this.getTransformedText(e.title.text):this.getTransformedText(e.title));let t=modelsHiddenParams[a].fig?.layout??modelsHiddenParams[a].layout;if(t){if([{key:"enforceBackgroundTransparency",value:plotlyBackground},{key:"enforceTextColor",value:genericPlotlyColor}].forEach((e=>{modelsParameters[a][e.key]?t=_.merge({},e.value,t):_.forIn(e.value,((e,a)=>{_.has(t,a)&&_.isEqual(t[a],e)&&_.unset(t,a)}))})),t.template?.layout&&modelsParameters[a].enforceTextColor){const e=t.template.layout;if(e.font?.color){const t=modelsParameters[a]?.textColor??textColor;e.font.color=this.getColorValueFromCSSProperty(t)}["xaxis","yaxis","zaxis"].forEach((t=>{e[t]?.gridcolor&&(e[t].gridcolor=this.getColorValueFromCSSProperty(gridColor))}))}t=JSON.parse(JSON.stringify(t));const e=modelsParameters[a].layout?JSON.parse(JSON.stringify(modelsParameters[a].layout)):t;this.checkNested(e,"colorway")&&(t.colorway=e.colorway.map((e=>this.getColorValueFromCSSProperty(e)))),["xaxis","yaxis","zaxis"].forEach((a=>{this.checkNested(e,a,"tickfont","color")&&(t[a].tickfont.color=this.getColorValueFromCSSProperty(e[a].tickfont.color))})),this.checkNested(e,"legend","font","color")&&(t.legend.font.color=this.getColorValueFromCSSProperty(e.legend.font.color)),this.checkNested(e,"paper_bgcolor")&&(t.paper_bgcolor=this.getColorValueFromCSSProperty(e.paper_bgcolor)),this.checkNested(e,"plot_bgcolor")&&(t.plot_bgcolor=this.getColorValueFromCSSProperty(e.plot_bgcolor))}$("#"+r).html("");const o=modelsHiddenParams[a].fig?.data??modelsHiddenParams[a].data;if(this.bIsInteractive){t&&t.autosize&&(delete t.width,delete t.height);const e=modelsParameters[a].hideModeBar?{displayModeBar:!1}:{};Plotly.newPlot(r,o,t,e),this.setSelectionActuator()}else{$(`#${r}`).html();const e=(e,t,a)=>{const o=modelsTempParams[a].lastData,r=modelsTempParams[a].lastLayout;return!(_.isEqual(e,o)&&_.isEqual(t,r))},l=(e,t,a)=>{modelsTempParams[a].lastData=e,modelsTempParams[a].lastLayout=t};(e=>e&&void 0!==e.data)(r)?e(o,t,a)&&(Plotly.purge(r),Plotly.react(r,o,t)):Plotly.newPlot(r,o,t),l(o,t,a)}},this.setSelectionActuator=function(){this.bIsInteractive=o;let e="plotly"+t;if(o){e+="c";const t=document.getElementById(e);t.on("plotly_selected",(function(e){if(!_.isUndefined(e)){const a=Array(t.data.length).fill(null).map((()=>[])),o=Array(t.data.length).fill(null).map((()=>[]));e.points.forEach((function(e){if(!_.isUndefined(e.pointNumber)){const r=e.curveNumber,l=e.pointNumber;a[r].push(l),_.isUndefined(t.data[r].customdata)||o[r].push(t.data[r].customdata[l])}if(!_.isUndefined(e.pointNumbers)){const r=e.pointNumbers.curveNumber;pointNumbers.forEach((function(e){a[r].push(e),_.isUndefined(t.data[r].customdata)||o[r].push(t.data[r].customdata[e])}))}}));const r=a.map((function(e,t){return{trace:t,selection:e,customdata:o[t]}}));l.selection.setValue(r),l.selection.updateCallback(l.selection,l.selection.getValue())}})),t.on("plotly_deselect",(function(){l.selection.setValue({range:{}}),l.selection.updateCallback(l.selection,l.selection.getValue())}))}},l.render(),this.getByName=function(e){if(this.hasOwnProperty(e))return this[e]},this.getInteractive=function(){return this.bIsInteractive},this.setInteractive=function(e){e!=this.bIsInteractive&&(this.bIsInteractive=e,this.render())},this.rescale=function(){this.bIsInteractive?Plotly.Plots.resize($("#"+r)[0]):this.render()}}this.createWidget=function(t,a,o,r){switch(e+=1,function(e,t,a){const o=document.createElement("div");let r="plotly"+t;a&&(r+="c"),o.setAttribute("id",r),o.setAttribute("class","js-plotly-plot"),o.setAttribute("style","text-align:center; height: inherit; width: inherit; background-color: transparent"),$("#"+e).html(o)}(t,e,r),a){case"plotlyLine":return new this.linePlotlyWidget(t,e,o,r);case"plotlyBar":return new this.barPlotlyWidget(t,e,o,r);case"plotlyPie":return new this.piePlotlyWidget(t,e,o,r);case"plotly3dSurface":return new this.d3surfacePlotlyWidget(t,e,o,r);case"plotlyGeneric":return new this.genericPlotlyWidget(t,e,o,r);case"plotlyPyGeneric":return new this.genericPlotlyPythonWidget(t,e,o,r);case"plotlyRealTime":return new this.realTimePlotlyWidget(t,e,o,r)}},this.copyWidget=function(e,t,a,o,r){return this.createWidget(e,t,o,r)},this.clear=function(){e=0},this.linePlotlyWidget=function(e,t,a,o){this.constructor(e,t,a,o);var r=this;this.numberOfAxis=modelsParameters[a].numberOfAxis,_.isUndefined(modelsParameters[a].layout)||(modelsParameters[a].layout={...plotlyColorParams,...modelsParameters[a].layout},["xaxis","yaxis"].forEach((e=>{_.isUndefined(modelsParameters[a].layout[e])||(modelsParameters[a].layout[e]={...axisParams,...modelsParameters[a].layout[e]})}))),modelsHiddenParams[a].data.length>this.numberOfAxis&&modelsHiddenParams[a].data.splice(this.numberOfAxis,modelsHiddenParams[a].data.length),this.getActuatorDescriptions=function(e=null){const t=e||modelsParameters[a],o=[t&&_isAxisLinear(t.layout,"xaxis")?_createPlotlyNumericDataDescriptor("x"):_createPlotlyAnyDataDescriptor("x")];if(t&&t.numberOfAxis){const e=_isAxisLinear(t.layout,"yaxis");for(let a=1;a<=t.numberOfAxis;a++){const t="y"+a;o.push(e?_createPlotlyNumericDataDescriptor(t):_createPlotlyAnyDataDescriptor(t))}}return o},this.x={setValue:function(e){if(_.isUndefined(e))swal("Invalid data value","value in x axis is undefined !","error");else{if(!Array.isArray(e)){if("number"!=typeof e&&"string"!=typeof e&&"bigint"!=typeof e)return void swal("Invalid data type","x axis must be an array !","error");e=[e],console.log("value in x axis is converted to an array.")}modelsHiddenParams[a].data[0].x=e,modelsHiddenParams[a].layout=modelsParameters[a].layout,r.render()}},getValue:function(){return modelsHiddenParams[a].data[0].x},addValueChangedHandler:function(e){},removeValueChangedHandler:function(e){},setCaption:function(e,t){modelsParameters[a].layout.xaxis.title=e,modelsHiddenParams[a].layout=modelsParameters[a].layout}};for(let e=1;e<=this.numberOfAxis;e++){const t="y"+e;e>1&&_.isUndefined(modelsHiddenParams[a].data[e-1])&&(modelsHiddenParams[a].data[e-1]={x:[],y:[],name:"caption "+(e-1)}),this[t]={index:e-1,setValue:function(e){const t=this.index+1;if(_.isUndefined(e))swal("Invalid data value","value in y"+t+" axis is undefined !","error");else{if(!Array.isArray(e)){if("number"!=typeof e&&"string"!=typeof e&&"bigint"!=typeof e)return void swal("Invalid data type","y"+t+" axis must be an array !","error");e=[e],console.log("value in y"+t+" axis is converted to an array.")}modelsHiddenParams[a].data[this.index].y=e,modelsHiddenParams[a].data[this.index].x=modelsHiddenParams[a].data[0].x,modelsHiddenParams[a].layout=modelsParameters[a].layout,r.render()}},getValue:function(){return modelsHiddenParams[a].data[this.index].y},addValueChangedHandler:function(e){},removeValueChangedHandler:function(e){},setCaption:function(e,t){1==modelsParameters[a].numberOfAxis?(modelsParameters[a].layout.yaxis.title=e,modelsHiddenParams[a].layout=modelsParameters[a].layout):(modelsHiddenParams[a].data[this.index].name=e,modelsParameters[a].layout.yaxis.title="",modelsHiddenParams[a].layout=modelsParameters[a].layout)}}}},this.linePlotlyWidget.prototype=t.prototype,this.barPlotlyWidget=function(e,t,a,o){this.constructor(e,t,a,o);const r=this;this.numberOfAxis=modelsParameters[a].numberOfAxis,_.isUndefined(modelsParameters[a].layout)||(modelsParameters[a].layout={...plotlyColorParams,...modelsParameters[a].layout},["xaxis","yaxis"].forEach((e=>{_.isUndefined(modelsParameters[a].layout[e])||(modelsParameters[a].layout[e]={...axisParams,...modelsParameters[a].layout[e]})}))),this.getActuatorDescriptions=function(e=null){const t=e||modelsParameters[a],o=[];if(t&&t.numberOfAxis){const e=_isAxisLinear(t.layout,"xaxis"),a=_isAxisLinear(t.layout,"yaxis");for(let r=1;r<=t.numberOfAxis;r++)o.push(e?_createPlotlyNumericDataDescriptor("x"+r):_createPlotlyAnyDataDescriptor("x"+r)),o.push(a?_createPlotlyNumericDataDescriptor("y"+r):_createPlotlyAnyDataDescriptor("y"+r))}return o},modelsHiddenParams[a].data.length>this.numberOfAxis&&modelsHiddenParams[a].data.splice(this.numberOfAxis,modelsHiddenParams[a].data.length),delete this.x;for(let e=1;e<=2;e++){const t=1===e?"x":"y";for(let e=1;e<=this.numberOfAxis;e++){const o=t+e;e>1&&"x"===t&&_.isUndefined(modelsHiddenParams[a].data[e-1])&&(modelsHiddenParams[a].data[e-1]={x:[],y:[],type:"bar"}),this[o]={index:e-1,strAxis:t,setValue:function(e){modelsHiddenParams[a].data[this.index][this.strAxis]=e,modelsHiddenParams[a].layout=modelsParameters[a].layout,r.render()},getValue:function(){return modelsHiddenParams[a].data[this.index][this.strAxis]},addValueChangedHandler:function(e){},removeValueChangedHandler:function(e){},setCaption:function(e,t){1==modelsParameters[a].numberOfAxis?(modelsParameters[a].layout[this.strAxis+"axis"].title=e,modelsHiddenParams[a].layout=modelsParameters[a].layout):modelsHiddenParams[a].data[this.index].name=e}}}}},this.barPlotlyWidget.prototype=t.prototype,this.piePlotlyWidget=function(e,t,a,o){this.constructor(e,t,a,o);var r=this;_.isUndefined(modelsParameters[a].layout)||(modelsParameters[a].layout={...plotlyColorParams,...modelsParameters[a].layout});const l=new WidgetActuatorDescription("labels","Array of labels",WidgetActuatorDescription.READ,WidgetPrototypesManager.SCHEMA_STRING_ARRAY),i=new WidgetActuatorDescription("values","Array of numeric values",WidgetActuatorDescription.READ,WidgetPrototypesManager.SCHEMA_NUMBER_ARRAY);this.getActuatorDescriptions=function(){return[l,i]},this.labels={setValue:function(e){modelsHiddenParams[a].data[0].labels=e,modelsHiddenParams[a].layout=modelsParameters[a].layout,r.render()},getValue:function(){return modelsHiddenParams[a].data[0].labels},addValueChangedHandler:function(e){},removeValueChangedHandler:function(e){}},this.values={setValue:function(e){modelsHiddenParams[a].data[0].values=e,modelsHiddenParams[a].layout=modelsParameters[a].layout,r.render()},getValue:function(){return modelsHiddenParams[a].data[0].values},addValueChangedHandler:function(e){},removeValueChangedHandler:function(e){}}},this.piePlotlyWidget.prototype=t.prototype,this.d3surfacePlotlyWidget=function(e,t,a,o){this.constructor(e,t,a,o);const r=this;_.isUndefined(modelsParameters[a].layout)||(modelsParameters[a].layout={...plotlyColorParams,...modelsParameters[a].layout},delete modelsParameters[a].layout.colorway,delete modelsParameters[a].layout.legend);const l=new WidgetActuatorDescription("x","1d array for the grid's Xs",WidgetActuatorDescription.READ,WidgetPrototypesManager.SCHEMA_NUMBER_ARRAY),i=new WidgetActuatorDescription("y","1d array for the grid's Ys",WidgetActuatorDescription.READ,WidgetPrototypesManager.SCHEMA_NUMBER_ARRAY),s=new WidgetActuatorDescription("z","2d array of arrays for the grid's Zs",WidgetActuatorDescription.READ,WidgetPrototypesManager.SCHEMA_NUMBER_ARRAY_2D);this.getActuatorDescriptions=function(){return[l,i,s]},this.x={setValue:function(e){modelsHiddenParams[a].data[0].x=e,modelsHiddenParams[a].layout=modelsParameters[a].layout,r.render()},getValue:function(){return modelsHiddenParams[a].data[0].x},addValueChangedHandler:function(e){},removeValueChangedHandler:function(e){},setCaption:function(e,t){modelsParameters[a].layout.scene.xaxis.title=e,modelsHiddenParams[a].layout=modelsParameters[a].layout}},this.y={setValue:function(e){modelsHiddenParams[a].data[0].y=e,modelsHiddenParams[a].layout=modelsParameters[a].layout,r.render()},getValue:function(){return modelsHiddenParams[a].data[0].y},addValueChangedHandler:function(e){},removeValueChangedHandler:function(e){},setCaption:function(e,t){modelsParameters[a].layout.scene.yaxis.title=e,modelsHiddenParams[a].layout=modelsParameters[a].layout}},this.z={setValue:function(e){modelsHiddenParams[a].data[0].z=e,r.render()},getValue:function(){return modelsHiddenParams[a].data[0].z},addValueChangedHandler:function(e){},removeValueChangedHandler:function(e){},setCaption:function(e,t){modelsParameters[a].layout.scene.zaxis.title=e,modelsHiddenParams[a].layout=modelsParameters[a].layout}}},this.d3surfacePlotlyWidget.prototype=t.prototype,this.genericPlotlyWidget=function(e,t,a,o){this.constructor(e,t,a,o);const r=this,l=new WidgetActuatorDescription("data","Plotly data array",WidgetActuatorDescription.READ,_SCHEMA_PLOTLY_DATA,void 0),i=new WidgetActuatorDescription("layout","Plotly layout object",WidgetActuatorDescription.READ,_SCHEMA_PLOTLY_LAYOUT,void 0),s=new WidgetActuatorDescription("selection","Plotly selection",WidgetActuatorDescription.WRITE);this.getActuatorDescriptions=function(){return[l,i,s]},this.data={setValue:function(e){modelsHiddenParams[a].data=e,r.render()},getValue:function(){return modelsHiddenParams[a].data},addValueChangedHandler:function(e){},removeValueChangedHandler:function(e){}},this.layout={setValue:function(e){modelsHiddenParams[a].layout=e,r.render()},getValue:function(){return modelsHiddenParams[a].layout},addValueChangedHandler:function(e){},removeValueChangedHandler:function(e){}},this.selection={setValue:function(e){modelsHiddenParams[a].selection=e},getValue:function(){return modelsHiddenParams[a].selection},addValueChangedHandler:function(e){this.updateCallback=e},removeValueChangedHandler:function(e){}}},this.genericPlotlyWidget.prototype=t.prototype,this.genericPlotlyPythonWidget=function(e,t,a,o){this.constructor(e,t,a,o);const r=this,l=new WidgetActuatorDescription("fig","Plotly figure object",WidgetActuatorDescription.READ),i=new WidgetActuatorDescription("selection","Plotly selection",WidgetActuatorDescription.WRITE);this.getActuatorDescriptions=function(){return[l,i]},this.fig={setValue:function(e){modelsHiddenParams[a].fig=e,r.render()},getValue:function(){return modelsHiddenParams[a].fig},addValueChangedHandler:function(e){},removeValueChangedHandler:function(e){}},this.selection={setValue:function(e){modelsHiddenParams[a].selection=e},getValue:function(){return modelsHiddenParams[a].selection},addValueChangedHandler:function(e){this.updateCallback=e},removeValueChangedHandler:function(e){}}},this.genericPlotlyPythonWidget.prototype=t.prototype,this.realTimePlotlyWidget=function(e,t,a,o){var r=this;this.numberOfAxis=1;const l=new WidgetActuatorDescription("layout","Plotly layout object",WidgetActuatorDescription.READ,_SCHEMA_PLOTLY_LAYOUT,void 0),i=new WidgetActuatorDescription("y1","Numeric value to add to the plot",WidgetActuatorDescription.READ,WidgetPrototypesManager.SCHEMA_NUMBER);this.getActuatorDescriptions=function(){const e=[];return e.push(i),e.push(l),e},modelsHiddenParams[a].data.length>this.numberOfAxis&&modelsHiddenParams[a].data.splice(this.numberOfAxis,modelsHiddenParams[a].data.length);for(let e=1;e<=this.numberOfAxis;e++){const r="y"+e;e>1&&_.isUndefined(modelsHiddenParams[a].data[e-1])&&(modelsHiddenParams[a].data[e-1]={x:[],y:[],name:"caption "+(e-1)}),this[r]={index:e-1,setValue:function(e){new Date;var a="plotly"+t;o&&(a+="c"),Plotly.extendTraces(a,{y:[[e]]},[this.index])},getValue:function(){return modelsHiddenParams[a].data[this.index].y},addValueChangedHandler:function(e){},removeValueChangedHandler:function(e){},setCaption:function(e,t){}}}this.layout={setValue:function(e){modelsHiddenParams[a].layout=e,r.render()},getValue:function(){return modelsHiddenParams[a].layout},addValueChangedHandler:function(e){},removeValueChangedHandler:function(e){}},this.constructor(e,t,a,o)},this.realTimePlotlyWidget.prototype=t.prototype,this.pluginDefinition={name:"plotly",widgetsDefinitionList:{plotlyLine:{factory:"linePlotlyWidget",title:"Plotly line",icn:"plotly-line",help:"wdg/wdg-plots/#plotly-line"},plotlyBar:{factory:"barPlotlyWidget",title:"Plotly bar",icn:"plotly-bar",help:"wdg/wdg-plots/#plotly-bar"},plotlyPie:{factory:"piePlotlyWidget",title:"Plotly pie",icn:"plotly-pie",help:"wdg/wdg-plots/#plotly-pie"},plotly3dSurface:{factory:"d3surfacePlotlyWidget",title:"Plotly 3D surface",icn:"plotly-3D",help:"wdg/wdg-plots/#plotly-3d-surface"},plotlyGeneric:{factory:"genericPlotlyWidget",title:"Plotly JavaScript generic",icn:"plotly-javascript-generic",help:"wdg/wdg-plots/#plotly-generic"},plotlyPyGeneric:{factory:"genericPlotlyPythonWidget",title:"Plotly Python generic",icn:"plotly-python-generic",help:"wdg/wdg-plots/#plotly-python-generic"},plotlyRealTime:{factory:"realTimePlotlyWidget",title:"Plotly real-time",icn:"plotly-real-time"}}}}var plotlyWidgetsPlugin=new plotlyWidgetsPluginClass;widgetsPluginsHandler.loadWidgetPlugin(plotlyWidgetsPlugin);
function pyodideWidgetsPluginClass(){const t=document.createElement("div");t.setAttribute("style","height: 1in; width: 1in; left: 100%; position: fixed; top: 100%;"),t.setAttribute("id","hiddenDivDpi"),document.body.appendChild(t);document.getElementById("hiddenDivDpi").offsetWidth,document.getElementById("hiddenDivDpi").offsetHeight;this.genericMatplotlibWidget=function(t,e,i,n){this.constructor(t,e,i,n);const d=this;this.render=async function(){let d="innerMatplotlib"+e;n&&(d+="c"),function(t,e){const i=document.createElement("div");i.setAttribute("id",e),i.setAttribute("style","text-align:center; height: inherit; width: inherit; background-color: transparent"),$("#"+t).html(i)}(t,d);$("#"+d).width(),$("#"+d).height();const o=modelsHiddenParams[i].fig;$("#"+d).html('<img id="png-export-'+d+'"></img>');const l=$("#png-export-"+d),s="data:"+o.type+";base64,"+o.content;l.attr("src",s),l[0].style.width="inherit",l[0].style.height="inherit"};const o=new WidgetActuatorDescription("fig","Matplotlib figure object",WidgetActuatorDescription.READ);this.getActuatorDescriptions=function(){return[o]},this.fig={setValue:function(t){modelsHiddenParams[i].fig=t,d.render()},getValue:function(){return modelsHiddenParams[i].fig},addValueChangedHandler:function(t){},removeValueChangedHandler:function(t){}},d.render()},this.genericMatplotlibWidget.prototype=baseWidget.prototype,this.pluginDefinition={name:"pyodide",widgetsDefinitionList:{matplotlib:{factory:"genericMatplotlibWidget",title:"Matplotlib generic",icn:"matplolib-generic",help:"wdg/wdg-plots/#matplotlib"}}},this.constructor()}modelsParameters.matplotlib={},modelsHiddenParams.matplotlib={fig:{type:"png",content:"iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII="}},modelsLayout.matplotlib={height:"30vh",width:"30vw",minWidth:"50px",minHeight:"32px"},pyodideWidgetsPluginClass.prototype=basePlugin.prototype;var pyodideWidgetsPlugin=new pyodideWidgetsPluginClass;widgetsPluginsHandler.loadWidgetPlugin(pyodideWidgetsPlugin);
function vegaWidgetsPluginClass(){let e;this.genericVegaWidget=function(t,i,n,a){void 0!==window.xdash&&void 0===e&&(e=null,fetch("assets/data/vega_json_schema_v5.json").then((e=>e.json())).then((t=>{e=t,e.$id=WidgetPrototypesManager.ID_URI_SCHEME+"xdash:vega"})).catch((e=>console.error(e)))),this.constructor(t,i,n,a);var r=this;this.rescale=function(){},this.render=function(){var e=JSON.parse(JSON.stringify(modelsHiddenParams[n].spec));if(function(e,t,i){var n=document.createElement("div"),a="vega"+t;i&&(a+="c"),n.setAttribute("id",a),n.setAttribute("style","text-align:center; height: inherit; width: inherit; background-color: transparent"),$("#"+e).html(n)}(t,i,a),modelsParameters[n].inheritWidthAndHeight&&(a?(e.width=$("#vega"+i+"c").width(),e.height=$("#vega"+i+"c").height()):(e.width=$("#vega"+i).width(),e.height=$("#vega"+i).height())),a)return new vega.View(vega.parse(e),{renderer:"canvas",container:"#vega"+i+"c",hover:!0}).runAsync();new vega.View(vega.parse(e),{renderer:"none"}).toCanvas().then((function(e){var t=e.toDataURL("image/png");$("#vega"+i).html('<img src="'+t+'"/>')})).catch((function(e){console.error(e)}))};const s=new WidgetActuatorDescription("spec","Vega JSON specification",WidgetActuatorDescription.READ,e);this.getActuatorDescriptions=function(){return[s]},this.spec={setValue:function(e){e!=modelsHiddenParams[n].spec&&(modelsHiddenParams[n].spec=JSON.parse(JSON.stringify(e)),r.render())},getValue:function(){return modelsHiddenParams[n].spec},addValueChangedHandler:function(e){},removeValueChangedHandler:function(e){}},r.render()},this.genericVegaWidget.prototype=baseWidget.prototype,this.pluginDefinition={name:"vega",widgetsDefinitionList:{vegaGeneric:{factory:"genericVegaWidget",title:"Vega JavaScript generic",icn:"vega-generic-javascript",help:"wdg/wdg-plots/#vega"}}},this.constructor()}modelsParameters.vegaGeneric={inheritWidthAndHeight:!0},modelsHiddenParams.vegaGeneric={spec:{marks:[{type:"text",encode:{update:{text:{value:"Write then connect your Vega spec"}}}}]}},modelsLayout.vegaGeneric={height:"30vh",width:"30vw",minWidth:"50px",minHeight:"32px"},vegaWidgetsPluginClass.prototype=basePlugin.prototype;var vegaWidgetsPlugin=new vegaWidgetsPluginClass;widgetsPluginsHandler.loadWidgetPlugin(vegaWidgetsPlugin);
modelsParameters.echartsGeneric={};const echartsDefaultColors=["var(--widget-color-2)","var(--widget-color-5)","var(--widget-color-6)","var(--widget-color-7)","var(--widget-color-8)","var(--widget-color-9)","var(--widget-color-10)","var(--widget-color-11)","var(--widget-color-12)","var(--widget-color-13)"];function echartsWidgetsPluginClass(){this.genericEchartsWidget=function(e,t,i,r){this.constructor(e,t,i,r);var o=this;this.rescale=function(){this.render()},this.updateValue=function(e){modelsHiddenParams[i].selection&&(modelsHiddenParams[i].selection=e,_.isUndefined(o.selection.updateCallback)||o.selection.updateCallback(o.selection,o.selection.getValue()))},this.getColorValueFromCSSProperty=function(e){var t=e;if(t.includes("var(--")){var i=e.substring(4,e.length-1);t=window.getComputedStyle(document.documentElement).getPropertyValue(i)}return t},this.render=function(){var n=JSON.parse(JSON.stringify(modelsHiddenParams[i].option));if(n.hasOwnProperty("color")||(n.color=echartsDefaultColors),n.color=n.color.map((e=>this.getColorValueFromCSSProperty(e))),function(e,t,i){var r=document.createElement("div"),o="echarts"+t;i&&(o+="c"),r.setAttribute("id",o),r.setAttribute("style","text-align:center; height: inherit; width: inherit; background-color: transparent"),$("#"+e).html(r)}(e,t,r),r){var a=echarts.init(document.getElementById("echarts"+t+"c"));try{a.setOption(n)}catch(e){console.log(e)}a.on("datazoom",(e=>{o.updateValue({start:e.start,end:e.end})}))}else{a=echarts.init(document.getElementById("echarts"+t));try{a.setOption(n)}catch(e){console.log(e)}var s=a.getDataURL();a.dispose(),$("#echarts"+t).html('<img src="'+s+'"/>')}};const n=new WidgetActuatorDescription("option","Chart definition",WidgetActuatorDescription.READ,WidgetPrototypesManager.SCHEMA_ANY_OBJECT),a=new WidgetActuatorDescription("selection","Current selection",WidgetActuatorDescription.WRITE,WidgetPrototypesManager.SCHEMA_ANY_OBJECT);this.getActuatorDescriptions=function(){return[n,a]},this.option={setValue:function(e){e==modelsHiddenParams[i].option||""==e||_.isUndefined(e)||(modelsHiddenParams[i].option=e,o.render())},getValue:function(){return modelsHiddenParams[i].option},addValueChangedHandler:function(e){},removeValueChangedHandler:function(e){}},this.selection={setValue:function(e){modelsHiddenParams[i].selection=e},getValue:function(){return modelsHiddenParams[i].selection},addValueChangedHandler:function(e){this.updateCallback=e},removeValueChangedHandler:function(e){}},o.render()},this.genericEchartsWidget.prototype=baseWidget.prototype,this.pluginDefinition={name:"echarts",widgetsDefinitionList:{echartsGeneric:{factory:"genericEchartsWidget",title:"Echarts JavaScript generic",icn:"echarts-generic-javascript",help:"wdg/wdg-plots/#echarts"}}},this.constructor()}modelsHiddenParams.echartsGeneric={option:{color:echartsDefaultColors},selection:{}},modelsLayout.echartsGeneric={height:"30vh",width:"30vw",minWidth:"50px",minHeight:"32px"},echartsWidgetsPluginClass.prototype=basePlugin.prototype;var echartsWidgetsPlugin=new echartsWidgetsPluginClass;widgetsPluginsHandler.loadWidgetPlugin(echartsWidgetsPlugin);
modelsHiddenParams.hereMaps={inputGeoJson:{},mapMatchingResult:{},heatMapData:{}},modelsHiddenParams.openStreetMaps={geoJson:{geoJsonLayers:[],geoJsonBounds:[]},choropleth:{choroplethLayers:[],choroplethBounds:[]},lineHeatMap:{lineHeatMapLayers:[],lineHeatMapBounds:[]},heatMap:{heatMapData:[],heatMapBuffer:[]},imageOverlay:{imageData:[]},svgOverlay:{svgData:[],svgElements:[]},legends:[],colors:["#800080","#FF00FF","#000080","#0000FF","#008080","#00FFFF","#FFFF00","#800000","#6666ff","#cc6699","#66ff66","#666699","#996633","#ff0000","#669999","#ffff99"]},modelsTempParams.openStreetMaps={geoJson:{geoJsonLayers:[]},choropleth:{choroplethLayers:[]},lineHeatMap:{lineHeatMapLayers:[]},heatMap:{heatMapLayers:[]},imageOverlay:{imageLayers:[]},svgOverlay:{svgLayers:[]},mapObj:null},modelsParameters.openStreetMaps={geoJson:{numberOfLayers:1},choropleth:{numberOfLayers:0},heatMap:{numberOfLayers:0,sampledDisplay:!1,densityHeatMap:!1},lineHeatMap:{numberOfLayers:0},imageOverlay:{numberOfLayers:0},svgOverlay:{numberOfLayers:0},defaultCenter:{latitude:48.872063,longitude:2.331773,zoom:16},offlineSupport:!1,tileServer:"MapboxStreets",drawingFeatures:!1,drawingFeaturesOptions:{point:!0,line:!0,polygon:!0,rectangle:!0,modal:!1},captureClickEvent:!1,markerCluster:!0},modelsLayout.openStreetMaps={height:"35vh",width:"35vw"};const _SCHEMA_SELECTED_POINT={$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:leaflet_imageOverlay",type:"object",properties:{lat:{type:"number"},lag:{type:"number"}},required:["lat","lag"]},_SCHEMA_IMAGE_OVERLAY={$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:leaflet_imageOverlay",type:"object",properties:{imageUrl:{type:"string"},imageBounds:{type:"array",items:{type:"array",items:{type:"number"},minItems:2,maxItems:2},minItems:2,maxItems:2},title:{type:"string"},addAs:{enum:["overlay","baseLayer"]}},required:["imageUrl","imageBounds","title","addAs"]},_SCHEMA_SVG_POINT_OVERLAY={$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:leaflet_svgPointOverlay",type:"object",properties:{data:{anyOf:[{type:"object",properties:{lat:{type:"number"},lng:{type:"number"},direction:{type:"number"}},required:["lat","lng"]},{type:"object",properties:{lat:{type:"number"},lng:{type:"number"},rotation:{type:"number"}},required:["lat","lng"]}]},config:{type:"object",properties:{title:{type:"string"},addAs:{enum:["overlay","baseLayer"]},disableAutoscale:{type:"boolean"},marker:{enum:["arrow","triangle","emptyTriangle","fullTriangle","circle"]},length:{type:"number"},color:{type:"string"}},required:["title","length"]}},required:["data","config"]},_SCHEMA_SVG_OVERLAY={$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:leaflet_svgOverlay",type:"object",properties:{data:{type:"array",items:{anyOf:[{type:"object",properties:{lat:{type:"number"},lng:{type:"number"},direction:{type:"number"}},required:["lat","lng"]},{type:"object",properties:{lat:{type:"number"},lng:{type:"number"},rotation:{type:"number"}},required:["lat","lng"]}]}},config:{type:"object",properties:{title:{type:"string"},addAs:{enum:["overlay","baseLayer"]},disableAutoscale:{type:"boolean"},marker:{enum:["arrow","triangle","emptyTriangle","fullTriangle","circle"]},length:{type:"number"},color:{type:"string"}},required:["title","length"]}},required:["data","config"]},__SCHEMA_VALUED_COORD={$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:leaflet__valued_coord",anyOf:[{type:"object",properties:{lat:{type:"number",minimum:-90,maximum:90},lng:{type:"number",minimum:-180,maximum:180}},required:["lat","lng"],minProperties:3,maxProperties:3,additionalProperties:{type:"number"}},{type:"array",items:[{type:"number",minimum:-90,maximum:90},{type:"number",minimum:-180,maximum:180},{type:"number"}],minItems:3,maxItems:3}]},__SCHEMA_COORD={$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:leaflet__coord",anyOf:[{type:"object",properties:{lat:{type:"number",minimum:-90,maximum:90},lng:{type:"number",minimum:-180,maximum:180}},required:["lat","lng"]},{type:"array",items:[{type:"number",minimum:-90,maximum:90},{type:"number",minimum:-180,maximum:180}],minItems:2,maxItems:2}]},__SCHEMA_HEATMAP_DENSITY_CONFIG={$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:leaflet__heatmap_density_config",type:"object",properties:{minOpacity:{type:"number",minimum:0,maximum:1},maxZoom:{type:"number",minimum:0},radius:{type:"number",minimum:0},blur:{type:"number",minimum:0},disableAutoscale:{type:"boolean"},colorScale:{type:"string"},reverseColorScale:{type:"boolean"}}},__SCHEMA_HEATMAP_CONFIG={$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:leaflet__heatmap_config",type:"object",properties:{opacity:{type:"number",minimum:0,maximum:1},radius:{type:"number",minimum:0},max:{type:"number"},min:{type:"number"},disableAutoscale:{type:"boolean"},addTextLabel:{type:"boolean"},colorScale:{type:"string"},reverseColorScale:{type:"boolean"}}},_SCHEMA_HEATMAP_DENSITY=[{$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:leaflet_heatmap_density",type:"object",properties:{data:{type:"array",items:{$ref:__SCHEMA_VALUED_COORD.$id}},config:{$ref:__SCHEMA_HEATMAP_DENSITY_CONFIG.$id}},required:["data"]},__SCHEMA_VALUED_COORD,__SCHEMA_HEATMAP_DENSITY_CONFIG],_SCHEMA_HEATMAP_DENSITY_SAMPLED=[{$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:leaflet_heatmap_density_sampled",type:"object",properties:{data:{$ref:__SCHEMA_VALUED_COORD.$id},config:{$ref:__SCHEMA_HEATMAP_DENSITY_CONFIG.$id}},required:["data"]},__SCHEMA_VALUED_COORD,__SCHEMA_HEATMAP_DENSITY_CONFIG],_SCHEMA_HEATMAP=[{$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:leaflet_heatmap",type:"object",properties:{data:{type:"array",items:{$ref:__SCHEMA_VALUED_COORD.$id}},config:{$ref:__SCHEMA_HEATMAP_CONFIG.$id}},required:["data"]},__SCHEMA_VALUED_COORD,__SCHEMA_HEATMAP_CONFIG],_SCHEMA_HEATMAP_SAMPLED=[{$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:leaflet_heatmap_sampled",type:"object",properties:{data:{$ref:__SCHEMA_VALUED_COORD.$id},config:{$ref:__SCHEMA_HEATMAP_CONFIG.$id}},required:["data"]},__SCHEMA_VALUED_COORD,__SCHEMA_HEATMAP_CONFIG],__SCHEMA_GEOJSON_COORD={$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:leaflet_geojson_coord",anyOf:[{type:"array",items:[{type:"number",minimum:-180,maximum:180},{type:"number",minimum:-90,maximum:90}],minItems:2,maxItems:2},{type:"array",items:[{type:"number",minimum:-180,maximum:180},{type:"number",minimum:-90,maximum:90},{type:"number"}],minItems:3,maxItems:3}]},__SCHEMA_GEOJSON_COORDINATES={$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:leaflet_geojson_coordinates",type:"array",items:{$ref:__SCHEMA_GEOJSON_COORD.$id}},_SCHEMA_LINE_HEATMAP=[{$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:leaflet_line_heatmap",type:"object",properties:{data:{type:"array",items:{type:"object",properties:{coordinates:{type:"array",items:{$ref:__SCHEMA_GEOJSON_COORD.$id},minItems:2}},required:["coordinates"],patternProperties:{"^(?!coordinates).*$":{type:"number"}},minProperties:2,maxProperties:2}},config:{type:"object",properties:{opacity:{type:"number",minimum:0,maximum:1},weight:{type:"number",minimum:0},max:{type:"number"},min:{type:"number"},disableAutoscale:{type:"boolean"},colorScale:{type:"string"},reverseColorScale:{type:"boolean"}},required:["weight"]}},required:["data","config"]},__SCHEMA_GEOJSON_COORD],__SCHEMA_GEOJSON_GEOMETRY_PRIMITIVE={$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:leaflet_geojson_geometry_primitive",anyOf:[{type:"object",properties:{type:{const:"Point"},coordinates:{$ref:__SCHEMA_GEOJSON_COORD.$id}},required:["type","coordinates"]},{type:"object",properties:{type:{const:"LineString"},coordinates:{$ref:__SCHEMA_GEOJSON_COORDINATES.$id}},required:["type","coordinates"]},{type:"object",properties:{type:{const:"Polygon"},coordinates:{type:"array",items:{$ref:__SCHEMA_GEOJSON_COORDINATES.$id}}},required:["type","coordinates"]}]},__SCHEMA_GEOJSON_GEOMETRY_ALL={$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:leaflet_geojson_geometry_all",anyOf:[{$ref:__SCHEMA_GEOJSON_GEOMETRY_PRIMITIVE.$id},{type:"object",properties:{type:{const:"MultiPoint"},coordinates:{$ref:__SCHEMA_GEOJSON_COORDINATES.$id}},required:["type","coordinates"]},{type:"object",properties:{type:{const:"MultiLineString"},coordinates:{type:"array",items:{$ref:__SCHEMA_GEOJSON_COORDINATES.$id}}},required:["type","coordinates"]},{type:"object",properties:{type:{const:"MultiPolygon"},coordinates:{type:"array",items:{type:"array",items:{$ref:__SCHEMA_GEOJSON_COORDINATES.$id}}}},required:["type","coordinates"]},{type:"object",properties:{type:{const:"GeometryCollection"},geometries:{type:"array",items:{$ref:__SCHEMA_GEOJSON_GEOMETRY_PRIMITIVE.$id}}},required:["type","geometries"]}]},_SCHEMA_CHOROPLETH=[{$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:leaflet_choropleth",type:"object",properties:{data:{type:"array",items:{type:"object",properties:{geometry:{$ref:__SCHEMA_GEOJSON_GEOMETRY_ALL.$id}},required:["geometry"],patternProperties:{"^(?!geometry).*$":{type:"number"}},minProperties:2,maxProperties:2}},config:{type:"object",properties:{opacity:{type:"number",minimum:0,maximum:1},weight:{type:"number",minimum:0},max:{type:"number"},min:{type:"number"},disableAutoscale:{type:"boolean"},colorScale:{type:"string"},reverseColorScale:{type:"boolean"}}}},required:["data"]},__SCHEMA_GEOJSON_COORD,__SCHEMA_GEOJSON_COORDINATES,__SCHEMA_GEOJSON_GEOMETRY_PRIMITIVE,__SCHEMA_GEOJSON_GEOMETRY_ALL],_SCHEMA_GEOJSON=[{$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:leaflet_geojson",type:"object",properties:{type:{const:"FeatureCollection"},features:{type:"array",items:{type:"object",properties:{type:{const:"Feature"},id:{type:"string"},geometry:{$ref:__SCHEMA_GEOJSON_GEOMETRY_ALL.$id},properties:{type:"object",properties:{description:{type:"string"},style:{type:"object",properties:{color:{type:"string"},weight:{type:"number"},opacity:{type:"number"}},additionalProperties:{$ref:WidgetPrototypesManager.SCHEMA_ANY_PRIMITIVE.$id}}}}},if:{properties:{geometry:{type:"object",properties:{type:{const:"Point"}},required:["type"]}}},then:{properties:{properties:{type:"object",properties:{awesomeMarker:{type:"object",properties:{icon:{type:"string"},prefix:{type:"string"},markerColor:{type:"string"},iconColor:{type:"string"},spin:{type:"boolean"},extraClasses:{type:"string"}},required:["icon"]},comment:{type:"string"},html:{type:"string"}},anyOf:[{not:{required:["comment"]}},{not:{required:["html"]}}]}}},required:["type","geometry","properties"]}},properties:{type:"object",properties:{description:{type:"string"}}}},required:["type","features"]},__SCHEMA_GEOJSON_COORD,__SCHEMA_GEOJSON_COORDINATES,__SCHEMA_GEOJSON_GEOMETRY_PRIMITIVE,__SCHEMA_GEOJSON_GEOMETRY_ALL,WidgetPrototypesManager.SCHEMA_ANY_PRIMITIVE],_SCHEMA_SELECTED_GEOJSON=[{$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:leaflet_selected_geojson",type:"object",properties:{type:{const:"FeatureCollection"},features:{type:"array",items:{type:"object",required:["type","geometry","properties"],properties:{type:{const:"Feature"},geometry:{$ref:__SCHEMA_GEOJSON_GEOMETRY_PRIMITIVE.$id},properties:{type:"object",properties:{layerId:{type:"number"}},required:["layerId"]}},if:{properties:{geometry:{type:"object",properties:{type:{const:"Polygon"}},required:["type"]}}},then:{properties:{geometry:{type:"object",properties:{isRectangle:{type:"boolean"},isCut:{type:"boolean"}},required:["isRectangle","isCut"]}}}}}},required:["type","features"]},__SCHEMA_GEOJSON_COORD,__SCHEMA_GEOJSON_COORDINATES,__SCHEMA_GEOJSON_GEOMETRY_PRIMITIVE,WidgetPrototypesManager.SCHEMA_ANY_PRIMITIVE];function mapWidgetsPluginClass(){var e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("xmlns","http://www.w3.org/2000/svg"),e.setAttribute("width","0"),e.setAttribute("height","0");e.innerHTML='<defs><marker id="styledArrow" markerUnits="strokeWidth" markerWidth="12" markerHeight="12" viewBox="0 0 12 12" refX="6" refY="6" orient="auto"><path d="M2,2 L10,6 L2,10 L6,6 L2,2" style="fill: black;"></path></marker></defs>';var a=document.createElement("div");a.setAttribute("style","width:0px; height:0px; margin:0px; padding: 0px"),a.setAttribute("id","hiddenDiv"),a.appendChild(e),document.body.appendChild(a),this.openStreetMapsWidget=function(e,a,t,r){var o=modelsParameters[t].drawingFeatures,s=modelsParameters[t].captureClickEvent,n=modelsParameters[t].markerCluster,i={drawCircle:!1,drawCircleMarker:!1,drawMarker:!0,drawPolyline:!0,drawPolygon:!0,drawRectangle:!0};const l=modelsParameters[t].drawingFeaturesOptions;void 0!==l.polygone&&(l.polygon=l.polygone,delete l.polygone),o&&(i={drawCircle:!1,drawCircleMarker:!1,drawMarker:modelsParameters[t].drawingFeaturesOptions.point,drawPolyline:modelsParameters[t].drawingFeaturesOptions.line,drawPolygon:modelsParameters[t].drawingFeaturesOptions.polygon,drawRectangle:modelsParameters[t].drawingFeaturesOptions.rectangle}),this.constructor(e,a,t,r);var d=this,m=(d3.select("body"),[0,25,50,75,100]);function p(e,a,t,r){var o=(a-e)/8;return r(Math.floor((t-e)/o)*(1/8))}if(this.numberOfGeoJsonLayers=modelsParameters[t].geoJson.numberOfLayers,modelsParameters[t].choropleth?this.numberOfChoroplethLayers=modelsParameters[t].choropleth.numberOfLayers:this.numberOfChoroplethLayers=0,modelsParameters[t].lineHeatMap?this.numberOfLineHeatMapLayers=modelsParameters[t].lineHeatMap.numberOfLayers:this.numberOfLineHeatMapLayers=0,this.numberOfHeatMapLayers=modelsParameters[t].heatMap.numberOfLayers,_.isUndefined(modelsHiddenParams[t].heatMap.heatMapBuffer)&&(modelsHiddenParams[t].heatMap.heatMapBuffer=[]),_.isUndefined(modelsParameters[t].imageOverlay)?(this.numberOfImageLayers=0,modelsParameters[t].imageOverlay={numberOfLayers:0}):this.numberOfImageLayers=modelsParameters[t].imageOverlay.numberOfLayers,_.isUndefined(modelsHiddenParams[t].imageOverlay)&&(modelsHiddenParams[t].imageOverlay={imageData:[]}),_.isUndefined(modelsParameters[t].svgOverlay)?(this.numberOfSvgLayers=0,modelsParameters[t].svgOverlay={numberOfLayers:0}):this.numberOfSvgLayers=modelsParameters[t].svgOverlay.numberOfLayers,_.isUndefined(modelsHiddenParams[t].svgOverlay)&&(modelsHiddenParams[t].svgOverlay={svgData:[],svgElements:[]}),_.isUndefined(modelsParameters[t].lineHeatMap)?(this.numberOfLineHeatMapLayers=0,modelsParameters[t].lineHeatMap={numberOfLayers:0}):this.numberOfLineHeatMapLayers=modelsParameters[t].lineHeatMap.numberOfLayers,_.isUndefined(modelsHiddenParams[t].lineHeatMap)&&(modelsHiddenParams[t].lineHeatMap={lineHeatMapLayers:[],lineHeatMapBounds:[]}),_.isUndefined(modelsParameters[t].choropleth)?(this.numberOfChoroplethLayers=0,modelsParameters[t].choropleth={numberOfLayers:0}):this.numberOfChoroplethLayers=modelsParameters[t].choropleth.numberOfLayers,_.isUndefined(modelsHiddenParams[t].choropleth)&&(modelsHiddenParams[t].choropleth={choroplethLayers:[],choroplethBounds:[]}),_.isUndefined(d.mapLayers)&&(d.mapLayers=jQuery.extend(!0,{},modelsTempParams.openStreetMaps)),this.configStore=[],modelsHiddenParams[t].geoJson.geoJsonLayers.length>d.numberOfGeoJsonLayers&&modelsHiddenParams[t].geoJson.geoJsonLayers.splice(d.numberOfGeoJsonLayers),modelsHiddenParams[t].geoJson.geoJsonBounds.length>d.numberOfGeoJsonLayers&&modelsHiddenParams[t].geoJson.geoJsonBounds.splice(d.numberOfGeoJsonLayers),d.mapLayers.geoJson.geoJsonLayers.length>d.numberOfGeoJsonLayers&&d.mapLayers.geoJson.geoJsonLayers.splice(d.numberOfGeoJsonLayers),modelsHiddenParams[t].choropleth.choroplethLayers.length>d.numberOfChoroplethLayers&&modelsHiddenParams[t].choropleth.choroplethLayers.splice(d.numberOfChoroplethLayers),modelsHiddenParams[t].choropleth.choroplethBounds.length>d.numberOfChoroplethLayers&&modelsHiddenParams[t].choropleth.choroplethBounds.splice(d.numberOfChoroplethLayers),d.mapLayers.choropleth.choroplethLayers.length>d.numberOfChoroplethLayers&&d.mapLayers.choropleth.choroplethLayers.splice(d.numberOfChoroplethLayers),modelsHiddenParams[t].lineHeatMap.lineHeatMapLayers.length>d.numberOfLineHeatMapLayers&&modelsHiddenParams[t].lineHeatMap.lineHeatMapLayers.splice(d.numberOfLineHeatMapLayers),modelsHiddenParams[t].lineHeatMap.lineHeatMapBounds.length>d.numberOfLineHeatMapLayers&&modelsHiddenParams[t].lineHeatMap.lineHeatMapBounds.splice(d.numberOfLineHeatMapLayers),d.mapLayers.lineHeatMap.lineHeatMapLayers.length>d.numberOfLineHeatMapLayers&&d.mapLayers.lineHeatMap.lineHeatMapLayers.splice(d.numberOfLineHeatMapLayers),modelsHiddenParams[t].heatMap.heatMapData.length>d.numberOfHeatMapLayers&&(modelsHiddenParams[t].heatMap.heatMapData.splice(d.numberOfHeatMapLayers),modelsHiddenParams[t].legends.splice(d.numberOfHeatMapLayers)),modelsHiddenParams[t].heatMap.heatMapBuffer.length>d.numberOfHeatMapLayers&&(modelsHiddenParams[t].heatMap.heatMapBuffer.splice(d.numberOfHeatMapLayers),modelsHiddenParams[t].legends.splice(d.numberOfHeatMapLayers)),d.mapLayers.heatMap.heatMapLayers.length>d.numberOfHeatMapLayers&&d.mapLayers.heatMap.heatMapLayers.splice(d.numberOfHeatMapLayers),modelsHiddenParams[t].imageOverlay.imageData.length>d.numberOfImageLayers&&modelsHiddenParams[t].imageOverlay.imageData.splice(d.numberOfImageLayers),d.mapLayers.imageOverlay.imageLayers.length>d.numberOfImageLayers&&d.mapLayers.imageOverlay.imageLayers.splice(d.numberOfImageLayers),modelsHiddenParams[t].svgOverlay.svgData.length>d.numberOfSvgLayers&&(modelsHiddenParams[t].svgOverlay.svgData.splice(d.numberOfSvgLayers),modelsHiddenParams[t].svgOverlay.svgElements.splice(d.numberOfSvgLayers)),d.mapLayers.svgOverlay.svgLayers.length>d.numberOfSvgLayers&&d.mapLayers.svgOverlay.svgLayers.splice(d.numberOfSvgLayers),this.getColorScale=function(e,a,t,r){var o=d3.interpolateYlOrRd;return _.isUndefined(e)||_.isUndefined(d3[e])||!e.includes("interpolate")||(o=d3[e]),!_.isUndefined(a)&&a?d3.scaleSequential().interpolator(o).domain([r,t]):d3.scaleSequential().interpolator(o).domain([t,r])},this.goToFirstRadioButton=function(){if("play"==tabActive&&d.numberOfHeatMapLayers>0){var e=0;_.isUndefined($("input[name='leaflet-base-layers']"))||(e=$("input[name='leaflet-base-layers']").length);for(var a=0;a<e;a++)if($.contains(document.getElementById(t+"c"),$("input[name='leaflet-base-layers']")[a])&&!_.isUndefined(modelsHiddenParams[t])&&modelsHiddenParams[t].legends!=[]){$("input[name='leaflet-base-layers']")[a].click();var r=_.keys(modelsHiddenParams[t].legends)[0];return d.showLegend(r),d.currentBaseLayer=r,void document.removeEventListener("play-tab-loaded",d.goToFirstRadioButton)}}},this.updateValue=function(e){modelsHiddenParams[t].selectedGeoJson&&(modelsHiddenParams[t].selectedGeoJson.features?modelsHiddenParams[t].selectedGeoJson.features.push(e):modelsHiddenParams[t].selectedGeoJson={type:"FeatureCollection",features:[e]},d.selectedGeoJson.updateCallback(d.selectedGeoJson,d.selectedGeoJson.getValue()))},this.getGeoJsonPoint=function(e,a){var t=[];if("polygon"!==e.geometry.type&&"Polygon"!==e.geometry.type||!e.geometry.isCut){if("LineString"===e.geometry.type||"lineString"===e.geometry.type){for(var r=0;r<a._latlngs.length;r++){var o=a._latlngs[r];t.push([o.lng,o.lat])}return t}if("polygon"!==e.geometry.type&&"Polygon"!==e.geometry.type||e.geometry.isCut)return"Point"===e.geometry.type||"point"===e.geometry.type?t=[a._latlng.lng,a._latlng.lat]:[];var s=a._latlngs?a._latlngs[0]:a.pm._layers[0]._latlngs[0];for(r=0;r<s.length;r++){o=s[r];t.push([o.lng,o.lat])}return[t]}return(s=a._latlngs?a._latlngs:a.pm._layers[0]._latlngs).forEach((function(e){for(var a=[],r=0;r<e.length;r++)a.push([e[r].lng,e[r].lat]);t.push(a)})),t},this.getGeoJsonPoint1=function(e,a,t){var r=[],o=[];"rectangle"===e||"Polygon"===e&&t||"polygon"===e||"Polygon"===e&&!t?r=a[0]:"LineString"===e?r=a:"Point"===e&&(r=[],o=[a[1],a[0]]);for(var s=0;s<r.length;s++)o.push([r[s][1],r[s][0]]);return o},this.getLayerInformation=function(e){var a={title:"",description:"",timeStamp:""};if(modelsHiddenParams[t].selectedGeoJson){for(var r=0;r<modelsHiddenParams[t].selectedGeoJson.features.length;r++)modelsHiddenParams[t].selectedGeoJson.features[r].properties.layerId==e&&modelsHiddenParams[t].selectedGeoJson.features[r].properties.information&&(a.title=modelsHiddenParams[t].selectedGeoJson.features[r].properties.information.title,a.description=modelsHiddenParams[t].selectedGeoJson.features[r].properties.information.description,a.timeStamp=modelsHiddenParams[t].selectedGeoJson.features[r].properties.information.timeStamp);d.selectedGeoJson.updateCallback(d.selectedGeoJson,d.selectedGeoJson.getValue())}return a},this.updateLayerInformation=function(e,a){if(modelsHiddenParams[t].selectedGeoJson){for(var r=0;r<modelsHiddenParams[t].selectedGeoJson.features.length;r++)modelsHiddenParams[t].selectedGeoJson.features[r].properties.layerId==e&&(modelsHiddenParams[t].selectedGeoJson.features[r].properties.information=a);d.selectedGeoJson.updateCallback(d.selectedGeoJson,d.selectedGeoJson.getValue())}},this.editList=function(e){if(modelsHiddenParams[t].selectedGeoJson){for(var a=e.map._layers,r=Object.keys(a),o=0;o<r.length;o++)for(var s=0;s<modelsHiddenParams[t].selectedGeoJson.features.length;s++)if(modelsHiddenParams[t].selectedGeoJson.features[s].properties.layerId==a[r[o]]._leaflet_id){var n=d.getGeoJsonPoint(modelsHiddenParams[t].selectedGeoJson.features[s],a[r[o]]);modelsHiddenParams[t].selectedGeoJson.features[s].geometry.coordinates=n}d.selectedGeoJson.updateCallback(d.selectedGeoJson,d.selectedGeoJson.getValue())}},this.rotateLayer=function(e){var a=e.layer._drawnByGeoman?e.layer._leaflet_id:e.layer.feature.properties.layerId;if(modelsHiddenParams[t].selectedGeoJson){for(var r=0;r<modelsHiddenParams[t].selectedGeoJson.features.length;r++)if(modelsHiddenParams[t].selectedGeoJson.features[r].properties.layerId==a){var o=d.getGeoJsonPoint(modelsHiddenParams[t].selectedGeoJson.features[r],e.layer);modelsHiddenParams[t].selectedGeoJson.features[r].geometry.coordinates=o}d.selectedGeoJson.updateCallback(d.selectedGeoJson,d.selectedGeoJson.getValue())}},this.deleteLayer=function(e){var a=e.layer._drawnByGeoman?e.layer._leaflet_id:e.layer.feature.properties.layerId;if(modelsHiddenParams[t].selectedGeoJson){for(var r=0;r<modelsHiddenParams[t].selectedGeoJson.features.length;r++)modelsHiddenParams[t].selectedGeoJson.features[r].properties.layerId==a&&modelsHiddenParams[t].selectedGeoJson.features.splice(r,1);d.selectedGeoJson.updateCallback(d.selectedGeoJson,d.selectedGeoJson.getValue())}},s&&(this.selectedPoint={updateCallback:function(){},getValue:function(){return modelsHiddenParams[t].selectedPoint},setValue:function(e){},addValueChangedHandler:function(e){this.updateCallback=e},removeValueChangedHandler:function(e){},setCaption:function(e){},clearCaption:function(){}}),o&&(this.selectedGeoJson={updateCallback:function(){},getValue:function(){return modelsHiddenParams[t].selectedGeoJson},setValue:function(e){modelsHiddenParams[t].selectedGeoJson=e},addValueChangedHandler:function(e){"None"!==widgetConnector.widgetsConnection[t].sliders.selectedGeoJson.dataNode&&(this.updateCallback=e,d.addDrawingFeatures())},removeValueChangedHandler:function(e){},setCaption:function(e){},clearCaption:function(){}}),this.modal=function(e){if(modelsParameters[t].drawingFeaturesOptions.modal){var a=d.getLayerInformation(e.leafletId),r=['<div class="modal-header"><h4>{title} </h4></div>','<h5 class="pull-left" style="padding-left: 10px"><a>Please add a title and a short description</a></h5>','<div class="modal-body">','<div class="row">{content}</div>',"</div>",'<div class="modal-footer">','<input id="dialog-ok" type="submit" class="bouton {OK_CLS}" value="Ok">','<input id="dialog-ok" type="submit" class="bouton  {CANCEL_CLS}" value="Cancel">',"</div>"].join(""),o=["<table>","<body>","<tr>",'<td style="width: 40%;padding-top: 20px;">Title</td>','<td style="width: 60%;padding-top: 20px;">','<textarea type="text" class="form-control"  style="width:190px;max-width: 200px ;max-height: 40px  ;color: #34495e" rows="1" id="modalInput1"  placeholder="Enter title">',a.title,"</textarea>","</td>","</tr>","<tr>",'<td style="width: 30%;padding-top: 20px;">Description</td>','<td style="width: 70%;padding-top: 20px;">','<textarea type="text" class="form-control"  style="width:190px;max-width: 200px ;max-height: 70px  ;color: #34495e" rows="2" id="modalInput2"  placeholder="Enter Description">',a.description,"</textarea>","</td>","</tr>","</body>","</table>"].join("");e.type,d.map.openModal({leafletId:e.leafletId||"NA",content:o,template:r,okText:"Ok",title:a.title,description:a.description,cancelText:"Cancel",OK_CLS:"modal-ok",CANCEL_CLS:"modal-cancel",MODAL_CONTENT_CLS:"modal-content modal-content-black",width:350,onShow:function(a){var t=a.modal;L.DomEvent.on(t._container.querySelector(".modal-ok"),"click",(function(){e.title=document.getElementById("modalInput1").value,e.description=document.getElementById("modalInput2").value;var a=new Date;e.timeStamp=a.toISOString(),d.updateLayerInformation(e.leafletId,e),t.hide()})).on(t._container.querySelector(".modal-cancel"),"click",(function(){t.hide()}))}})}},this.addDrawingFeatures=function(){var e=new L.FeatureGroup;if(d.map.addLayer(e),this.bIsInteractive){if(modelsHiddenParams[t].selectedGeoJson)if(modelsHiddenParams[t].selectedGeoJson.features){for(var a=0;a<modelsHiddenParams[t].selectedGeoJson.features.length;a++){var r=d.getGeoJsonPoint1(modelsHiddenParams[t].selectedGeoJson.features[a].geometry.type,modelsHiddenParams[t].selectedGeoJson.features[a].geometry.coordinates,modelsHiddenParams[t].selectedGeoJson.features[a].geometry.isRectangle),o=null;"LineString"===modelsHiddenParams[t].selectedGeoJson.features[a].geometry.type?o=L.polyline(r):"Point"===modelsHiddenParams[t].selectedGeoJson.features[a].geometry.type?o=L.marker(r):"Polygon"===modelsHiddenParams[t].selectedGeoJson.features[a].geometry.type&&(o=(modelsHiddenParams[t].selectedGeoJson.features[a].geometry.isRectangle,L.geoJSON(modelsHiddenParams[t].selectedGeoJson.features[a],{}))),o&&(o.on("click",(function(e){console.log("click pol leaflet_id",e.target._leaflet_id),d.modal({leafletId:e.target._leaflet_id})})),e.addLayer(o),modelsHiddenParams[t].selectedGeoJson.features[a].properties.layerId=o._leaflet_id)}d.selectedGeoJson.updateCallback(d.selectedGeoJson,d.selectedGeoJson.getValue())}else modelsHiddenParams[t].selectedGeoJson.type="FeatureCollection",modelsHiddenParams[t].selectedGeoJson.features=[],d.selectedGeoJson.updateCallback(d.selectedGeoJson,d.selectedGeoJson.getValue());else modelsHiddenParams[t].selectedGeoJson={type:"FeatureCollection",features:[]},d.selectedGeoJson.updateCallback(d.selectedGeoJson,d.selectedGeoJson.getValue());d.map.on("pm:globaleditmodetoggled",(function(e){console.log("pm:globaleditmodetoggled",e),d.editList(e)})),d.map.on("pm:globaldragmodetoggled",(function(e){console.log("pm:globaldragmodetoggled",e),d.editList(e)})),d.map.on("pm:rotateend",(function(e){console.log("pm:rotateend",e),d.rotateLayer(e)})),d.map.on("pm:remove",(function(e){console.log("pm:remove",e),d.deleteLayer(e)})),d.map.on("pm:cut",(function(e){console.log("pm:cut",e);for(var a=e.originalLayer._drawnByGeoman?e.originalLayer._leaflet_id:e.originalLayer.feature.properties.layerId,r=0;r<modelsHiddenParams[t].selectedGeoJson.features.length;r++)modelsHiddenParams[t].selectedGeoJson.features[r].properties.layerId==a&&(modelsHiddenParams[t].selectedGeoJson.features[r].properties.layerId=e.layer._leaflet_id,modelsHiddenParams[t].selectedGeoJson.features[r].geometry.coordinates=e.layer.feature.geometry.coordinates,modelsHiddenParams[t].selectedGeoJson.features[r].geometry.isCut=!0);d.selectedGeoJson.updateCallback(d.selectedGeoJson,d.selectedGeoJson.getValue())})),d.map.on("pm:create",(a=>{console.log("pm:create",a),e.addLayer(a.layer);var r=[];if(modelsHiddenParams[t].selectedGeoJson)if("Polygon"==a.shape){for(var o=0;o<a.layer._latlngs[0].length;o++){var s=a.layer._latlngs[0][o];r.push([s.lng,s.lat])}d.updateValue({type:"Feature",geometry:{type:"Polygon",coordinates:[r],isRectangle:!1,isCut:!1},properties:{layerId:a.layer._leaflet_id}})}else if("Line"==a.shape){for(o=0;o<a.layer._latlngs.length;o++){s=a.layer._latlngs[o];r.push([s.lng,s.lat])}d.updateValue({type:"Feature",geometry:{type:"LineString",coordinates:r},properties:{layerId:a.layer._leaflet_id}})}else if("Rectangle"==a.shape){for(o=0;o<a.layer._latlngs[0].length;o++){s=a.layer._latlngs[0][o];r.push([s.lng,s.lat])}d.updateValue({type:"Feature",geometry:{type:"Polygon",coordinates:[r],isRectangle:!0,isCut:!1},properties:{layerId:a.layer._leaflet_id}})}else"Marker"==a.shape&&(r=[a.layer._latlng.lng,a.layer._latlng.lat],d.updateValue({type:"Feature",geometry:{type:"Point",coordinates:r},properties:{layerId:a.layer._leaflet_id}}))}))}else modelsHiddenParams[t].selectedGeoJson={type:"FeatureCollection",features:[]},d.selectedGeoJson.updateCallback(d.selectedGeoJson,d.selectedGeoJson.getValue())},this.render=function(){var r=document.createElement("div");r.setAttribute("id","openStreetMap"+a),r.setAttribute("style","width: inherit; height: inherit"),document.addEventListener("play-tab-loaded",d.goToFirstRadioButton),$("#"+e).html(r),d.map=L.map("openStreetMap"+a,{preferCanvas:!0}).setView([modelsParameters[t].defaultCenter.latitude,modelsParameters[t].defaultCenter.longitude],modelsParameters[t].defaultCenter.zoom),modelsTempParams[t].mapObj=d.map,s&&this.bIsInteractive&&d.map.on("click",(function(e){modelsHiddenParams[t].selectedPoint,modelsHiddenParams[t].selectedPoint={lat:e.latlng.lat,lag:e.latlng.lng},d.selectedPoint.updateCallback(d.selectedPoint,d.selectedPoint.getValue())})),this.bIsInteractive||(d.map.dragging.disable(),d.map.touchZoom.disable(),d.map.doubleClickZoom.disable(),d.map.scrollWheelZoom.disable(),d.map.boxZoom.disable(),d.map.keyboard.disable());var n={};n.MapboxStreets={url:"https://xdashgateway.azure-api.net/mapbox/tiles?z={z}&x={x}&y={y}",attribution:'Imagery  <a href="http://mapbox.com">Mapbox</a>',maxZoom:18,id:"streets-v11",tileSize:512,zoomOffset:-1},n.MapboxDark={url:"https://xdashgateway.azure-api.net/mapbox/tilesgeneral?z={z}&x={x}&y={y}&id={id}",attribution:'Imagery  <a href="http://mapbox.com">Mapbox</a>',maxZoom:18,id:"dark-v10",tileSize:512,zoomOffset:-1},n.HereSatelliteDay={url:"https://xdashgateway.azure-api.net/here{s}/maptile?z={z}&x={x}&y={y}&lg=eng",attribution:'Map &copy; 1987-2014 <a href="http://developer.here.com">HERE</a>',id:" satellite.day",maxZoom:20,subdomains:"1234"},n.HereTerrainDay={url:"https://xdashgateway.azure-api.net/here{s}/maptile?z={z}&x={x}&y={y}&lg=eng",attribution:'Map &copy; 1987-2014 <a href="http://developer.here.com">HERE</a>',id:"terrain.day",maxZoom:20,subdomains:"1234"},n.HereHybridDay={url:"https://xdashgateway.azure-api.net/here{s}/maptile?z={z}&x={x}&y={y}&lg=eng",attribution:'Map &copy; 1987-2014 <a href="http://developer.here.com">HERE</a>',id:" HERE.hybridDay",maxZoom:20,subdomains:"1234"},"true"!=xDashConfig.xDashBasicVersion&&(n.EsriWorldImagery={url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",attribution:"Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community",id:"Esri.WorldImagery",maxZoom:19},n["GeoportailFrance.orthos"]={url:"https://wxs.ign.fr/{apikey}/geoportail/wmts?REQUEST=GetTile&SERVICE=WMTS&VERSION=1.0.0&STYLE={style}&TILEMATRIXSET=PM&FORMAT={format}&LAYER=ORTHOIMAGERY.ORTHOPHOTOS&TILEMATRIX={z}&TILEROW={y}&TILECOL={x}",attribution:'<a target="_blank" href="https://www.geoportail.gouv.fr/">Geoportail France</a>',minZoom:2,maxZoom:19,apikey:"choisirgeoportail",format:"image/jpeg",style:"normal"});var l="MapboxStreets";_.isUndefined(modelsParameters[t].tileServer)||_.includes(_.keys(n),modelsParameters[t].tileServer)&&(l=modelsParameters[t].tileServer);var m={url:n[l].url,maxZoom:n[l].maxZoom,attribution:'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, '+n[l].attribution};if(_.isUndefined(n[l].subdomains)||(m.subdomains=n[l].subdomains),_.isUndefined(n[l].id)||(m.id=n[l].id),_.isUndefined(n[l].apikey)||(m.apikey=n[l].apikey),_.isUndefined(n[l].format)||(m.format=n[l].format),_.isUndefined(n[l].style)||(m.style=n[l].style),_.isUndefined(n[l].tileSize)||(m.tileSize=n[l].tileSize),_.isUndefined(n[l].zoomOffset)||(m.zoomOffset=n[l].zoomOffset),_.isUndefined(n[l].accessToken)||(m.accessToken=n[l].accessToken),modelsParameters[t].offlineSupport){m.attribution='Progress: <span id="leafletProgress'+a+'"></span> / <span id="leafletTotal'+a+'"></span>. Current storage: <span id="leafletStorage'+a+'"></span> files.Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, '+n[l].attribution,d.baseLayer=L.tileLayer.offline(n[l].url,m),d.baseLayer.addTo(d.map);var p=[];if(modelsParameters[t].defaultCenter.zoom<=n[l].maxZoom)for(var y=0;y<n[l].maxZoom-modelsParameters[t].defaultCenter.zoom;y++)p[y]=modelsParameters[t].defaultCenter.zoom+y;else p=modelsParameters[t].defaultCenter.zoom;var c,g=L.control.savetiles(d.baseLayer,{zoomlevels:p,confirm:function(e,a){window.confirm("Save "+e._tilesforSave.length)&&a()},confirmRemoval:function(e,a){window.confirm("Remove all the tiles?")&&a()},saveText:'<i class="icon-download-alt icon" aria-hidden="true"></i>',rmText:'<i class="icon-trash icon" aria-hidden="true"></i>'});g.addTo(d.map),d.baseLayer.on("storagesize",(function(e){document.getElementById("leafletStorage"+a).innerHTML=e.storagesize})),g.setPosition("topright"),d.baseLayer.on("savestart",(function(e){c=0,document.getElementById("leafletTotal"+a).innerHTML=e._tilesforSave.length})),d.baseLayer.on("savetileend",(function(e){c++,document.getElementById("leafletProgress"+ +a).innerHTML=c})),d.baseLayer.on("loadend",(function(e){swal("","Saved all tiles","info")})),d.baseLayer.on("tilesremoved",(function(e){document.getElementById("leafletProgress"+ +a).innerHTML="",document.getElementById("leafletTotal"+a).innerHTML="",swal("","Removed all tiles","info")}))}else d.baseLayer=L.tileLayer(n[l].url,m),d.baseLayer.addTo(d.map);L.control.scale().addTo(d.map),d.map.zoomControl.setPosition("topright"),d.ctrl=L.control.layers({},{},{position:"topright",collapsed:!0,autoZIndex:!0}).addTo(d.map),o&&d.map.pm.addControls(i);try{for(y=0;y<d.numberOfGeoJsonLayers;y++)_.isUndefined(modelsHiddenParams[t].geoJson.geoJsonLayers[y])||_.isUndefined(modelsHiddenParams[t].geoJson.geoJsonLayers[y])||d.addGeoJson(modelsHiddenParams[t].geoJson.geoJsonLayers[y],y+1);for(y=0;y<d.numberOfChoroplethLayers;y++)_.isUndefined(modelsHiddenParams[t].choropleth.choroplethLayers[y])||_.isUndefined(modelsHiddenParams[t].choropleth.choroplethLayers[y])||d.addChoropleth(modelsHiddenParams[t].choropleth.choroplethLayers[y],y+1);for(y=0;y<d.numberOfLineHeatMapLayers;y++)_.isUndefined(modelsHiddenParams[t].lineHeatMap.lineHeatMapLayers[y])||_.isUndefined(modelsHiddenParams[t].lineHeatMap.lineHeatMapLayers[y])||d.addLineHeatMap(modelsHiddenParams[t].lineHeatMap.lineHeatMapLayers[y],y+1);for(y=0;y<d.numberOfHeatMapLayers;y++)modelsHiddenParams[t].heatMap.heatMapBuffer[y]=[],_.isUndefined(modelsHiddenParams[t].heatMap.heatMapData[y])||_.isUndefined(modelsHiddenParams[t].heatMap.heatMapData[y])||d.drawHeatMap(modelsHiddenParams[t].heatMap.heatMapData[y],y+1);for(y=0;y<d.numberOfImageLayers;y++)_.isUndefined(modelsHiddenParams[t].imageOverlay.imageData[y])||_.isUndefined(modelsHiddenParams[t].imageOverlay.imageData[y])||d.addImageOverlay(modelsHiddenParams[t].imageOverlay.imageData[y],y+1);for(y=0;y<d.numberOfSvgLayers;y++)_.isUndefined(modelsHiddenParams[t].svgOverlay.svgData[y])||_.isUndefined(modelsHiddenParams[t].svgOverlay.svgData[y])||d.addSvgOverlay(modelsHiddenParams[t].svgOverlay.svgData[y],y+1,!1)}catch(e){console.error(e)}d.map.on("baselayerchange",(function(e){d.showLegend(e.name),d.currentBaseLayer=e.name}))},this.showLegend=function(e){var a=_.keys(modelsHiddenParams[t].legends);if(_.has(modelsHiddenParams[t].legends,e)){var r=_.without(a,e);_.each(r,(function(e){d.map.removeControl(modelsHiddenParams[t].legends[e])})),modelsHiddenParams[t].legends[e].addTo(d.map),o&&(d.map.pm.removeControls(),d.map.pm.addControls(i))}},this.rescale=function(){try{d.map.invalidateSize()}catch(e){console.log(e.message)}},this.addGeoJson=function(e,a){if(modelsHiddenParams[t].geoJson.geoJsonBounds[a-1]=null,!(_.isUndefined(e)||(_.isEmpty(d.mapLayers.geoJson.geoJsonLayers[a-1])||(d.ctrl.removeLayer(d.mapLayers.geoJson.geoJsonLayers[a-1]),d.map.removeLayer(d.mapLayers.geoJson.geoJsonLayers[a-1])),_.isEmpty(e)||e=={}||_.isUndefined(e.features)||_.isEmpty(e.features)))){var r="Trace"+a;_.isUndefined(e.properties)||_.isUndefined(e.properties.description)||(r=e.properties.description);var o={color:modelsHiddenParams[t].colors[a-1],weight:4,opacity:1},s=L.geoJSON(e,{style:function(e){return _.isUndefined(e.properties)?o:(_.isUndefined(e.properties.description)||(r=e.properties.description),_.isUndefined(e.properties.style)?o:e.properties.style)},onEachFeature:function(e,a){if("Point"==e.geometry.type&&e.properties)if(e.properties.comment)if(e.properties.openPopup){a.bindPopup(e.properties.comment,{autoClose:!1,autoPan:!1}).on("add",(function(e){e.target.openPopup()}))}else a.bindPopup(e.properties.comment);else if(e.properties.html)e.properties.openPopup?(mk=a.bindPopup(e.properties.html,{autoClose:!1,autoPan:!1}),mk.on("add",(function(e){e.target.openPopup()}))):a.bindPopup(e.properties.html);else{var t=jQuery.extend(!0,{},e.properties);t.awesomeMarker&&delete t.awesomeMarker,e.properties.openPopup?(mk=a.bindPopup(syntaxHighlight(JSON.stringify(t)),{autoClose:!1,autoPan:!1}),mk.on("add",(function(e){e.target.openPopup()}))):a.bindPopup(syntaxHighlight(JSON.stringify(t)))}},pointToLayer:function(e,a){if("Point"==e.geometry.type){if(e.properties&&e.properties.awesomeMarker){var t=L.AwesomeMarkers.icon(e.properties.awesomeMarker);return L.marker(a,{icon:t})}return L.marker(a)}}});if(n){var i=L.markerClusterGroup();i.addLayer(s),d.mapLayers.geoJson.geoJsonLayers[a-1]=i}else d.mapLayers.geoJson.geoJsonLayers[a-1]=s;d.map.addLayer(d.mapLayers.geoJson.geoJsonLayers[a-1]),d.ctrl.addOverlay(d.mapLayers.geoJson.geoJsonLayers[a-1],r);try{var l=geojsonExtent(e),m=L.latLng(l[1],l[0]),p=L.latLng(l[3],l[2]),y=L.latLngBounds(m,p);modelsHiddenParams[t].geoJson.geoJsonBounds[a-1]=y;var c=!1;_.isUndefined(e.properties)||_.isUndefined(e.properties.disableAutoscale)||(c=e.properties.disableAutoscale),c||d.map.fitBounds(d.globalLayersBounds())}catch(e){console.log(e)}}},this.addChoropleth=function(e,a){if(_.isUndefined(e))return;if(_.isEmpty(e))return;if(e=={})return;var r=d.convertToChoroplethObject(e);if(modelsHiddenParams[t].choropleth.choroplethBounds[a-1]=null,_.isEmpty(d.mapLayers.choropleth.choroplethLayers[a-1])||(d.ctrl.removeLayer(d.mapLayers.choropleth.choroplethLayers[a-1]),d.map.removeLayer(d.mapLayers.choropleth.choroplethLayers[a-1])),_.isUndefined(r.features))return;if(_.isEmpty(r.features))return;var o=_.without(_.keys(e.data[0]),"geometry")[0];_.isUndefined(r.properties)||_.isUndefined(r.properties.description)||(o=r.properties.description);var s=_.max(_.map(e.data,o)),n=_.min(_.map(e.data,o)),i=4,l=.7;let m;try{_.isUndefined(e.config.max)||(s=e.config.max),_.isUndefined(e.config.min)||(n=e.config.min),_.isUndefined(e.config.weight)||(i=e.config.weight),_.isUndefined(e.config.opacity)||(l=e.config.opacity),m=d.getColorScale(e.config.colorScale,e.config.reverseColorScale,0,1)}catch(e){}d.createChoroplethLegend(n,s,o,m),d.showLegend(o),d.mapLayers.choropleth.choroplethLayers[a-1]=L.geoJSON(r,{style:function(e){return{weight:i,opacity:l,color:"white",dashArray:"3",fillOpacity:l,fillColor:p(n,s,e.properties.density,m)}}}).addTo(d.map),d.ctrl.addBaseLayer(d.mapLayers.choropleth.choroplethLayers[a-1],o);var y=!1;try{y=e.config.disableAutoscale}catch(e){}try{if(!y){var c=geojsonExtent(r),g=L.latLng(c[1],c[0]),u=L.latLng(c[3],c[2]),f=L.latLngBounds(g,u);modelsHiddenParams[t].choropleth.choroplethBounds[a-1]=f,d.map.fitBounds(f)}}catch(e){console.log(e)}},this.convertToChoroplethObject=function(e){let a=[];const t=e.data;if(t.length){const e=_.without(_.keys(t[0]),"geometry")[0];a=t.map(((a,t)=>({type:"Feature",id:t,properties:{},geometry:a.geometry,properties:{density:a[e]}})))}return{type:"FeatureCollection",features:a}},this.createChoroplethLegend=function(e,a,r,o){_.isUndefined(modelsHiddenParams[t].legends[r])||d.map.removeControl(modelsHiddenParams[t].legends[r]),modelsHiddenParams[t].legends[r]=L.control({position:"topright"}),modelsHiddenParams[t].legends[r].onAdd=function(t){for(var r,s,n=(a-e)/8,i=L.DomUtil.create("div","info legend"),l=[e,e+n,e+2*n,e+3*n,e+4*n,e+5*n,e+6*n,a],d=[],m=0;m<l.length;m++)r=l[m],s=l[m+1],d.push('<i style="background:'+p(e,a,r+1,o)+'"></i> <span>'+d3.format("~s")(r)+(s?"&ndash;"+d3.format("~s")(s):"+")+"</span>");return i.innerHTML=d.join("<br>"),i}},this.convertToGeoJSONObject=function(e){var a=[],t="";return _.each(e.data,(function(r){var o=Object.keys(r);_.each(o,(function(e){"coordinates"!=e&&(t=e)}));var s,n,i,l={type:"Feature",geometry:{type:"LineString",coordinates:r.coordinates},properties:{style:{color:d.getColorScale(e.config.colorScale,e.config.reverseColorScale,0,100)((s=r[t],n=e.config.min,i=100*(s-n)/(e.config.max-n),i>100&&(i=100),i<0&&(i=0),i)),weight:e.config.weight,opacity:e.config.opacity}}};a.push(l)})),{type:"FeatureCollection",features:a,properties:{description:t}}},this.addLineHeatMap=function(e,a){if(!_.isUndefined(e)&&!_.isEmpty(e)&&e!={}){var r=d.convertToGeoJSONObject(e);if(modelsHiddenParams[t].lineHeatMap.lineHeatMapBounds[a-1]=null,_.isEmpty(d.mapLayers.lineHeatMap.lineHeatMapLayers[a-1])||(d.ctrl.removeLayer(d.mapLayers.lineHeatMap.lineHeatMapLayers[a-1]),d.map.removeLayer(d.mapLayers.lineHeatMap.lineHeatMapLayers[a-1])),!_.isUndefined(r.features)&&!_.isEmpty(r.features)){var o="Trace"+a;_.isUndefined(r.properties)||_.isUndefined(r.properties.description)||(o=r.properties.description);var s={color:modelsHiddenParams[t].colors[a-1],weight:4,opacity:1},n=_.max(_.map(e.data,o)),i=_.min(_.map(e.data,o));try{_.isUndefined(e.config.max)||(n=e.config.max),_.isUndefined(e.config.min)||(i=e.config.min)}catch(e){}var l=d.getColorScale(e.config.colorScale,e.config.reverseColorScale,0,100);d.createLegend(l,100,m,i,n,o),d.showLegend(o),d.mapLayers.lineHeatMap.lineHeatMapLayers[a-1]=L.geoJSON(r,{style:function(e){return _.isUndefined(e.properties)?s:(_.isUndefined(e.properties.description)||(o=e.properties.description),_.isUndefined(e.properties.style)?s:e.properties.style)},onEachFeature:function(e,a){"Point"==e.geometry.type&&e.properties&&a.bindPopup(syntaxHighlight(JSON.stringify(e.properties)))}}).addTo(d.map),d.ctrl.addBaseLayer(d.mapLayers.lineHeatMap.lineHeatMapLayers[a-1],o);var p=!1;try{p=e.config.disableAutoscale}catch(e){}if(!p)try{var y=geojsonExtent(r),c=L.latLng(y[1],y[0]),g=L.latLng(y[3],y[2]),u=L.latLngBounds(c,g);modelsHiddenParams[t].lineHeatMap.lineHeatMapBounds[a-1]=u,d.map.fitBounds(d.globalLayersLineHeatBounds())}catch(e){console.log(e)}}}},this.addImageOverlay=function(e,a){if(_.isUndefined(e))return;if(_.isEmpty(e))return;if(e=={})return;const t=e.imageUrl,r=e.imageBounds,o=e.title,s=e.addAs,n=e.options;_.isEmpty(d.mapLayers.imageOverlay.imageLayers[a-1])||(d.ctrl.removeLayer(d.mapLayers.imageOverlay.imageLayers[a-1]),d.map.removeLayer(d.mapLayers.imageOverlay.imageLayers[a-1])),d.mapLayers.imageOverlay.imageLayers[a-1]=L.imageOverlay(t,r,n).addTo(d.map),"overlay"==s?d.ctrl.addOverlay(d.mapLayers.imageOverlay.imageLayers[a-1],o):d.ctrl.addBaseLayer(d.mapLayers.imageOverlay.imageLayers[a-1],o)},this.globalLayersBounds=function(){for(var e=L.latLngBounds(d.map.getCenter()),a=0;a<d.numberOfGeoJsonLayers;a++)null!=modelsHiddenParams[t].geoJson.geoJsonBounds[a]&&e.extend(modelsHiddenParams[t].geoJson.geoJsonBounds[a]);return e},this.globalLayersLineHeatBounds=function(){for(var e=L.latLngBounds(d.map.getCenter()),a=0;a<d.numberOfLineHeatMapLayers;a++)null!=modelsHiddenParams[t].lineHeatMap.lineHeatMapBounds[a]&&e.extend(modelsHiddenParams[t].lineHeatMap.lineHeatMapBounds[a]);return e},this.createSvgOverlay=function(e,a){var t=d.createOneCircle,r=e.config.marker;switch(r){case"arrow":t=d.createOneArrow;break;case"triangle":case"emptyTriangle":case"fullTriangle":t=d.createOneTriangle;break;default:r="circle",t=d.createOneCircle}return d.createObjectsOverlay(e,a,r,t)},this.appendSvgOverlay=function(e,a){if("arrow"===e.config.marker)return d.appendArrowsOverlay(e,a)},this.appendArrowsOverlay=function(e,a){var r=e.data[0],o=L.latLng([r.lat,r.lng]),s=d.map.latLngToLayerPoint(o).x,n=d.map.latLngToLayerPoint(o).y,i=0,l="black";_.isUndefined(r.direction)||(i=r.direction),_.isUndefined(r.rotation)||(i=r.rotation),_.isUndefined(r.color)||(l=r.color);var m=d.createOneArrow(s,n,i,modelsHiddenParams[t].svgOverlay.svgElements[a-1].reductionFactor,modelsHiddenParams[t].svgOverlay.svgElements[a-1].lengthInPx,l);modelsHiddenParams[t].svgOverlay.svgElements[a-1].SVG.innerHTML=modelsHiddenParams[t].svgOverlay.svgElements[a-1].SVG.innerHTML+m},this.createObjectsOverlay=function(e,a,r,o){modelsHiddenParams[t].svgOverlay.svgElements[a-1]={},modelsHiddenParams[t].svgOverlay.svgElements[a-1].currentZoom=d.map.getZoom(),[modelsHiddenParams[t].svgOverlay.svgElements[a-1].reductionFactor,modelsHiddenParams[t].svgOverlay.svgElements[a-1].lengthInPx]=d.computeDimensions(e);var s="",n=e.config.color||"#000";e.data.forEach((function(e){var i=L.latLng([e.lat,e.lng]),l=0;_.isUndefined(e.direction)||(l=e.direction),_.isUndefined(e.rotation)||(l=e.rotation);var m=d.map.latLngToContainerPoint(i).x,p=d.map.latLngToContainerPoint(i).y;s+=o(m,p,l,modelsHiddenParams[t].svgOverlay.svgElements[a-1].reductionFactor,modelsHiddenParams[t].svgOverlay.svgElements[a-1].lengthInPx,r,n)}));var i=document.createElementNS("http://www.w3.org/2000/svg","svg");i.setAttribute("xmlns","http://www.w3.org/2000/svg");var l="0 0 "+d.map.getSize().x+" "+d.map.getSize().y;return i.setAttribute("viewBox",l),modelsHiddenParams[t].svgOverlay.svgElements[a-1].SVG=i,modelsHiddenParams[t].svgOverlay.svgElements[a-1].SVG.innerHTML=s,L.svgOverlay(modelsHiddenParams[t].svgOverlay.svgElements[a-1].SVG,d.map.getBounds())},this.computeDimensions=function(e){const a=e.config.length,t=d.map.getBounds(),r=t.getSouthWest(),o=t.getNorthEast(),s=d.map.latLngToContainerPoint(r).y-d.map.latLngToContainerPoint(o).y,n=L.latLng(o.lat,r.lng),i=a/d.map.distance(r,n);return[i,s*i]},this.autoscaleSvg=function(e){var a,t,r,o=[],s=[];_.isEmpty(e.data)||(e.data.forEach((function(e){o.push(e.lat),s.push(e.lng)})),o.length>1?(a=L.latLng(_.max(o),_.max(s)),t=L.latLng(_.min(o),_.min(s)),r=L.latLngBounds(a,t),d.map.fitBounds(r)):d.map.setView(L.latLng(o[0],s[0]),d.map.getZoom()))},this.createOneArrow=function(e,a,t,r,o,s){var n='<line x1="'+e+'" y1="'+a+'" x2="'+e+'" y2="'+(a-o)+'" stroke="#000" stroke-width="'+50*r+'" marker-end="url(#styledArrow)" ';return n=n+'transform="rotate('+t+" "+e+" "+a+')"  />'},this.createOneCircle=function(e,a,t,r,o){var s='<circle cx="'+e+'" cy="'+a+'" stroke="#000" r="'+50*r+'"';return s+="/>"},this.rotationPoint=function(e,a,t,r,o){var s=Math.PI/180*o,n=Math.cos(s),i=Math.sin(s);return[n*(t-e)+i*(r-a)+e,n*(r-a)-i*(t-e)+a]},this.getTrianglePoints=function(e,a,t){var r=e.y,o=e.x-0,s=e.y,n=e.x-a,i=e.y-a/2,l=e.x,m=e.y+a/2,p=e.x,y=d.rotationPoint(o,r,n,s,t),c=d.rotationPoint(o,r,l,i,t),g=d.rotationPoint(o,r,p,m,t);return y[1]+" "+y[0]+" "+c[1]+" "+c[0]+" "+g[1]+" "+g[0]},this.createOneTriangle=function(e,a,t,r,o,s,n){var i=d.getTrianglePoints({x:a,y:e},o,t),l='<polygon points="'+i+'"  style="fill:'+n+";stroke:"+n+";stroke-width:"+50*r+'"   />';return"emptyTriangle"==s&&(l='<polygon points="'+i+'"  fill="none" style="stroke:'+n+";stroke-width:"+50*r+'"   />'),l},this.addSvgOverlay=function(e,a,r){if(!_.isUndefined(e)&&!_.isEmpty(e)&&e!={}&&!_.isUndefined(e.data)){var o=e.config.title,s=e.config.addAs,n=e.config.disableAutoscale;if(!_.isUndefined(modelsHiddenParams[t].svgOverlay.svgElements[a-1])&&!_.isUndefined(modelsHiddenParams[t].svgOverlay.svgElements[a-1].currentZoom)){var i=d.map.getZoom();modelsHiddenParams[t].svgOverlay.svgElements[a-1].currentZoom!=i&&(r=!1)}r?d.appendSvgOverlay(e,a):(n||d.autoscaleSvg(e),_.isEmpty(d.mapLayers.svgOverlay.svgLayers[a-1])||(d.ctrl.removeLayer(d.mapLayers.svgOverlay.svgLayers[a-1]),d.map.removeLayer(d.mapLayers.svgOverlay.svgLayers[a-1])),d.mapLayers.svgOverlay.svgLayers[a-1]=L.layerGroup().addLayer(d.createSvgOverlay(e,a)).addTo(d.map),"overlay"==s?d.ctrl.addOverlay(d.mapLayers.svgOverlay.svgLayers[a-1],o):d.ctrl.addBaseLayer(d.mapLayers.svgOverlay.svgLayers[a-1],o))}},this.psetSvg=function(e,a){if(!_.isUndefined(e)&&!_.isEmpty(e)&&!_.isEmpty(e.data)){var t,r=e.data;t=_.isUndefined(e.config)?{data:[r]}:{data:[r],config:e.config},_.isEmpty(d.mapLayers.svgOverlay.svgLayers[a-1])?d.addSvgOverlay(t,a,!1):d.addSvgOverlay(t,a,!0)}},this.createLabelIcon=function(e,a){return L.divIcon({className:e,html:a})},this.drawHeatMap2=function(e,a){if(_.isEmpty(d.mapLayers.heatMap.heatMapLayers[a-1])||(d.ctrl.removeLayer(d.mapLayers.heatMap.heatMapLayers[a-1]),d.map.removeLayer(d.mapLayers.heatMap.heatMapLayers[a-1]),d.mapLayers.heatMap.heatMapLayers[a-1].remove(),delete d.mapLayers.heatMap.heatMapLayers[a-1]),_.isUndefined(e))return;if(_.isEmpty(e))return;if(_.isUndefined(e.data))return;if(heatMapData=e.data,_.isEmpty(heatMapData)||0==heatMapData.length){var t=L.layerGroup([]);return d.mapLayers.heatMap.heatMapLayers[a-1]=t.addTo(d.map),d.ctrl.addBaseLayer(d.mapLayers.heatMap.heatMapLayers[a-1],"none"),void(_.isUndefined($("input[name='leaflet-base-layers']")[d.numberOfHeatMapLayers-1])||$("input[name='leaflet-base-layers']")[d.numberOfHeatMapLayers-1].click())}let r,o,s,n=.8,i=5,l=!1,p=!1;try{heatMapConfig=e.config,n=heatMapConfig.opacity||n,i=heatMapConfig.radius||i,r=heatMapConfig.max,o=heatMapConfig.min,l=heatMapConfig.disableAutoscale,p=heatMapConfig.addTextLabel,s=d.getColorScale(heatMapConfig.colorScale,heatMapConfig.reverseColorScale,0,100)}catch(e){}const y=[];let c=-Number.MAX_VALUE,g=Number.MAX_VALUE;const u=[],f=[],h=[],M=_.keys(heatMapData[0])[2];for(var H=0;H<heatMapData.length;H++)y[H]=_.values(heatMapData[H]),u[H]=y[H][0],f[H]=y[H][1],null!==y[H][2]&&(y[H][2]>c&&(c=y[H][2]),y[H][2]<g&&(g=y[H][2]));for(_.isUndefined(r)&&(r=1==heatMapData.length?1:c),_.isUndefined(o)&&(o=1==heatMapData.length?0:g),H=0;H<heatMapData.length;H++)null!==y[H][2]&&(y[H][2]>r?h[H]=100:y[H][2]<o?h[H]=0:h[H]=100*(y[H][2]-o)/(r-o));var O=[],v="#000000";for(H=0;H<y.length;H++)v=null!==h[H]?s(h[H]):"#000000",O.push(L.circle([u[H],f[H]],{stroke:!1,color:v,fillColor:v,fillOpacity:n,radius:i,stroke:!1})),p&&O.push(L.marker(new L.LatLng(u[H],f[H]),{icon:d.createLabelIcon("boldWhiteHeatMapLabel",nFormatter(y[H][2]))}));d.configStore[a-1]={color:s,fillOpacity:n,radius:i,minValue:o,maxValue:r};t=L.layerGroup(O);if(d.mapLayers.heatMap.heatMapLayers[a-1]=t.addTo(d.map),d.ctrl.addBaseLayer(d.mapLayers.heatMap.heatMapLayers[a-1],M),!l){var P=L.latLng(_.max(u),_.max(f)),E=L.latLng(_.min(u),_.min(f)),b=L.latLngBounds(P,E);d.map.fitBounds(b)}d.map.invalidateSize(),d.createLegend(s,100,m,o,r,M),d.showLegend(M),_.isUndefined($("input[name*='leaflet-base-layers']")[d.numberOfHeatMapLayers-1])||$("input[name*='leaflet-base-layers']")[d.numberOfHeatMapLayers-1].click()},this.createLegend=function(e,a,r,o,s,n){o=Number(o),s=Number(s);_.isUndefined(modelsHiddenParams[t].legends[n])||d.map.removeControl(modelsHiddenParams[t].legends[n]),modelsHiddenParams[t].legends[n]=L.control({position:"topleft"}),modelsHiddenParams[t].legends[n].onAdd=function(t){for(var i=L.DomUtil.create("div","scaleLegend"),l="",d=0;d<a;d++)l=l+'<rect height="10" x="'+4*d+'" width="4" style="fill: '+e(d)+';"></rect>';var m,p='<svg id="legend" width="450" height="50"><g class="key" transform="translate(25,16)">'+l,y=o;m=nFormatter(o,2);for(d=0;d<r.length;d++)p=p+'<g class="tick" transform="translate('+4*r[d]+',0)" style="opacity: 1;"><line y2="-1" x2="0"></line><text dy="0em" y="-4" x="0" style="text-anchor: middle;">'+m+"</text></g>",y+=(s-o)/4,m=nFormatter(y,2);return p=(p+='<path class="domain" d="M0,-1V0H400V-1"></path>')+'<text class="" y="21">'+n+"</text>",p+="</g></svg>",i.innerHTML=p,i}},this.drawHeatMap1=function(e,a){if(_.isEmpty(d.mapLayers.heatMap.heatMapLayers[a-1])||(d.ctrl.removeLayer(d.mapLayers.heatMap.heatMapLayers[a-1]),d.map.removeLayer(d.mapLayers.heatMap.heatMapLayers[a-1]),d.mapLayers.heatMap.heatMapLayers[a-1].remove(),delete d.mapLayers.heatMap.heatMapLayers[a-1]),!(_.isUndefined(e)||_.isEmpty(e)||_.isUndefined(e.data)||(heatMapData=e.data,_.isUndefined(heatMapData.length)))){for(var t=[],r=Number.MIN_VALUE,o=[],s=[],n=_.keys(heatMapData[0])[2],i=0;i<heatMapData.length;i++)t[i]=_.values(heatMapData[i]),o[i]=t[i][0],s[i]=t[i][1],t[i][2]>r&&(r=t[i][2]);1==heatMapData.length&&(r=1),r=1;var l,m,p,y,c,g=null,u=!1;try{heatMapConfig=e.config,l=heatMapConfig.minOpacity,m=heatMapConfig.maxZoom,p=heatMapConfig.radius,y=heatMapConfig.blur,u=heatMapConfig.disableAutoscale,g=new Object,c=d.getColorScale(heatMapConfig.colorScale,heatMapConfig.reverseColorScale,0,1),d3.range(11).forEach((e=>g[.1*e]=c(.1*e)))}catch(e){g=null}if(d.mapLayers.heatMap.heatMapLayers[a-1]=L.meanLayer(t,{minOpacity:l,maxZoom:m,max:r,radius:p,blur:y,gradient:g}).addTo(d.map),d.ctrl.addBaseLayer(d.mapLayers.heatMap.heatMapLayers[a-1],n),!u){var f=L.latLng(_.max(o),_.max(s)),h=L.latLng(_.min(o),_.min(s)),M=L.latLngBounds(f,h);d.map.fitBounds(M)}d.map.invalidateSize()}},_.isUndefined(modelsParameters[t].heatMap.densityHeatMap)||modelsParameters[t].heatMap.densityHeatMap?this.drawHeatMap=d.drawHeatMap1:this.drawHeatMap=d.drawHeatMap2,this.clearHeatMapLayer=function(e){d.mapLayers.heatMap.heatMapLayers[e-1].clearLayers()},this.psetHeatMap=function(e,a){if(!_.isUndefined(e)&&!_.isEmpty(e)&&!_.isEmpty(e.data)){var r,o=e.data;r=_.isUndefined(e.config)?{data:[o]}:{data:[o],config:e.config};var s=_.values(e.data);if(_.isEmpty(d.mapLayers.heatMap.heatMapLayers[a-1]))d.drawHeatMap(r,a);else{if(_.isUndefined(modelsParameters[t].heatMap.densityHeatMap))d.mapLayers.heatMap.heatMapLayers[a-1].addLatLng(s);else if(modelsHiddenParams[t].heatMap.densityHeatMap)d.mapLayers.heatMap.heatMapLayers[a-1].addLatLng(s);else{const n=r.config||{},i={circleFillOpacity:n.opacity,circleRadius:n.radius,maxValue:n.max,minValue:n.min},l=d.configStore[a-1],m={circleFillOpacity:l.fillOpacity,circleRadius:l.radius,maxValue:l.maxValue,minValue:l.minValue};if(!(void 0!==i.circleFillOpacity&&i.circleFillOpacity!==m.circleFillOpacity||void 0!==i.circleRadius&&i.circleRadius!==m.circleRadius||void 0!==i.maxValue&&i.maxValue!==m.maxValue||void 0!==i.minValue&&i.minValue!==m.minValue)){let e=100*(s[2]-d.configStore[a-1].minValue)/(d.configStore[a-1].maxValue-d.configStore[a-1].minValue);e<0&&(e=0),e>100&&(e=100),modelsHiddenParams[t].heatMap.heatMapBuffer[a-1].push(o);const r=L.circle([o.lat,o.lng],{color:d.configStore[a-1].color(e),fillColor:d.configStore[a-1].color(e),fillOpacity:d.configStore[a-1].fillOpacity,radius:d.configStore[a-1].radius,stroke:!1});d.mapLayers.heatMap.heatMapLayers[a-1].addLayer(r)}else{d.configStore[a-1].minValue=r.config.min,d.configStore[a-1].maxValue=r.config.max,d.configStore[a-1].radius=r.config.radius,d.configStore[a-1].fillOpacity=r.config.opacity,d.clearHeatMapLayer(a),modelsHiddenParams[t].heatMap.heatMapBuffer[a-1].push(o);const s={data:modelsHiddenParams[t].heatMap.heatMapBuffer[a-1],config:e.config};d.drawHeatMap(s,a)}}_.isUndefined(e.config)||_.isUndefined(e.config.disableAutoscale)?d.map.setView(o):e.config.disableAutoscale||d.map.setView(o)}}},modelsParameters[t].geoJson.numberOfLayers>0)for(let e=1;e<=d.numberOfGeoJsonLayers;e++){_.isUndefined(modelsHiddenParams[t].geoJson.geoJsonLayers[e-1])&&(modelsHiddenParams[t].geoJson.geoJsonLayers[e-1]={}),_.isUndefined(d.mapLayers.geoJson.geoJsonLayers[e-1])&&(d.mapLayers.geoJson.geoJsonLayers[e-1]={});this["geoJson"+e]={layerIndex:e,updateCallback:function(){},setValue:function(e){modelsHiddenParams[t].geoJson.geoJsonLayers[this.layerIndex-1]=e,d.addGeoJson(e,this.layerIndex)},getValue:function(){return modelsHiddenParams[t].geoJson.geoJsonLayers[e-1]},addValueChangedHandler:function(e){this.updateCallback=e},removeValueChangedHandler:function(e){}}}if(modelsParameters[t].choropleth&&modelsParameters[t].choropleth.numberOfLayers>0)for(let e=1;e<=d.numberOfChoroplethLayers;e++){_.isUndefined(modelsHiddenParams[t].choropleth.choroplethLayers[e-1])&&(modelsHiddenParams[t].choropleth.choroplethLayers[e-1]={}),_.isUndefined(d.mapLayers.choropleth.choroplethLayers[e-1])&&(d.mapLayers.choropleth.choroplethLayers[e-1]={});this["choropleth"+e]={layerIndex:e,updateCallback:function(){},setValue:function(e){modelsHiddenParams[t].choropleth.choroplethLayers[this.layerIndex-1]=e,d.addChoropleth(e,this.layerIndex)},getValue:function(){return modelsHiddenParams[t].choropleth.choroplethLayers[e-1]},addValueChangedHandler:function(e){this.updateCallback=e},removeValueChangedHandler:function(e){}}}if(modelsParameters[t].lineHeatMap&&modelsParameters[t].lineHeatMap.numberOfLayers>0)for(let e=1;e<=d.numberOfLineHeatMapLayers;e++){_.isUndefined(modelsHiddenParams[t].lineHeatMap.lineHeatMapLayers[e-1])&&(modelsHiddenParams[t].lineHeatMap.lineHeatMapLayers[e-1]={}),_.isUndefined(d.mapLayers.lineHeatMap.lineHeatMapLayers[e-1])&&(d.mapLayers.lineHeatMap.lineHeatMapLayers[e-1]={});this["lineHeatMap"+e]={layerIndex:e,updateCallback:function(){},setValue:function(e){modelsHiddenParams[t].lineHeatMap.lineHeatMapLayers[this.layerIndex-1]=e,d.addLineHeatMap(e,this.layerIndex)},getValue:function(){return modelsHiddenParams[t].lineHeatMap.lineHeatMapLayers[e-1]},addValueChangedHandler:function(e){this.updateCallback=e},removeValueChangedHandler:function(e){}}}if(modelsParameters[t].heatMap.numberOfLayers>0)for(let e=1;e<=d.numberOfHeatMapLayers;e++){const a="heatMapData"+e,r="heatMapPoint"+e;_.isUndefined(modelsHiddenParams[t].heatMap.heatMapData[e-1])&&(modelsHiddenParams[t].heatMap.heatMapData[e-1]={}),_.isUndefined(modelsHiddenParams[t].heatMap.heatMapBuffer[e-1])&&(modelsHiddenParams[t].heatMap.heatMapBuffer[e-1]=[]),_.isUndefined(d.mapLayers.heatMap.heatMapLayers[e-1])&&(d.mapLayers.heatMap.heatMapLayers[e-1]={}),modelsParameters[t].heatMap.sampledDisplay?this[r]={layerIndex:e,updateCallback:function(){},setValue:function(e){d.bIsInteractive&&d.psetHeatMap(e,this.layerIndex)},getValue:function(){},addValueChangedHandler:function(e){this.updateCallback=e},removeValueChangedHandler:function(e){}}:this[a]={layerIndex:e,updateCallback:function(){},setValue:function(e){e!=modelsHiddenParams[t].heatMap.heatMapData[this.layerIndex-1]&&(modelsHiddenParams[t].heatMap.heatMapData[this.layerIndex-1]=e,d.drawHeatMap(e,this.layerIndex))},getValue:function(){return modelsHiddenParams[t].heatMap.heatMapData[this.layerIndex-1]},addValueChangedHandler:function(e){this.updateCallback=e},removeValueChangedHandler:function(e){}}}if(d.numberOfImageLayers>0)for(let e=1;e<=d.numberOfImageLayers;e++){const a="imageOverlay"+e;_.isUndefined(modelsHiddenParams[t].imageOverlay.imageData[e-1])&&(modelsHiddenParams[t].imageOverlay.imageData[e-1]={}),_.isUndefined(d.mapLayers.imageOverlay.imageLayers[e-1])&&(d.mapLayers.imageOverlay.imageLayers[e-1]={}),this[a]={layerIndex:e,updateCallback:function(){},setValue:function(e){e!=modelsHiddenParams[t].imageOverlay.imageData[this.layerIndex-1]&&(modelsHiddenParams[t].imageOverlay.imageData[this.layerIndex-1]=e,d.addImageOverlay(e,this.layerIndex))},getValue:function(){return modelsHiddenParams[t].imageOverlay.imageData[this.layerIndex-1]},addValueChangedHandler:function(e){this.updateCallback=e},removeValueChangedHandler:function(e){}}}if(d.numberOfSvgLayers>0)for(let e=1;e<=d.numberOfSvgLayers;e++){const a="svgOverlay"+e,r="svgPoint"+e;_.isUndefined(modelsHiddenParams[t].svgOverlay.svgData[e-1])&&(modelsHiddenParams[t].svgOverlay.svgData[e-1]={}),_.isUndefined(d.mapLayers.svgOverlay.svgLayers[e-1])&&(d.mapLayers.svgOverlay.svgLayers[e-1]={}),modelsParameters[t].svgOverlay.sampledDisplay?this[r]={layerIndex:e,updateCallback:function(){},setValue:function(e){d.bIsInteractive&&d.psetSvg(e,this.layerIndex)},getValue:function(){},addValueChangedHandler:function(e){this.updateCallback=e},removeValueChangedHandler:function(e){}}:this[a]={layerIndex:e,updateCallback:function(){},setValue:function(e){modelsHiddenParams[t].svgOverlay.svgData[this.layerIndex-1]=e,d.addSvgOverlay(e,this.layerIndex,!1)},getValue:function(){return modelsHiddenParams[t].svgOverlay.svgData[this.layerIndex-1]},addValueChangedHandler:function(e){this.updateCallback=e},removeValueChangedHandler:function(e){}}}const y=new WidgetActuatorDescription("selectedPoint","Selected coordinates",WidgetActuatorDescription.WRITE,_SCHEMA_SELECTED_POINT),c=new WidgetActuatorDescription("selectedGeoJson","Drawn GeoJSON figure",WidgetActuatorDescription.WRITE,_SCHEMA_SELECTED_GEOJSON);this.getActuatorDescriptions=function(e=null){const a=e||modelsParameters[t],r=[];if(a){if(a.captureClickEvent&&r.push(y),a.drawingFeatures&&r.push(c),a.geoJson&&a.geoJson.numberOfLayers)for(let e=1;e<=a.geoJson.numberOfLayers;e++)r.push(new WidgetActuatorDescription("geoJson"+e,"GeoJSON features",WidgetActuatorDescription.READ,_SCHEMA_GEOJSON));if(a.lineHeatMap&&a.lineHeatMap.numberOfLayers)for(let e=1;e<=a.lineHeatMap.numberOfLayers;e++)r.push(new WidgetActuatorDescription("lineHeatMap"+e,"Lines colored by values",WidgetActuatorDescription.READ,_SCHEMA_LINE_HEATMAP));if(a.choropleth&&a.choropleth.numberOfLayers)for(let e=1;e<=a.choropleth.numberOfLayers;e++)r.push(new WidgetActuatorDescription("choropleth"+e,"Choropleth data",WidgetActuatorDescription.READ,_SCHEMA_CHOROPLETH));if(a.heatMap&&a.heatMap.numberOfLayers)for(let e=1;e<=a.heatMap.numberOfLayers;e++)if(a.heatMap.sampledDisplay){const t="heatMapPoint"+e;a&&!a.densityHeatMap?r.push(new WidgetActuatorDescription(t,"Cumulative heatmap",WidgetActuatorDescription.READ,_SCHEMA_HEATMAP_SAMPLED)):r.push(new WidgetActuatorDescription(t,"Cumulative density heatmap",WidgetActuatorDescription.READ,_SCHEMA_HEATMAP_DENSITY_SAMPLED))}else{const t="heatMapData"+e;a&&!a.densityHeatMap?r.push(new WidgetActuatorDescription(t,"Heatmap",WidgetActuatorDescription.READ,_SCHEMA_HEATMAP)):r.push(new WidgetActuatorDescription(t,"Density heatmap",WidgetActuatorDescription.READ,_SCHEMA_HEATMAP_DENSITY))}if(a.imageOverlay&&a.imageOverlay.numberOfLayers)for(let e=1;e<=a.imageOverlay.numberOfLayers;e++)r.push(new WidgetActuatorDescription("imageOverlay"+e,"Image to place on the map",WidgetActuatorDescription.READ,_SCHEMA_IMAGE_OVERLAY));if(a.svgOverlay&&a.svgOverlay.numberOfLayers)for(let e=1;e<=a.svgOverlay.numberOfLayers;e++)a.svgOverlay.sampledDisplay?r.push(new WidgetActuatorDescription("svgPoint"+e,"Place a symbol on the map",WidgetActuatorDescription.READ,_SCHEMA_SVG_POINT_OVERLAY)):r.push(new WidgetActuatorDescription("svgOverlay"+e,"Place symbols on the map",WidgetActuatorDescription.READ,_SCHEMA_SVG_OVERLAY))}return r},d.render()},this.openStreetMapsWidget.prototype=baseWidget.prototype,this.pluginDefinition={name:"Maps",widgetsDefinitionList:{openStreetMaps:{factory:"openStreetMapsWidget",title:"Leaflet JSON maps",icn:"map",help:"wdg/wdg-geo-time/#leaflet-maps"}}},this.constructor()}mapWidgetsPluginClass.prototype=basePlugin.prototype;var mapWidgetsPlugin=new mapWidgetsPluginClass;widgetsPluginsHandler.loadWidgetPlugin(mapWidgetsPlugin);
function foliumWidgetPluginClass(){this.foliumMapWidget=function(i,t,e,n){this.constructor(i,t,e,n);var l=this;this.enable=function(){},this.disable=function(){},this.rescale=function(){this.render()},this.hasScrollBar=function(i){return i.get(0).scrollHeight>i.get(0).clientHeight},this.render=function(){let l=document.createElement("div"),o="folium-map"+t;if(n&&(o+="c"),l.setAttribute("id",o),modelsHiddenParams[e].map){l.innerHTML=modelsHiddenParams[e].map;try{div1=l.firstElementChild,"DIV"==div1.tagName&&(div1.style.height="100%",div2=div1.firstElementChild,"DIV"==div2.tagName&&(div2.style.height="100%",div2.style["padding-bottom"]=null,div3=div2.firstElementChild,"DIV"==div3.tagName&&(div3.style.height="100%")))}catch(i){console.log(i)}}l.setAttribute("style","width: inherit; height: inherit; background-color: rgba(0, 0, 0, 0)"),$("#"+i).html(l)};const o=new WidgetActuatorDescription("_repr_html_","Folium Map _repr_html_",WidgetActuatorDescription.READ,WidgetPrototypesManager.SCHEMA_STRING);this.getActuatorDescriptions=function(){return[o]},this._repr_html_={setValue:function(i){modelsHiddenParams[e].map=i,l.render()},getValue:function(){return modelsHiddenParams[e].map},addValueChangedHandler:function(i){l.enable()},removeValueChangedHandler:function(i){l.disable()}},l.render()},this.foliumMapWidget.prototype=baseWidget.prototype,this.pluginDefinition={name:"Maps",widgetsDefinitionList:{foliumMaps:{factory:"foliumMapWidget",title:"Folium maps",icn:"folium",help:""}}},this.constructor()}modelsHiddenParams.foliumMaps={map:""},modelsParameters.foliumMaps={},modelsLayout.foliumMaps={height:"30vh",width:"30vw",minWidth:"50px",minHeight:"32px"},foliumWidgetPluginClass.prototype=basePlugin.prototype;var foliumWidgetPlugin=new foliumWidgetPluginClass;widgetsPluginsHandler.loadWidgetPlugin(foliumWidgetPlugin);
var scalingManager=function(h,t,e){var i=this;function w(h){switch(i.method){case"scaleTwSp":return i.scaleTwSp(h);case"scaleTwSpWS":return i.scaleTwSpWS(h);case"scaleTwSd":return i.scaleTwSd(h);case"scaleTwh":return i.scaleTwh(h);case"scaleTwhS":return i.scaleTwhS(h);default:return i.scaleIdent(h)}}return i.srcDash=h,i.tgDash=t,i.method=e,this.scaleTwSp=function(h){if(_.isUndefined(i.srcDash))return h;var t={},e=i.tgDash,w=i.srcDash;return t.widthVw=h.widthVw/w.widthVw*e.widthVw,t.leftVw=h.leftVw/w.widthVw*e.widthVw,t.heightVh=h.heightVh*(w.heightPx/w.widthPx)*(e.widthPx/e.heightPx)*(e.heightVh/w.heightVh),t.topVh=h.topVh*(w.heightPx/w.widthPx)*(e.widthPx/e.heightPx)*(e.heightVh/w.heightVh),t},this.scaleTwSpWS=function(h){if(_.isUndefined(i.srcDash))return h;var t={},e=i.tgDash,w=i.srcDash;return t.widthVw=h.widthVw/w.scrollWidthVw*e.widthVw,t.leftVw=h.leftVw/w.scrollWidthVw*e.widthVw,t.heightVh=h.heightVh*(w.heightPx/w.scrollWidthPx)*(e.widthPx/e.heightPx)*(e.heightVh/w.heightVh),t.topVh=h.topVh*(w.heightPx/w.scrollWidthPx)*(e.widthPx/e.heightPx)*(e.heightVh/w.heightVh),t},this.scaleTwSd=function(h){if(_.isUndefined(i.srcDash))return h;var t={},e=i.tgDash,w=i.srcDash;return t.widthVw=h.widthVw/w.widthVw*e.widthVw,t.leftVw=h.leftVw/w.widthVw*e.widthVw,h.widthPx=h.widthVw/w.widthVw*w.widthPx,h.heightPx=h.heightVh/w.heightVh*w.heightPx,h.topPx=h.topVh/w.heightVh*w.heightPx,t.heightPx=h.heightPx,t.topPx=h.topPx,t},this.scaleTwh=function(h){if(_.isUndefined(i.srcDash))return h;var t={},e=i.tgDash,w=i.srcDash;return t.widthVw=h.widthVw/w.widthVw*e.widthVw,t.leftVw=h.leftVw/w.widthVw*e.widthVw,t.heightVh=h.heightVh/w.heightVh*e.heightVh,t.topVh=h.topVh/w.heightVh*e.heightVh,t},this.scaleTwhS=function(h){if(_.isUndefined(i.srcDash))return h;var t={},e=i.tgDash,w=i.srcDash;return t.widthVw=h.widthVw/w.scrollWidthVw*e.widthVw,t.leftVw=h.leftVw/w.scrollWidthVw*e.widthVw,t.heightVh=h.heightVh/w.scrollHeightVh*e.heightVh,t.topVh=h.topVh/w.scrollHeightVh*e.heightVh,t},this.scaleIdent=function(h){if(_.isUndefined(i.srcDash))return h;var t={};i.tgDash,i.srcDash;return t.widthVw=h.widthVw,t.leftVw=h.leftVw,t.heightVh=h.heightVh,t.topVh=h.topVh,t},{setMethod:function(h){i.method=h},scale:w,applyRescale:function(h){var t,e,i,V,s,d,r,n;if(h.nodeType==Node.ELEMENT_NODE)for(t=h.style.width,s=rmUnit(t),V=h.style.left,d=rmUnit(V),e=h.style.height,r=rmUnit(e),i=h.style.top,n=w({widthVw:s,leftVw:d,heightVh:r,topVh:rmUnit(i)}),h.style.width=n.widthVw+"vw",h.style.left=n.leftVw+"vw",h.style.height=n.heightVh+"vh",h.style.top=n.topVh+"vh",wcChildren=h.getElementsByTagName("div"),k=0;k<wcChildren.length;k++)-1!=wcChildren[k].id.search("WidgetContainer")&&(wcChildren[k].style.width=n.widthVw-100/document.documentElement.clientWidth*2+"vw",wcChildren[k].style.height=n.heightVh-100/document.documentElement.clientHeight*2+"vh")}}};
var inputHandler={encodeInputPars:function(a){return btoa(JSON.stringify(a))},decodeInputPars:function(a){try{return JSON.parse(atob(a))}catch(a){return console.log(a),null}},patchInputVariables:function(a,t){return _.each(t,(t=>{a=function(a,t,n){let e=!1;for(var o=0;o<a.data.datanodes.length;o++)a.data.datanodes[o].name==t&&(e=!0,"JSON_var_plugin"==a.data.datanodes[o].type?a.data.datanodes[o].settings.json_var=JSON.stringify(n):console.log("patchVariableDataNode failed : dataNode "+t+"  is not a variable"));return e||console.log("patchVariableDataNode failed : unable to find dataNode "+t),a}(a,t.dsName,t.dsVal)})),a}};
var rescaleHelper=function(e,t,i){var o=this;function s(){switch(o.mode){case"edit":return"";case"preview":return"c"}}function r(){var e="";switch(o.mode){case"edit":break;case"preview":e="c"}if(o.rows){const t=o.cols*o.rows;switch(o.scalingMethod){case"scaleTwhS":for(let i=1;i<=t;i++)$("#dpr"+i+e)[0].style.height="100%";break;case"scaleTwSp":for(let t=1;t<=o.rows;t++){const i=o.cellProportion[t],s=(t-1)*o.cols+1,r=$("#dpr"+s+e).width(),n=Math.floor(i*r)+2;for(let t=0;t<o.cols;t++)$("#dpr"+(s+t)+e)[0].style.height=n+"px"}break;case"scaleTwh":case"scaleIdent":for(let e=1;e<=o.rows;e++){o.cols;for(let e=0;e<o.cols;e++);}}if("edit"===o.mode)layoutMgr.updateMaxTopAndLeft()}}function n(){let e=null;const t=$("#dpr1"+s());switch(o.rows){case 0:break;case 1:if(e={widthPx:t.width()+2,heightPx:t.height()+2,widthVw:100*(t.width()+2)/document.documentElement.clientWidth,heightVh:100*(t.height()+2)/document.documentElement.clientHeight},"undefined"!=typeof layoutMgr){const t=layoutMgr.getHeightCols();e.rowHeightPercent=t.length?t[0]:100}break;default:if(e={widthPx:t.width()+16,heightPx:t.height()+2,widthVw:100*(t.width()+16)/document.documentElement.clientWidth,heightVh:100*(t.height()+2)/document.documentElement.clientHeight},"undefined"!=typeof layoutMgr){const t=layoutMgr.getHeightCols();e.rowHeightPercent=t.length?t[0]:100}}return e}function d(){if(0===o.rows)o.cellProportion=1;else{o.cellProportion=[];for(let e=1;e<=o.rows;e++){const t=1+(e-1)*o.cols,i=$("#dpr"+t+s());o.cellProportion[e]=i.height()/i.width()}}}return o.dashboardDimensions=e,o.scalingMethod=t,o.mode=i,o.cellProportion=1,o.rows=0,o.cols=1,{setDimensions:function(e){o.dashboardDimensions=e},setScalingMethod:function(e){o.scalingMethod=e},setRows:function(e){o.rows=e},setCols:function(e){o.cols=e},getCols:function(){return o.cols},resizeDashboard:function(e){r();var t=function(){switch(o.mode){case"edit":return widgetEditor.getCurrentDashZoneDims();case"preview":return widgetPreview.getCurrentDashZoneDims()}}(o.mode);_.isUndefined(e)||e.widthVw>0&&e.widthPx>0&&(t=e);var i=new scalingManager(o.dashboardDimensions,t,o.scalingMethod);o.dashboardDimensions=t;const n=function(){switch(o.mode){case"edit":return document.getElementById("drop-zone");case"preview":return document.getElementById("dashboard-zone")}}(o.mode);for(let e=0;e<n.childNodes.length;e++){const t=n.childNodes[e];if(t.id=="DropperDroite"+s(o.mode))for(let e=0;e<t.childNodes.length;e++){const s=t.childNodes[e];if(""===s.id)return;if($("#"+s.id).hasClass("device-col"))for(let e=0;e<s.childNodes.length;e++){let t;t="edit"==o.mode?s.childNodes[e].childNodes[0]:s.childNodes[e],i.applyRescale(t)}else{let e;e="edit"==o.mode?s.childNodes[0]:s,i.applyRescale(e)}}}},resizeWidgetOnMediaChange:function(e,t){const i=function(){switch(o.mode){case"edit":return widgetEditor.getWidgetsRelativeDims().width;case"preview":return widgetPreview.getWidgetsRelativeDims().width}}(),s=function(){switch(o.mode){case"edit":return widgetEditor.getWidgetsRelativeDims().height;case"preview":return widgetPreview.getWidgetsRelativeDims().height}}(),r=function(){switch(o.mode){case"edit":return widgetEditor.getWidgetsRelativeDims().left;case"preview":return widgetPreview.getWidgetsRelativeDims().left}}(),n=function(){switch(o.mode){case"edit":return widgetEditor.getWidgetsRelativeDims().top;case"preview":return widgetPreview.getWidgetsRelativeDims().top}}(),d=$("#"+t)[0];let c=0,h=0,l=0,a=0;switch(o.mode){case"edit":c=$(d.parentNode.parentNode).width()*i[e]+2,h=$(d.parentNode.parentNode).height()*s[e]+2,l=$(d.parentNode.parentNode).width()*r[e],a=$(d.parentNode.parentNode).height()*n[e];break;case"preview":c=$(d.parentNode).width()*i[e]+2,h=$(d.parentNode).height()*s[e]+2,l=$(d.parentNode).width()*r[e],a=$(d.parentNode).height()*n[e]}const g=rmUnit(unitW(c)),w=rmUnit(unitH(h)),m=rmUnit(unitW(l)),u=rmUnit(unitH(a));d.style.left=m+"vw",d.style.top=u+"vh",d.style.width=g+"vw",d.style.height=w+"vh"},getCurrentDropperDims:n,resizeDashboardCols:r,mediaChangeProjection:function(e,t,i){var o,s=e,r=isMediaChanged(e.media);return r.bChanged,o=r.lastMedia,i?(s.widthVw=e.colDims.widthVw,s.widthPx=e.colDims.widthPx,s.scrollWidthVw=e.colDims.widthVw,s.scrollWidthPx=e.colDims.widthPx,s.heightVh=e.colDims.heightVh,s.heightPx=e.colDims.heightPx,s.scrollHeightVh=e.colDims.heightVh,s.scrollHeightPx=e.colDims.heightPx,{lastMedia:o,referenceFrame:s,targetFrame:t=n()}):{lastMedia:o,referenceFrame:s,targetFrame:t}},setCellProportion:function(e){o.cellProportion=e},updateCellsProportions:d,computeRelativeColHeigth:function(e){var t=100,i=e.heightPx;if(_.isUndefined(e.colDims.heightPx))return 100;switch(t=e.colDims.heightPx,o.scalingMethod){case"scaleTwhS":return 100;case"scaleTwSp":case"scaleTwh":case"scaleIdent":return Math.ceil((t+2)/i*100)}},deserialize:function(e){if(!_.isUndefined(e)){if(e.colDims)if(0===o.rows)o.cellProportion=1;else{o.cellProportion=[];for(let t=1;t<=o.rows;t++)o.cellProportion[t]=e.colDims.heightPx/e.colDims.widthPx}switch(e.scalingMethod){case"scaleTwSp":break;case"scaleTwh":case"scaleIdent":for(var t=1;t<=o.rows;t++)for(var i=(t-1)*o.cols+1,r=0;r<o.cols;r++)$("#dpr"+(i+r)+s())[0].style.height=e.colDims.heightVh+"vh";d()}}}}};
function gridMgrClass(){var t=20,i=20;this.getGrid=function(){return $("#DropperDroite")[0].classList.contains("show-grid")?{sizeX:t,sizeY:i}:null},this.updateGrid=function(){!function(){widgetEditor.updateSnapshotDashZoneDims();const r=widgetEditor.getSnapshotDashZoneDims();t=(r.widthPx-22)/48,i=(r.heightPx-4)/24,t=Math.max(1,Math.round(t)),i=Math.max(1,Math.round(i))}();const r=`${t}px ${i}px`;$(".dropperR:not(#DropperDroitec), .dropperR:not(#DropperDroitec) .device-col").each((function(){this.style["background-size"]=r}))}}var gridMgr=new gridMgrClass;
const keyShift=5,minLeftCst=10,minTopCst=10,minHeightCst=10,minWidthCst=10,MULTIPLE_HEIGHT=!1;class LayoutMgrClass{constructor(){this.drprD=$("#DropperDroite")[0],this.rows=0,this.cols=0,this.heightCols=[],this.newHeightCols=[],this.maxTopCst=15*this.drprD.offsetHeight,0==this.maxTopCst&&(this.maxTopCst=15*$("#DropperDroite").height()),this.maxLeftCst=panelDash.fullScreenWidth-10,this.scalingHelper=void 0,this.rowNames=[],this.defaultRow={},this.defaultBgColor="var(--widget-color-0)",this.dashBgColor="",this.inheritThemeBgColor=!0,this.dashboardTheme="default",this.$rootScope=angular.element(document.body).scope().$root}findAllCells(){return $("#DropperDroite [id^='dpr']")}updateButtonState(){const t=this._readRows(),e=t?this._readCols():0;0===t?($("#select-cols").attr("disabled",!0),$("#height-row-button").attr("disabled",!0),$("#select-cols").val("1")):($("#select-cols").attr("disabled",!1),$("#height-row-button").attr("disabled",!1));const s=this.rows!==t||this.cols!==e||!angular.equals(this.heightCols,this.newHeightCols);$("#buttonDevice").prop("disabled",!s)}isRowColMode(){return this.rows>=1}getDefaultContainer(){return this.isRowColMode()?$("#dpr1")[0]:this.drprD}setScalingHelper(t){this.scalingHelper=t}updateMaxTopAndLeft(){const t=$(this.drprD);0===this.rows?(t.hasClass("overflow-type1")||(t.addClass("overflow-type1"),t.removeClass("overflow-type2"),t.removeClass("overflow-type3")),this.maxLeftCst=panelDash.fullScreenWidth-10,this.maxTopCst=15*this.drprD.offsetHeight,0==this.maxTopCst&&(this.maxTopCst=15*$("#DropperDroite").height())):1===this.rows?(t.hasClass("overflow-type2")||(t.addClass("overflow-type2"),t.removeClass("overflow-type1"),t.removeClass("overflow-type3")),this.maxLeftCst=this.drprD.offsetWidth-10-14,this.maxTopCst=this.drprD.childNodes[0].offsetHeight-10):this.rows>1&&(t.hasClass("overflow-type3")||(t.addClass("overflow-type3"),t.removeClass("overflow-type1"),t.removeClass("overflow-type2")),this.maxLeftCst=this.drprD.offsetWidth-10-14,this.maxTopCst=this.drprD.childNodes[0].offsetHeight*this.rows-10)}_updateNewHeightCols(t){if(0===t)this.newHeightCols=[];else{const e=100;if(1!==this.newHeightCols.length)this.newHeightCols=[e];else if(t!==this.rows&&1===this.heightCols.length){const t=this.heightCols[0],s=this.newHeightCols[0],o=this.rows*t;t===s&&o>=99&&o<=101&&(this.newHeightCols=[e])}}}configureRowHeight(){const t=this._readRows();if(!t)return;this._updateNewHeightCols(t);let e="";for(let t=0;t<1;t++)e+='<div class="Row">',e+='<div class="CellH"><label style="font-size: calc(8px + 0.4vw);font-weight: bold;">Height (%) of rows</label></div>',e+='<div class="Cell">',e+='<input type="number" min="15" max="150" name="height-cols_'+t+'" style="height:25px;width:100%" id="heightCols_'+t+'" value='+this.newHeightCols[t]+" />",e+="</div>",e+="</div>";e+="</div>";const s=document.createElement("div");s.innerHTML=e,s.setAttribute("style","display: inline-block");const o=this;new DialogBoxForToolboxEdit(s,"Configuration of each height's row","OK","Cancel",(function(){for(let t=0;t<1;t++){const e=parseInt($("#heightCols_"+t).val(),10);void 0!==e&&e>0&&(o.newHeightCols[t]=e)}}))}getRows(){return this.rows}getHeightCols(){return[...this.heightCols]}_readRows(){const t=$("#select-rows").val();return parseInt(t,10)}_readCols(){const t=$("#select-cols").val();return parseInt(t,10)}applyCells(){const t=this._readRows(),e=t?this._readCols():0;$("#DropperDroite")[0].scrollTo({top:0,left:0,behavior:"auto"}),this._updateNewHeightCols(t),angular.element(document.body).injector().invoke(["UndoManagerService","EditorActionFactory",(s,o)=>{const i=o.createUpdateLayoutAction(t,e,this.newHeightCols);s.execute(i)}]),this._updateExportOptions(),this.updateDashBgColor(),this._updateRowNames()}setLayout(t,e,s,o=!1){const i=this.rows!==t||this.cols!==e,h=!angular.equals(this.heightCols,s);if(this.rows=t,this.cols=e,this.newHeightCols=[...s],this.heightCols=[...s],i){this.cleanColumns(),this.scalingHelper.setRows(this.rows),this.scalingHelper.setCols(this.cols);const t=this._getClassType(this.cols);this._createColumn(t),0!==this.rows&&_.each(widgetEditor.modelsId,(t=>{const e=document.getElementById(t);this.putWidgetInTheRightCol(e,10,10)}))}else h&&(this._applyHeights(),this.scalingHelper.updateCellsProportions());if(o&&this.rows){const t=$("#dpr1");parseInt(t.css("min-height"))>t.height()&&swal(t[0].style.height+" is too small considering the size of your screen!","The minimum allowed height '"+t.css("min-height")+"' will be applied.","warning")}this.updateMaxTopAndLeft(),widgetEditor.updateSnapshotDashZoneDims(),$("select[name=select-rows]").val(this.rows),$("select[name=select-cols]").val(this.cols||1),this.updateButtonState()}getCols(){return this.cols}_getClassType(t){let e="";return 0===t?e="":1===t?e="col-md-12":2===t?e="col-md-6":3===t?e="col-md-4":4===t&&(e="col-md-3"),e}getTargetDivLayoutPx(t){return this.isRowColMode()?getElementLayoutPx(t):{top:10,left:10,height:this.maxTopCst,width:this.maxLeftCst}}cleanColumns(){const t=this.findAllCells();t.each(((t,e)=>{const s=$(e).position(),o=s.top,i=s.left,h=[];e.childNodes.forEach((t=>h.push(t))),h.forEach((t=>{const e=t.firstChild,s=$(e).position(),h=s.top,l=s.left;$(t).appendTo($("#DropperDroite")),e.style.top=unitH(o+h),e.style.left=unitW(i+l)}))})),t.remove(),this.drprD.classList.remove("has-device-col")}_getRowHeight(t){return void 0!==this.heightCols[0]?this.heightCols[0]:void 0!==this.heightCols[1]?this.heightCols[1]:100}_createColumn(t){this._createCols(t),this._applyHeights(),this.scalingHelper.updateCellsProportions()}_applyHeights(){for(let t=0;t<this.rows;t++){const e=this._getRowHeight(t),s=t*this.cols+1,o=s+this.cols;for(let t=s;t<o;t++)$("#dpr"+t)[0].style.height=e+"%"}}_createCols(t){if(this.rows){this.drprD.classList.add("has-device-col");const e=this.rows*this.cols;for(let s=1;s<=e;s++){const e=document.createElement("div");e.setAttribute("class",t+" device-col drop-zone-col"),e.setAttribute("id","dpr"+s),this.drprD.appendChild(e)}gridMgr.updateGrid()}}putWidgetInDrprD(t){if(this.isRowColMode()&&t&&t.parentNode){const e=t.parentNode.parentNode;if(e&&e.id.startsWith("dpr")){const s=t.offsetLeft+e.offsetLeft,o=t.offsetTop+e.offsetTop;$(this.drprD).append(t.parentNode),t.style.left=unitW(s),t.style.top=unitH(o)}}}putWidgetInTheRightCol(t,e,s){if(this.isRowColMode()){const o=t.offsetLeft;for(let i=1;i<=this.cols;i++){const h=o-e>=$("#dpr"+i)[0].offsetLeft;if((1===i||h)&&(i===this.cols||o-e<$("#dpr"+(i+1))[0].offsetLeft)){this._putWidgetInTheRightRow(t,i,e,s);break}}}}_putWidgetInTheRightRow(t,e,s,o){const i=t.offsetTop-o;for(let h=0;h<this.rows;h++){const l=this.cols*h+e,r=$("#dpr"+l)[0],a=i<r.offsetTop+r.offsetHeight,n=i>=r.offsetTop;if((a||h===this.rows-1)&&(n||0===h)){this._dropWidgetAndUpdatePosition(t,r,s,o);break}}}_dropWidgetAndUpdatePosition(t,e,s,o){e.append(t.parentNode);const i=t.offsetLeft-e.offsetLeft,h=t.offsetTop-e.offsetTop;t.style.left=unitW(i),t.style.top=unitH(h);const l=e.offsetWidth-s,r=e.offsetHeight-o;t.offsetTop>r-t.offsetHeight&&(t.style.top=unitH(r-t.offsetHeight)),t.offsetLeft>l-t.offsetWidth&&(t.style.left=unitW(l-t.offsetWidth))}makeColsTrasparent(){for(let t=1;t<=this.rows*this.cols;t++)$("#dpr"+t+"c").hasClass("col-invisible")||$("#dpr"+t+"c").addClass("col-invisible")}clear(){this.clearCols()}clearCols(){this.cols=0,this.rows=0,this.scalingHelper.setRows(this.rows),this.scalingHelper.setCols(this.cols),$('select[name="select-rows"]').val(this.rows),$('select[name="select-cols"]').val(1),this.heightCols=[],this.newHeightCols=[],this.rowNames=[],this.defaultRow={},this.updateMaxTopAndLeft()}getColorValueFromCSSProperty(t){let e=t;if(e.includes("var(--")){const s=t.substring(4,t.length-1);e=window.getComputedStyle(document.documentElement).getPropertyValue(s)}return e}onInputDashBgColor(){this.dashBgColor=$("#inputDashBgColor").val(),$(".dropperR").css("background-color",this.dashBgColor),this.$rootScope.updateFlagDirty(!0)}updateDashBgColor(){const t=this.getColorValueFromCSSProperty(this.dashBgColor);$("#inputDashBgColor").val(t),$(".dropperR").css("background-color",t)}resetDashBgColor(){this.dashBgColor=this.defaultBgColor,this._toggleDashBgColor(),this.updateDashBgColor()}_toggleDashBgColor(){$("#divInputDashBgColor").toggleClass("aspect_input-bg-color--disabled",this.inheritThemeBgColor),$("#checkboxBgColor").prop("checked",this.inheritThemeBgColor),this.inheritThemeBgColor&&(this.dashBgColor=this.defaultBgColor)}setDashBgColor(){this.inheritThemeBgColor=$("#checkboxBgColor").is(":checked"),this._toggleDashBgColor(),this.inheritThemeBgColor&&this.updateDashBgColor(),this.$rootScope.updateFlagDirty(!0)}serializeDashBgColor(){return{backgroundColor:this.dashBgColor,inheritThemeBackgroundColor:this.inheritThemeBgColor}}deserializeDashBgColor(t){const e=t?.backgroundColor,s=t?.inheritThemeBackgroundColor??!1;e&&(this.dashBgColor=e,this.inheritThemeBgColor=s,this._toggleDashBgColor(),this.updateDashBgColor())}onChangeDashboardTheme(t){this.dashboardTheme=t,$("html").attr("data-theme",this.dashboardTheme),$("#current-theme").attr("data-theme",this.dashboardTheme),this.updateDashBgColor(),widgetEditor.resizeDashboard(),this.$rootScope.updateFlagDirty(!0)}updateDashboardTheme(){$("html").attr("data-theme",this.dashboardTheme),$("#current-theme").attr("data-theme",this.dashboardTheme),this.updateDashBgColor(),widgetEditor.resizeDashboard()}resetDashboardTheme(){this.dashboardTheme="default",this.updateDashboardTheme()}serializeDashboardTheme(){return{theme:this.dashboardTheme}}deserializeDashboardTheme(t){_.isUndefined(t.theme)||(this.dashboardTheme=t.theme,this.updateDashboardTheme())}_updateExportOptions(){const t=htmlExport.exportOptions||"",e=this.getRows();0!=e||["adjustToFullWidth","ajustToTargetWindow","keepOriginalWidth"].includes(t)?e>=1&&!["projectToTargetWindow","rowToPage","rowToTab","customNavigation"].includes(t)&&(htmlExport.exportOptions="projectToTargetWindow"):htmlExport.exportOptions="adjustToFullWidth"}serializeExportOptions(){return htmlExport.exportOptions}deserializeExportOptions(t){_.isUndefined(t)||(htmlExport.exportOptions=t),this._updateExportOptions()}configureRowName(){const t=this.getRows();if(!t)return;this._updateRowNames();const e=Array.from({length:t},((t,e)=>`\n            <div class="dashboard-form__group dashboard-form__group--inline">\n                <div class="dashboard-form__label">\n                    <label>row ${e+1}</label>\n                </div>\n                <input type="text" name="row_${e+1}" id="row_${e+1}" value="${this.rowNames[e]}" />\n            </div>\n        `)).join(""),s=document.createElement("div");s.innerHTML=e,s.setAttribute("style","display: inline-block; width: 100%;"),new DialogBoxForToolboxEdit(s,"Configuration of each row's name","OK","Cancel",function(){const t=this.rowNames.length;for(let e=0;e<t;e++){const t=$("#row_"+(e+1)).val();this.rowNames[e]=t}}.bind(this))}_updateRowNames(){const t=this.getRows();this.rowNames.length=t;for(let e=0;e<t;e++)this.rowNames[e]||(this.rowNames[e]="Page "+(e+1))}_getRowNames(){return this._updateRowNames(),this.rowNames}getRowNamesObj(){return this._getRowNames().map(((t,e)=>({id:e+1,name:t})))}serializeRowNames(){return{pageNames:this._getRowNames()}}deserializeRowNames(t){_.isUndefined(t.pageNames)||(this.rowNames=t.pageNames)}_getDefaultRow(){if(!_.isEmpty(this.defaultRow))return this.defaultRow;return{id:"1",name:this._getRowNames()[0]}}getDefaultRowID(){const t=this._getDefaultRow(),e=this.getRows();return t.id<=e?t.id:"1"}setDefaultRow(t){this.defaultRow=t}serializeDefaultRow(){return{defaultPage:htmlExport.exportOptions.includes("customNavigation")?this._getDefaultRow():{}}}deserializeDefaultRow(t){_.isUndefined(t.defaultPage)||(this.defaultRow=t.defaultPage)}deserialize(t,e){this.cols=t.cols.maxCols;const s=t.cols.maxCells;this.rows=s/(this.cols||1),this.scalingHelper.setRows(this.rows),this.scalingHelper.setCols(this.cols),$('select[name="select-rows"]').val(this.rows),$('select[name="select-cols"]').val(this.cols||1),this.cleanColumns();const o=this._getClassType(this.cols);this._createColumn(o),this.updateButtonState(),_.isUndefined(e)}updateColHeight(t){if(this.heightCols=[],this.newHeightCols=[],_.isUndefined(t)||null===t.colDims)return;let e;e=_.isUndefined(t.colDims.rowHeightPercent)?this.scalingHelper.computeRelativeColHeigth(t):t.colDims.rowHeightPercent;for(let t=0;t<1;t++)this.heightCols.push(e),this.newHeightCols.push(e);this.updateMaxTopAndLeft(),this._applyHeights()}serializeCols(){const t={},e=this._getClassType(this.cols),s=this.rows?this.rows.toString():"none",o=this.rows&&this.cols?this.cols.toString():"1",i=this.rows*this.cols,h={valueRow:s,valueCol:o,maxCells:i,maxCols:this.cols,classType:e};for(let e=1;e<=i;e++){const s={},o=$("#dpr"+e)[0];if(o.hasChildNodes())for(let t=0;t<o.childNodes.length;t++){const e=o.childNodes[t];s["component"+t]=e.childNodes[0].id}t["dpr"+e]=s}return{cols:h,droppers:t}}deserializeCols(t,e){const s={};if(0==e.cols.maxCells){const e=_.values(t);_.each(e,(t=>{s[t]="DropperDroite"}))}else{const t=e.droppers,o=_.keys(t);for(let e=0;e<o.length;e++){const i=_.values(t[o[e]]);_.each(i,(t=>{s[t]=o[e]}))}}return s}}var layoutMgr=new LayoutMgrClass;$("select[name=select-rows]").on("change",(function(t){layoutMgr.updateButtonState()})),$("select[name=select-cols]").on("change",(function(t){layoutMgr.updateButtonState()}));
function enforceConstraints(t,e){var i=t.top,n=t.left,h=t.height,o=t.width,d=e.top+minTopCst,m=e.left+minLeftCst,s=e.height-2*minTopCst,f=e.width-2*minLeftCst;return w_b=i+h,w_r=n+o,c_b=d+s,c_r=m+f,h>s&&(h=s,w_b=i+s),o>f&&(o=f,w_r=n+f),i<d&&(i=d),n<m&&(n=m),w_b>c_b&&(i=c_b-h,w_b=c_b),w_r>c_r&&(n=c_r-o,w_r=c_r),{top:i,left:n,width:o,height:h}}function computeMaxWidthPx(t,e){var i=t.left,n=e.width-2*minLeftCst;return e.left+minLeftCst+n-i+minLeftCst}function computeMaxHeightPx(t,e){var i=t.top;return e.height-2*minTopCst+(e.top+minTopCst)-i+minTopCst}function computeContainerRelativeLayout(t,e){var i=t.height,n=t.width;return e?{top:minTopCst,left:minLeftCst,width:n-2*minLeftCst,height:i-2*minTopCst}:{top:0,left:0,width:n,height:i}}function computeRelativePxLayout(t,e){var i=t.top,n=t.left,h=t.height,o=t.width;return{top:i-e.top,left:n-e.left,width:o,height:h}}function pxToViewPort(t){var e={};return e.topVh=unitH(t.top),e.leftVw=unitW(t.left),e.heightVh=unitH(t.height),e.widthVw=unitW(t.width),e}function getElementLayoutPx(t){return{top:t.offsetTop,left:t.offsetLeft,height:t.offsetHeight,width:t.offsetWidth}}function getElementLayoutWithMarginPx(t){return{top:t.top+minTopCst,left:t.left+minLeftCst,height:t.height,width:t.width}}function getWidgetLayoutPx(t){return{top:t.offsetTop-minTopCst,left:t.offsetLeft-minLeftCst,height:t.offsetHeight,width:t.offsetWidth}}function applyLayoutStyleFromPx(t,e){var i=pxToViewPort(e);t.style.left=i.leftVw,t.style.top=i.topVh,t.style.width=i.widthVw,t.style.height=i.heightVh}function computeMainDivLayout(t,e){var i=widgetDefaultLayout.get();_.isUndefined(t)||_.isUndefined(t.left)||_.isUndefined(t.top)?(i.left=unitH(minLeftCst),i.top=unitW(minTopCst)):(i.left=t.left,i.top=t.top);var n=e.toString();return _.isUndefined(t)||_.isUndefined(t.width)||_.isUndefined(t.height)?(_.isUndefined(modelsLayout[n])||_.isUndefined(modelsLayout[n].width)||_.isUndefined(modelsLayout[n].height)||(i.width=modelsLayout[n].width,i.height=modelsLayout[n].height,_.isUndefined(modelsLayout[n].minWidth)||(i.minWidth=modelsLayout[n].minWidth,i.width=Math.max(parseFloat(i.minWidth)*(100/document.documentElement.clientWidth),parseFloat(i.width))+"vw"),_.isUndefined(modelsLayout[n].minHeight)||(i.minHeight=modelsLayout[n].minHeight,i.height=Math.max(parseFloat(i.minHeight)*(100/document.documentElement.clientHeight),parseFloat(i.height))+"vh")),i):(i.width=t.width,i.height=t.height,_.isUndefined(t.minWidth)?_.isUndefined(modelsLayout[n])||_.isUndefined(modelsLayout[n].minWidth)||(i.minWidth=modelsLayout[n].minWidth,i.width=Math.max(parseFloat(i.minWidth)*(100/document.documentElement.clientWidth),parseFloat(i.width))+"vw"):(i.minWidth=t.minWidth,i.width=Math.max(parseFloat(i.minWidth)*(100/document.documentElement.clientWidth),parseFloat(i.width))+"vw"),_.isUndefined(t.minHeight)?_.isUndefined(modelsLayout[n])||_.isUndefined(modelsLayout[n].minHeight)||(i.minHeight=modelsLayout[n].minHeight,i.height=Math.max(parseFloat(i.minHeight)*(100/document.documentElement.clientHeight),parseFloat(i.height))+"vh"):(i.minHeight=t.minHeight,i.height=Math.max(parseFloat(i.minHeight)*(100/document.documentElement.clientHeight),parseFloat(i.height))+"vh"),i)}function applyLayout(t,e){t.style.left=e.leftVw,t.style.top=e.topVh,t.style.width=e.widthVw,t.style.height=e.heightVh,_.isUndefined(e.minWidth)||(t.style.minWidth=e.minWidth),_.isUndefined(e.minHeight)||(t.style.minHeight=e.minHeight)}function enforceMinConsistency(t){return t.minWidth>t.width&&(t.minWidth=t.width),t.minHeight>t.height&&(t.minHeight=t.height),t}
function initEditWidget(){var t=$("#DropperDroite")[0],e=[],i=[],o=[],n=[],r=[],d=[],a=new Map;var s,l="",c="scaleTwh",g=new rescaleHelper(s,c,"edit");layoutMgr.setScalingHelper(g);var u=new Set;const h="DropperDroite",m="drop-possible",f="drop-over",p="widget-selected",b="widget-selected-last",A="data-x",w="data-y",v="data-x0",M="data-y0",E="data-height",W="data-width",C="data-height0",D="data-width0",I="data-minRatioX",z="data-minRatioY",N="data-maxRatioX",T="data-maxRatioY",S="data-display-x",F="data-display-y";function P(t){t.removeAttribute(A),t.removeAttribute(w),t.removeAttribute(v),t.removeAttribute(M),t.removeAttribute(E),t.removeAttribute(W),t.removeAttribute(C),t.removeAttribute(D),t.removeAttribute(I),t.removeAttribute(z),t.removeAttribute(N),t.removeAttribute(T),t.removeAttribute(S),t.removeAttribute(F)}function H(t){return{left:parseFloat(t.getAttribute(v))||0,top:parseFloat(t.getAttribute(M))||0,height:parseFloat(t.getAttribute(C))||1,width:parseFloat(t.getAttribute(D))||1}}if($("#DropperDroite")[0].hasChildNodes())for(var R=$("#DropperDroite")[0],L=R.childNodes.length-1;L>=0;L--)"menuWidget"!=R.childNodes[L].id&&R.childNodes[L].remove();function V(t){if(t.parentNode&&t.parentNode.parentNode){const e=t.parentNode.parentNode.id;if(e&&e.startsWith("dpr"))return e}return h}function O(t,e){if(t===h)return e;{const i=$("#"+t).offset();return{...e,top:e.top+i.top,left:e.left+i.left}}}function U(t,e){if(t===h)return e;{const i=$("#"+t).offset();return{...e,top:e.top-i.top,left:e.left-i.left}}}function B(t,e,i){let[o,n]=t,[r,d]=e;return[Math.round((o-r)/i.sizeX)*i.sizeX+r,Math.round((n-d)/i.sizeY)*i.sizeY+d]}var k=null,j=[];interact("#DropperDroite").draggable({cursorChecker:(t,e,i,o)=>o?"pointer":"default",listeners:{start(t){j=[...u],(k=document.createElement("div")).classList.add("dragged-editor-selection-lasso"),document.body.appendChild(k);const e=t.clientX0+window.pageXOffset,i=t.clientY0+window.pageYOffset;k.style.left=e+"px",k.style.top=i+"px",k.style.width="0px",k.style.height="0px",k.setAttribute(A,e),k.setAttribute(w,i),k.setAttribute(v,e),k.setAttribute(M,i)},move(t){const e=parseFloat(k.getAttribute(v))||0,i=parseFloat(k.getAttribute(M))||0;let o=parseFloat(k.getAttribute(A))||0,n=parseFloat(k.getAttribute(w))||0;o+=t.dx,n+=t.dy,k.setAttribute(A,o),k.setAttribute(w,n);const r=Math.min(e,o),d=Math.max(e,o),s=Math.min(i,n),l=Math.max(i,n);k.style.left=r+"px",k.style.width=d-r+"px",k.style.top=s+"px",k.style.height=l-s+"px",u.clear();t.ctrlKey&&j.forEach((t=>u.add(t)));for(const t of a.keys())if(!u.has(t)){const e=$("#"+t);if(e){const i=e.offset(),o=i.left,n=i.top,a=o+e.width(),c=n+e.height();o>=r&&o<=d&&a>=r&&a<=d&&n>=s&&n<=l&&c>=s&&c<=l&&u.add(t)}}ot()},end(){j=[],k&&(k.parentNode.removeChild(k),k=null)}}}).on("tap",(function(){it()}));var Y=null;interact("#DropperDroite .drop-zone-col").dropzone({accept:".drag-drop-new, .drag-drop-move",ondropactivate(t){t.target.classList.add(m)},ondragenter(t){t.target.classList.add(f),Y=t.target},ondragleave(t){t.target.classList.remove(f),Y=null},ondrop(t){},ondropdeactivate(t){t.target.classList.remove(m),t.target.classList.remove(f),Y=null}}),interact("#DropperDroite").dropzone({accept:".drag-drop-new",ondropactivate(t){t.target.classList.add(m)},ondragenter(t){t.target.classList.add(f)},ondragleave(t){t.target.classList.remove(f)},ondrop(t){},ondropdeactivate(t){t.target.classList.remove(m),t.target.classList.remove(f)}});var G=null,J=null;function X(){angular.element(document.body).injector().invoke(["EventCenterService",t=>{t.sendEvent(EVENTS_EDITOR_ADD_REMOVE_WIDGET)}])}function K(t){_.isUndefined($("#"+t)[0])||(o[t]=$("#"+t).width()/$("#"+$("#"+t)[0].parentNode.parentNode.id).width(),n[t]=$("#"+t).height()/$("#"+$("#"+t)[0].parentNode.parentNode.id).height(),r[t]=$("#"+t).position().left/$("#"+$("#"+t)[0].parentNode.parentNode.id).width(),d[t]=$("#"+t).position().top/$("#"+$("#"+t)[0].parentNode.parentNode.id).height(),l=getMedia())}function Z(){layoutMgr.updateMaxTopAndLeft();var t=$("#drop-zone")[0].getElementsByTagName("div");s=tt(),g.setDimensions(s),g.setScalingMethod(c);var e,o=isMediaChanged(l);if(e=o.bChanged,l=o.lastMedia,e)!function(){g.resizeDashboardCols();for(var t=$("#drop-zone")[0].getElementsByTagName("div"),e=0;e<t.length;e++)if($("#"+t[e].id).hasClass("drsElement")&&"Widget"!=t[e].id.substring(0,6)){var i=t[e],o=i.id;g.resizeWidgetOnMediaChange(o,o);for(var n=i.childNodes.length-1;n>=0;n--)if(i.childNodes[n].id.match("WidgetContainer")){wcId=i.childNodes[n].id;break}widgetContainer.replaceWidget(i)}}();else for(var n=0;n<t.length;n++)if(t[n].id&&$("#"+t[n].id).hasClass("drsElement")&&"Widget"!=t[n].id.substring(0,6)){var r=t[n].id;rescaleWidget(i,r),a.get(r).widgetObj=i[r]}}function q(){flatUiWidgetsPlugin.clear(),plotlyWidgetsPlugin.clear(),mapWidgetsPlugin.clear();for(const[t,e]of a)_.isUndefined(models[t])||delete models[t],_.isUndefined(modelsParameters[t])||delete modelsParameters[t],_.isUndefined(modelsHiddenParams[t])||delete modelsHiddenParams[t],_.isUndefined(modelsTempParams[t])||delete modelsTempParams[t];a.clear();for(const t in i)delete i[t];if(e.length=0,bFirstExec=!0,it(),X(),storage={},$("#DropperDroite")[0].hasChildNodes())for(var t=$("#DropperDroite")[0],o=t.childNodes.length-1;o>=0;o--)"menuWidget"!=t.childNodes[o].id&&t.childNodes[o].remove()}function Q(){var t;for(t in layoutMgr.clear(),o)delete o[t];for(t in n)delete n[t];for(t in r)delete r[t];for(t in d)delete d[t];l="",c="scaleTwh",q(),widgetConnector.clear(),widgetPreview.clear()}function tt(){return{widthPx:$("#drop-zone").width(),heightPx:$("#drop-zone").height(),scrollWidthPx:$("#drop-zone")[0].scrollWidth,scrollHeightPx:$("#drop-zone")[0].scrollHeight,widthVw:100*$("#drop-zone").width()/document.documentElement.clientWidth,heightVh:100*$("#drop-zone").height()/document.documentElement.clientHeight,scrollWidthVw:100*$("#drop-zone")[0].scrollWidth/document.documentElement.clientWidth,scrollHeightVh:100*$("#drop-zone")[0].scrollHeight/document.documentElement.clientHeight,scalingMethod:c,media:getMedia(),colDims:g.getCurrentDropperDims()}}function et(t){u.delete(t.id),ot()}function it(){u.clear(),ot()}function ot(){!function(){for(const t of a.keys())$("#"+t).removeClass(p),$("#"+t).removeClass(b);let t=null;u.forEach((e=>{t=$("#"+e),t.addClass(p)})),t&&t.addClass(b)}(),angular.element(document.body).injector().invoke(["EventCenterService",t=>{t.sendEvent(EVENTS_EDITOR_SELECTION_CHANGED)}])}function nt(){angular.element(document.body).injector().invoke(["EventCenterService",t=>{t.sendEvent(EVENTS_EDITOR_WIDGET_MOVED)}])}return interact(".drag-drop-new").draggable({cursorChecker:(t,e,i,o)=>o?"grabbing":"grab",listeners:{start(t){const e=t.target;J=e.id,(G=e.cloneNode(!0)).id="dragged-new-widget",G.classList.add("dragged-new-widget"),document.body.appendChild(G);const i=e.getBoundingClientRect();y=i.top+window.pageYOffset,x=i.left+window.pageXOffset,G.style.left=x+"px",G.style.top=y+"px",G.setAttribute(A,x),G.setAttribute(w,y)},move(t){let e=parseFloat(G.getAttribute(A))||0,i=parseFloat(G.getAttribute(w))||0;e+=t.dx,i+=t.dy,G.setAttribute(A,e),G.setAttribute(w,i);const o=gridMgr.getGrid();if(o){let t=h;Y&&Y.id&&(t=Y.id);const n=$("#"+t).offset();[e,i]=B([e,i],[n.left,n.top],o)}G.style.left=e+"px",G.style.top=i+"px"},end(t){let e=parseFloat(G.getAttribute(A))||0,i=parseFloat(G.getAttribute(w))||0;G.parentNode.removeChild(G),P(G),G=null;const o=t.relatedTarget;if(o&&o.id){const t=o.id;if(t===h||t.startsWith("dpr")){const n=o.getBoundingClientRect();e-=n.left-window.pageXOffset,i-=n.top-window.pageYOffset;const r=gridMgr.getGrid();r&&([e,i]=B([e,i],[0,0],r)),layout={top:unitH(i),left:unitW(e)},angular.element(document.body).injector().invoke(["UndoManagerService","EditorActionFactory",(e,i)=>{const o=i.createCreateWidgetdAction(J,t,layout);e.execute(o)}])}}J=null}}}).on("tap",(function(t){if(t&&t.currentTarget&&t.currentTarget.id){const e=t.currentTarget.id;angular.element(document.body).injector().invoke(["UndoManagerService","EditorActionFactory",(t,i)=>{const o=i.createCreateWidgetdAction(e);t.execute(o)}])}})),interact("#DropperDroite .drag-drop-move").resizable({edges:{left:!0,right:!0,bottom:!0,top:!0},margin:7,listeners:{start(t){const e=t.target.id;e&&a.has(e)&&!u.has(e)&&(u.clear(),u.add(e),ot()),u.forEach((e=>{const i=document.getElementById(e),o=i.offsetLeft,n=i.offsetTop,r=i.offsetHeight||1,d=i.offsetWidth||1;i.setAttribute(v,o),i.setAttribute(M,n),i.setAttribute(C,r),i.setAttribute(D,d),i.setAttribute(A,o),i.setAttribute(w,n),i.setAttribute(E,r),i.setAttribute(W,d);const a=parseInt(i.style["min-width"]||minWidthCst+"px",10),s=parseInt(i.style["min-height"]||minHeightCst+"px",10);i.setAttribute(I,a/d),i.setAttribute(z,s/r);const l=V(i);let c=1/0,g=1/0;if(l!==h){const e=document.getElementById(l);if(!t.edges.left){const t=e.offsetWidth-o-minLeftCst;c=Math.min(c,t/d)}if(!t.edges.top){const t=e.offsetHeight-n-minTopCst;g=Math.min(g,t/r)}}if(t.edges.left){const t=o+d-minLeftCst;c=Math.min(c,t/d)}if(t.edges.top){const t=n+r-minTopCst;g=Math.min(g,t/r)}i.setAttribute(N,c),i.setAttribute(T,g)}))},move(t){const e=H(t.target),i=t.edges.left||t.edges.right,o=t.edges.top||t.edges.bottom,n=t.edges.left,r=t.edges.top;let d=i?t.rect.width/e.width:1,a=o?t.rect.height/e.height:1;if(t.shiftKey&&i&&o){const t=Math.max(d,a);d=a=t}const s=gridMgr.getGrid();u.forEach((e=>{const l=document.getElementById(e),c=H(l),g=parseFloat(l.getAttribute(I))||0,u=parseFloat(l.getAttribute(z))||0,h=parseFloat(l.getAttribute(N))||1/0,m=parseFloat(l.getAttribute(T))||1/0,f={...c};let p=d,b=a;if(t.shiftKey&&i&&o){p=b=Math.max(p,b)}if(s){const t=f.width*p,e=f.height*b,d=f.left+(n?c.width-t:t),a=f.top+(r?c.height-e:e),[l,g]=B([d,a],[0,0],s);i&&(p=(t+(l-d)*(n?-1:1))/f.width),o&&(b=(e+(g-a)*(r?-1:1))/f.height)}p=Math.min(p,h),b=Math.min(b,m),p=Math.max(p,g),b=Math.max(b,u),i&&(f.width*=p,n&&(f.left-=f.width-c.width)),o&&(f.height*=b,r&&(f.top-=f.height-c.height)),l.style.left=f.left+"px",l.style.top=f.top+"px",l.style.width=f.width+"px",l.style.height=f.height+"px",l.setAttribute(A,f.left),l.setAttribute(w,f.top),l.setAttribute(E,f.height),l.setAttribute(W,f.width)})),nt()},end(t){const e=new Map;u.forEach((t=>{const i=document.getElementById(t);let o={left:parseFloat(i.getAttribute(A))||0,top:parseFloat(i.getAttribute(w))||0,height:parseFloat(i.getAttribute(E))||0,width:parseFloat(i.getAttribute(W))||0};const n=H(i);angular.equals(n,o)||(widgetContainer.moveResizeWidget(i,n,!1,!0),e.set(t,o)),P(i)})),e.size>0&&angular.element(document.body).injector().invoke(["UndoManagerService","EditorActionFactory",(t,i)=>{const o=i.createSetGeometryAction(e,"Resize widget"+(e.size>1?"s":""));t.execute(o)}])}}}).draggable({cursorChecker:(t,e,i,o)=>o?"grabbing":"grab",listeners:{start(t){const e=t.target.id;e&&a.has(e)&&!u.has(e)&&(u.clear(),u.add(e),ot()),u.forEach((t=>{const e=document.getElementById(t),i=e.offsetLeft,o=e.offsetTop,n=e.offsetHeight||1,r=e.offsetWidth||1;e.setAttribute(v,i),e.setAttribute(M,o),e.setAttribute(C,n),e.setAttribute(D,r),e.setAttribute(A,i),e.setAttribute(w,o)}))},move(t){let e=h;Y&&Y.id&&(e=Y.id);const i=gridMgr.getGrid();u.forEach((o=>{const n=document.getElementById(o),r=V(n),d={left:parseFloat(n.getAttribute(A))||0,top:parseFloat(n.getAttribute(w))||0,height:parseFloat(n.getAttribute(C))||0,width:parseFloat(n.getAttribute(D))||0};d.left+=t.dx,d.top+=t.dy,n.setAttribute(A,d.left),n.setAttribute(w,d.top);let a=d;if(r!==h&&(a=O(r,a)),e===h)i&&([a.left,a.top]=B([a.left,a.top],[0,0],i)),a.left=Math.max(minLeftCst,a.left),a.top=Math.max(minTopCst,a.top);else{const t=$("#"+e),o=t.offset(),n={left:o.left,top:o.top,height:t.height(),width:t.width()};i&&([a.left,a.top]=B([a.left,a.top],[n.left,n.top],i)),a=enforceConstraints(a,n)}const s=U(e,a);n.setAttribute(S,s.left),n.setAttribute(F,s.top),r!==h&&(a=U(r,a)),n.style.left=a.left+"px",n.style.top=a.top+"px",n.style.width=a.width+"px",n.style.height=a.height+"px"})),nt()},end(t){const e=new Map,i=t.relatedTarget;let o=h;i&&i.id&&(o=i.id);const n=gridMgr.getGrid();layoutMgr.isRowColMode()&&o===h?u.forEach((t=>{const e=document.getElementById(t),i=H(e);widgetContainer.moveResizeWidget(e,i,!1,!1),P(e)})):(u.forEach((t=>{const i=document.getElementById(t),r=V(i);let d=parseFloat(i.getAttribute(A))||0,a=parseFloat(i.getAttribute(w))||0;const s=H(i);let l={left:d,top:a};o!==r&&(l=O(r,l),l=U(o,l)),n&&([l.left,l.top]=B([l.left,l.top],[0,0],n)),angular.equals(s,l)||(widgetContainer.moveResizeWidget(i,s,!1,!1),e.set(t,l)),P(i)})),e.size>0&&angular.element(document.body).injector().invoke(["UndoManagerService","EditorActionFactory",(t,i)=>{const n=i.createDropToCellAction(o,e,"Move widget"+(e.size>1?"s":""));t.execute(n)}]))}}}).on("tap",(function(t){const e=t.ctrlKey,i=t.currentTarget.id;i&&a.has(i)&&(e?u.has(i)?u.delete(i):u.add(i):(u.clear(),u.add(i)),ot(),t.preventDefault(),t.stopImmediatePropagation())})),{addWidget:function(t,e,o,n,r){const d=widgetFactory.build(t,e,o,n,r);if(i[d.instanceId]=d.widgetObj,a.set(d.instanceId,d),"createWidget"!=i[d.instanceId].constructor.name)return X(),u.clear(),u.add(d.instanceId),ot(),d;widgetInstance.deleteWidget(d.divModel)},deleteWidget:function(t){const e=a.get(t).divModel;widgetInstance.deleteWidget(e),et(e),e.remove(),X()},widgetObject:i,widgetContainers:a,modelsId:e,serialize:function(){const t={};for(const[e,i]of a){const o={top:$("#"+i.id)[0].style.top,left:$("#"+i.id)[0].style.left,height:$("#"+i.id)[0].style.height,width:$("#"+i.id)[0].style.width,minHeight:$("#"+i.id)[0].style.minHeight,minWidth:$("#"+i.id)[0].style.minWidth,"z-index":$("#"+i.id)[0].style["z-index"]},n={instanceId:i.instanceId,modelJsonId:i.modelJsonId};"annotationLabel"==i.modelJsonId||"annotationImage"==i.modelJsonId?t[e]={layout:o,container:n,modelParameters:modelsParameters[e],modelHiddenParams:modelsHiddenParams[e]}:(emptyModelsHiddenParams=jQuery.extend(!0,{},modelsHiddenParams[i.modelJsonId]),t[e]={layout:o,container:n,modelParameters:modelsParameters[e],modelHiddenParams:emptyModelsHiddenParams})}return t},deserialize:function(t,i,o){Q(),s=tt();var n,r,d,a=0;_.isUndefined(i)||_.isUndefined(i.scalingMethod)||(c=i.scalingMethod),g.setDimensions(s),g.setScalingMethod(c),layoutMgr.deserialize(o,i),g.deserialize(i),layoutMgr.updateColHeight(i),g.resizeDashboardCols();var u=i,h=s;if(_.isUndefined(i))u=s;else{_.isUndefined(i.media)&&(i.media="large");var m=g.mediaChangeProjection(i,s,layoutMgr.getRows());l=m.lastMedia,u=m.referenceFrame,h=m.targetFrame}var f=new scalingManager(u,h,c),p=layoutMgr.deserializeCols(t,o);for(const i in t){modelsParameters[i]=t[i].modelParameters,"annotationLabel"!=t[i].container.modelJsonId&&"annotationImage"!=t[i].container.modelJsonId||_.isEmpty(t[i].modelHiddenParams)||(modelsHiddenParams[i]=t[i].modelHiddenParams),e[a]=i,r={topVh:rmUnit(t[i].layout.top),leftVw:rmUnit(t[i].layout.left),widthVw:rmUnit(t[i].layout.width),heightVh:rmUnit(t[i].layout.height)},n={top:(d=f.scale(r)).topVh+"vh",left:d.leftVw+"vw",width:d.widthVw+"vw",height:d.heightVh+"vh"};var b=document.getElementById(p[i]);widgetEditor.addWidget(t[i].container.modelJsonId,b,t[i].container.instanceId,n,t[i].layout["z-index"]),a+=1}for(const e in t)K(t[e].container.instanceId);s=tt(),g.setDimensions(s)},rescale:Z,resizeDashboard:function(){s=tt(),g.setDimensions(s),g.setScalingMethod(c),g.resizeDashboard(),Z()},clear:Q,reset:q,getCurrentDashZoneDims:tt,getSnapshotDashZoneDims:function(){return s},updateSnapshotDashZoneDims:function(){s=tt()},computeDropperMaxWidth:function(){panelDash.fullScreenWidth=Math.ceil((t.offsetWidth+25)/.75*.975-25)},setLastMedia:function(t){l=t},getWidgetsRelativeDims:function(){return{width:o,height:n,left:r,top:d}},setScalingMethod:function(t){c=t,g.setScalingMethod(c)},widthRatioModels:o,heightRatioModels:n,leftRatioModels:r,topRatioModels:d,selectWidget:function(t){u.add(t.id),ot()},selectAllWidgets:function(){u.clear();for(const t of a.keys())u.add(t);ot()},unselectWidget:et,unselectAllWidgets:it,getSelectedActive:function(){let t=null;for(t of u);return t},getSelection:function(){return[...u]},getContainer:function(t){return document.getElementById(V(t))},MAIN_CONTAINER_ID:h,DATA_ATTR_DISPLAY_X:S,DATA_ATTR_DISPLAY_Y:F,showHideWidgMenu:function(t){let e=!0;const i=t.parentElement.parentElement,o=i.id;let n=[],r=widgetConnector.widgetsConnection;_.isUndefined(r[o])||_.each(_.keys(r[o].sliders),(t=>{let e=r[o].sliders[t].dataNode;-1===n.indexOf(e)&&n.push(e)}));const d=document.getElementById("openGraphFromWidget");d?.setAttribute("name",JSON.stringify(n));const a="menuWidget";$("#"+a)[0].getAttribute("name")!==o&&($("#"+a).attr("name",o),e=!1);const s=angular.element(document.getElementById("dashboard-editor")).scope().vm;s.menuWidgetVisible?e&&(s.menuWidgetVisible=!1):s.menuWidgetVisible=!0;const l=V(i),c=$("#"+h)[0].offsetHeight,g=$("#"+l)[0].offsetTop,u=$("#"+l)[0].offsetLeft,m=$("#"+o)[0].clientWidth,f=$("#"+o)[0].clientHeight,p=$("#"+o)[0].offsetTop,b=$("#"+o)[0].offsetLeft,y=247.047,A=443,w=f-10,v=layoutMgr.getRows();let M,x;l!==h?(x=c*v,M=c-(f+p+g)):(x=c,M=c-(p+f)),v<=1&&g+p+30+A>=c&&M+w+A>=c?($("#"+a)[0].style.bottom="10px",$("#"+a)[0].style.top="auto",document.styleSheets[0].addRule("#menuWidget::after","top: -5px; transform: rotate(0deg)")):g+p+30+A>=x?($("#"+a)[0].style.bottom=(w+M).toString()+"px",$("#"+a)[0].style.top="auto",document.styleSheets[0].addRule("#menuWidget::after","top: 443px; transform: rotate(180deg)")):($("#"+a)[0].style.top=(g+p+30).toString()+"px",$("#"+a)[0].style.bottom="auto",document.styleSheets[0].addRule("#menuWidget::after","top: -5px; transform: rotate(0deg)")),(m+b).toString()<=y&&0==u?($("#"+a)[0].style.left="7px",document.styleSheets[0].addRule("#menuWidget::after","left: "+(b+m-30)+"px")):($("#"+a)[0].style.left=(m+b+u-y).toString()+"px",document.styleSheets[0].addRule("#menuWidget::after","left: auto; right: 20px")),$("#"+a)[0].style.right="auto"}}}var widgetEditor=initEditWidget();
var widgetDefaultLayoutClass=function(){var t={left:"0vw",top:"0vh",height:"5vh",width:"10vw",minWidth:"20px",minHeight:"20px"};this.get=function(){return jQuery.extend(!0,{},t)}},widgetDefaultLayout=new widgetDefaultLayoutClass;
function widgetInstanceClass(){this.createWidget=function(e,d,t){return _.isUndefined(modelsParameters[t])?modelsParameters[t]=jQuery.extend(!0,{},modelsParameters[d]):modelsParameters[t]={...modelsParameters[d],...modelsParameters[t]},_.isUndefined(models[t])&&(models[t]=jQuery.extend(!0,{},models[d])),_.isUndefined(modelsHiddenParams[t])&&(modelsHiddenParams[t]=jQuery.extend(!0,{},modelsHiddenParams[d])),_.isUndefined(modelsTempParams[t])&&(modelsTempParams[t]=jQuery.extend(!0,{},modelsTempParams[d])),new widgetsPluginsHandler.createWidget(e,d,t,!1)},this.deleteWidget=function(e){delete widgetConnector.widgetsConnection[e.id];const d=e.parentNode;if(d){for(;d.hasChildNodes();)d.removeChild(d.lastChild);d.parentNode&&d.parentNode.removeChild(d),delete widgetEditor.widgetObject[e.id];for(let d=widgetEditor.modelsId.length-1;d>=0;d--)if(widgetEditor.modelsId[d]===e.id){widgetEditor.modelsId.splice(d,1);break}delete widgetEditor.widthRatioModels[e.id],delete widgetEditor.heightRatioModels[e.id],delete widgetEditor.leftRatioModels[e.id],delete widgetEditor.topRatioModels[e.id],widgetEditor.widgetContainers.delete(e.id)}const t=e.id;_.isUndefined(modelsParameters[t])||delete modelsParameters[t],_.isUndefined(models[t])||delete models[t],_.isUndefined(modelsHiddenParams[t])||delete modelsHiddenParams[t],_.isUndefined(modelsTempParams[t])||delete modelsTempParams[t]}}var widgetInstance=new widgetInstanceClass;
function widgetContainerClass(){var t=100;function e(t){return t.sort(((t,e)=>t.divModel.style.zIndex-e.divModel.style.zIndex))}function i(t){const e=[],i=[];for(const[n,o]of widgetEditor.widgetContainers)t.includes(n)?e.push(o):i.push(o);return[e,i]}function n(t){let e=1;const i=new Map;return t.forEach((t=>i.set(t.instanceId,e++))),i}this.getWidgetContainerId=function(){t+=1;return"WidgetContainer"+parseInt(t)},this.putAndGetTargetDiv=function(t,e){return e||(e=layoutMgr.getDefaultContainer()),e.appendChild(t),e},this.computeAndApplyContainerDivLayout=function(t,e){var i=parseFloat(t.style.width.substring(0,t.style.width.length-2))-100/document.documentElement.clientWidth*2,n=parseFloat(t.style.height.substring(0,t.style.height.length-2))-100/document.documentElement.clientHeight*2;e.style.width=i.toString()+"vw",e.style.height=n.toString()+"vh",""!=t.style.minWidth&&(e.style.minWidth=parseFloat(t.style.minWidth)-5+"px",e.style.width=Math.max(parseFloat(e.style.minWidth)*(100/document.documentElement.clientWidth),parseFloat(e.style.width))+"vw"),""!=t.style.minHeight&&(e.style.minHeight=parseFloat(t.style.minHeight)-5+"px",e.style.height=Math.max(parseFloat(e.style.minHeight)*(100/document.documentElement.clientHeight),parseFloat(e.style.height))+"vh")},this.replaceWidget=function(t){for(var e,i=t.childNodes.length-1;i>=0;i--)if(t.childNodes[i].id.match("WidgetContainer")){e=t.childNodes[i].id,t.removeChild(t.childNodes[i]);break}t.style.top=unitH(t.offsetTop),t.style.left=unitW(t.offsetLeft),t.style.height=unitH(t.offsetHeight),t.style.width=unitW(t.offsetWidth),t.setAttribute("item-width",t.offsetWidth),t.setAttribute("item-height",t.offsetHeight);var n=document.createElement("div");n.style.height=unitH(t.offsetHeight-2),n.style.width=unitW(t.offsetWidth-2),n.style.minWidth=parseFloat(t.style.minWidth)-5+"px",n.style.minHeight=parseFloat(t.style.minHeight)-5+"px",t.appendChild(n),n.id=e;var o=t.id.substring(0,t.id.length-1),d=t.id,s=widgetEditor.widgetContainers.get(d).widgetTitle;return widgetEditor.widgetObject[d]=widgetsPluginsHandler.copyWidget(e,o,widgetEditor.widgetObject[d],d,!1),widgetEditor.widgetContainers.set(d,{id:d,instanceId:d,modelJsonId:o,name:d,divContainer:n,divModel:t,widgetObj:widgetEditor.widgetObject[d],widgetTitle:s}),n},this.getMinWidth=function(t){var e=32;return""!=t.style.minWidth&&(e=parseFloat(rmUnit(t.style.minWidth))),e},this.getMinHeight=function(t){var e=32;return""!=t.style.minHeight&&(e=parseFloat(rmUnit(t.style.minHeight))),e},this.getMaxWidth=function(t){const e=getElementLayoutPx(t),i=widgetEditor.getContainer(t),n=getElementLayoutPx(i);return computeMaxWidthPx(e,n)},this.getMaxHeight=function(t){const e=getElementLayoutPx(t),i=widgetEditor.getContainer(t),n=getElementLayoutPx(i);return computeMaxHeightPx(e,n)},this.getFloatingState=function(t){return layoutMgr.isRowColMode()&&"DropperDroite"===t.parentNode.parentNode.id?"FLOATING":"FIXED"},this.translateWidgetPx=function(t,e){var i=getElementLayoutPx(t),n={top:i.top+e.top,left:i.left+e.left,width:i.width,height:i.height};this.moveResizeWidget(t,n)},this.constrainLayout=function(t,e){let i;if(layoutMgr.isRowColMode()){const e=widgetEditor.getContainer(t);"FIXED"===this.getFloatingState(t)?(i=getElementLayoutPx(e),i=computeContainerRelativeLayout(i)):i="DropperDroite"===e.id?{left:0,top:0,width:layoutMgr.maxLeftCst,height:layoutMgr.maxTopCst}:getElementLayoutPx(e)}else i={left:0,top:0,width:layoutMgr.maxLeftCst,height:layoutMgr.maxTopCst};return enforceConstraints(e,i)},this.moveResizeWidget=function(t,e,i,n){let o=null;if(!i){if(null==t.parentNode.parentNode)return null;o=this.constrainLayout(t,e),t.style.top=unitH(o.top),t.style.left=unitW(o.left),t.style.height=unitH(o.height),t.style.width=unitW(o.width),n&&widgetContainer.replaceWidget(t)}const d=$(t),s=$(t.parentNode.parentNode);return n&&(widgetEditor.widthRatioModels[t.id]=d.width()/s.width(),widgetEditor.heightRatioModels[t.id]=d.height()/s.height()),widgetEditor.leftRatioModels[t.id]=d.position().left/s.width(),widgetEditor.topRatioModels[t.id]=d.position().top/s.height(),o},this.highlightWidgets=function(t){t.forEach((t=>{const e=widgetEditor.widgetContainers.get(t);e&&e.divContainer&&$(e.divContainer).fadeOut(30).fadeIn(140)}))},this.duplicateWidgetWithConnection=function(t,e){return e=this.duplicateWidget(t,e),_.isUndefined(widgetConnector.widgetsConnection[t.id])||widgetConnector.duplicateConnection(e,t),e},this.duplicateWidget=function(t,e){const i=t.id.substring(0,t.id.length-1),n=getElementLayoutPx(t),o={top:n.top+20,left:n.left+20,width:n.width,height:n.height},d=this.constrainLayout(t,o);let s={};s.top=unitH(d.top),s.left=unitW(d.left),s.height=unitH(d.height),s.width=unitW(d.width),e||(e=widgetFactory.createUniqueInstanceId(i)),modelsHiddenParams[e]=jQuery.extend(!0,{},modelsHiddenParams[t.id]),modelsParameters[e]=jQuery.extend(!0,{},modelsParameters[t.id]);const r=widgetEditor.getContainer(t);return widgetEditor.addWidget(i,r,e,s),e},this.getMaxZIndex=function(){let t=null;for(const e of widgetEditor.widgetContainers.values()){const i=e.divModel.style.zIndex;if(void 0!==i){const e=parseInt(i,10);!isNaN(e)&&(null===t||t<e)&&(t=e)}}return t},this.setZIndices=function(t){const e=widgetEditor.widgetContainers;for(const[i,n]of t){const t=e.get(i);t&&t.divModel.style.zIndex!==n&&(t.divModel.style.zIndex=n)}},this.getZIndices=function(){const t=new Map;for(const[e,i]of widgetEditor.widgetContainers)t.set(e,i.divModel.style.zIndex);return t},this.putWidgetAtForeground=function(t){const[o,d]=i(t),s=n([...e(d),...e(o)]);this.setZIndices(s)},this.putWidgetAtBackground=function(t){const[o,d]=i(t),s=n([...e(o),...e(d)]);this.setZIndices(s)}}widgetContainer=new widgetContainerClass;
function widgetFactoryClass(){this.build=function(e,t,i,d,n){var a,o;(_.isUndefined(i)||null===i)&&(i=widgetFactory.createUniqueInstanceId(e)),[a,o,t]=function(e,t,i){var d=document.createElement("div"),n=(t=widgetContainer.putAndGetTargetDiv(d,t),computeMainDivLayout(i,e));d.style.zIndex=(widgetContainer.getMaxZIndex()||0)+1;var a=convertViewportToPx(n),o=layoutMgr.getTargetDivLayoutPx(t),r=computeContainerRelativeLayout(o),l=enforceConstraints(a,r);a=enforceMinConsistency(a);var s=pxToViewPort(l);s.minHeight=a.minHeight,s.minWidth=a.minWidth,applyLayout(d,s);var c=document.createElement("div");return widgetContainer.computeAndApplyContainerDivLayout(d,c),d.appendChild(c),[d,c,t]}(e,t,d),a.id=i,$("#"+a.id).addClass("drsElement"),$("#"+a.id).addClass("drag-drop-move"),$("#"+a.id).addClass("_cloned"),$("#"+a.id).addClass("widget widget__layout--item"),$("#"+a.id)[0].setAttribute("item-width",$("#"+a.id).width()),$("#"+a.id)[0].setAttribute("item-height",$("#"+a.id).height());const r=document.createElement("div");r.classList.add("widget-overlay"),a.appendChild(r);let l=$('<ul class="actions__list" style="padding:0"></ul>').appendTo(a);$('<li id="li_'+a.id+'" onclick="widgetEditor.showHideWidgMenu(this)" style="z-index:999999;margin:0"><a id="ed_a_'+a.id+'" tilte="edit widget"><i id="showHideWidgetMenu" class="basic icn-edit"></i></a></li>').appendTo(l);var s=widgetContainer.getWidgetContainerId();o.id=s,_.isUndefined(n)||(a.style.zIndex=n);var c=widgetsPluginsHandler.widgetToolbarDefinitions[e].title;_.isUndefined(c)&&(c=""),c=c+"("+i+")",$("div#"+a.id).wrap("<a id=DIV_"+a.id+" title='"+c.replace("_"," ")+"'></a>");var g=widgetInstance.createWidget(s,e.toString(),i);return{id:i,instanceId:i,modelJsonId:e,name:i,divContainer:o,divModel:a,widgetObj:g,widgetTitle:c}},this.createUniqueInstanceId=function(e){const t=widgetEditor.modelsId.length,i=new Set(widgetEditor.modelsId),d=[..."ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",..."",..."",..."",..."",..."",..."",..."",...""].map((t=>{return e+(i=t).charAt(Math.floor(Math.random()*i.length));var i})).find((e=>!i.has(e)));if(d)i.add(d),widgetEditor.modelsId[t]=d;else{const e=new PNotify({title:"Annotation label",text:"The number of label instances is reached",type:"warning",delay:1800,styling:"bootstrap3"});$(".ui-pnotify-container").on("click",(function(){e.remove()}))}return d}}var widgetFactory=new widgetFactoryClass;
function navigationHelperClass(){this.gotoMyProjects=function(){var e=angular.element(document.body),o=e.scope().$root,n=e.scope().$state;o.toggleMenuOptionDisplay("cards"),n.go("modules.cards.layout",{action:"myProjects"})},this.openDemoProject=function(e,o){var n=e,t=angular.element(document.body),a=t.scope().$root,i=t.scope().$state;if(a.origin="openProject",a.loadingBarStart(),a.toggleMenuOptionDisplay("none"),i.go("modules",{}),a.isLiveDemo=!1,!a.xDashFullVersion){angular.element(document.getElementById("dash-ctrl")).scope().closeLeftSidePanel(),a.isLiveDemo=!0}a.moduleOpened=!1;(new FileMngrFct).ReadFile("template",n+".xprjson",(function(e,t,i){"success"===i?(xdash.openProjectManager(e),a.loadingBarStop(),a.currentProject.name=n,_.isFunction(o)&&o(),a.origin="projectEdition"):swal(e,t,i)}))}}var navHelper=new navigationHelperClass;
var widgetConnector=function(){var e=[];function t(){const e=angular.element(document.body).injector();e&&e.has("EventCenterService")&&e.invoke(["EventCenterService",e=>{e.sendEvent(EVENTS_EDITOR_CONNECTIONS_CHANGED)}])}function n(){for(const t in e)widgetEditor.widgetContainers.get(e[t].id)||delete e[t];for(const[t,n]of widgetEditor.widgetContainers)if(e[t]){if(widgetEditor.widgetObject[t]){if(!_.isNull(e[t].widgetObjEdit)&&!_.isNull(widgetEditor.widgetObject[t])){let n=e[t].widgetObjEdit.numberOfTriggers-widgetEditor.widgetObject[t].numberOfTriggers;for(;n>0;){let i=Object.keys(e[t].sliders);delete e[t].sliders[i[i.length-1]],n--}}e[t].widgetObjEdit=widgetEditor.widgetObject[t]}}else e[t]={name:t,id:t,instanceId:t,modelJsonId:n.modelJsonId,sliders:[],widgetObjEdit:widgetEditor.widgetObject[t],widgetObjConnect:null};t()}function i(){for(const t in e)d(t);t()}function d(t){const n=e[t];for(const e in n.sliders){const t=n.sliders[e];t.dataNode="None",t.dataFields.length=0}}function o(){for(const t in e)delete e[t];i()}return{widgetsConnection:e,updateWidgetsConnections:n,effectiveSliders:function(){let t=[];return _.each(_.keys(e),(n=>{let i=_.keys(e[n].sliders);for(let e=0;e<i.length;e++)_.isEmpty(i[e])||t.push(i[e])})),_.uniq(t)},resetSingleMatchingBox:i,serialize:function(){const t={};for(const n in e){t[n]={};for(const i in e[n].sliders)t[n][i]=jQuery.extend(!0,{},e[n].sliders[i])}return t},deserialize:function(i){o(),n();for(var d=[],r=0;r<datanodesManager.getAllDataNodes().length;r++)d[r]=datanodesManager.getAllDataNodes()[r].name();for(const t in e)for(const n in i[t])_.isUndefined(i[t][n].dataNode)&&(i[t][n].dataNode=i[t][n].dataSource,delete i[t][n].dataSource),e[t].sliders[n]=i[t][n];for(let t in e)try{widgetPreview.plotConstantData(t,!1)}catch(e){console.error(e)}t()},clear:o,duplicateConnection:function(n,i){e[n]=jQuery.extend(!0,{},e[i.id]),e[n].id=n,e[n].name=n,e[n].instanceId=n,t()},refreshDatanodeConsumers:function(t,n,i,d){for(const o in e){const r=e[o];for(const e in r.sliders){const s=r.sliders[e];if("None"!=s.name){let a=null;null!=r.widgetObjEdit?a=r.widgetObjEdit.getByName(s.name):null!=r.widgetObjConnect&&(a=r.widgetObjConnect.getByName(s.name)),null!=a&&(s.dataNode===n?"Python_pyodide_plugin"==datanodesManager.getDataNodeByName(n).type()&&"fig"===e?widgetPreview.setDataOnWidget(o,e,a,n,i,d,!1):widgetPreview.setDataOnWidget(o,e,a,t,i,d,!1):s.dataNode)}}}}}}();
function displaySpinnerOnInputFileButton(t){const e=this,n=document.getElementById("button"+t),o=document.getElementById("button"+t+"_select_file"),a=document.createElement("i");let i;this.disableButton=function(){n.classList.add("disabled"),a.setAttribute("id","icon"+t),a.setAttribute("class","fa fa-spinner fa-spin"),n.append(a)},this.enableButton=function(){n.classList.remove("disabled"),a&&a.remove()},this.disableButton(),o.onchange=function(){clearTimeout(i),document.body.focus(),e.enableButton()},document.body.onfocus=function(){i=setTimeout((()=>{e.enableButton(),document.body.onfocus=null}),200)}}function updateDataSourceFromWidget(t,e){if(_.isUndefined(widgetConnector.widgetsConnection[t]))return;const n=widgetConnector.widgetsConnection[t].sliders,o=[];if(!_.isUndefined(n)){for(const t in n){const e=n[t].dataNode;"None"!==e&&o.push(datanodesManager.getDataNodeByName(e).name())}o.length>0&&datanodesManager.getDataNodeByName(o[0]).schedulerStart(o,o[0],"triggerButton")}}function updateDataNodeFromWidgetwithspinButton(t,e){if(_.isUndefined(widgetConnector.widgetsConnection[t]))return;const n=widgetConnector.widgetsConnection[t].sliders,o=[];if(!_.isUndefined(n)){for(const t in n){const e=n[t].dataNode;"None"!=e&&o.push(datanodesManager.getDataNodeByName(e).name())}if(o.length>0){const n=document.getElementById("button"+e),a=document.createElement("i");a.setAttribute("id","icon"+e),datanodesManager.getDataNodeByName(o[0]).schedulerStart(o,o[0],"triggerButton");const i=setInterval((function(){const s=[];o.forEach((t=>{"Pending"==datanodesManager.getDataNodeByName(t).status()&&($("#button"+e).attr("class","btn btn-table-cell btn-lg disabled"),s.push(!0),n.contains(a)||(a.classList.contains("fa","fa-spinner","fa-spin")||a.classList.add("fa","fa-spinner","fa-spin"),n.append(a)))})),0==s.length&&($(a).remove(),$("#button"+e).attr("class","btn btn-table-cell btn-lg "+t+"widgetCustomColor "),clearInterval(i))}),100)}}}
var widgetPreview=function(){var e,t=[],n="scaleTwh",o=0,d=1,a=new rescaleHelper(e,n,"preview"),s=[],l=[],r=[],c=[],g="",u={};function f(){return{widthPx:$("#dashboard-zone").width(),heightPx:$("#dashboard-zone").height(),scrollWidthPx:$("#dashboard-zone")[0].scrollWidth,scrollHeightPx:$("#dashboard-zone")[0].scrollHeight,widthVw:100*$("#dashboard-zone").width()/document.documentElement.clientWidth,heightVh:100*$("#dashboard-zone").height()/document.documentElement.clientHeight,scrollWidthVw:100*$("#dashboard-zone")[0].scrollWidth/document.documentElement.clientWidth,scrollHeightVh:100*$("#dashboard-zone")[0].scrollHeight/document.documentElement.clientHeight,scalingMethod:n}}function m(){for(let e in t)for(let n of widgetConnector.effectiveSliders())null!=t[e]&&null!=t[e].getByName(n)&&(slider=t[e].getByName(n),slider.addValueChangedHandler(v))}function p(e,n){_.each(_.keys(e.dashboard),(e=>{let i=document.getElementById(e+"c"),o=e.substring(0,e.length-1),d=i.firstElementChild.id;t[e]=n?widgetsPluginsHandler.createWidget(d,o,e,!0):widgetsPluginsHandler.copyWidget(d,o,null,e,!0),function(e){$("#"+e+"c")[0].style.position="absolute",$("#"+e+"c")[0].style.border="1px solid rgba(255, 255, 255, 0)"}(e),null!=widgetConnector.widgetsConnection[e]&&(widgetConnector.widgetsConnection[e].widgetObjEdit=null,widgetConnector.widgetsConnection[e].widgetObjConnect=t[e],C(e,!1))})),a.updateCellsProportions(),_.each(_.keys(t),(e=>{!function(e,t){s[e]=$("#"+t).width()/$("#"+$("#"+t)[0].parentNode.id).width(),l[e]=$("#"+t).height()/$("#"+$("#"+t)[0].parentNode.id).height(),r[e]=$("#"+t).position().left/$("#"+$("#"+t)[0].parentNode.id).width(),c[e]=$("#"+t).position().top/$("#"+$("#"+t)[0].parentNode.id).height(),g=getMedia()}(e,e+"c")}))}function C(e,t){const n=widgetConnector.widgetsConnection[e];if(_.isUndefined(n))console.log("connection of "+e+" is undefined");else for(const o in n.sliders){const d=n.sliders[o];if("None"!==d.name){let a=null;if(null!=n.widgetObjEdit?a=n.widgetObjEdit.getByName(d.name):null!=n.widgetObjConnect&&(a=n.widgetObjConnect.getByName(d.name)),null!=a){const n=d.dataNode;if("None"!==n){const i=datanodesManager.getDataNodeByName(n);if(i){y(e,o,a,i.latestData(),i.status(),i.last_updated(),t)}else{b(e,o,"Invalid connection with data")}}else $("#collapse-matching-box").hasClass("collapse in")&&widgetPreview.clearDataFromWidget(e,i,a,!0)}}}}function b(e,t,n){if(!u[e]){var i=widgetConnector.widgetsConnection[e].instanceId+"c";_.isUndefined($("#"+i)[0])||"3px groove #e40000"!=$("#"+i)[0].style.border&&(w=parseFloat($("#"+i)[0].style.width)+1,h=parseFloat($("#"+i)[0].style.height)+1,$("#"+i)[0].style.width=w+"vw",$("#"+i)[0].style.height=h+"vh",$("#"+i)[0].style.border="3px groove #e40000",$("#"+i)[0].style.borderRadius="6px",$("#"+i)[0].style.background="rgba(255, 0, 0, 0.26)",$("#"+i).append('<br/><span style="color:red">'+n+' "'+widgetConnector.widgetsConnection[e].sliders[t].dataNode+'" !</span>')),u[e]=!0}}function y(e,t,n,i,o,d,a){if(_.isUndefined(i)&&"never"!=d||"Error"==o)return msg="Invalid data",void b(e,t,msg);if(function(e){var t=widgetConnector.widgetsConnection[e].instanceId+"c";if(!_.isUndefined($("#"+t)[0])&&"1px solid rgba(255, 255, 255, 0)"!=$("#"+t)[0].style.border){w=parseFloat($("#"+t)[0].style.width)-1,h=parseFloat($("#"+t)[0].style.height)-1,$("#"+t)[0].style.width=w+"vw",$("#"+t)[0].style.height=h+"vh",$("#"+t)[0].style.border="1px solid rgba(255, 255, 255, 0)",$("#"+t)[0].style.borderRadius="",$("#"+t)[0].style.background="";for(var n=0;n<$("#"+t)[0].childNodes.length;n++)"span"==$("#"+t)[0].childNodes[n].localName&&$("#"+t)[0].childNodes[n].remove()}u[e]=!1}(e),!_.isUndefined(i)&&!_.isNull(i)){const o=widgetConnector.widgetsConnection[e].sliders[t];let d=i,s=o.dataNode;for(let e=0;e<o.dataFields.length;e++){const t=o.dataFields[e];"string"==typeof t&&t.includes(" ... ")||(s=t,d=_.isNull(d)||_.isUndefined(d)?i[s]:d[s])}if(null===d)widgetPreview.clearDataFromWidget(e,t,n,!0);else if("D"===o.name.substring(0,1))try{n.setText(d)}catch(e){console.log("setText got exception with data '"+o.dataNode+"'. "+e)}else{if(!_.isUndefined(n.setCaption))try{n.setCaption(s,a)}catch(e){console.log("setCaption got exception with data '"+o.dataNode+"'. "+e)}if(!_.isUndefined(n.setValue))try{n.setValue(d)}catch(e){console.log("setValue got exception with data '"+o.dataNode+"'. "+e)}}}}function v(e,t){let n=function(e){for(let t in widgetConnector.widgetsConnection){const n=widgetConnector.widgetsConnection[t];if(n.widgetObjConnect){const t=Object.values(n.sliders).find((t=>n.widgetObjConnect.getByName(t.name)===e));if(t)return t}}return null}(e);if(n&&"None"!==n.dataNode){const t=datanodesManager.getDataNodeByName(n.dataNode);if(_.isUndefined(t))console.log("data was removed or data index was modified!");else if(t.canSetValue()&&!_.isUndefined(e.getValue))try{t.setValue(n.dataFields,e.getValue())}catch(e){console.log("setValue got exception with data: "+t.name()+". "+e.message)}else console.log("setValue is not possible with data: "+t.name())}}function N(){e=f(),a.setDimensions(e);var n,i=isMediaChanged(g);n=i.bChanged,g=i.lastMedia,n?_.each(_.keys(t),(e=>{let n=e+"c";a.resizeWidgetOnMediaChange(e,n),function(e){let n=e+"c";for(var i=document.getElementById(n),o=i.id.substring(0,i.id.length-2),d=(e=i.id.substring(0,i.id.length-1),i.firstElementChild),a=i.childNodes.length-1;a>=0;a--)i.removeChild(i.childNodes[a]);var s=document.createElement("div");s.style.height=unitH(i.offsetHeight-2),s.style.width=unitW(i.offsetWidth-2),s.style.minWidth=parseFloat(i.style.minWidth)-5+"px",s.style.minHeight=parseFloat(i.style.minHeight)-5+"px",i.appendChild(s),s.id=d.id;var l=d.id;t[e]=widgetsPluginsHandler.copyWidget(l,o,t[e],e,!0),u[e]=!1}(e),null!=widgetConnector.widgetsConnection[e]&&(widgetConnector.widgetsConnection[e].widgetObjConnect=t[e],C(e))})):_.each(_.keys(t),(e=>{rescaleWidget(t,e)}))}function x(){for(var e in t)delete t[e];for(var e in $("#dashboard-zone").html(""),s)delete s[e];for(var e in l)delete l[e];for(var e in r)delete r[e];for(var e in c)delete c[e];g=""}return{loadPlayMode:function(){x(),e=widgetEditor.getSnapshotDashZoneDims(),a.setDimensions(e),a.setScalingMethod(n),a.setRows(o),a.setCols(d),p(function(){var e=xdash.serialize();e.scaling=widgetEditor.getSnapshotDashZoneDims();var t=document.getElementById("dashboard-zone"),n=document.createElement("div");return n.id="DropperDroitec",n.className="dropperR",n.style.zIndex=0,n.style.borderRadius="10px",t.appendChild(n),reconstructFoundations.buildDivsFromXprjson(e),e}(),!1),0!=datanodesManager.getAllDataNodes().length&&m()},renderDashboardWidgets:p,updateDataFromWidget:v,resizeDashboard:function(e){if("undefined"!=typeof execOutsideEditor&&execOutsideEditor){var t=0;switch($("#nav-menu")[0]&&(t=parseInt($("#nav-menu")[0].style.height),isNaN(t)&&(t=0)),jsonContent.exportOptions){case"rowToPage":rowToPageRuntime.rowToPagePrepareRescale(o,d);break;case"rowToTab":rowToTabRuntime.rowToTabPrepareRescale(o,d);break;case"customNavigation":customNavigationRuntime.customNavigationPrepareRescale(o,d);break;case"keepOriginalWidth":$("#dashboard-zone")[0].style.height=scalingSrc.scrollHeightPx+t+"px";break;default:$("#dashboard-zone")[0].style.height=document.body.clientHeight-t+"px"}}a.setScalingMethod(n),a.setRows(o),a.setCols(d),a.resizeDashboard(e),N(),"undefined"!=typeof execOutsideEditor&&execOutsideEditor&&"rowToPage"==jsonContent.exportOptions&&setTimeout(rowToPageRuntime.rowToPageFinishRescale,500,o,d)},resizeDashboardCols:function(){a.resizeDashboardCols()},widget:t,plotConstantData:C,assignValueChangeHandlers:m,rescale:N,clear:function(){x(),htmlExport.exportOptions="ajustToTargetWindow"},deserialize:function(e){let t;for(t in _.each(_.keys(e),(e=>{let t=e.substring(0,e.length-1),n=e+"c";null==widgetConnector.widgetsConnection[e]&&(widgetConnector.widgetsConnection[e]={name:n,id:n,instanceId:e,modelJsonId:t,sliders:[],widgetObjEdit:null,widgetObjConnect:null})})),widgetConnector.widgetsConnection)for(var n in e[t])widgetConnector.widgetsConnection[t].sliders[n]=e[t][n];for(t in widgetConnector.widgetsConnection)try{widgetPreview.plotConstantData(t,!1),widgetConnector.widgetsConnection[t].widgetObjEdit=null}catch(e){}},setDataOnWidget:y,clearDataFromWidget:function(e,t,n,i){"D"===widgetConnector.widgetsConnection[e].sliders[t].name.substring(0,1)?n.setText(""):(!_.isUndefined(n.clearCaption)&&i&&n.clearCaption(),_.isUndefined(n.setValue)||n.setValue(null))},getCurrentDashZoneDims:f,getSnapshotDashZoneDims:function(){return e},getWidgetsRelativeDims:function(){return{width:s,height:l,left:r,top:c}},setScalingInformation:function(e,t,i,s){null!=e&&(a.setDimensions(e),null!=e.colDims&&a.deserialize(e)),null!=t&&(n=t,a.setScalingMethod(n)),null!=i&&(o=i,a.setRows(o)),null!=s&&(d=s,a.setCols(d))},getCols:function(){return a.getCols()},mediaChangeProjection:function(e,t,n){return a.mediaChangeProjection(e,t,n)},toPng:function(){var e=function(){var e,n,i=0,o=0,d=$("#dashboard-zone").offset().left,a=$("#dashboard-zone").offset().top,s=$("#dashboard-zone").height();for(var l in t)(e=$("#"+l+"c").offset().left-d+$("#"+l+"c").width())>i&&(i=e),(n=$("#"+l+"c").offset().top-a+$("#"+l+"c").height())>o&&(o=n),o>s&&(o=s);return{right:i,bottom:o}}(),n=document.getElementById("dashboard-zone"),i=n.style.height,o=n.style.width;n.style.height=e.bottom+"px",n.style.width=e.right+"px",html2canvas(n,{allowTaint:!1,useCORS:!0}).then((function(t){var d=Canvas2Image.convertToPNG(t,e.right,e.bottom),a=document.createElement("a");a.setAttribute("download",$("#projectName")[0].value+".png"),a.setAttribute("href",d.src.replace("image/png","image/octet-stream")),a.click(),n.style.height=i,n.style.width=o}))},elevateZIndex:function(e,n){var i=0;_.each(Object.keys(t),(function(e){var t=Number($("#"+e+"c")[0].style["z-index"]);t>i&&(i=t)})),$("#"+e+"c")[0].style["z-index"]=i+1}}}();
var pyodideLib={serialize:function(){const d=pyodideManager.packages;return{pyodideStandard:[...d.standard].sort(),pyodideMicropip:[...d.micropip].sort()}},deserialize:function(d){if(pyodideManager.reset(),!_.isUndefined(d.libraries)){const{pyodideStandard:i,pyodideMicropip:e}=d.libraries;pyodideManager.packages={standard:i,micropip:e}}d.data.datanodes.find((d=>"Python_pyodide_plugin"===d.type))&&pyodideManager.ensureStarted()}};
var reconstructFoundations=function(){var e=401;function t(e){var t=document.getElementById("DropperDroitec");_.isUndefined(e.scaling)?(t.style.width="100",t.style.height="100"):(t.style.width=e.scaling.widthVw,t.style.height=e.scaling.heightVh),function(e){var t,n,i;if(_.isUndefined(e.device)?(t="",n=0,i=0):(t=e.device.cols.classType,n=e.device.cols.maxCells,i=e.device.cols.maxCols),0!=n)for(var r=document.getElementById("DropperDroitec"),o=n/i,a=1;a<=o;a++)for(var d=1+(a-1)*i;d<=a*i;d++){var l=document.createElement("div");l.setAttribute("class",t+" device-col"),l.setAttribute("id","dpr"+d+"c"),l.style.height=e.scaling.colDims.heightVh+"vh",r.appendChild(l),$("#dpr"+d+"c").hasClass("col-invisible")||$("#dpr"+d+"c").addClass("col-invisible")}}(e)}function n(t,n){var i=document.getElementById(n),r=function(t){var n=document.createElement("div");n.id=t.container.instanceId+"c",n.style.top=t.layout.top,n.style.left=t.layout.left,n.style.width=t.layout.width,n.style.height=t.layout.height,_.isUndefined(t.layout["z-index"])||(n.style["z-index"]=t.layout["z-index"]);n.style.position="absolute",n.style.cursor="default";var i=document.createElement("div");return i.id="WidgetContainer"+e+"c",e++,i.style.width=rmUnit(t.layout.width)-100/document.documentElement.clientWidth*2+"vw",i.style.height=rmUnit(t.layout.height)-100/document.documentElement.clientHeight*2+"vh",n.appendChild(i),n}(t);i.appendChild(r)}function i(e){reconstructFoundations.buildDivsFromXprjson(e);var t=e.exportOptions;_.isUndefined(e)||_.isUndefined(e.meta)||(document.title=e.meta.name),RuntimeDashboard.loadDashboard(e,t)}function r(e){var t=findGetParameter("inputParams");if(null!=t){var n=inputHandler.decodeInputPars(t);e=inputHandler.patchInputVariables(e,n)}}return{buildDivsFromXprjson:function(e){t(e),function(e){const t=e.device.droppers;_.isEmpty(t)?Object.values(e.dashboard).forEach((e=>n(e,"DropperDroitec"))):Object.entries(t).forEach((([t,i])=>{Object.values(i).forEach((i=>n(e.dashboard[i],t+"c")))}))}(e)},loadXprjson:function(e){var t=findGetParameter("projectUrl");if(null==t){var n=e;e=r(e),i(n)}else $.get(t,(function(e){})).done((function(n){var o;try{o=JSON.parse(n),e=r(o),i(o)}catch(e){swal("Unable to parse "+t+" project",e,"error"),$(".wrapperloading").hide()}})).fail((function(e,t){datanodesManager.showLoadingIndicator(!1),swal("Error in loading xprjson from URL","Server response : "+e.status,"error")}))}}}();
var runtimeToolbar={toolbar:['<div class="top-nav" ng-if="showNavBar">','   <nav class="top-nav__menu" id="nav-menu">','       <ul class="top-nav__nav">','           <li class="top-nav__nav-item">','               <a class="top-nav__brand" target="_blank" href="'+xDashConfig.urlWebSite+'" title="Chalk\'it website">',"                   Powered by Chalk'it",'                   <img src="'+xDashConfig.urlBaseForExport+'assets/img/chalk-it-icon.svg" />',"               </a>","           </li>",'           <li ng-if="showPagination && (exportOptions == \'rowToPage\')" class="top-nav__nav-item top-nav__nav-item--row-to-page">\n                  <button class="top-nav__btn top-nav__btn--rounded" ng-click="rowToPageChange(\'previous\')">\n                    <i class="fa fa-chevron-left" aria-hidden="true"></i>\n                  </button>\n                  <div class="top-nav__title">Page {{pageNumber}} / {{totalPages}}</div>\n                  <button class="top-nav__btn top-nav__btn--rounded" ng-click="rowToPageChange(\'next\')">\n                    <i class="fa fa-chevron-right" aria-hidden="true"></i>\n                  </button>\n                </li>\n                <li ng-if="showPagination && (exportOptions == \'rowToTab\')" class="top-nav__nav-item top-nav__nav-item--row-to-tab">\n                  <div class="top-nav__btn-wrapper" ng-repeat="pageName in pageNames">\n                    <button id="btn-page-{{$index + 1}}" class="btn btn-rounded-fill primary" ng-class="{\'cancel\': pageNumber != $index + 1}"  ng-click="rowToTabChange($index + 1)">\n                      {{pageName}}\n                    </button>\n                  </div>\n                </li>',"       </ul>","       <ul class='top-nav__nav top-nav__nav--right'>",'            <li class="top-nav__nav-item dropdown" ng-if="navBarNotification">','                <a class="dropdown-toggle info-number" data-toggle="dropdown" aria-expanded="false">','                    <i class="fa fa-envelope-o" aria-hidden="true"></i>','                    <span class="badge bg-red">{{nbNotifications}}</span>',"                </a>",'                <ul id="menu1" class="dropdown-menu list-unstyled top-nav__msg-list" role="menu">',"                    <form>",'                        <li class="top-nav__msg-item" ng-if="nbNotifications">','                            <div class="text-center">','                                <div ng-show="!searchFrom" style="display: inline-block; width:80%;margin:13px">','                                    <h3 style="margin:0; line-height:normal"> Notifications list</h3>',"                                </div>","                            </div>","                        </li>",'                        <li class="top-nav__msg-item" ng-if="nbNotifications>shownNotificationsMax">','                            <div class="text-center">',"                                <strong>..too many notifications! Please acquit a few to display more.</strong>","                            </div>","                        </li>",'                        <li class="top-nav__msg-item" ng-repeat="notification in listNotifications | limitTo:- 100 |orderBy:-$index " ',"                            ng-show=\"!notification.hide&&(notification.dataNode.indexOf(notificationFilterDataValue)>=0||notificationFilterDataValue=='')\">",'                            <a class="top-nav__msg-link" ng-click="hideNotificationFromNavBar(notification)" title="Click to acquit this notification">','                                <span class="image"><img ng-src="{{urlBase+notification.img}}" alt="error Message"></span>',"                                <span>","                                    <span>{{notification.title || 'Error'}}</span>","                                <span class=\"data\">{{'Data: '}} {{notification.dataNode}}</span>","                                </span>","                                <span class=\"message\">{{notification.text + '. '}}</span>",'                                <span class="time">{{notification.time}}</span>',"                            </a>","                        </li>",'                        <li class="top-nav__msg-item text-center" ng-if="nbNotifications">','                            <a ng-click="clearAllNotifications()">',"                                <strong>Clear All Notifications</strong>",'                                <i class="fa fa-angle-right"></i>',"                            </a>","                        </li>","                    </form>","                </ul>","            </li>","        </ul>","    </nav>","</div>",""]};
class CustomNavigationRuntime{#o;#t;constructor(){this.#o={rows:1,cols:1},this.#t={}}customNavigationPrepareRescale(o,t){const{defaultRows:e,defaultCols:s}=this.grid,i=Number(o)||e,r=Number(t)||s;this.grid={rows:i,cols:r},i>1&&$("[id^=dpr][id$=c]").show()}customNavigationModeInit(o){const t=Number(o.pages.defaultPage.id),{defaultRows:e,defaultCols:s}=this.grid,i=Number(o.device.cols.valueRow)||e,r=Number(o.device.cols.valueCol)||s;if(this.grid={rows:i,cols:r},i>1)if($("[id^=dpr][id$=c]").hide(),r>1){const o=t*r;for(let t=o-r+1;t<=o;t++)$("#dpr"+t+"c").show()}else $("#dpr"+t+"c").show()}customNavigationGoToPage(o){const t=angular.element(document.body).scope().$root;if("undefined"!=typeof layoutMgr&&!t.bIsPlayMode)return;t.pageNumber=o;const e=this.jsonContent;let s="";const{defaultRows:i,defaultCols:r}=this.grid;let n,d;if(_.isEmpty(e)?(n=layoutMgr.getRows()||i,d=layoutMgr.getCols()||r,s=htmlExport.exportOptions):(n=Number(e.device.cols.valueRow)||i,d=Number(e.device.cols.valueCol)||r,s=e.exportOptions),this.grid={rows:n,cols:d},n>1)if("projectToTargetWindow"==s){$("#dpr"+o*d+"c")[0].scrollIntoView(!1)}else if($("[id^=dpr][id$=c]").hide(),d>1){const t=o*d;for(let o=t-d+1;o<=t;o++)$("#dpr"+o+"c").show()}else $("#dpr"+o+"c").show()}get jsonContent(){return this.#t}set jsonContent(o){this.#t=o}get grid(){return this.#o}set grid(o){this.#o=o}}const customNavigationRuntime=new CustomNavigationRuntime;
var xDashApi={setVariable:function(a,e){datanodesManager.getDataNodeByName(a).notificationCallback("warning",a,"Deprecated feature: please rename 'xDashApi' by 'chalkit'"),chalkit.setVariable(a,e)},setVariables:function(a,e){datanodesManager.getDataNodeByName(a[0]).notificationCallback("warning",a[0],"Deprecated feature: please rename 'xDashApi' by 'chalkit'"),chalkit.setVariables(a,e)},getVariable:function(a){datanodesManager.getDataNodeByName(a).notificationCallback("error",a,"Deprecated feature: 'getVariable' feature is no longer supported")},setVariableProperty:function(a,e,t){datanodesManager.getDataNodeByName(a).notificationCallback("warning",a,"Deprecated feature: please rename 'xDashApi' by 'chalkit'"),chalkit.setVariableProperty(a,e,t)},executeDataNode:function(a){datanodesManager.getDataNodeByName(a).notificationCallback("warning",a,"Deprecated feature: please rename 'xDashApi' by 'chalkit'"),chalkit.executeDataNode(a)},executeDataNodes:function(a){datanodesManager.getDataNodeByName(a[0]).notificationCallback("warning",a[0],"Deprecated feature: please rename 'xDashApi' by 'chalkit'"),chalkit.executeDataNodes(a)},viewProject:function(a,e,t){const n=datanodesManager.getCurrentDataNode();datanodesManager.getDataNodeByName(n).notificationCallback("warning",n,"Deprecated feature: please rename 'xDashApi' by 'chalkit'"),chalkit.viewProject(a,e,t)},viewPage:function(a,e,t){const n=datanodesManager.getCurrentDataNode();datanodesManager.getDataNodeByName(n).notificationCallback("warning",n,"Deprecated feature: please rename 'xDashApi' by 'chalkit'"),chalkit.viewPage(a,e,t)},goToPage:function(a){const e=datanodesManager.getCurrentDataNode();datanodesManager.getDataNodeByName(e).notificationCallback("warning",e,"Deprecated feature: please rename 'xDashApi' by 'chalkit'"),chalkit.goToPage(a)}};
var chalkit=(scheduler={setVariable:function(e,a){chalkit.setVariable(e,a)},setVariables:function(e,a){chalkit.setVariables(e,a)},setVariableProperty:function(e,a,t){chalkit.setVariableProperty(e,a,t)},executeDataNode:function(e){chalkit.executeDataNode(e)},executeDataNodes:function(e){chalkit.executeDataNodes(e)}},dashboard={viewPage:function(e,a,t){chalkit.viewPage(e,a,t)},viewProject:function(e,a,t){chalkit.viewProject(e,a,t)},goToPage:function(e){chalkit.goToPage(e)},enableWidget:function(e){chalkit.enableWidget(e)},disableWidget:function(e){chalkit.disableWidget(e)},showWidget:function(e){chalkit.showWidget(e)},hideWidget:function(e){chalkit.hideWidget(e)}},{setVariable:function(e,a){const t=JSON.parse(JSON.stringify(a)),n=datanodesManager.getCurrentDataNode();let o=datanodesManager.getDataNodeByName(e);_.isUndefined(o)?(o=datanodesManager.getDataNodeByName(n),o.notificationCallback("error",n,"The dataNode referenced in setVariable api doesn't exist. Please verify your parameters")):(datanodesManager.datanodesDependency().addSetvarList(e,n),o.setValue([],t,!0))},setVariables:function(e,a){const t=datanodesManager.getCurrentDataNode();for(let n=0;n<e.length;n++){let o=datanodesManager.getDataNodeByName(e[n]);if(_.isUndefined(o))o=datanodesManager.getDataNodeByName(t),o.notificationCallback("error",t,"The dataNode referenced in setVariables api doesn't exist. Please verify your parameters");else{datanodesManager.datanodesDependency().addSetvarList(e[n],t);const i=JSON.parse(JSON.stringify(a[n]));o.setValue([],i,!0)}}},setVariableProperty:function(e,a,t){const n=datanodesManager.getCurrentDataNode(),o=JSON.parse(JSON.stringify(t));let i=datanodesManager.getDataNodeByName(e);_.isUndefined(i)?(i=datanodesManager.getDataNodeByName(n),i.notificationCallback("error",n,"The dataNode referenced in setVariableProperty api doesn't exist. Please verify your parameters")):(datanodesManager.datanodesDependency().addSetvarList(e,n),i.setValue(a,o,!0))},executeDataNode:function(e){const a=datanodesManager.getCurrentDataNode();datanodesManager.foundDatanode(e)?datanodesManager.datanodesDependency().addSetvarList(e,a):datanodesManager.getDataNodeByName(a).notificationCallback("error",a,"The dataNode referenced in executeDataNode api doesn't exist. Please verify your parameters")},executeDataNodes:function(e){const a=datanodesManager.getCurrentDataNode();for(let t=0;t<e.length;t++)datanodesManager.foundDatanode(e[t])?datanodesManager.datanodesDependency().addSetvarList(e[t],a):datanodesManager.getDataNodeByName(a).notificationCallback("error",a,"The dataNode referenced in executeDataNodes api doesn't exist. Please verify your parameters")},viewProject:function(e,a,t){const n=xDashConfig.urlBaseForExport;let o=!1;"999"==xDashConfig.version.minor&&(o=!0);let i="";o||(i="-"+xDashConfig.version.fullVersion);const d=n+"index-view"+i+".html?projectUrl="+e+"&inputParams="+inputHandler.encodeInputPars(a);t?window.open(d,"_blank"):window.location=d},viewPage:function(e,a,t){const n=e+"?inputParams="+inputHandler.encodeInputPars(a);t?window.open(n,"_blank"):window.location=n},goToPage:function(e){customNavigationRuntime.customNavigationGoToPage(e)},enableWidget:function(e){let a=$("#"+e+"c")[0];_.isUndefined(a)||(a.style.pointerEvents="",a.style.opacity="")},disableWidget:function(e){let a=$("#"+e+"c")[0];_.isUndefined(a)||(a.style.pointerEvents="none",a.style.opacity="0.5")},showWidget:function(e){let a=$("#"+e+"c");_.isUndefined(a)||a.show()},hideWidget:function(e){let a=$("#"+e+"c");_.isUndefined(a)||a.hide()},scheduler:scheduler,dashboard:dashboard});
class XdashDataUpdateInformation{constructor(e,t,a){this.fromVersion=e,this.toVersion=t,this.messages=a}}class XdashDataUpdateEngine{static VERSION_REGEX=/^(0|[1-9]\d*)\.(0|[1-9]\d*)$/;static DEFAULT_VERSION="0.0";static CURRENT_VERSION="0.3";static VERSION_METADATA_KEY="fileFormatVersion";constructor(){this.steps=new Map}static createStep(e,t,a){return a.fromVersion=e,a.toVersion=t,a}static readVersion(e){const t=XdashDataUpdateEngine.VERSION_REGEX.exec(e);if(t){return[parseInt(t[1],10),parseInt(t[2],10)]}}static isGreater(e,t){const[a,s]=XdashDataUpdateEngine.readVersion(e),[n,r]=XdashDataUpdateEngine.readVersion(t);return a>n||a===n&&s>r}registerSteps(e){e.forEach((e=>{const t=e.fromVersion,a=e.toVersion;if(!t)throw new Error("No starting version");if(!a)throw new Error("No target version");if(!XdashDataUpdateEngine.readVersion(t))throw new Error(`Invalid starting version ${t}`);if(!XdashDataUpdateEngine.readVersion(a))throw new Error(`Invalid target version ${a}`);if(!XdashDataUpdateEngine.isGreater(a,t))throw new Error(`Target version ${a} is not greater than starting version ${t}`);if(this.steps.get(t))throw new Error(`There already is an update registered for version ${t}`);this.steps.set(t,e)}))}#e(e){const t=[];for(;e!==XdashDataUpdateEngine.CURRENT_VERSION;){const a=this.steps.get(e);if(!a)return null;t.push(a),e=a.toVersion}return t}hasCurrentVersion(e){return(e.meta[XdashDataUpdateEngine.VERSION_METADATA_KEY]??XdashDataUpdateEngine.DEFAULT_VERSION)===XdashDataUpdateEngine.CURRENT_VERSION}update(e,t=!0){const a=e.meta[XdashDataUpdateEngine.VERSION_METADATA_KEY]??XdashDataUpdateEngine.DEFAULT_VERSION;if(XdashDataUpdateEngine.isGreater(a,XdashDataUpdateEngine.CURRENT_VERSION))throw new Error(`Version ${a} is more recent than current version ${XdashDataUpdateEngine.CURRENT_VERSION}`);const s=this.#e(a);if(!s)throw new Error(`There is no update path from version ${a} to ${XdashDataUpdateEngine.CURRENT_VERSION}`);return s.flatMap((a=>{const s=a(e,t);return e.meta[XdashDataUpdateEngine.VERSION_METADATA_KEY]=a.toVersion,s?.length?new XdashDataUpdateInformation(a.fromVersion,a.toVersion,s):[]}))}displayNotifications(e,t=!0){if(e.length){let a=`<div class="swal-text"><p>The ${t?"dashboard":"data"}'s definition was updated to match the current version.</p><br/>`;e.forEach((e=>{a+=`<p>Version ${e.toVersion} notes:</p>`,a+="<ul>"+e.messages.map((e=>`<li> - ${e}</li>`)).join()+"</ul>",a+="<br/>"})),a+="</div>",swal({title:"<strong>Update result</strong>",icon:"warning",html:!0,text:a})}}}var xdashUpdateEngine=new XdashDataUpdateEngine;!function(){function e(e){return new Set(Object.keys(e.dashboard))}function t(e,t){const a="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",s=[0];let n;do{n=t+s.map((e=>a[e])).join(),s[0]+=1;let e=0;for(;s[e]>=62;)s[e]=0,e+=1,s[e]=e===s.length?0:s[e]+1}while(e.has(n));return n}function a(e,t){e.dashboard=Object.fromEntries(Object.entries(e.dashboard).map((([e,a])=>{const s=t.get(e)??e;return a.container.instanceId=s,[s,a]}))),e.connections=Object.fromEntries(Object.entries(e.connections).map((([e,a])=>[t.get(e)??e,a]))),Object.values(e.device.droppers??{}).forEach((e=>{Object.entries(e).filter((([,e])=>t.has(e))).forEach((([a,s])=>e[a]=t.get(s)))}))}const s=[XdashDataUpdateEngine.createStep("0.0","0.1",((e,t)=>{if(t){e.device??={cols:{valueRow:"none",valueCol:"1",maxCells:0,maxCols:0,classType:""},droppers:{}};const t=e.device;if(!t.cols.valueRow)switch(deviceObj.cols.value??"none"){case"none":default:t.cols.valueRow="none";break;case"1":case"3":t.cols.valueRow="1";break;case"6":t.cols.valueRow="6"}if(!t.cols.valueCol)switch(t.cols.value??"none"){case"none":case"1":default:t.cols.valueCol="1";break;case"3":case"6":t.cols.valueCol="3"}delete t.cols.value}const a=e.data;a.datanodes||(a.datanodes=a.datasources??a.dataNodes??[],["datasources","dataNodes"].forEach((e=>{void 0!==a[e]&&delete a[e]}))),Object.values(e.connections??[]).forEach((e=>{Object.values(e).forEach((e=>{e.dataSource&&(e.dataNode=e.dataSource,delete e.dataSource),e.dataSourceIndex&&(e.dataNodeIndex=e.dataSourceIndex,delete e.dataSourceIndex)}))}));const s=new Set;if(a.datanodes.forEach((e=>{const t=e.settings;if(void 0!==t.refresh)t.sampleTime=t.refresh,delete t.refresh;else if(void 0!==t.refresh_time)t.sampleTime=t.refresh_time,delete t.refresh_time;else if(void 0!==t.refresh_rate)t.sampleTime=t.refresh_rate,delete t.refresh_rate;else if(void 0!==t.refreshRate){t.sampleTime=t.refreshRate,delete t.refreshRate;const e=object.version,a=/^(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)$/.exec(e);if(a){const e=parseInt(a[1],10),s=parseInt(a[2],10);(e<0||0===e&&s<7)&&t.explicitTrig&&t.autoStart&&(t.autoStart=!1)}}function a(a){const n=t[a];n&&(t[a]=n.replaceAll("datasources","dataNodes").replaceAll("headersFromDatasourceWS","headersFromDataNodeWS"),n!==t[a]&&s.add(e.name))}switch(e.type){case"FMI_web-service_from_datasource":a("body");break;case"REST_web-service_from_datasource":case"REST_web-service_from_JSON_editor":a("body"),delete t.use_jsonp,void 0!==t.use_thingproxy&&(t.use_xproxy=!!t.use_thingproxy,delete t.use_thingproxy),t.req_data_type??="none",t.headers??=[],0===t.headers.length&&(t.req_data_type="none",t.headers=[{name:"",value:""}]);break;case"WS-send-plugin":case"JSON_memory_plugin":a("json_input");break;case"JSON_formula_plugin":a("json_var_formula");break;case"Python_inline_plugin":case"Python_pyodide_plugin":a("content")}})),s.size){return[`"datasources" has been renamed to "dataNodes". The following nodes may need to be updated : ${[...s].sort().map((e=>`"${e}"`)).join(", ")}`]}})),XdashDataUpdateEngine.createStep("0.1","0.2",((e,t)=>{const a=e.data.datanodes,s=a.filter((e=>"Python_inline_plugin"===e.type)),n=a.filter((e=>"Python_pyodide_plugin"===e.type));[...s,...n].forEach((e=>e.type="Python_plugin")),n.forEach((e=>e.settings.dockerImage={name:"Pyodide",id:"__PYODIDE__"}));const r=new Set;if(s.forEach((e=>{(e.settings.splat||e.settings.munch||e.settings.function||e.settings.args)&&(r.add(e.name),e.settings.args&&(e.settings.content="args = "+currentSettings.args+"\n"+e.settings.content),delete e.settings.splat,delete e.settings.munch,delete e.settings.function,delete e.settings.args)})),r.size){return[`Following changes to the wiring of Python scripts, the following nodes may need to be updated : ${[...r].sort().map((e=>`"${e}"`)).join(", ")}`]}return[]})),XdashDataUpdateEngine.createStep("0.2","0.3",((s,n)=>{if(delete s.data.reIndexMap,delete s.data.noTopologicalSortAtSerialize,!n)return;const r=s.dashboard,o=s.connections,i=s.data.datanodes.filter((e=>"JSON_var_plugin"===e.type)).map((e=>e.name)),d=e(s),l=new Map;Object.entries(r).filter((([,e])=>"flatUiValue"===e.container.modelJsonId)).forEach((([e,a])=>{const s=o[e].value.dataNode,n=s&&i.includes(s),r=a.modelParameters;let c="flatUiValueDisplay";n&&(c=r.isNumber?"flatUiNumericInput":"flatUiTextInput"),delete r.decimalDigits,"flatUiValueDisplay"!==c&&delete r.isNumber,"flatUiTextInput"!==c&&delete r.isPassword;const h=t(d,c);d.add(h),l.set(e,h),a.container.modelJsonId=c})),a(s,l),Object.values(r).forEach((e=>{const t=e.modelParameters,a=e.modelHiddenParams;switch(delete e.container.id,delete e.container.widgetTypeName,e.container.modelJsonId){case"annotationImage":delete a.widthPx,delete a.heightPx,delete a.ratio;break;case"flatUiDoubleSlider":t.forceValuesToMinAndMax??=!1;break;case"plotlyLine":case"plotlyBar":case"plotlyPie":case"plotly3dSurface":case"plotlyGeneric":case"plotlyRealTime":t.hideModeBar??=!1;break;case"flatUiSelect":t.isKeyValuePairs??=!0,t.isKeyValuePairs&&Array.isArray(a.value)?(a.values=a.value.map((e=>e.value??e.key)),a.keys=a.value.map((e=>e.key))):(a.values??=[],a.keys??=[]),delete a.value;break;case"flatUiCheckbox":t.checkboxSize??=1,t.checkboxColor??="#447bdc";break;case"flatUiTable":t.noBorder??=!1;break;case"ledStatus":delete t.redAtStateOff,t.onColor??="#00b700",t.offColor??="#004d00"}}))}))];xdashUpdateEngine.registerSteps(s)}();
var xdash=function(){const e=xDashConfig.version.fullVersion;var t="";const o=angular.element(document.body).scope().$root;function n(){angular.element(document.body).injector().invoke(["UndoManagerService",e=>{e.clear()}]),datanodesManager.clear(),widgetEditor.clear(),xdashNotifications.clearAllNotifications(),o.updateFlagDirty(!1),$("#projectName")[0].value=t,pyodideManager.reset(!0,!1),layoutMgr.resetDashboardTheme(),layoutMgr.resetDashBgColor(),layoutMgr.updateButtonState();angular.element(document.getElementById("help__wrap")).scope().initFrame()}function a(){let t=(new Date).toISOString();return{version:e,[XdashDataUpdateEngine.VERSION_METADATA_KEY]:XdashDataUpdateEngine.CURRENT_VERSION,date:t,name:"",description:"",groupName:"",tags:[],schedulerLogOff:offSchedLogUser}}function r(e){if(!xdashUpdateEngine.hasCurrentVersion(e))try{o.updateFlagDirty(!0);const t=xdashUpdateEngine.update(e);xdashUpdateEngine.displayNotifications(t)}catch(e){return console.error(e),swal({title:"Update failed",icon:"warning",text:e?.message??"The update did not complete successfully"}),!1}try{return $("#projectName")[0].value=e.meta.name,_.isUndefined(e.meta.description)||(o.currentProject.description=e.meta.description),_.isUndefined(e.meta.tags)||(o.currentProject.tags=e.meta.tags),_.isUndefined(e.meta.groupName)||(o.currentProject.groupName=e.meta.groupName),_.isUndefined(e.meta.schedulerLogOff)?offSchedLogUser=!0:offSchedLogUser=e.meta.schedulerLogOff,pyodideLib.deserialize(e),e.data.version=e.meta.version,datanodesManager.load(e.data,!0)?(angular.element(document.body).injector().invoke(["UndoManagerService",e=>{e.clear()}]),widgetEditor.deserialize(e.dashboard,e.scaling,e.device),widgetConnector.deserialize(e.connections),widgetPreview.clear(),widgetEditor.unselectAllWidgets(),layoutMgr.deserializeDashBgColor(e.device),layoutMgr.deserializeDashboardTheme(e.device),_.isUndefined(e.pages)||(layoutMgr.deserializeRowNames(e.pages),layoutMgr.deserializeDefaultRow(e.pages)),layoutMgr.deserializeExportOptions(e.exportOptions),_.isUndefined(e.navBarNotification)?htmlExport.navBarNotification=!1:htmlExport.navBarNotification=e.navBarNotification,!0):(n(),!1)}catch(e){return console.log(e),!1}}function i(e,t){let o="Previous";t&&"datanode"!=e||(o="Cancel"),(new FileMngrFct).GetFileList(e,l,!1,o,null)}function l(e,t,o,n){if("error"==o)swal(e,t,o);else if("success"==o){let o=t,a="files";"project"==o?a="projects":"datanode"==o&&(a="xdsjson"),contentElement=function(e,t){var o=document.createElement("div");o.classList.add("dashboard-form");var n='<label for="selectFile">'+t+"</label>";if(n+='<select class="multiple h-full" name="select-file" id="selectFile" size="10">',!_.isUndefined(e.FileList))for(let t=0;t<e.FileList.length;t++)_.isUndefined(e.FileList[t].Name)||(n=0==t?n+'<option selected value ="'+e.FileList[t].Name+'">'+e.FileList[t].Name+"</option>":n+'<option value ="'+e.FileList[t].Name+'">'+e.FileList[t].Name+"</option>");return n+="</select>",o.innerHTML=n,o}(e,"Please select a "+o+": "),new DialogBox(contentElement,"List of available "+a+" on server","Open",n,(function(){let e=$("#selectFile")[0];if(-1==e.selectedIndex)return!0;{datanodesManager.showLoadingIndicator(!0);let t=e.options[e.selectedIndex].value;swal.close(),(new FileMngrFct).ReadFile(o,t,s)}}))}}function s(e,t,o){if("error"==o)swal(e,t,o);else{let o=e,n=t;"project"==n?d(o):"datanode"==n&&xdsjson.openJsonManager(o)}datanodesManager.showLoadingIndicator(!1)}function d(e){let t;try{t=JSON.parse(e)}catch(e){return void swal("Unable to load file","Project loading will be interrupted.","error")}var o;o=t,angular.element(document.body).injector().invoke(["$rootScope",function(e){e.currentProject={name:o.meta.name}}]);let a=!1,i=function(e){if(angular.element(document.getElementById("dash-ctrl")).scope().reset(),n(),a=r(t),datanodesManager.showLoadingIndicator(!1),document.removeEventListener("widgets-tab-loaded",i),t=void 0,!a)return swal("Unable to load your project","Project loading will be interrupted.","error"),!1};document.addEventListener("widgets-tab-loaded",i),"widgets"==tabActive&&i()}return $(window).bind("beforeunload",(async function(){await async function(){const e=angular.element(document.body).scope().$root;if(e.xDashFullVersion){if(""!==e.currentProject.name){const t=angular.element(document.getElementById("headerbar-ctrl")).scope();if(" *"==e.currentPrjDirty){const o=function(){t.closeProject(e.currentProject.name,!0),console.log("Your project is saved before closing")};fileManager.getFileListExtended("project",e.currentProject.name,void 0,o,!0)}else t.closeProject(e.currentProject.name),console.log("Your project was closed")}}else if(" *"==e.currentPrjDirty){const e=(document.getElementById("projectName").value||"untitled")+"-recovery",t=xdash.serialize();t.meta.name=e;const o=JSON.stringify(t,null,"\t");(new FileMngrFct).SendText("project",e+".xprjson",o,void 0)}}()})),{openFile:function(e,t){"project"==e?fileText="project":"datanode"==e&&(fileText="xdsjson"),"local"===t?function(e){let t=FileMngr.GetFileExt(e);if(window.File&&window.FileReader&&window.FileList&&window.Blob){let o=document.createElement("input");o.type="file",o.setAttribute("accept",t),$(o).on("change",(function(t){"project"==e&&swal.close();let o=t.target.files;if(o&&o.length>0){let t=o[0],n=new FileReader;datanodesManager.showLoadingIndicator(!0),n.addEventListener("load",(function(t){let o=t.target;"project"==e?d(o.result):"datanode"==e&&xdsjson.openJsonManager(o.result)})),n.readAsText(t)}})),$(o).trigger("click")}else swal("Unable to load a file in this browser.","","error")}(e):"server"===t&&i(e,!0)},openFromServer:i,serialize:function(){const e=a();e.name=$("#projectName")[0].value||"Untitled",o.currentProject&&(e.description=o.currentProject.description,e.tags=o.currentProject.tags,e.groupName=o.currentProject.groupName);const t=datanodesManager.serialize(),n=pyodideLib.serialize();let r;r=o.moduleOpened||"widgets"!=tabActive||"edit-dashboard"!=modeActive||"full"!=editorStatus?widgetEditor.getSnapshotDashZoneDims():widgetEditor.getCurrentDashZoneDims();const i=widgetEditor.serialize(),l=layoutMgr.serializeCols(),s=layoutMgr.serializeDashBgColor(),d=layoutMgr.serializeDashboardTheme(),c=widgetConnector.serialize(),u=layoutMgr.serializeRowNames(),g=layoutMgr.serializeDefaultRow(),p=layoutMgr.serializeExportOptions();return navBarNotification=htmlExport.navBarNotification,{meta:e,data:t,libraries:n,scaling:r,device:{...l,...s,...d},dashboard:i,connections:c,exportOptions:p,pages:{...u,...g},checkExportOptions:!0,navBarNotification:navBarNotification}},initMeta:a,openProjectManager:d,deserialize:r,clear:n,pageLoad:!0,readFileFromServer:function(e,t){let o=new FileMngrFct,n=angular.element(document.body),a=n.scope().$root,r=n.scope().$state;a.origin="openProject",a.toggleMenuOptionDisplay("none"),r.go("modules",{}).then((function(){a.moduleOpened=!1,o.ReadFile(t,e+".xprjson",(function(o,n,i){if("ModulesController"!=a.$state.current.controller&&(r.go("modules",{}),console.log("switch to modules controller...")),"success"===i){xdash.openProjectManager(o);let n=new PNotify({title:e,text:"Your "+t+" "+e+" is ready!",type:"success",delay:1800,styling:"bootstrap3"});$(".ui-pnotify-container").on("click",(function(){n.remove()})),a.loadingBarStop(),a.currentProject.name=e}else swal(o,n,i)}))}))},readFileFromUrl:function(e,t){let o;$.get(t,(function(e){o=e})).done((function(){let t=angular.element(document.body),n=t.scope().$root,a=t.scope().$state;n.origin="openProject",n.toggleMenuOptionDisplay("none"),a.go("modules",{}),s(o,e)})).fail((function(e,t){datanodesManager.showLoadingIndicator(!1),swal("Error in loading xprjson from URL","Server response : "+e.status,"error")}))}}}();
var htmlExport=function(){var e=function(e,t,n,o){var r=n.createDocumentType("html",null,null),i=n.createDocument(null,"html",r),a=i.documentElement,s=a.appendChild(i.createElement("head")),c=s.appendChild(i.createElement("title")),d=s.appendChild(i.createElement("meta")),p=a.appendChild(i.createElement("body"));p.setAttribute("ng-app","xCLOUD"),a.setAttribute("lang","en"),c.appendChild(i.createTextNode(o)),d.setAttribute("charset",window.document.characterSet),d.setAttribute("name","viewport"),d.setAttribute("content","width=device-width, initial-scale=1");var l=window.document.createElement("head");l.innerHTML=e;var u=window.document.createElement("body");u.innerHTML=t;for(var h=0;h<l.childNodes.length;h++)s.appendChild(i.importNode(l.childNodes.item(h),!0));for(var x=0;x<u.childNodes.length;x++)p.appendChild(i.importNode(u.childNodes.item(x),!0));var m,v=((m=document.createElement("div")).setAttribute("id","dashboard-zone"),m.setAttribute("class","panel-body"),m.setAttribute("style","padding: 0px"),m.innerHTML='<div id="DropperDroitec" class="dropperR" ng-app="xCLOUD"></div>',m);return p.appendChild(i.importNode(v,!0)),i};function t(t,n){var o=window.document.implementation,r=function(){for(var e=[],t=0;t<exportHeaderCss.length;t++){var n=xDashConfig.urlBaseForExport;e.push('<link rel="stylesheet" href="'+n+exportHeaderCss[t]+'"></link>')}for(t=0;t<exportHeaderJs.length;t++)e.push('<script charset="UTF-8" src="'+xDashConfig.urlBaseForExport+exportHeaderJs[t]+'"><\/script>');return e.join("\n")}(),i=function(e){var t=[],n=[],o=[],r=[],i=[];let a,s=htmlExport.navBarNotification;_.isUndefined(e.navBarNotification)||(s=e.navBarNotification);for(var c=0;c<exportBodyJs.length;c++)t.push('<script src="'+xDashConfig.urlBaseForExport+exportBodyJs[c]+'"><\/script>');var d="jsonContent = "+JSON.stringify(e,null,"  ");a="rowToPage"==e.exportOptions||"rowToTab"==e.exportOptions||s,n.push("","<script>","",'tabActive = "play";',"execOutsideEditor = true;",'urlBase = "'+xDashConfig.urlBaseForExport+'";','navBarNotification = "'+s+'" ;','showNavBar = "'+a+'" ;',"$(function()","{","");var p=d+";";return o.push(""),r.push("reconstructFoundations.loadXprjson(jsonContent);","});","<\/script>",""),a&&i.push(...runtimeToolbar.toolbar),t.join("\n")+n.join("\n")+p+o.join("\n")+r.join("\n")+i.join("\n")}(_.isUndefined(n)?xdash.serialize():n),a=e(r,i,o,t);return(new XMLSerializer).serializeToString(a)}function n(e){var n,o,r;_.isUndefined(e)||(o=e[0],r=e[1]),_.isUndefined($("#select-export-settings")[0])||(htmlExport.exportOptions=$("#select-export-settings")[0].value),_.isUndefined($("#check-scale-export")[0])||(htmlExport.checkExportOptions=$("#check-scale-export")[0].checked),n=_.isUndefined(r)?$("#projectName")[0].value:r;var i=window.open("about:blank","_blank"),a=t(n,o);i.document.write(a),i.document.close(),i.focus()}return{previewDashboardCallback:n,previewDashboard:function(e,t,o){const r=angular.element(document.body).scope().$root.xDashFullVersion?t:$("#projectName").val()||"Untitled";let i;_.isUndefined(e)||_.isUndefined(r)||(i=[e,r]),(htmlExport.checkExportOptions||o)&&n(i)},saveDashboard:function(){!function(){var e=$("#projectName")[0].value;_.isUndefined($("#select-export-settings")[0])||(htmlExport.exportOptions=$("#select-export-settings")[0].value);_.isUndefined($("#check-scale-export")[0])||(htmlExport.checkExportOptions=$("#check-scale-export")[0].checked);!function(e){var t=angular.element(document.body).scope().$root;t.infoPage={isPrivatePage:"True"===t.securedLink,name:e,title:"HTML page export",btnTxt:"Save",exportPage:!0,isManagePageOpen:!0}}(e)}()},exportOptions:"ajustToTargetWindow",checkExportOptions:!0,navBarNotification:!1,createDashboardDocument:t}}();
var widgetsEditorToolboxDefinition={"collapse-basic":{name:"Basic inputs & controls",widgets:["flatUiNumericInput","flatUiTextInput","flatUiCheckbox","flatUiSwitch","flatUiHorizontalSlider","flatUiVerticalSlider","flatUiDoubleSlider","flatUiButton","flatUiFileInputButton","loadFile","saveToFileButton","flatUiSelect","flatUiMultiSelect","flatUiList","flatUiEditableTable"]},"collapse-gauges":{name:"Basic displays",widgets:["flatUiValueDisplay","kpiCard","advancedKpiCard","ledStatus","flatUiProgressBar","scoringFullCircularGauge","scoringSemiCircularGauge","scoringArchCircularGauge","anyDisplay","flatUiTable"]},"collapse-plotly":{name:"Plots",widgets:["plotlyLine","plotlyBar","plotlyPie","plotly3dSurface","plotlyGeneric","plotlyPyGeneric","matplotlib","plotlyRealTime","vegaGeneric","echartsGeneric"]},"collapse-geotime":{name:"Geo & Time",widgets:["openStreetMaps","foliumMaps","flatUiHereAutocompleteValue","datepickerSimple","dateRangePicker","calendarD3","timepickerSimple"]},"collapse-annotations":{name:"Annotation & Video",widgets:["annotationIconInfo","annotationLabel","annotationRectangle","annotationImage","annotationImageConnected","annotationMarkdown","annotationHtml","annotationVideo"]}};
function widgetToolboxClass(){var e=[],i=function(){let e=[],i=[],t=[],o=_.keys(widgetsEditorToolboxDefinition);for(let n=0;n<o.length;n++){i=[],e=widgetsEditorToolboxDefinition[o[n]].widgets,_.each(e,(e=>{i.push(widgetsPluginsHandler.widgetToolbarDefinitions[e].title)}));for(let o=0;o<e.length;o++)t.push({name:e[o],title:i[o]})}return t}();var t=function(){for(var i=e.length>0,t=i?["collapse-search_results"]:_.keys(widgetsEditorToolboxDefinition),o=i?["Search Results"]:_.map(widgetsEditorToolboxDefinition,"name"),n="",l=[],s=[],d=[],r=0;r<t.length;r++){l=[],s=[],d=[],l=i?e:widgetsEditorToolboxDefinition[t[r]].widgets,_.each(l,(e=>{_.isUndefined(widgetsPluginsHandler.widgetToolbarDefinitions[e])?(swal("Widget plugin loader Error","Did not find the definition of delcared widget "+e,"error"),l=_.without(l,e)):(s.push(widgetsPluginsHandler.widgetToolbarDefinitions[e].title),d.push(widgetsPluginsHandler.widgetToolbarDefinitions[e].icn))}));var a=p(t,o,r);n=[n,a=u(a=w(a,s,l,d))].join("\n")}$("#widgetGroups").html(""),$("#widgetGroups")[0].insertAdjacentHTML("beforeend",n);var g=angular.element(document.body).scope().$root;let c=angular.element(document.getElementById("widget__wrap")).scope();function p(e,i,t){return['<div class="widget__groups--wrapper " ng-class="{open:displayedWdgtIndex=='+t+'}">','    <div ng-click="toggleWidgetLibDisplay('+t+')" class="widget__groups--wrapper--top btn--collapse" id="'+e[r]+'">',"        <h3>"+i[r]+"</h3>","        <a>",'            <i class="basic icn-miniarrowbottom"></i>',"        </a>","    </div>",'    <div id="widget__groups--wrapper--icons" class="widget__groups--wrapper--icons">'].join("\n")}function w(e,i,t,o){var n=[],l=0;for(l=0;l<t.length;l++)n[l]=['        <a href="#" title="Click to clone" class="icons__item drag-drop-new" id="'+t[l]+'">','           <i class="widgets icn-'+o[l]+'"> </i>',"               <label>"+i[l]+"</label>","         </a>"].join("\n");for(l=0;l<n.length;l++)e=[e,n[l]].join("\n");return e}function u(e){return e=[e,"  </div>","</div>"].join("\n")}c.myWidgetHTML=$("#widgetGroups").html(),i&&(document.getElementById("widget__groups--wrapper--icons").style.overflow="visible"),i&&0!=c.displayedWdgtIndex&&c.toggleWidgetLibDisplay(0),g.safeApply()};t(),$("#inputSearchWidget").on("input",(function(o){var n=$(this).val(),l=[],s=!1;for(let e=0;e<i.length;e++)n.length>0&&i[e].title.toLowerCase().match(n)&&-1===l.indexOf(i[e].title)&&(l.push(i[e].name),s=!0);s?(e=l,t()):(e=[],t())}))}var WTBC=new widgetToolboxClass;
!function(e){e.fn.hasVScrollBar=function(){return this.get(0).scrollHeight>this.height()},e.fn.hasHScrollBar=function(){return this.get(0).scrollWidth>this.width()},e.fn.computeRatio=function(){return this.get(0).scrollWidth/this.width()}}(jQuery);const RuntimeDashboard=function(){let e;function t(t,a){e=jQuery.extend(!0,{},t.scaling);let o=0;switch($("#nav-menu")[0]&&(o=parseInt($("#nav-menu")[0].style.height),isNaN(o)&&(o=0)),a){case"keepOriginalWidth":$("#dashboard-zone")[0].style.width=e.scrollWidthPx+"px",$("#dashboard-zone")[0].style.height=e.scrollHeightPx+o+"px",e.scalingMethod="scaleTwSp";break;case"adjustToFullWidth":$("#dashboard-zone")[0].style.width="100%",$("#dashboard-zone")[0].style.height=document.body.clientHeight-o+"px",e.scalingMethod="scaleTwSpWS";break;case"ajustToTargetWindow":$("#dashboard-zone")[0].style.width="100%",$("#dashboard-zone")[0].style.height=document.body.clientHeight-o+"px",e.scalingMethod="scaleTwh";break;case"projectToTargetWindow":case"customNavigation":case"rowToTab":case"rowToPage":$("#dashboard-zone")[0].style.width="100%",$("#dashboard-zone")[0].style.height=document.body.clientHeight-o-1+"px",e.scalingMethod="scaleTwhS";break;default:$("#dashboard-zone")[0].style.width="100%",$("#dashboard-zone")[0].style.height="100%"}$("#dashboard-zone")[0].style.margin="auto",$("#dashboard-zone")[0].style["overflow-x"]="hidden",$("#dashboard-zone")[0].style["overflow-y"]="hidden",$("#DropperDroitec")[0].style.height="100%",$("#DropperDroitec")[0].style.width="100%",$("#DropperDroitec")[0].style["overflow-y"]="auto";const r=t.device.cols.maxCols,s=t.device.cols.maxCells/(r||1);let i=jQuery.extend(!0,{},e),d=widgetPreview.getCurrentDashZoneDims();widgetPreview.setScalingInformation(i,e.scalingMethod,s,r),widgetPreview.resizeDashboardCols();const n=widgetPreview.mediaChangeProjection(i,d,s);i=n.referenceFrame,d=n.targetFrame,widgetPreview.setScalingInformation(i,e.scalingMethod,s,r),widgetPreview.resizeDashboard(d)}return{initContainers:t,loadDashboard:function(e,a){let o=$("<textarea />").html(JSON.stringify(e.data)).text(),r="";try{r=JSON.parse(o)}catch(e){return void swal("JSON Parse error",e.message,"error")}pyodideLib.deserialize(e),datanodesManager.load(r,!0),t(e,a);for(const t in e.dashboard)if(_.isEmpty(e.dashboard[t].modelParameters)||(modelsParameters[t]=e.dashboard[t].modelParameters),_.isEmpty(e.dashboard[t].modelHiddenParams)||(modelsHiddenParams[t]=e.dashboard[t].modelHiddenParams),_.isUndefined(modelsTempParams[t])){const e=t.substring(0,t.length-1);modelsTempParams[t]=jQuery.extend(!0,{},modelsTempParams[e])}switch(e.meta,$("html").attr("data-theme",e.device.theme),widgetPreview.deserialize(e.connections),widgetPreview.renderDashboardWidgets(e,!0),$(".dropperR").css("background-color",e.device.backgroundColor),e.exportOptions){case"rowToPage":rowToPageRuntime.rowToPageModeInit(e);break;case"rowToTab":rowToTabRuntime.rowToTabModeInit(e);break;case"customNavigation":customNavigationRuntime.customNavigationModeInit(e);break;case"projectToTargetWindow":customNavigationRuntime.jsonContent=e}setTimeout((()=>{widgetPreview.assignValueChangeHandlers()}),2e3)}}}();
var xdashNotifications=function(){var t=angular.element(document.body).scope().$root;return t.PnotifyStatus=!1,{addNotification:function(e,a){e.title&&e.text&&e.type&&(t.listNotifications.unshift(e),t.nbNotifications++,a||t.PnotifyStatus||(t.PnotifyStatus=!0,setTimeout((function(){t.PnotifyStatus=!1,function(t){let e=new PNotify({title:t.title,text:t.text,type:t.type,delay:1800,styling:"bootstrap3"});$(".ui-pnotify-container").on("click",(function(){e.remove()}))}(e)}),300)),t.safeApply())},manageNotification:function(t,e,a,n){var i="dataNode",o="",s="",c="",r=!0;switch(t){case"warning":o="warning",s="Warning",c="assets/img/flat-icon/warning.png";break;case"success":o="success",s="Success",c="assets/img/flat-icon/success.png";break;case"error":o="error",s="Error",c="assets/img/flat-icon/error.png";break;case"info":o="info",s="Info",c="assets/img/flat-icon/info-custom.png";break;default:o="info",s="Info",c="assets/img/flat-icon/info.png"}if(_.isUndefined(datanodesManager.getDataNodeByName(e)))console.log("notification is not possible before dataNode creation.");else{if(_.isUndefined(datanodesManager.getDataNodeByName(e).__notifications)&&(datanodesManager.getDataNodeByName(e).__notifications=[]),n){r=!1;var f="none";datanodesManager.getDataNodeByName(e).__notifications.length>0&&(f=datanodesManager.getDataNodeByName(e).__notifications[0].type),"error"!==f&&"warning"!==f&&"info"!==f||(r=!0)}if(r){datanodesManager.getDataNodeByName(e).__notifications.unshift({type:o,title:s,text:a,kind:i,dataNode:e,img:c,time:(new Date).timeNow()});var d=!1,g="";null!==datanodesManager.getDataNodeByName(e).execInstance()&&(g=datanodesManager.getDataNodeByName(e).execInstance().getSchedulerCallOrigin()),datanodesManager.getDataNodeByName(e).sampleTime()<"60"&&"timer"==g&&(d=!0),xdashNotifications.addNotification({type:o,title:s,text:a,kind:i,dataNode:e,img:c,time:(new Date).timeNow()},d)}}},clearAllNotifications:function(){t.listNotifications=[],t.nbNotifications=0,t.safeApply()}}}();
var urlQueryEntry={process:function(e){if(!e&&xdash.pageLoad){xdash.pageLoad=!1;let e=findGetParameter("project");if(null==e){let e=findGetParameter("projectUrl");if(null==e){let e=findGetParameter("template");null!=e&&xdash.readFileFromServer(e,"template")}else xdash.readFileFromUrl("project",e)}else xdash.readFileFromServer(e,"project")}}};
var datanodesManager=function(){var e,n={},t=new DatanodeDependency;"undefined"==typeof execOutsideEditor?this.execOutsideEditor=!1:execOutsideEditor?this.execOutsideEditor=!0:this.execOutsideEditor=!1,this.execOutsideEditor||(e=new GraphVisu(t));var a=new TimeManager,o=new FreeboardUI,i=new DatanodesListModel(n,o,t,a),d=new JSONEdit,s={},r=new JSEditor,c=new PluginEditor(r);let l=null;const g=angular.element(document.body).injector();var u;function p(e){const n=e.name();if(e.sampleTime()&&a.unregisterDatanode(n),t.hasSuccessors(n)){let e=Array.from(t.getSuccessors(n)).toString();e=e.replaceAll(",",", "),swal("Deleting dataNode side effects",'This dataNode "'+n+'" is still used in dataNode(s) "'+e+'".\n It must be changed.',"warning")}var o=angular.element(document.body).scope().$root;i.deleteDatanode(e),i.datanodes.remove(e),o.alldatanodes=datanodesManager.getAllDataNodes(),o.filtredNodes=o.alldatanodes.length,o.updateFlagDirty(!0),o.safeApply(),t.updateDisconnectedGraphsList(n,"delete"),offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("All disconnected Graphs after delete: ",t.getAllDisconnectedGraphs()),l&&l.sendEvent(EVENTS_EDITOR_DATANODE_DELETED,[n])}function m(e){var n=!1,t=[];for(var a in widgetConnector.widgetsConnection)for(var o in widgetConnector.widgetsConnection[a].sliders)"None"!=widgetConnector.widgetsConnection[a].sliders[o].name&&widgetConnector.widgetsConnection[a].sliders[o].dataNode===e&&(n=!0,t.push(a));return n||(t=[]),[n,_.uniq(t)]}function f(e,n,t){if([bFoundConnection,prop]=m(e.name()),"datanode"==n&&bFoundConnection){let n=[];for(let e=0;e<prop.length;e++)n.push(widgetConnector.widgetsConnection[prop[e]].instanceId);swal({title:"Are you sure?",text:"This dataNode will be deleted and connections with widget(s) '"+n.join("\n")+"' may be removed!",type:"warning",showCancelButton:!0,showConfirmButton:!1,showConfirmButton1:!0,confirmButtonText:"Yes",cancelButtonText:"Abandon",closeOnConfirm:!0,closeOnConfirm1:!0,closeOnCancel:!0},(function(n){if(n){if(p(e),angular.element(document.body).scope().$root.bIsPlayMode)for(key in widgetConnector.widgetsConnection)widgetPreview.plotConstantData(key,!1)}}))}else{var a=angular.element(document.body).scope().$root;a.isPopupWindow=!0,a.popupTitle="Confirm Delete",a.popupText="Are you sure you want to delete this "+t,a.popupAction=function(){"datanode"==n&&p(e)}}}function y(e,n){const o=e.name(),d=n.settings.name;if(e.isSettingNameChanged(d)){if(datanodesManager.foundDatanode(d))return swal(`A dataNode with name '${d}' adready exists.`,"Please specify a different name","error"),!0;if(t.hasSuccessors(e.name())){var s=Array.from(t.getSuccessors(e.name()));xdashNotifications.manageNotification("info",e.name(),'Update new name "'+n.settings.name+'" in script of "'+s+'"');for(let t in s){const a=e.name(),o=n.settings.name;let i="";"Python_plugin"===datanodesManager.getDataNodeByName(s[t]).type()||"Python_pyodide_plugin"===datanodesManager.getDataNodeByName(s[t]).type()?i=datanodesManager.getDataNodeByName(s[t]).settings().content:"JSON_formula_plugin"===datanodesManager.getDataNodeByName(s[t]).type()?i=datanodesManager.getDataNodeByName(s[t]).settings().json_var_formula:"REST_web-service_from_datasource"===datanodesManager.getDataNodeByName(s[t]).type()?i=datanodesManager.getDataNodeByName(s[t]).settings().body:"JSON_delay_plugin"===datanodesManager.getDataNodeByName(s[t]).type()&&(i=datanodesManager.getDataNodeByName(s[t]).settings().json_input),replacedScript=i.replace(new RegExp('dataNodes\\["'+a+'"\\]',"g"),'dataNodes["'+o+'"]').replace(new RegExp("dataNodes\\."+a,"g"),"dataNodes."+o),"Python_plugin"===datanodesManager.getDataNodeByName(s[t]).type()||"Python_pyodide_plugin"===datanodesManager.getDataNodeByName(s[t]).type()?datanodesManager.getDataNodeByName(s[t]).settings().content=replacedScript:"JSON_formula_plugin"===datanodesManager.getDataNodeByName(s[t]).type()?datanodesManager.getDataNodeByName(s[t]).settings().json_var_formula=replacedScript:"REST_web-service_from_datasource"===datanodesManager.getDataNodeByName(s[t]).type()?datanodesManager.getDataNodeByName(s[t]).settings().body=replacedScript:"JSON_delay_plugin"===datanodesManager.getDataNodeByName(s[t]).type()&&(datanodesManager.getDataNodeByName(s[t]).settings().json_input=replacedScript)}}if([bFoundConnection,prop]=m(e.name()),bFoundConnection){let t=[];for(let a in widgetConnector.widgetsConnection)for(let o in widgetConnector.widgetsConnection[a].sliders)e.name()===widgetConnector.widgetsConnection[a].sliders[o].dataNode&&(t.push(widgetConnector.widgetsConnection[a].instanceId),widgetConnector.widgetsConnection[a].sliders[o].dataNode=n.settings.name);xdashNotifications.manageNotification("info",e.name(),'Update new name "'+n.settings.name+'" in connected widgets "'+t.join("\n")+'"')}null!=e.execInstance()&&e.execInstance().stopOperation(o),i.renameDatanodeData(o,d)}t.renameNode(o,d),e.name(d),_.isUndefined(n.settings.sampleTime)||e.isSettingSampleTimeChanged(n.settings.sampleTime)&&e.sampleTime(n.settings.sampleTime),e.type(n.type),e.settings(n.settings);const r="icn-"+n.iconType.replace(/\.[^/.]+$/,"");if(e.iconType(r),l&&l.sendEvent(EVENTS_EDITOR_DATANODE_UPDATED,{oldName:o,newName:d}),e.error())return!0;t.computeAllDisconnectedGraphs(),offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("All disconnected Graphs after rename: ",t.getAllDisconnectedGraphs()),_.isUndefined(n.settings.sampleTime)?e.schedulerStart(void 0,void 0,"edit"):0!=e.sampleTime()?a.registerDatanode(e.sampleTime(),e.name(),"edit"):a.isRegisteredDatanode(e.name())&&(a.unregisterDatanode(e.name()),e.schedulerStart(void 0,void 0,"edit"))}return g?.has("EventCenterService")&&g.invoke(["EventCenterService",e=>{l=e}]),ko.bindingHandlers.pluginEditor={init:function(e,t,a,o,i){var d=ko.unwrap(t()),s="";"datanode"==d.type&&(n,s="DataNode"),$(e).click((function(n){if("delete"==d.operation)f(o,d.type,s);else if("refresh"==d.operation)o.schedulerStart(void 0,void 0,"refresh");else if("stop"==d.operation)null!=o.execInstance()&&o.execInstance().stopOperation(o.name());else if("showTooltip"==d.operation)"datanode"==d.type&&($(e).tooltip("fixTitle"),$(e).tooltip("show"));else if("hide"==d.operation)"data-preview"==d.type&&$(e).parent().parent().parent().remove();else{"datanode"==d.type&&("add"==d.operation?{}:(o.type(),o.settings().name=o.name()))}}))}},ko.virtualElements.allowedBindings.datanodeTypeSettings=!0,ko.bindingHandlers.datanodeTypeSettings={update:function(e,n,t,a,o){processPluginSettings(e,n,t,a,o)}},{initialize:function(e){ko.applyBindings(i),o.showLoadingIndicator(!1),document.querySelectorAll(".docsLink").forEach((function(e){e.href=xDashConfig.urlDoc})),urlQueryEntry.process(e)},load:function(e,n,t){const a=i.datanodes().map((e=>e.name()));if(i.load(e,n,t),i.error())return!1;if(l){const t=i.datanodes().map((e=>e.name()));if(n)a.length&&l.sendEvent(EVENTS_EDITOR_DATANODE_DELETED,a),t.length&&l.sendEvent(EVENTS_EDITOR_DATANODE_CREATED,t);else{const n=e.datanodes.map((e=>e.name));n.length&&l.sendEvent(EVENTS_EDITOR_DATANODE_CREATED,n)}}return!0},serialize:function(){return i.serialize()},loadDatanodePlugin:function(e){_.isUndefined(e.display_name)&&(e.display_name=e.type_name),"Memory_plugin"!==e.type_name?e.settings.unshift({name:"name",display_name:"Name",type:"text",required:!0}):e.settings.unshift({name:"name",display_name:"Generated memory name",type:"text",disabled:!0}),n[e.type_name]=e,i._datanodeTypes.valueHasMutated()},getDataNodePluginTypes:function(){return n},setAssetRoot:function(e){r.setAssetRoot(e)},showLoadingIndicator:function(e){o.showLoadingIndicator(e)},foundDatanode:function(e){var n=i.datanodes();return datanode=_.find(n,(function(n){return n.name()===e})),!!datanode},getDataNodeByName:function(e){const n=i.datanodes();return _.find(n,(n=>n.name()===e))},getAllDataNodes:function(){return i.datanodes()},clear:function(){schedulerProfiling={};const e=i.datanodes().map((e=>e.name()));i.clear(),self.eventCenter&&e.length&&self.eventCenter.sendEvent(EVENTS_EDITOR_DATANODE_DELETED,e)},showDepGraph:function(n){e.showDepGraph(n),angular.element(document.getElementById("dependency__graph--container")).scope().getUniqTypes()},editNodeFromGraph:function(e){angular.element(document.getElementById("dependency__graph--container")).scope().editNodeFromGraph(e)},selectNodeFromTagList:function(n){e.selectNodeFromTagList(n)},selectConnectedWithWidget:function(n){e.selectConnectedWithWidget(n)},closeGraph:function(){e.closeGraph()},isSingletonNode:function(e){return t.isSingletonNode(e)},RemoveUnusedDatanodes:function(){var e=[],n=t.getAllsingletonNodes();for(let t in n)[bFoundConnection,prop]=m(n[t]),bFoundConnection||e.push(n[t]);offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("zombie: ",e);var a=[],o=xdsjson.getDataList(e,"Unused data is a singleton node that is not connected to any widget.<br>Please check data to be deleted : ");new DialogBoxForData(o,"List of unused data","Delete","Cancel",(function(){for(var n=0;n<e.length;n++)$("#data-checkbox-"+n).is(":checked")&&(a[n]=e[n],p(datanodesManager.getDataNodeByName(e[n])),!0)}))},stopSchedule:function(){var e=i.datanodes();for(var n in t.clearExtraStartNodesList(),t.clearSetvarList(),t.clearProcessedSetvarList(),t.clearCurrentGraphList(),e)if(null!=e[n].execInstance()){e[n].execInstance().stopAllOperations(),swal("Scheduler progress","scheduler is stopped!","success");break}},isConnectedWithWidgt:m,previewWidget:function(e){var n=[];$("#widgets-preview-top > div").each(((e,t)=>{n.push(t.id),$("#"+t.id).hide()})),$("#widget-preview-zone-"+e).show()},deleteDataNode:function(e,n,t){f(e,n,t)},createPluginEditor:function(e,n,t,a){!function(e,n,t,a){c.createPluginEditor(e,n,t,a)}(e,n,t,a)},settingsSavedCallback:function(e,o,d){return c.saveSettings(d,o,(()=>!!(e?y(e,o):function(e){if(datanodesManager.foundDatanode(e.settings.name))return swal("A dataNode with name '"+e.settings.name+"' adready exists.","Please specify a different name","error"),!0;const o=new DatanodeModel(i,n,t,a);o.name(e.settings.name),o.settings(e.settings),o.type(e.type);const d="icn-"+e.iconType.replace(/\.[^/.]+$/,"");if(o.iconType(d),o.error())return!0;o.isSchedulerStartSafe(!0),i.addDatanode(o),t.updateDisconnectedGraphsList(o.name(),"add"),offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("All disconnected Graphs after add: ",t.getAllDisconnectedGraphs()),_.isUndefined(e.settings.sampleTime)||0==e.settings.sampleTime?o.schedulerStart(void 0,void 0,"unidentified"):(o.sampleTime(e.settings.sampleTime),a.registerDatanode(o.sampleTime(),o.name(),"unidentified")),l&&l.sendEvent(EVENTS_EDITOR_DATANODE_CREATED,[o.name()]),angular.element(document.body).injector().invoke(["$rootScope",function(e){}]);var s=angular.element(document.body).scope().$root;s.alldatanodes=datanodesManager.getAllDataNodes(),s.safeApply()}(o))))},updateDatanode:y,getOldSettingsCallback:function(e){!function(e){if(_.isFunction(e.getSavedSettings)){var n=e.getSavedSettings();if(!_.isUndefined(n))e.settings(n[1]),e.statusCallback(n[0]),e.name()!==n[1].name&&(i.renameDatanodeData(e.name(),n[1].name),t.renameNode(e.name(),n[1].name)),e.name(n[1].name),n[1]}}(e)},getDataNodeNewSettings:function(){return c.getNewSettings()},getJsonEd:function(){return d},setJsonEditor:function(e){s=e},getJsonEditor:function(){return s},datanodesDependency:function(){return t},setCurrentDataNode:function(e){u=e},getCurrentDataNode:function(){return u}}}();
!function(){datanodesManager.loadDatanodePlugin({type_name:"JSON_var_plugin",display_name:"Variable",icon_type:"json-variable.svg",description:"JavaScript workspace variable",external_scripts:[""],settings:[{name:"json_var",display_name:"Variable",type:"json",description:"JSON, array or primitive data type variable (with read/write permissions)"}],expose_as_files:[{key:"json_var",nameSuffix:"value.json"}],newInstance:function(e,r,t,a){return r(new n(e,t,a)),!0}});var n=function(n,e,r){const t=this;let a={},s=n;t.onSettingsChanged=function(n){return!!t.isJsonParsingSuccess(n)&&(s=n,!0)},t.isJsonParsingSuccess=function(n){r("Pending");try{return a=JSON.parse(n.json_var),!0}catch(n){return swal("JSON Parse error",n.message,"error"),r("Error","Error in JSON parse"),!1}},t.isSettingNameChanged=function(n){return s.name!==n},t.updateNow=function(){return s.json_var=JSON.stringify(a),r("OK"),e(a),!0},t.onDispose=function(){},this.canSetValue=function(){return{acceptPath:!0,hasPostProcess:!1}},t.isInternetNeeded=function(){return!1},t.setValue=function(n,e){if(n.length){const r=n.length-1;let t=a;for(let e=0;e<r;e++)t=t[n[e]];t[n[r]]=e}else a=e;Array.isArray(a)?a=[...a]:a&&a.contructor===Object&&(a={...a})},t.getValue=function(n){let e=a;if(n)for(const r of n)e=e[r];return e},t.isJsonParsingSuccess(s)}}();
!function(){var e=!1;datanodesManager.loadDatanodePlugin({type_name:"JSON_delay_plugin",display_name:"Delay",icon_type:"delay.svg",description:"JavaScript one-step delay operator",external_scripts:[""],settings:[{name:"json_init",display_name:"init value",type:"json",description:"Initial value (JSON, array or primitive data type)"},{name:"json_input",display_name:"Input signal",type:"calculated",description1:"Write JavaScript formula to define JSON, array or primitive data type input to be delayed.",description2:"Browse and select a dataNode from workspace to use it in the formula."}],newInstance:function(t,a,r,i){return a(new n(t,r,i)),!e}});var n=function(n,t,a){e=!1;var r=this,i={},o={},s={},u=!0,d=n;r.onSettingsChanged=function(e){d=e;try{i=JSON.parse(d.json_init),d}catch(e){return swal("JSON Parse error",e.message,"error"),a("Error"),!1}return!0},r.isSettingNameChanged=function(e){return d.name!=e},r.updateNow=function(){if(a("Pending"),u)try{u=!1,i=JSON.parse(d.json_init)}catch(e){return swal("JSON Parse error",e.message,"error"),a("Error"),t(void 0,"Error"),!1}return o=i,i="object"==typeof s?jQuery.extend(!0,{},s):s,a("OK"),t(o),"OK",d,!0},r.onDispose=function(){},r.canSetValue=function(){return!1},r.isInternetNeeded=function(){return!1},r.onCalculatedValueChanged=function(e,n){s=n}}}();
!function(){var e=!1;datanodesManager.loadDatanodePlugin({type_name:"Memory_plugin",display_name:"Memory",icon_type:"memory.png",description:"Memory operator (past value)",external_scripts:[""],settings:[{name:"value_init",display_name:"initial value",type:"json",short_display:!0,default_value:0,description:"Initial value (number, boolean, JSON or array)"},{name:"datanode_origin",display_name:"DataNode origin",type:"option",from_datanode:!0,options:[],description:"Select the datanode origin for your past value"}],newInstance:function(t,a,r,o){return a(new n(t,r,o)),!e}});var n=function(n,t,a){e=!1;var r=this,o={},i=!0,s=n;r.onSettingsChanged=function(e){s=e;try{o=JSON.parse(s.value_init),s}catch(e){return swal("JSON Parse error",e.message,"error"),a("Error"),!1}return!0},r.isSettingNameChanged=function(e){return s.name!=e},r.updateNow=function(){if(a("Pending"),i)try{return i=!1,o=JSON.parse(s.value_init),a("OK"),t(o),"OK",s,!0}catch(e){return swal("JSON Parse error",e.message,"error"),a("Error"),t(void 0,"Error"),!1}o;let e=s.datanode_origin;if(!datanodesManager.foundDatanode(e)){const n="DataNode '"+e+"' does not exist in dataNodes list";return datanodeModel.statusCallback("Error",n),datanodeModel.notificationCallback("error",datanodeModel.name(),n),!1}let n=datanodesManager.getDataNodeByName(e).latestData();return o="object"==typeof n?jQuery.extend(!0,{},n):n,a("OK"),t(o),"OK",s,!0},r.onDispose=function(){},this.canSetValue=function(){return!0},r.isInternetNeeded=function(){return!1},this.isSpecificExecution=function(){return!0},this.setValue=function(e,n){if(i=!0,0==e.length)return o=n,void(s.value_init=JSON.stringify(o));if(1==e.length)o[e[0]]=n;else{for(var t,a=0;a<e.length-1;a++)t=0==a?o[e[a]]:t[e[a]];t[e[e.length-1]]=n}s.value_init=JSON.stringify(o)}}}();
!function(){var e=!1;datanodesManager.loadDatanodePlugin({type_name:"JSON_formula_plugin",display_name:"JavaScript",icon_type:"json-formula.svg",description:"JavaScript Script (client-side) plugin",external_scripts:[""],settings:[{name:"autoStart",display_name:"AUTO START",description:"DataNode is executed automatically at start (project load, its creation/modification).",type:"boolean",default_value:!0},{name:"explicitTrig",display_name:"Explicit trigger",description:"DataNode is executed only if triggered explicitly (no execution when its predecessors are updated). It is executed automatically once when AutoStart is YES.",type:"boolean",default_value:!1},{name:"json_var_formula",display_name:"Javascript formula",type:"calculated",description1:"Write Javascript formula that returns a JSON, array or primitive data type ouptput",description2:"Browse and select a dataNode from workspace to use it in the formula."}],newInstance:function(a,n,i,r,o){if(!n(new t(a,i,r,o)))return!e}});var t=function(t,a,n,i){e=!1;var r=this,o={},u=t,s=t,l="None";r.onSettingsChanged=function(e){return u=e,!0},r.isSettingNameChanged=function(e){return u.name!=e},r.getSavedSettings=function(){return[l,s]},r.updateNow=function(){return n("Pending"),_.isNull(o)||_.isUndefined(o)?(e=!0,text="Formula is null or undefined",n("Error",text),a(o,"Error"),!1):_.isObject(o)&&_.isEmpty(o)&&_.isEmpty(u.json_var_formula)?(e=!0,text="Formula is empty",i("warning",u.name,text,"Formula error"),n("Error",text),a(o,"Error"),!1):(e=!1,l="OK",s=u,n("OK"),a(o),!0)},r.onDispose=function(){},r.canSetValue=function(){return!1},r.isInternetNeeded=function(){return!1},r.onCalculatedValueChanged=function(e,t){o=t}}}();
!function(){var e=function(e,a,r,s,n){t=!1;var o,i,d=e,l="JSON",p="",u="",c={};function y(){var e=d.url;switch(u=d.url,d.resp_data_type){case"JSON":l="json";break;case"binary":l="binary";break;case"text":l="text"}if(d.use_xproxy)switch(d.method){case"GET":u=xServConfig.urlxProxy+"Get";break;case"POST":u=xServConfig.urlxProxy+"Post";break;case"PUT":u=xServConfig.urlxProxy+"Put";break;case"DELETE":u=xServConfig.urlxProxy+"Delete"}if("calculated"!=s&&(p=d.body),p){try{c=JSON.parse(p),"GET"==d.method&&(p="")}catch(e){return swal("JSON Parse error",e.message,"error"),!1}_.isUndefined(c)||_.isNull(c)||_.isUndefined(c.urlAppend)||(d.use_xproxy?e=d.url+c.urlAppend:u+=c.urlAppend)}if(d.use_xproxy){var a={};if(_.each(d.headers,(function(e){var t=e.name,r=e.value;a[t]=r})),!_.isUndefined(c)&&!_.isNull(c)){if(!_.isUndefined(c.headersFromDataNodeWS))for(var t in c.headersFromDataNodeWS)a[t]=c.headersFromDataNodeWS[t];if(Array.isArray(c))for(let e=0;e<c.length;e++)if(_.isUndefined(c[e].headersFromDatasourceWS)||(c[e].headersFromDataNodeWS=c[e].headersFromDatasourceWS,delete c[e].headersFromDatasourceWS),!_.isUndefined(c[e].headersFromDataNodeWS))for(var t in c[e].headersFromDataNodeWS)a[t]=c[e].headersFromDataNodeWS[t]}var r="";if(p){let e=JSON.parse(p);if(!_.isUndefined(e)&&!_.isNull(e)&&(_.isUndefined(e.headersFromDataNodeWS)||delete e.headersFromDataNodeWS,Array.isArray(e)))for(let a=0;a<e.length;a++)_.isUndefined(e[a].headersFromDatasourceWS)||delete e[a].headersFromDatasourceWS,_.isUndefined(e[a].headersFromDataNodeWS)||delete e[a].headersFromDataNodeWS;_.isUndefined(e)||_.isNull(e)||_.isUndefined(e.urlAppend)||delete e.urlAppend,r=JSON.stringify(e)}p={URL:e,Body:r,Headers:JSON.stringify(a)},p=JSON.stringify(p)}else if(p)try{let e=JSON.parse(p);if(!_.isUndefined(e)&&!_.isNull(e)&&(_.isUndefined(e.headersFromDataNodeWS)||delete e.headersFromDataNodeWS,Array.isArray(e)))for(let a=0;a<e.length;a++)_.isUndefined(e[a].headersFromDatasourceWS)||delete e[a].headersFromDatasourceWS,_.isUndefined(e[a].headersFromDataNodeWS)||delete e[a].headersFromDataNodeWS;_.isUndefined(e)||_.isNull(e)||_.isUndefined(e.urlAppend)||delete e.urlAppend,p=JSON.stringify(e)}catch(e){return swal("Data Parse error",e.message,"error"),!1}function n(){let e=JSON.parse(p),a=JSON.parse(e.Headers);a["ProxyCode-Hash"]=d.proxyHash,a["ProxyCode-Sig"]=d.proxySig,e.Headers=JSON.stringify(a),p=JSON.stringify(e)}if(d.use_xproxy&&(l="json"),d.use_xproxy){_.isUndefined(d.proxyHash)&&(d.proxyHash=""),_.isUndefined(d.proxySig)&&(d.proxySig="");let a=new FileMngrFct;if(proxyHashTemp=a.Hash4Proxy(e,"xdash"),""!==d.proxyHash&&d.proxyHash.localeCompare(proxyHashTemp))n();else{d.proxyHash=proxyHashTemp;let e=JSON.stringify({Hash:d.proxyHash});i=$.ajax({url:xServConfig.urlxProxy+"Sign",type:"POST",contentType:"application/json; charset=utf-8",dataType:"json",data:e,success:function(e){var a=jQuery.parseJSON(e.d);return a.Success?(d.proxySig=a.Msg,n(),!0):(swal("Proxy signing error",a.Msg,"error"),d.proxySig="",!1)},error:function(e,a,t){return swal("Proxy signing error",e.statusText,"error"),d.proxySig="",!1}})}}return!0}function m(e,t,s){let i=null;const l=d.use_xproxy?"POST":d.method;o=$.ajax({url:e,dataType:t,type:l||"GET",data:s,responseType:"arraybuffer",beforeSend:function(e){try{if(d.use_xproxy)e.setRequestHeader("Content-Type","application/json");else if(_.each(d.headers,(function(a){var t=a.name,r=a.value;_.isUndefined(t)||_.isUndefined(r)||e.setRequestHeader(t,r)})),!_.isUndefined(c)&&!_.isNull(c)){if(!_.isUndefined(c.headersFromDataNodeWS))for(var a in c.headersFromDataNodeWS)e.setRequestHeader(a,c.headersFromDataNodeWS[a]);if(Array.isArray(c))for(let t=0;t<c.length;t++)if(_.isUndefined(c[t].headersFromDatasourceWS)||(c[t].headersFromDataNodeWS=c[t].headersFromDatasourceWS,delete c[t].headersFromDatasourceWS),!_.isUndefined(c[t].headersFromDataNodeWS))for(var a in c[t].headersFromDataNodeWS)e.setRequestHeader(a,c[t].headersFromDataNodeWS[a])}}catch(e){swal("Error",e.message,"error")}},success:function(e,s,i){if("Stop"==datanodesManager.getDataNodeByName(d.name).schedulerStatus())return r("None","Request is aborted"),a(void 0,"None"),n("info",d.name,"Response status 0 : abort"),!1;o=void 0;const l=i.getResponseHeader("Content-Type");if("json"===t)if(d.use_xproxy){const t=Object.keys(e);if(1===t.length&&"d"===t[0]){try{e=JSON.parseMore(e.d)}catch(e){return r("Error","Data parse error"),"Error",n("error",d.name,"Data parse error : "+e.message),void(bFinishTick=!0)}if(!e.Success){var p="";p=_.isUndefined(e.Message)?'xProxy returned error at dataNode "'+d.name+'"':'xProxy returned error at dataNode "'+d.name+'" : "'+e.Message+'"';const a="Response status "+i.status+" :"+p;return n("error",d.name,a),"Error",r("Error",a),!1}if(!_.isUndefined(e.Body))if(_.isUndefined(e.Headers["Content-Type"])){if(_.isNull(e.Body))return r("OK"),a(null),n("success",d.name,e.Message),"OK",!0}else{const a=e.Headers["Content-Type"],[t,s]=decodeMimeType(a),o=stripUndefined({type:t,charset:s});if(a.match("application/json"))try{e=JSON.parseMore(e.Body)}catch(e){return r("Error","Data parse error"),"Error",n("error",d.name,"Data parse error : "+e.message),void(bFinishTick=!0)}else if(a.startsWith("text"))e={content:e.Body,...o};else{e={content:e.Body,isBinary:!0,...o}}const l=`Response status ${i.status}: ${i.statusText}`;n("success",d.name,l)}}else{const e=`Response status ${i.status}: ${i.statusText}`;n("success",d.name,e)}}else{const e=`Response status ${i.status}: ${i.statusText}`;n("success",d.name,e)}else{const a="text"!==t,[r,s]=decodeMimeType(l),o=stripUndefined({type:r,charset:s});e={content:a?base64ArrayBuffer(e):e,isBinary:a,...o};const p=`Response status ${i.status}: ${i.statusText}`;n("success",d.name,p)}return r("OK"),a(e),"OK",!0},error:function(e,t,s){var i="error",l="Error";o=void 0,"abort"===t&&(i="info",l="None");const p=`Response status ${e.status}: ${e.statusText}. Ajax status: ${t}.`;if("Error",_.isUndefined(e.responseText))n(i,d.name,p);else{var u="",c=e.responseText.search("type"),y=e.responseText.search(">");u=-1!=c&&-1!=y?e.responseText.slice(c,y):e.responseText,n(i,d.name,p+". "+u)}return r(l,p),a(void 0,l),!1},complete:function(e,a){clearInterval(i)}}),i=setInterval((function(){navigator.onLine||_.isUndefined(o)||(datanodesManager.getDataNodeByName(d.name).completeExecution("NOP"),datanodesManager.getDataNodeByName(d.name).schedulerStatus("Stop"),n("error",d.name,"Internet is disconnected. Request of '"+d.name+"' wil be aborted"),o.abort())}),1e3)}this.updateNow=function(e){return e&&d.sampleTime>0&&d.explicitTrig&&(n("warning",d.name,'Explicit Trigger option is turned off (False) because "'+d.name+'" is periodic and was triggered explicitly'),d.explicitTrig=!1),r("Pending"),function(e,a,t){o&&4!=o.readyState&&o.abort();i&&4!=i.readyState?i.done((function(){m(e,a,t=p)})):m(e,a,t)}(u,l,p),!0},this.onDispose=function(){},this.onSettingsChanged=function(e,a){"OK"===a&&(a,d),d=e;for(var t=0;t<d.headers.length;t++)""===d.headers[t].name&&d.headers.splice(t,t+1);var r=y();return r&&d,r},this.isSettingNameChanged=function(e){return d.name!=e},this.isSettingSampleTimeChanged=function(e){return d.sampleTime!=e},this.getXHR=function(){return o},this.canSetValue=function(){return!1},this.isInternetNeeded=function(){return!0},t=!y(),"calculated"==s&&(this.onCalculatedValueChanged=function(e,a){p=JSON.stringify(a),y()})};function a(){if(_.isUndefined($("input#table-row-value-headers0")[0]))console.log("headers table is empty");else{var e=$("input#table-row-value-headers0"),a=$("input#table-row-value-headers1");switch($("select#select-option-req_data_type").val()){case"JSON":e[0].value="Content-Type",a[0].value="application/json";break;case"none":e[0].value="",a[0].value=""}var t=new CustomEvent("change");$("input#table-row-value-headers0")[0].dispatchEvent(t),$("input#table-row-value-headers1")[0].dispatchEvent(t)}}var t=!1;datanodesManager.loadDatanodePlugin({type_name:"REST_web-service_from_datasource",display_name:"REST Web-service",icon_type:"web-service-datasource.svg",description:"REST Web-service from dataNode workspace",settings:[{name:"url",display_name:"URL",type:"text",required:!0},{name:"use_xproxy",display_name:"Use xProxy",description:"xProxy allows your browser to call cross-domain REST APIs (which solves browser CORS policy issues). Keep this parameter to true, unless your distant REST API allows your browser to be called in a cross-origin context.",type:"boolean",default_value:!0},{name:"sampleTime",display_name:"Sample time",type:"number",suffix:"seconds",default_value:0},{name:"autoStart",display_name:"AUTO START",description:"Start web-service automatically after dashboard play begins or after creation or modification.",type:"boolean",default_value:!0},{name:"explicitTrig",display_name:"Explicit trigger",description:"Execute web-service only if triggered explicitly : no execution when predecessor dataNodes are modified.",type:"boolean",default_value:!1},{name:"req_data_type",display_name:"Request data-type",type:"option",description:"Choose the web-service request data-type that prefill automatically the first header.",options:[{name:"JSON",value:"JSON"},{name:"none",value:"none"}]},{name:"resp_data_type",display_name:"Response data-type",type:"option",description:"Choose the response data-type expected from the web-service.",options:[{name:"JSON",value:"JSON"},{name:"binary",value:"binary"},{name:"text",value:"text"}]},{name:"method",display_name:"Method",type:"option",options:[{name:"GET",value:"GET"},{name:"POST",value:"POST"},{name:"PUT",value:"PUT"},{name:"DELETE",value:"DELETE"}]},{name:"body",display_name:"Body",type:"calculated",description1:"Insert the body of the request. Normally only used if method is POST. If the method is GET, the content of urlAppend object will be appended to the URL. The content of headersFromDataNodeWS will be injected to headers",description2:"Browse and select a dataNode from workspace to use it in the body."},{name:"headers",display_name:"Headers",type:"array",settings:[{name:"name",display_name:"Name",type:"text"},{name:"value",display_name:"Value",type:"text"}],default_value:[{name:"Content-Type",value:"application/json"}],description:"The first header is 'READ ONLY' and reserved for Request Data-Type."}],newInstance:function(a,r,s,n,o){return r(new e(a,s,n,"calculated",o)),!t},preFillBody:function(){a()}}),xDashConfig.jsonEditorDatanodes&&datanodesManager.loadDatanodePlugin({type_name:"REST_web-service_from_JSON_editor",display_name:"REST Web-service from JSON editor",icon_type:"web-service-json-editor.svg",description:"REST Web-service from JSON editor",settings:[{name:"url",display_name:"URL",type:"text",required:!0},{name:"use_xproxy",display_name:"Use xProxy",description:"If that also fails due to CORS policy, you can use xProxy, which can solve many connection problems to APIs.",type:"boolean",default_value:!0},{name:"sampleTime",display_name:"Sample time",type:"number",suffix:"seconds",default_value:0},{name:"autoStart",display_name:"AUTO START",description:"Start web-service automatically after dashboard play begins or after creation or modification.",type:"boolean",default_value:!0},{name:"req_data_type",display_name:"Request data-type",type:"option",description:"Choose the web-service request data-type that prefill automatically the first header.",options:[{name:"JSON",value:"JSON"},{name:"none",value:"none"}]},{name:"resp_data_type",display_name:"Response data-type",type:"option",description:"Choose the response data-type expected from the web-service.",options:[{name:"JSON",value:"JSON"},{name:"binary",value:"binary"},{name:"text",value:"text"}]},{name:"method",display_name:"Method",type:"option",options:[{name:"GET",value:"GET"},{name:"POST",value:"POST"},{name:"PUT",value:"PUT"},{name:"DELETE",value:"DELETE"}]},{name:"body",display_name:"Body",type:"json",description:'The body of the request. Normally only used if method is POST. If the method is GET, the content of "urlAppend" object it will be appended to the URL.'},{name:"headers",display_name:"Headers",type:"array",settings:[{name:"name",display_name:"Name",type:"text"},{name:"value",display_name:"Value",type:"text"}],default_value:[{name:"Content-Type",value:"application/json"}],description:"The first header is 'READ ONLY' and reserved for Request Data-Type."}],newInstance:function(a,r,s,n,o){return r(new e(a,s,n,"JSON",o)),!t},preFillBody:function(){a()}})}();
!function(){datanodesManager.loadDatanodePlugin({type_name:"Generic_file_reader_plugin",display_name:"Generic text file reader",icon_type:"text-file-reader.svg",description:"Read text files",external_scripts:[""],settings:[{name:"data_path",display_name:"Data file",description:"Browse to select file.",type:"browseText",accept:"text/plain",required:!1}],expose_as_files:[{key:"content",nameSuffix:e=>e?.content?.name??"content.txt",getter:e=>b64EncodeUnicode(e.content.content),setter:(e,t)=>e.content={...e.content,content:b64DecodeUnicode(t)}}],newInstance:function(t,n,a,i){return n(new e(t,a,i)),!0}});var e=function(e,t,n){const a=this;let i=e;function o(e){return e?.content&&!e?.isBinary}a.onSettingsChanged=function(e,t){return!!o(e?.content)&&(i=e,!0)},a.isSettingNameChanged=function(e){return i.name!=e},a.updateNow=function(){return n("OK"),t(i.content),!0},a.onDispose=function(){},this.canSetValue=function(){return{acceptPath:!1,hasPostProcess:!1}},a.setValue=function(e,t){_.isEmpty(t)?(i.content={},i.data_path=""):o(t)&&(i.content={...t},i.data_path=t?.name)},a.isInternetNeeded=function(){return!1}}}();
!function(){datanodesManager.loadDatanodePlugin({type_name:"Generic_binary_file_reader",display_name:"Generic binary file reader",icon_type:"file-reader.svg",description:"Read binary files",external_scripts:[""],settings:[{name:"data_path",display_name:"Data file",description:"Browse to select file.",type:"browseBinary",required:!1}],expose_as_files:[{key:"content",nameSuffix:e=>e?.content?.name??"data",getter:e=>e.content.content,setter:(e,n)=>e.content={...e.content,content:n}}],newInstance:function(n,t,a,i){return t(new e(n,a,i)),!0}});var e=function(e,n,t){const a=this;let i=e;function r(e){return e?.content&&e?.isBinary}a.onSettingsChanged=function(e,n){return!!r(e?.content)&&(i=e,!0)},a.isSettingNameChanged=function(e){return i.name!==e},a.updateNow=function(){return t("OK"),n(i.content),!0},a.onDispose=function(){},this.canSetValue=function(){return{acceptPath:!1,hasPostProcess:!1}},a.setValue=function(e,n){_.isEmpty(n)?(i.content={},i.data_path=""):r(n)&&(i.content={...n},i.data_path=n?.name)},a.isInternetNeeded=function(){return!1}}}();
!function(){datanodesManager.loadDatanodePlugin({type_name:"CSV_file_reader_plugin",display_name:"CSV file reader",icon_type:"csv-reader.svg",description:"Read CSV files",external_scripts:[],settings:[{name:"data_path",display_name:"Data file",description:"Browse to select CSV data file.",type:"browseText",accept:"text/csv",required:!0},{name:"delimiter",display_name:"Delimiter",description:"The delimiting character. Leave auto to auto-detect.",type:"option",options:[{name:"auto",value:""},{name:"comma",value:","},{name:"semi-colon",value:";"},{name:"colon",value:":"},{name:"tabulation",value:"\t"},{name:"space",value:" "}]},{name:"eol",display_name:"Line endings",description:"The newline sequence. Leave auto to auto-detect.",type:"option",options:[{name:"auto",value:""},{name:"\\n",value:"\n"},{name:"\\r",value:"\r"},{name:"\\r\\n",value:"\r\n"}]},{name:"quote_char",display_name:"Quote Char",description:"The character used to quote fields. The quoting of all fields is not mandatory. Any field which is not quoted will correctly read.",type:"option",options:[{name:'"',value:'"'},{name:"'",value:"'"},{name:"empty",value:""}]},{name:"head",display_name:"Header line",description:"If true, the first row after metaData of parsed data will be interpreted as field names.",type:"boolean",default_value:!0},{name:"nb_meta_lines",display_name:"Number of metaData lines",type:"number",default_value:0,description:"If 0 no metaData exist before the header line. Otherwise metaData will be placed inside 'meta' object."},{name:"nb_subheader_lines",display_name:"Number of subheader lines",type:"number",default_value:0,description:"If 0 no subheader exist after the header line. Otherwise subheader will be placed inside 'subheader' object."},{name:"skip_empty_lines",display_name:"Skip empty lines",type:"boolean",default_value:!0},{name:"dynamic_typing",display_name:"Dynamic typing",description:"If true, numeric and boolean data will be converted to their type instead of remaining strings.",type:"boolean",default_value:!0},{name:"pluck",display_name:"Row to array",description:"If true, each row will be placed in an array.",type:"boolean",default_value:!0},{name:"embedding_object",display_name:"Embedd in content object",description:"If true, parsed file will be placed inside a top level 'content' object. It's true when metaData exist.",type:"boolean",default_value:!1}],expose_as_files:[{key:"content",nameSuffix:e=>e?.content?.name??"data.csv",getter:e=>{const n=e.content;return"string"==typeof n?b64EncodeUnicode(n):n.isBinary?n.content:b64EncodeUnicode(n.content)},setter:(e,n)=>{e.content;"string"==typeof e.content?e.content=b64DecodeUnicode(n):e.content={...e.content,content:n,isBinary:!0}}}],newInstance:function(n,t,a,i,r){return t(new e(n,a,i,r)),!0}});var e=function(e,n,t,a){const i=this;let r,o=e;i.onSettingsChanged=function(e,n){const t=i.parseFile(e.content);return!!t&&(o=e,r=t,!0)},i.isSettingNameChanged=function(e){return o.name!==e},i.updateNow=function(){void 0===r&&(r=i.parseFile(o.content)),r?t("OK"):t("Error","Error in file parse"),n(r)},i.onDispose=function(){},i.canSetValue=function(){return{acceptPath:!1,hasPostProcess:!0}},i.setValue=function(e,n){if(n.content){const e=i.parseFile(n.content);e&&(o.content={...n},o.data_path=n?.name,r=e)}},i.isInternetNeeded=function(){return!1},i.parseFile=function(e){let n=null;return"string"==typeof e?n=e:e.content?n=e.isBinary?atob(e.content):e.content:a("error",o.name,"Invalid content"),i.parseContent(n)},i.parseContent=function(e){const n={delimiter:o.delimiter,newline:o.eol,quoteChar:o.quote_char,header:o.head,dynamicTyping:o.dynamic_typing,skipEmptyLines:o.skip_empty_lines},t={},a={};if(_.isUndefined(o.nb_meta_lines)&&(o.nb_meta_lines=0),_.isUndefined(o.nb_subheader_lines)&&(o.nb_subheader_lines=0),o.nb_meta_lines>0){const n=e.split("\n"),a=n.splice(0,o.nb_meta_lines);for(let e=0;e<a.length;e++)t["metaLine"+e]=a[e];e=n.join("\n")}if(o.nb_subheader_lines>0){const n=e.split("\n"),t=n.splice(1,o.nb_subheader_lines);for(let e=0;e<t.length;e++)a["subheaderLine"+e]=t[e],""!==o.delimiter&&(a["subheaderLine"+e]=a["subheaderLine"+e].split(o.delimiter));e=n.join("\n")}const i=Papa.parse(e,n);if(0===i.errors.length){const e=i.data;let n={};if(o.pluck)for(let t=0;t<i.meta.fields.length;t++)colName=i.meta.fields[t],n[colName]=_.map(e,colName);else n=e;return(o.embedding_object||o.nb_meta_lines>0||o.nb_subheader_lines>0)&&(n={content:n},o.embedding_object=!0,o.nb_meta_lines>0&&(n.meta=t),o.nb_subheader_lines>0&&(n.subheader=a)),n}return _.isUndefined(i.errors[0].row)?swal("Parser error : "+i.errors[0].type,i.errors[0].message+" in '"+o.data_path+"'.","error"):swal("Parser error : "+i.errors[0].type,i.errors[0].message+" in line '"+i.errors[0].row+"' of "+o.data_path+"'.","error"),null}}}();
!function(){datanodesManager.loadDatanodePlugin({type_name:"CSV_file_player_plugin",display_name:"CSV file player",icon_type:"csv-player.svg",description:"Play csv files",external_scripts:[],settings:[{name:"data_path",display_name:"Data file",description:"Browse to select CSV data file.",type:"browseText",accept:"text/csv",required:!0},{name:"delimiter",display_name:"Delimiter",description:"The delimiting character. Leave auto to auto-detect.",type:"option",options:[{name:"auto",value:""},{name:"comma",value:","},{name:"semi-colon",value:";"},{name:"colon",value:":"},{name:"tabulation",value:"\t"},{name:"space",value:" "}]},{name:"eol",display_name:"Line endings",description:"The newline sequence. Leave auto to auto-detect.",type:"option",options:[{name:"auto",value:""},{name:"\\n",value:"\n"},{name:"\\r",value:"\r"},{name:"\\r\\n",value:"\r\n"}]},{name:"quote_char",display_name:"Quote Char",description:"The character used to quote fields. The quoting of all fields is not mandatory. Any field which is not quoted will correctly read.",type:"option",options:[{name:'"',value:'"'},{name:"'",value:"'"},{name:"empty",value:""}]},{name:"head",display_name:"Header line",description:"If true, the first row after metaData of parsed data will be interpreted as field names.",type:"boolean",default_value:!0},{name:"nb_meta_lines",display_name:"Number of metaData lines",type:"number",default_value:0,description:"If 0 no metaData exist before the header line. Otherwise metaData will be placed inside 'meta' object."},{name:"nb_subheader_lines",display_name:"Number of subheader lines",type:"number",default_value:0,description:"If 0 no subheader exist after the header line. Otherwise subheader will be placed inside 'subheader' object."},{name:"skip_empty_lines",display_name:"Skip empty lines",type:"boolean",default_value:!0},{name:"dynamic_typing",display_name:"Dynamic typing",description:"If true, numeric and boolean data will be converted to their type instead of remaining strings.",type:"boolean",default_value:!0},{name:"sampleTime",display_name:"Sample time",type:"number",suffix:"seconds",default_value:1},{name:"time_included",display_name:"Time included",description:"If true, the first row will be considered as time vector.",type:"boolean",default_value:!1},{name:"playback",display_name:"Playback",description:"If true, data will be played back.",type:"boolean",default_value:!0}],expose_as_files:[{key:"content",nameSuffix:e=>e?.content?.name??"data.csv",getter:e=>{const n=e.content;return"string"==typeof n?b64EncodeUnicode(n):n.isBinary?n.content:b64EncodeUnicode(n.content)},setter:(e,n)=>{e.content;"string"==typeof e.content?e.content=b64DecodeUnicode(n):e.content={...e.content,content:n,isBinary:!0}}}],newInstance:function(n,t,a,i,r){return t(new e(n,a,i,r)),!0}});var e=function(e,n,t,a){const i=this;let r,s=e,o=0;i.onSettingsChanged=function(e,n){const t=i.parseFile(e.content);return!!t&&(s=e,r=t,o=0,!0)},i.isSettingNameChanged=function(e){return s.name!==e},i.isSettingSampleTimeChanged=function(e){return s.sampleTime!==e},i.updateNow=function(){void 0===r&&(r=i.parseFile(s.content),o=0),r?function(){const e={};for(const n of Object.keys(r.content))e[n]=r.content[n][o];(s.nb_meta_lines>0||s.nb_subheader_lines>0)&&(e={content:e},s.nb_meta_lines>0&&(e.meta={...r.meta}),s.nb_subheader_lines>0&&(e.subheader={...r.subheader})),s.playback&&(o+=1,o>=r.rows&&(o=0)),t("OK"),n(e)}():(t("Error","Error in file parse"),n(null))},i.onDispose=function(){},i.canSetValue=function(){return{acceptPath:!1,hasPostProcess:!0}},i.setValue=function(e,n){if(n.content){const e=i.parseFile(n.content);e&&(s.content={...n},s.data_path=n?.name,r=e,o=0)}},i.isInternetNeeded=function(){return!1},i.parseFile=function(e){let n=null;return"string"==typeof e?n=e:e.content?n=e.isBinary?atob(e.content):e.content:a("error",s.name,"Invalid content"),i.parseContent(n)},i.parseContent=function(e){const n={delimiter:s.delimiter,newline:s.eol,quoteChar:s.quote_char,header:s.head,dynamicTyping:s.dynamic_typing,skipEmptyLines:s.skip_empty_lines},t={},a={};if(_.isUndefined(s.nb_meta_lines)&&(s.nb_meta_lines=0),_.isUndefined(s.nb_subheader_lines)&&(s.nb_subheader_lines=0),s.nb_meta_lines>0){const n=e.split("\n"),a=n.splice(0,s.nb_meta_lines);for(let e=0;e<a.length;e++)t["metaLine"+e]=a[e];e=n.join("\n")}if(s.nb_subheader_lines>0){const n=e.split("\n"),t=n.splice(1,s.nb_subheader_lines);for(let e=0;e<t.length;e++)a["subheaderLine"+e]=t[e],""!==s.delimiter&&(a["subheaderLine"+e]=a["subheaderLine"+e].split(s.delimiter));e=n.join("\n")}const i=Papa.parse(e,n);if(0===i.errors.length){const e=i.data,n=i.meta.fields.length,r={content:{},rows:e.length};for(let t=0;t<n;t++){const n=i.meta.fields[t];r.content[n]=_.map(e,n)}return s.nb_meta_lines>0&&(r.meta=t),s.nb_subheader_lines>0&&(r.subheader=a),r}return _.isUndefined(i.errors[0].row)?swal("Parser error : "+i.errors[0].type,i.errors[0].message+" in '"+s.data_path+"'.","error"):swal("Parser error : "+i.errors[0].type,i.errors[0].message+" in line '"+i.errors[0].row+"' of "+s.data_path+"'.","error"),null}}}();
!function(){datanodesManager.loadDatanodePlugin({type_name:"Unzip_file_plugin",display_name:"Unzip file",icon_type:"file-reader.svg",description:"unzip files",external_scripts:[""],settings:[{name:"data_path",display_name:"Data file",description:"Browse to select zipped file.",type:"browseBinary",accept:"application/x-zip-compressed",required:!1}],expose_as_files:[{key:"content",nameSuffix:n=>n?.content?.name??"data.zip",getter:n=>n.content.content,setter:(n,t)=>n.content={...n.content,content:t}}],newInstance:function(t,e,a,i,o){return e(new n(t,a,i,o)),!0}});var n=function(n,t,e,a){const i=this;let o,r=n;i.onSettingsChanged=function(n,t){return r=n,o=void 0,!0},i.isSettingNameChanged=function(n){return r.name!==n},i.updateAsync=async function(){if(void 0===o)try{await i.parseFile()}catch(n){a("error",r.name,n.message),o=null}e(o?"OK":"Error"),t(o)},i.updateNow=function(){return i.updateAsync(),!0},i.onDispose=function(){},i.canSetValue=function(){return{acceptPath:!1,hasPostProcess:!0}},i.setValue=function(n,t){_.isEmpty(t)?(r.content={},r.data_path="",o=void 0):t?.content&&t?.isBinary&&(r.content={...t},r.data_path=t?.name,o=void 0)},i.isInternetNeeded=function(){return!1},i.parseFile=async function(){if(r.content&&Array.isArray(r.content.content))o=r.content;else{if(!r.content)throw new Error("No data");{const n=r.content;if(!n.content||!n.isBinary)throw new Error("Error in file struct");o=await i.parseContent(n)}}},i.parseContent=async function(n){return await zipToObject(n)}}}();
!function(){var e=function(e,n,a){t=!1;var i=e;this.updateNow=function(){a("Pending");var e=new Date,t={numeric_value:e.getTime(),full_string_value:e.toLocaleString(),date_string_value:e.toLocaleDateString(),time_string_value:e.toLocaleTimeString(),date_object:e};return a("OK"),n(t),!0},this.onDispose=function(){},this.onSettingsChanged=function(e,t){return"OK"===t&&(t,i),i=e,!0},this.isSettingNameChanged=function(e){return i.name!=e},this.isSettingSampleTimeChanged=function(e){return i.sampleTime!=e},this.canSetValue=function(){return!1},this.isInternetNeeded=function(){return!1}},t=!1;datanodesManager.loadDatanodePlugin({type_name:"Clock_web-service",display_name:"Clock",icon_type:"clock.svg",description:"Clock trigger",settings:[{name:"sampleTime",display_name:"Sample time",type:"number",suffix:"seconds",default_value:1},{name:"autoStart",display_name:"AUTO START",description:"Starts datanode automatically after dashboard play begins or after creation or modification.",type:"boolean",default_value:!0}],newInstance:function(n,a,i,o){return a(new e(n,i,o)),!t}})}();
!function(){datanodesManager.loadDatanodePlugin({type_name:"mqtt",display_name:"MQTT",icon_type:"mqtt.svg",description:"MQTT (Message Queuing Telemetry Transport) ISO standard publish-subscribe",external_scripts:["https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.js"],settings:[{name:"topic",display_name:"Topic",type:"text",description:"For IBM quickstart, replace only DEVICEID with the device id string found in the upper right corner. For Watson IoT platform, replace DEVICEID with your specific device mac address or with '+' to listen to all devices in your organization. For all other MQTT servers, enter your own topic search string.",required:!0,default_value:"iot-2/type/+/id/DEVICEID/evt/+/fmt/json"},{name:"server",display_name:"Server",type:"text",description:"For IBM quickstart use 'quickstart.internetofthings.ibmcloud.com', or type '[OrganizationID].messaging.internetofthings.ibmcloud.com' for Watson IoT, or enter any other MQTT server available.",required:!0,default_value:"quickstart.messaging.internetofthings.ibmcloud.com"},{name:"port",display_name:"Port",type:"number",description:"Typically either 8883 or 443 for secure, or 1883 for insecure communication.",required:!0,default_value:8883},{name:"use_encryption",display_name:"Use Encryption",type:"boolean",description:"Use TLS encryption to connect to the MQTT Server securely (datanodesManager.io requires all brokers to use encryption).",default_value:!0},{name:"client_id",display_name:"Client Id",type:"text",default_value:"quickstart",required:!0,description:"For IBM quickstart, use default 'quickstart'. For Watson IoT, enter your Organization ID. For all other MQTT servers, set a clientID which will be passed as 'a:clientID:ApiKey:Timestamp'."},{name:"api_key",display_name:"API Key/Username",description:"Not required for IBM quickstart, required for Watson IoT Platform connections.",type:"text",required:!1,default_value:""},{name:"api_auth_token",display_name:"API Auth Token/Password",description:"Not required for IBM quickstart, required for Watson IoT Platform connections.",type:"text",required:!1,default_value:""},{name:"json_data",display_name:"JSON messages?",type:"boolean",description:"If the messages on your topic are in JSON format they will be parsed so the individual fields can be used in datanodesManager widgets.",default_value:!0}],newInstance:function(n,r,t,o,i){r(new e(n,t,o,i))}});var e=function(e,n,r,t){error=!1;var o=this,i={},a=e;function s(){console.log("Subscribing to topic: "+a.topic),c.subscribe(a.topic)}o.onSettingsChanged=function(e){var o="";try{r("Pending"),c.disconnect()}catch(e){o="Could not disconnect client: "+e,t("error",a.name,o,"JSON file parse error"),r("Error","Could not disconnect client"),n({},"Error")}i={},a=e;var c=new Paho.MQTT.Client(a.server,a.port,"a:"+a.client_id+":"+a.api_key+(new Date).getTime().toString());c.connect({onSuccess:s,userName:a.api_key,password:a.api_auth_token,useSSL:a.use_encryption,timeout:10,cleanSession:!0,onFailure:function(e){o="Connection failed: "+e.errorMessage,t("error",a.name,o,"JSON file parse error"),r("Error","Connection failed"),n({},"Error")}})},o.isSettingNameChanged=function(e){return a.name!=e},o.updateNow=function(){var e="";console.log("Forcing Update"),r("Pending");try{o.disconnect()}catch(o){e="Could not disconnect client: "+o,t("error",a.name,e,"JSON file parse error"),r("Error","Could not disconnect client"),n({},"Error")}var o=new Paho.MQTT.Client(a.server,a.port,"a:"+a.client_id+":"+a.api_key+(new Date).getTime().toString());o.connect({onSuccess:s,userName:a.api_key,password:a.api_auth_token,useSSL:a.use_encryption,timeout:10,cleanSession:!0,onFailure:function(o){e="Connection failed: "+o.errorMessage,t("error",a.name,e,"JSON file parse error"),r("Error","Connection failed"),n({},"Error")}})},o.onDispose=function(){c.isConnected()&&c.disconnect(),c={}},o.canSetValue=function(){return!1},o.isInternetNeeded=function(){return!0},console.log("Creating Paho client at timestamp="+(new Date).getTime().toString());var c=new Paho.MQTT.Client(a.server,a.port,"a:"+a.client_id+":"+a.api_key+(new Date).getTime().toString());c.onConnectionLost=function(e){console.log("Connection Lost"),0!==e.errorCode&&console.log("onConnectionLost: "+e.errorMessage),new Paho.MQTT.Client(a.server,a.port,"a:"+a.client_id+":"+a.api_key+(new Date).getTime().toString()).connect({onSuccess:s,userName:a.api_key,password:a.api_auth_token,useSSL:a.use_encryption,timeout:10,cleanSession:!0,onFailure:function(e){var o="Connection failed: "+e.errorMessage;t("error",a.name,o,"JSON file parse error"),r("Error","Connection failed"),n({},"Error")}})},c.onMessageArrived=function(e){var t=e.destinationName.split("/")[4],o="";o=a.json_data?JSON.parse(e.payloadString):e.payloadString,i[t]=o,r("OK"),n(i)},c.connect({onSuccess:s,userName:a.api_key,password:a.api_auth_token,useSSL:a.use_encryption,timeout:10,cleanSession:!0,onFailure:function(e){var o="Connection failed: "+e.errorMessage;t("error",a.name,o,"JSON file parse error"),r("Error","Connection failed"),n({},"Error")}})}}();
!function(){var e=function(e,n,t,r,a){var o,i=this,s="",c=e,E=!0,l=new Array,y=!0,d="",u=!1,f=!0,A={debug:!0,automaticOpen:!0,reconnectInterval:1e3,maxReconnectInterval:3e4,reconnectDecay:1.5,timeoutInterval:2e3,maxReconnectAttempts:4,binaryType:"arraybuffer"},p=function(){console.info("Connected to server ",s),r("success",c.name,"Connected to server "+s),u=!0,f=!0,_.isUndefined(c.init_value)||(E=!0),a("Ready")},S=function(){console.info("WebSocket Connection is closed..."),r("info",c.name,"WebSocket Connection is closed..."),u&&a("Stop"),u=!1},T=function(e){console.debug("WebSocket  (%s) OnError ",s,e),f&&(r("error",c.name,"WebSocket  ("+s+") error"),f=!1),a("NotReady"),u=!1},R=function(e){d=e.data,y?(y=!1,console.info("WebSocket received ",e.data),l="string"==typeof e.data||e.data instanceof String?e.data:v(e.data,c.decoding_options),t("OK"),n(l),console.info("Data processed ",l)):a("Ready")};function m(){o&&o.close(),console.log(c),s="ws://"+c.host+":"+c.port,(o=new ReconnectingWebSocket(s,[],A)).onopen=p,o.onerror=T,o.onmessage=R,o.onclose=S}function g(e,n=!0){_.isUndefined(o)||1!==o.readyState||(1==n?o.send(JSON.stringify(e)):o.send(e))}function v(e,n){if("JSON"===n.toUpperCase()){try{e=JSON.parse(e)}catch(e){console.log(e)}return e}var t,r,a,o=e.byteLength,i=new DataView(e),s=0,c=0;switch(n.toUpperCase()){case"ARRAYBUFFER2STRING":r=String.fromCharCode.apply(null,new Uint8Array(e));break;case"INT8ARRAY":for(a=Int8Array.BYTES_PER_ELEMENT,t=o/Int8Array.BYTES_PER_ELEMENT,t=Math.floor(t),r=new Array(t),s=0,c=0;s<t;s++,c+=a)r[s]=i.getInt8(c);break;case"UINT8ARRAY":for(a=Uint8Array.BYTES_PER_ELEMENT,t=o/Uint8Array.BYTES_PER_ELEMENT,t=Math.floor(t),r=new Array(t),s=0,c=0;s<t;s++,c+=a)r[s]=i.getUint8(c);break;case"INT16ARRAY":for(a=Int16Array.BYTES_PER_ELEMENT,t=o/Int16Array.BYTES_PER_ELEMENT,t=Math.floor(t),r=new Array(t),s=0,c=0;s<t;s++,c+=a)r[s]=i.getInt16(c,!0);break;case"UINT16ARRAY":for(a=Uint16Array.BYTES_PER_ELEMENT,t=o/Uint16Array.BYTES_PER_ELEMENT,t=Math.floor(t),r=new Array(t),s=0,c=0;s<t;s++,c+=a)r[s]=i.getUint16(c,!0);break;case"INT32ARRAY":for(a=Int32Array.BYTES_PER_ELEMENT,t=o/Int32Array.BYTES_PER_ELEMENT,t=Math.floor(t),r=new Array(t),s=0,c=0;s<t;s++,c+=a)r[s]=i.getInt32(c,!0);break;case"UINT32ARRAY":for(a=Uint32Array.BYTES_PER_ELEMENT,t=o/Uint32Array.BYTES_PER_ELEMENT,t=Math.floor(t),r=new Array(t),s=0,c=0;s<t;s++,c+=a)r[s]=i.getUint32(c,!0);break;case"FLOAT32ARRAY":for(a=Float32Array.BYTES_PER_ELEMENT,t=o/Float32Array.BYTES_PER_ELEMENT,t=Math.floor(t),r=new Array(t),s=0,c=0;s<t;s++,c+=a)r[s]=i.getFloat32(c,!0);break;case"FLOAT64ARRAY":for(a=Float64Array.BYTES_PER_ELEMENT,t=o/Float64Array.BYTES_PER_ELEMENT,t=Math.floor(t),r=new Array(t),s=0,c=0;s<t;s++,c+=a)r[s]=i.getFloat64(c,!0);break;default:for(a=Uint8Array.BYTES_PER_ELEMENT,t=o/Uint8Array.BYTES_PER_ELEMENT,t=Math.floor(t),r=new Array(t),s=0,c=0;s<t;s++,c+=a)r[s]=i.getUint8(c)}return r}i.onSettingsChanged=function(e,n){return"OK"===n&&(n,c),c.host!=e.host||c.port!=e.port||!u||!_.isUndefined(e.init_value)&&c.init_value!=e.init_value?(c=e,y=!0,a("Wait"),m()):c=e,c,!0},i.isSettingNameChanged=function(e){return c.name!=e},i.updateNow=function(){var e;if(y){if(1===o.readyState&&(t("Pending"),!_.isUndefined(c.init_value)&&E&&(E=!1,"none"!=c.init_value)))if(function(e){try{JSON.parse(e)}catch(e){return!1}return!0}(c.init_value)){try{e=jQuery.extend(!0,{},JSON.parse(c.init_value))}catch(e){return r("error",c.name,"JSON Parse error"+e.message),t("Error","JSON Parse error"),n(void 0,"Error"),!1}g(e,!0)}else g(e=c.init_value,!1)}else t("Pending"),console.info("WebSocket received ",d),l="string"==typeof d||d instanceof String?d:v(d,c.decoding_options),t("OK"),n(l),console.info("Data processed ",l);return!0},i.onDispose=function(){o&&o.close()},i.onstop=function(){o&&o.close()},i.canSetValue=function(){return!1},a("Wait"),y=!0,m()};datanodesManager.loadDatanodePlugin({type_name:"WS-receive-plugin",display_name:"WebSocket Receive",icon_type:"websocket.svg",description:"Websocket client to receive data in Chalk'it",external_scripts:[""],settings:[{name:"host",display_name:"Remote IP address",type:"text",description:"IP address or hostname of your remote WebSocket sender.",required:!0},{name:"port",display_name:"Remote IP port",type:"number",description:"The port to connect to your remote WebSocket sender.",required:!0},{name:"autoStart",display_name:"AUTO START",description:"Start websocket receive automatically after dashboard play begins or after creation or modification.",type:"boolean",default_value:!0},{name:"init_value",display_name:"initializing token",type:"option",description:"This token is sent before the exchange begin. Normally only used if send to xMOD",options:[{name:"None",value:"none"},{name:"xMOD",value:"ws_init"}]},{name:"decoding_options",display_name:"Decoding options",description:"Decoding options applied on Response data.",type:"option",options:[{name:"JSON",value:"JSON"},{name:"Int8Array",value:"Int8Array"},{name:"Uint8Array",value:"Uint8Array"},{name:"Int16Array",value:"Int16Array"},{name:"Uint16Array",value:"Uint16Array"},{name:"Int32Array",value:"Int32Array"},{name:"Uint32Array",value:"Uint32Array"},{name:"Float32Array",value:"Float32Array"},{name:"Float64Array",value:"Float64Array"},{name:"Text",value:"Text"},{name:"ArrayBuffer2String",value:"ArrayBuffer2String"}]}],newInstance:function(n,t,r,a,o,i){return t(new e(n,r,a,o,i)),!0}})}();
!function(){var e=function(e,t,i,o,r){var a,s=this,c="",d=e,l=!0,u={},p=!1,m=!0,f={debug:!0,automaticOpen:!0,reconnectInterval:1e3,maxReconnectInterval:3e4,reconnectDecay:1.5,timeoutInterval:2e3,maxReconnectAttempts:4,binaryType:"arraybuffer"},y=function(){console.info("Connected to server ",c),o("success",d.name,"Connected to server "+c),m=!0,p=!0,_.isUndefined(d.init_value)||(l=!0),r("Ready")},g=function(){console.info("WebSocket Connection is closed..."),o("info",d.name,"WebSocket Connection is closed..."),p&&r("Stop"),p=!1},b=function(e){console.debug("WebSocket  (%s) OnError ",c,e),m&&(o("error",d.name,"WebSocket  ("+c+") error"),m=!1),r("NotReady")},v=function(e){};function S(){a&&a.close(),console.log(d),c="ws://"+d.host+":"+d.port,(a=new ReconnectingWebSocket(c,[],f)).onopen=y,a.onerror=b,a.onmessage=v,a.onclose=g}function h(e,n=!0){_.isUndefined(a)||1!==a.readyState||a.send(e)}s.onSettingsChanged=function(e,n){return"OK"===n&&(n,d),d.host!=e.host||d.port!=e.port||!p||!_.isUndefined(e.init_value)&&d.init_value!=e.init_value?(d=e,r("Wait"),S()):d=e,d,!0},s.isSettingNameChanged=function(e){return d.name!=e},s.isSettingSampleTimeChanged=function(e){return d.sampleTime!=e},s.updateNow=function(e){var r;if(e&&d.sampleTime>0&&d.explicitTrig&&(o("warning",d.name,'Explicit Trigger option is turned off (False) because "'+d.name+'" is periodic and was triggered explicitly'),d.explicitTrig=!1),1===a.readyState){if(i("Pending"),!_.isUndefined(d.init_value)&&l&&(l=!1,"none"!=d.init_value))if(function(e){try{JSON.parse(e)}catch(e){return!1}return!0}(d.init_value)){try{r=jQuery.extend(!0,{},JSON.parse(d.init_value))}catch(e){return o("error",d.name,"Data Parse error"+e.message),i("Error","Data Parse error"),t(void 0,"Error"),!1}h(r,!0)}else h(r=d.init_value,!1);if(_.isNull(u)||_.isUndefined(u))return i("Error","script is null or undefined"),o("error",d.name,"script is null or undefined."),!1;if(_.isObject(u)&&_.isEmpty(u)&&_.isEmpty(d.json_input))return i("Error","JS script error"),n=!0,o("error",d.name,"JS script error: script cannot be empty."),!1;h(u),i("OK"),t(u)}return!0},s.onDispose=function(){a&&a.close()},s.onstop=function(){a&&a.close()},this.canSetValue=function(){return!1},s.isInternetNeeded=function(){return!0},s.onCalculatedValueChanged=function(e,n){u=JSON.stringify(n)},r("Wait"),S()},n=!1;datanodesManager.loadDatanodePlugin({type_name:"WS-send-plugin",display_name:"WebSocket Send",icon_type:"websocket.svg",description:"Websocket client to send data to Chalk'it",external_scripts:[""],settings:[{name:"host",display_name:"Remote IP address",type:"text",description:"IP address or hostname of your remote WebSocket receiver.",required:!0},{name:"port",display_name:"Remote IP port",type:"number",description:"The port to connect to your remote WebSocket receiver.",required:!0},{name:"sampleTime",display_name:"Sample time",type:"number",default_value:0,suffix:"seconds",description:"Refresh rate for sending data. Data will be sent even if control values are not changed"},{name:"autoStart",display_name:"AUTO START",description:"Start websocket send automatically after dashboard play begins or after creation or modification.",type:"boolean",default_value:!0},{name:"explicitTrig",display_name:"Explicit trigger",description:"Execute web-socket only if triggered explicitly : no execution when predecessor dataNodes are modified.",type:"boolean",default_value:!1},{name:"init_value",display_name:"initializing token",type:"option",description:"This token is sent before the exchange begin. Normally only used if exchange with xMOD",options:[{name:"None",value:"none"},{name:"xMOD",value:"ws_init"}]},{name:"json_input",display_name:"JSON/Javascript input",type:"calculated",description1:"Can be literal JSON. Input to be sent.",description2:"Browse and select a dataNode from workspace to send it by web socket."}],newInstance:function(t,i,o,r,a,s){return i(new e(t,o,r,a,s)),!n}})}();
"true"!=xDashConfig.xDashBasicVersion&&function(){var o=function(o,n,t,r,a){error=!1;var i=this;i.errorState=!1;var s,c,l,u=o,d=o,g="None",p={lat:0,lng:0};function f(o){p={lat:o.coords.latitude,lng:o.coords.longitude},console.log(p),a("Ready")}function m(o){var e;1==o.code?(console.log("Error: Access is denied !"),e="Error: Access is denied !",r("error",u.name,e),a("NotReady")):2==o.code?(console.log("Error: Position is unavailable !"),e="Error: Position is unavailable !",r("error",u.name,e),a("NotReady")):3==o.code&&(console.log("Error: Timeout expired !"),e="Error: Timeout expired !",r("error",u.name,e),a("NotReady"))}i.onSettingsChanged=function(o,e){return"OK"===e&&(g=e,d=u),u=o,!0},i.isSettingNameChanged=function(o){return u.name!=o},i.getSavedSettings=function(){return[g,d]},i.updateNow=function(){t("Pending"),"watchPosition"==l&&(t("OK"),n(p))},i.onDispose=function(){"watchPosition"==l&&c.clearWatch(s)},i.canSetValue=function(){return!1},function(){if(c=navigator.geolocation){a("Wait");s=c.watchPosition(f,m,{maximumAge:0,timeout:5e3,enableHighAccuracy:!0}),l="watchPosition"}else console.log("Sorry, browser does not support geolocation"),swal("Browser support","Sorry, browser does not support geolocation","error"),e=!0}()},e=!1;datanodesManager.loadDatanodePlugin({type_name:"Geolocation-plugin",display_name:"Geolocation",icon_type:"geolocation.svg",description:"A geolocation plugin",external_scripts:[""],settings:[{name:"autoStart",display_name:"Auto start",description:"Start Geolocation automatically after dashboard play begins or after creation or modification.",type:"boolean",default_value:!0}],newInstance:function(n,t,r,a,i,s){return t(new o(n,r,a,i,s)),!e}})}();
class PythonPluginExecBase{static ABORT_ERROR="ABORT";static DISCONNECTED_ERROR="DISCONNECTED";static SIGNATURE_ERROR="SIGNATURE INVALID";static isEmbedded(){const e=angular.element(document.body).injector();return!e?.has("$rootScope")||e.invoke(["$rootScope",e=>!e.UserProfile])}static applySideEffects(e){if(e?.length)for(const{name:t,args:s}of e){const e=[];try{switch(t){case"scheduler.setVariables":chalkit.scheduler.setVariables(Object.keys(s[0]),Object.values(s[0]));break;case"scheduler.setVariableProperty":case"scheduler.executeDataNodes":const a=t.replace("scheduler.","");chalkit.scheduler[a](...s);break;case"dashboard.viewPage":case"dashboard.viewProject":case"dashboard.goToPage":case"dashboard.enableWidget":case"dashboard.disableWidget":case"dashboard.showWidget":case"dashboard.hideWidget":const r=t.replace("dashboard.","");chalkit.dashboard[r](...s);break;default:e.push(t)}}finally{if(e.length)throw new Error(`Invalid side effects: ${e.join(", ")}`)}}}constructor(){}getXHR(){return null}needSignature(){return!1}async signCode(e){}async execute(e,t,s=!1,a=void 0){}dispose(){}}class PythonPluginLocalExec extends PythonPluginExecBase{static PSEUDO_IMAGE_NAME="Pyodide";static PSEUDO_IMAGE_ID="__PYODIDE__";static isSupported(){return!!xDashConfig.pyodide?.pyodide_index}static shift(e){return e.split(/\r?\n/).map((e=>"  "+e)).join("\n")+"\n"}static writePython(e,t){return`\nfrom chalkit_python_api.outputs import capture \n\n@capture(is_debug=${t?"True":"False"}, script_name='<exec>', start_line=5)\ndef script(dataNodes, chalkit):\n${PythonPluginLocalExec.shift(e)}\n\nscript(dataNodes)\n`}async execute(e,t,s=!1,a=void 0){const r=PythonPluginLocalExec.writePython(e,s);return await pyodideManager.runPythonAsync(r,{dataNodes:t})}}class PythonPluginRemoteExec extends PythonPluginExecBase{static DEFAULT_IMAGE_NAME="Default";static DEFAULT_IMAGE_ID="";static isSupported(){return!_.isUndefined(urlPython)}static async getImages(){return(await angular.element(document.body).injector().invoke(["PythonImagesManager","$rootScope",(e,t)=>(t.UserProfile||(t.UserProfile={}),t.UserProfile.userId||(t.UserProfile.userId=prompt("Please fill your User ID")),e.getImages())])).map((e=>({id:e.Id,name:e.Name,hash:e.Hash})))}static createId(e=!0){const t=new Uint32Array(8);window.crypto.getRandomValues(t);let s="";for(let a=0;a<t.length;a++)s+=(a<2||a>5?"":"-")+t[a].toString(e?16:36).slice(-4);return s}constructor(e,t=void 0){super(),this.imageId=e,this.clientId=t??PythonPluginRemoteExec.createId(),this.started=!1,this.jqXHR=null}getXHR(){return this.jqXHR}async execute(e,t,s=!1,a=void 0){return a||(a=await this.signCode(e)),this.abort(),new Promise(((r,n)=>this.#e(r,n,e,t,s,a)))}#e(e,t,s,a,r,n){const i=urlPython+"eval",o={callerId:this.clientId,image:this.imageId,script:s,dataNodes:JSON.stringify(a),isDebug:r,signature:n};let c,d=!1;this.jqXHR=$.ajax({url:i,dataType:"text",type:"POST",beforeSend:function(e){e.setRequestHeader("X-Request-ID",PythonPluginRemoteExec.createId())},data:JSON.stringify(o),responseType:"json",contentType:"application/json",success:(t,s,a)=>{const r=JSON.parseMore(t);e(r)},error:(e,s,a)=>{if(d)t(PythonPluginExecBase.DISCONNECTED_ERROR);else if(403===e.status)t(PythonPluginExecBase.SIGNATURE_ERROR);else if("abort"===s)t(PythonPluginExecBase.ABORT_ERROR);else{const s="Response status "+e.status+" :"+e.statusText;let a=s;const r=e.responseJSON;_.isUndefined(r)||_.isUndefined(r.errorMessage)||(a=a+".  "+r.errorMessage);const n=new Error(s);n.notifText=a,t(n)}},complete:(e,t)=>{this.jqXHR=void 0,clearInterval(c)}}),c=setInterval((()=>{navigator.onLine||(d=!0,this.abort())}),1e3)}needSignature(){return!0}async signCode(e){return await angular.element(document.body).injector().invoke(["$http","$q",async(t,s)=>{this.abort();const a=s.defer();this.jqXHR={abort:()=>a.resolve()};const r=urlPython+"images/sign",n=await t.post(r,JSON.stringify({image:this.imageId,code:e}),{contentType:"application/json; charset=utf-8",headers:{...getAuthorizationHeaders(),"X-Request-ID":PythonPluginRemoteExec.createId()},timeout:a.promise});return this.jqXHR=void 0,n.data}])}abort(){this.jqXHR&&(this.jqXHR.abort(),this.jqXHR=null)}dispose(){if(this.abort(),this.started){const e=urlPython+"end";jqXHR=$.ajax({url:e,type:"POST",headers:{"X-Request-ID":PythonPluginRemoteExec.createId()},data:JSON.stringify({callerId:this.clientId}),contentType:"application/json",error:(e,t,s)=>{this.jqXHR=void 0;const a="Error stopping the interpreter. Status: "+t+", Error:"+s;notificationCallback("error",currentSettings.name,a)}})}}}
(PythonPluginRemoteExec.isSupported()||PythonPluginLocalExec.isSupported())&&function(){var e=!1;const t=PythonPluginExecBase.isEmbedded();function n(e,t=void 0){return e===PythonPluginLocalExec.PSEUDO_IMAGE_ID?new PythonPluginLocalExec:new PythonPluginRemoteExec(e,t)}const o={name:PythonPluginRemoteExec.DEFAULT_IMAGE_NAME,id:PythonPluginRemoteExec.DEFAULT_IMAGE_ID};function a(e,t,n=!1){const o=document.createElement("div");o.style["margin-bottom"]="1rem",n&&(o.style.color="red");const a=document.createElement("h2");a.innerText=e,o.appendChild(a);const i=document.createElement("div");i.style["overflow-x"]="auto";const r=document.createElement("code");return r.innerText=t,r.style["white-space"]="pre",i.appendChild(r),o.appendChild(i),o}function i(e,t,n=!1){const o=document.createElement("div");o.style["margin-bottom"]="1rem";const a=document.createElement("h2");if(n){const t=document.createElement("em");t.innerText=e,a.appendChild(t)}else a.innerText=e;o.appendChild(a);const i=document.createElement("div"),r=jsonDataToBasicHtmlElement(t);return r instanceof HTMLIFrameElement&&(i.style.height="30vh"),i.appendChild(r),o.appendChild(i),o}function r(e,t=!1){return Array.isArray(e)?e.map(((e,n)=>i(`${t?"Debug":"Output"} [${n}]`,e,t))):Object.entries(e).map((([e,n])=>i(`${t?"Debug":"Output"} [${e}]`,n,t)))}function s(e,t){if(t instanceof Error)e.appendChild(a("Error",t.stack??String(t),!0));else{if(t.error&&e.appendChild(a("Error",t.error,!0)),t.stderr&&e.appendChild(a("Stderr",t.stderr,!0)),t.stdout&&e.appendChild(a("Stdout",t.stdout)),t.debug&&t.debug.length&&r(t.debug,!0).forEach((t=>e.appendChild(t))),t?.sideEffects.length){const n=t.sideEffects.map((e=>`${e.name}( ${e.args.map(JSON.stringify).join(", ")} );`)).join("\n");e.appendChild(a("Side Effects",n))}t.result&&(!function(e){const t=Array.isArray(e);if(t||"object"==typeof e){const n=t?e:Object.values(e);for(const e of n)if(e&&e.content&&e.type&&"string"==typeof e.content&&"string"==typeof e.type)return!0}return!1}(t.result)?e.appendChild(i("Output",t.result)):r(t.result).forEach((t=>e.appendChild(t))))}return e}function c(e,t,o,a){const i=t.settings.name;e||(e='#example: create 2 datanodes py_a a,d py_b then use them as follow:\n# Example: add the values of 2 datanodes.\n# return dataNodes["py_a"] + dataNodes["py_b"];\n');const r=$('<div class="cancel__box__top cancel__box__body" style="display:flex; flex-direction:row;"></div>'),c=$('<div style="display:flex; flex-direction:column; flex: 2; flex-shrink: 0;"></div>');r.append([c]);const d=document.createElement("div");d.classList.add("code-window","cancel__box","cancel__box--xl"),d.appendChild(r[0]);const l=$('<div class="code-mirror-wrapper" id="codeWrapper"></div>').get(0),u=$('<div class="cancel__box__bottom"></div>'),p=$('<div class="cancel__box__body"></div>'),m=$('<div class="code-window-header cm-s-ambiance">\n            This Python will be re-evaluated any time a referenced dataNode is updated, and the value you <code><span class="cm-keyword">return</span></code>\n            (which will be serialized to JSON) will be made available for widgets and other dataNodes. You can assume this script is wrapped in a function with \n            a dictionary-like <code><span class="cm-def">dataNodes</span></code> parameter.<br>\n            Press <code><span class="cm-keyword">ctrl-space</span></code> to activate autocompletion; <code><span class="cm-keyword">ctrl-enter</span></code> to test the script.\n        </div>');c.append([m,p,u]),p.append(l);const h=$('<div id="codeWindowContainer" class="cancel__container open"></div>')[0];h.appendChild($('<div class="cancel__overlay"></div>')[0]),h.appendChild(d),document.body.appendChild(h);let g=null,f=null,y=null,E=null,v=null,x=null;const w=n(t.settings.dockerImage.id);function P(e,t){t.pick(),e.execCommand("autocomplete")}function _(){[...g.childNodes].filter((e=>e!==f)).forEach((e=>e.remove())),x=null}function C(){y&&(E||!v?(_(),s(g,y)):function(){if(x)b(!1);else{_();const e=v,t=document.createElement("div");t.className="code-widget-window-preview",t.style.display="flex",t.style["background-color"]="white",t.style["justify-content"]="center",t.style.border="1px dashed rgba(0, 0, 0, 0.5)";const n=document.createElement("div");n.id="widget-preview-zone-"+e,t.appendChild(n),g.appendChild(t);const o=Math.min($("#"+e).height(),$(g).height()-40-$(f).height()),a=Math.min($("#"+e).width(),$(g).width()-100);$(n).width(a),$(n).height(o);const i=e.substring(0,e.length-1);x=widgetsPluginsHandler.copyWidget(n.id,i,null,e,!0),b(!0)}}())}function b(e){const t=widgetConnector.widgetsConnection[v];for(const n in t.sliders){const o=t.sliders[n];if("None"===o.dataNode)continue;const a=x.getByName(o.name),r=o.dataNode===i;if(a&&a.setValue&&(r||e)){const e=r?y.result:datanodesManager.getDataNodeByName(o.dataNode).latestData();let t=e,n=o.dataNode;for(let e=0;e<o.dataFields.length;e++){n=o.dataFields[e],t=t[n]}void 0!==e&&(a.setValue(t),a.setCaption&&a.setCaption(n,!1))}}}async function S(e){g||function(){g=document.createElement("div"),g.id="python-in-editor-results",g.style.display="flex",g.style.flex=1,g.style.width=0,g.style["flex-direction"]="column",g.style["overflow-y"]="auto",g.style["margin-left"]="1rem";const[,e]=datanodesManager.isConnectedWithWidgt(i);if(e?.length){function t(e){const t=document.createElement("div");t.style.display="inline-block",t.style.padding="0rem 1rem 0rem 0rem";const n=document.createElement("input");n.type="radio",n.checked=null===e,n.id=`result-radio-select-${e??""}`,n.name="result-radio-select";const o=document.createElement("label");return o.for=n.id,o.innerText=" "+(e??"None"),t.appendChild(n),t.appendChild(o),t}const n=document.createElement("div");n.style["margin-bottom"]="1rem",n.classList.add("code-window-header","cm-s-ambiance"),n.appendChild(document.createTextNode("Connected widget(s) : "));const o=t(null);o.addEventListener("change",(()=>{v=null,x=null,C()})),n.appendChild(o),n.appendChild(document.createElement("br")),e.forEach((e=>{const o=t(e);n.appendChild(o),o.addEventListener("change",(()=>{v=e,x=null,C()}))})),g.appendChild(n),f=n}r.append(g)}(),v||_();let t={};for(const e of datanodesManager.getAllDataNodes())t[e.name()]=e.latestData();try{const n=await w.execute(e,t,!0);y=n,E=!1}catch(e){console.error(e),y=e,E=!0}C()}const T=datanodesManager.getAllDataNodes().sort(((e,t)=>e.name().localeCompare(t.name()))),N=CodeMirror(l,{value:e,mode:{name:"python",globalVars:!0},theme:"eclipse",version:3,indentUnit:2,lineNumbers:!0,matchBrackets:!0,autoCloseBrackets:!0,lineWrapping:!1,showCursorWhenSelecting:!0,extraKeys:{"Ctrl-Space":"autocomplete","Ctrl-Enter":e=>S(e.getValue()),"Alt-C":e=>e.toggleComment()},hintOptions:{hint:JSEditorCompletion.createCompletionFct(T),completeSingle:!1,extraKeys:{Tab:P,Right:P,Left:function(e,t){const n=e.getCursor(),o=n.line,a=e.getLine(o),i=n.ch,r=JSEditorCompletion.getPrecedingPathLength(a,i);r&&(e.replaceRange("",CodeMirror.Pos(o,i-r),CodeMirror.Pos(o,i)),t.close(),e.execCommand("autocomplete"))}}}}),D=document.createElement("button");D.innerText="Evaluate",D.title="Test script (ctrl+enter)",D.classList.add("btn","btn-rounded-fill","cancel"),D.addEventListener("click",(()=>{S(N.getValue())}));const A=document.createElement("button");A.innerText="Close",A.title="Close the editor",A.classList.add("btn","btn-rounded-fill","primary"),A.addEventListener("click",(()=>{if(h.remove(),w.dispose(),a){const e=N.getValue();a(e)}})),u.append(A),u.append(D)}datanodesManager.loadDatanodePlugin({type_name:"Python_plugin",display_name:"Python",icon_type:"python.svg",description:"Python script plugin",external_scripts:[],settings:[{name:"autoStart",display_name:"AUTO START",description:"Start Python automatically after dashboard play begins or after creation or modification.",type:"boolean",default_value:!0},{name:"explicitTrig",display_name:"Explicit trigger",description:"Execute Python only if triggered explicitly : no execution when predecessor dataNodes are modified.",type:"boolean",default_value:!1},{name:"dockerImage",display_name:"Python backend / image",type:"custom1",default_value:o,description:"Select execution backend for Python script. Default is local execution for pip installed Chalk'it. Pyodide is executed in the browser.",implementation:async function(e,t,n,a){const i="select-option"+t.name;$('<select disabled="true" id="'+i+'"></select>').appendTo($('<div class="styled-select"></div>').appendTo(e));const r=[];PythonPluginLocalExec.isSupported()&&r.push({name:PythonPluginLocalExec.PSEUDO_IMAGE_NAME,id:PythonPluginLocalExec.PSEUDO_IMAGE_ID}),PythonPluginRemoteExec.isSupported()&&r.push({name:PythonPluginRemoteExec.DEFAULT_IMAGE_NAME,id:PythonPluginRemoteExec.DEFAULT_IMAGE_ID});const s=[...r],c=t.name in n&&n[t.name]?n[t.name]:null;c&&c.id!==PythonPluginLocalExec.PSEUDO_IMAGE_ID&&c.id!==PythonPluginRemoteExec.DEFAULT_IMAGE_ID&&s.push({name:c.name,id:c.id});const d=$("#"+i);if(s.forEach((e=>$("<option></option>").text(e.name).attr("value",e.id).appendTo(d))),d.val(c?.id??o.id),!urlPython)return;const l=await PythonPluginRemoteExec.getImages();let u=[];_.each(l,(function(e){u.push({name:e.name,id:e.id})})),u.sort((function(e,t){return e.name.localeCompare(t.name)}));const p=[...r,...u];if(d.empty(),_.each(p,(function(e){$("<option></option>").text(e.name).attr("value",e.id).appendTo(d)})),d.change((function(){const e=$(this).val(),n=p.find((function(t){return t.id===e}));a.settings[t.name]=n})),d.prop("disabled",!1),p.find((e=>e.id===c.id)))d.val(c.id);else{let e=p.find((e=>e.name===c.name));e?swal("Docker image","The selected docker images does not exist anymore but one with the same name was found.","warning"):(e=o,swal("Docker image","The selected docker images does not exist anymore. It was replaced by the default one.","warning")),d.val(e.id),a.settings[t.name]=e}}},{name:"content",display_name:"Python script",type:"custom2",implementation:function(e,t,n,o){var a=$('<textarea autocorrect="off" autocomplete="off" spellcheck="false" class="calculated-value-input" style="display:none; width:78%"></textarea>');a.change((function(){o.settings[t.name]=$(this).val()})),a.val(""),t.name in n&&a.val(n[t.name]);var i=$('<div class="codemirror-wrapper__top"></div>'),r=$('<div class="calculated-setting-row codemirror-wrapper"></div>');r.append(i);var s=function(e,t,n){t||(t='#example: create 2 datanodes py_a a,d py_b then use them as follow:\n# Example: add the values of 2 datanodes.\n# return dataNodes["py_a"] + dataNodes["py_b"];\n');const o=$('<div class="codemirror-wrapper__content"></div>').get(0);function a(e,t){t.pick(),e.execCommand("autocomplete")}e.append(o);const i=datanodesManager.getAllDataNodes().sort(((e,t)=>e.name().localeCompare(t.name()))),r=CodeMirror(o,{value:t,mode:{name:"python",globalVars:!0},theme:"eclipse",version:3,indentUnit:2,lineNumbers:!0,matchBrackets:!0,autoCloseBrackets:!0,lineWrapping:!1,showCursorWhenSelecting:!0,extraKeys:{"Ctrl-Space":"autocomplete","Alt-C":e=>e.toggleComment()},hintOptions:{hint:JSEditorCompletion.createCompletionFct(i),completeSingle:!1,extraKeys:{Tab:a,Right:a,Left:function(e,t){const n=e.getCursor(),o=n.line,a=e.getLine(o),i=n.ch,r=JSEditorCompletion.getPrecedingPathLength(a,i);r&&(e.replaceRange("",CodeMirror.Pos(o,i-r),CodeMirror.Pos(o,i)),t.close(),e.execCommand("autocomplete"))}}}});r.doc.cm.on("change",(function(){var e=r.getValue();n(e)}));var s=r.getValue();return setTimeout((function(){r.refresh()}),1),n(s),r}(r,a.val(),(function(e){a.val(e),a.change()}));r.append(a),t.name in n&&a.val(n[t.name]);var d=$('<a>Full Screen view<i class="basic icn-full-screen""></i></a>').mousedown((function(e){e.preventDefault(),c(a.val(),o,0,(function(e){s.setValue(e),a.val(e),a.change()}))}));i.append(d),$(e).append(r)},description:"Python script to evaluate."}],expose_as_files:[{key:"content",nameSuffix:"script.py"}],newInstance:function(t,n,o,a,i){if(!n(new d(t,o,a,i)))return!e}});var d=function(o,a,i,r){const s=this;let c=o,d=o,l="None";const u=PythonPluginRemoteExec.createId();let p,m=null;s.onSettingsChanged=function(t,n){"OK"===n&&(l=n,d=c);const o=t.dockerImage?.id!==c.dockerImage?.id;return o&&m&&(m.dispose(),m=null),(o||c.content!==t.content||t.dockerImage?.id!==PythonPluginLocalExec.PSEUDO_IMAGE_ID&&!t.signature||!p)&&(t.signature=void 0,p=void 0),c=t,p=s.runScriptSettings(),!e&&(d=c,!0)},s.isSettingNameChanged=function(e){return c.name!=e},s.updateNow=function(e,t){if(!e&&!1===c.autoStart)return{notTobeExecuted:!0};i("Pending");let n={};for(const e of t)n[e]=datanodesManager.getDataNodeByName(e).latestData();return p||(p=s.runScriptSettings()),s.runScript(n,p),!0},s.runScriptSettings=async function(){e=!1;const o=c.content;if(_.isNull(o)||_.isUndefined(o)||""==o){e=!0;const t="No python script was provided.";throw swal("Script error",t,"error"),new Error(t)}const a=c.dockerImage.id;if(a!==PythonPluginLocalExec.PSEUDO_IMAGE_ID&&a!==PythonPluginRemoteExec.DEFAULT_IMAGE_ID&&!t){const t=(await PythonPluginRemoteExec.getImages()).find((function(e){return e.id===a}));if(!t){e=!0;const t="The selected docker images does not exist anymore.";throw swal("Docker error",t,"error"),new Error(t)}if(!t.hash){e=!0;const t="The selected docker images has not been built.";throw swal("Docker error",t,"error"),new Error(t)}}m??=n(a,u);let i=c.signature;if(m.needSignature())if(t){if(!c.signature){e=!0;const t="Script was not signed before exporting the dashboard.";throw swal("Script error",t,"error"),new Error(t)}}else if(!i){try{c.signature=await m.signCode(o)}catch(e){throw e.status&&e.statusText&&s.errorAllTheThings(`Response status ${e.status} : ${e.statusText}`),e.message?s.errorAllTheThings(e.message):s.errorAllTheThings(String(e),"Could not sign script"),e}i=c.signature}return{script:o,signature:i,executor:m}},s.errorAllTheThings=function(e,t=null,n="error",o="Error"){r(n,c.name,e),i(o,t||e),a(void 0,o),s.error=!0,s.pastStatus="Error"},s.runScript=async function(e,t){function n(e,t=void 0){t??=e,s.errorAllTheThings(t,e)}datanodesManager.setCurrentDataNode(c.name);try{const{executor:d,script:l,signature:u}=await t,p=await d.execute(l,e,!1,u);p.error&&p.error.length?n(p.error):(PythonPluginExecBase.applySideEffects(p.sideEffects),o=p.result,r("success",c.name,""),i("OK"),a(o),s.error=!1,s.pastStatus="OK",s.pastSettings=c)}catch(e){if(e===PythonPluginExecBase.ABORT_ERROR){const e="Response status : aborted";s.errorAllTheThings(e,e,"info","None")}else e===PythonPluginExecBase.DISCONNECTED_ERROR?(datanodesManager.getDataNodeByName(c.name).completeExecution("NOP"),datanodesManager.getDataNodeByName(c.name).schedulerStatus("Stop"),r("error",c.name,"Internet is disconnected. Request of '"+c.name+"' wil be aborted")):e===PythonPluginExecBase.SIGNATURE_ERROR?(s.errorAllTheThings("Bad code signature"),c.signature=void 0):(console.error(e),e instanceof Error?n(e.message,e.notifText):e.error?n(e.error):e.status&&e.statusText?n(`Response status ${e.status} : ${e.statusText}`):n(String(e)))}var o},s.onDispose=function(){m?.dispose()},this.getXHR=function(){return m?.getXHR()},s.canSetValue=function(){return!1},p=s.runScriptSettings()}}();