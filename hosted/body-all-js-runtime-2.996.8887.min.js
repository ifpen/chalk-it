var geoJsonColors=["#800080","#FF00FF","#000080","#0000FF","#008080","#00FFFF","#FFFF00","#800000"],geoConversion=function(){function e(e,t,r,n){for(var o=[],i={type:"FeatureCollection",features:[]},s=0;s<t.length;s++)o.push([t[s],e[s]]);var u={type:"Feature",geometry:{type:"LineString",coordinates:o},properties:{style:{color:geoJsonColors[n],weight:4,opacity:.9},description:'<span style="color: '+geoJsonColors[n]+'">'+r+"</span>"}};return u&&i.features.push(u),i}return{geoJson2dqTrip:function(e){var t={longitude:[],latitude:[]};for(i=0;i<e.features.length&&"LineString"==e.features[i].geometry.type;i++){var r=e.features[i].geometry.coordinates;for(k=0;k<r.length;k++)curLat=Number(r[k][1]),curLng=Number(r[k][0]),t.latitude.push(curLat),t.longitude.push(curLng)}return t},dqTrip2geoJson:function(t,r,n){var o=t.longitude,i=t.latitude,s=r+"_gpsTrace",u=null;return _.isUndefined(o)||_.isUndefined(i)||(u=e(i,o,s,n)),u},dqTrip2Csv:function(e){for(var t="latitude,longitude\n",r=0;r<e.longitude.length;r++)t=t+e.latitude[r]+","+e.longitude[r]+"\n";return t},hereMm2geoJson:function(t,r,n){if(_.isUndefined(t))return{};if(t=={})return{};if(_.isUndefined(t.RouteLinks))return{};for(var o,i,s=[],u=[],p=0;p<t.RouteLinks.length;p++)for(var a=t.RouteLinks[p].shape.split(" "),l=0;l<a.length;l+=2)o=Number(a[l]),s.push(o),i=Number(a[l+1]),u.push(i);return e(s,u,r+"_here",n)},graphHopper2geoJson:function(e,t,r,n){var o={};if(e.paths){for(var i=0;i<e.paths.length;i++){var s=e.paths[i];if(s.points_encoded){var u=graphhopper.util.decodePath(s.points,undefined);s.points={type:"LineString",coordinates:u}}}o={type:"FeatureCollection",features:[{type:"Feature",geometry:e.paths[0].points,properties:{style:{color:geoJsonColors[n],weight:4,opacity:.9},description:'<span style="color: '+geoJsonColors[n]+'">'+t+"_mapMatch_"+r+"</span>"}}]}}return o}}}();function Point(e,t,r){this.label=e,this.x=360*(r+180),this.y=180*(t+90),this.distance=function(e){var t=e.x-this.x,r=e.y-this.y;return Math.sqrt(t*t+r*r)},this.slope=function(e){var t=e.x-this.x;return(e.y-this.y)/t},this.toString=function(){return this.label}}function Points(e){return this.points=e,upper=function(e){for(var t=e[0],r=1;r<e.length;r++){var n=e[r];(n.y>t.y||n.y==t.y&&n.x<t.x)&&(t=n)}return t}(e),{pointSort:function(e,t){if(e==upper)return-1;if(t==upper)return 1;var r=upper.slope(e),n=upper.slope(t);return r==n?e.distance(upper)<t.distance(upper)?-1:1:r<=0&&n>0?-1:r>0&&n<=0?1:r>n?-1:1}}}
var angularModule=angular.module("xCLOUD",["angularjs-gauge","rzSlider","720kb.datepicker","ui.router.state","modules.python-images"]);angularModule.run(["$rootScope",function(a){a.urlBase=urlBase,a.navBarNotification="true"===navBarNotification,a.showNavBar="true"===showNavBar,a.loadingBarStart=function(a){},a.loadingBarStop=function(a){},a.notificationFilterDataValue="",a.listNotifications=[],a.nbNotifications=0,a.pageNumber=1,a.totalPages=1,a.pageNames=[],a.clearAllNotifications=function(t){a.listNotifications=[],a.nbNotifications=0;for(let t=0;t<a.alldatanodes.length;t++)a.alldatanodes[t].__notifications=void 0},a.safeApply=function(t){var o=a.$root.$$phase;"$apply"==o||"$digest"==o||a.$apply()}}]);
angular.module("xCLOUD").service("SessionUser",[function(){var e="userId",t="userAvatar",s="bLegalConditionsAccepted";return this.setUserId=function(t){sessionStorage.setItem(e,t)},this.setUserAvatar=function(e){sessionStorage.setItem(t,e)},this.setLegalConditionsAccepted=function(e){this.setCookie(s,e,100)},this.getUserId=function(){return sessionStorage.getItem(e)},this.getUserName=function(){return sessionStorage.getItem("userName")},this.getToken=function(){return sessionStorage.getItem("token")},this.getUserAvatar=function(){return sessionStorage.getItem(t)},this.getLegalConditionsAccepted=function(){return this.getCookie(s)},this.getUserProfile=function(){return{userName:this.getUserName(),userId:this.getUserId(),token:this.getToken(),userAvatar:this.getUserAvatar()}},this.setExpiredDate=function(){},this.checkSession=function(){},this.setCookie=function(e,t,s){var n=new Date;n.setTime(n.getTime()+24*s*60*60*1e3);var i="expires="+n.toUTCString();document.cookie=e+"="+t+";"+i+";path=/"},this.getCookie=function(e){for(var t=e+"=",s=decodeURIComponent(document.cookie).split(";"),n=0;n<s.length;n++){for(var i=s[n];" "==i.charAt(0);)i=i.substring(1);if(0==i.indexOf(t))return i.substring(t.length,i.length)}return""},this}]);
angular.module("xCLOUD").service("ApisFactory",["$http","$rootScope",function(t,e){function n(t,e,n,r){return $.ajax({type:t,contentType:"application/json; charset=utf-8",data:JSON.stringify(n),dataType:"json",crossDomain:!0,url:urlxDashNodeServer+"api/"+e})}return this.saveSettings=function(t){return new Promise((function(e,n){(new FileMngrFct).SendFile("settings",new Blob([JSON.stringify(t)],{type:"application/json"}),e)})).then((function(n){return e.allSettings=t,t}),(function(t){return console.log("saveSettings error "+t),{error:!0,status:401,message:t}}))},this.getSettings=function(){return new Promise((function(t,e){(new FileMngrFct).ReadFile("settings","",t)})).then((function(t){if("File does not exist"==t)return console.log("settings.usr file does not exist on server. Creating new one with default settings"),e.DefaultSettings;var n={};try{n=JSON.parse(t)}catch(n){return e.xDashFullVersion?swal("Unexpected error","unable to load settings.usr\n\n"+t,"error"):swal("Please check and restart the command line","the Flask server is not responding","error"),e.DefaultSettings}return n}),(function(t){return console.log("getSettings error"+t),{error:!0,status:401,message:t}}))},this.postRequest=function(n,r){return e.loadingBarStart(),t.post(xServConfig.urlApi+n,JSON.stringify(r),{contentType:"application/json; charset=utf-8"}).then((function(t){return e.loadingBarStop(),JSON.parse(t.data.d)}),(function(t){return e.loadingBarStop(),t}))},this.GetProjectByName=function(n){return e.loadingBarStart(),t.post(xServConfig.urlApi+"ReadProject",JSON.stringify(n),{contentType:"application/json; charset=utf-8"}).then((function(t){return e.loadingBarStop(),JSON.parse(t.data.d)}),(function(t){return e.loadingBarStop(),t}))},this.deleteFileFromServer=function(n,r){return e.loadingBarStart(),t.post(xServConfig.urlApi+r,JSON.stringify(n),{contentType:"application/json; charset=utf-8"}).then((function(t){return e.loadingBarStop(),JSON.parse(t.data.d)}),(function(t){return e.loadingBarStop(),t}))},this.sentResetPasswordRequest=function(t){return n("PUT","auth/updatepassword",{email:t})},this.sentResetPasswordForm=function(t){return n("POST","auth/updatepassword",t)},this.registerRequest=function(t){return n("POST","auth/register",t)},this.loginWithEmailPasswordAction=function(t){return n("POST","auth/login",{email:t.email,password:t.password})},this.getUserProfileByToken=function(t){return n("GET","users/me?Authorization=Bearer "+t,{})},this.updatePassword=function(t){return n("POST","auth/updatepassword",{email:t.email,password:t.password})},this}]);
angular.module("modules.python-images",[]).config(["$stateProvider",function(e){e.state("modules.python-images",{notAuthenticate:!0,userAuthenticated:!1,abstract:!0,url:"/python-images",templateUrl:""})}]).service("PythonImagesManager",["$http","$rootScope","ApisFactory",function(e,t,a){const n=this;function i(e,t){if("success"!==t)throw Error(e)}function o(e=!0){const t=new Uint32Array(8);window.crypto.getRandomValues(t);let a="";for(let n=0;n<t.length;n++)a+=(n<2||n>5?"":"-")+t[n].toString(e?16:36).slice(-4);return a}function l(){return new Promise(((e,t)=>{(new FileMngrFct).GetFileList("pydata",((a,n,i)=>{"success"===i?e(a.FileList.map((e=>e.Python))):t(a)}),!1)}))}function s(e){return new Promise(((t,a)=>{(new FileMngrFct).ReadFile("pydata",e,((e,n,i)=>{var o;"success"===i?t((o=e,decodeURIComponent(Array.prototype.map.call(atob(o),(function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)})).join("")))):a(e)}))}))}function r(e,t,a){const n=e.Id;return a&&a(0),new Promise(((e,i)=>{(new FileMngrFct).SendText("pydata",n,t,((t,a,n)=>{"success"===n?e(t):i(t)}),a)}))}this.getImages=async()=>{const e=await l();return e||[]},this.createImage=async(e,t,a)=>{await r(e,t.data,a),(new FileMngrFct).AddPythonInfo(e.Id,i,e.BaseImage,"",e.Name,e.Description,e.FileName,e.FileSize)},this.updateImage=async(e,t,a={},n)=>{e.Hash&&(_.isUndefined(t)||(a.data||t.FileName!==e.FileName||t.BaseImage!==e.BaseImage)&&(e.Hash=void 0)),a.data&&await r(e,a.data,n),(new FileMngrFct).AddPythonInfo(e.Id,i,e.BaseImage,e.Hash,e.Name,e.Description,e.FileName,e.FileSize);const o=await l();if(!o)throw Error("No images defined");const s=o.findIndex((t=>t.Id===e.Id));if(-1===s)throw Error(`Image ${e.Id} does not exist`);o[s]=e},this.deleteImage=async t=>{const a=urlPython+`images/${t.Id}`;e.delete(a,{headers:{Authorization:LoginMngr.GetSavedJwt()}}),async function(e){await new Promise(((e,t)=>{(new FileMngrFct).GetFileList("pydata",((a,n,i)=>{"success"===i?e(a.FileList.map((e=>e.Name))):t(a)}),!1)})),(await n.getImages()).map((e=>e.Id));!function(e){new Promise(((t,a)=>{(new FileMngrFct).DeleteFile("pydata",e,((e,n,i)=>{"error"===i?a(e):t(e)}))}))}(e)}(t.Id)},this.buildImage=async t=>{const a=urlPython+"images/build",n={id:t.Id,baseImage:t.BaseImage,fileData:await s(t.Id),fileName:t.FileName};return(await e.post(a,n,{headers:{Authorization:LoginMngr.GetSavedJwt()}})).data},this.getImageFullStatus=async t=>{const a=urlPython+`images/${t}`;return(await e.get(a,{headers:{Authorization:LoginMngr.GetSavedJwt()}})).data},this.getImagesStatus=async t=>{const a=urlPython+"images/list";return(await e.post(a,t,{headers:{Authorization:LoginMngr.GetSavedJwt()}})).data};const c="name",u="file",d="base",p="python:3.8";let m;m=xDashConfig.disablePythonSlim?[{label:"python:3.10",value:"python:3.10"},{label:"python:3.9",value:"python:3.9"},{label:"python:3.8",value:p},{label:"python:3.7",value:"python:3.7"},{label:"python:3.6",value:"python:3.6"}]:[{label:"python:3.10-slim",value:"python:3.10-slim"},{label:"python:3.10",value:"python:3.10"},{label:"python:3.9-slim",value:"python:3.9-slim"},{label:"python:3.9",value:"python:3.9"},{label:"python:3.8-slim",value:"python:3.8-slim"},{label:"python:3.8",value:p},{label:"python:3.7-slim",value:"python:3.7-slim"},{label:"python:3.7",value:"python:3.7"},{label:"python:3.6-slim",value:"python:3.6-slim"},{label:"python:3.6",value:"python:3.6"}];function g(e,t){const a=$('<div style="margin: 10px 0 10px 0"></div>'),n=h(c,"Image name",a),i=$('<input type="text">').appendTo(n).change((function(){e.Name=$(this).val(),y(e,t)}));e.Name&&i.val(e.Name);const o=h("desc","Image description",a),l=$('<textarea class="calculated-value-input">').appendTo(o).change((function(){e.Description=$(this).val(),y(e,t)}));e.Description&&l.val(e.Description);const s=h(d,"Base image",a),r=$("<select></select>").appendTo($('<div class="styled-select"></div>').appendTo(s));m.forEach((e=>{r.append($(`<option>${e.label}</option>`).attr("value",e.value))})),r.change((function(){e.BaseImage=$(this).val(),y(e,t)})),e.BaseImage&&r.val(e.BaseImage);const p=e.FileName?I(e.FileName,e.FileSize):"",g=$(`<input type="text" id="select_file_path" value="${p}"></input><label class="board-toolbar datasource-input-suffix"><i class="fa-folder-open fa" aria-hidden="true"></i>Browse...</label>`),w=$('<input type="file" style="display: none" id="select_file" accept=".zip, .txt"></input>').appendTo(g);g.mousedown((function(e){e.preventDefault(),$("#select_file").trigger("click")})),w.change((function(a){if(a.target.files.length>0){const n=a.target.files[0],i=n.name;if(n.size>1e9)f(u),v(u,`File ${i} is too big.`);else{const a=new FileReader;a.addEventListener("load",(function(a){const o=a.target.result,l=n.size;t.data=o.replace(/^data:.+;base64,/,""),e.FileName=i,e.FileSize=l,$("#select_file_path").val(I(i,l)),y(e,t)})),a.readAsDataURL(n)}}}));const F=h(u,"Package/requirements",a);return g.appendTo(F),a}function h(e,t,a){var n=$('<div id="setting-row-'+e+'" class="form-row"></div>').appendTo(a);return n.append('<div class="form-label"><label class="control-label">'+t+"</label></div>"),$('<div id="setting-value-container-'+e+'" class="form-value"></div>').appendTo(n)}function y(e,t){var a=!0;return f(c),0===(e.Name||"").trim().length&&(v(c,"This is required"),a=!1),f(u),(e.FileSize||0)<=0&&(v(u,"Either a requirement file or a package is required"),a=!1),f(d),0===(e.BaseImage||"").trim().length&&(v(d,"Base image is mandatory"),a=!1),a}function v(e,t){const a=$('<div class="validation--error"></div>').html(t);$("#setting-value-container-"+e).append(a)}function f(e){$("#setting-value-container-"+e).children(".validation--error").remove()}function I(e,t){var a="";return e&&(a+=e),t&&t>0&&(a+=" ("+w(t)+")"),a}function w(e){if(!e)return"";var t=1,a="";e>1e9?(t=1e9,a="Go"):e>1e6?(t=1e6,a="Mo"):e>1e3&&(t=1e3,a="ko");var n=e/t;return""+(n=Math.round(100*n)/100)+a}this.openOutputDialog=async(e,t)=>{const a=this;const n=await this.getImageFullStatus(e),i=$('<div><pre id="outputText" style="color: white; background-color: black"></div>');new DialogBox(i,"Build output","Close",null,(()=>(t&&t(image),!1))),function t(n){if(n.output){const e=$("#outputText");e.text(n.output.replace(/\r\n/g,"\n"));const t=e.parent();t.animate({scrollTop:t.prop("scrollHeight")})}"building"===n.status&&setTimeout((async()=>t(await a.getImageFullStatus(e))),5e3)}(n)},this.openNewImageDialog=()=>{const e={BaseImage:p,Id:o(!1)},t={};return $("#editForm").append(g(e,t)),[e,t]},this.openEditImageDialog=e=>{const t=_.clone(e),a={};return $("#editForm").append(g(t,a)),[t,a]},this.checkImageValidity=y,this.imageSizeToText=w}]);
function DatanodeDependency(){var e={},t=new Map,n=new Map,o=new Map,s=new Map,r=new Map,i=[],a=[];function c(e,t){var n,o,s,r=[];[n,o]=l();var i=new Set;if(e.forEach((function(e){let t=new Set(n.getDescendants(e));t.add(e),r.push(t)})),1==e.length&&0==t.length)t.push(r[0]);else for(let e=0;e<r.length;e++){i=r[e];for(let t=e+1;t<r.length;t++){0!=new Set([...i].filter((e=>r[t].has(e)))).size&&(i=union(i,r[t]))}if(0==t.length)t.push(i);else{for(let e in t){let n=new Set([...i].filter((n=>t[e].has(n))));if(0!=n.size){n.size<i.size&&(i=union(i,t[e]),t.splice(e,1,i)),s=!0;break}s=!1}s||t.push(i)}i=new Set}let a=0;return t.forEach((function(e){e.id=e.values().next().value+Math.random(),e.index=a,a++})),t}function d(){const e=f();i=c(e,[]),offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("All disconnected Graphs: ",i),a=[],i.some((function(e){1==e.size&&e.forEach((function(e,t,n){a.push(t)}))}))}function u(e){return a.includes(e)}function f(){const e=g(),t=e.nodes();let n=[];for(let o in t)(0==e.indegree(t[o])||-1!==t[o].indexOf("pastValue_"))&&n.push(t[o]);return n}function l(){let t=new Graph,n=!1;for(let o in e){let s=o,r=[];e[o].forEach((function(e){r.push(e)})),t.add(s,r);for(let e in r)r[e]===s&&(n=!0)}return[t,n]}function h(){let t=new Graph,n=!1;for(let o in e){let s=o,r=[];e[o].forEach((function(e){let t=!0,n=e.match(/pastValue_(.+)/);if(n){let e=n[1];o==e&&(t=!1)}t&&r.push(e)})),t.add(s,r);for(let e in r)r[e]===s&&(n=!0)}return[t,n]}function g(){let t=new GraphDS;for(let n in e){let o=n;t.addNode(o),e[n].forEach((function(e){t.addEdge(o,e)}))}return t}return{dependencyStructure:e,addNode:function(t){e[t]=new Set},removeNode:function(t){delete e[t];for(let n in e)e[n].has(t)&&e[n].delete(t)},addEdge:function(t,n){e[t].add(n)},removeEdge:function(t,n){e[t].delete(n)},removeMissedDependantDatanodes:function(t,n){for(let o in e)t.has(o)||e[o].has(n)&&e[o].delete(n)},getSuccessors:function(t){return e[t].values()},getPredecessorsSet:function(t){let n=new Set;for(let o in e)e[o].has(t)&&n.add(o);return n},hasSuccessors:function(t){return e[t].size>0},hasPredecessors:function(t){let n=!1;for(let o in e)if(e[o].has(t)){n=!0;break}return n},getSourceNodes:function(){const e=g(),t=e.nodes();let n=[];for(let o in t)0==e.indegree(t[o])&&n.push(t[o]);return n},getSourceNodesWithMemory:f,getDescendantsinBFS:function(e){},getDescendants:function(e,t){let n,o;return[n,o]=t?h():l(),startNodesDesc=new Set,e.forEach((function(e){elemDesc=new Set(n.getDescendants(e)),startNodesDesc=union(startNodesDesc,elemDesc)})),startNodesDesc},getDisconnectedGraphs:c,getBelongingDisconnectedGraph:function(e,t){let n;return t.some((function(t){t.has(e)&&(offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("node ",e," is found in disconnected graph: ",t),n=t)})),n},computeAllDisconnectedGraphs:d,getAllDisconnectedGraphs:function(){return i},resetGraphList:function(){i=[],a=[]},isNode:function(t){return!_.isUndefined(e[t])},renameNode:function(t,n){for(let o in e)e[o].has(t)&&(e[o].delete(t),e[o].add(n));const o=e[t];delete e[t],e[n]=o},topologicalSort:function(){let e=g();return e.nodes().forEach((function(t){datanodesManager.foundDatanode(t)||e.removeNode(t)})),e.topologicalSort()},detectCycles:function(){let e,t;return[e,t]=h(),{hasCycle:e.hasCycle(),getCycles:e.getCycles(),hasLoop:t}},getExtraStartNodesList:function(){return t},addExtraStartNodesList:function(e,n){t.has(e)&&xdashNotifications.manageNotification("info",e,e+" is called many consecutif times while scheduler is in progress"),t.set(e,n)},clearExtraStartNodesList:function(){t.clear()},getSetvarList:function(){return n},addSetvarList:function(e,t){n.has(e)&&n.get(e)!==t&&xdashNotifications.manageNotification("warning",e,'Possible undeterminism: setVariable of "'+e+'" is used more than once in other dataNodes as: "'+n.get(e)+'" and "'+t+'"'),n.set(e,t)},clearSetvarList:function(){n.clear()},getProcessedSetvarList:function(){return o},addProcessedSetvarList:function(e){for(const[t,n]of e.entries())o.set(t,n)},clearProcessedSetvarList:function(){o.clear()},getMemorydataNodeList:function(){return s},addMemorydataNodeList:function(e){s.set(e,"memory")},getCurrentGraphList:function(){return r},addCurrentGraphList:function(e,t){r.has(e),r.set(e,t)},clearCurrentGraphList:function(){r.clear()},clearMemorydataNodeList:function(e){_.isUndefined(e)?s.clear():e.forEach((e=>{s.has(e)&&s.delete(e)}))},getAllsingletonNodes:function(){return offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("SingletonNodeList: ",a),a},isSingletonNode:u,updateDisconnectedGraphsList:function(e,t){switch(t){case"add":case"default":d();break;case"delete":u(e)?function(e){i.some((function(t){if(t.has(e)){t.delete(e);let n=a.indexOf(e);a.splice(n,1)}}))}(e):d()}}}}
function GraphVisu(e){var t,n,o,a,r,d=null,i=[],c=[],l={},s=[],u=[];let g=[],p=[],f=[],h=0;function v(e){let t=datanodesManager.getDataNodeByName(e).beautifulString();void 0===t&&(t="NO DATA");var n=document.createElement("div");return n.innerHTML=t,n}function m(e){y();var i={scale:o,offset:{x:t,y:n},animation:{duration:a,easingFunction:r}};d.focus(e,i)}function y(){t=0,n=0,a=1e3,o=3,positionx=300,positiony=300,r="easeInOutQuint"}function b(){y();var e={offset:{x:t,y:n},duration:a,easingFunction:r};d.fit({animation:e})}return $("#inputSearchGraph").on("input",(function(e){var t,n=$(this).val();h=0;for(let e=0;e<u.length;e++)i.update([{id:l[u[e].label],font:{color:"#0843b9",background:"#e3ecff"}}]),u[e].label.toLowerCase().match(n)&&n.length>2&&(i.update([{id:l[u[e].label],font:{color:"white",background:"black"}}]),t=u[e].label,h++);1===h?m(l[t]):b()})),$("#exportGraph").on("click",(function(){var e=document.getElementById("canvas");console.log("mynetworkCanvas",e),e.toBlob((function(e){var t=document.createElement("a");document.body.appendChild(t),t.download="network.png",t.href=window.URL.createObjectURL(e),t.click()}))})),$("#openFullScreen").on("click",(function(){var e=document.getElementById("dependencyGraphBody");e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen()})),$("#zoomIn").on("click",(function(){d.setScale(d.getScale()+.3)})),$("#zoomOut").on("click",(function(){d.setScale(d.getScale()-.3)})),{showDepGraph:function(t){let n=datanodesManager.getAllDataNodes(),o=[];for(let e in n)o[e]=n[e].name();let a=[];for(var r=0;r<o.length;r++)a.push({id:r,label:o[r],title:v(o[r]),type:datanodesManager.getDataNodeByName(o[r]).type(),disconnected:e.isSingletonNode(o[r]),widgetConnection:datanodesManager.isConnectedWithWidgt(o[r])[0]}),l[o[r]]=r;u=a;let s=[],p=[];for(var f=0;f<o.length;f++){p=Array.from(e.dependencyStructure[o[f]]);for(var h=0;h<p.length;h++)s.push({from:f,to:l[p[h]],arrows:"to"})}i=new vis.DataSet(a),c=new vis.DataSet(s),function(e,t){var n=$('<div id="dependencyGraphBody" class="modal-body" style="vertical-align: middle; overflow: auto; display: block; margin: auto; width: 938px; height: 625px; border: 1px solid lightgray;"></div>');document.getElementById("dependencyGraph").hasChildNodes()||n.appendTo($("#dependencyGraph"));var o=document.getElementById("dependencyGraphBody"),a={layout:{randomSeed:3},nodes:{borderWidth:1,font:{size:15,color:"#0843b9"},color:{border:"#478dec",background:"#e3ecff"},shape:"box",margin:15},edges:{color:"#9fb8ed"},interaction:{hover:!0,zoomView:!0},physics:{forceAtlas2Based:{theta:.2,gravitationalConstant:-65,centralGravity:.015,springLength:70,damping:.7,avoidOverlap:.95},minVelocity:20,solver:"forceAtlas2Based",timestep:.1}};d=new vis.Network(o,e,a),$("#dependencyGraphBody canvas").attr("id","canvas"),d.on("doubleClick",(function(e){var t=e.nodes[0];let n=datanodesManager.getAllDataNodes();datanodesManager.editNodeFromGraph(n[t])}));var r=document.getElementById("dependencyGraphBody").getElementsByTagName("canvas")[0];d.on("hoverNode",(function(){r.style.cursor="pointer"})),d.on("blurNode",(function(){r.style.cursor="default"})),d.on("stabilizationIterationsDone",(function(){!function(e){if(g=[],"string"==typeof e)i.update([{id:l[e],color:{background:"orange"}}]),m(l[e]);else if("object"==typeof e){e=JSON.parse(e.target.attributes.name.value);for(let t=0;t<e.length;t++)g.push({id:l[e[t]],color:{background:"orangered"}});i.update(g),1===e.length&&m(l[e[0]])}}(t)})),vis.Network.prototype.setScale=function(e){var t={position:{x:0,y:0},scale:e,animation:{duration:300}};t.scale>=0&&this.view.moveTo(t)}}({nodes:i,edges:c},t)},selectNodeFromTagList:function(e){var t=document.getElementById(e),n=[];if(t.classList.contains("active")){t.classList.remove("active");for(let t=0;t<p.length;t++)p[t].type===e&&(p[t].color={background:"#e3ecff"},n.push(p[t]));i.update(p),b(),-1!==s.indexOf(e)&&s.splice(s.indexOf(e),1);for(let e=0;e<n.length;e++)p.splice(p.indexOf(n[e]),1)}else{h=0,-1===s.indexOf(e)&&s.push(e),t.classList.add("active");for(let t=0;t<u.length;t++)u[t].type===e&&(p.push({id:l[u[t].label],type:e,color:{background:"yellow"}}),h++);i.update(p),1===h?m(p[0].id.toString()):b()}},selectConnectedWithWidget:function(e){var t=document.getElementById(e),n=[];if(t.classList.contains("active")){t.classList.remove("active");for(let t=0;t<f.length;t++)"green"===f[t].color.border&&"connectedtowidget"===e&&(f[t].color={border:"#478dec"},f[t].borderWidth=1,n.push(f[t])),"red"===f[t].color.border&&"notconnectedtowidget"===e&&(f[t].color={border:"#478dec"},f[t].borderWidth=1,n.push(f[t]));i.update(f),b();for(let e=0;e<n.length;e++)f.splice(f.indexOf(n[e]),1)}else{h=0,t.classList.add("active");for(let t=0;t<u.length;t++)!0===u[t].widgetConnection&&"connectedtowidget"===e&&(f.push({id:l[u[t].label],borderWidth:3,color:{border:"green"}}),h++),!1===u[t].widgetConnection&&"notconnectedtowidget"===e&&(f.push({id:l[u[t].label],borderWidth:3,color:{border:"red"}}),h++);i.update(f),1===h?m(f[f.length-1].id.toString()):b()}},closeGraph:function(){for(g=[],p=[],f=[],h=0,$("#inputSearchGraph").val("");s.length;){for(var e=0;e<s.length;e++){document.getElementById(s[e]).classList.remove("active")}s.pop()}document.getElementById("connectedtowidget").classList.remove("active"),document.getElementById("notconnectedtowidget").classList.remove("active")}}}
function DatanodesListModel(e,a,t,n){var s=this,r=[];function d(a){var r=new DatanodeModel(s,e,t,n);return r.deserialize(a)?(s.addDatanode(r),!0):(s.error(!0),!1)}this.datanodes=ko.observableArray(),this.datasourceData={},this.processDatanodeUpdate=function(e,a){s.datasourceData[e]=a},this.renameDatanodeData=function(e,a){s.datasourceData[a]=s.datasourceData[e],delete s.datasourceData[e]},this._datanodeTypes=ko.observable(),this.datanodeTypes=ko.computed({read:function(){s._datanodeTypes();var a=[];return _.each(e,(function(e){var t=e.type_name,n=t;_.isUndefined(e.display_name)||(n=e.display_name),a.push({name:t,display_name:n})})),a}}),this.serialize=function(){var e=[];_.each(s.datanodes(),(function(a){e.push(a.serialize())}));var a=angular.element(document.body).scope().$root;return a.alldatanodes=datanodesManager.getAllDataNodes(),a.showNotifications=!1,a.safeApply(),{datanodes:e}},this.deserialize=function(e,a,o){return a&&s.clear(),function(){s.error=ko.observable(!1),r=[];var a,i=[];if(_.isUndefined(e.datanodes)&&(e.datanodes=e.datasources,delete e.datasources),(i=e.datanodes).sort((function(e,a){return"Memory_plugin"===e.type&&"Memory_plugin"!==a.type?1:"Memory_plugin"!==e.type&&"Memory_plugin"===a.type?-1:void 0})),_.each(i,(function(e){if(function(e){for(var a=!1,t=0;t<s.datanodes().length;t++)if(a=!1,s.datanodes()[t].name()==e){a=!0;break}return!!a}(e.name))r.push(e);else if(!d(e))return!1})),0!=r.length&&(a=xdsjson.getDuplicateDataList(r,"Please check data to be loaded after choosing rename or overwite option"),new DialogBoxForDuplicateData(a,"List of duplicate data name","Load","Close",(function(){var e=0;for(e=0;e<r.length;e++)$("#data-checkbox-"+e).is(":checked")&&(r[e].name=$("#data-check-"+e)[0].value);for(e=0;e<r.length;e++)if($("#data-checkbox-"+e).is(":checked"))if(r[e].name=$("#data-check-"+e)[0].value,$("#data-rename-"+e).is(":checked"))d(r[e]);else for(var a=0;a<s.datanodes().length;a++)if(s.datanodes()[a].name()==r[e].name){s.deleteDatanode(s.datanodes()[a]),s.datanodes.remove(s.datanodes()[a]),d(r[e]);break}}))),s.datanodes().length>0){var l=!1,c=Object.keys(t.dependencyStructure).length-i.length;if(0!=c)for(var f in t.dependencyStructure){l=!1;for(var u=0;u<i.length;u++)if(f===i[u].name){l=!0;break}if(!l){var h=Array.from(t.getSuccessors(f));swal("Missed dataNodes!","'"+f+"' is referenced in formula of '"+h+"' but doesn't exist in list of datanodes","error"),c--}if(0==c)break}for(var m=!1,g=!1,p=0,v=0,y=0;y<s.datanodes().length;y++){i=s.datanodes()[y],_.isUndefined(i.settings().refresh)?_.isUndefined(i.settings().refresh_time)?_.isUndefined(i.settings().refresh_rate)?_.isUndefined(i.settings().refreshRate)||(i.settings().sampleTime=i.settings().refreshRate,delete i.settings().refreshRate):(i.settings().sampleTime=i.settings().refresh_rate,delete i.settings().refresh_rate):(i.settings().sampleTime=i.settings().refresh_time,delete i.settings().refresh_time):(i.settings().sampleTime=i.settings().refresh,delete i.settings().refresh);const a=e.version,t=/^(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)$/.exec(a);if(t){const e=parseInt(t[1],10),a=parseInt(t[2],10);(e<2||2===e&&a<890)&&i.settings().explicitTrig&&i.settings().autoStart&&(i.settings().autoStart=!1)}}t.computeAllDisconnectedGraphs();for(y=0;y<s.datanodes().length;y++)i=s.datanodes()[y],_.isUndefined(i.settings().sampleTime)||0==i.settings().sampleTime?(g=!0,v=y):(m=!0,p=y,i.sampleTime(i.settings().sampleTime),n.registerDatanode(i.sampleTime(),i.name(),"globalFirstUpdate"));m&&(i=s.datanodes()[p],n.registerDatanode(i.sampleTime(),i.name())),g&&(i=s.datanodes()[v],s.launchGlobalFirstUpdate(i))}_.isFunction(o)&&o()}(),!s.error()},this.launchGlobalFirstUpdate=function(e){var a=t.getSourceNodesWithMemory();0!=a.length&&e.schedulerStart(a,a[0],"globalFirstUpdate")},this.clear=function(){if(t.clearExtraStartNodesList(),t.clearSetvarList(),t.clearProcessedSetvarList(),t.clearCurrentGraphList(),_.each(s.datanodes(),(function(e){s.deleteDatanode(e)})),Object.keys(t.dependencyStructure).length)for(var e in t.dependencyStructure)t.removeNode(e),console.log("extra nodes are deleted");t.resetGraphList(),s.datanodes.removeAll()},this.load=function(e,t,n){a.showLoadingIndicator(!0),s.deserialize(e,t,(function(){return a.showLoadingIndicator(!1),_.isFunction(n)&&n(),!s.error()}))},this.addDatanode=function(e){for(var a=!1,t=0;t<s.datanodes().length;t++)if(a=!1,s.datanodes()[t].name()==e.name()){a=!0;break}a||s.datanodes.unshift(e)},this.deleteDatanode=function(e){var a=e.name();delete s.datasourceData[a],e.dispose()}}
function FormulaInterpreter(e,t,a,n){var s=this;s.bCalculatedSettings=!0,this.callValueFunction=function(a){return datanodesManager.setCurrentDataNode(t.name()),a.call(void 0,e.datasourceData)},this.processCalculatedSetting=function(e,a){var n=!1;let o=a.split("\n");for(let e=0;e<o.length;e++)for(var i=new RegExp("dataNodes.([\\w\\-]{1,}\\.{0,}[\\w\\-]{0,})|dataNodes\\[['\"]([\\w\\\\\\-]{1,})['\"]\\]((\\[['\"]([\\w\\W]){1,}['\"](?=\\])\\])){0,1}","g");matches=i.exec(o[e]);){let a,o;if(_.isUndefined(matches[1])){a=matches[2].split('"]')[0],o=matches[0];let e=1,t=matches[0].split('"]').length-1;if(t>2)for(let a=0;a<t-2;a++)for(o=matches[0].substring(0,matches[0].length-e),e++;!o.endsWith('"]',o.length);)o=matches[0].substring(0,matches[0].length-e),e++}else a=matches[1].split(".")[0],o=matches[0];try{let e=new Function("dataNodes",o);s.callValueFunction(e)}catch(o){t.statusCallback("Error",o.message);const i="var "+a+" in line "+e+" : "+o.message;t.notificationCallback("error",t.settings().name,i,"Error evaluation at datanode : '"+t.name()+"'"),n=!0,s.bCalculatedSettings=!1}}if(!n&&_.isFunction(t.calculatedSettingScripts[e])){let n;try{n=s.callValueFunction(t.calculatedSettingScripts[e])}catch(e){t.statusCallback("Error",e.message),t.notificationCallback("error",t.settings().name,e.message,"Parse error"),n=null,s.bCalculatedSettings=!1}if(!_.isUndefined(t.datanodeInstance)&&_.isFunction(t.datanodeInstance.onCalculatedValueChanged)){if(!_.isEmpty(a))if(_.isUndefined(n)){const a="Parse error while parsing formula in : '"+t.name()+"'";t.notificationCallback("warning",t.settings().name,a,"Parse error"),t.statusCallback("Error","Parse error");try{t.datanodeInstance.onCalculatedValueChanged(e,void 0)}catch(e){console.log(e.toString())}}else if(!_.isNull(n)){const a=!0,s="Success while parsing formula in : '"+t.name()+"'";t.notificationCallback("success",t.settings().name,s,"Parse success",a);try{t.datanodeInstance.onCalculatedValueChanged(e,n)}catch(e){console.log(e.toString())}}}else console.log("datanodeInstance or onCalculatedValueChanged function is not defined")}return!0},this.updateCalculatedSettings=function(e,o,i){if(s.bCalculatedSettings=!0,t.datanodeRefreshNotifications={},t.calculatedSettingScripts={},_.isUndefined(t.type()))return!1;var r=a[t.type()].settings,l=new RegExp("dataNodes.([\\w_-]+)|dataNodes\\[['\"]([^'\"]+)","g");const c=/(setVariables\((\[.+?\]),(\[.*?\])\))|(setVariable\((.+?)),((.*?)[^,])\)|(executeDataNode\(((.*?)[^,])\))|(.executeDataNodes\((\[.+?\])\))|(.setVariableProperty\((.+?),(\[.*?\]),(.*?)[^,]\))/g,d=/(?=["'])(?:"[^"\\]*(?:\\[\s\S][^"\\]*)*"|'[^'\\]*(?:\\[\s\S][^'\\]*)*')|(#.*$)/gm;var u=t.settings(),g=!0;return _.each(r,(function(a){if("calculated"==a.type||"custom2"==a.type){var r=u[a.name];if(!_.isUndefined(r)){if(r=(r=(r="custom2"==a.type?r.replace(d,(function(e,t){return null==t?e:""})):r.replace(/\/\*[\s\S]*?\*\/|([^\\:]|^)\/\/.*$/gm,"$1")).replace(/datasources/g,"dataNodes")).replace(/headersFromDatasourceWS/g,"headersFromDataNodeWS"),_.isArray(r)&&(r="["+r.join(",")+"]"),(r.match(/;/g)||[]).length<=1&&-1==r.indexOf("return"))if(_.isEmpty(r)){if(!_.isUndefined(t.settings().method)&&"POST"==t.settings().method){const e="Cannot have an empty body with a POST method";t.notificationCallback("warning",u.name,e,"Cannot have an empty body with a POST method in datanode : '"+t.name()+"'")}}else r="return "+r;let m,f;if("custom2"!=a.type)try{m=new Function("dataNodes",r)}catch(e){const n=e+".\n Formula interpreted as literal text";t.notificationCallback("warning",u.name,n,"Syntax error at datanode : '"+t.name()+"'");const s=u[a.name].replace(/"/g,'\\"').replace(/[\r\n]/g," \\\n");m=new Function("dataNodes",'return "'+s+'";')}let h=new Set;for(;f=l.exec(r);){const o=f[1]||f[2];if(t.name()===o){const e='DataNode "'+o+'": Please remove from formula the expression dataNodes["'+t.name()+'"].';return t.statusCallback("Error"),swal("Loop detection",e,"error"),s.bCalculatedSettings=!1,void(g=!1)}n.isNode(o)||n.addNode(o);let i=o.match(/pastValue_(.+)/);if(i){let e=i[1];t.name()==e&&(add_edge=!1)}if(n.addEdge(o,t.name()),h.add(o),!e&&!datanodesManager.foundDatanode(o)){const e="DataNode '"+o+"' does not exist in dataNodes list";return t.statusCallback("Error",e),t.notificationCallback("error",t.name(),e,"Error in formula"),void(s.bCalculatedSettings=!1)}let r="";if(n.detectCycles().hasCycle)return n.removeEdge(o,t.name()),r='Cycle detected while computing dataNode "'+o+'" while parsing formula in : "'+t.name()+'"',t.statusCallback("Error"),swal("Cycle detection",r,"error"),s.bCalculatedSettings=!1,void(g=!1);let l=t.datanodeRefreshNotifications[o];_.isUndefined(l)&&(l=[],t.datanodeRefreshNotifications[o]=l),-1==_.indexOf(l,a.name)&&l.push(a.name)}let p=r.split("\n"),C=/\.(goToPage|viewPage|viewProject|\w+Widget)/;"custom2"===a.type&&(C=/\.(output|as_|goToPage|viewPage|viewProject|\w+Widget)/);for(let e=0;e<p.length;e++)if(p[e]=p[e].replace(/\s/g,""),c.lastIndex=0,_.isNull(c.exec(p[e]))&&_.isNull(p[e].match(C))&&(line=p[e].replace(/(['"])(?:\\.|(?!\1)[^\\\n])*\1/g,""),!_.isNull(line.match(/(chalkit|xDashApi)\.[^\s()]+\(/)))){const e="Syntax error in chalkit API";return t.statusCallback("Error",e),t.notificationCallback("error",t.name(),e),void(s.bCalculatedSettings=!1)}if(n.removeMissedDependantDatanodes(h,t.name()),!i&&!t.settings().autoStart&&t.settings().explicitTrig)return void(offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("init: don't process calculate"));if("custom2"!=a.type&&(t.calculatedSettingScripts[a.name]=m,o&&!s.processCalculatedSetting(a.name,r)))return s.bCalculatedSettings=!1,void(g=!1)}}if("option"==a.type&&a.from_datanode){let e=u[a.name];if(!datanodesManager.foundDatanode(e)){const a="DataNode '"+e+"' does not exist in dataNodes list";return t.statusCallback("Error",a),t.notificationCallback("error",t.name(),a),void(s.bCalculatedSettings=!1)}if(t.name()===e){const a='DataNode "'+e+'": Please select another datanode target.';return t.statusCallback("Error"),swal("Loop detection",a,"error"),s.bCalculatedSettings=!1,void(g=!1)}n.isNode(t.name())||n.addNode(t.name());let o=t.name().match(/pastValue_(.+)/);if(o){e==o[1]&&(add_edge=!1)}n.addEdge(e,t.name()),n.removeMissedDependantDatanodes(new Set([e]),t.name())}})),g}}
function TimeManager(){var e,n,r=[],i=0,o=0,t=[];function a(e,n){_.isUndefined(n)&&(n=e);var r;if(e<n){var i=e;e=n,n=i}return 0==(r=e%n)?n:a(n,r)}function d(e){var n=e;for(var i in r)n=a(r[i],n),offSchedLogUser||xDashConfig.disableSchedulerLog||console.log(o);return n}function l(n){e&&clearInterval(e),e=setInterval((function(){c(!1)}),n),c(!0)}function c(r){if(r)offSchedLogUser||xDashConfig.disableSchedulerLog||console.log(n," timer initialization");else{if(n){var o=datanodesManager.getDataNodeByName(n);o?o.schedulerStart(t,n,"timer"):(clearInterval(e),console.log("initiatorDatanodeModel is undefined"))}else clearInterval(e),console.log("initiatorDatanode is undefined");i+=1}}return{registerDatanode:function(e,a,c){r[a]=e,-1==t.indexOf(a)&&t.push(a),n=t[0],o=d(e),i=0,"globalFirstUpdate"!=c&&l(1e3*o)},unregisterDatanode:function(a){delete r[a];var c=t.indexOf(a);-1!=c?(t.splice(c,1),i=0,0==Object.keys(r).length?(n=void 0,clearInterval(e),e=void 0,o=0):(n=t[0],l(1e3*(o=d())))):offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("error in datanode "+a)},isRegisteredDatanode:function(e){return!_.isUndefined(r[e])},getBasePeriod:function(){return o},getHyperPeriod:function(){},getCurrentTick:function(){return i},getCurrentTime:function(){return i*o}}}
var schedulerProfiling={},schedulerProfilingItem={};function DatanodeScheduler(e,a,t,o,n){if(!_.isUndefined(datanodesManager)){var d=new Set(a),s=new Set,i=new Set,r=new Set,c=new Set,l=new Set;datanodesManager.getAllDataNodes().forEach((function(e){l.add(e.name()),xDashConfig.disableSchedulerProfiling||(schedulerProfiling[e.name()]=[])}));var g=e.getDescendants(a,!0),u=difference(l,g),f=new Set;return u.forEach((function(e){"OK"==datanodesManager.getDataNodeByName(e).status()&&f.add(e)})),{launchSchedule:function(){m()},operationCompleted:function(a,t){let n,c=!0;switch(t){case"OK":i.add(a),s.delete(a),datanodesManager.getDataNodeByName(a).is_specific_exec||e.dependencyStructure[a].forEach((function(e){var a;D(e)&&(p(e)?datanodesManager.getDataNodeByName(e).is_specific_exec?(a=e,i.has(a)||d.add(e)):offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("operation "+e+" not added because already executed"):d.add(e))})),offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("operation "+a+" completed with status "+t),xDashConfig.disableSchedulerProfiling||(schedulerProfilingItem.completion=Date.now(),schedulerProfilingItem.status=t,schedulerProfiling[a].push(schedulerProfilingItem)),d.size&&(c=!1,m());break;case"Error":r.add(a),s.delete(a),n=e.getDescendants([a]),n.forEach((function(e){r.add(e),datanodesManager.getDataNodeByName(e).statusCallback("None"),datanodesManager.getDataNodeByName(e).updateCallback("","None")})),d=difference(d,r),offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("operation "+a+" completed with status "+t),xDashConfig.disableSchedulerProfiling||(schedulerProfilingItem.completion=Date.now(),schedulerProfilingItem.status=t,schedulerProfiling[a].push(schedulerProfilingItem));break;case"NOP":if("OK"===datanodesManager.getDataNodeByName(a).status()){i.add(a),s.delete(a),e.dependencyStructure[a].forEach((function(e){D(e)&&(p(e)?offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("operation "+e+" not added because already executed"):d.add(e))})),offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("operation "+a+" completed with status "+t),xDashConfig.disableSchedulerProfiling||(schedulerProfilingItem.completion=Date.now(),schedulerProfilingItem.status=t,schedulerProfiling[a].push(schedulerProfilingItem)),d.size&&(c=!1,m());break}"None"===datanodesManager.getDataNodeByName(a).status()||"Error"===datanodesManager.getDataNodeByName(a).status()?(r.add(a),s.delete(a),n=e.getDescendants([a]),n.forEach((function(e){r.add(e)})),d=difference(d,r),offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("operation "+a+" completed with status "+t),xDashConfig.disableSchedulerProfiling||(schedulerProfilingItem.completion=Date.now(),schedulerProfilingItem.status=t,schedulerProfiling[a].push(schedulerProfilingItem))):console.log("datanode with explicitTrig ended with status ",datanodesManager.getDataNodeByName(a).status());break;default:return{initiatorNode:o,schedulingInstanceTerminated:!1}}return 0==s.size&&0==d.size&&c?{initiatorNode:o,schedulingInstanceTerminated:!0}:{initiatorNode:o,schedulingInstanceTerminated:!1}},stopAllOperations:function(){d.forEach((function(e){d.delete(e)})),s.forEach((function(e){s.delete(e),datanodesManager.getDataNodeByName(e).completeExecution("NOP"),datanodesManager.getDataNodeByName(e).statusCallback("None"),datanodesManager.getDataNodeByName(e).updateCallback(void 0,"None")}));let e=new Set;for(let a in datanodesManager.getAllDataNodes()){datanodesManager.getAllDataNodes()[a].schedulerStatus("Stop");const t=datanodesManager.getAllDataNodes()[a].getXHR();_.isUndefined(t)||e.add(t)}e.forEach((function(a){a.abort(),e.delete(a)})),null!=datanodesManager.getDataNodeByName(o).execInstance()&&datanodesManager.getDataNodeByName(o).schedulerEnd()},stopOperation:function(e){if(s.has(e)){s.delete(e),datanodesManager.getDataNodeByName(e).completeExecution("NOP"),datanodesManager.getDataNodeByName(e).statusCallback("None"),datanodesManager.getDataNodeByName(e).updateCallback(void 0,"None"),datanodesManager.getDataNodeByName(e).schedulerStatus("Stop");const a=datanodesManager.getDataNodeByName(e).getXHR();_.isUndefined(a)||a.abort()}},getInitiatorNode:function(){return o},getSchedulerCallOrigin:function(){return n},clear:function(){}}}function h(e){return!_.contains(t,e)&&"globalFirstUpdate"!==n}function N(e){if(!_.contains(t,e))return!1;switch(n){case"triggerButton":case"vignette":case"memory":case"setValue":case"setVariable":case"setFile":case"refresh":return!0;default:return!1}}function m(){var a=!0,o=!1;d.forEach((function(l){if(0!=d.size){if(_.isUndefined(datanodesManager.getDataNodeByName(l)))return offSchedLogUser||xDashConfig.disableSchedulerLog||console.log(l+" is not treated because it does not exist"),d.delete(l),void r.add(l);if(datanodesManager.getDataNodeByName(l).is_specific_exec&&!function(e){if(!_.contains(t,e))return!1;switch(n){case"unidentified":case"edit":case"setVariable":case"globalFirstUpdate":return!0;default:return!1}}(l))return console.log(l+" is a memory and will be treated at the end of schedule."),d.delete(l),e.addMemorydataNodeList(l),c.add(l),void datanodesManager.getDataNodeByName(l).completeExecution("NOP");switch(datanodesManager.getDataNodeByName(l).statusForScheduler()){case"Ready":if(datanodesManager.foundDatanode(l)){let t=D(l);datanodesManager.getDataNodeByName(l).is_specific_exec&&(t=!0),t?(d.delete(l),s.add(l),offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("operation "+l+" released"),xDashConfig.disableSchedulerProfiling||(schedulerProfilingItem={release:Date.now()}),a=h(l),o=N(l),datanodesManager.getDataNodeByName(l).updateNow(a,o,t,n)):(d.delete(l),c.add(l),"refresh"==n||"triggerButton"==n?(swal("Update is not available","Predecessors: "+function(a){let t="[";const o=e.getPredecessorsSet(a),n=union(i,f);return difference(o,n).forEach((e=>{t=t+' "'+e+'" '})),t+" ]"}(l)+' of operation "'+l+'" need to be executed first.',"info"),datanodesManager.getDataNodeByName(l).completeExecution("NOP")):"edit"==n||"unidentified"==n?(c.delete(l),s.add(l),offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("operation "+l+" released"),xDashConfig.disableSchedulerProfiling||(schedulerProfilingItem={release:Date.now()}),a=h(l),o=N(l),datanodesManager.getDataNodeByName(l).updateNow(a,o,t,n)):(offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("operation "+l+" is ready but cannot be executed because of its predecessors."),datanodesManager.getDataNodeByName(l).completeExecution("NOP")))}else{const a=Array.from(e.getSuccessors(l));offSchedLogUser||xDashConfig.disableSchedulerLog||console.log(l+" is referenced in '"+a+"' but not defined as a datanode."),datanodesManager.getDataNodeByName(l).completeExecution("NOP")}break;case"Wait":d.delete(l),c.add(l),D(l)?offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("operation "+l+" is waiting for initialization to be done."):offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("operation "+l+" cannot be executed because of its predecessors."),datanodesManager.getDataNodeByName(l).completeExecution("NOP");break;case"NotReady":case"Stop":d.delete(l),r.add(l),offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("operation "+l+" cannot not be scheduled because it needs initialization.");e.getDescendants([l]).forEach((function(e){r.add(e)})),d=difference(d,r),datanodesManager.getDataNodeByName(l).completeExecution("Error")}}else offSchedLogUser||xDashConfig.disableSchedulerLog||console.log(l+" is already treated")}))}function D(a){const t=e.getPredecessorsSet(a),o=union(i,f);return!!isSuperset(o,t)}function p(e){return!!union(i,f).has(e)}}
function DataPreviewFormat(){"undefined"==typeof execOutsideEditor?this.execOutsideEditor=!1:execOutsideEditor?this.execOutsideEditor=!0:this.execOutsideEditor=!1,this.format=function(e){var t="",i="";if("string"==typeof e){if(e.match("base64ImageDetected")){var a=e.replace("base64ImageDetected","");return this.execOutsideEditor||(i='<img src="data:image/jpeg;base64,'+a+'"/>'),e=a,{newData:a,previewData:i}}return e.match("<div>\n<style scoped>\n")?(this.execOutsideEditor||(t=e),{newData:e,previewData:t}):(this.execOutsideEditor||(t=syntaxHighlight(JSON.stringify(e,void 0,4))),{newData:e,previewData:t})}return this.execOutsideEditor||(t=syntaxHighlight(JSON.stringify(e,void 0,4))),{newData:e,previewData:t}}}
DatanodeModel=function(e,t,a,n){var o=this;function s(){_.isUndefined(o.datanodeInstance)||(_.isFunction(o.datanodeInstance.onDispose)&&o.datanodeInstance.onDispose(),o.datanodeInstance=void 0)}this.datanodeRefreshNotifications={},this.calculatedSettingScripts={},this.formulaInterpreter=new FormulaInterpreter(e,o,t,a),this.execInstance=ko.observable(null),this.dataPreviewFormat=new DataPreviewFormat,this.is_specific_exec=!1,this.name=ko.observable(),this.latestData=ko.observable(),this.beautifulString=ko.observable(),this.status=ko.observable("None"),this.last_updated=ko.observable("never"),this.last_error=ko.observable(),this.last_error_msg=ko.observable("none"),this.error=ko.observable(),this.isSchedulerStartSafe=ko.observable(!1),this.sampleTime=ko.observable(0),this.statusForScheduler=ko.observable("Ready"),this.schedulerStatus=ko.observable("Running"),this.iconType=ko.observable(),this.settings=ko.observable({}),this.settings.subscribe((function(e){if(!_.isUndefined(o.datanodeInstance)&&_.isFunction(o.datanodeInstance.onSettingsChanged)){if(!o.formulaInterpreter.updateCalculatedSettings(!0,!1,!1))return void o.error(!0);o.datanodeInstance.onSettingsChanged(e,o.status())?o.error(!1):o.error(!0)}})),this.completeExecution=function(e){const t=o.name();var a,n={};_.isUndefined(datanodesManager.getDataNodeByName(t))||"Stop"==datanodesManager.getDataNodeByName(t).schedulerStatus()&&"NOP"!==e||(a=_.isUndefined(e)?o.status():e,null!==o.execInstance()?n=o.execInstance().operationCompleted(t,a):"Error"===a?offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("scheduling is already terminated. "+t+" is ended with status = "+o.status()):(offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("statusCallback of "+t+" is called before scheduling instance created. Status = "+o.status()),n={schedulingInstanceTerminated:!1}),n.schedulingInstanceTerminated&&(null==o.execInstance()?offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("scheduling is already terminated. "+t+" is ended with status = "+o.status()):datanodesManager.getDataNodeByName(n.initiatorNode).schedulerEnd()))},this.statusCallback=function(e,t){o.status(e),"OK"==e?(o.last_error_msg("No error message"),$('[data-toggle="tooltip"]').tooltip("fixTitle")):"Pending"!==e&&"None"!==e&&"Running"!==e&&o.completeExecution(),_.isUndefined(t)||"Error"!=e||(o.last_error_msg(t),$('[data-toggle="tooltip"]').tooltip("fixTitle"))},this.statusForSchedulerCallback=function(e){o.statusForScheduler(e),"Ready"===e?(offSchedLogUser||xDashConfig.disableSchedulerLog||console.log(o.name()+" is ready now."),o.schedulerStart([o.name()],o.name(),"ReadyNow")):"NotReady"===e?(offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("initialization of "+o.name()+" is interrupted due to error."),o.status("Error"),o.updateCallback(void 0,"Error")):"Stop"===e&&(offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("initialization of "+o.name()+" need to be redone due to stop."),o.status("None"),o.updateCallback("","None"))},this.notificationCallback=function(e,t,a,n,o){xdashNotifications?xdashNotifications.manageNotification(e,t,a,o):(console.log("no notification lib was found. "),_.isUndefined(n)||_.isNull(n)||swal(n,a,e))},this.updateCallback=function(t,a){let n=o.name();const s=new Date;var i=o.dataPreviewFormat.format(t);t=i.newData,o.beautifulString(i.previewData),e.processDatanodeUpdate(n,t),o.latestData(t),o.last_updated(s.toLocaleTimeString()),"Error"!==a&&"None"!==a&&"Running"!==a&&o.completeExecution();let r=angular.element(document.body).scope().$root;r.alldatanodes=datanodesManager.getAllDataNodes(),r.safeApply(),widgetConnector.refreshDatanodeConsumers(t,o.name(),o.status(),o.last_updated())},this.type=ko.observable(),this.type.subscribe((function(e){if(s(),e in t&&_.isFunction(t[e].newInstance)){var n=t[e],i=!0;function r(){const e=o.name();return a.isNode(e)||a.addNode(e),n.newInstance(o.settings(),(function(e){if(o.datanodeInstance=e,!o.formulaInterpreter.updateCalculatedSettings(!0,!1,!1))return i=!1,!1}),o.updateCallback,o.statusCallback,o.notificationCallback,o.statusForSchedulerCallback)||(i=!1),!!i}let d=!1;_.isUndefined(n.external_scripts)||_.isUndefined(n.external_scripts[0])||""!==n.external_scripts[0]&&(d=!0),d?head.js(n.external_scripts.slice(0),r):r(),i||o.error(!0)}else swal("DataNode Plugin Error","The required '"+e+"' plugin does not exist in this Chalk'it version !","error"),o.error(!0)})),this.serialize=function(){return{name:o.name(),type:o.type(),settings:o.settings()}},this.deserialize=function(e){o.settings(e.settings),o.name(e.name),o.type(e.type),"Memory_plugin"===e.type&&(o.is_specific_exec=!0);let a="icn-";return _.isUndefined(t[e.type])?a+="json-variable":a+=t[e.type].icon_type.replace(/\.[^/.]+$/,""),o.iconType(a),o.error(),!0},this.getDataRepresentation=function(e){return new Function("data","return "+e+";").call(void 0,o.latestData())},this.schedulerStart=function(e,t,s){var i,r,d=o.name();offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("schedulerStart with sourceNodesArg:",e," and initiatorNodeArg:",t),_.isUndefined(e)?(i=[d],r=d):(i=e,r=t),_.isUndefined(s)&&(s="unidentified");let l=_fillRunningList(i);l.disconSourceNodes.forEach((function(t,o){if(a.addCurrentGraphList(l.disconSourceNodes,o),datanodesManager.foundDatanode(t[0]))if(null==datanodesManager.getDataNodeByName(t[0]).execInstance()){let e=Object.assign({},t);i=_updateSourceNodes(t,s),r=i[0],offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("new scheduler instance with sourceNodes:",i," and initiator:",r);var d=new DatanodeScheduler(a,i,e,r,s);if(currentGraph=l.disconGraphs[o],null!=currentGraph?currentGraph.forEach((function(e){if(!datanodesManager.foundDatanode(e))return text="Datanode '"+e+"' does not exist but referenced in another datanode",void(offSchedLogUser||xDashConfig.disableSchedulerLog||console.log(text));{const t=a.getMemorydataNodeList();if(t.size){const e=Array.from(t.keys()).filter((e=>currentGraph.has(e)));e.length>0&&(offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("Start schedule from memory datanodes list: "+e),a.clearMemorydataNodeList(e),datanodesManager.getDataNodeByName(e[0]).updateNow(!0,!0,!0,"memory"))}null!=datanodesManager.getDataNodeByName(e).execInstance()?offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("Instance of ",e," is already running"):(datanodesManager.getDataNodeByName(e).execInstance(d),datanodesManager.getDataNodeByName(e).schedulerStatus("Running"))}})):offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("error in building disconnected graphs"),!offSchedLogUser&&!xDashConfig.disableSchedulerLog){console.log("scheduling instance created, clkTick:"+n.getCurrentTick()+", clkTime(s):"+n.getCurrentTime());let e=datanodesManager.getDataNodeByName(i[0]).execInstance().getInitiatorNode();console.log("scheduling instance of started with "+e)}datanodesManager.getDataNodeByName(i[0]).execInstance().launchSchedule()}else if("globalFirstUpdate"===s&&0!=n.getCurrentTick())for(var c in e)offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("operation "+e[c]+", called from "+s+", is added to extraStartNodes list"),a.addExtraStartNodesList(e[c],s);else"timer"===s&&0!=n.getCurrentTick()?offSchedLogUser||xDashConfig.disableSchedulerLog||(console.log("Execution of operation "+t[0]+" is ignored at clkTick:"+n.getCurrentTick()+" because scheduling instance is not terminated yet"),console.log("Try to increase sample time of operation "+t[0])):"timer"!==s&&"globalFirstUpdate"!==s&&(offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("operation "+t[0]+", called from "+s+", is added to extraStartNodes list"),a.addExtraStartNodesList(t[0],s));else offSchedLogUser||xDashConfig.disableSchedulerLog||(text="Datanode '"+t[0]+"' does not exist but referenced in another datanode",console.log(text))}))},this.schedulerEnd=function(){o.name()!==o.execInstance().getInitiatorNode()&&(offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("scheduling instance will not be terminated by the initiator "+o.execInstance().getInitiatorNode()));const e=o.execInstance().getSchedulerCallOrigin();if(null!=o.execInstance()){const t=a.getAllDisconnectedGraphs();offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("get belonging disconnected graph (from schedulerEnd)"),graph=a.getBelongingDisconnectedGraph(o.name(),t),null!=graph&&graph.forEach((function(e){datanodesManager.foundDatanode(e)?null==datanodesManager.getDataNodeByName(e).execInstance()?offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("Instance of ",e," is already terminated"):(datanodesManager.getDataNodeByName(e).execInstance(null),datanodesManager.getDataNodeByName(e).isSchedulerStartSafe(!0)):offSchedLogUser||xDashConfig.disableSchedulerLog||(text="Datanode '"+e+"' does not exist but referenced in another datanode",console.log(text))})),offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("scheduling instance terminated by "+o.name());const n=a.getMemorydataNodeList(),s=a.getSetvarList(),i=a.getProcessedSetvarList(),r=new Map(Array.from(s).filter((([e])=>!i.has(e))));let d=!0;const l=a.getCurrentGraphList(),c=Array.from(l.keys()),g=l.get(c[0]);if(l.size&&(d=!1,g===c[0].length-1&&(d=!0)),d)if("timer"!==e&&a.clearCurrentGraphList(),r.size){offSchedLogUser||xDashConfig.disableSchedulerLog||(console.log("Start schedule from setVariable list: "+Array.from(r.keys())),console.log("triggered by : "+Array.from(r.values())));const e=Array.from(r.keys());if(a.addProcessedSetvarList(r),a.clearSetvarList(),n.size){const e=Array.from(n.keys()).filter((e=>r.has(e)));a.clearMemorydataNodeList(e)}o.schedulerStart(e,e[0],"setVariable")}else{a.clearSetvarList(),a.clearProcessedSetvarList();const e=a.getExtraStartNodesList();if(e.size){offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("Start schedule from extraStartNodesList:"+Array.from(e.keys()));const t=Array.from(e.keys()),n=e.get(t[0]);a.clearExtraStartNodesList(),o.schedulerStart(t,t[0],n)}}else offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("Problem : request for ending a scheduling instance whereas no instance exists")}},this.updateNow=function(e,t,s,i){var r=!1;if(o.sampleTime()<1&&o.sampleTime()>=.1?Math.floor(10*n.getCurrentTime())%(10*o.sampleTime())==0&&(r=!0):o.sampleTime()>=1?n.getCurrentTime()%o.sampleTime()==0&&(r=!0):0!=o.sampleTime()&&console.log("sampleTime cannot be lesser than 0.1s"),0==o.sampleTime()||r){if(!function(e,t,a){return e&&o.settings().explicitTrig?(o.completeExecution("NOP"),offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("Called from predecessor, but ExplicitTrigger of ",o.settings().name+" is true"),!1):"timer"===a&&o.settings().explicitTrig?(o.completeExecution("NOP"),offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("Called from timer, but ExplicitTrigger of ",o.settings().name+" is true"),!1):!!(_.isUndefined(o.settings().autoStart)||o.settings().autoStart||t||e||"timer"===a&&"OK"===o.status())||(o.completeExecution("NOP"),offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("AutoStart of ",o.settings().name+" is false"),!1)}(e,t,i))return;if(!_.isUndefined(o.datanodeInstance)&&_.isFunction(o.datanodeInstance.updateNow)){if(!o.formulaInterpreter.updateCalculatedSettings(!1,s,t))return void o.error(!0);if(s)if(o.formulaInterpreter.bCalculatedSettings){let e=Array.from(a.getPredecessorsSet(o.name()));var d=o.datanodeInstance.updateNow(t,e);_.isUndefined(d)||d.notTobeExecuted&&o.completeExecution("NOP")}else o.notificationCallback("info",o.settings().name,"Scheduling of this operation is interrupted because of its last error","Scheduler interruption"),o.updateCallback(void 0,"Error");else o.settings().explicitTrig&&!o.settings().autoStart||swal("Update is not available",'Predecessors of operation "'+o.settings().name+'" need to be executed first.',"info"),o.completeExecution("NOP"),o.updateCallback(void 0,"None")}}else offSchedLogUser||xDashConfig.disableSchedulerLog||console.log(o.name()+" is not executed because currentTime: "+n.getCurrentTime()+" is not multiple of sampleTime: "+o.sampleTime()),o.completeExecution("NOP")},this.dispose=function(){const e=o.name();a.removeNode(e),o.sampleTime()&&n.unregisterDatanode(e),null!=o.execInstance()&&(e!==o.execInstance().getInitiatorNode()?o.execInstance().stopOperation(e):(o.notificationCallback("info",e,"Scheduling is aborted because datanode "+e+" is part of scheduling operations","Scheduler stop"),o.execInstance().stopAllOperations())),s()},this.isSetValueValid=function(){return o.datanodeInstance.isSetValueValid()},this.isSetFileValid=function(){return o.datanodeInstance.isSetFileValid()},this.setValue=function(e,t,a){_.isFunction(o.datanodeInstance.getValue)?t!=o.datanodeInstance.getValue(e)&&setDirtyFlagSafe(!0):setDirtyFlagSafe(!0),o.datanodeInstance.setValue(e,t),a||o.schedulerStart([o.name()],o.name(),"setValue")},this.setValueSpec=function(t,a){const n=o.name();o.setValue(t,a),newData=JSON.parse(o.settings().json_var);var s=new Date,i=o.dataPreviewFormat.format(newData);newData=i.newData,o.beautifulString(i.previewData),e.processDatanodeUpdate(n,newData),o.latestData(newData),o.last_updated(s.toLocaleTimeString()),setDirtyFlagSafe(!0)},this.setFile=function(e){o.datanodeInstance.setFile(e)&&(o.schedulerStart([o.name()],o.name(),"setFile"),setDirtyFlagSafe(!0))},this.isSettingNameChanged=function(e){if(!_.isUndefined(o.datanodeInstance))return o.datanodeInstance.isSettingNameChanged(e)},this.getSavedSettings=function(){if(!_.isUndefined(o.datanodeInstance)&&_.isFunction(o.datanodeInstance.getSavedSettings))return o.datanodeInstance.getSavedSettings()},this.isSettingSampleTimeChanged=function(e){if(!_.isUndefined(o.datanodeInstance)&&_.isFunction(o.datanodeInstance.isSettingSampleTimeChanged))return o.datanodeInstance.isSettingSampleTimeChanged(e)},this.getXHR=function(){if(!_.isUndefined(o.datanodeInstance)&&_.isFunction(o.datanodeInstance.getXHR))return o.datanodeInstance.getXHR()},_fillRunningList=function(e){let t={disconSourceNodes:[],disconGraphs:[],indicesDisconGraphs:[]};const n=a.getAllDisconnectedGraphs();return e.forEach((function(e){offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("get belonging disconnected graph (from schedulerStart)"),graph=a.getBelongingDisconnectedGraph(e,n),null!=graph?t.indicesDisconGraphs.includes(graph.index)?t.disconSourceNodes[t.indicesDisconGraphs.indexOf(graph.index)].push(e):(t.indicesDisconGraphs.push(graph.index),t.disconSourceNodes.push([e]),t.disconGraphs.push(graph)):offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("error in building disconnected graphs")})),a.addCurrentGraphList(t.disconSourceNodes,0),t},_updateSourceNodes=function(e,t){let n=new Set(e);if(descendants=a.getDescendants(e),descendants.forEach((e=>{-1!==e.indexOf("pastValue_")&&descendants.delete(e)})),"setVariable"===t){let e=new Set,t=new Set;n.forEach((t=>{t.startsWith("pastValue_")||e.add(t)})),n.forEach((a=>{if(a.startsWith("pastValue_")){let n=a.substring(10);e.has(n)&&(t.add(a),t.add(n))}})),t.forEach((e=>{descendants.delete(e)}))}return new Set(Array.from(descendants).filter((e=>n.has(e)))).forEach((function(t){e.splice(e.indexOf(t),1)})),e.sort(((e,t)=>(meetsCondition_a=-1!==e.indexOf("pastValue_"),meetsCondition_b=-1!==t.indexOf("pastValue_"),meetsCondition_a&&!meetsCondition_b?-1:!meetsCondition_a&&meetsCondition_b?1:0)))}};
function DialogBox(e,c,i,n,t,o){var a,d,l=$('<div class="modalDialog modalDialogOpen" style="z-index:1000"></div>');_.isUndefined($(".code-mirror-wrapper")[0])||($(l)[0].style.zIndex=6e3),_.isUndefined($(".showSweetAlert")[0])||($(l)[0].style.zIndex=99999);var s=$('<div class="modalDialog__wrapper"></div>');function p(){$(document).unbind("keydown",h),l.fadeOut(200,(function(){$(this).remove()}))}function h(e){27===e.keyCode&&(n||r())}$(document).on("keydown",h),s.append('<div class="modalDialog__header"><h2>'+c+"</h2></div>"),$('<div class="modalDialog__content"></div>').appendTo(s).append(e);var u=$('<div class="modalDialog__footer"></div>').appendTo(s);function r(){var e=!1;_.isFunction(t)&&(e=a?t(a):d?t(d):t()),e||p()}n&&($('<input id="dialog-cancel" type="button" class="btn btn-rounded-fill cancel"  value="'+n+'"></input>').appendTo(u).click((function(){_.isFunction(o)?o():_.isUndefined(o)||(a=o),p()})),_.isUndefined(o)||_.isFunction(o)||(d=o)),i&&$('<input id="dialog-ok" type="button" class="btn btn-rounded-fill primary" value="'+i+'"></input>').appendTo(u).click(r),l.append(s),$("body").append(l),l.fadeIn(200)}function DialogBoxForToolboxEdit(e,c,i,n,t){DialogBox(e,c,i,n,t)}function DialogBoxForData(e,c,i,n,t){DialogBox(e,c,i,n,t),_.isUndefined($("#check-all"))||($("#check-all").click((function(e){this.checked&&($(".check-option1").each((function(){this.checked=!0})),$("#uncheck-all")[0].checked=!1)})),$("#uncheck-all").click((function(e){this.checked&&($(".check-option1").each((function(){this.checked=!1})),$("#check-all")[0].checked=!1)})),$(".check-option1").click((function(){$("#check-all")[0].checked=!1,$("#uncheck-all")[0].checked=!1})))}function DialogBoxForDuplicateData(e,c,i,n,t){if(DialogBoxForData(e,c,i,n,t),!_.isUndefined($(".data-check-input")[0])){$(".data-check-input").each((function(){$(".data-check-input").on("change paste input",(function(e){for(var c=this.id.substring(this.id.length-1,this.id.length),i=!1,n=0;n<datanodesManager.getAllDataNodes().length;n++)if(datanodesManager.getAllDataNodes()[n].name()==this.value){i=!0;break}i?($("#data-overwrite-"+c)[0].checked=!0,$("#data-checkbox-"+c)[0].checked=!1):($("#data-rename-"+c)[0].checked=!0,$("#data-checkbox-"+c)[0].checked=!0)}))}))}}function copyURLtoClipboard(){document.getElementById("swal-input").select(),document.execCommand("copy"),$("#swal-p")[0].style.visibility="visible",setTimeout((function(){$("#swal-p")[0].style.visibility="hidden"}),1500)}function DialogBoxForHtmlExport(e,c,i,n,t,o){DialogBox(e,c,i,n,t,o),_.isUndefined(o)?($("#select-export-settings")[0].value=htmlExport.exportOptions,$("#check-scale-export")[0].checked=htmlExport.checkExportOptions):($("#select-export-settings")[0].value=o[0].exportOptions,$("#check-scale-export")[0].checked=o[0].checkExportOptions,$("#check-scale-export").attr("disabled",!0))}
PluginEditor=function(jsEditor){function _displayValidationError(e,t){var n,i=$('<div class="validation--error"></div>').html(t);_.isUndefined($("#setting-value-container-data_path")[0])||(n=$("#setting-value-container-data_path")[0].childNodes[$("#setting-value-container-data_path")[0].childNodes.length-1]),"data_path"==e&&(_.isUndefined(n)||(n.style.display="table-cell"),i[0].style.display="table-cell",i[0].style.height="25px"),"name"!=e&&"url"!=e||(_.isUndefined(n)||(n.style.display=""),i[0].style.display=""),$("#setting-value-container-"+e).append(i)}function _isNumerical(e){return!isNaN(parseFloat(e))&&isFinite(e)}function _appendCalculatedSettingRow(e,t,n,i,a,s){var l=$('<textarea autocorrect="off" autocomplete="off" spellcheck="false" class="calculated-value-input" style="display:none; width:78%"></textarea>');n.multi_input?l.change((function(){var i=[];$(e).find("textarea").each((function(){var e=$(this).val();e&&(i=i.concat(e))})),t.settings[n.name]=i})):l.change((function(){t.settings[n.name]=$(this).val()})),i&&l.val(i);var r=$('<div class="codemirror-wrapper__top"></div>'),o=$('<div class="calculated-setting-row codemirror-wrapper"></div>');o.append(r);var d=jsEditor.displayMiniJSEditor(o,l.val(),t,(function(e){l.val(e),l.change()}));o.append(l);var c=$('<a>Full Screen view<i class="basic icn-full-screen""></i></a>').mousedown((function(e){e.preventDefault(),jsEditor.displayJSEditor(l.val(),t,n,s,(function(e){d.setValue(e),l.val(e),l.change()}))}));if(r.append(c),a){var u=$('<li class="remove-setting-row"><i class="icon-minus icon"></i><label></label></li>').mousedown((function(t){t.preventDefault(),o.remove(),$(e).find("textarea:first").change()}));r.prepend(u)}$(e).append(o),_.isUndefined(n.description1)||$(e).append($('<div class="setting-description" style="display:block;">'+n.description1+"</div>"))}function saveSettings(e,t,n){$(".validation--error").remove(),newSettings=t;for(var i=0;i<e.settings.length;i++){var a=e.settings[i];if(a.required&&(_.isUndefined(newSettings.settings[a.name])||""==newSettings.settings[a.name]))return _displayValidationError(a.name,"This is required."),!0;if("integer"==a.type&&newSettings.settings[a.name]%1!=0)return _displayValidationError(a.name,"Must be a whole number."),!0;if("number"==a.type&&!_isNumerical(newSettings.settings[a.name]))return _displayValidationError(a.name,"Must be a number."),!0;if("text"==a.type&&"name"==a.name){if(-1!==newSettings.settings[a.name].indexOf("\\"))return _displayValidationError(a.name,"Backslash '\\' is forbidden."),!0;if((-1!==newSettings.settings[a.name].indexOf("pastValue_")||-1!==newSettings.settings[a.name].indexOf("past."))&&"Memory_plugin"!==newSettings.type)return _displayValidationError(a.name,"'pastValue_' is forbidden. It is dedicated to memory dataNode."),!0}}if("JSON_var_plugin"==newSettings.type){datanodesManager.getJsonEd().updateVal()}return"Map_matching_from_datanode"!=newSettings.type||navigator.onLine?_.isFunction(n)?!1!==n(newSettings):void 0:(swal("Need internet connection for '"+newSettings.settings.name+"'","Please verify your connection then reload the page","error"),!1)}var newSettings={type:"",iconType:"",settings:{}};function createPluginEditor(pluginTypes,currentTypeName,currentSettingsValues,flag){function createSettingRow(e,t){let n=$('<div id="setting-row-'+e+'" class="form-row"></div>').appendTo("#data-form-content");return n.append('<div class="form-label"><label class="control-label">'+t+"</label></div>"),$('<div id="setting-value-container-'+e+'" class="form-value"></div>').appendTo(n)}function removeRows(){let e=$("#data-form-content")[0];for(;e.firstChild;)e.removeChild(e.firstChild)}function typeSelectChange(e){(newSettings.type=e,newSettings.settings={},$(".input-wrapper-current").remove(),selectedType=pluginTypes[e],newSettings.iconType=selectedType.icon_type,_.isUndefined(selectedType))||(angular.element(document.body).scope().$root.dataNodeDescription=selectedType.description,_.isUndefined(selectedType.preFillBody)?createSettingsFromDefinition(selectedType.settings,selectedType.typeahead_source,selectedType.typeahead_data_segment):createSettingsFromDefinition(selectedType.settings,selectedType.typeahead_source,selectedType.typeahead_data_segment,selectedType.preFillBody))}var selectedType;if(newSettings={type:currentTypeName,iconType:"",settings:{}},_.isUndefined(flag)){for(var labels=[{name:"JSON",searchString:["Variable"]},{name:"Python",searchString:["Pyodide"]},{name:"JavaScript",searchString:["client-side"]},{name:"APIs",searchString:["REST"]},{name:"Files",searchString:["Generic","CSV file","Unzip"]},{name:"Streams & Real-time",searchString:["Clock","Delay","Memory","WebSocket","MQTT","Geoloc"]},{name:"Others",searchString:""}],typeOptGp=[],i=0;i<labels.length;i++)typeOptGp[labels[i].name]=[];if(_.each(pluginTypes,(function(e){let t=labels.length-1;for(let i=0;i<labels.length;i++){var n=!1;for(let a=0;a<labels[i].searchString.length;a++)if(-1!=e.display_name.search(labels[i].searchString[a])){t=i,n=!0;break}if(n)break}typeOptGp[labels[t].name].push({name:e.display_name,type:e.type_name})})),1==$("#datanode-list")[0].childNodes.length){$("#datanode-list")[0].innerHTML="",$('<div class="panel--content--top"><h1>New</h1><button ng-click="editorView.newDatanodePanel.view=!editorView.newDatanodePanel.view" class="btn btn-icon-only"><i class="basic icn-miniarrowleft"></i></button></div>').appendTo($("#datanode-list"));for(let e=0;e<labels.length;e++)if(typeOptGp[labels[e].name].length>0){var datanodeWrap=$('<div class="add__new__datanode--list--wrap"></div>').appendTo($("#datanode-list"));$("<span>"+labels[e].name+"</span>").appendTo(datanodeWrap);let t=$("<ul></ul>").appendTo(datanodeWrap);for(let n=0;n<typeOptGp[labels[e].name].length;n++)a=$('<a title="Open '+labels[e].name+" : "+typeOptGp[labels[e].name][n].name+' dataNode" ng-click="openDataNodeTypePlugin(\''+typeOptGp[labels[e].name][n].type+"')\"></a>").appendTo($("<li></li>").appendTo(t)),a.text(typeOptGp[labels[e].name][n].name),$('<i class="basic icn-miniarrowright"></i>').appendTo(a)}let e=angular.element(document.body),t=e.scope().$root;t.myDataNodeHTML=$("#datanode-list").html()}}else typeSelectChange(flag);function createSettingsFromDefinition(settingsDefs,typeaheadSource,typeaheadDataSegment,preFillBody){removeRows(),_.each(settingsDefs,(function(settingDef){!_.isUndefined(settingDef.default_value)&&_.isUndefined(currentSettingsValues[settingDef.name])&&(currentSettingsValues[settingDef.name]=settingDef.default_value),"body"==settingDef.name&&1==currentSettingsValues.bodyPrefill&&(_.isUndefined(settingDef.default_value)?currentSettingsValues[settingDef.name]="":""===currentSettingsValues[settingDef.name]&&(currentSettingsValues[settingDef.name]=settingDef.default_value));var displayName=settingDef.name,valueCell;switch(_.isUndefined(settingDef.display_name)||(displayName=settingDef.display_name),valueCell=createSettingRow(settingDef.name,displayName),settingDef.type){case"array":{var containerDiv=$('<div style="display:inline-table"></div>').appendTo(valueCell),subTableDiv=$('<div class="form-table-value-subtable" style="width:80%"></div>').appendTo(containerDiv),subTable=$('<table class="sub-table"></table>').appendTo(subTableDiv),subTableHead=$("<thead></thead>").hide().appendTo(subTable),subTableHeadRow=$("<tr></tr>").appendTo(subTableHead),subTableBody=$("<tbody></tbody>").appendTo(subTable),currentSubSettingValues=[];function processHeaderVisibility(){newSettings.settings[settingDef.name].length>0?subTableHead.show():subTableHead.hide()}function createSubsettingRow(e){var t=$("<tr></tr>").appendTo(subTableBody),n={},i=!1;_.isArray(newSettings.settings[settingDef.name])||(newSettings.settings[settingDef.name]=[],i=!0);var a=2*newSettings.settings[settingDef.name].length;newSettings.settings[settingDef.name].push(n),_.each(settingDef.settings,(function(s){var l=$("<td></td>").appendTo(t),r="";_.isUndefined(e[s.name])||(r=e[s.name]),n[s.name]=r;var o="table-row-value-"+settingDef.name+a;$("<input id="+o+' class="table--row-value" type="text">').appendTo(l).val(r).change((function(){n[s.name]=$(this).val()})),i&&$("input#"+o)[0].setAttribute("readonly","readonly"),a++})),i?t.append($('<td class="table-row-operation"></td>').append($('<ul class="board-toolbar"></ul>').append($("<li></li>").append($('<i class=" icon"></i>'))))):t.append($('<td class="table-row-operation"></td>').append($('<ul class="board-toolbar"></ul>').append($("<li></li>").append($('<i class="icon-trash icon"></i>').click((function(){var e=newSettings.settings[settingDef.name].indexOf(n);-1!=e&&(newSettings.settings[settingDef.name].splice(e,1),t.remove(),processHeaderVisibility())})))))),subTableDiv.scrollTop(subTableDiv[0].scrollHeight),processHeaderVisibility()}if(_.each(settingDef.settings,(function(e){var t=e.name;_.isUndefined(e.display_name)||(t=e.display_name),$("<th>"+t+"</th>").appendTo(subTableHeadRow)})),settingDef.name in currentSettingsValues&&(currentSubSettingValues=currentSettingsValues[settingDef.name]),$('<label class="board-toolbar datasource-input-suffix"><i class="fa-plus fa"></i>ADD</label>').appendTo(containerDiv).click((function(){var e={};_.each(settingDef.settings,(function(t){e[t.name]=""})),createSubsettingRow(e)})),_.each(currentSubSettingValues,(function(e,t){createSubsettingRow(e)})),0==currentSubSettingValues.length){var newSubsettingValue={};_.each(settingDef.settings,(function(e){newSubsettingValue[e.name]=""})),newSettings.settings.req_data_type="none",$("select#select-option-req_data_type")[0].value="none",createSubsettingRow(newSubsettingValue)}break}case"boolean":{newSettings.settings[settingDef.name]=currentSettingsValues[settingDef.name];let e=$("<div></div>").appendTo(valueCell);var onOffSwitch=$('<div class="onoffswitch" style="display:inline-block"><label class="onoffswitch-label" for="'+settingDef.name+'-onoff"><div class="onoffswitch-inner"><span class="on">YES</span><span class="off">NO</span></div><div class="onoffswitch-switch"></div></label></div>').appendTo(e),input=$('<input type="checkbox" name="onoffswitch" class="onoffswitch-checkbox" id="'+settingDef.name+'-onoff">').prependTo(onOffSwitch).change((function(){newSettings.settings[settingDef.name]=this.checked}));settingDef.name in currentSettingsValues&&input.prop("checked",currentSettingsValues[settingDef.name]);break}case"browseText":newSettings.settings[settingDef.name]=currentSettingsValues[settingDef.name],newSettings.settings.content=currentSettingsValues.content;var input=$('<input type="text" id="select_file_path" style="float:left"></input><input type="file" style="display: none" id="select_file"></input><label class="board-toolbar datasource-input-suffix"><i class="fa-folder-open fa"></i>Browse...</label>');if(input.mousedown((function(e){e.preventDefault(),$("#select_file").change((function(e){var t=this.value,n=Path2FileName(t);$("#select_file_path").val(n);var i=new FileReader;i.addEventListener("load",(function(e){var t=e.target;text=t.result,newSettings.settings.content=text})),i.readAsText(e.target.files[0])})),$("#select_file").trigger("click")})),input.appendTo(valueCell).change((function(){newSettings.settings[settingDef.name]=Path2FileName($(this).val())})),settingDef.name in currentSettingsValues){var fakeFilePath=currentSettingsValues[settingDef.name],fileName=Path2FileName(fakeFilePath);$("#select_file_path").val(fileName)}break;case"browseBinary":newSettings.settings[settingDef.name]=currentSettingsValues[settingDef.name],newSettings.settings.content=currentSettingsValues.content;var input=$('<input type="text" id="select_file_path" style="float:left"></input><input type="file" style="display: none" id="select_file"></input><label class="board-toolbar datasource-input-suffix"><i class="fa-folder-open fa"></i>Browse...</label>');if(input.mousedown((function(e){e.preventDefault(),$("#select_file").change((function(e){var t=this.value,n=Path2FileName(t);$("#select_file_path").val(n);var i=new FileReader;i.addEventListener("load",(function(e){const t=e.target.result;newSettings.settings.content=btoa([].reduce.call(new Uint8Array(t),(function(e,t){return e+String.fromCharCode(t)}),""))})),i.readAsArrayBuffer(e.target.files[0])})),$("#select_file").trigger("click")})),input.appendTo(valueCell).change((function(){newSettings.settings[settingDef.name]=Path2FileName($(this).val())})),settingDef.name in currentSettingsValues){var fakeFilePath=currentSettingsValues[settingDef.name],fileName=Path2FileName(fakeFilePath);$("#select_file_path").val(fileName)}break;case"unzip":newSettings.settings[settingDef.name]=currentSettingsValues[settingDef.name],newSettings.settings.content=currentSettingsValues.content;var input=$('<input type="text" id="select_file_path" style="float:left"></input><input type="file" style="display: none" id="select_file" accept="application/x-zip-compressed"></input><label class="board-toolbar datasource-input-suffix"><i class="fa-folder-open fa"></i>Browse...</label>');if(input.mousedown((function(event){event.preventDefault(),$("#select_file").change((async function(event){const freeboardUIInst=new FreeboardUI,file=event.target.files[0],fileSize=file.size;let fileSizeFormat="";fileSizeFormat=fileSize<1024?`${fileSize} bytes`:fileSize<1048576?`${(fileSize/1024).toFixed(1)} KB`:`${(fileSize/1048576).toFixed(1)} MB`;const result={type:file.type,size:fileSizeFormat,name:file.name,content:""},fileExtension=file.name.split(".").pop(),extensionsText=["txt","json","xprjson","xml","svg","html","css","js","ts","md","csv"],fileTypes=["","application/json"],zipContent=[];fileExtension&&fileTypes.includes(result.type)&&(result.type=fileExtension);try{freeboardUIInst.showLoadingIndicator(!0);const zip=await JSZip.loadAsync(file);for(const relativePath in zip.files){const zipEntry=zip.files[relativePath],isDir=zipEntry.dir;if(isDir)continue;const fileExtension=relativePath.split(".").pop(),fileSize=zipEntry._data.uncompressedSize;if(!(fileSize>73400320))if(fileExtension&&extensionsText.includes(fileExtension)){const fileData=await zipEntry.async("string");zipContent.push({name:relativePath,content:["json","xprjson"].includes(fileExtension)?JSON.parse(JSON.stringify(eval("("+fileData+")")),null,2):fileData})}else{const e=await zipEntry.async("uint8array");zipContent.push({name:relativePath,content:btoa([].reduce.call(new Uint8Array(e),((e,t)=>e+String.fromCharCode(t)),""))})}}result.content=zipContent}catch(e){const t=new PNotify({title:"Unzip file",text:"Error reading "+file.name+": "+e,type:"error",styling:"bootstrap3"});$(".ui-pnotify-container").on("click",(()=>t.remove())),console.error("Error reading "+file.name+": "+e)}finally{freeboardUIInst.showLoadingIndicator(!1)}newSettings.settings.content=result;const fakeFilePath=this.value,fileName=Path2FileName(fakeFilePath);$("#select_file_path").val(fileName)})),$("#select_file").trigger("click")})),input.appendTo(valueCell).change((function(){newSettings.settings[settingDef.name]=Path2FileName($(this).val())})),settingDef.name in currentSettingsValues){var fakeFilePath=currentSettingsValues[settingDef.name],fileName=Path2FileName(fakeFilePath);$("#select_file_path").val(fileName)}break;case"json":if(newSettings.settings[settingDef.name]=currentSettingsValues[settingDef.name],newSettings.settings.content=currentSettingsValues.content,_.isUndefined($("#var-body")[0])){var input=$('<input type="text" title="'+settingDef.display_name+'" class="input__wrapper--text" id="var-body" autocorrect="off" autocomplete="off" spellcheck="false" />');if(input.appendTo(valueCell).change((function(){if(newSettings.settings[settingDef.name]=$(this).val(),!settingDef.short_display){let e=datanodesManager.getJsonEditor();datanodesManager.getJsonEd().updateEditor(e,$(this).val())}})),!settingDef.short_display){$('<div class="btn-wrapper btn-wrapper--no-label input-wrapper-current" id="btn-json">').appendTo($("#data-form-content")),$('<div class="tree__preview__container input-wrapper-current" style="height:unset"><div id="full-screen-json" class="tree__preview__container--top"><a><p>Full Screen view</p><i class="basic icn-full-screen"></i></a></div><div id="tree-preview" style="height: 36vh;"></div></div>').appendTo($("#data-form-content")),$("#full-screen-json").on("click",(function(){var e=document.getElementById("tree-preview");e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen()}));var json=datanodesManager.getJsonEd();json.displayJSONEdit(input.val(),(function(e){input.val(e),input.change()}))}}if(settingDef.name in currentSettingsValues&&($("#var-body").val(currentSettingsValues[settingDef.name]),!settingDef.short_display)){let t=datanodesManager.getJsonEditor(),n=datanodesManager.getJsonEd();n.updateEditor(t,currentSettingsValues[settingDef.name])}break;case"option":var defaultValue=currentSettingsValues[settingDef.name],selectId="select-option-"+settingDef.name,input=$('<select id="'+selectId+'"></select>').appendTo($('<div class="styled-select"></div>').appendTo(valueCell)).change((function(){newSettings.settings[settingDef.name]=$(this).val(),_.isUndefined($("#value-dn_name")[0])||(newSettings.settings.name="pastValue_"+$(this).val(),$("#value-dn_name")[0].value="pastValue_"+$(this).val()),("FMI_webservice"===settingDef.name&&newSettings.settings.bodyPrefill||"req_data_type"===settingDef.name)&&preFillBody()}));if(settingDef.from_datanode){let a=datanodesManager.getAllDataNodes();a.length&&(a=a.filter((e=>"Memory_plugin"!==e.type())),a.sort(((e,t)=>e.name().localeCompare(t.name()))),a.some((e=>e.name()===defaultValue))||(defaultValue=void 0),_.each(a,(function(e){let t=e.name(),n=e.name();_.isUndefined(defaultValue)&&(defaultValue=n),$("<option></option>").text(t).attr("value",n).appendTo(input)})),_.isUndefined($("#value-dn_name")[0])||(newSettings.settings.name="pastValue_"+defaultValue,$("#value-dn_name")[0].value="pastValue_"+defaultValue))}else _.each(settingDef.options,(function(e){let t,n;_.isObject(e)?(t=e.name,n=e.value):t=e,_.isUndefined(n)&&(n=t),_.isUndefined(defaultValue)&&(defaultValue=n),$("<option></option>").text(t).attr("value",n).appendTo(input)}));newSettings.settings[settingDef.name]=defaultValue,settingDef.name in currentSettingsValues&&input.val(currentSettingsValues[settingDef.name]);break;case"custom1":case"custom2":newSettings.settings[settingDef.name]=currentSettingsValues[settingDef.name],settingDef.implementation(valueCell,settingDef,currentSettingsValues,newSettings);break;default:var input;if(newSettings.settings[settingDef.name]=currentSettingsValues[settingDef.name],"calculated"==settingDef.type){if(settingDef.name in currentSettingsValues){var currentValue=currentSettingsValues[settingDef.name];if(settingDef.multi_input&&_.isArray(currentValue))for(var includeRemove=!1,i=0;i<currentValue.length;i++)_appendCalculatedSettingRow(valueCell,newSettings,settingDef,currentValue[i],includeRemove),includeRemove=!0;else _appendCalculatedSettingRow(valueCell,newSettings,settingDef,currentValue,!1)}else _appendCalculatedSettingRow(valueCell,newSettings,settingDef,null,!1);if(settingDef.multi_input){var inputAdder=$('<ul class="board-toolbar"><li class="add-setting-row"><i class="fa-plus fa"></i><label>ADD</label></li></ul>').mousedown((function(e){e.preventDefault(),_appendCalculatedSettingRow(valueCell,newSettings,settingDef,null,!0)}));$(valueCell).siblings(".form-label").append(inputAdder)}}else{let s="";if(s=settingDef.disabled&&"Generated memory name"===settingDef.display_name?'<input type="text" id="value-dn_name" title="'+settingDef.display_name+'" class="input__wrapper--text disabled" disabled />':'<input type="text" title="'+settingDef.display_name+'" class="input__wrapper--text" />',input=$(s).appendTo(valueCell).change((function(){if("name"==settingDef.name&&($('<input type="text">')[0].maxLength=40),"number"==settingDef.type)newSettings.settings[settingDef.name]=Number($(this).val());else{var e=!1,t="";for(var t in widgetConnector.widgetsConnection){for(var n in widgetConnector.widgetsConnection[t].sliders)if("None"!=widgetConnector.widgetsConnection[t].sliders[n].name&&!_.isUndefined(widgetConnector.widgetsConnection[t].sliders[n].connectedDataNodeS)&&widgetConnector.widgetsConnection[t].sliders[n].connectedDataNodeS===newSettings.settings[settingDef.name]){e=!0;break}if(e)break}e&&swal("'"+newSettings.settings[settingDef.name]+"' is now missing","Connections with widget '"+widgetConnector.widgetsConnection[t].modelJsonId+"' may be removed!","warning"),newSettings.settings[settingDef.name]=$(this).val()}})),settingDef.name in currentSettingsValues&&input.val(currentSettingsValues[settingDef.name]),typeaheadSource&&settingDef.typeahead_data_field&&input.addClass("typeahead_data_field-"+settingDef.typeahead_data_field),typeaheadSource&&settingDef.typeahead_field){var typeaheadValues=[];input.keyup((function(e){e.which>=65&&e.which<=91&&input.trigger("change")})),$(input).autocomplete({source:typeaheadValues,select:function(e,t){input.val(t.item.value),input.trigger("change")}}),input.change((function(e){var t=input.val(),n=_.template(typeaheadSource)({input:t});$.get(n,(function(e){if(typeaheadDataSegment&&(e=e[typeaheadDataSegment]),e=_.select(e,(function(e){return e[settingDef.typeahead_field][0]==t[0]})),typeaheadValues=_.map(e,(function(e){return e[settingDef.typeahead_field]})),$(input).autocomplete("option","source",typeaheadValues),1==e.length)for(var n in e=e[0])if(e.hasOwnProperty(n)){var i=$(_.template("input.typeahead_data_field-<%= field %>")({field:n}));i&&(i.val(e[n]),i.val()!=input.val()&&i.trigger("change"))}}))}))}}}_.isUndefined(settingDef.suffix)||valueCell.append($('<div class="input--suffix">'+settingDef.suffix+"</div>")),_.isUndefined(settingDef.description)||valueCell.append($('<div class="setting-description">'+settingDef.description+"</div>"))}))}}return{createPluginEditor:function(e,t,n,i){createPluginEditor(e,t,n,i)},getNewSettings:function(){return newSettings},saveSettings:function(e,t,n){return saveSettings(e,t,n)}}};
JSONEdit=function(){var e,o="code";return{displayJSONEdit:function(t,n){$('<button class = "btn btn-rounded" onclick="var json = datanodesManager.getJsonEd();json.loadJSON()"> <i class = "basic icn-upload"></i>Import Json</button>').appendTo($("#btn-json")),$('<button class = "btn btn-rounded" onclick="var json = datanodesManager.getJsonEd();json.saveJSON()"> <i class = "basic icn-download"></i>Export Json</button>').appendTo($("#btn-json")),$('<div id="jsonedit"style="height:100%"></div>').appendTo($("#tree-preview")),function(t,n){function r(){var o={};try{o=e.get();var t=JSON.stringify(o);n(t)}catch(e){return void swal("Error",e.message,"error")}}var a=$("#jsonedit");$("#jsonedit")[0].innerHTML="";var s={mode:"code",modes:["code","tree"],onError:function(e){swal("Error",e.toString(),"error")},onModeChange:function(e,t){"tree"==e?($("#var-body").prop("disabled",!0),$("#jsonedit").off("focusout"),o="tree"):"code"==e&&($("#var-body").prop("disabled",!1),$("#jsonedit").on("focusout",r),o="code")},language:"en"};e=new JSONEditor(a[0],s),datanodesManager.setJsonEditor(e);try{t&&e.set(JSON.parse(t))}catch(e){swal("JSON Parse error",e.message,"error")}$("#jsonedit").on("focusout",r)}(t,n)},loadJSON:function(){if(e=datanodesManager.getJsonEditor(),window.File&&window.FileReader&&window.FileList&&window.Blob){var o=document.createElement("input");o.type="file",o.setAttribute("accept",".json"),$(o).on("change",(function(o){var t=o.target.files;if(t&&t.length>0){var n=t[0],r=new FileReader;r.addEventListener("load",(function(o){try{e.setText(o.target.result);var t=e.get(),n=JSON.stringify(t);$("#var-body").val(n),$("#var-body").change()}catch(e){swal("JSON Parse error",e.message,"error")}})),r.readAsText(n)}})),$(o).trigger("click")}else swal("Unable to load a file in this browser.","","error")},saveJSON:function(){e=datanodesManager.getJsonEditor(),swal({title:"Export JSON",text:"Save as ...",type:"input",showConfirmButton:!1,showConfirmButton1:!0,showCancelButton:!0,confirmButtonText:"Save",closeOnConfirm:!1,closeOnConfirm1:!1,inputPlaceholder:"please write JSON file name here ..."},(function(o){if(!1===o)return!1;if(""===o)return swal.showInputError("JSON file name is required!"),!1;if(null!=o){var t=o;-1==t.indexOf(".")?t+=".json":"json"==t.split(".").pop().toLowerCase()||(t=t.split(".")[0]+".json");var n=new Blob([e.getText()],{type:"application/json;charset=utf-8"});saveAs(n,t),swal.close()}}))},getJsonEd:function(){return e},updateEditor:function(e,o){datanodesManager.setJsonEditor(e);try{o&&e.set(JSON.parse(o))}catch(e){swal("JSON Parse error",e.message,"error")}},updateVal:function(){if("tree"==o){var t=e.get(),n=JSON.stringify(t);$("#var-body").val(n),$("#var-body").change()}}}};
JSEditor=function(){function e(e){e}function t(e,t,o,n,i){var a=t.settings.name,d="";"JSON_formula_plugin"===t.type?d='// Example: Convert temp from C to F and truncate to 2 decimal places.\n// return (dataNodes["MyDataNode"].sensor.tempInF * 1.8 + 32).toFixed(2);\n':"Python_inline_plugin"===t.type&&(d="#example: create 2 datanodes py_a a,d py_b then use them as follow:\n#return {'a':dataNodes[\"py_a\"],'b':dataNodes[\"py_b\"]}; \n#simple example:\nreturn {'key':'value'}; \n "),e||(e=d);var r=$('<div id="code-window-js" class="code-window cancel__box cancel__box--xl"></div>'),c=$('<div class="code-mirror-wrapper" id="codeWrapper"></div>'),s=$('<div class="cancel__box__bottom"></div>'),l=$('<div class="cancel__box__body"></div>'),p=$('<div class="cancel__box__top"><div class="code-window-header cm-s-ambiance"><span>This javaScript code will be re-evaluated any time this dataNode is updated, and the value you <code><span class="cm-keyword">return</span></code> will update the workspace. You can assume this code is wrapped in a function of the form <code><span class="cm-keyword">function</span>(<span class="cm-def">dataNodes</span>)</code> where dataNodes is a collection of javaScript objects (keyed by their name) defining the workspace. <br>Press <code><span class="cm-keyword">ctrl-space</span></code> to activate dataNodes autocompletion, <code><span class="cm-keyword">Tab</span></code> to go deeper into JSON and <code><span class="cm-keyword">Escape</span></code> to leave it.<br>Press <code><span class="cm-keyword">ctrl-K</span></code> to autoformat (beautify) selection. </span><br>To debug this script effectively, insert the keyword <code><span class="cm-keyword">debugger</span></code> at the points where you want to set breakpoints. Then, open the <code><span class="cm-def">DevTools</span></code> during script execution to pause and inspect the code at those breakpoints.</div></div>'),g=$('<div class="cancel__box__container"></div>');l.append([c]),g.append([p,l,s]),r.append([g]);var u=$('<div id="codeWindowContainer" class="cancel__container open"></div>');u.append($('<div class="cancel__overlay"></div>')),u.append(r),$("body").append(u);var h=[],m=checkES6(),w=checkES7(),v=checkES8(),C=checkES9(),f=checkES10(),b=5;function y(){E.operation((function(){for(var e=0;e<h.length;++e)E.removeLineWidget(h[e]);h.length=0;var t="/*jshint esversion:"+b+"*/\n"+E.getValue();JSHINT(t);for(e=0;e<JSHINT.errors.length;++e){var o=JSHINT.errors[e];if(o){var n=document.createElement("div"),i=n.appendChild(document.createElement("span"));i.innerHTML="!!",i.className="lint-error-icon",n.appendChild(document.createTextNode(o.reason)),n.className="lint-error",h.push(E.addLineWidget(o.line-1,n,{coverGutter:!1,noHScroll:!0}))}}JSHINT.errors.length&&E.focus()}));var e=E.getScrollInfo(),t=E.charCoords({line:E.getCursor().line+1,ch:0},"local").top;e.top+e.clientHeight<t&&E.scrollTo(null,t-e.clientHeight+3)}function S(e,t){t.pick(),e.execCommand("autocomplete")}m&&(b=6),w&&(b=7),v&&(b=8),C&&(b=9),f&&(b=10);var N,k=datanodesManager.getAllDataNodes().sort(((e,t)=>e.name().localeCompare(t.name()))),x=CodeMirror(c.get(0),{value:e,mode:{name:"javascript",globalVars:!0},theme:"eclipse",indentUnit:4,lineNumbers:!0,matchBrackets:!0,autoCloseBrackets:!0,lineWrapping:!0,showCursorWhenSelecting:!0,extraKeys:{"Ctrl-Space":"autocomplete","Alt-C":e=>e.toggleComment(),"Ctrl-K":e=>e.autoFormatRange(e.getCursor(!0),e.getCursor(!1))},hintOptions:{hint:JSEditorCompletion.createCompletionFct(k),completeSingle:!1,extraKeys:{Tab:S,Right:S,Left:function(e,t){const o=e.getCursor(),n=o.line,i=e.getLine(n),a=o.ch,d=JSEditorCompletion.getPrecedingPathLength(i,a);d&&(e.replaceRange("",CodeMirror.Pos(n,a-d),CodeMirror.Pos(n,a)),t.close(),e.execCommand("autocomplete"))}}}}),E=x.doc.cm;if(E.on("change",(function(){clearTimeout(N),N=setTimeout(y,500)})),setTimeout(y,100),[bFoundConnection,prop]=datanodesManager.isConnectedWithWidgt(a),bFoundConnection){var T='<div style="display: table-cell; padding: 10px"><span>Connected widget(s): </span></div>';_.each(prop,(e=>{T=T+'<div style="display: table-cell; padding: 10px"><input type="radio" id="'+e+'_radio" name="dataWidgetRadio" value="'+e+'" onchange="datanodesManager.previewWidget(this.value)"><label for="'+e+'_radio">'+e+"</label></div>"}));var j=$('<button id="dialog-widget" class="btn btn-rounded-fill primary" js-reset-toggle="">Show widget</button>').click((function(){if("Show widget"==$("#dialog-widget").text()){$("#code-window-js").width("80%"),$("#dialog-widget").text("Hide widget");var e="";_.each(prop,(t=>{e=e+'<div id="widget-preview-zone-'+t+'" style="background-color:white; border:1px dashed rgba(0, 0, 0, 0.5)" ></div>'}));var t=$('<div id="code-widget-window-js"  style="width: 49%;float: right;z-index:5000;overflow:auto;height:100%"><div id="widgets-selection-header" class="code-window-header cm-s-ambiance" style="position:relative"><div style="display: table-row">'+T+'</div></div><div id="widgets-preview-top" class="code-widget-window-preview"> '+e+"</div></div>");c.append(t),$("#"+prop[0]+"_radio").prop("checked",!0);_.each(prop,(e=>{!function(e){var t=[];$("#widgets-preview-top > div").each(((e,o)=>{t.push(o.id),$("#"+o.id).hide()})),$("#widget-preview-zone-"+e).show();var o=Math.min($("#"+e).height(),$("#code-widget-window-js").height()-40-$("#widgets-selection-header").height()),n=Math.min($("#"+e).width(),$("#code-widget-window-js").width()-40);$("#widget-preview-zone-"+e).width(n),$("#widget-preview-zone-"+e).height(o);var i=e.substring(0,e.length-1),a=widgetsPluginsHandler.copyWidget("widget-preview-zone-"+e,i,null,e,!0);null!=widgetConnector.widgetsConnection[e]&&(widgetConnector.widgetsConnection[e].widgetObjEdit=null,widgetConnector.widgetsConnection[e].widgetObjConnect=a)}(e)}));var o=prop[0];datanodesManager.previewWidget(o),$(".code-mirror-wrapper")[0].childNodes[0].style.float="left",$(".code-mirror-wrapper")[0].childNodes[0].style.width="50%"}else $("#dialog-widget").text("Show widget"),_.each(prop,(e=>{null!=widgetConnector.widgetsConnection[e]&&(widgetConnector.widgetsConnection[e].widgetObjEdit=null,widgetConnector.widgetsConnection[e].widgetObjConnect=null)})),$("#code-widget-window-js").remove(),$("#code-window-js").width("80%"),$(".code-mirror-wrapper")[0].childNodes[0].style.float="unset",$(".code-mirror-wrapper")[0].childNodes[0].style.width="unset"}));s.append(j);var H=$('<button id="apply-widget" class="btn btn-rounded-fill primary" js-reset-toggle="">Apply</button>').click((function(){t.settings[o.name]=x.getValue(),angular.element(document.getElementById("dash-datanode-ctrl")).scope().saveDataNodeSettings(!0)}));s.append(H)}var J=$('<button id="dialog-cancel" class="btn btn-rounded-fill primary" js-reset-toggle="">Close </button>').click((function(){if(i){var e=x.getValue();i(e),"Hide widget"==$("#dialog-widget").text()&&(instanceId=prop[0],null!=widgetConnector.widgetsConnection[instanceId]&&(widgetConnector.widgetsConnection[instanceId].widgetObjEdit=null,widgetConnector.widgetsConnection[instanceId].widgetObjConnect=null))}$("#codeWindowContainer").remove()}));s.append(J)}return{displayJSEditor:function(e,o,n,i,a){t(e,o,n,0,a)},displayMiniJSEditor:function(e,t,o,n){return function(e,t,o,n){o.settings.name;var i="";"JSON_formula_plugin"===o.type?i='// Example: Convert temp from C to F and truncate to 2 decimal places.\n// return (dataNodes["MyDataNode"].sensor.tempInF * 1.8 + 32).toFixed(2);\n':"Python_inline_plugin"===o.type&&(i=""),t||(t=i);var a=$('<div class="codemirror-wrapper__content"></div>');e.append(a);var d=[],r=checkES6(),c=checkES7(),s=checkES8(),l=checkES9(),p=checkES10(),g=5;function u(){C.operation((function(){for(var e=0;e<d.length;++e)C.removeLineWidget(d[e]);d.length=0;var t="/*jshint esversion:"+g+"*/\n"+C.getValue();for(JSHINT(t),e=0;e<JSHINT.errors.length;++e){var o=JSHINT.errors[e];if(o){var n=document.createElement("div"),i=n.appendChild(document.createElement("span"));i.innerHTML="!!",i.className="lint-error-icon",n.appendChild(document.createTextNode(o.reason)),n.className="lint-error",d.push(C.addLineWidget(o.line-1,n,{coverGutter:!1,noHScroll:!0}))}}JSHINT.errors.length&&C.focus()}));var e=C.getScrollInfo(),t=C.charCoords({line:C.getCursor().line+1,ch:0},"local").top;e.top+e.clientHeight<t&&C.scrollTo(null,t-e.clientHeight+3)}function h(e,t){t.pick(),e.execCommand("autocomplete")}r&&(g=6),c&&(g=7),s&&(g=8),l&&(g=9),p&&(g=10);var m,w=datanodesManager.getAllDataNodes().sort(((e,t)=>e.name().localeCompare(t.name()))),v=CodeMirror(a.get(0),{value:t,mode:{name:"javascript",globalVars:!0},theme:"eclipse",indentUnit:4,lineNumbers:!0,matchBrackets:!0,autoCloseBrackets:!0,lineWrapping:!0,showCursorWhenSelecting:!0,extraKeys:{"Ctrl-Space":"autocomplete","Alt-C":e=>e.toggleComment(),"Ctrl-K":e=>e.autoFormatRange(e.getCursor(!0),e.getCursor(!1))},hintOptions:{hint:JSEditorCompletion.createCompletionFct(w),completeSingle:!1,extraKeys:{Tab:h,Right:h,Left:function(e,t){const o=e.getCursor(),n=o.line,i=e.getLine(n),a=o.ch,d=JSEditorCompletion.getPrecedingPathLength(i,a);d&&(e.replaceRange("",CodeMirror.Pos(n,a-d),CodeMirror.Pos(n,a)),t.close(),e.execCommand("autocomplete"))}}}}),C=v.doc.cm;C.on("change",(function(){clearTimeout(m),m=setTimeout(u,500);var e=v.getValue();n(e)})),m=setTimeout(u,500);var f=v.getValue();return setTimeout((function(){v.refresh()}),1),n(f),v}(e,t,o,n)},setAssetRoot:function(t){e(t)}}};
JSEditorCompletion=function(){const t=75;function e(t,e,i){const a=s(e,i,!0);if(a){if(i<a.end)return r(t,a.start,a.end);{const r=f(e,a.end,i);if(r){const e=l(t,a.name);if(e){const t=d(e,r.path);let i=[];return Array.isArray(t)?i=[...t.keys()].map((e=>o(`[${e}]`,t[e]))):"object"!=typeof t&&"function"!=typeof t||null===t||(i=Object.keys(t).map((e=>o(`[${n(e)}]`,t[e])))),{list:i,from:r.completionStart,to:r.completionEnd}}return}}}const u=c(e,i);if(u){const e=t.filter((t=>t.name().startsWith(u.prefix)));return r(e.length>0?e:t,u.start,u.end)}const p=e.substring(0,i),h=/(?<=[^\w]|^)d(?:a(?:t(?:a(?:N(?:o(?:d(?:es?)?)?)?)?)?)?)?$/.exec(p);return h?r(t,h.index,i):r(t,i)}function n(t){return JSON.stringify(t)}function r(t,e,r){return void 0===r&&(r=e),{list:t.map((t=>o(`dataNodes[${n(t.name())}]`,t.latestData()))),from:e,to:r}}function o(e,n){return{text:e,render:function(r,o,s){const c=document.createElement("div"),a=document.createElement("b");if(a.innerText=e,c.appendChild(a),void 0!==n){const e=document.createElement("span");e.innerText=" - ",c.appendChild(e);const r=document.createElement("i");r.innerText=i(n,t),c.appendChild(r)}r.appendChild(c)}}}function i(e,n=t){let r=JSON.stringify(e);if(r.length>n){let t;t=Array.isArray(e)?"...]":"object"!=typeof e&&"function"!=typeof e||null===e?"string"==typeof e||e instanceof String?'..."':"...":"...}",r=r.substr(0,n-t.length)+t}return r}function s(t,e,n=!1){const r=/dataNodes\s*\[\s*(["'])((?:(?=(\\?))\3.)*?)\1\s*\]/g;let o,i;for(;o=r.exec(t);){const t=o[0],n=o.index,r=n+t.length;if(i={name:a(o[2]),start:n,end:r},e>=n&&e<=r)return i}return n&&i&&i.end<=e?i:void 0}function c(t,e){const n=t.substring(0,e),r=/dataNodes\s*\[\s*["']([^"']*)/g;let o;for(;o=r.exec(n);){const t=o[0],n=o.index,r=n+t.length;if(r===e)return{prefix:o[1],start:n,end:r}}}function a(t){if(t){let e="",n=!1;for(let r of t)n?(n=!1,e+="b"===r?"\b":"f"===r?"\f":"n"===r?"\n":"r"===r?"\r":"t"===r?"\t":"v"===r?"\v":r):"\\"===r?n=!0:e+=r;return e}return t}function u(t){const e=/^\s*\[\s*(?:([0-9]+)|(["'])((?:(?=(\\?))\4.)*?)\2)\s*\]/,n=[];let r,o=0;for(;r=e.exec(t);){if(r[1])try{n.push(parseInt(r[1],10))}catch(e){return void console.error(`Invalid number '${r[1]}' in path '${t}'`)}else{if(!r[3])return void console.error(`No matched group in match '${r[0]}' in path '${t}'`);n.push(a(r[3]))}const e=r[0];o+=e.length,t=t.substring(e.length)}return{path:n,length:o}}function f(t,e,n){const r=t.substring(e,n),o=u(r);if(o){const t=o.length,n=e+t,i=r.substr(t);let s;if(s=/^\s*(?:\[\s*(?:["']\s*)?)?$/.exec(i))return{completionStart:n,completionEnd:n+s[0].length,path:o.path}}}function l(t,e){const n=t.find((t=>t.name()===e));return n?n.latestData():void 0}function d(t,e){let n=t;for(let t of e){if(null==n||"string"==typeof n||n instanceof String)return;n=n[t]}return n}return{getPrecedingPathLength:function(t,e){const n=t.substring(0,e);let r;if(r=/^.*(\s*\[\s*(?:[0-9]+|(["'])(?:(?=(\\?))\3.)*?)\2\s*\]\s*)$/.exec(n)){let n=r[1].length;const o="dataNodes";return t.substring(0,e-n).endsWith(o)&&(n+=o.length),n}},createCompletionFct:function(t){return function(n,r){if(!t||0===t.length)return;const o=n.getCursor(),i=o.line,s=n.getLine(i),c=o.ch,a=e(t,s,c);return a&&(a.from=CodeMirror.Pos(i,a.from),a.to=CodeMirror.Pos(i,a.to)),a}},_locateDataNodes:s,_locateDataNodesPrefix:c,_decodePath:u,_locatePath:f,_getDsData:l,_resolvePath:d,_quoteString:n,_valueToText:i,_complete:e}}();
var datanodesManager=function(){var e,n={},t=new DatanodeDependency;"undefined"==typeof execOutsideEditor?this.execOutsideEditor=!1:execOutsideEditor?this.execOutsideEditor=!0:this.execOutsideEditor=!1,this.execOutsideEditor||(e=new GraphVisu(t));var a,o=new TimeManager,i=new FreeboardUI,d=new DatanodesListModel(n,i,t,o),s=new JSONEdit,r={},c=new JSEditor,l=new PluginEditor(c);function g(e){if(e.sampleTime()&&o.unregisterDatanode(e.name()),t.hasSuccessors(e.name())){let n=Array.from(t.getSuccessors(e.name())).toString();n=n.replaceAll(",",", "),swal("Deleting dataNode side effects",'This dataNode "'+e.name()+'" is still used in dataNode(s) "'+n+'".\n It must be changed.',"warning")}var n=angular.element(document.body).scope().$root;d.deleteDatanode(e),d.datanodes.remove(e),n.alldatanodes=datanodesManager.getAllDataNodes(),n.filtredNodes=n.alldatanodes.length,n.showNotifications=!1,n.updateFlagDirty(!0),n.safeApply(),t.updateDisconnectedGraphsList(e.name(),"delete"),offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("All disconnected Graphs after delete: ",t.getAllDisconnectedGraphs())}function u(e){var n=!1,t=[];for(var a in widgetConnector.widgetsConnection)for(var o in widgetConnector.widgetsConnection[a].sliders)"None"!=widgetConnector.widgetsConnection[a].sliders[o].name&&widgetConnector.widgetsConnection[a].sliders[o].dataNode===e&&(n=!0,t.push(a));return n||(t=[]),[n,_.uniq(t)]}function p(e,n,t){if([bFoundConnection,prop]=u(e.name()),"datanode"==n&&bFoundConnection){let n=[];for(let e=0;e<prop.length;e++)n.push(widgetConnector.widgetsConnection[prop[e]].instanceId);swal({title:"Are you sure?",text:"This dataNode will be deleted and connections with widget(s) '"+n.join("\n")+"' may be removed!",type:"warning",showCancelButton:!0,showConfirmButton:!1,showConfirmButton1:!0,confirmButtonText:"Yes",cancelButtonText:"Abandon",closeOnConfirm:!0,closeOnConfirm1:!0,closeOnCancel:!0},(function(n){if(n){if(g(e),angular.element(document.body).scope().$root.bIsPlayMode)for(key in widgetConnector.widgetsConnection)widgetPreview.plotConstantData(key,!1)}}))}else{var a=angular.element(document.body).scope().$root;a.isPopupWindow=!0,a.popupTitle="Confirm Delete",a.popupText="Are you sure you want to delete this "+t,a.popupAction=function(){"datanode"==n&&g(e)}}}return ko.bindingHandlers.pluginEditor={init:function(e,t,a,o,i){var d=ko.unwrap(t()),s="";"datanode"==d.type&&(n,s="DataNode"),$(e).click((function(n){if("delete"==d.operation)p(o,d.type,s);else if("refresh"==d.operation)o.schedulerStart(void 0,void 0,"refresh");else if("stop"==d.operation)null!=o.execInstance()&&o.execInstance().stopOperation(o.name());else if("showTooltip"==d.operation)"datanode"==d.type&&($(e).tooltip("fixTitle"),$(e).tooltip("show"));else if("hide"==d.operation)"data-preview"==d.type&&$(e).parent().parent().parent().remove();else{"datanode"==d.type&&("add"==d.operation?{}:(o.type(),o.settings().name=o.name()))}}))}},ko.virtualElements.allowedBindings.datanodeTypeSettings=!0,ko.bindingHandlers.datanodeTypeSettings={update:function(e,n,t,a,o){processPluginSettings(e,n,t,a,o)}},{initialize:function(e){ko.applyBindings(d),i.showLoadingIndicator(!1),document.querySelectorAll(".docsLink").forEach((function(e){e.href=xDashConfig.urlDoc+"index.html"})),urlQueryEntry.process(e)},load:function(e,n,t){return d.load(e,n,t),!d.error()},serialize:function(){return d.serialize()},loadDatanodePlugin:function(e){_.isUndefined(e.display_name)&&(e.display_name=e.type_name),"Memory_plugin"!==e.type_name?e.settings.unshift({name:"name",display_name:"Name",type:"text",required:!0}):e.settings.unshift({name:"name",display_name:"Generated memory name",type:"text",disabled:!0}),n[e.type_name]=e,d._datanodeTypes.valueHasMutated()},getDataNodePluginTypes:function(){return n},setAssetRoot:function(e){c.setAssetRoot(e)},showLoadingIndicator:function(e){i.showLoadingIndicator(e)},foundDatanode:function(e){var n=d.datanodes();return datanode=_.find(n,(function(n){return n.name()===e})),!!datanode},getDataNodeByName:function(e){var n=d.datanodes();if(datanode=_.find(n,(function(n){return n.name()===e})),datanode)return datanode},getDatasourceByName:function(e){return datanodesManager.getDataNodeByName(e)},getAllDataNodes:function(){return d.datanodes()},getAllDataSources:function(){return datanodesManager.getAllDataNodes()},clear:function(){return schedulerProfiling={},d.clear()},showDepGraph:function(n){e.showDepGraph(n),angular.element(document.getElementById("dependency__graph--container")).scope().getUniqTypes()},editNodeFromGraph:function(e){angular.element(document.getElementById("dependency__graph--container")).scope().editNodeFromGraph(e)},selectNodeFromTagList:function(n){e.selectNodeFromTagList(n)},selectConnectedWithWidget:function(n){e.selectConnectedWithWidget(n)},closeGraph:function(){e.closeGraph()},isSingletonNode:function(e){return t.isSingletonNode(e)},RemoveUnusedDatanodes:function(){var e=[],n=t.getAllsingletonNodes();for(let t in n)[bFoundConnection,prop]=u(n[t]),bFoundConnection||e.push(n[t]);offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("zombie: ",e);var a=[],o=xdsjson.getDataList(e,"Unused data is a singleton node that is not connected to any widget.<br>Please check data to be deleted : ");new DialogBoxForData(o,"List of unused data","Delete","Cancel",(function(){for(var n=0;n<e.length;n++)$("#data-checkbox-"+n).is(":checked")&&(a[n]=e[n],g(datanodesManager.getDataNodeByName(e[n])),!0)}))},stopSchedule:function(){var e=d.datanodes();for(var n in t.clearExtraStartNodesList(),t.clearSetvarList(),t.clearProcessedSetvarList(),t.clearCurrentGraphList(),e)if(null!=e[n].execInstance()){e[n].execInstance().stopAllOperations(),swal("Scheduler progress","scheduler is stopped!","success");break}},isConnectedWithWidgt:u,previewWidget:function(e){var n=[];$("#widgets-preview-top > div").each(((e,t)=>{n.push(t.id),$("#"+t.id).hide()})),$("#widget-preview-zone-"+e).show()},deleteDataNode:function(e,n,t){p(e,n,t)},createPluginEditor:function(e,n,t,a){!function(e,n,t,a){l.createPluginEditor(e,n,t,a)}(e,n,t,a)},settingsSavedCallback:function(e,a,i,s){return!!l.saveSettings(s,i,(function(){return function(e,a,i){var s;if("add"==a.operation){if("datanode"==a.type){if(datanodesManager.foundDatanode(i.settings.name))return swal("A dataNode with name '"+i.settings.name+"' adready exists.","Please specify a different name","error"),!0;(s=new DatanodeModel(d,n,t,o)).name(i.settings.name),s.settings(i.settings),s.type(i.type),"Memory_plugin"===i.type&&(s.is_specific_exec=!0);const e="icn-"+i.iconType.replace(/\.[^/.]+$/,"");if(s.iconType(e),s.error())return!0;s.isSchedulerStartSafe(!0),d.addDatanode(s),t.updateDisconnectedGraphsList(s.name(),"add"),offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("All disconnected Graphs after add: ",t.getAllDisconnectedGraphs()),_.isUndefined(i.settings.sampleTime)||0==i.settings.sampleTime?s.schedulerStart(void 0,void 0,"unidentified"):(s.sampleTime(i.settings.sampleTime),o.registerDatanode(s.sampleTime(),s.name(),"unidentified")),angular.element(document.body).injector().invoke(["$rootScope",function(e){}]);var r=angular.element(document.body).scope().$root;r.alldatanodes=datanodesManager.getAllDataNodes(),r.showNotifications=!1,r.safeApply()}}else if("edit"==a.operation){if("datanode"==a.type){if(e.isSettingNameChanged(i.settings.name)){if(datanodesManager.foundDatanode(i.settings.name))return swal("A dataNode with name '"+i.settings.name+"' already exists.","Please specify a different name","error"),!0;if(t.hasSuccessors(e.name())){var c=Array.from(t.getSuccessors(e.name()));xdashNotifications.manageNotification("info",e.name(),'Update new name "'+i.settings.name+'" in script of "'+c+'"');for(let n in c){const t=e.name(),a=i.settings.name;let o="";"Python_plugin"===datanodesManager.getDataNodeByName(c[n]).type()||"Python_pyodide_plugin"===datanodesManager.getDataNodeByName(c[n]).type()?o=datanodesManager.getDataNodeByName(c[n]).settings().content:"JSON_formula_plugin"===datanodesManager.getDataNodeByName(c[n]).type()?o=datanodesManager.getDataNodeByName(c[n]).settings().json_var_formula:"REST_web-service_from_datasource"===datanodesManager.getDataNodeByName(c[n]).type()?o=datanodesManager.getDataNodeByName(c[n]).settings().body:"JSON_delay_plugin"===datanodesManager.getDataNodeByName(c[n]).type()&&(o=datanodesManager.getDataNodeByName(c[n]).settings().json_input),replacedScript=o.replace(new RegExp('dataNodes\\["'+t+'"\\]',"g"),'dataNodes["'+a+'"]').replace(new RegExp("dataNodes\\."+t,"g"),"dataNodes."+a),"Python_plugin"===datanodesManager.getDataNodeByName(c[n]).type()||"Python_pyodide_plugin"===datanodesManager.getDataNodeByName(c[n]).type()?datanodesManager.getDataNodeByName(c[n]).settings().content=replacedScript:"JSON_formula_plugin"===datanodesManager.getDataNodeByName(c[n]).type()?datanodesManager.getDataNodeByName(c[n]).settings().json_var_formula=replacedScript:"REST_web-service_from_datasource"===datanodesManager.getDataNodeByName(c[n]).type()?datanodesManager.getDataNodeByName(c[n]).settings().body=replacedScript:"JSON_delay_plugin"===datanodesManager.getDataNodeByName(c[n]).type()&&(datanodesManager.getDataNodeByName(c[n]).settings().json_input=replacedScript)}}if([bFoundConnection,prop]=u(e.name()),bFoundConnection){let n=[];for(let t in widgetConnector.widgetsConnection)for(let a in widgetConnector.widgetsConnection[t].sliders)e.name()===widgetConnector.widgetsConnection[t].sliders[a].dataNode&&(n.push(widgetConnector.widgetsConnection[t].instanceId),widgetConnector.widgetsConnection[t].sliders[a].dataNode=i.settings.name);xdashNotifications.manageNotification("info",e.name(),'Update new name "'+i.settings.name+'" in connected widgets "'+n.join("\n")+'"')}null!=e.execInstance()&&e.execInstance().stopOperation(e.name()),e.name()!==i.settings.name&&d.renameDatanodeData(e.name(),i.settings.name)}e.name()!==i.settings.name&&t.renameNode(e.name(),i.settings.name),e.name(i.settings.name),_.isUndefined(i.settings.sampleTime)||e.isSettingSampleTimeChanged(i.settings.sampleTime)&&e.sampleTime(i.settings.sampleTime)}e.type(i.type),e.settings(i.settings);const n="icn-"+i.iconType.replace(/\.[^/.]+$/,"");if(e.iconType(n),e.error())return!0;"datanode"==a.type&&(t.computeAllDisconnectedGraphs(),offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("All disconnected Graphs after rename: ",t.getAllDisconnectedGraphs()),_.isUndefined(i.settings.sampleTime)?e.schedulerStart(void 0,void 0,"edit"):0!=e.sampleTime()?o.registerDatanode(e.sampleTime(),e.name(),"edit"):o.isRegisteredDatanode(e.name())&&(o.unregisterDatanode(e.name()),e.schedulerStart(void 0,void 0,"edit")))}return!1}(e,a,i)}))},getOldSettingsCallback:function(e){!function(e){if(_.isFunction(e.getSavedSettings)){var n=e.getSavedSettings();if(!_.isUndefined(n))e.settings(n[1]),e.statusCallback(n[0]),e.name()!==n[1].name&&(d.renameDatanodeData(e.name(),n[1].name),t.renameNode(e.name(),n[1].name)),e.name(n[1].name),n[1]}}(e)},getDataNodeNewSettings:function(){return l.getNewSettings()},getJsonEd:function(){return s},setJsonEditor:function(e){r=e},getJsonEditor:function(){return r},datanodesDependency:function(){return t},setCurrentDataNode:function(e){a=e},getCurrentDataNode:function(){return a}}}();
/* @license
Papa Parse
v5.3.0
https://github.com/mholt/PapaParse
License: MIT
*/
!function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof module&&"undefined"!=typeof exports?module.exports=t():e.Papa=t()}(this,(function e(){"use strict";var t="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==t?t:{};var i=!t.document&&!!t.postMessage,r=i&&/blob:/i.test((t.location||{}).protocol),n={},s=0,a={parse:function(i,r){var o=(r=r||{}).dynamicTyping||!1;C(o)&&(r.dynamicTypingFunction=o,o={});if(r.dynamicTyping=o,r.transform=!!C(r.transform)&&r.transform,r.worker&&a.WORKERS_SUPPORTED){var h=function(){if(!a.WORKERS_SUPPORTED)return!1;var i=(o=t.URL||t.webkitURL||null,h=e.toString(),a.BLOB_URL||(a.BLOB_URL=o.createObjectURL(new Blob(["(",h,")();"],{type:"text/javascript"})))),r=new t.Worker(i);var o,h;return r.onmessage=m,r.id=s++,n[r.id]=r,r}();return h.userStep=r.step,h.userChunk=r.chunk,h.userComplete=r.complete,h.userError=r.error,r.step=C(r.step),r.chunk=C(r.chunk),r.complete=C(r.complete),r.error=C(r.error),delete r.worker,void h.postMessage({input:i,config:r,workerId:h.id})}var p=null;if(i===a.NODE_STREAM_INPUT&&"undefined"==typeof PAPA_BROWSER_CONTEXT)return(p=new c(r)).getStream();"string"==typeof i?p=r.download?new u(r):new d(r):!0===i.readable&&C(i.read)&&C(i.on)?p=new l(r):(t.File&&i instanceof File||i instanceof Object)&&(p=new f(r));return p.stream(i)},unparse:function(e,t){var i=!1,r=!0,n=",",s="\r\n",o='"',h=o+o,u=!1,f=null,d=!1;!function(){if("object"!=typeof t)return;"string"!=typeof t.delimiter||a.BAD_DELIMITERS.filter((function(e){return-1!==t.delimiter.indexOf(e)})).length||(n=t.delimiter);("boolean"==typeof t.quotes||"function"==typeof t.quotes||Array.isArray(t.quotes))&&(i=t.quotes);"boolean"!=typeof t.skipEmptyLines&&"string"!=typeof t.skipEmptyLines||(u=t.skipEmptyLines);"string"==typeof t.newline&&(s=t.newline);"string"==typeof t.quoteChar&&(o=t.quoteChar);"boolean"==typeof t.header&&(r=t.header);if(Array.isArray(t.columns)){if(0===t.columns.length)throw new Error("Option columns is empty");f=t.columns}void 0!==t.escapeChar&&(h=t.escapeChar+o);"boolean"==typeof t.escapeFormulae&&(d=t.escapeFormulae)}();var l=new RegExp(_(o),"g");"string"==typeof e&&(e=JSON.parse(e));if(Array.isArray(e)){if(!e.length||Array.isArray(e[0]))return c(null,e,u);if("object"==typeof e[0])return c(f||Object.keys(e[0]),e,u)}else if("object"==typeof e)return"string"==typeof e.data&&(e.data=JSON.parse(e.data)),Array.isArray(e.data)&&(e.fields||(e.fields=e.meta&&e.meta.fields),e.fields||(e.fields=Array.isArray(e.data[0])?e.fields:"object"==typeof e.data[0]?Object.keys(e.data[0]):[]),Array.isArray(e.data[0])||"object"==typeof e.data[0]||(e.data=[e.data])),c(e.fields||[],e.data||[],u);throw new Error("Unable to serialize unrecognized input");function c(e,t,i){var a="";"string"==typeof e&&(e=JSON.parse(e)),"string"==typeof t&&(t=JSON.parse(t));var o=Array.isArray(e)&&e.length>0,h=!Array.isArray(t[0]);if(o&&r){for(var u=0;u<e.length;u++)u>0&&(a+=n),a+=p(e[u],u);t.length>0&&(a+=s)}for(var f=0;f<t.length;f++){var d=o?e.length:t[f].length,l=!1,c=o?0===Object.keys(t[f]).length:0===t[f].length;if(i&&!o&&(l="greedy"===i?""===t[f].join("").trim():1===t[f].length&&0===t[f][0].length),"greedy"===i&&o){for(var _=[],g=0;g<d;g++){var m=h?e[g]:g;_.push(t[f][m])}l=""===_.join("").trim()}if(!l){for(var y=0;y<d;y++){y>0&&!c&&(a+=n);var v=o&&h?e[y]:y;a+=p(t[f][v],y)}f<t.length-1&&(!i||d>0&&!c)&&(a+=s)}}return a}function p(e,t){if(null==e)return"";if(e.constructor===Date)return JSON.stringify(e).slice(1,25);!0===d&&"string"==typeof e&&null!==e.match(/^[=+\-@].*$/)&&(e="'"+e);var r=e.toString().replace(l,h),s="boolean"==typeof i&&i||"function"==typeof i&&i(e,t)||Array.isArray(i)&&i[t]||function(e,t){for(var i=0;i<t.length;i++)if(e.indexOf(t[i])>-1)return!0;return!1}(r,a.BAD_DELIMITERS)||r.indexOf(n)>-1||" "===r.charAt(0)||" "===r.charAt(r.length-1);return s?o+r+o:r}}};if(a.RECORD_SEP=String.fromCharCode(30),a.UNIT_SEP=String.fromCharCode(31),a.BYTE_ORDER_MARK="\ufeff",a.BAD_DELIMITERS=["\r","\n",'"',a.BYTE_ORDER_MARK],a.WORKERS_SUPPORTED=!i&&!!t.Worker,a.NODE_STREAM_INPUT=1,a.LocalChunkSize=10485760,a.RemoteChunkSize=5242880,a.DefaultDelimiter=",",a.Parser=g,a.ParserHandle=p,a.NetworkStreamer=u,a.FileStreamer=f,a.StringStreamer=d,a.ReadableStreamStreamer=l,"undefined"==typeof PAPA_BROWSER_CONTEXT&&(a.DuplexStreamStreamer=c),t.jQuery){var o=t.jQuery;o.fn.parse=function(e){var i=e.config||{},r=[];return this.each((function(e){if(!("INPUT"===o(this).prop("tagName").toUpperCase()&&"file"===o(this).attr("type").toLowerCase()&&t.FileReader)||!this.files||0===this.files.length)return!0;for(var n=0;n<this.files.length;n++)r.push({file:this.files[n],inputElem:this,instanceConfig:o.extend({},i)})})),n(),this;function n(){if(0!==r.length){var t,i,n,h,u=r[0];if(C(e.before)){var f=e.before(u.file,u.inputElem);if("object"==typeof f){if("abort"===f.action)return t="AbortError",i=u.file,n=u.inputElem,h=f.reason,void(C(e.error)&&e.error({name:t},i,n,h));if("skip"===f.action)return void s();"object"==typeof f.config&&(u.instanceConfig=o.extend(u.instanceConfig,f.config))}else if("skip"===f)return void s()}var d=u.instanceConfig.complete;u.instanceConfig.complete=function(e){C(d)&&d(e,u.file,u.inputElem),s()},a.parse(u.file,u.instanceConfig)}else C(e.complete)&&e.complete()}function s(){r.splice(0,1),n()}}}function h(e){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},function(e){var t=k(e);t.chunkSize=parseInt(t.chunkSize),e.step||e.chunk||(t.chunkSize=null);this._handle=new p(t),this._handle.streamer=this,this._config=t}.call(this,e),this.parseChunk=function(e,i){if(this.isFirstChunk&&C(this._config.beforeFirstChunk)){var n=this._config.beforeFirstChunk(e);void 0!==n&&(e=n)}this.isFirstChunk=!1,this._halted=!1;var s=this._partialLine+e;this._partialLine="";var o=this._handle.parse(s,this._baseIndex,!this._finished);if(!this._handle.paused()&&!this._handle.aborted()){var h=o.meta.cursor;this._finished||(this._partialLine=s.substring(h-this._baseIndex),this._baseIndex=h),o&&o.data&&(this._rowCount+=o.data.length);var u=this._finished||this._config.preview&&this._rowCount>=this._config.preview;if(r)t.postMessage({results:o,workerId:a.WORKER_ID,finished:u});else if(C(this._config.chunk)&&!i){if(this._config.chunk(o,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);o=void 0,this._completeResults=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(o.data),this._completeResults.errors=this._completeResults.errors.concat(o.errors),this._completeResults.meta=o.meta),this._completed||!u||!C(this._config.complete)||o&&o.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),u||o&&o.meta.paused||this._nextChunk(),o}this._halted=!0},this._sendError=function(e){C(this._config.error)?this._config.error(e):r&&this._config.error&&t.postMessage({workerId:a.WORKER_ID,error:e,finished:!1})}}function u(e){var t;(e=e||{}).chunkSize||(e.chunkSize=a.RemoteChunkSize),h.call(this,e),this._nextChunk=i?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(e){this._input=e,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(t=new XMLHttpRequest,this._config.withCredentials&&(t.withCredentials=this._config.withCredentials),i||(t.onload=b(this._chunkLoaded,this),t.onerror=b(this._chunkError,this)),t.open(this._config.downloadRequestBody?"POST":"GET",this._input,!i),this._config.downloadRequestHeaders){var e=this._config.downloadRequestHeaders;for(var r in e)t.setRequestHeader(r,e[r])}if(this._config.chunkSize){var n=this._start+this._config.chunkSize-1;t.setRequestHeader("Range","bytes="+this._start+"-"+n)}try{t.send(this._config.downloadRequestBody)}catch(e){this._chunkError(e.message)}i&&0===t.status&&this._chunkError()}},this._chunkLoaded=function(){4===t.readyState&&(t.status<200||t.status>=400?this._chunkError():(this._start+=this._config.chunkSize?this._config.chunkSize:t.responseText.length,this._finished=!this._config.chunkSize||this._start>=function(e){var t=e.getResponseHeader("Content-Range");if(null===t)return-1;return parseInt(t.substring(t.lastIndexOf("/")+1))}(t),this.parseChunk(t.responseText)))},this._chunkError=function(e){var i=t.statusText||e;this._sendError(new Error(i))}}function f(e){var t,i;(e=e||{}).chunkSize||(e.chunkSize=a.LocalChunkSize),h.call(this,e);var r="undefined"!=typeof FileReader;this.stream=function(e){this._input=e,i=e.slice||e.webkitSlice||e.mozSlice,r?((t=new FileReader).onload=b(this._chunkLoaded,this),t.onerror=b(this._chunkError,this)):t=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var e=this._input;if(this._config.chunkSize){var n=Math.min(this._start+this._config.chunkSize,this._input.size);e=i.call(e,this._start,n)}var s=t.readAsText(e,this._config.encoding);r||this._chunkLoaded({target:{result:s}})},this._chunkLoaded=function(e){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(e.target.result)},this._chunkError=function(){this._sendError(t.error)}}function d(e){var t;e=e||{},h.call(this,e),this.stream=function(e){return t=e,this._nextChunk()},this._nextChunk=function(){if(!this._finished){var e,i=this._config.chunkSize;return i?(e=t.substring(0,i),t=t.substring(i)):(e=t,t=""),this._finished=!t,this.parseChunk(e)}}}function l(e){e=e||{},h.call(this,e);var t=[],i=!0,r=!1;this.pause=function(){h.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){h.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(e){this._input=e,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){r&&1===t.length&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),t.length?this.parseChunk(t.shift()):i=!0},this._streamData=b((function(e){try{t.push("string"==typeof e?e:e.toString(this._config.encoding)),i&&(i=!1,this._checkIsFinished(),this.parseChunk(t.shift()))}catch(e){this._streamError(e)}}),this),this._streamError=b((function(e){this._streamCleanUp(),this._sendError(e)}),this),this._streamEnd=b((function(){this._streamCleanUp(),r=!0,this._streamData("")}),this),this._streamCleanUp=b((function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)}),this)}function c(e){var t=require("stream").Duplex,i=k(e),r=!0,n=!1,s=[],a=null;this._onCsvData=function(e){var t=e.data;a.push(t)||this._handle.paused()||this._handle.pause()},this._onCsvComplete=function(){a.push(null)},i.step=b(this._onCsvData,this),i.complete=b(this._onCsvComplete,this),h.call(this,i),this._nextChunk=function(){n&&1===s.length&&(this._finished=!0),s.length?s.shift()():r=!0},this._addToParseQueue=function(e,t){s.push(b((function(){if(this.parseChunk("string"==typeof e?e:e.toString(i.encoding)),C(t))return t()}),this)),r&&(r=!1,this._nextChunk())},this._onRead=function(){this._handle.paused()&&this._handle.resume()},this._onWrite=function(e,t,i){this._addToParseQueue(e,i)},this._onWriteComplete=function(){n=!0,this._addToParseQueue("")},this.getStream=function(){return a},(a=new t({readableObjectMode:!0,decodeStrings:!1,read:b(this._onRead,this),write:b(this._onWrite,this)})).once("finish",b(this._onWriteComplete,this))}function p(e){var t,i,r,n=Math.pow(2,53),s=-n,o=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)(e[-+]?\d+)?\s*$/,h=/(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))/,u=this,f=0,d=0,l=!1,c=!1,p=[],m={data:[],errors:[],meta:{}};if(C(e.step)){var y=e.step;e.step=function(t){if(m=t,E())b();else{if(b(),0===m.data.length)return;f+=t.data.length,e.preview&&f>e.preview?i.abort():(m.data=m.data[0],y(m,u))}}}function v(t){return"greedy"===e.skipEmptyLines?""===t.join("").trim():1===t.length&&0===t[0].length}function b(){if(m&&r&&(R("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+a.DefaultDelimiter+"'"),r=!1),e.skipEmptyLines)for(var t=0;t<m.data.length;t++)v(m.data[t])&&m.data.splice(t--,1);return E()&&function(){if(!m)return;function t(t,i){C(e.transformHeader)&&(t=e.transformHeader(t,i)),p.push(t)}if(Array.isArray(m.data[0])){for(var i=0;E()&&i<m.data.length;i++)m.data[i].forEach(t);m.data.splice(0,1)}else m.data.forEach(t)}(),function(){if(!m||!e.header&&!e.dynamicTyping&&!e.transform)return m;function t(t,i){var r,n=e.header?{}:[];for(r=0;r<t.length;r++){var s=r,a=t[r];e.header&&(s=r>=p.length?"__parsed_extra":p[r]),e.transform&&(a=e.transform(a,s)),a=w(s,a),"__parsed_extra"===s?(n[s]=n[s]||[],n[s].push(a)):n[s]=a}return e.header&&(r>p.length?R("FieldMismatch","TooManyFields","Too many fields: expected "+p.length+" fields but parsed "+r,d+i):r<p.length&&R("FieldMismatch","TooFewFields","Too few fields: expected "+p.length+" fields but parsed "+r,d+i)),n}var i=1;!m.data.length||Array.isArray(m.data[0])?(m.data=m.data.map(t),i=m.data.length):m.data=t(m.data,0);e.header&&m.meta&&(m.meta.fields=p);return d+=i,m}()}function E(){return e.header&&0===p.length}function w(t,i){return function(t){return e.dynamicTypingFunction&&void 0===e.dynamicTyping[t]&&(e.dynamicTyping[t]=e.dynamicTypingFunction(t)),!0===(e.dynamicTyping[t]||e.dynamicTyping)}(t)?"true"===i||"TRUE"===i||"false"!==i&&"FALSE"!==i&&(function(e){if(o.test(e)){var t=parseFloat(e);if(t>s&&t<n)return!0}return!1}(i)?parseFloat(i):h.test(i)?new Date(i):""===i?null:i):i}function R(e,t,i,r){var n={type:e,code:t,message:i};void 0!==r&&(n.row=r),m.errors.push(n)}this.parse=function(n,s,o){var h=e.quoteChar||'"';if(e.newline||(e.newline=function(e,t){e=e.substring(0,1048576);var i=new RegExp(_(t)+"([^]*?)"+_(t),"gm");e=e.replace(i,"");var r=e.split("\r"),n=e.split("\n"),s=n.length>1&&n[0].length<r[0].length;if(1===r.length||s)return"\n";for(var a=0,o=0;o<r.length;o++)"\n"===r[o][0]&&a++;return a>=r.length/2?"\r\n":"\r"}(n,h)),r=!1,e.delimiter)C(e.delimiter)&&(e.delimiter=e.delimiter(n),m.meta.delimiter=e.delimiter);else{var u=function(t,i,r,n,s){var o,h,u,f;s=s||[",","\t","|",";",a.RECORD_SEP,a.UNIT_SEP];for(var d=0;d<s.length;d++){var l=s[d],c=0,p=0,_=0;u=void 0;for(var m=new g({comments:n,delimiter:l,newline:i,preview:10}).parse(t),y=0;y<m.data.length;y++)if(r&&v(m.data[y]))_++;else{var k=m.data[y].length;p+=k,void 0!==u?k>0&&(c+=Math.abs(k-u),u=k):u=k}m.data.length>0&&(p/=m.data.length-_),(void 0===h||c<=h)&&(void 0===f||p>f)&&p>1.99&&(h=c,o=l,f=p)}return e.delimiter=o,{successful:!!o,bestDelimiter:o}}(n,e.newline,e.skipEmptyLines,e.comments,e.delimitersToGuess);u.successful?e.delimiter=u.bestDelimiter:(r=!0,e.delimiter=a.DefaultDelimiter),m.meta.delimiter=e.delimiter}var f=k(e);return e.preview&&e.header&&f.preview++,t=n,i=new g(f),m=i.parse(t,s,o),b(),l?{meta:{paused:!0}}:m||{meta:{paused:!1}}},this.paused=function(){return l},this.pause=function(){l=!0,i.abort(),t=C(e.chunk)?"":t.substring(i.getCharIndex())},this.resume=function(){u.streamer._halted?(l=!1,u.streamer.parseChunk(t,!0)):setTimeout(u.resume,3)},this.aborted=function(){return c},this.abort=function(){c=!0,i.abort(),m.meta.aborted=!0,C(e.complete)&&e.complete(m),t=""}}function _(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function g(e){var t,i=(e=e||{}).delimiter,r=e.newline,n=e.comments,s=e.step,o=e.preview,h=e.fastMode,u=t=void 0===e.quoteChar?'"':e.quoteChar;if(void 0!==e.escapeChar&&(u=e.escapeChar),("string"!=typeof i||a.BAD_DELIMITERS.indexOf(i)>-1)&&(i=","),n===i)throw new Error("Comment character same as delimiter");!0===n?n="#":("string"!=typeof n||a.BAD_DELIMITERS.indexOf(n)>-1)&&(n=!1),"\n"!==r&&"\r"!==r&&"\r\n"!==r&&(r="\n");var f=0,d=!1;this.parse=function(e,a,l){if("string"!=typeof e)throw new Error("Input must be a string");var c=e.length,p=i.length,g=r.length,m=n.length,y=C(s);f=0;var v=[],k=[],b=[],E=0;if(!e)return z();if(h||!1!==h&&-1===e.indexOf(t)){for(var w=e.split(r),R=0;R<w.length;R++){if(b=w[R],f+=b.length,R!==w.length-1)f+=r.length;else if(l)return z();if(!n||b.substring(0,m)!==n){if(y){if(v=[],I(b.split(i)),M(),d)return z()}else I(b.split(i));if(o&&R>=o)return v=v.slice(0,o),z(!0)}}return z()}for(var S=e.indexOf(i,f),O=e.indexOf(r,f),x=new RegExp(_(u)+_(t),"g"),T=e.indexOf(t,f);;)if(e[f]!==t)if(n&&0===b.length&&e.substring(f,f+m)===n){if(-1===O)return z();f=O+g,O=e.indexOf(r,f),S=e.indexOf(i,f)}else if(-1!==S&&(S<O||-1===O))b.push(e.substring(f,S)),f=S+p,S=e.indexOf(i,f);else{if(-1===O)break;if(b.push(e.substring(f,O)),j(O+g),y&&(M(),d))return z();if(o&&v.length>=o)return z(!0)}else for(T=f,f++;;){if(-1===(T=e.indexOf(t,T+1)))return l||k.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:v.length,index:f}),F();if(T===c-1)return F(e.substring(f,T).replace(x,t));if(t!==u||e[T+1]!==u){if(t===u||0===T||e[T-1]!==u){-1!==S&&S<T+1&&(S=e.indexOf(i,T+1)),-1!==O&&O<T+1&&(O=e.indexOf(r,T+1));var A=L(-1===O?S:Math.min(S,O));if(e[T+1+A]===i){b.push(e.substring(f,T).replace(x,t)),f=T+1+A+p,e[T+1+A+p]!==t&&(T=e.indexOf(t,f)),S=e.indexOf(i,f),O=e.indexOf(r,f);break}var D=L(O);if(e.substring(T+1+D,T+1+D+g)===r){if(b.push(e.substring(f,T).replace(x,t)),j(T+1+D+g),S=e.indexOf(i,f),T=e.indexOf(t,f),y&&(M(),d))return z();if(o&&v.length>=o)return z(!0);break}k.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:v.length,index:f}),T++}}else T++}return F();function I(e){v.push(e),E=f}function L(t){var i=0;if(-1!==t){var r=e.substring(T+1,t);r&&""===r.trim()&&(i=r.length)}return i}function F(t){return l||(void 0===t&&(t=e.substring(f)),b.push(t),f=c,I(b),y&&M()),z()}function j(t){f=t,I(b),b=[],O=e.indexOf(r,f)}function z(e){return{data:v,errors:k,meta:{delimiter:i,linebreak:r,aborted:d,truncated:!!e,cursor:E+(a||0)}}}function M(){s(z()),v=[],k=[]}},this.abort=function(){d=!0},this.getCharIndex=function(){return f}}function m(e){var t=e.data,i=n[t.workerId],r=!1;if(t.error)i.userError(t.error,t.file);else if(t.results&&t.results.data){var s={abort:function(){r=!0,y(t.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:v,resume:v};if(C(i.userStep)){for(var a=0;a<t.results.data.length&&(i.userStep({data:t.results.data[a],errors:t.results.errors,meta:t.results.meta},s),!r);a++);delete t.results}else C(i.userChunk)&&(i.userChunk(t.results,s,t.file),delete t.results)}t.finished&&!r&&y(t.workerId,t.results)}function y(e,t){var i=n[e];C(i.userComplete)&&i.userComplete(t),i.terminate(),delete n[e]}function v(){throw new Error("Not implemented.")}function k(e){if("object"!=typeof e||null===e)return e;var t=Array.isArray(e)?[]:{};for(var i in e)t[i]=k(e[i]);return t}function b(e,t){return function(){e.apply(t,arguments)}}function C(e){return"function"==typeof e}return r&&(t.onmessage=function(e){var i=e.data;void 0===a.WORKER_ID&&i&&(a.WORKER_ID=i.workerId);if("string"==typeof i.input)t.postMessage({workerId:a.WORKER_ID,results:a.parse(i.input,i.config),finished:!0});else if(t.File&&i.input instanceof File||i.input instanceof Object){var r=a.parse(i.input,i.config);r&&t.postMessage({workerId:a.WORKER_ID,results:r,finished:!0})}}),u.prototype=Object.create(h.prototype),u.prototype.constructor=u,f.prototype=Object.create(h.prototype),f.prototype.constructor=f,d.prototype=Object.create(d.prototype),d.prototype.constructor=d,l.prototype=Object.create(h.prototype),l.prototype.constructor=l,"undefined"==typeof PAPA_BROWSER_CONTEXT&&(c.prototype=Object.create(h.prototype),c.prototype.constructor=c),a}));
function truncateLongArray(e,r){for(var t in e)if("object"==typeof e[t]){var n=e[t];_.isNull(n)||_.isUndefined(n)||n.length>r&&(n.length=r,n[n.length-1]="... [preview truncated due to data big size]"),truncateLongArray(n,r)}}function syntaxHighlight(e){if(!_.isUndefined(e)){var r=JSON.parse(e),t=1e5;truncateLongArray(r,20);var n=!1;return(e=JSON.stringify(r,null,2)).length>t&&(e=e.substring(0,t),n=!0),e=(e=(e=(e=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")).replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g,(function(e){var r="number";return/^"/.test(e)?r=/:$/.test(e)?"key":"string":/true|false/.test(e)?r="boolean":/null/.test(e)&&(r="null"),'<span class="'+r+' vignette">'+e+"</span>"}))).replace(/    /g,"&nbsp;&nbsp;&nbsp;&nbsp;")).replace(/\n/g,"<br/>"),n&&(e+="<b>... [preview truncated due to data big size]</b><br/>"),e}}function base64ArrayBuffer(e){for(var r,t="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=new Uint8Array(e),o=a.byteLength,i=o%3,u=o-i,f=0;f<u;f+=3)t+=n[(16515072&(r=a[f]<<16|a[f+1]<<8|a[f+2]))>>18]+n[(258048&r)>>12]+n[(4032&r)>>6]+n[63&r];return 1==i?t+=n[(252&(r=a[u]))>>2]+n[(3&r)<<4]+"==":2==i&&(t+=n[(64512&(r=a[u]<<8|a[u+1]))>>10]+n[(1008&r)>>4]+n[(15&r)<<2]+"="),t}function String2Uint8Array(e){for(var r=new Uint8Array(e.length),t=0;t<e.length;t++)r.set([e.charCodeAt(t)],t);return r}function String2Int8Array(e){for(var r=new Int8Array(e.length),t=0;t<e.length;t++)r.set([e.charCodeAt(t)],t);return r}function Path2FileName(e){if(_.isUndefined(e))return"";if(_.isEmpty(e))return"";var r=e.lastIndexOf("\\");return r<e.length?e.substring(r+1,e.length):e}function getRealMimeType(e){for(var r,t=new Uint8Array(e).subarray(0,4),n="",a=0;a<t.length;a++)n+=t[a].toString(16);switch(n){case"89504e47":r="image/png";break;case"47494638":r="image/gif";break;case"ffd8ffDB":case"ffd8ffe0":case"ffd8ffe1":case"ffd8ffe2":case"ffd8ffe3":case"ffd8ffe8":r="image/jpeg";break;default:r="unknown"}return r}function rmUnit(e){return Number(e.substring(0,e.length-2))}function findGetParameter(e){for(var r=null,t=[],n=location.search.substr(1).split("&"),a=0;a<n.length;a++)(t=n[a].split("="))[0]===e&&(r=decodeURIComponent(t[1]));return r}function nFormatter(e,r){var t,n=[{value:1,symbol:""},{value:1e3,symbol:"k"},{value:1e6,symbol:"M"},{value:1e9,symbol:"G"},{value:1e12,symbol:"T"},{value:1e15,symbol:"P"},{value:1e18,symbol:"E"}];for(t=n.length-1;t>0&&!(e>=n[t].value);t--);return(e/n[t].value).toFixed(r).replace(/\.0+$|(\.[0-9]*[1-9])0+$/,"$1")+n[t].symbol}function isSuperset(e,r){for(var t of r)if(!e.has(t))return!1;return!0}function union(e,r){var t=new Set(e);for(var n of r)t.add(n);return t}function intersection(e,r){var t=new Set;for(var n of r)e.has(n)&&t.add(n);return t}function difference(e,r){var t=new Set(e);for(var n of r)t.delete(n);return t}function detectBrowser(){var e=!!window.opr&&!!opr.addons||!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0;if(e)return"Opera";if("undefined"!=typeof InstallTrigger)return"Firefox";if(/constructor/i.test(window.HTMLElement)||"[object SafariRemoteNotification]"===(!window.safari||"undefined"!=typeof safari&&safari.pushNotification).toString())return"Safari";var r=!!document.documentMode;if(r)return"IE";if(!r&&!!window.StyleMedia)return"Edge";var t=!(!window.chrome||!window.chrome.webstore&&!window.chrome.runtime);if(t)return"Chrome";(t||e)&&window.CSS}function checkES6(){"use strict";try{eval("var foo = (x)=>x+1")}catch(e){return!1}return!0}function checkES7(){"use strict";try{eval("2**3")}catch(e){return!1}return!0}function checkES8(){"use strict";try{eval("async function f() { var a = await Promise.resolve(42); return a; } f();")}catch(e){return!1}return!0}function checkES9(){"use strict";try{eval("var a = {a:1}, b = {b:2}, c = { ...a, ...b }; var { ...d } = c;")}catch(e){return!1}return!0}function checkES10(){"use strict";try{eval("try { throw '' } catch { return true; }")}catch(e){return!1}return!0}function ab2str(e){return String.fromCharCode.apply(null,new Uint16Array(e))}function str2ab(e){for(var r=new ArrayBuffer(2*e.length),t=new Uint16Array(r),n=0,a=e.length;n<a;n++)t[n]=e.charCodeAt(n);return r}$.ajaxTransport("+binary",(function(e,r,t){if(window.FormData&&(e.dataType&&"binary"==e.dataType||e.data&&(window.ArrayBuffer&&e.data instanceof ArrayBuffer||window.Blob&&e.data instanceof Blob)))return{send:function(r,t){var n=new XMLHttpRequest,a=e.url,o=e.type,i=e.async||!0,u=e.responseType||"blob",f=e.data||null,s=e.username||null,c=e.password||null;for(var l in n.addEventListener("load",(function(){var r={};r[e.dataType]=n.response,t(n.status,n.statusText,r,n.getAllResponseHeaders())})),n.open(o,a,i,s,c),r)n.setRequestHeader(l,r[l]);n.responseType=u,n.send(f)},abort:function(){}}})),function(){function e(r,t,n){return void 0===n||0==+n?Math[r](t):(t=+t,n=+n,isNaN(t)||"number"!=typeof n||n%1!=0?NaN:t<0?-e(r,-t,n):(t=t.toString().split("e"),+((t=(t=Math[r](+(t[0]+"e"+(t[1]?+t[1]-n:-n)))).toString().split("e"))[0]+"e"+(t[1]?+t[1]+n:n))))}Math.round10||(Math.round10=function(r,t){return e("round",r,t)}),Math.floor10||(Math.floor10=function(r,t){return e("floor",r,t)}),Math.ceil10||(Math.ceil10=function(r,t){return e("ceil",r,t)})}();
!function(){var n=!1;datanodesManager.loadDatanodePlugin({type_name:"JSON_var_plugin",display_name:"Variable",icon_type:"json-variable.svg",description:"JavaScript workspace variable",external_scripts:[""],settings:[{name:"json_var",display_name:"Variable",type:"json",description:"JSON, array or primitive data type variable (with read/write permissions)"}],newInstance:function(r,t,a,i){return t(new e(r,a,i)),!n}});var e=function(e,r,t){n=!1;var a=this,i={},s=e,o=e,u="None";a.onSettingsChanged=function(n){return s=n,a.isJsonParsingSuccess()},a.isJsonParsingSuccess=function(){t("Pending");try{return i=JSON.parse(s.json_var),!0}catch(n){return swal("JSON Parse error",n.message,"error"),t("Error","Error in JSON parse"),!1}},a.isSettingNameChanged=function(n){return s.name!=n},a.getSavedSettings=function(){return[u,o]},a.updateNow=function(){return t("OK"),u="OK",o=s,s.json_var=JSON.stringify(i),r(i),!0},a.onDispose=function(){},this.isSetValueValid=function(){return!0},a.isSetFileValid=function(){return!0},a.isInternetNeeded=function(){return!1},a.setFile=function(n){return"application/json"===n.type?n.isBinary?s.json_var=atob(n.content):s.json_var=n.content:s.json_var=JSON.stringify(n),a.isJsonParsingSuccess()},a.setValue=function(n,e){if(0!=n.length)if(1==n.length)i[n[0]]=e;else{for(var r,t=0;t<n.length-1;t++)r=0==t?i[n[t]]:r[n[t]];r[n[n.length-1]]=e}else i=e},a.getValue=function(n){if(0==n.length)return i;if(1==n.length)return i[n[0]];for(var e,r=0;r<n.length-1;r++)e=0==r?i[n[r]]:e[n[r]];return e[n[n.length-1]]};try{i=JSON.parse(s.json_var),n=!1}catch(e){swal("JSON Parse error",e.message,"error"),n=!0}}}();
!function(){var e=!1;datanodesManager.loadDatanodePlugin({type_name:"JSON_delay_plugin",display_name:"Delay",icon_type:"delay.svg",description:"JavaScript one-step delay operator",external_scripts:[""],settings:[{name:"json_init",display_name:"init value",type:"json",description:"Initial value (JSON, array or primitive data type)"},{name:"json_input",display_name:"Input signal",type:"calculated",description1:"Write JavaScript formula to define JSON, array or primitive data type input to be delayed.",description2:"Browse and select a dataNode from workspace to use it in the formula."}],newInstance:function(t,r,a,i){return r(new n(t,a,i)),!e}});var n=function(n,t,r){e=!1;var a=this,i={},o={},s={},u=!0,d=n;a.onSettingsChanged=function(e){d=e;try{i=JSON.parse(d.json_init),d}catch(e){return swal("JSON Parse error",e.message,"error"),r("Error"),!1}return!0},a.isSettingNameChanged=function(e){return d.name!=e},a.updateNow=function(){if(r("Pending"),u)try{u=!1,i=JSON.parse(d.json_init)}catch(e){return swal("JSON Parse error",e.message,"error"),r("Error"),t(void 0,"Error"),!1}return o=i,i="object"==typeof s?jQuery.extend(!0,{},s):s,r("OK"),t(o),"OK",d,!0},a.onDispose=function(){},this.isSetValueValid=function(){return!1},a.isSetFileValid=function(){return!1},a.isInternetNeeded=function(){return!1},a.onCalculatedValueChanged=function(e,n){s=n}}}();
!function(){var e=!1;datanodesManager.loadDatanodePlugin({type_name:"Memory_plugin",display_name:"Memory",icon_type:"memory.png",description:"Memory operator (past value)",external_scripts:[""],settings:[{name:"value_init",display_name:"initial value",type:"json",short_display:!0,default_value:0,description:"Initial value (number, boolean, JSON or array)"},{name:"datanode_origin",display_name:"DataNode origin",type:"option",from_datanode:!0,options:[],description:"Select the datanode origin for your past value"}],newInstance:function(t,a,r,i){return a(new n(t,r,i)),!e}});var n=function(n,t,a){e=!1;var r=this,i={},o=!0,s=n;r.onSettingsChanged=function(e){s=e;try{i=JSON.parse(s.value_init),s}catch(e){return swal("JSON Parse error",e.message,"error"),a("Error"),!1}return!0},r.isSettingNameChanged=function(e){return s.name!=e},r.updateNow=function(){if(a("Pending"),o)try{return o=!1,i=JSON.parse(s.value_init),a("OK"),t(i),"OK",s,!0}catch(e){return swal("JSON Parse error",e.message,"error"),a("Error"),t(void 0,"Error"),!1}i;let e=s.datanode_origin;if(!datanodesManager.foundDatanode(e)){const n="DataNode '"+e+"' does not exist in dataNodes list";return datanodeModel.statusCallback("Error",n),datanodeModel.notificationCallback("error",datanodeModel.name(),n),!1}let n=datanodesManager.getDataNodeByName(e).latestData();return i="object"==typeof n?jQuery.extend(!0,{},n):n,a("OK"),t(i),"OK",s,!0},r.onDispose=function(){},this.isSetValueValid=function(){return!0},r.isSetFileValid=function(){return!1},r.isInternetNeeded=function(){return!1},this.isSpecificExecution=function(){return!0},this.setValue=function(e,n){if(o=!0,0==e.length)return i=n,void(s.value_init=JSON.stringify(i));if(1==e.length)i[e[0]]=n;else{for(var t,a=0;a<e.length-1;a++)t=0==a?i[e[a]]:t[e[a]];t[e[e.length-1]]=n}s.value_init=JSON.stringify(i)}}}();
!function(){var e=!1;datanodesManager.loadDatanodePlugin({type_name:"JSON_formula_plugin",display_name:"Script (client-side)",icon_type:"json-formula.svg",description:"JavaScript Script (client-side) plugin",external_scripts:[""],settings:[{name:"autoStart",display_name:"AUTO START",description:"DataNode is executed automatically at start (project load, its creation/modification).",type:"boolean",default_value:!0},{name:"explicitTrig",display_name:"Explicit trigger",description:"DataNode is executed only if triggered explicitly (no execution when its predecessors are updated). It is executed automatically once when AutoStart is “YES”.",type:"boolean",default_value:!1},{name:"json_var_formula",display_name:"Javascript formula",type:"calculated",description1:"Write Javascript formula that returns a JSON, array or primitive data type ouptput",description2:"Browse and select a dataNode from workspace to use it in the formula."}],newInstance:function(n,a,i,r,o){if(!a(new t(n,i,r,o)))return!e}});var t=function(t,n,a,i){e=!1;var r=this,o={},u=t,s=t,l="None";r.onSettingsChanged=function(e){return u=e,!0},r.isSettingNameChanged=function(e){return u.name!=e},r.getSavedSettings=function(){return[l,s]},r.updateNow=function(){return a("Pending"),_.isNull(o)||_.isUndefined(o)?(e=!0,text="Formula is null or undefined",a("Error",text),n(o,"Error"),!1):_.isObject(o)&&_.isEmpty(o)&&_.isEmpty(u.json_var_formula)?(e=!0,text="Formula is empty",i("warning",u.name,text,"Formula error"),a("Error",text),n(o,"Error"),!1):(e=!1,l="OK",s=u,a("OK"),n(o),!0)},r.onDispose=function(){},this.isSetValueValid=function(){return!1},r.isSetFileValid=function(){return!1},r.isInternetNeeded=function(){return!1},r.onCalculatedValueChanged=function(e,t){o=t}}}();
!function(){var e=!1;datanodesManager.loadDatanodePlugin({type_name:"Generic_file_reader_plugin",display_name:"Generic text file reader",icon_type:"text-file-reader.svg",description:"Read text files",external_scripts:[""],settings:[{name:"data_path",display_name:"Data file",description:"Browse to select file.",type:"browseText",required:!0}],newInstance:function(t,i,r,a){return i(new n(t,r,a)),!e}});var n=function(n,t,i){var r=null;e=!1;var a,o=this,s=n,u=n,c="None";o.onSettingsChanged=function(e,n){return"OK"===n&&(c=n,u=s),s=e,o.isFileReadingSuccess()},o.isFileReadingSuccess=function(){return i("Pending"),(a=o.readFileContent())==r?(i("Error","Error in file struct"),!1):(u=s,!0)},o.isSettingNameChanged=function(e){return s.name!=e},o.getSavedSettings=function(){return[c,u]},o.updateNow=function(){return c="OK",i("OK"),t(a),!0},o.onDispose=function(){},o.isSetValueValid=function(){return!1},o.isSetFileValid=function(){return!0},o.isInternetNeeded=function(){return!1},o.readFileContent=function(){return _.isUndefined(s.content)?r:{content:s.content}},o.setFile=function(e){return s.content=e.content,s.data_path=e.name,o.isFileReadingSuccess()},a=o.readFileContent(),e=a==r}}();
!function(){var e=!1;datanodesManager.loadDatanodePlugin({type_name:"Generic_binary_file_reader",display_name:"Generic binary file reader",icon_type:"file-reader.svg",description:"Read binary files",external_scripts:[""],settings:[{name:"data_path",display_name:"Data file",description:"Browse to select file.",type:"browseBinary",required:!0}],newInstance:function(t,i,r,a){return i(new n(t,r,a)),!e}});var n=function(n,t,i){var r=null;e=!1;var a,o=this,s=n,u=n,c="None";o.onSettingsChanged=function(e,n){return"OK"===n&&(c=n,u=s),s=e,o.isFileReadingSuccess()},o.isFileReadingSuccess=function(){return i("Pending"),(a=o.readFileContent())==r?(i("Error","Error in file struct"),!1):(u=s,!0)},o.isSettingNameChanged=function(e){return s.name!=e},o.getSavedSettings=function(){return[c,u]},o.updateNow=function(){return c="OK",i("OK"),t(a),!0},o.onDispose=function(){},o.isSetValueValid=function(){return!1},o.isSetFileValid=function(){return!0},o.isInternetNeeded=function(){return!1},o.readFileContent=function(){return _.isUndefined(s.content)?r:{content:s.content}},o.setFile=function(e){return s.content=e,s.data_path=e.name,o.isFileReadingSuccess()},a=o.readFileContent(),e=a==r}}();
!function(){var e=!1;datanodesManager.loadDatanodePlugin({type_name:"CSV_file_reader_plugin",display_name:"CSV file reader",icon_type:"csv-reader.svg",description:"Read CSV files",external_scripts:[],settings:[{name:"data_path",display_name:"Data file",description:"Browse to select CSV data file.",type:"browseText",required:!0},{name:"delimiter",display_name:"Delimiter",description:"The delimiting character. Leave auto to auto-detect.",type:"option",options:[{name:"auto",value:""},{name:"comma",value:","},{name:"semi-colon",value:";"},{name:"colon",value:":"},{name:"tabulation",value:"\t"},{name:"space",value:" "}]},{name:"eol",display_name:"Line endings",description:"The newline sequence. Leave auto to auto-detect.",type:"option",options:[{name:"auto",value:""},{name:"\\n",value:"\n"},{name:"\\r",value:"\r"},{name:"\\r\\n",value:"\r\n"}]},{name:"quote_char",display_name:"Quote Char",description:"The character used to quote fields. The quoting of all fields is not mandatory. Any field which is not quoted will correctly read.",type:"option",options:[{name:'"',value:'"'},{name:"'",value:"'"},{name:"empty",value:""}]},{name:"head",display_name:"Header line",description:"If true, the first row after metaData of parsed data will be interpreted as field names.",type:"boolean",default_value:!0},{name:"nb_meta_lines",display_name:"Number of metaData lines",type:"number",default_value:0,description:"If 0 no metaData exist before the header line. Otherwise metaData will be placed inside 'meta' object."},{name:"nb_subheader_lines",display_name:"Number of subheader lines",type:"number",default_value:0,description:"If 0 no subheader exist after the header line. Otherwise subheader will be placed inside 'subheader' object."},{name:"skip_empty_lines",display_name:"Skip empty lines",type:"boolean",default_value:!0},{name:"dynamic_typing",display_name:"Dynamic typing",description:"If true, numeric and boolean data will be converted to their type instead of remaining strings.",type:"boolean",default_value:!0},{name:"pluck",display_name:"Row to array",description:"If true, each row will be placed in an array.",type:"boolean",default_value:!0},{name:"embedding_object",display_name:"Embedd in content object",description:"If true, parsed file will be placed inside a top level 'content' object. It's true when metaData exist.",type:"boolean",default_value:!1}],newInstance:function(a,t,i,r){return t(new n(a,i,r)),!e}});var n=function(n,a,t){var i=null;e=!1;var r,s=this,l=n,o=n,d="None";s.onSettingsChanged=function(e,n){return"OK"===n&&(d=n,o=l),l=e,s.isFileParsingSuccess()},s.isFileParsingSuccess=function(){return t("Pending"),(r=s.parseFileContent())==i?(t("Error","Error in file parse"),!1):(o=l,!0)},s.isSettingNameChanged=function(e){return l.name!=e},s.getSavedSettings=function(){return[d,o]},s.updateNow=function(){return d="OK",t("OK"),a(r),!0},s.onDispose=function(){},s.isSetValueValid=function(){return!1},s.isSetFileValid=function(){return!0},s.isInternetNeeded=function(){return!1},s.parseFileContent=function(){papaSettings={delimiter:l.delimiter,newline:l.eol,quoteChar:l.quote_char,header:l.head,dynamicTyping:l.dynamic_typing,skipEmptyLines:l.skip_empty_lines};var e={},n={},a=l.content;if(_.isUndefined(a))return i;if(_.isUndefined(l.nb_meta_lines)&&(l.nb_meta_lines=0),_.isUndefined(l.nb_subheader_lines)&&(l.nb_subheader_lines=0),l.nb_meta_lines>0){let n=a.split("\n");var t=n.splice(0,l.nb_meta_lines);for(let n=0;n<t.length;n++)e["metaLine"+n]=t[n];a=n.join("\n")}if(l.nb_subheader_lines>0){let e=a.split("\n");var r=e.splice(1,l.nb_subheader_lines);for(let e=0;e<r.length;e++)n["subheaderLine"+e]=r[e],""!==l.delimiter&&(n["subheaderLine"+e]=n["subheaderLine"+e].split(l.delimiter));a=e.join("\n")}if(s.parserResults=Papa.parse(a,papaSettings),0==s.parserResults.errors.length){var o=s.parserResults.data,d={};if(l.pluck)for(let e=0;e<s.parserResults.meta.fields.length;e++)colName=s.parserResults.meta.fields[e],d[colName]=_.pluck(o,colName);else d=o;return(l.embedding_object||l.nb_meta_lines>0||l.nb_subheader_lines>0)&&(d={content:d},l.embedding_object=!0,l.nb_meta_lines>0&&(d.meta=e),l.nb_subheader_lines>0&&(d.subheader=n)),d}return _.isUndefined(s.parserResults.errors[0].row)?swal("Parser error : "+s.parserResults.errors[0].type,s.parserResults.errors[0].message+" in '"+l.data_path+"'.","error"):swal("Parser error : "+s.parserResults.errors[0].type,s.parserResults.errors[0].message+" in line '"+s.parserResults.errors[0].row+"' of "+l.data_path+"'.","error"),i},s.setFile=function(e){return l.data_path=e.name,e.isBinary?l.content=atob(e.content):l.content=e.content,s.isFileParsingSuccess()},r=s.parseFileContent(),e=r==i}}();
!function(){var e=!1;datanodesManager.loadDatanodePlugin({type_name:"CSV_file_player_plugin",display_name:"CSV file player",icon_type:"csv-player.svg",description:"Play csv files",external_scripts:[],settings:[{name:"data_path",display_name:"Data file",description:"Browse to select CSV data file.",type:"browseText",required:!0},{name:"delimiter",display_name:"Delimiter",description:"The delimiting character. Leave auto to auto-detect.",type:"option",options:[{name:"auto",value:""},{name:"comma",value:","},{name:"semi-colon",value:";"},{name:"colon",value:":"},{name:"tabulation",value:"\t"},{name:"space",value:" "}]},{name:"eol",display_name:"Line endings",description:"The newline sequence. Leave auto to auto-detect.",type:"option",options:[{name:"auto",value:""},{name:"\\n",value:"\n"},{name:"\\r",value:"\r"},{name:"\\r\\n",value:"\r\n"}]},{name:"quote_char",display_name:"Quote Char",description:"The character used to quote fields. The quoting of all fields is not mandatory. Any field which is not quoted will correctly read.",type:"option",options:[{name:'"',value:'"'},{name:"'",value:"'"},{name:"empty",value:""}]},{name:"head",display_name:"Header line",description:"If true, the first row after metaData of parsed data will be interpreted as field names.",type:"boolean",default_value:!0},{name:"nb_meta_lines",display_name:"Number of metaData lines",type:"number",default_value:0,description:"If 0 no metaData exist before the header line. Otherwise metaData will be placed inside 'meta' object."},{name:"nb_subheader_lines",display_name:"Number of subheader lines",type:"number",default_value:0,description:"If 0 no subheader exist after the header line. Otherwise subheader will be placed inside 'subheader' object."},{name:"skip_empty_lines",display_name:"Skip empty lines",type:"boolean",default_value:!0},{name:"dynamic_typing",display_name:"Dynamic typing",description:"If true, numeric and boolean data will be converted to their type instead of remaining strings.",type:"boolean",default_value:!0},{name:"sampleTime",display_name:"Sample time",type:"number",suffix:"seconds",default_value:1},{name:"time_included",display_name:"Time included",description:"If true, the first row will be considered as time vector.",type:"boolean",default_value:!1},{name:"playback",display_name:"Playback",description:"If true, data will be played back.",type:"boolean",default_value:!0}],newInstance:function(a,t,i,r){return t(new n(a,i,r)),!e}});var n=function(n,a,t){var i=null;e=!1;var r,s=this,l=n,o=n,d="None",u={},p=0,m=0,c={},f=0;s.onSettingsChanged=function(e,n){return"OK"===n&&(d=n,o=l),l=e,s.isFileParsingSuccess()},s.isFileParsingSuccess=function(){return f=0,t("Pending"),(r=s.parseFileContent())==i?(t("Error","Error in file parse"),!1):(o=l,!0)},s.isSettingNameChanged=function(e){return l.name!=e},this.isSettingSampleTimeChanged=function(e){return l.sampleTime!=e},s.getSavedSettings=function(){return[d,o]},s.updateNow=function(){return function(){for(var e=0;e<p;e++)l.nb_meta_lines>0||l.nb_subheader_lines>0?c[u[e]]=r.content[u[e]][f]:c[u[e]]=r[u[e]][f];f<m-1?f++:l.playback&&(f=0),d="OK",t("OK");var n={};l.nb_meta_lines>0&&(n.content=c,n.meta=r.meta),l.nb_subheader_lines>0&&(n.content=c,n.subheader=r.subheader),l.nb_meta_lines>0||l.nb_subheader_lines>0?a(n):a(c)}(),!0},s.onDispose=function(){},s.isSetValueValid=function(){return!1},s.isSetFileValid=function(){return!0},s.isInternetNeeded=function(){return!1},s.parseFileContent=function(){papaSettings={delimiter:l.delimiter,newline:l.eol,quoteChar:l.quote_char,header:l.head,dynamicTyping:l.dynamic_typing,skipEmptyLines:l.skip_empty_lines};var e={},n={},a=l.content;if(_.isUndefined(a))return i;if(_.isUndefined(l.nb_meta_lines)&&(l.nb_meta_lines=0),_.isUndefined(l.nb_subheader_lines)&&(l.nb_subheader_lines=0),l.nb_meta_lines>0){let n=a.split("\n");var t=n.splice(0,l.nb_meta_lines);for(let n=0;n<t.length;n++)e["metaLine"+n]=t[n];a=n.join("\n")}if(l.nb_subheader_lines>0){let e=a.split("\n");var o=e.splice(1,l.nb_subheader_lines);for(let e=0;e<o.length;e++)n["subheaderLine"+e]=o[e],""!==l.delimiter&&(n["subheaderLine"+e]=n["subheaderLine"+e].split(l.delimiter));a=e.join("\n")}if(s.parserResults=Papa.parse(a,papaSettings),0==s.parserResults.errors.length){var d=s.parserResults.data;p=s.parserResults.meta.fields.length,r={},c={},p>0&&(m=d.length);for(let e=0;e<p;e++){var f=s.parserResults.meta.fields[e];r[f]=_.pluck(d,f),u[e]=f}return l.nb_meta_lines>0&&(r.content=r,r.meta=e),l.nb_subheader_lines>0&&(r.content=r,r.subheader=n),r}return _.isUndefined(s.parserResults.errors[0].row)?swal("Parser error : "+s.parserResults.errors[0].type,s.parserResults.errors[0].message+" in '"+l.data_path+"'.","error"):swal("Parser error : "+s.parserResults.errors[0].type,s.parserResults.errors[0].message+" in line '"+s.parserResults.errors[0].row+"' of "+l.data_path+"'.","error"),i},s.setFile=function(e){return l.content=e,l.data_path=e.name,s.isFileParsingSuccess()},r=s.parseFileContent(),e=r==i}}();
!function(){var n=!1;datanodesManager.loadDatanodePlugin({type_name:"Unzip_file_plugin",display_name:"Unzip file",icon_type:"file-reader.svg",description:"unzip files",external_scripts:[""],settings:[{name:"data_path",display_name:"Data file",description:"Browse to select zipped file.",type:"unzip",required:!0}],newInstance:function(t,i,r,a){return i(new e(t,r,a)),!n}});var e=function(e,t,i){var r=null;n=!1;var a,u=this,o=e,s=e,c="None";u.onSettingsChanged=function(n,e){return"OK"===e&&(c=e,s=o),o=n,u.isFileReadingSuccess()},u.isFileReadingSuccess=function(){return i("Pending"),(a=u.readFileContent())==r?(i("Error","Error in file struct"),!1):(s=o,!0)},u.isSettingNameChanged=function(n){return o.name!=n},u.getSavedSettings=function(){return[c,s]},u.updateNow=function(){return c="OK",i("OK"),t(a),!0},u.onDispose=function(){},u.isSetValueValid=function(){return!1},u.isSetFileValid=function(){return!0},u.isInternetNeeded=function(){return!1},u.readFileContent=function(){return _.isUndefined(o.content)?r:o.content},u.setFile=function(n){return o.content=n.content,o.data_path=n.name,u.isFileReadingSuccess()},a=u.readFileContent(),n=a==r}}();
!function(){var e=function(e,n,t,r,a){var o,i=this,s="",c=e,l=!0,E=new Array,d=!0,y="",u=!1,A=!0,f={debug:!0,automaticOpen:!0,reconnectInterval:1e3,maxReconnectInterval:3e4,reconnectDecay:1.5,timeoutInterval:2e3,maxReconnectAttempts:4,binaryType:"arraybuffer"},p=function(){console.info("Connected to server ",s),r("success",c.name,"Connected to server "+s),u=!0,A=!0,_.isUndefined(c.init_value)||(l=!0),a("Ready")},S=function(){console.info("WebSocket Connection is closed..."),r("info",c.name,"WebSocket Connection is closed..."),u&&a("Stop"),u=!1},T=function(e){console.debug("WebSocket  (%s) OnError ",s,e),A&&(r("error",c.name,"WebSocket  ("+s+") error"),A=!1),a("NotReady"),u=!1},R=function(e){y=e.data,d?(d=!1,console.info("WebSocket received ",e.data),E="string"==typeof e.data||e.data instanceof String?e.data:v(e.data,c.decoding_options),t("OK"),n(E),console.info("Data processed ",E)):a("Ready")};function m(){o&&o.close(),console.log(c),s="ws://"+c.host+":"+c.port,(o=new ReconnectingWebSocket(s,[],f)).onopen=p,o.onerror=T,o.onmessage=R,o.onclose=S}function g(e,n=!0){_.isUndefined(o)||1!==o.readyState||(1==n?o.send(JSON.stringify(e)):o.send(e))}function v(e,n){if("JSON"===n.toUpperCase()){try{e=JSON.parse(e)}catch(e){console.log(e)}return e}var t,r,a,o=e.byteLength,i=new DataView(e),s=0,c=0;switch(n.toUpperCase()){case"ARRAYBUFFER2STRING":r=String.fromCharCode.apply(null,new Uint8Array(e));break;case"INT8ARRAY":for(a=Int8Array.BYTES_PER_ELEMENT,t=o/Int8Array.BYTES_PER_ELEMENT,t=Math.floor(t),r=new Array(t),s=0,c=0;s<t;s++,c+=a)r[s]=i.getInt8(c);break;case"UINT8ARRAY":for(a=Uint8Array.BYTES_PER_ELEMENT,t=o/Uint8Array.BYTES_PER_ELEMENT,t=Math.floor(t),r=new Array(t),s=0,c=0;s<t;s++,c+=a)r[s]=i.getUint8(c);break;case"INT16ARRAY":for(a=Int16Array.BYTES_PER_ELEMENT,t=o/Int16Array.BYTES_PER_ELEMENT,t=Math.floor(t),r=new Array(t),s=0,c=0;s<t;s++,c+=a)r[s]=i.getInt16(c,!0);break;case"UINT16ARRAY":for(a=Uint16Array.BYTES_PER_ELEMENT,t=o/Uint16Array.BYTES_PER_ELEMENT,t=Math.floor(t),r=new Array(t),s=0,c=0;s<t;s++,c+=a)r[s]=i.getUint16(c,!0);break;case"INT32ARRAY":for(a=Int32Array.BYTES_PER_ELEMENT,t=o/Int32Array.BYTES_PER_ELEMENT,t=Math.floor(t),r=new Array(t),s=0,c=0;s<t;s++,c+=a)r[s]=i.getInt32(c,!0);break;case"UINT32ARRAY":for(a=Uint32Array.BYTES_PER_ELEMENT,t=o/Uint32Array.BYTES_PER_ELEMENT,t=Math.floor(t),r=new Array(t),s=0,c=0;s<t;s++,c+=a)r[s]=i.getUint32(c,!0);break;case"FLOAT32ARRAY":for(a=Float32Array.BYTES_PER_ELEMENT,t=o/Float32Array.BYTES_PER_ELEMENT,t=Math.floor(t),r=new Array(t),s=0,c=0;s<t;s++,c+=a)r[s]=i.getFloat32(c,!0);break;case"FLOAT64ARRAY":for(a=Float64Array.BYTES_PER_ELEMENT,t=o/Float64Array.BYTES_PER_ELEMENT,t=Math.floor(t),r=new Array(t),s=0,c=0;s<t;s++,c+=a)r[s]=i.getFloat64(c,!0);break;default:for(a=Uint8Array.BYTES_PER_ELEMENT,t=o/Uint8Array.BYTES_PER_ELEMENT,t=Math.floor(t),r=new Array(t),s=0,c=0;s<t;s++,c+=a)r[s]=i.getUint8(c)}return r}i.onSettingsChanged=function(e,n){return"OK"===n&&(n,c),c.host!=e.host||c.port!=e.port||!u||!_.isUndefined(e.init_value)&&c.init_value!=e.init_value?(c=e,d=!0,a("Wait"),m()):c=e,c,!0},i.isSettingNameChanged=function(e){return c.name!=e},i.updateNow=function(){var e;if(d){if(1===o.readyState&&(t("Pending"),!_.isUndefined(c.init_value)&&l&&(l=!1,"none"!=c.init_value)))if(function(e){try{JSON.parse(e)}catch(e){return!1}return!0}(c.init_value)){try{e=jQuery.extend(!0,{},JSON.parse(c.init_value))}catch(e){return r("error",c.name,"JSON Parse error"+e.message),t("Error","JSON Parse error"),n(void 0,"Error"),!1}g(e,!0)}else g(e=c.init_value,!1)}else t("Pending"),console.info("WebSocket received ",y),E="string"==typeof y||y instanceof String?y:v(y,c.decoding_options),t("OK"),n(E),console.info("Data processed ",E);return!0},i.onDispose=function(){o&&o.close()},i.onstop=function(){o&&o.close()},i.isSetValueValid=function(){return!1},i.isSetFileValid=function(){return!1},a("Wait"),d=!0,m()};datanodesManager.loadDatanodePlugin({type_name:"WS-receive-plugin",display_name:"WebSocket Receive",icon_type:"websocket.svg",description:"Websocket client to receive data in Chalk'it",external_scripts:[""],settings:[{name:"host",display_name:"Remote IP address",type:"text",description:"IP address or hostname of your remote WebSocket sender.",required:!0},{name:"port",display_name:"Remote IP port",type:"number",description:"The port to connect to your remote WebSocket sender.",required:!0},{name:"autoStart",display_name:"AUTO START",description:"DataNode is executed automatically at start (project load, its creation/modification).",type:"boolean",default_value:!0},{name:"init_value",display_name:"initializing token",type:"option",description:"This token is sent before the exchange begin. Normally only used if send to xMOD",options:[{name:"None",value:"none"},{name:"xMOD",value:"ws_init"}]},{name:"decoding_options",display_name:"Decoding options",description:"Decoding options applied on Response data.",type:"option",options:[{name:"JSON",value:"JSON"},{name:"Int8Array",value:"Int8Array"},{name:"Uint8Array",value:"Uint8Array"},{name:"Int16Array",value:"Int16Array"},{name:"Uint16Array",value:"Uint16Array"},{name:"Int32Array",value:"Int32Array"},{name:"Uint32Array",value:"Uint32Array"},{name:"Float32Array",value:"Float32Array"},{name:"Float64Array",value:"Float64Array"},{name:"Text",value:"Text"},{name:"ArrayBuffer2String",value:"ArrayBuffer2String"}]}],newInstance:function(n,t,r,a,o,i){return t(new e(n,r,a,o,i)),!0}})}();
!function(){var e=function(e,t,i,o,r){var a,s=this,c="",d=e,l=!0,u={},p=!1,m=!0,f={debug:!0,automaticOpen:!0,reconnectInterval:1e3,maxReconnectInterval:3e4,reconnectDecay:1.5,timeoutInterval:2e3,maxReconnectAttempts:4,binaryType:"arraybuffer"},y=function(){console.info("Connected to server ",c),o("success",d.name,"Connected to server "+c),m=!0,p=!0,_.isUndefined(d.init_value)||(l=!0),r("Ready")},g=function(){console.info("WebSocket Connection is closed..."),o("info",d.name,"WebSocket Connection is closed..."),p&&r("Stop"),p=!1},S=function(e){console.debug("WebSocket  (%s) OnError ",c,e),m&&(o("error",d.name,"WebSocket  ("+c+") error"),m=!1),r("NotReady")},v=function(e){};function b(){a&&a.close(),console.log(d),c="ws://"+d.host+":"+d.port,(a=new ReconnectingWebSocket(c,[],f)).onopen=y,a.onerror=S,a.onmessage=v,a.onclose=g}function h(e,n=!0){_.isUndefined(a)||1!==a.readyState||a.send(e)}s.onSettingsChanged=function(e,n){return"OK"===n&&(n,d),d.host!=e.host||d.port!=e.port||!p||!_.isUndefined(e.init_value)&&d.init_value!=e.init_value?(d=e,r("Wait"),b()):d=e,d,!0},s.isSettingNameChanged=function(e){return d.name!=e},s.isSettingSampleTimeChanged=function(e){return d.sampleTime!=e},s.updateNow=function(e){var r;if(e&&d.sampleTime>0&&d.explicitTrig&&(o("warning",d.name,'Explicit Trigger option is turned off (False) because "'+d.name+'" is periodic and was triggered explicitly'),d.explicitTrig=!1),1===a.readyState){if(i("Pending"),!_.isUndefined(d.init_value)&&l&&(l=!1,"none"!=d.init_value))if(function(e){try{JSON.parse(e)}catch(e){return!1}return!0}(d.init_value)){try{r=jQuery.extend(!0,{},JSON.parse(d.init_value))}catch(e){return o("error",d.name,"Data Parse error"+e.message),i("Error","Data Parse error"),t(void 0,"Error"),!1}h(r,!0)}else h(r=d.init_value,!1);if(_.isNull(u)||_.isUndefined(u))return i("Error","script is null or undefined"),o("error",d.name,"script is null or undefined."),!1;if(_.isObject(u)&&_.isEmpty(u)&&_.isEmpty(d.json_input))return i("Error","JS script error"),n=!0,o("error",d.name,"JS script error: script cannot be empty."),!1;h(u),i("OK"),t(u)}return!0},s.onDispose=function(){a&&a.close()},s.onstop=function(){a&&a.close()},s.isSetValueValid=function(){return!1},s.isSetFileValid=function(){return!1},s.isInternetNeeded=function(){return!0},s.onCalculatedValueChanged=function(e,n){u=JSON.stringify(n)},r("Wait"),b()},n=!1;datanodesManager.loadDatanodePlugin({type_name:"WS-send-plugin",display_name:"WebSocket Send",icon_type:"websocket.svg",description:"Websocket client to send data to Chalk'it",external_scripts:[""],settings:[{name:"host",display_name:"Remote IP address",type:"text",description:"IP address or hostname of your remote WebSocket receiver.",required:!0},{name:"port",display_name:"Remote IP port",type:"number",description:"The port to connect to your remote WebSocket receiver.",required:!0},{name:"sampleTime",display_name:"Sample time",type:"number",default_value:0,suffix:"seconds",description:"Refresh rate for sending data. Data will be sent even if control values are not changed"},{name:"autoStart",display_name:"AUTO START",description:"DataNode is executed automatically at start (project load, its creation/modification).",type:"boolean",default_value:!0},{name:"explicitTrig",display_name:"Explicit trigger",description:"DataNode is executed only if triggered explicitly (no execution when its predecessors are updated). It is executed automatically once when AutoStart is “YES”.",type:"boolean",default_value:!1},{name:"init_value",display_name:"initializing token",type:"option",description:"This token is sent before the exchange begin. Normally only used if exchange with xMOD",options:[{name:"None",value:"none"},{name:"xMOD",value:"ws_init"}]},{name:"json_input",display_name:"JSON/Javascript input",type:"calculated",description1:"Can be literal JSON. Input to be sent.",description2:"Browse and select a dataNode from workspace to send it by web socket."}],newInstance:function(t,i,o,r,a,s){return i(new e(t,o,r,a,s)),!n}})}();
"true"!=xDashConfig.xDashBasicVersion&&function(){var o=function(o,t,n,a,i){error=!1;var r=this;r.errorState=!1;var s,c,l,u=o,d=o,g="None",p={lat:0,lng:0};function m(o){p={lat:o.coords.latitude,lng:o.coords.longitude},console.log(p),i("Ready")}function f(o){var e;1==o.code?(console.log("Error: Access is denied !"),e="Error: Access is denied !",a("error",u.name,e),i("NotReady")):2==o.code?(console.log("Error: Position is unavailable !"),e="Error: Position is unavailable !",a("error",u.name,e),i("NotReady")):3==o.code&&(console.log("Error: Timeout expired !"),e="Error: Timeout expired !",a("error",u.name,e),i("NotReady"))}r.onSettingsChanged=function(o,e){return"OK"===e&&(g=e,d=u),u=o,!0},r.isSettingNameChanged=function(o){return u.name!=o},r.getSavedSettings=function(){return[g,d]},r.updateNow=function(){n("Pending"),"watchPosition"==l&&(n("OK"),t(p))},r.onDispose=function(){"watchPosition"==l&&c.clearWatch(s)},r.isSetValueValid=function(){return!1},function(){if(c=navigator.geolocation){i("Wait");s=c.watchPosition(m,f,{maximumAge:0,timeout:5e3,enableHighAccuracy:!0}),l="watchPosition"}else console.log("Sorry, browser does not support geolocation"),swal("Browser support","Sorry, browser does not support geolocation","error"),e=!0}()},e=!1;datanodesManager.loadDatanodePlugin({type_name:"Geolocation-plugin",display_name:"Geolocation",icon_type:"geolocation.svg",description:"A geolocation plugin",external_scripts:[""],settings:[{name:"autoStart",display_name:"Auto start",description:"DataNode is executed automatically at start (project load, its creation/modification).",type:"boolean",default_value:!0}],newInstance:function(t,n,a,i,r,s){return n(new o(t,a,i,r,s)),!e}})}();
!function(){var e=!1;function t(e,t,n,a){var o=t.settings.name;e||(e='#example: create 2 datanodes py_a a,d py_b then use them as follow:\n# Example: add the values of 2 datanodes.\n# return dataNodes["py_a"] + dataNodes["py_b"];\n');var i=$('<div id="code-window-js" class="code-window cancel__box cancel__box--xl"></div>'),r=$('<div class="code-mirror-wrapper" id="codeWrapper"></div>'),d=$('<div class="cancel__box__bottom"></div>'),s=$('<div class="cancel__box__body"></div>'),l=$('<div class="cancel__box__top"><div class="code-window-header cm-s-ambiance">This Python script will be re-evaluated according to Chalk\'it execution engine rules, if one of the referenced input <code><span class="cm-def">dataNodes</span></code> is updated. The value you <code><span class="cm-keyword">return</span></code> will update the Chalk\'it workspace. You can assume this script is wrapped in a function with a <code><span class="cm-def">dataNodes</span></code> parameter containing the defined input dataNodes. <br>Press <code><span class="cm-keyword">ctrl-space</span></code> to activate autocompletion.</div></div>'),c=$('<div class="cancel__box__container"></div>');s.append([r]),c.append([l,s,d]),i.append([c]);var p=$('<div id="codeWindowContainer" class="cancel__container open"></div>');function u(e,t){t.pick(),e.execCommand("autocomplete")}p.append($('<div class="cancel__overlay"></div>')),p.append(i),$("body").append(p);var g=datanodesManager.getAllDataNodes().sort(((e,t)=>e.name().localeCompare(t.name()))),m=CodeMirror(r.get(0),{value:e,mode:{name:"python",globalVars:!0},theme:"eclipse",version:3,indentUnit:2,lineNumbers:!0,matchBrackets:!0,autoCloseBrackets:!0,lineWrapping:!1,showCursorWhenSelecting:!0,extraKeys:{"Ctrl-Space":"autocomplete","Alt-C":e=>e.toggleComment()},hintOptions:{hint:JSEditorCompletion.createCompletionFct(g),completeSingle:!1,extraKeys:{Tab:u,Right:u,Left:function(e,t){const n=e.getCursor(),a=n.line,o=e.getLine(a),i=n.ch,r=JSEditorCompletion.getPrecedingPathLength(o,i);r&&(e.replaceRange("",CodeMirror.Pos(a,i-r),CodeMirror.Pos(a,i)),t.close(),e.execCommand("autocomplete"))}}}});if([bFoundConnection,prop]=datanodesManager.isConnectedWithWidgt(o),bFoundConnection){var h='<div style="display: table-cell; padding: 10px"><span>Connected widget(s): </span></div>';_.each(prop,(e=>{h=h+'<div style="display: table-cell; padding: 10px"><input type="radio" id="'+e+'_radio" name="dataWidgetRadio" value="'+e+'" onchange="datanodesManager.previewWidget(this.value)"><label for="'+e+'_radio">'+e+"</label></div>"}));var w=$('<button id="dialog-widget" class="btn btn-rounded-fill primary" js-reset-toggle="">Show widget</button>').click((function(){if("Show widget"==$("#dialog-widget").text()){$("#code-window-js").width("80%"),$("#dialog-widget").text("Hide widget");var e="";_.each(prop,(t=>{e=e+'<div id="widget-preview-zone-'+t+'" ></div>'}));var t=$('<div id="code-widget-window-js"  style="width: 49%;float: right;z-index:5000;overflow:auto;height:100%"><div id="widgets-selection-header" class="code-window-header cm-s-ambiance" style="position:relative"><div style="display: table-row">'+h+'</div></div><div id="widgets-preview-top" class="code-widget-window-preview" style="display:flex; justify-content:center; background-color:white; border:1px dashed rgba(0, 0, 0, 0.5);"> '+e+"</div></div>");r.append(t),$("#"+prop[0]+"_radio").prop("checked",!0);_.each(prop,(e=>{!function(e){var t=[];$("#widgets-preview-top > div").each(((e,n)=>{t.push(n.id),$("#"+n.id).hide()})),$("#widget-preview-zone-"+e).show();var n=Math.min($("#"+e).height(),$("#code-widget-window-js").height()-40-$("#widgets-selection-header").height()),a=Math.min($("#"+e).width(),$("#code-widget-window-js").width()-100);$("#widget-preview-zone-"+e).width(a),$("#widget-preview-zone-"+e).height(n);var o=e.substring(0,e.length-1),i=widgetsPluginsHandler.copyWidget("widget-preview-zone-"+e,o,null,e,!0);null!=widgetConnector.widgetsConnection[e]&&(widgetConnector.widgetsConnection[e].widgetObjEdit=null,widgetConnector.widgetsConnection[e].widgetObjConnect=i)}(e)}));var n=prop[0];datanodesManager.previewWidget(n),$(".code-mirror-wrapper")[0].childNodes[0].style.float="left",$(".code-mirror-wrapper")[0].childNodes[0].style.width="50%"}else $("#dialog-widget").text("Show widget"),_.each(prop,(e=>{null!=widgetConnector.widgetsConnection[e]&&(widgetConnector.widgetsConnection[e].widgetObjEdit=null,widgetConnector.widgetsConnection[e].widgetObjConnect=null)})),$("#code-widget-window-js").remove(),$("#code-window-js").width("80%"),$(".code-mirror-wrapper")[0].childNodes[0].style.float="unset",$(".code-mirror-wrapper")[0].childNodes[0].style.width="unset"}));d.append(w);var v=$('<button id="apply-widget" class="btn btn-rounded-fill primary" js-reset-toggle="">Apply</button>').click((function(){t.settings[n.name]=m.getValue(),angular.element(document.getElementById("dash-datanode-ctrl")).scope().saveDataNodeSettings(!0)}));d.append(v)}var y=$('<button id="dialog-cancel" class="btn btn-rounded-fill primary" js-reset-toggle="">Close </button>').click((function(){if(a){var e=m.getValue();a(e),i.remove()}$("#codeWindowContainer").remove()}));d.append(y)}datanodesManager.loadDatanodePlugin({type_name:"Python_pyodide_plugin",display_name:"Script (Pyodide)",icon_type:"python.svg",description:"Python script (in client-side) plugin",external_scripts:[],settings:[{name:"autoStart",display_name:"AUTO START",description:"DataNode is executed automatically at start (project load, its creation/modification).",type:"boolean",default_value:!0},{name:"explicitTrig",display_name:"Explicit trigger",description:"DataNode is executed only if triggered explicitly (no execution when its predecessors are updated). It is executed automatically once when AutoStart is “YES”.",type:"boolean",default_value:!1},{name:"content",display_name:"Python script",type:"custom2",implementation:function(e,n,a,o){var i=$('<textarea autocorrect="off" autocomplete="off" spellcheck="false" class="calculated-value-input" style="display:none; width:78%"></textarea>');i.change((function(){o.settings[n.name]=$(this).val()})),i.val(""),n.name in a&&i.val(a[n.name]);var r=$('<div class="codemirror-wrapper__top"></div>'),d=$('<div class="calculated-setting-row codemirror-wrapper"></div>');d.append(r);var s=function(e,t,n){t||(t='#example: create 2 datanodes py_a a,d py_b then use them as follow:\n# Example: add the values of 2 datanodes.\n# return dataNodes["py_a"] + dataNodes["py_b"];\n');var a=$('<div class="codemirror-wrapper__content"></div>');function o(e,t){t.pick(),e.execCommand("autocomplete")}e.append(a);var i=datanodesManager.getAllDataNodes().sort(((e,t)=>e.name().localeCompare(t.name()))),r=CodeMirror(a.get(0),{value:t,mode:{name:"python",globalVars:!0},theme:"eclipse",version:3,indentUnit:2,lineNumbers:!0,matchBrackets:!0,autoCloseBrackets:!0,lineWrapping:!1,showCursorWhenSelecting:!0,extraKeys:{"Ctrl-Space":"autocomplete","Alt-C":e=>e.toggleComment()},hintOptions:{hint:JSEditorCompletion.createCompletionFct(i),completeSingle:!1,extraKeys:{Tab:o,Right:o,Left:function(e,t){const n=e.getCursor(),a=n.line,o=e.getLine(a),i=n.ch,r=JSEditorCompletion.getPrecedingPathLength(o,i);r&&(e.replaceRange("",CodeMirror.Pos(a,i-r),CodeMirror.Pos(a,i)),t.close(),e.execCommand("autocomplete"))}}}});r.doc.cm.on("change",(function(){var e=r.getValue();n(e)}));var d=r.getValue();return setTimeout((function(){r.refresh()}),1),n(d),r}(d,i.val(),(function(e){i.val(e),i.change()}));d.append(i),n.name in a&&i.val(a[n.name]);var l=$('<a>Full Screen view<i class="basic icn-full-screen""></i></a>').mousedown((function(e){e.preventDefault(),t(i.val(),o,n,(function(e){s.setValue(e),i.val(e),i.change()}))}));r.append(l),$(e).append(d)},description:"Python script to evaluate."}],newInstance:function(t,a,o,i,r){if(!a(new n(t,o,i,r)))return!e}});var n=function(t,n,a,o){var i,r=this,d=t;r.onSettingsChanged=function(t,n){return"OK"===n&&(n,d),d=t,r.runScriptSettings(),!e&&(d,!0)},r.isSettingNameChanged=function(e){return d.name!=e},r.updateNow=function(t,s){a("Pending");let l={};for(let e of s)l[e]=datanodesManager.getDataNodeByName(e).latestData();if(_.isUndefined(l)){return o("error",d.name,"The value of arguments is undefined"),a("Error","Arguments error"),n(void 0,"Error"),e=!0,!1}return r.runScript(i,l),!0},r.runScriptSettings=function(){if(e=!1,_.isEmpty(d.args))i=d.content;else{let e=d.args;e+="\n",i=e+d.content,d.content=i,d.args=""}return(_.isNull(i)||_.isUndefined(i)||""==i)&&(e=!0,swal("Script error","No python script was provided.","error")),angular.element(document.body).injector().invoke(["$rootScope",function(e){return!e.UserProfile}])||(i=i.replaceAll("datasources","dataNodes")),!0},r.errorAllTheThings=function(e,t=null,i="error",s="Error"){o(i,d.name,e),a(s,t||e),n(void 0,s),r.error=!0,r.pastStatus="Error"},r.runScript=async function(e,t){if(_.isEmpty(d.args))e=d.content;else{let t=d.args.replaceAll("return","args=");t+="\n",e=t+d.content}var i="";i=function(e,t,n,a){return e+="def runScript(dataNodes):\n",e+=function(e){return e.split(/\r?\n/).map((e=>"  "+e)).join("\n")+"\n"}(t="global globalScope\n"+t+"\n"),e+="import json\n",e+="import js\n",_.isEmpty(n)?e+="dataNodes = {};\n":(e+="dataNodes = {}\n",_.each(_.keys(n),(t=>{"Python_pyodide_plugin"==datanodesManager.getDataNodeByName(t).type()?t!=a&&(e=e+'dataNodes["'+t+'"] = globalScope["'+t+'"]\n'):e=e+'dataNodes["'+t+'"] = json.loads(js.JSON.stringify(js.datanodesManager.getDataNodeByName("'+t+'").latestData()))\n'}))),e=e+"\nimport os\nimport sys\nimport json\n\ndef is_jsonable(x):\n  try:\n    json.dumps(x)\n    return True\n  except (TypeError, OverflowError):\n    return False\n\nsys.stdout = open(os.devnull,'w')\nresult = runScript(dataNodes);\nsys.stdout = sys.__stdout__\nglobalScope['"+a+"']=result\nif is_jsonable(result):\n  resRet = json.dumps(result)\nelse:\n  if (str(type(result)) == \"<class 'pandas.core.frame.DataFrame'>\"):\n    resRet =  json.dumps(result.to_html(notebook=True, max_rows=4))\n  else :\n    resRet = json.dumps(str(type(result)));\n\nresRet\n"}(i,e=e.replaceAll("datasources","dataNodes"),t,d.name);const{standardLibs:s,micropipLibs:l}=pyodideManager.getProjectLibs(),c=_.isEqual(s,["matplotlib"]),p=_.isEqual(l,["plotly"]);if(c&&p||c&&!l.length||p&&!s.length||!l.length&&!s.length){const e=pyodideManager.getDefaultLibs();await pyodideManager.loadPyodideLibs(e)}try{i=(i=i.replaceAll("xDashApi","js.xDashApi")).replaceAll("chalkit","js.chalkit");const e=await pyodideManager.runPythonScript(i);u=e,data={},_.isUndefined(u)||("PyProxyClass"==u.constructor.name?data=u.toJs():data=JSON.parseMore(u)),"Stop"==datanodesManager.getDataNodeByName(d.name).schedulerStatus()?(a("None","Request is aborted"),n(void 0,"None"),o("info",d.name,"Response status 0 : abort")):(o("success",d.name,""),a("OK"),n(data),r.error=!1,r.pastStatus="OK",r.pastSettings=d)}catch(e){!function(e){const t=e;let n=t;n=t,"abort"===e?r.errorAllTheThings(n,t,"info","None"):r.errorAllTheThings(n,t)}(e)}var u;return!0},r.onDispose=function(){},this.getXHR=function(){},this.isSetValueValid=function(){return!1},r.isSetFileValid=function(){return!1},r.onCalculatedValueChanged=function(e,t){calculatedValue=t},r.runScriptSettings()}}();
!function(){var e=function(e,a,r,s,n){t=!1;var o,i,d=this,u=e,l="JSON",p="",c="",m="",y={};function f(){var e=u.url;switch(c=u.url,u.resp_data_type){case"JSON":l="json";break;case"binary":l="binary";break;case"text":l="text"}if(_.isUndefined(u.use_jsonp)||(u.use_jsonp=!1),u.use_jsonp&&(l="JSONP"),_.isUndefined(u.use_thingproxy)||(u.use_thingproxy?u.use_xproxy=!0:u.use_xproxy=!1),u.use_xproxy)switch(u.method){case"GET":c=xServConfig.urlxProxy+"Get";break;case"POST":c=xServConfig.urlxProxy+"Post";break;case"PUT":c=xServConfig.urlxProxy+"Put";break;case"DELETE":c=xServConfig.urlxProxy+"Delete"}if("calculated"!=s&&(p=u.body),p){try{y=JSON.parse(p),"GET"==u.method&&(p="")}catch(e){return swal("JSON Parse error",e.message,"error"),!1}_.isUndefined(y)||_.isNull(y)||_.isUndefined(y.urlAppend)||(u.use_xproxy?e=u.url+y.urlAppend:c+=y.urlAppend)}if(u.use_xproxy){var a={};if(_.each(u.headers,(function(e){var t=e.name,r=e.value;a[t]=r})),!_.isUndefined(y)&&!_.isNull(y)){if(_.isUndefined(y.headersFromDatasourceWS)||(y.headersFromDataNodeWS=y.headersFromDatasourceWS,delete y.headersFromDatasourceWS),!_.isUndefined(y.headersFromDataNodeWS))for(var t in y.headersFromDataNodeWS)a[t]=y.headersFromDataNodeWS[t];if(Array.isArray(y))for(let e=0;e<y.length;e++)if(_.isUndefined(y[e].headersFromDatasourceWS)||(y[e].headersFromDataNodeWS=y[e].headersFromDatasourceWS,delete y[e].headersFromDatasourceWS),!_.isUndefined(y[e].headersFromDataNodeWS))for(var t in y[e].headersFromDataNodeWS)a[t]=y[e].headersFromDataNodeWS[t]}var r="";if(p){let e=JSON.parse(p);if(!_.isUndefined(e)&&!_.isNull(e)&&(_.isUndefined(e.headersFromDatasourceWS)||delete e.headersFromDatasourceWS,_.isUndefined(e.headersFromDataNodeWS)||delete e.headersFromDataNodeWS,Array.isArray(e)))for(let a=0;a<e.length;a++)_.isUndefined(e[a].headersFromDatasourceWS)||delete e[a].headersFromDatasourceWS,_.isUndefined(e[a].headersFromDataNodeWS)||delete e[a].headersFromDataNodeWS;_.isUndefined(e)||_.isNull(e)||_.isUndefined(e.urlAppend)||delete e.urlAppend,r=JSON.stringify(e)}p={URL:e,Body:r,Headers:JSON.stringify(a)},p=JSON.stringify(p)}else if(p)try{let e=JSON.parse(p);if(!_.isUndefined(e)&&!_.isNull(e)&&(_.isUndefined(e.headersFromDatasourceWS)||delete e.headersFromDatasourceWS,_.isUndefined(e.headersFromDataNodeWS)||delete e.headersFromDataNodeWS,Array.isArray(e)))for(let a=0;a<e.length;a++)_.isUndefined(e[a].headersFromDatasourceWS)||delete e[a].headersFromDatasourceWS,_.isUndefined(e[a].headersFromDataNodeWS)||delete e[a].headersFromDataNodeWS;_.isUndefined(e)||_.isNull(e)||_.isUndefined(e.urlAppend)||delete e.urlAppend,p=JSON.stringify(e)}catch(e){return swal("Data Parse error",e.message,"error"),!1}function n(){let e=JSON.parse(p),a=JSON.parse(e.Headers);a["ProxyCode-Hash"]=u.proxyHash,a["ProxyCode-Sig"]=u.proxySig,e.Headers=JSON.stringify(a),p=JSON.stringify(e)}if(u.use_xproxy&&(l="JSON"),u.use_xproxy){_.isUndefined(u.proxyHash)&&(u.proxyHash=""),_.isUndefined(u.proxySig)&&(u.proxySig="");let a=new FileMngrFct;if(proxyHashTemp=a.Hash4Proxy(e,"xdash"),""!==u.proxyHash&&u.proxyHash.localeCompare(proxyHashTemp))n();else{u.proxyHash=proxyHashTemp;let e=JSON.stringify({Hash:u.proxyHash});i=$.ajax({url:xServConfig.urlxProxy+"Sign",type:"POST",contentType:"application/json; charset=utf-8",dataType:"json",data:e,success:function(e){var a=jQuery.parseJSON(e.d);return a.Success?(u.proxySig=a.Msg,n(),!0):(swal("Proxy signing error",a.Msg,"error"),u.proxySig="",!1)},error:function(e,a,t){return swal("Proxy signing error",e.statusText,"error"),u.proxySig="",!1}})}}return!0}function h(e,t,s){var i=null,d="",l=u.method;u.use_xproxy&&(l="POST"),o=$.ajax({url:e,dataType:t,type:l||"GET",data:s,responseType:"arraybuffer",beforeSend:function(e){try{if(u.use_xproxy)e.setRequestHeader("Content-Type","application/json");else if(_.each(u.headers,(function(a){var t=a.name,r=a.value;_.isUndefined(t)||_.isUndefined(r)||e.setRequestHeader(t,r)})),!_.isUndefined(y)&&!_.isNull(y)){if(_.isUndefined(y.headersFromDatasourceWS)||(y.headersFromDataNodeWS=y.headersFromDatasourceWS,delete y.headersFromDatasourceWS),!_.isUndefined(y.headersFromDataNodeWS))for(var a in y.headersFromDataNodeWS)e.setRequestHeader(a,y.headersFromDataNodeWS[a]);if(Array.isArray(y))for(let t=0;t<y.length;t++)if(_.isUndefined(y[t].headersFromDatasourceWS)||(y[t].headersFromDataNodeWS=y[t].headersFromDatasourceWS,delete y[t].headersFromDatasourceWS),!_.isUndefined(y[t].headersFromDataNodeWS))for(var a in y[t].headersFromDataNodeWS)e.setRequestHeader(a,y[t].headersFromDataNodeWS[a])}}catch(e){swal("Error",e.message,"error")}},success:function(e,t,s){if("Stop"==datanodesManager.getDataNodeByName(u.name).schedulerStatus())return r("None","Request is aborted"),a(void 0,"None"),n("info",u.name,"Response status 0 : abort"),!1;o=void 0;var i=s.getResponseHeader("Content-Type");if(_.isNull(i))return r("OK"),a(null),"OK",!0;if(i.match("application/json")){m=e;var l=[],p=0;for(var c in e)l[p]=c,p++;if(1==l.length&&"d"==l[0]){try{e=JSON.parseMore(e.d)}catch(e){return r("Error","Data parse error"),"Error",n("error",u.name,"Data parse error : "+e.message),void(bFinishTick=!0)}if(u.use_xproxy){if(!e.Success){var y="";return y=_.isUndefined(e.Message)?'xProxy returned error at dataNode "'+u.name+'"':'xProxy returned error at dataNode "'+u.name+'" : "'+e.Message+'"',d="Response status "+s.status+" :"+y,n("error",u.name,d),"Error",r("Error",d),!1}if(!_.isUndefined(e.Body))if(_.isUndefined(e.Headers["Content-Type"])){if(_.isNull(e.Body))return r("OK"),a(null),n("success",u.name,e.Message),"OK",!0}else{var f=e.Headers["Content-Type"];if(f.match("application/json"))try{e=JSON.parseMore(e.Body)}catch(e){return r("Error","Data parse error"),"Error",n("error",u.name,"Data parse error : "+e.message),void(bFinishTick=!0)}else if(f.match("text"))e={content:e.Body,type:f};else if(f.match("image")){e="base64ImageDetected"+e.Body}else e={content:e.Body,type:f};d="Response status "+s.status+" : "+s.statusText,n("success",u.name,d)}}else d="Response status "+s.status+" : "+s.statusText,n("success",u.name,d)}else d="Response status "+s.status+" : "+s.statusText,n("success",u.name,d)}else if(i.match("image")){e="base64ImageDetected"+base64ArrayBuffer(e),d="Response status "+s.status+" : "+s.statusText,n("success",u.name,d)}else if(i.match("text"))e={content:e,type:i},d="Response status "+s.status+" : "+s.statusText,n("success",u.name,d);else{e={content:base64ArrayBuffer(e),type:i},d="Response status "+s.status+" : "+s.statusText,n("success",u.name,d)}return r("OK"),a(e),"OK",!0},error:function(e,t,s){var i="error",l="Error";if(o=void 0,"abort"===t&&(i="info",l="None"),d=(d="Response status "+e.status+" : "+e.statusText)+". Ajax status: "+t,"Error",_.isUndefined(e.responseText))n(i,u.name,d);else{var p="",c=e.responseText.search("type"),m=e.responseText.search(">");p=-1!=c&&-1!=m?e.responseText.slice(c,m):e.responseText,n(i,u.name,d+". "+p)}return r(l,d),a(void 0,l),!1},complete:function(e,a){clearInterval(i)}}),i=setInterval((function(){navigator.onLine||_.isUndefined(o)||(datanodesManager.getDataNodeByName(u.name).completeExecution("NOP"),datanodesManager.getDataNodeByName(u.name).schedulerStatus("Stop"),n("error",u.name,"Internet is disconnected. Request of '"+u.name+"' wil be aborted"),o.abort())}),1e3)}this.getRestResponseData=function(){return m},this.updateNow=function(e){return e&&u.sampleTime>0&&u.explicitTrig&&(n("warning",u.name,'Explicit Trigger option is turned off (False) because "'+u.name+'" is periodic and was triggered explicitly'),u.explicitTrig=!1),r("Pending"),function(e,a,t){o&&4!=o.readyState&&o.abort();i&&4!=i.readyState?i.done((function(){h(e,a,t=p)})):h(e,a,t)}(c,l,p),!0},this.onDispose=function(){},this.onSettingsChanged=function(e,a){"OK"===a&&(a,u),u=e;for(var t=0;t<u.headers.length;t++)""===u.headers[t].name&&u.headers.splice(t,t+1);var r=f();return r&&u,r},this.isSettingNameChanged=function(e){return u.name!=e},this.isSettingSampleTimeChanged=function(e){return u.sampleTime!=e},this.getXHR=function(){return o},this.isSetValueValid=function(){return!1},d.isSetFileValid=function(){return!1},d.isInternetNeeded=function(){return!0},t=!f(),"calculated"==s&&(d.onCalculatedValueChanged=function(e,a){p=JSON.stringify(a),f()})};function a(){if(_.isUndefined($("input#table-row-value-headers0")[0]))console.log("headers table is empty");else{var e=$("input#table-row-value-headers0"),a=$("input#table-row-value-headers1");switch($("select#select-option-req_data_type").val()){case"JSON":e[0].value="Content-Type",a[0].value="application/json";break;case"none":e[0].value="",a[0].value=""}var t=new CustomEvent("change");$("input#table-row-value-headers0")[0].dispatchEvent(t),$("input#table-row-value-headers1")[0].dispatchEvent(t)}}var t=!1;datanodesManager.loadDatanodePlugin({type_name:"REST_web-service_from_datasource",display_name:"REST Web-service",icon_type:"web-service-datasource.svg",description:"REST Web-service from dataNode workspace",settings:[{name:"url",display_name:"URL",type:"text",required:!0},{name:"use_xproxy",display_name:"Use xProxy",description:"xProxy allows your browser to call cross-domain REST APIs (which solves browser CORS policy issues). Keep this parameter to true, unless your distant REST API allows your browser to be called in a cross-origin context.",type:"boolean",default_value:!0},{name:"sampleTime",display_name:"Sample time",type:"number",suffix:"seconds",default_value:0},{name:"autoStart",display_name:"AUTO START",description:"DataNode is executed automatically at start (project load, its creation/modification).",type:"boolean",default_value:!0},{name:"explicitTrig",display_name:"Explicit trigger",description:"DataNode is executed only if triggered explicitly (no execution when its predecessors are updated). It is executed automatically once when AutoStart is “YES”.",type:"boolean",default_value:!1},{name:"req_data_type",display_name:"Request data-type",type:"option",description:"Choose the web-service request data-type that prefill automatically the first header.",options:[{name:"JSON",value:"JSON"},{name:"none",value:"none"}]},{name:"resp_data_type",display_name:"Response data-type",type:"option",description:"Choose the response data-type expected from the web-service.",options:[{name:"JSON",value:"JSON"},{name:"binary",value:"binary"},{name:"text",value:"text"}]},{name:"method",display_name:"Method",type:"option",options:[{name:"GET",value:"GET"},{name:"POST",value:"POST"},{name:"PUT",value:"PUT"},{name:"DELETE",value:"DELETE"}]},{name:"body",display_name:"Body",type:"calculated",description1:"Insert the body of the request. Normally only used if method is POST. If the method is GET, the content of urlAppend object will be appended to the URL. The content of headersFromDataNodeWS will be injected to headers",description2:"Browse and select a dataNode from workspace to use it in the body."},{name:"headers",display_name:"Headers",type:"array",settings:[{name:"name",display_name:"Name",type:"text"},{name:"value",display_name:"Value",type:"text"}],default_value:[{name:"Content-Type",value:"application/json"}],description:"The first header is 'READ ONLY' and reserved for Request Data-Type."}],newInstance:function(a,r,s,n,o){return r(new e(a,s,n,"calculated",o)),!t},preFillBody:function(){a()}}),xDashConfig.jsonEditorDatanodes&&datanodesManager.loadDatanodePlugin({type_name:"REST_web-service_from_JSON_editor",display_name:"REST Web-service from JSON editor",icon_type:"web-service-json-editor.svg",description:"REST Web-service from JSON editor",settings:[{name:"url",display_name:"URL",type:"text",required:!0},{name:"use_xproxy",display_name:"Use xProxy",description:"If that also fails due to CORS policy, you can use xProxy, which can solve many connection problems to APIs.",type:"boolean",default_value:!0},{name:"sampleTime",display_name:"Sample time",type:"number",suffix:"seconds",default_value:0},{name:"autoStart",display_name:"AUTO START",description:"DataNode is executed automatically at start (project load, its creation/modification).",type:"boolean",default_value:!0},{name:"req_data_type",display_name:"Request data-type",type:"option",description:"Choose the web-service request data-type that prefill automatically the first header.",options:[{name:"JSON",value:"JSON"},{name:"none",value:"none"}]},{name:"resp_data_type",display_name:"Response data-type",type:"option",description:"Choose the response data-type expected from the web-service.",options:[{name:"JSON",value:"JSON"},{name:"binary",value:"binary"},{name:"text",value:"text"}]},{name:"method",display_name:"Method",type:"option",options:[{name:"GET",value:"GET"},{name:"POST",value:"POST"},{name:"PUT",value:"PUT"},{name:"DELETE",value:"DELETE"}]},{name:"body",display_name:"Body",type:"json",description:'The body of the request. Normally only used if method is POST. If the method is GET, the content of "urlAppend" object it will be appended to the URL.'},{name:"headers",display_name:"Headers",type:"array",settings:[{name:"name",display_name:"Name",type:"text"},{name:"value",display_name:"Value",type:"text"}],default_value:[{name:"Content-Type",value:"application/json"}],description:"The first header is 'READ ONLY' and reserved for Request Data-Type."}],newInstance:function(a,r,s,n,o){return r(new e(a,s,n,"JSON",o)),!t},preFillBody:function(){a()}})}();
!function(){var e=function(e,n,i){t=!1;var a=e;this.updateNow=function(){i("Pending");var e=new Date,t={numeric_value:e.getTime(),full_string_value:e.toLocaleString(),date_string_value:e.toLocaleDateString(),time_string_value:e.toLocaleTimeString(),date_object:e};return i("OK"),n(t),!0},this.onDispose=function(){},this.onSettingsChanged=function(e,t){return"OK"===t&&(t,a),a=e,!0},this.isSettingNameChanged=function(e){return a.name!=e},this.isSettingSampleTimeChanged=function(e){return a.sampleTime!=e},this.isSetValueValid=function(){return!1},this.isSetFileValid=function(){return!1},this.isInternetNeeded=function(){return!1}},t=!1;datanodesManager.loadDatanodePlugin({type_name:"Clock_web-service",display_name:"Clock",icon_type:"clock.svg",description:"Clock trigger",settings:[{name:"sampleTime",display_name:"Sample time",type:"number",suffix:"seconds",default_value:1},{name:"autoStart",display_name:"AUTO START",description:"DataNode is executed automatically at start (project load, its creation/modification).",type:"boolean",default_value:!0}],newInstance:function(n,i,a,o){return i(new e(n,a,o)),!t}})}();
function widgetsPluginsHandlerClass(){var i=[],e=[],n=[],t=[],o=0;function s(i){for(var n in e){var t=_.keys(e[n].pluginDefinition.widgetsDefinitionList);if(_.contains(t,i))return e[n]}}return{loadWidgetPlugin:function(s){var d=s.pluginDefinition;n[o]=d,i[o]=d.name,e[o]=s,_.each(_.keys(d.widgetsDefinitionList),(i=>{t[i]=d.widgetsDefinitionList[i]})),o++},createWidget:function(i,e,n,t){var o=s(e);if(!_.isUndefined(o))return o.createWidget(i,e,n,t);console.log(e+" does not exist. Create widget failed")},copyWidget:function(i,e,n,t,o){var d=s(e);if(!_.isUndefined(d))return d.copyWidget(i,e,n,t,o);console.log(e+" does not exist. Copy widget failed")},widgetToolbarDefinitions:t}}var widgetsPluginsHandler=new widgetsPluginsHandlerClass;
let bRescaleNeededForModeSwitch=!1,currentDashboardScrollTop=0;function showEditMode(e,o){"widgets"==tabActive?"edit-dashboard"!=modeActive?("play-dashboard"==modeActive&&(currentDashboardScrollTop=$("#DropperDroitec").scrollTop()),$("#dashboard-preview-div").hide(0,(function(){$("#dashboard-editor-div").show(0,(function(){$("#dashboard-editor-div").removeClass("ng-hide"),switchToEditMode(e,o),setIsPlayModeStatus(!1)}))}))):switchToEditMode(e,o):console.log("showEditMode called while tabActive="+tabActive)}function showPlayMode(e){switchToPlayMode(e)}function switchToEditMode(e,o){if(bFirstExec){const e=getMedia();widgetEditor.setLastMedia(e)}e&&widgetEditor.resizeDashboard(),gridMgr.updateGrid(),document.dispatchEvent(tabWidgetsLoadedEvt),bFirstExec&&(bFirstExec=!1,widgetEditor.computeDropperMaxWidth()),modeActive="edit-dashboard",_.isUndefined(o)||o(),$("#DropperDroite").scrollTop(currentDashboardScrollTop)}function switchToPlayMode(){let e={};"edit-dashboard"==modeActive?(widgetEditor.updateSnapshotDashZoneDims(),e=xdash.serialize(),currentDashboardScrollTop=$("#DropperDroite").scrollTop(),widgetPreview.setScalingInformation(null,widgetEditor.getCurrentDashZoneDims().scalingMethod,layoutMgr.getRows(),layoutMgr.getCols()),widgetEditor.unselectAllWidgets(),$("#dashboard-editor-div").hide(0,(function(){$("#dashboard-preview-div").show(0,(function(){$("#dashboard-preview-div").removeClass("ng-hide");try{widgetPreview.loadPlayMode(e)}catch(e){console.log(e)}layoutMgr.makeColsTrasparent(),modeActive="play-dashboard",setIsPlayModeStatus(!0),$("#DropperDroitec").scrollTop(currentDashboardScrollTop),document.dispatchEvent(tabPlayLoadedEvt)}))}))):console.log("bad modeActive : "+modeActive+". Unable to switch to Play mode")}function setIsPlayModeStatus(e){const o=angular.element(document.body).scope().$root;o.bIsPlayMode!=e&&(o.bIsPlayMode=e,o.$apply())}function setEditPlaySwitchDisableStatus(e){const o=angular.element(document.body).scope().$root;o.bDisableEditPlaySwitch!=e&&(o.bDisableEditPlaySwitch=e,o.$apply())}
var offSchedLogUser=!0,ratioScroll=0,models={};modelsHiddenParams={},modelsTempParams={},modelsParameters={},modelsLayout={};try{var tabWidgetsLoadedEvt=new Event("widgets-tab-loaded"),tabPlayLoadedEvt=new Event("play-tab-loaded")}catch(e){}Date.prototype.today=function(){return(this.getDate()<10?"0":"")+this.getDate()+"/"+(this.getMonth()+1<10?"0":"")+(this.getMonth()+1)+"/"+this.getFullYear()},Date.prototype.timeNow=function(){return(this.getHours()<10?"0":"")+this.getHours()+":"+(this.getMinutes()<10?"0":"")+this.getMinutes()+":"+(this.getSeconds()<10?"0":"")+this.getSeconds()+":"+this.getMilliseconds()};var bFirstExec=!0,ua=navigator.userAgent.toLowerCase(),isAndroid=ua.indexOf("android")>-1;function isTouchDevice(){return"ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0}var isTouchDevice=isTouchDevice();function activeTab(){tabActive="widgets",setEditPlaySwitchDisableStatus(!1),"no-dashboard"==modeActive?(bRescaleNeededForModeSwitch=!0,showEditMode(!0,(function(){}))):console.log("tabActive="+tabActive+". modeActive="+modeActive)}function rescaleWidget(e,t){e[t].rescale()}function setDirtyFlagSafe(e){try{if("undefined"!=typeof execOutsideEditor){if(!execOutsideEditor)angular.element(document.body).scope().$root.updateFlagDirty(e)}else angular.element(document.body).scope().$root.updateFlagDirty(e)}catch(e){}}$((function(){$(window).on("resize",(function(){var e=angular.element(document.body).scope().$root;"play"==tabActive?isAndroid||isTouchDevice||widgetPreview.resizeDashboard():e.moduleOpened||"widgets"==tabActive&&("edit-dashboard"==modeActive?(widgetEditor.resizeDashboard(),gridMgr.updateGrid()):"play-dashboard"==modeActive&&widgetPreview.resizeDashboard())})),isAndroid||isTouchDevice||$(window).on("orientationchange",(function(){"play"==tabActive&&widgetPreview.resizeDashboard()}))})),window.mobileAndTabletCheck=function(){let e=!1;var t;return t=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(e=!0),e};
class WidgetPrototypesManager{static SCHEMA_VERSION="http://json-schema.org/draft-07/schema#";static ID_URI_SCHEME="json-schema:";static SCHEMA_ANYTHING={$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:anything"};static SCHEMA_STRING={$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:string",type:"string"};static SCHEMA_NUMBER={$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:number",type:"number"};static SCHEMA_STRING_ARRAY={$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:string_array",type:"array",items:{type:"string"}};static SCHEMA_NUMBER_ARRAY={$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:number_array",type:"array",items:{type:"number"}};static SCHEMA_BOOLEAN_ARRAY={$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:boolean_array",type:"array",items:{type:"boolean"}};static SCHEMA_NUMBER_ARRAY_2D={$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:number_array_2d",type:"array",items:{type:"array",items:{type:"number"}}};static SCHEMA_PRIMITIVE_ARRAY={$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:primitives_array",type:"array",items:{anyOf:[{type:"string"},{type:"number"},{type:"boolean"}]}};static SCHEMA_INTEGER={$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:integer",type:"integer"};static SCHEMA_BOOLEAN={$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:boolean",type:"boolean"};static SCHEMA_ANY_PRIMITIVE={$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:primitives",anyOf:[{type:"string"},{type:"number"},{type:"boolean"}]};static SCHEMA_ANY_OBJECT={$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:object",type:"object"};static SCHEMA_NUMBER_OR_STRING={$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:number_or_string",anyOf:[{type:"string"},{type:"number"}]};constructor(){this.ajv=new ajv7}getOrCompile(t){if(Array.isArray(t)){for(const e of t){const t=e.$id;this.ajv.getSchema(t)||this.ajv.addSchema(e)}return this.ajv.getSchema(t[0].$id)}const e=t.$id,a=this.ajv.getSchema(e);return a||this.ajv.compile(t)}formatErrors(t){const e=this;function a(t){return["anyOf","oneOf","allOf"].includes(t.keyword)}function r(t,e){let a=t.message;return"anyOf"===t.keyword?a="One the the following must be true":"const"===t.keyword&&void 0!==t.params.allowedValue&&(a=`${a} "${t.params.allowedValue}"`),new WidgetActuatorValidationError(t.instancePath?`"${t.instancePath}": ${a}`:a,e)}function s(t,a){return r(t,a=e.formatErrors(a))}let o,i=[];for(t=_.sortBy(t,(t=>t.schemaPath.length));o=t.find(a);){const e=o.schemaPath,a=[],r=[];for(const s of t)s!==o&&(s.schemaPath.startsWith(e)?a.push(s):r.push(s));i.push(s(o,a)),t=r}return i=[...i,...t.map((t=>r(t,[])))],i=i.sort(((t,e)=>t.compareTo(e))),i.filter(((t,e,a)=>0===e||0!==t.compareTo(a[e-1])))}}var widgetPrototypesManager=new WidgetPrototypesManager;
var workOnViewport=!0;function unitW(t){var e=(t*(100/document.documentElement.clientWidth)).toPrecision(23);return e+="vw"}function unitH(t){var e=(t*(100/document.documentElement.clientHeight)).toPrecision(23);return e+="vh"}function convertVwtoPx(t){return(t=rmUnit(t))/100*document.documentElement.clientWidth}function convertVhtoPx(t){return(t=rmUnit(t))/100*document.documentElement.clientHeight}function convertViewportToPx(t){return{left:convertVwtoPx(t.left),top:convertVhtoPx(t.top),width:convertVwtoPx(t.width),height:convertVhtoPx(t.height),minWidth:t.minWidth,minHeight:t.minHeight}}function inheritWcWidthFromPx(t){return(t-2)*(100/document.documentElement.clientWidth)+"vw"}function inheritWcHeightFromPx(t){return(t-2)*(100/document.documentElement.clientHeight)+"vh"}function inheritWcWidthFromIdInst(t){var e=t;return"play"==tabActive&&(e+="c"),inheritWcWidthFromPx($("#"+e).width)}function inheritWcHeightFromIdInst(t){var e=t;return"play"==tabActive&&(e+="c"),inheritWcHeightFromPx($("#"+e).height)}function getMedia(){return window.matchMedia("(min-width: 768px)").matches?"large":"small"}function isMediaChanged(t){var e=!1;return"small"==t&&window.matchMedia("(min-width: 768px)").matches?(t="large",e=!0):"large"==t&&window.matchMedia("(max-width: 767px)").matches?(t="small",e=!0):e=!1,{bChanged:e,lastMedia:t}}function getFontFactor(){return"play"==tabActive?window.matchMedia("(min-width: 768px)").matches?1:widgetPreview.getCols()||1:"widgets"==tabActive?window.matchMedia("(min-width: 768px)").matches?1:layoutMgr.getCols()||1:1}
function basePlugin(i=void 0){i&&(this.pluginDefinition=i),this.widgetsCount={},Object.keys(this.pluginDefinition.widgetsDefinitionList).forEach((i=>this.widgetsCount[i]=0)),this.createWidget=function(i,t,n,e){this.widgetsCount[t]++;const s=this.pluginDefinition.widgetsDefinitionList[t].factory;return new("function"==typeof s?s:this[s])(i,this.widgetsCount[t],n,e)},this.copyWidget=function(i,t,n,e,s){return this.createWidget(i,t,e,s)},this.clear=function(){Object.keys(this.pluginDefinition.widgetsDefinitionList).forEach((i=>this.widgetsCount[i]=0))}}
function baseWidget(e,o,t,r){this.idDivContainer=e,this.idWidget=o,this.idInstance=t,this.bIsInteractive=r,this.getColorValueFromCSSProperty=function(e){let o=e;if(o.includes("var(--")){const t=e.substring(4,e.length-1);o=window.getComputedStyle(document.documentElement).getPropertyValue(t)}return o},this.setColorValueFromModelParameters=function(e,o){let r=o;_.isUndefined(modelsParameters[t][e])?modelsParameters[t][e]=o:r=modelsParameters[t][e];return this.getColorValueFromCSSProperty(r)},this.labelFontSize=function(){return"font-size: calc(7px + "+modelsParameters[t].labelFontSize*getFontFactor()+"vw + 0.4vh); "},this.valueFontSize=function(){return"font-size: calc(7px + "+modelsParameters[t].valueFontSize*getFontFactor()+"vw + 0.4vh); "},this.valueFormat=function(e){const o=parseInt(modelsParameters[t].decimalDigits,10);if(isNaN(o))return e;let r=e;if(-1!=o&&!isNaN(e)){if(r=parseFloat(e),isNaN(r))return e;r=Math.round10(r,-o)}return r},this.fontSize=function(){return"font-size: calc(7px + "+modelsParameters[t].fontsize*getFontFactor()+"vw + 0.4vh); "},this.labelColor=function(){return"color:"+this.setColorValueFromModelParameters("labelColor","var(--widget-label-color)")+"; "},this.valueColor=function(){return"color:"+this.setColorValueFromModelParameters("valueColor","var(--widget-color)")+"; "},this.labelFontFamily=function(){_.isUndefined(modelsParameters[t].labelFontFamily)&&(modelsParameters[t].labelFontFamily="Helvetica Neue");return"font-family: "+modelsParameters[t].labelFontFamily+", Helvetica, Arial, sans-serif; "},this.valueFontFamily=function(){_.isUndefined(modelsParameters[t].valueFontFamily)&&(modelsParameters[t].valueFontFamily="Helvetica Neue");return"font-family: "+modelsParameters[t].valueFontFamily+", Helvetica, Arial, sans-serif; "},this.border=function(){let e="border: none; ";if(modelsParameters[t].displayBorder){const o=this.setColorValueFromModelParameters("borderColor","var(--widget-border-color)");e="border: "+this.setColorValueFromModelParameters("borderWidth","2px")+" solid "+o+"; "}else e+=NaN,e+="-moz-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0);",e+="box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0);";return e},this.captionHelper=function(e,o,r){o?modelsParameters[t].label=e:r?modelsParameters[t].inheritLabelFromData=!1:modelsParameters[t].label=e},this.backgroundColor=function(){return"background-color:"+this.setColorValueFromModelParameters("backgroundColor","#ffffff")+"; "},this.getTransformedText=function(e){let o=modelsParameters[t][e]||"";if(o){if(!($("<div>").html(o).children().length>0)){o=(new DOMParser).parseFromString("<!doctype html><body>"+o,"text/html").body.textContent}}return o},this.buttonFontFamily=function(){_.isUndefined(modelsParameters[t].buttonFontFamily)&&(modelsParameters[t].buttonFontFamily="Helvetica Neue");return"font-family: "+modelsParameters[t].buttonFontFamily+", Helvetica, Arial, sans-serif; "},this.setButtonColorStyle=function(){const e=this.setColorValueFromModelParameters("buttonDefaultColor","var(--widget-button-color)"),o=this.setColorValueFromModelParameters("buttonHoverColor","var(--widget-button-hover-color)"),l=this.setColorValueFromModelParameters("buttonActiveColor","var(--widget-button-active-color)"),a=this.setColorValueFromModelParameters("buttonTextColor","var(--widget-button-text)"),s="styleNormalFor"+t+"widgetCustomColor";let n=document.getElementById(s);const i="."+t+"widgetCustomColor{ color: "+a+";background-color: "+e+";border-color: "+e+"; }";if(null==n?(n=document.createElement("style"),n.type="text/css",n.id=s,n.innerHTML=i,document.getElementsByTagName("head")[0].appendChild(n)):n.innerHTML=i,r){const e="styleHoverFor"+t+"widgetCustomColor";let r=document.getElementById(e);const a="."+t+"widgetCustomColor:hover{ background-color: "+o+";border-color: "+o+";}";null==r?(r=document.createElement("style"),r.type="text/css",r.id=e,r.innerHTML=a,document.getElementsByTagName("head")[0].appendChild(r)):r.innerHTML=a;const s="styleActiveFor"+t+"widgetCustomColor";let n=document.getElementById(s);const i="."+t+"widgetCustomColor:active{ background-color: "+l+";border-color: "+l+";}";null==n?(n=document.createElement("style"),n.type="text/css",n.id=s,n.innerHTML=i,document.getElementsByTagName("head")[0].appendChild(n)):n.innerHTML=i}},this.displayIcon=function(){return _.isUndefined(modelsParameters[t].displayIcon)&&(modelsParameters[t].displayIcon=!1),modelsParameters[t].displayIcon},this.fontAwesomeIcon=function(){return _.isUndefined(modelsParameters[t].fontAwesomeIcon)&&(modelsParameters[t].fontAwesomeIcon=""),modelsParameters[t].fontAwesomeIcon},this.validationButtonDefaultColor=function(){return"background-color:"+this.setColorValueFromModelParameters("validationBtnDefaultColor","var(--widget-button-primary-color)")+"; "},this.validationButtonHoverColor=function(){return"background-color:"+this.setColorValueFromModelParameters("validationBtnHoverColor","var(--widget-button-hover-color)")+"; "},this.validationButtonActiveColor=function(){return"background-color:"+this.setColorValueFromModelParameters("validationBtnActiveColor","var(--widget-button-active-color)")+"; "},this.validationButtonBorderColor=function(){let e="border: none; ";if(modelsParameters[t].displayBorder){e="border: 2px solid "+this.setColorValueFromModelParameters("validationBtnDefaultColor","var(--widget-border-color)")+"; "}else e+="-webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0);",e+="-moz-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0);",e+="box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0);";return e},this.graphColor=function(){return this.setColorValueFromModelParameters("graphColor","var(--widget-label-color)")},this.subLabelFontFamily=function(){_.isUndefined(modelsParameters[t].subLabelFontFamily)&&(modelsParameters[t].subLabelFontFamily="Helvetica Neue");return"font-family: "+modelsParameters[t].subLabelFontFamily+", Helvetica, Arial, sans-serif; "},this.subLabelColor=function(){return"color:"+this.setColorValueFromModelParameters("subLabelColor","var(--widget-subtext-color)")+"; "},this.subLabelFontSize=function(){return"font-size: calc(7px + "+modelsParameters[t].subLabelFontSize*getFontFactor()+"vw + 0.4vh); "},this.checkedColor=function(){_.isUndefined(modelsParameters[t].checkboxColor)||delete modelsParameters[t].checkboxColor;return"color: "+this.setColorValueFromModelParameters("checkedColor","var(--widget-input-checked-color)")+"; "},this.uncheckedColor=function(){return"color: "+this.setColorValueFromModelParameters("uncheckedColor","var(--widget-input-unchecked-color)")+"; "},this.switchOnColor=function(){return"background-color: "+this.setColorValueFromModelParameters("switchOnColor","var(--widget-input-checked-color)")+"; "},this.switchOffColor=function(){return"background-color: "+this.setColorValueFromModelParameters("switchOffColor","var(--widget-input-unchecked-color)")+"; "},this.switchShadowColor=function(){return"box-shadow: 0 0 1px "+this.setColorValueFromModelParameters("switchOnColor","var(--widget-input-checked-color)")+"; "},this.progressBarRangeColor=function(){return"background-color: "+this.setColorValueFromModelParameters("progressBarRangeColor","var(--widget-range-color)")+"; "},this.progressBarSegmentColor=function(){return"background-color: "+this.setColorValueFromModelParameters("progressBarSegmentColor","var(--widget-segment-color)")+"; "},this.sliderRangeColor=function(){return"background-color: "+this.setColorValueFromModelParameters("sliderRangeColor","var(--widget-range-color)")+"; "},this.sliderSegmentColor=function(){return"background-color: "+this.setColorValueFromModelParameters("sliderSegmentColor","var(--widget-segment-color)")+"; "},this.sliderHandleDefaultColor=function(){return"background-color: "+this.setColorValueFromModelParameters("sliderHandleDefaultColor","var(--widget-handle-default-color)")+"; "},this.sliderHandleHoverColor=function(){return"background-color: "+this.setColorValueFromModelParameters("sliderHandleHoverColor","var(--widget-handle-hover-color)")+"; "},this.sliderHandleActiveColor=function(){return"background-color: "+this.setColorValueFromModelParameters("sliderHandleActiveColor","var(--widget-handle-active-color)")+"; "},this.valueBorderColor=function(){return"border-color: "+this.setColorValueFromModelParameters("valueBorderColor","var(--widget-border-color)")+"; "},this.textSize=function(){return"font-size: calc(7px + "+modelsParameters[t].textSize*getFontFactor()+"vw + 0.4vh); "},this.textColor=function(){return"color: "+this.setColorValueFromModelParameters("textColor","var(--widget-color)")+"; "},this.subTextColor=function(){return"color: "+this.setColorValueFromModelParameters("subTextColor","var(--widget-color)")+"; "},this.browseButtonTextColor=function(){const e=this.setColorValueFromModelParameters("browseButtonTextColor","var(--widget-button-text)");let o=" color: "+e+"; ";return o+=" border-color: "+e+"; ",o},this.browseButtonDefaultColor=function(){return" background-color: "+this.setColorValueFromModelParameters("browseButtonDefaultColor","var(--widget-button-color)")+"; "},this.browseButtonHoverColor=function(){return" background-color: "+this.setColorValueFromModelParameters("browseButtonHoverColor","var(--widget-button-hover-color)")+"; "},this.browseButtonActiveColor=function(){return" background-color: "+this.setColorValueFromModelParameters("browseButtonActiveColor","var(--widget-button-active-color)")+"; "},this.deleteButtonDefaultColor=function(){const e=this.setColorValueFromModelParameters("deleteButtonDefaultColor","var(--widget-delete-button-default-color)");let o=" background-color: "+e+"; ";return o+=" box-shadow: 0 0 2px 3px "+e+"; ",o},this.deleteButtonActiveColor=function(){const e=this.setColorValueFromModelParameters("deleteButtonActiveColor","var(--widget-delete-button-active-color)");let o=" background-color: "+e+"; ";return o+=" box-shadow: 0 0 2px 3px "+e+"; ",o},this.deleteButtonHoverColor=function(){const e=this.setColorValueFromModelParameters("deleteButtonHoverColor","var(--widget-delete-button-hover-color)");let o=" background-color: "+e+"; ";return o+=" box-shadow: 0 0 2px 3px "+e+"; ",o},this.listBackgroundColor=function(){return" background-color: "+this.setColorValueFromModelParameters("listBackgroundColor","var(--widget-select-drop-color)")+"; "},this.selectValueColor=function(){return" color: "+this.setColorValueFromModelParameters("selectValueColor","var(--widget-select-option-highlighted-text)")+"; "},this.selectValueBackgroundColor=function(){return" background-color: "+this.setColorValueFromModelParameters("selectValueBackgroundColor","var(--widget-select-option-highlighted-color)")+"; "},this.valueDefaultColor=function(){return" color: "+this.setColorValueFromModelParameters("valueDefaultColor","var(--widget-label-color)")+"; "},this.valueFocusColor=function(){return" color: "+this.setColorValueFromModelParameters("valueFocusColor","var(--widget-multiselect-checked-text)")+"; "},this.valueHoverColor=function(){return" color: "+this.setColorValueFromModelParameters("valueHoverColor","var(--widget-multiselect-hover-text)")+"; "},this.checkboxDefaultColor=function(){return" background-color: "+this.setColorValueFromModelParameters("checkboxDefaultColor","var(--widget-multiselect-color)")+"; "},this.checkboxFocusColor=function(){return" background-color: "+this.setColorValueFromModelParameters("checkboxFocusColor","var(--widget-multiselect-checked-color)")+"; "},this.checkboxHoverColor=function(){return" background-color: "+this.setColorValueFromModelParameters("checkboxHoverColor","var(--widget-multiselect-hover-color)")+"; "},this.checkboxHoverBorderColor=function(){return" border-color: "+this.setColorValueFromModelParameters("checkboxHoverBorderColor","var(--widget-multiselect-hover-border-color)")+"; "},this.checkboxFocusBorderColor=function(){return" border-color: "+this.setColorValueFromModelParameters("checkboxFocusBorderColor","var(--widget-multiselect-checked-border-color)")+"; "},this.checkboxWidth=function(){_.isUndefined(modelsParameters[t].checkboxWidth)&&(modelsParameters[t].checkboxWidth=7);return" width: "+modelsParameters[t].checkboxWidth+"rem; "},this.checkboxHeight=function(){_.isUndefined(modelsParameters[t].checkboxHeight)&&(modelsParameters[t].checkboxHeight=1.5);return" line-height: "+modelsParameters[t].checkboxHeight+"; "},this.checkboxBorder=function(){let e="border: none; ";if(modelsParameters[t].displayBorder){e=" border: 1.5px solid "+this.setColorValueFromModelParameters("checkboxBorderColor","var(--widget-multiselect-border-color)")+"; "}else e+="-webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0);",e+="-moz-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0);",e+="box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0);";return e},this.selectFontSize=function(){_.isUndefined(modelsParameters[t].selectValueFontSize)&&(modelsParameters[t].selectValueFontSize=modelsParameters[t].labelFontSize);return"font-size: calc(7px + "+modelsParameters[t].selectValueFontSize*getFontFactor()+"vw + 0.4vh); "},this.selectValueFontFamily=function(){_.isUndefined(modelsParameters[t].selectValueFontFamily)&&(modelsParameters[t].selectValueFontFamily="Helvetica Neue");return"font-family: "+modelsParameters[t].selectValueFontFamily+", Helvetica, Arial, sans-serif; "},this.selectedValueColor=function(){return" color: "+this.setColorValueFromModelParameters("selectedValueColor","var(--widget-select-option-highlighted-text)")+"; "},this.selectedItemDefaultColor=function(){return" background-color: "+this.setColorValueFromModelParameters("selectedItemDefaultColor","var(--widget-select-option-highlighted-color)")+"; "},this.selectedItemHoverColor=function(){return" background-color: "+this.setColorValueFromModelParameters("selectedItemHoverColor","var(--widget-select-option-highlighted-color)")+"; "},this.valueAlign=function(){_.isUndefined(modelsParameters[t].ValueAlign)||delete modelsParameters[t].ValueAlign,_.isUndefined(modelsParameters[t].valueAlign)&&(modelsParameters[t].valueAlign="left");return" text-align: "+modelsParameters[t].valueAlign+"; "},this.tableBackgroundColor=function(e){_.isUndefined(modelsParameters[t].backgroundColor)&&(modelsParameters[t].backgroundColor={primary:"var(--widget-color-0)",secondary:"var(--widget-table-striped-odd)"});return" background-color: "+this.getColorValueFromCSSProperty(modelsParameters[t].backgroundColor[e])+"; "},this.thicknessBackgroundColor=function(){return' background-color="'+this.setColorValueFromModelParameters("thicknessBackgroundColor","var(--widget-segment-color)")+'" '},this.thicknessColor=function(){return' foreground-color="'+this.setColorValueFromModelParameters("thicknessColor","var(--widget-range-color)")+'" '},this.tipBackgroundColor=function(){return this.setColorValueFromModelParameters("tipBackgroundColor","var(--widget-button-color)")},this.tipBorderColor=function(){return this.setColorValueFromModelParameters("tipBorderColor","var(--widget-button-text)")}}baseWidget.prototype.getActuatorDescriptions=function(e=null){return[]},baseWidget.prototype.getByName=function(e){if(this.hasOwnProperty(e))return this[e]},baseWidget.prototype.getInteractive=function(){return this.bIsInteractive},baseWidget.prototype.setInteractive=function(e){e!=this.bIsInteractive&&(this.bIsInteractive=e,this.render())},baseWidget.prototype.rescale=function(){},baseWidget.prototype.render=function(){};class WidgetActuator{setValue(e){}getValue(){}addValueChangedHandler(e){}removeValueChangedHandler(e){}setCaption(e,o){}clearCaption(){}}class WidgetActuatorBase extends WidgetActuator{static NOOP_CALLBACK=function(e,o,t=void 0){};constructor(e){super(),this.widget=e}updateCallback=WidgetActuatorBase.NOOP_CALLBACK;addValueChangedHandler(e){this.updateDataFromWidget=e}removeValueChangedHandler(e){this.updateDataFromWidget=WidgetActuatorBase.NOOP_CALLBACK}}class WidgetActuatorDescription{static TRIGGER=0;static READ=1;static WRITE=2;static READ_WRITE=WidgetActuatorDescription.READ|WidgetActuatorDescription.WRITE;static FILE=4;constructor(e,o,t,r=null,l=null){this._name=e,this._summary=o,this._readwrite=t,this._schema=r,this._validator=l}get name(){return this._name}get summary(){return this._summary}get direction(){return this._readwrite}get jsonSchema(){return this._schema}get validator(){return this._validator}}class WidgetActuatorValidationError{constructor(e,o=void 0){this._msg=e,this._nested=o||[]}get msg(){return this._msg}get nested(){return this._nested}toString(){return this._print().join("\n")}_print(e=""){return[e+"- "+this._msg,...this._nested.flatMap((o=>o._print(e+"   ")))]}compareTo(e){const o=this.msg.localeCompare(e.msg);if(0!==o)return o;const t=this.nested.length,r=t-e.nested.length;if(0!==r)return r;for(let o=0;o<t;o++){const t=this.nested[o].compareTo(e.nested[o]);if(0!==t)return t}return 0}}
function scoringWidgetsPluginClass(){var e=this,r=0;this.scoringFullCircularGauge=function(i,a,t,n){return r++,new e.scoringCircularGaugeWidget(i,r,t,n,"full")},this.scoringSemiCircularGauge=function(i,a,t,n){return r++,new e.scoringCircularGaugeWidget(i,r,t,n,"semi")},this.scoringArchCircularGauge=function(i,a,t,n){return r++,new e.scoringCircularGaugeWidget(i,r,t,n,"arch")},this.clear=function(){r=0},this.scoringCircularGaugeWidget=function(e,r,i,a,t){this.constructor(e,r,i,a,t);var n=this;this.enable=function(){},this.disable=function(){},this.rescale=function(){this.render()},this.render=function(){var a=document.createElement("div");a.setAttribute("style","text-align: center; height: inherit; width: inherit; cursor: inherit"),a.setAttribute("id","div-for-ng-gauge"+r),$("#"+e).html(a);var o=Math.min($("#div-for-ng-gauge"+r).width(),$("#div-for-ng-gauge"+r).height()),l="gaugeValues.val"+r,u=angular.element('<ng-gauge id="ng-gauge'+r+'" style="'+this.valueColor()+'" size="'+o+'" type="'+t+'" thick="'+modelsParameters[i].thick+'" min="'+modelsParameters[i].min+'" max="'+modelsParameters[i].max+'" value="'+l+'"" cap="round" label="'+modelsParameters[i].label+'" duration="'+modelsParameters[i].duration+'"'+this.thicknessColor()+this.thicknessBackgroundColor()+'" append="'+modelsParameters[i].unit+'"></ng-gauge>'),g=document.getElementById("div-for-ng-gauge"+r);angular.element(g).append(u),angular.element(document.body).injector().invoke(["$compile","$rootScope",function(e,a){var t=angular.element(u).scope();a.gaugeValues||(a.gaugeValues={}),a.gaugeValues["val"+r]=modelsHiddenParams[i].value,e(u)(t)}]),this.bIsInteractive?n.enable():n.disable()};const o=new WidgetActuatorDescription("value","Numeric value",WidgetActuatorDescription.READ,WidgetPrototypesManager.SCHEMA_NUMBER);this.getActuatorDescriptions=function(){return[o]},this.value={updateCallback:function(){},setValue:function(e){modelsHiddenParams[i].value=e,angular.element(document.body).injector().invoke(["$compile","$rootScope",function(i,a){a.gaugeValues["val"+r]=e,a.safeApply()}])},getValue:function(){return $("#ng-gauge"+r)[0].value},addValueChangedHandler:function(e){this.updateCallback=e,n.enable()},removeValueChangedHandler:function(e){n.disable()},setCaption:function(e,r){modelsParameters[i].inheritLabelFromData&&n.captionHelper(e,n.bIsInteractive,r)},clearCaption:function(){modelsParameters[i].inheritLabelFromData&&(modelsParameters[i].label=""),n.render()}},n.render()},this.scoringCircularGaugeWidget.prototype=baseWidget.prototype,this.pluginDefinition={name:"scoring",widgetsDefinitionList:{scoringFullCircularGauge:{factory:"scoringFullCircularGauge",title:"Full-circular gauge",icn:"full-circular-gauge",help:"wdg/wdg-scoring-gauge/"},scoringSemiCircularGauge:{factory:"scoringSemiCircularGauge",title:"Semi-circular gauge",icn:"semi-circular-gauge",help:"wdg/wdg-scoring-gauge/"},scoringArchCircularGauge:{factory:"scoringArchCircularGauge",title:"Arch-circular gauge",icn:"widgets icn-arch-circular-gauge",help:"wdg/wdg-scoring-gauge/"}}},this.constructor()}modelsHiddenParams.scoringFullCircularGauge={value:75},modelsHiddenParams.scoringSemiCircularGauge={value:75},modelsHiddenParams.scoringArchCircularGauge={value:75},modelsParameters.scoringFullCircularGauge={label:"",inheritLabelFromData:!0,min:0,max:100,unit:"",valueColor:"var(--widget-color)",thick:10,thicknessColor:"var(--widget-range-color)",duration:1500,thicknessBackgroundColor:"var(--widget-segment-color)"},modelsParameters.scoringSemiCircularGauge={label:"",inheritLabelFromData:!0,min:0,max:100,unit:"",valueColor:"var(--widget-color)",thick:10,thicknessColor:"var(--widget-range-color)",duration:1500,thicknessBackgroundColor:"var(--widget-segment-color)"},modelsParameters.scoringArchCircularGauge={label:"",inheritLabelFromData:!0,min:0,max:100,unit:"",valueColor:"var(--widget-color)",thick:10,thicknessColor:"var(--widget-range-color)",duration:1500,thicknessBackgroundColor:"var(--widget-segment-color)"},modelsLayout.scoringFullCircularGauge={height:"15vh",width:"11vw"},modelsLayout.scoringSemiCircularGauge={height:"15vh",width:"11vw"},modelsLayout.scoringArchCircularGauge={height:"15vh",width:"11vw"},scoringWidgetsPluginClass.prototype=basePlugin.prototype;var scoringWidgetsPlugin=new scoringWidgetsPluginClass;widgetsPluginsHandler.loadWidgetPlugin(scoringWidgetsPlugin);
function annotationMarkdownWidgetsPluginClass(){this.markdownAnnotationWidget=function(t,n,e,i){this.constructor(t,n,e,i);var a=this;_.isUndefined(modelsParameters[e].textAlign)&&(modelsHiddenParams[e].textAlign="left"),this.enable=function(){},this.disable=function(){},this.rescale=function(){this.render()},_.isUndefined(modelsParameters[e].centerVertically)&&(modelsParameters[e].centerVertically=!0),this.hasScrollBar=function(t){return t.get(0).scrollHeight>t.get(0).clientHeight},this.render=function(){var i=document.createElement("div"),o="",r='<div id="annotationMarkdownDiv'+n+'" class="defaultCSS" style="overflow: auto; background-color: transparent; box-shadow: none; width: inherit; height: inherit; color:'+modelsParameters[e].textColor+"; text-align: "+modelsParameters[e].textAlign+"; padding: 4px; resize: inherit; border-radius: 6px; "+this.fontSize()+this.valueFontFamily()+this.border()+'"><div style="'+o+'">'+marked.parse(modelsHiddenParams[e].text)+"</div></div>";i.innerHTML=r,i.setAttribute("style","width: inherit; height: inherit; background-color:"+modelsParameters[e].backgroundColor),$("#"+t).html(i);var d=a.hasScrollBar($("#annotationMarkdownDiv"+n));modelsParameters[e].centerVertically&&!d&&(o=" position: relative; top: 50%; -webkit-transform: translateY(-50%); -ms-transform: translateY(-50%); transform: translateY(-50%);",$("#annotationMarkdownDiv"+n+" div").attr("style",o))};const o=new WidgetActuatorDescription("text","Markdown content",WidgetActuatorDescription.READ,WidgetPrototypesManager.SCHEMA_STRING);this.getActuatorDescriptions=function(){return[o]},this.text={setValue:function(t){modelsHiddenParams[e].text=t,a.render()},getValue:function(){return modelsHiddenParams[e].text},addValueChangedHandler:function(t){a.enable()},removeValueChangedHandler:function(t){a.disable()}},a.render()},this.markdownAnnotationWidget.prototype=baseWidget.prototype,this.pluginDefinition={name:"annotation",widgetsDefinitionList:{annotationMarkdown:{factory:"markdownAnnotationWidget",title:"Markdown",icn:"markdown",help:"wdg/wdg-annotation-video/#markdown"}}},this.constructor()}modelsHiddenParams.annotationMarkdown={text:""},modelsParameters.annotationMarkdown={fontsize:.3,backgroundColor:"rgba(0, 0, 0, 0)",textColor:"var(--widget-color)",valueFontFamily:"var(--widget-font-family)",textAlign:"left",displayBorder:!1,centerVertically:!0},modelsLayout.annotationMarkdown={height:"30vh",width:"30vw",minWidth:"50px",minHeight:"32px"},annotationMarkdownWidgetsPluginClass.prototype=basePlugin.prototype;var annotationMarkdownWidgetsPlugin=new annotationMarkdownWidgetsPluginClass;widgetsPluginsHandler.loadWidgetPlugin(annotationMarkdownWidgetsPlugin);
function genericHtmlWidgetPluginClass(){this.genericHtmlWidget=function(t,e,i,n){this.constructor(t,e,i,n);var r=this;_.isUndefined(modelsParameters[i].textAlign)&&(modelsHiddenParams[i].textAlign="left"),this.enable=function(){},this.disable=function(){},this.rescale=function(){this.render()},_.isUndefined(modelsParameters[i].centerVertically)&&(modelsParameters[i].centerVertically=!0),this.hasScrollBar=function(t){return t.get(0).scrollHeight>t.get(0).clientHeight},this.render=function(){var n=document.createElement("div"),l="",a='<div id="htmlDiv'+e+'" class="defaultCSS" style="overflow: auto; background-color: transparent; box-shadow: none; width: inherit; height: inherit; color:'+modelsParameters[i].textColor+"; text-align: "+modelsParameters[i].textAlign+"; padding: 4px; resize: inherit; border-radius: 6px; "+this.fontSize()+this.valueFontFamily()+this.border()+'"><div style="'+l+'">'+modelsHiddenParams[i].html+"</div></div>";n.innerHTML=a,n.setAttribute("style","width: inherit; height: inherit; background-color:"+modelsParameters[i].backgroundColor),$("#"+t).html(n);var o=r.hasScrollBar($("#htmlDiv"+e));modelsParameters[i].centerVertically&&!o&&(l=" position: relative; top: 50%; -webkit-transform: translateY(-50%); -ms-transform: translateY(-50%); transform: translateY(-50%);",$("#htmlDiv"+e+" div").attr("style",l))};const l=new WidgetActuatorDescription("html","Html content",WidgetActuatorDescription.READ,WidgetPrototypesManager.SCHEMA_STRING);this.getActuatorDescriptions=function(){return[l]},this.html={setValue:function(t){modelsHiddenParams[i].html=t,r.render()},getValue:function(){return modelsHiddenParams[i].html},addValueChangedHandler:function(t){r.enable()},removeValueChangedHandler:function(t){r.disable()}},r.render()},this.genericHtmlWidget.prototype=baseWidget.prototype,this.pluginDefinition={name:"annotation",widgetsDefinitionList:{annotationHtml:{factory:"genericHtmlWidget",title:"Generic html",icn:"generic-html",help:"wdg/wdg-annotation-video/#generic-html"}}},this.constructor()}modelsHiddenParams.annotationHtml={html:""},modelsParameters.annotationHtml={fontsize:.3,backgroundColor:"rgba(0, 0, 0, 0)",textColor:"var(--widget-color)",valueFontFamily:"var(--widget-font-family)",textAlign:"left",displayBorder:!1,centerVertically:!0},modelsLayout.annotationHtml={height:"30vh",width:"30vw",minWidth:"50px",minHeight:"32px"},genericHtmlWidgetPluginClass.prototype=basePlugin.prototype;var genericHtmlWidgetPlugin=new genericHtmlWidgetPluginClass;widgetsPluginsHandler.loadWidgetPlugin(genericHtmlWidgetPlugin);
function kpiWidgetsPluginClass(){this.kpiCardWidget=function(e,t,a,i){this.constructor(e,t,a,i);var l=this,r="";this.enable=function(){},this.disable=function(){},this.rescale=function(){this.render()},this.render=function(){var i=document.createElement("div");modelsParameters[a].borderShadow?i.setAttribute("class","card-kpi-container card-shadow"):i.setAttribute("class","card-kpi-container ");var n='<div class="card-kpi">';n+='<div class="card-body">',n+='<div class="row align-items-center">';var s="";if(modelsParameters[a].displayLabel){const e=this.getTransformedText("label");s=(s+='<h5 class="card-mt-0 text-truncate"')+' style="text-align:center;'+this.labelFontSize()+this.labelColor()+this.labelFontFamily()+'">'+e,s+="</h5>"}var o="";o=(o=o+'<div id="card-value-'+t+'" class="card-value" style="text-align:center;')+this.valueFontSize()+this.valueColor()+this.valueFontFamily()+'"></div>',n="top"==modelsParameters[a].valuePosition?o+s:s+o,n+="</div>",n+="</div>",n+="</div>",i.innerHTML=n,$("#"+e).html(i),$("#card-value-"+t)[0].innerText=l.valueFormat(modelsHiddenParams[a].value),r='<span id ="unit-span'+t+'" style="text-align: left; color: '+modelsParameters[a].unitColor+"; font-size: calc(7px + "+modelsParameters[a].unitFontSize*getFontFactor()+'vw + 0.4vh);">'+modelsParameters[a].unit+"</span>",""!=modelsParameters[a].unit&&modelsParameters[a].displayUnit&&$("#card-value-"+t).append(r),this.bIsInteractive?l.enable():l.disable()};const n=new WidgetActuatorDescription("value","Current value",WidgetActuatorDescription.READ,WidgetPrototypesManager.SCHEMA_ANY_PRIMITIVE);this.getActuatorDescriptions=function(){return[n]},this.value={updateCallback:function(){},setValue:function(e){modelsHiddenParams[a].value=e,$("#card-value-"+t)[0].innerText=l.valueFormat(modelsHiddenParams[a].value),""!=modelsParameters[a].unit&&modelsParameters[a].displayUnit&&$("#card-value-"+t).append(r)},getValue:function(){return modelsHiddenParams[a].value},addValueChangedHandler:function(e){this.updateCallback=e,l.enable()},removeValueChangedHandler:function(e){l.disable()},setCaption:function(e,t){modelsParameters[a].inheritLabelFromData&&(l.captionHelper(e,l.bIsInteractive,t),l.render())},clearCaption:function(){modelsParameters[a].inheritLabelFromData&&(modelsParameters[a].label=""),l.render()}},l.render()},this.kpiCardWidget.prototype=baseWidget.prototype,this.pluginDefinition={name:"kpiCard",widgetsDefinitionList:{kpiCard:{factory:"kpiCardWidget",title:"KPI value",icn:"kpi"}}},this.constructor()}modelsHiddenParams.kpiCard={value:"--"},modelsParameters.kpiCard={label:"labelText",inheritLabelFromData:!0,displayLabel:!0,labelFontSize:.5,labelColor:"var(--widget-label-color)",labelFontFamily:"var(--widget-font-family)",valuePosition:"bottom",valueFontSize:2,valueColor:"var(--widget-color)",valueFontFamily:"var(--widget-font-family)",decimalDigits:3,unit:"unitText",displayUnit:!1,unitFontSize:.5,unitColor:"var(--widget-label-color)",borderShadow:!1},modelsLayout.kpiCard={height:"16vh",width:"18vw",minWidth:"64px",minHeight:"32px"},kpiWidgetsPluginClass.prototype=basePlugin.prototype;var kpiWidgetsPlugin=new kpiWidgetsPluginClass;widgetsPluginsHandler.loadWidgetPlugin(kpiWidgetsPlugin);
function advancedKpiWidgetsPluginClass(){this.advancedKpiCardWidget=function(a,e,t,i){this.constructor(a,e,t,i);var s=this;this.enable=function(){},this.disable=function(){},this.rescale=function(){this.render()},this.initEcharts=function(a){modelsTempParams[t].echartsInstance=echarts.init(document.getElementById(a))},this.getEchartsData=function(){let a=Date.now()+1e3;return{name:a.toString(),value:[a,modelsHiddenParams[t].value]}},this.pushEchartsListData=function(a){modelsTempParams[t].echartsListData.push(a)},this.shiftEchartsListData=function(){modelsTempParams[t].echartsListData.shift()},this.getEchartsListData=function(){return modelsTempParams[t].echartsListData},this.getEchartsOptions=function(){return{xAxis:{type:"time",boundaryGap:!1,axisLabel:!1,axisLine:!1,splitLine:{show:!1}},yAxis:{type:"value",boundaryGap:["",""],axisLabel:!1,axisLine:!1,splitLine:{show:!1}},visualMap:{type:"continuous",show:!1,realtime:!0,inRange:{color:s.graphColor()}},grid:{left:0,top:0,right:0,bottom:0},series:[{type:"line",smooth:.25,showSymbol:!1,areaStyle:{color:new echarts.graphic.LinearGradient(0,0,0,1,[{offset:0,color:s.graphColor()},{offset:1,color:"#ffffff"}])},data:modelsTempParams[t].echartsListData}],animationDuration:0,animationDurationUpdate:1e3,animationEasing:"linear",animationEasingUpdate:"linear"}},this.initEchartsOptions=function(){let a=this.getEchartsOptions();try{modelsTempParams[t].echartsInstance.setOption(a)}catch(a){console.log(a)}},this.setEchartsOptions=function(a){modelsTempParams[t].echartsInstance.setOption({series:[{data:a}]})},this.updateEcharts=function(a){if(i)_.isUndefined(modelsTempParams[t].windowValue)&&(modelsTempParams[t].windowValue=modelsHiddenParams[t].window),this.initEcharts(a),this.initEchartsOptions(),-1==modelsHiddenParams[t].window?(this.pushEchartsListData(this.getEchartsData()),this.setEchartsOptions(this.getEchartsListData())):modelsHiddenParams[t].window>=0&&(0==modelsTempParams[t].windowValue&&this.shiftEchartsListData(),this.pushEchartsListData(this.getEchartsData()),this.setEchartsOptions(this.getEchartsListData()),0!=modelsTempParams[t].windowValue&&--modelsTempParams[t].windowValue),s.enable();else{this.initEcharts(a),this.initEchartsOptions();var e=modelsTempParams[t].echartsInstance.getDataURL();modelsTempParams[t].echartsInstance.dispose(),$("#"+a).html('<img src="'+e+'"/>'),s.disable()}},this.render=function(){var n=document.createElement("div");modelsParameters[t].borderShadow?n.setAttribute("class","card-kpi-container card-shadow"):n.setAttribute("class","card-kpi-container");var r='<div class="card-kpi">';r=(r+='<div class="card-body">')+'<div id="items-'+e+'" class="row align-items-center">';var d="";d=(d=d+'<h5 id="advanced-card-label-'+e+'" class="card-mt-0 text-truncate"')+' style="text-align:center; margin-bottom: 4rem;'+this.labelFontSize()+this.labelColor()+this.labelFontFamily()+'"></h5>';var o="";o=(o=o+'<div id="advanced-card-value-'+e+'" class="card-value" style="text-align:center; margin-bottom: 1.7rem;')+this.valueFontSize()+this.valueColor()+this.valueFontFamily()+'"></div>';var l="";l=(l=l+'<div id="advanced-card-sub-label-'+e+'" class="card-value" style="text-align:center; margin-bottom: 2rem; ')+this.subLabelFontSize()+this.subLabelColor()+this.subLabelFontFamily()+'"></div>';var c="",m="echarts"+e;if(i&&(m+="c"),c=c+'<div id="'+m+'" style="text-align:left; height: 11.9vh; width: 100%; background-color: transparent"></div>',r="top"==modelsParameters[t].valuePosition?o+l+d+c:d+o+l+c,r+="</div>",r+="</div>",r+="</div>",n.innerHTML=r,$("#"+a).html(n),modelsParameters[t].displayLabel){const a=this.getTransformedText("label");$("#advanced-card-label-"+e)[0].innerHTML=a}else $("#advanced-card-label-"+e).hide();$("#advanced-card-value-"+e)[0].innerText=s.valueFormat(modelsHiddenParams[t].value),$("#advanced-card-sub-label-"+e)[0].innerText=s.valueFormat(modelsHiddenParams[t].subLabel),this.updateEcharts(m)};const n={$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:advancedKpiCardWidget",type:"object",properties:{value:{type:["string","number","boolean"]},subLabel:{type:["string","number","boolean"]}},required:["value","subLabel"]},r=new WidgetActuatorDescription("extendedValue","Current value and sub-label",WidgetActuatorDescription.READ,n);this.getActuatorDescriptions=function(){return[r]},this.extendedValue={updateCallback:function(){},setValue:function(a){modelsHiddenParams[t]=a},getValue:function(){return modelsHiddenParams[t]},addValueChangedHandler:function(a){this.updateCallback=a,s.enable()},removeValueChangedHandler:function(a){s.disable()},setCaption:function(a,e){modelsParameters[t].inheritLabelFromData&&(s.captionHelper(a,s.bIsInteractive,e),s.render())},clearCaption:function(){modelsParameters[t].inheritLabelFromData&&(modelsParameters[t].label=""),s.render()}},s.render()},this.advancedKpiCardWidget.prototype=baseWidget.prototype,this.pluginDefinition={name:"advancedKpiCard",widgetsDefinitionList:{advancedKpiCard:{factory:"advancedKpiCardWidget",title:"Advanced KPI value",icn:"kpi-advanced"}}},this.constructor()}modelsHiddenParams.advancedKpiCard={value:"--",subLabel:"--"},modelsParameters.advancedKpiCard={label:"labelText",inheritLabelFromData:!0,displayLabel:!0,labelFontSize:.5,labelColor:"var(--widget-label-color)",labelFontFamily:"var(--widget-font-family)",valuePosition:"bottom",valueFontSize:3,valueColor:"var(--widget-color)",valueFontFamily:"var(--widget-font-family)",decimalDigits:3,subLabelFontSize:.5,subLabelColor:"var(--widget-subtext-color)",subLabelFontFamily:"var(--widget-font-family)",borderShadow:!1,graphColor:"var(--widget-label-color)"},modelsTempParams.advancedKpiCard={echartsInstance:"",echartsListData:[]},modelsLayout.advancedKpiCard={height:"33vh",width:"14vw",minWidth:"64px",minHeight:"32px"},advancedKpiWidgetsPluginClass.prototype=basePlugin.prototype;var advancedKpiWidgetsPlugin=new advancedKpiWidgetsPluginClass;widgetsPluginsHandler.loadWidgetPlugin(advancedKpiWidgetsPlugin);
function doubleSliderWidgetsPluginClass(){this.doubleSliderFlatUiWidget=function(e,a,l,n){this.constructor(e,a,l,n);var i=this;this.enable=function(){},this.disable=function(){},this.getCleanedOptions=function(e){return{floor:e.minRange,ceil:e.maxRange,step:e.step,precision:e.precision,enforceStep:e.enforceStep,disableAnimation:e.disableAnimation,onEnd:e.onEnd}},this.updateMinValue=function(){i.bIsInteractive&&(i.minValue.updateCallback(i.minValue,i.minValue.getValue()),modelsHiddenParams[l].minValue=i.minValue.getValue())},this.updateMaxValue=function(){i.bIsInteractive&&(i.maxValue.updateCallback(i.maxValue,i.maxValue.getValue()),modelsHiddenParams[l].maxValue=i.maxValue.getValue())},this.rescale=function(){this.render()},_.isUndefined(modelsParameters[l].forceValuesToMinAndMax)&&(modelsParameters[l].forceValuesToMinAndMax=!1),this.render=function(){var n=document.createElement("div");n.setAttribute("style","display: table; height: inherit; width: inherit; cursor: inherit"),n.setAttribute("id","div-for-ng-slider"+a),$("#"+e).html(n);Math.min($("#div-for-ng-slider"+a).width(),$("#div-for-ng-slider"+a).height());var t="sliderValues.values_"+l,o="30%",r="labelText",d='<div><rzslider id="ng-slider'+a+'" ng-click="changeValue()" rz-slider-model="'+t+'.minValue"  rz-slider-high="'+t+'.maxValue"  rz-slider-options="getModel('+("sliderValues.params_"+l)+')" ></rzslider></div>',s="",u="calc(7px + 0.5vw + 0.4vh)";1==modelsParameters[l].displayLabel&&(_.isUndefined(modelsParameters[l].label)||(r=this.getTransformedText("label")),_.isUndefined(modelsParameters[l].labelWidthProportion)||(o=modelsParameters[l].labelWidthProportion),_.isUndefined(modelsParameters[l].labelFontSize)||(u=this.labelFontSize()),s='<span class="label-h-slider" id="h-slider-span" style="heigh: auto; width:'+o+"; "+u+this.labelColor()+this.labelFontFamily()+';">'+r+"</span>");var m=angular.element(s+'<div style="display: table-cell; vertical-align: middle; padding-bottom: 18px;"> '+d+"</div>");modelsParameters[l].onEnd=function(e,a,l,n){"max"==n&&i.updateMaxValue(),"min"==n&&i.updateMinValue()};var c=document.getElementById("div-for-ng-slider"+a);angular.element(c).append(m),angular.element(document.body).injector().invoke(["$compile","$rootScope",function(e,a){var n=angular.element(m).scope();a.sliderValues||(a.sliderValues={}),a.sliderValues["values_"+l]={minValue:modelsHiddenParams[l].minValue,maxValue:modelsHiddenParams[l].maxValue},a.getModel=function(e){var a=angular.copy(e);return i.bIsInteractive?(_.isUndefined(a.minRange)||(a.floor=a.minRange),_.isUndefined(a.maxRange)||(a.ceil=a.maxRange)):(a.ceil=a.maxRange,a.floor=a.minRange,a.readOnly=!0),a},a.changeValue=function(){},a.sliderValues["params_"+l]=i.getCleanedOptions(modelsParameters[l]),e(m)(n)}]),document.styleSheets[0].addRule("#ng-slider"+a+" > .rz-bar-wrapper > .rz-bar",this.sliderSegmentColor()),document.styleSheets[0].addRule("#ng-slider"+a+" > .rz-bar-wrapper > .rz-selection",this.sliderRangeColor()),document.styleSheets[0].addRule("#ng-slider"+a+" > .rz-pointer",this.sliderHandleDefaultColor()),document.styleSheets[0].addRule("#ng-slider"+a+" > .rz-pointer:hover",this.sliderHandleHoverColor()),document.styleSheets[0].addRule("#ng-slider"+a+" > .rz-pointer:active",this.sliderHandleActiveColor())};const t=new WidgetActuatorDescription("minValue","Selected minimum value",WidgetActuatorDescription.READ_WRITE,WidgetPrototypesManager.SCHEMA_NUMBER),o=new WidgetActuatorDescription("maxValue","Selected maximum value",WidgetActuatorDescription.READ_WRITE,WidgetPrototypesManager.SCHEMA_NUMBER),r=new WidgetActuatorDescription("minRange","Minimum allowed value",WidgetActuatorDescription.READ,WidgetPrototypesManager.SCHEMA_NUMBER),d=new WidgetActuatorDescription("maxRange","Maximum allowed value",WidgetActuatorDescription.READ,WidgetPrototypesManager.SCHEMA_NUMBER);this.getActuatorDescriptions=function(e=void 0){const a=e||modelsParameters[l],n=[t,o];return a&&a.rangeActuator&&(n.push(r),n.push(d)),n},this.minValue={updateCallback:function(){},setValue:function(e){var a=Number(e);modelsHiddenParams[l].minValue=a,angular.element(document.body).injector().invoke(["$compile","$rootScope",function(e,n){n.sliderValues["values_"+l].minValue=a,n.safeApply()}])},getValue:function(){var e=0;return angular.element(document.body).injector().invoke(["$compile","$rootScope",function(a,n){e=n.sliderValues["values_"+l].minValue}]),e},addValueChangedHandler:function(e){this.updateCallback=e,i.enable()},removeValueChangedHandler:function(e){i.disable()},setCaption:function(e,a){},clearCaption:function(){}},this.maxValue={updateCallback:function(){},setValue:function(e){var a=Number(e);modelsHiddenParams[l].maxValue=a,angular.element(document.body).injector().invoke(["$compile","$rootScope",function(e,n){n.sliderValues["values_"+l].maxValue=a,n.safeApply()}])},getValue:function(){var e;return angular.element(document.body).injector().invoke(["$compile","$rootScope",function(a,n){e=n.sliderValues["values_"+l].maxValue}]),e},addValueChangedHandler:function(e){this.updateCallback=e,i.enable()},removeValueChangedHandler:function(e){i.disable()},setCaption:function(e,a){},clearCaption:function(){}},i.maxRange={updateCallback:function(){},setValue:function(e){var a=Number(e);modelsParameters[l].maxRange=a,angular.element(document.body).injector().invoke(["$compile","$rootScope",function(e,a){a.sliderValues["params_"+l]=i.getCleanedOptions(modelsParameters[l]),a.safeApply()}]),modelsParameters[l].forceValuesToMinAndMax&&(i.maxValue.setValue(modelsParameters[l].maxRange),i.updateMaxValue())},getValue:function(){var e;return angular.element(document.body).injector().invoke(["$compile","$rootScope",function(a,n){e=modelsParameters[l].maxRange}]),e},addValueChangedHandler:function(e){this.updateCallback=e,i.enable()},removeValueChangedHandler:function(e){i.disable()}},i.minRange={updateCallback:function(){},setValue:function(e){var a=Number(e);modelsParameters[l].minRange=a,angular.element(document.body).injector().invoke(["$compile","$rootScope",function(e,a){a.sliderValues["params_"+l]=i.getCleanedOptions(modelsParameters[l]),a.safeApply()}]),modelsParameters[l].forceValuesToMinAndMax&&(i.minValue.setValue(modelsParameters[l].minRange),i.updateMinValue())},getValue:function(){var e;return angular.element(document.body).injector().invoke(["$compile","$rootScope",function(a,n){e=modelsParameters[l].minRange}]),e},addValueChangedHandler:function(e){this.updateCallback=e,i.enable()},removeValueChangedHandler:function(e){i.disable()}},i.render()},this.doubleSliderFlatUiWidget.prototype=baseWidget.prototype,this.pluginDefinition={name:"flatUiDoubleSlider",widgetsDefinitionList:{flatUiDoubleSlider:{factory:"doubleSliderFlatUiWidget",title:"Double slider",icn:"double-slider",help:"wdg/wdg-basics/#double-slider"}}},this.constructor()}modelsHiddenParams.flatUiDoubleSlider={minValue:25,maxValue:75},modelsParameters.flatUiDoubleSlider={label:"labelText",displayLabel:!0,labelFontSize:.5,labelColor:"var(--widget-label-color)",labelWidthProportion:"30%",minRange:0,maxRange:100,step:.1,precision:2,enforceStep:!1,disableAnimation:!1,rangeActuator:!1,forceValuesToMinAndMax:!1,sliderSegmentColor:"var(--widget-segment-color)",sliderRangeColor:"var(--widget-range-color)",sliderHandleDefaultColor:"var(--widget-handle-default-color)",sliderHandleHoverColor:"var(--widget-handle-hover-color)",sliderHandleActiveColor:"var(--widget-handle-active-color)"},modelsLayout.flatUiDoubleSlider={height:"8vh",width:"24vw",minWidth:"200px",minHeight:"24px"},doubleSliderWidgetsPluginClass.prototype=basePlugin.prototype;var doubleSliderWidgetsPlugin=new doubleSliderWidgetsPluginClass;widgetsPluginsHandler.loadWidgetPlugin(doubleSliderWidgetsPlugin);
function datePickerWidgetsPluginClass(){var e=this;this.datePickerWidget=function(e,t,a,i,l){this.constructor(e,t,a,i);var r=this;this.dateFieldShow=function(){var e=$("#ng-datepicker"+t);e.hasClass("daterangepicker-hide")&&e.removeClass("daterangepicker-hide")},this.dateFieldHide=function(){var e=$("#ng-datepicker"+t);e.hasClass("daterangepicker-hide")||e.addClass("daterangepicker-hide")},this.enable=function(){$("#"+a+"c").on("click",(function(e,t){widgetPreview.elevateZIndex(a,e),r.dateFieldShow()}))},this.disable=function(){r.dateFieldHide()},this.updateValue=function(e){r.dateValue.updateCallback(r.dateValue,r.dateValue.getValue()),r.dateFieldHide()},this.getShortDate=function(e){var t=String(e.getDate()).padStart(2,"0"),a=String(e.getMonth()+1).padStart(2,"0"),i=e.getFullYear();return e=i+"-"+a+"-"+t},this.rescale=function(){this.render()},this.render=function(){var i=document.createElement("div"),l=!1,d=" ",n="display: table;";modelsHiddenParams[a].visibility&&(l=!0,d="display: none; ",n=""),i.setAttribute("style",n+"text-align: left; height: inherit; width: inherit; cursor: inherit"),i.setAttribute("id","div-for-ng-datepicker"+t),$("#"+e).html(i);var o=$("#div-for-ng-datepicker"+t).height(),s="datepickerValues.val"+a,c="100%",p="labelText",u=($("#div-for-ng-datepicker"+t).width(),""),h="calc(7px + 0.5vw + 0.4vh)",g="calc(7px + 0.5vw + 0.4vh)";if(1==modelsParameters[a].displayLabel&&(_.isUndefined(modelsParameters[a].label)||(p=this.getTransformedText("label")),_.isUndefined(modelsParameters[a].labelWidthProportion)||(c=modelsParameters[a].labelWidthProportion,(100-parseInt(c))*$("#div-for-ng-datepicker"+t).width()/100),_.isUndefined(modelsParameters[a].labelFontSize)||(h=this.labelFontSize()),_.isUndefined(modelsParameters[a].valueFontSize)||(g="calc(7px + "+modelsParameters[a].valueFontSize*getFontFactor()+"vw + 0.4vh)"),u='<span class="value-span" id="date-label-span'+t+'" style="width:'+c+"; "+h+this.labelColor()+this.labelFontFamily()+'">'+p+"</span>",l)){var m=80*$("#div-for-ng-datepicker"+t).width()/100,v=20*$("#div-for-ng-datepicker"+t).height()/100;u='<span class="value-span" id="date-label-span'+t+'" style="width:'+m+"px;height:"+v+"px;text-align: center;padding-bottom: 0px; "+h+this.labelColor()+this.labelFontFamily()+'">'+p+"</span>"}var b="disabled",f="cursor: inherit; ";if(this.bIsInteractive){b="";f="cursor: pointer; "}var k=this.border(),P='<datepicker id="ng-datepicker'+t+'" date-format="yyyy-MM-dd" datepicker-show="'+l+'" selector="form-control"><div style="cursor: inherit"><input  id="'+("calender-input"+t)+'" class="value-input form-control " style="'+f+" height: "+o+"px; border-radius: 6px; "+d+k+"float: right; font-size: "+g+";"+this.valueColor()+this.valueFontFamily()+this.backgroundColor()+"padding-right: "+g.replace("(","(3*(").replace(")","))")+";text-align: "+modelsParameters[a].valueTextAlign+'; " ng-model="'+s+'.currentDate" '+b+' placeholder="Choose a date"/><span class="form-control-feedback" style="cursor: inherit; display: table;margin-top:0; top:0; padding-right: '+g+"; height: "+o+'px;"><i class="fa fa-lg fa-calendar" style="display: table-cell; vertical-align: middle; font-size:'+g+'"></i></span></div></datepicker>',y=u+'<div style="cursor: inherit; height: 100%"> '+P+"</div> ";if(l){var w="height: 100%; width: 100%";modelsParameters[a].displayLabel&&(w="height: 80%; width: 80%"),y='<div style="'+w+'"> '+P+"</div> "+u}var F=angular.element(y),S=document.getElementById("div-for-ng-datepicker"+t);angular.element(S).append(F),angular.element(document.body).injector().invoke(["$compile","$rootScope",function(e,t){var i=angular.element(F).scope();if(t.datepickerValues||(t.datepickerValues={}),t.datepickerValues["val"+a]||(t.datepickerValues["val"+a]={currentDate:r.getShortDate(new Date)}),modelsHiddenParams[a]){if(!modelsHiddenParams[a].value){var l=new Date;modelsHiddenParams[a].value=r.getShortDate(l)}t.datepickerValues["val"+a]={currentDate:modelsHiddenParams[a].value}}t.$watch("datepickerValues.val"+a,(function(){r.updateValue()}),!0),e(F)(i)}]),r.dateFieldHide(),this.bIsInteractive?r.enable():r.disable()};const d=new WidgetActuatorDescription("dateValue","Selected date as YYYY-MM-DD",WidgetActuatorDescription.READ_WRITE,{$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:datePickerWidgetSemi",type:"string",pattern:"^\\d\\d\\d\\d-[0-1]\\d-[0-3]\\d$"});this.getActuatorDescriptions=function(){return[d]},this.dateValue={updateCallback:function(){},setValue:function(e){var t=Date.parse(e);_.isNaN(t)||(modelsHiddenParams[a].value=r.getShortDate(new Date(t)),angular.element(document.body).injector().invoke(["$compile","$rootScope",function(e,t){t.datepickerValues["val"+a]&&(t.datepickerValues["val"+a].currentDate=modelsHiddenParams[a].value,t.safeApply())}]))},getValue:function(){var e=null;return angular.element(document.body).injector().invoke(["$compile","$rootScope",function(t,i){i.datepickerValues["val"+a]&&(e=i.datepickerValues["val"+a].currentDate,modelsHiddenParams[a].value=e)}]),e},addValueChangedHandler:function(e){this.updateCallback=e},removeValueChangedHandler:function(e){},setCaption:function(e,i){modelsParameters[a].inheritLabelFromData&&(r.captionHelper(e,r.bIsInteractive,i),$("#date-label-span"+t).text(modelsParameters[a].label))},clearCaption:function(){modelsParameters[a].inheritLabelFromData&&(modelsParameters[a].label=""),r.render()}},r.render()},this.datePickerWidgetSemi=function(t,a,i,l){return new e.datePickerWidget(t,a,i,l,"semi")},this.datePickerWidgetFull=function(t,a,i,l){return new e.datePickerWidget(t,a,i,l,"full")},this.datePickerWidget.prototype=baseWidget.prototype,this.pluginDefinition={name:"datepicker",widgetsDefinitionList:{datepickerSimple:{factory:"datePickerWidgetSemi",title:"Simple calender",icn:"calendar",help:"wdg/wdg-geo-time/#simple-calendar"}}},this.constructor()}modelsHiddenParams.datepickerSimple={value:"",visibility:!1},modelsHiddenParams.datepickerVisible={value:"",visibility:!0},modelsParameters.datepickerSimple={label:"labelText",inheritLabelFromData:!0,displayLabel:!0,labelFontSize:.5,labelColor:"var(--widget-label-color)",labelWidthProportion:"30%",valueFontSize:.5,valueColor:"var(--widget-color)",valueFontFamily:"var(--widget-font-family)",valueTextAlign:"left",displayBorder:!0,borderColor:"var(--widget-border-color)",backgroundColor:"var(--widget-input-color)"},modelsParameters.datepickerVisible={label:"labelText",inheritLabelFromData:!1,displayLabel:!0,labelFontSize:.5,labelColor:"var(--widget-label-color)",labelFontFamily:"var(--widget-font-family)",valueFontSize:.5,valueColor:"var(--widget-color)",valueFontFamily:"var(--widget-font-family)"},modelsLayout.datepickerSimple={height:"5vh",width:"19vw",minWidth:"150px",minHeight:"32px"},modelsLayout.datepickerVisible={height:"45vh",width:"22vw",minWidth:"150px",minHeight:"190px"},datePickerWidgetsPluginClass.prototype=basePlugin.prototype;var datePickerWidgetsPlugin=new datePickerWidgetsPluginClass;widgetsPluginsHandler.loadWidgetPlugin(datePickerWidgetsPlugin);
function dateRangePickerWidgetsPluginClass(){this.dateRangePickerWidget=function(e,a,t,i){this.constructor(e,a,t,i);const r=this;this.formatDateValue="",this.updateDateValue=function(e){this.bIsInteractive&&(r.endDateValue.updateCallback(r.endDateValue,r.endDateValue.getValue()),modelsHiddenParams[t].endDateValue=r.endDateValue.getValue(),r.startDateValue.updateCallback(r.startDateValue,r.startDateValue.getValue()),modelsHiddenParams[t].startDateValue=r.startDateValue.getValue())},this.rescale=function(){this.render()},this.render=function(){const i=document.createElement("div");i.setAttribute("style","display: table;text-align: left; height: inherit; width: inherit; cursor: inherit"),i.setAttribute("id","div-for-daterangepicker"+a),$("#"+e).html(i);let d="0%",n="labelText",l=$("#div-for-daterangepicker"+a).width(),s="",o="calc(7px + 0.5vw + 0.4vh)",u="calc(7px + 0.5vw + 0.4vh)";_.isUndefined(modelsParameters[t].inheritLabelFromData)||delete modelsParameters[t].inheritLabelFromData,1==modelsParameters[t].displayLabel&&(_.isUndefined(modelsParameters[t].label)||(n=this.getTransformedText("label")),_.isUndefined(modelsParameters[t].labelWidthProportion)||(d=modelsParameters[t].labelWidthProportion,l=(100-parseInt(d))*$("#div-for-daterangepicker"+a).width()/100),_.isUndefined(modelsParameters[t].labelFontSize)||(o=this.labelFontSize()),_.isUndefined(modelsParameters[t].valueFontSize)||(u="calc(7px + "+modelsParameters[t].valueFontSize*getFontFactor()+"vw + 0.4vh)"),s='<span class="value-span" id="date-label-span'+a+'" style="width:'+d+"; "+o+this.labelColor()+this.labelFontFamily()+';">'+n+"</span>");let c="disabled",m="cursor: inherit; ";this.bIsInteractive&&(c="",m="cursor: pointer; ");const g=this.border(),p=$("#div-for-daterangepicker"+a).height(),h=s+'<div style="height:100% width: '+l+'px;">'+('<div id="daterangepicker'+a+'" ><input type="text" autocomplete="off" '+c+' placeholder="Choose a date range" id="daterangepickerInput'+a+'" style="'+m+" height: "+p+"px; border-radius: 6px; "+g+"float: right;padding-right: "+u.replace("(","(3*(").replace(")","))")+";text-align: "+modelsParameters[t].valueTextAlign+"; font-size: "+u+"; "+this.valueColor()+this.valueFontFamily()+this.backgroundColor()+'" class="value-input form-control ng-pristine ng-untouched ng-valid ng-empty" /><span class="form-control-feedback" style="'+m+"height: "+p+"px; display:table; margin-top: 0; top:0; padding-right: "+u+'"><i class="fa fa-lg fa-calendar" style="display: table-cell; vertical-align: middle;'+m+"font-size: "+u+';" ></i></span></div>')+"</div>";i.innerHTML=h,modelsParameters[t].displayTimePicker?r.formatDateValue=modelsParameters[t].displayTimePicker24Hour?"YYYY-MM-DD hh:mm":"YYYY-MM-DD hh:mm A":r.formatDateValue="YYYY-MM-DD";let D="",P="";D=""!==modelsHiddenParams[t].startDateValue?modelsHiddenParams[t].startDateValue:moment().startOf("hour"),P=""!==modelsHiddenParams[t].endDateValue?modelsHiddenParams[t].endDateValue:moment().startOf("hour").add(32,"hour"),$('input[id="daterangepickerInput'+a+'"]').daterangepicker({opens:"right",singleDatePicker:!1,showDropdowns:!0,autoUpdateInput:!0,timePicker:modelsParameters[t].displayTimePicker,timePicker24Hour:modelsParameters[t].displayTimePicker24Hour,startDate:D,endDate:P,locale:{format:r.formatDateValue}}),$('input[id="daterangepickerInput'+a+'"]').on("apply.daterangepicker",(function(e,a){modelsHiddenParams[t].startDateValue=a.startDate.format(r.formatDateValue),modelsHiddenParams[t].endDateValue=a.endDate.format(r.formatDateValue),r.updateDateValue()}))};const d={$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:dateRangeWidget_date",type:"string",pattern:"^\\d\\d\\d\\d-[0-1]\\d-[0-3]\\d$"},n=new WidgetActuatorDescription("startDateValue","Selected start date as YYYY-MM-DD",WidgetActuatorDescription.READ_WRITE,d),l=new WidgetActuatorDescription("endDateValue","Selected end date as YYYY-MM-DD",WidgetActuatorDescription.READ_WRITE,d);this.getActuatorDescriptions=function(){return[n,l]},this.startDateValue={updateCallback:function(){},setValue:function(e){moment(e,r.formatDateValue,!0).isValid()&&(modelsHiddenParams[t].startDateValue=e,$('input[id="daterangepickerInput'+a+'"]').data("daterangepicker").setStartDate(modelsHiddenParams[t].startDateValue))},getValue:function(){return modelsHiddenParams[t].startDateValue},addValueChangedHandler:function(e){this.updateCallback=e},removeValueChangedHandler:function(e){},setCaption:function(e,a){},clearCaption:function(){}},this.endDateValue={updateCallback:function(){},setValue:function(e){moment(e,r.formatDateValue,!0).isValid()&&(modelsHiddenParams[t].endDateValue=e,$('input[id="daterangepickerInput'+a+'"]').data("daterangepicker").setEndDate(modelsHiddenParams[t].endDateValue))},getValue:function(){return modelsHiddenParams[t].endDateValue},addValueChangedHandler:function(e){this.updateCallback=e},removeValueChangedHandler:function(e){},setCaption:function(e,a){},clearCaption:function(){}},r.render()},this.dateRangePickerWidget.prototype=baseWidget.prototype,this.pluginDefinition={name:"dateRangePicker",widgetsDefinitionList:{dateRangePicker:{factory:"dateRangePickerWidget",title:"Date-range calendar",icn:"date-range-calendar",help:"wdg/wdg-geo-time/#advanced-calendar"}}},this.constructor()}modelsHiddenParams.dateRangePicker={startDateValue:"",endDateValue:""},modelsParameters.dateRangePicker={label:"labelText",displayLabel:!0,displayTimePicker:!1,displayTimePicker24Hour:!1,labelFontSize:.5,labelColor:"var(--widget-label-color)",labelFontFamily:"var(--widget-font-family)",labelWidthProportion:"25%",valueFontSize:.5,valueColor:"var(--widget-color)",valueFontFamily:"var(--widget-font-family)",valueTextAlign:"left",displayBorder:!0,borderColor:"var(--widget-border-color)",backgroundColor:"var(--widget-input-color)"},modelsLayout.dateRangePicker={height:"5vh",width:"24vw",minWidth:"170px",minHeight:"32px"},dateRangePickerWidgetsPluginClass.prototype=basePlugin.prototype;var dateRangePickerWidgetsPlugin=new dateRangePickerWidgetsPluginClass;widgetsPluginsHandler.loadWidgetPlugin(dateRangePickerWidgetsPlugin);
function timePickerWidgetsPluginClass(){this.timepickerWidget=function(e,t,i,a){this.constructor(e,t,i,a);var l=this;this.enable=function(){},this.disable=function(){},this.updateValue=function(e){l.timeValue.updateCallback(l.timeValue,l.timeValue.getValue()),modelsHiddenParams[i].timeValue=l.timeValue.getValue()},this.rescale=function(){this.render()},this.render=function(){var a=document.createElement("div");a.setAttribute("style","display: table;text-align: left; height: inherit; width: inherit; cursor: inherit"),a.setAttribute("id","div-for-ng-timepicker"+t),$("#"+e).html(a);var r="";r=this.bIsInteractive?"clockpicker ":" ";var n="0%",o="labelText",s=$("#div-for-ng-timepicker"+t).width(),d="",c="calc(7px + 0.5vw + 0.4vh)",u="calc(7px + 0.5vw + 0.4vh)";1==modelsParameters[i].displayLabel&&(_.isUndefined(modelsParameters[i].label)||(o=this.getTransformedText("label")),_.isUndefined(modelsParameters[i].labelWidthProportion)||(n=modelsParameters[i].labelWidthProportion,s=(100-parseInt(n))*$("#div-for-ng-timepicker"+t).width()/100),_.isUndefined(modelsParameters[i].labelFontSize)||(c=this.labelFontSize()),_.isUndefined(modelsParameters[i].valueFontSize)||(u="calc(7px + "+modelsParameters[i].valueFontSize*getFontFactor()+"vw + 0.4vh)"),d='<span class="value-span" id="time-label-span'+t+'" style="width:'+n+"; "+c+this.labelColor()+this.labelFontFamily()+';">'+o+"</span>");var m="disabled",p="cursor: inherit; ";this.bIsInteractive&&(m="",p="cursor: pointer; ");var g=this.border(),h=$("#div-for-ng-timepicker"+t).height(),f=d+'<div style="height:100% width: '+s+'px;">'+('<div id="clockpicker'+t+'" ><div class="'+r+'"><input autocomplete="off" '+m+' placeholder="Select Time" id="clockpickerInput'+t+'" style="'+p+" height: "+h+"px; border-radius: 6px; "+g+"float: right;padding-right: "+u.replace("(","(3*(").replace(")","))")+";text-align: "+modelsParameters[i].valueTextAlign+"; font-size: "+u+"; "+this.valueColor()+this.valueFontFamily()+this.backgroundColor()+'" class="value-input form-control ng-pristine ng-untouched ng-valid ng-empty"><span class="form-control-feedback" style="'+p+"height: "+h+"px; display:table; margin-top: 0; top:0; padding-right: "+u+'"><i class="fa fa-lg fa-clock-o" style="display: table-cell; vertical-align: middle;'+p+"font-size: "+u+';" ></i></span></div></div>')+"</div>";a.innerHTML=f,$("#clockpicker"+t).clockpicker({autoclose:!0,default:"12:00",init:function(){this.value=modelsHiddenParams[i].timeValue},beforeShow:function(){},afterShow:function(){},beforeHide:function(){},afterHide:function(){},beforeHourSelect:function(){},afterHourSelect:function(){},beforeDone:function(){},afterDone:function(){}}).find("input").change((function(){modelsHiddenParams[i].timeValue=this.value,l.updateValue()})),$("#clockpickerInput"+t)[0].value=modelsHiddenParams[i].timeValue,$("#check-minutes").click((function(e){e.stopPropagation(),input.clockpicker("show").clockpicker("toggleView","minutes")})),this.bIsInteractive?l.enable():l.disable()};const r=new WidgetActuatorDescription("timeValue","Selected time as MM:HH",WidgetActuatorDescription.READ_WRITE,{$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:timepickerWidget",type:"string",pattern:"^[0-2]\\d:[0-5]\\d$"});this.getActuatorDescriptions=function(){return[r]},this.timeValue={updateCallback:function(){},setValue:function(e){modelsHiddenParams[i].timeValue=e,$("#clockpickerInput"+t)[0].value=e},getValue:function(){return modelsHiddenParams[i].timeValue},addValueChangedHandler:function(e){this.updateCallback=e,l.enable()},removeValueChangedHandler:function(e){l.disable()},setCaption:function(e,a){modelsParameters[i].inheritLabelFromData&&(l.captionHelper(e,l.bIsInteractive,a),$("#time-label-span"+t).text(modelsParameters[i].label))},clearCaption:function(){modelsParameters[i].inheritLabelFromData&&(modelsParameters[i].label=""),l.render()}},l.render()},this.timepickerWidget.prototype=baseWidget.prototype,this.pluginDefinition={name:"timepicker",widgetsDefinitionList:{timepickerSimple:{factory:"timepickerWidget",title:"Simple clock",icn:"clock",help:"wdg/wdg-geo-time/#simple-clock"}}},this.constructor()}modelsHiddenParams.timepickerSimple={timeValue:""},modelsParameters.timepickerSimple={label:"labelText",inheritLabelFromData:!0,displayLabel:!0,labelFontSize:.5,labelColor:"var(--widget-label-color)",labelFontFamily:"var(--widget-font-family)",labelWidthProportion:"30%",valueFontSize:.5,valueColor:"var(--widget-color)",valueFontFamily:"var(--widget-font-family)",valueTextAlign:"left",displayBorder:!0,borderColor:"var(--widget-border-color)",backgroundColor:"var(--widget-input-color)"},modelsLayout.timepickerSimple={height:"5vh",width:"19vw",minWidth:"150px",minHeight:"32px"},timePickerWidgetsPluginClass.prototype=basePlugin.prototype;var timePickerWidgetsPlugin=new timePickerWidgetsPluginClass;widgetsPluginsHandler.loadWidgetPlugin(timePickerWidgetsPlugin);
function calendarD3WidgetPluginClass(){this.calendarD3Widget=function(t,e,a,n){this.constructor(t,e,a,n);const i=this;this.enable=function(){},this.disable=function(){},this.updateValue=function(t){i.SelectedDate.updateCallback(i.SelectedDate,i.SelectedDate.getValue())},this.rescale=function(){this.render()},this.render=function(){const n=document.createElement("div");n.setAttribute("style","display: table;text-align: left; height: inherit; width: inherit; cursor: inherit"),n.setAttribute("id","div-for-calendarD3"+e),$("#"+t).html(n);const l=n.getBoundingClientRect(),r=l.width,d=l.height,o=d3.timeFormat("%Y-%m-%d"),s=d3.timeParse("%Y-%m-%d"),c=modelsHiddenParams[a].CalendarValues;var u;let p;if(u=c&&"values"in c?c.values:"",!_.isUndefined(u)&&u.length)p=u;else{const t=d3.timeDay.range(new Date(2020,5,2),Date.now());p=t.map((t=>({date:o(t),value:void 0})))}p=p.map((t=>({date:s(t.date),value:t.value}))).sort(((t,e)=>t.date.getTime()-e.date.getTime()));const g=_.isUndefined(c.start)?p[0].date:s(c.start),y=_.isUndefined(c.end)?p[p.length-1].date:s(c.end),h=d3.timeDay.range(g,y),m=_.difference(h.map((function(t){return t.getTime()})),p.map((function(t){return t.date.getTime()})));m.length>0&&(m.forEach((function(t){p.push({date:new Date(t),value:void 0})})),p=p.sort((function(t,e){return t.date.getTime()-e.date.getTime()})));let f,D,w,M,Y,k,b,v,C,V,x,P,S,W=modelsParameters[a].AllYearsVisible?"full":"single",A="monday",H=t=>"SMTWTFS"[t],F="%b",E="+%",U=(d3.interpolateRdYlGn,p[0].date.getFullYear()),T=p[p.length-1].date.getFullYear(),L=T,R=40,j=0,I=0;function O(){"single"===W?(f=p.filter((t=>L==t.date.getFullYear())).map((t=>t.date)),D=p.filter((t=>L==t.date.getFullYear())).map((t=>t.value))):(f=p.map((t=>t.date)),D=p.map((t=>t.value))),w=d3.range(f.length),P=d3.groups(w,(t=>f[t].getFullYear())).reverse(),M="sunday"===A?t=>t:t=>(t+6)%7,Y="sunday"===A?d3.timeSunday:d3.timeMonday,k="weekday"===A?5:7;let t=d/((k+2)*P.length),e=(r-R)/53;S=Math.min(t,e),b=S*(k+2),j=(r-(R+53*S))/2,(j<0||"single"===W)&&(j=0),I=(d-b*P.length)/2,(I<0||"single"===W)&&(I=0),v=d3.quantile(D,.9975),C=d3.scaleSequential([0,v],["#d5f4c7","red"]).unknown("none"),F=d3.timeFormat(F),V=d3.timeFormat("%B %-d, %Y"),x=C.tickFormat(100,E),title=t=>`${V(f[t])}\n${x(D[t])}`}function q(t){const e=Math.max(0,Math.min(k,M(t.getDay()))),a=Y.count(d3.timeYear(t),t);return`${0===e?`M${a*S},0`:e===k?`M${(a+1)*S},0`:`M${(a+1)*S},0V${e*S}H${a*S}`}V${k*S}`}O(),d3.selection.prototype.conditionalDraw=function(){const t=22*S+R,e=b*P.length/2;return"single"===W?this.attr("x",t).attr("y",e).style("opacity",0).transition().duration(500):this};const B=d3.select(n).append("svg").attr("style","width: inherit; height: inherit;").attr("font-family","sans-serif").attr("font-size",S);if(d3.select("body").append("div").attr("class","tooltip").attr("id","tooltipCalendar").style("display","none").style("pointer-events","none").style("background","#fff").style("color","#000").style("border","2px solid #000").style("opacity",0),"single"===W){const t="M 1 1 L 12 10 L 1 19 L 1 1",e="M 12 1 L 1 10 L 12 19 L 12 1",a=B.append("path").attr("d",t).style("fill-rule","evenodd").attr("transform","translate("+(28*S+R)+", "+b*P.length+") ").attr("stroke-width","0.0").attr("stroke","black").attr("fill","#888888"),n=B.append("path").attr("d",e).style("fill-rule","evenodd").attr("transform","translate("+(22*S+R)+", "+b*P.length+") ").attr("stroke-width","0.0").attr("stroke","black").attr("fill","#888888");a.on("click",(function(){N(1,a,n)})),n.on("click",(function(){N(-1,a,n)})),a.attr("opacity",.2)}async function N(t,e,a){const n=22*S+R,i=b*P.length/2,l=L+t;l>T||l<U||(L=l,await B.selectAll(".year").selectAll("*").transition().duration(500).attr("x",n).attr("y",i).style("opacity",0).end(),B.selectAll(".year").remove(),l==U?(a.attr("opacity",.2),e.attr("opacity",1)):l==T?(a.attr("opacity",1),e.attr("opacity",.2)):(a.attr("opacity",1),e.attr("opacity",1)),O(),z())}function z(){const t=B.selectAll("g").data(P).join("g");t.attr("class","year").attr("transform",((t,e)=>"translate("+(R+j)+`,${b*e+1.5*S+I})`)),t.append("text").conditionalDraw().attr("x",-5).attr("y",-5).attr("font-weight","bold").attr("text-anchor","end").text((([t])=>t)).style("opacity",1),t.append("g").attr("text-anchor","end").selectAll("text").data("weekday"===A?d3.range(1,6):d3.range(7)).join("text").conditionalDraw().attr("x",-5).attr("y",(t=>(M(t)+.5)*S)).attr("dy","0.31em").text(H).style("opacity",1),t.append("g").selectAll("rect").data("weekday"===A?([,t])=>t.filter((t=>![0,6].includes(f[t].getDay()))):([,t])=>t).join("rect").attr("width",S-1).attr("height",S-1).attr("fill",(function(t,e){return _.isUndefined(D[t])?modelsParameters[a].UndefinedValueColor:C(D[t])})).on("mouseover",(function(t,e){_.isUndefined(D[e])||(d3.select(this).attr("height",S-2).attr("width",S-2).attr("transform","translate(1,1)").style("stroke","black").style("stroke-width",1).style("stroke-opacity",1),d3.select("#tooltipCalendar").style("display","block").style("opacity",1).html("<center>"+o(f[e])+"</center>Value : "+D[e]).style("left",t.pageX+10+"px").style("top",t.pageY+10+"px"))})).on("mouseout",(function(t,e){_.isUndefined(D[e])||(d3.select(this).style("stroke","black").style("stroke-width",0).style("stroke-opacity",0).attr("transform","translate(0,0)").attr("width",S-1).attr("height",S-1),d3.select("#tooltipCalendar").style("display","none").style("opacity",0))})).on("click",(function(t,e){modelsHiddenParams[a].SelectedDate=o(f[e]),i.updateValue()})).conditionalDraw().style("opacity",1).attr("x",(t=>Y.count(d3.timeYear(f[t]),f[t])*S+.5)).attr("y",(t=>M(f[t].getDay())*S+.5));const e=t.append("g").selectAll("g").data((([,t])=>d3.timeMonths(d3.timeMonth(f[t[0]]),f[t[t.length-1]]))).join("g");e.filter(((t,e)=>e)).append("path").attr("fill","none").attr("stroke","#fff").attr("stroke-width",2).attr("d",q),e.append("text").text(F).conditionalDraw().style("opacity",1).attr("x",(t=>Y.count(d3.timeYear(t),Y.ceil(t))*S+3)).attr("y",-5).style("opacity",1)}function q(t){const e=Math.max(0,Math.min(k,M(t.getDay()))),a=Y.count(d3.timeYear(t),t);return`${0===e?`M${a*S},0`:e===k?`M${(a+1)*S},0`:`M${(a+1)*S},0V${e*S}H${a*S}`}V${k*S}`}z()};const l={$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:calendarD3Widget_input",type:"object",properties:{start:{type:"string"},end:{type:"string"},values:{type:"array",items:{type:"object",properties:{date:{type:"string"},value:{type:"number"}}}}}},r=new WidgetActuatorDescription("CalendarValues","Calendar Values Object{start : YYYY-MM-DD, end : YYYY-MM-DD, values : Array[{date : YYYY-MM-DD, value : number}]}",WidgetActuatorDescription.READ,l),d={$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:calendarD3Widget_dateSelected",type:"string"},o=new WidgetActuatorDescription("SelectedDate","Selected date as YYYY-MM-DD",WidgetActuatorDescription.WRITE,d);this.getActuatorDescriptions=function(){return[r,o]},this.CalendarValues={updateCallback:function(){},setValue:function(t){modelsHiddenParams[a].CalendarValues=t,i.render()},getValue:function(){return modelsHiddenParams[a].timeValue},addValueChangedHandler:function(t){this.updateCallback=t,i.enable()},removeValueChangedHandler:function(t){i.disable()}},this.SelectedDate={updateCallback:function(){},setValue:function(t){modelsHiddenParams[a].SelectedDate=t},getValue:function(){return modelsHiddenParams[a].SelectedDate},addValueChangedHandler:function(t){this.updateCallback=t},removeValueChangedHandler:function(t){}},i.render()},this.calendarD3Widget.prototype=baseWidget.prototype,this.pluginDefinition={name:"calendarD3",widgetsDefinitionList:{calendarD3:{factory:"calendarD3Widget",title:"Year Calenddar",icn:"year-calendar",help:"wdg/wdg-geo-time/#simple-clock"}}},this.constructor()}modelsHiddenParams.calendarD3={CalendarValues:[],SelectedDate:""},modelsParameters.calendarD3={AllYearsVisible:!0,UndefinedValueColor:"#F6F6F6"},modelsLayout.calendarD3={height:"5vh",width:"19vw",minWidth:"100px",minHeight:"100px"},calendarD3WidgetPluginClass.prototype=basePlugin.prototype;var calendarD3Plugin=new calendarD3WidgetPluginClass;widgetsPluginsHandler.loadWidgetPlugin(calendarD3Plugin);
function getLedSvg(e,t,i){var a="#008400",r="#00b700";switch(e){case"off":a=modelsParameters[i].offColor;var o=w3color(a);o.darker(5),r=o.toHexString();break;case"on":r=modelsParameters[i].onColor;var s=w3color(r);s.darker(10),a=s.toHexString();break;case"inactive":a="#e6e6e6",r="#a6a6a6"}return'<svg xmlns="http://www.w3.org/2000/svg" xmlns: xlink="http://www.w3.org/1999/xlink" viewBox="-1 -1 51 51"  preserveAspectRatio="xMinYMin meet" class="svg-content"><title>LED '+e+'</title><defs><linearGradient y2="0.154336" y1="1.1441" xlink: href="#linearGradient6506_'+t+'" x2="0.566583" x1="0.577235" id="linearGradient6650_'+t+'"/><linearGradient y2="0.846351" y1="0.057496" xlink: href="#linearGradient5756_'+t+'" x2="0.609143" x1="0.532859" id="linearGradient6646_'+t+'"/><linearGradient y2="1" y1="0.019227" xlink: href="#linearGradient5742_'+t+'" x2="0.500488" x1="0.496181" id="linearGradient6644_'+t+'"/><linearGradient id="linearGradient6506_'+t+'"><stop stop-color="#ffffff" stop-opacity="0" offset="0" id="stop6508_'+t+'" /><stop stop-color="#ffffff" stop-opacity="0.87451" offset="1" id="stop6510_'+t+'" /></linearGradient><linearGradient id="linearGradient5756_'+t+'"><stop stop-color="#828282" offset="0" id="stop5758_'+t+'" /><stop stop-color="#929292" stop-opacity="0.352941" offset="1" id="stop5760_'+t+'" /></linearGradient><linearGradient id="linearGradient5742_'+t+'"><stop stop-color="#adadad" offset="0" id="stop5744_'+t+'" /><stop stop-color="#f0f0f0" offset="1" id="stop5746_'+t+'" /></linearGradient><linearGradient y2="0.553776" x2="0.632943" y1="1" x1="1" id="svg_1_'+t+'"><stop offset="0" stop-opacity="0.984375" stop-color="'+a+'" /><stop offset="0.984505" stop-opacity="0.980469" stop-color="'+r+'" /></linearGradient></defs><g><title>Layer 1</title><g id="layer1_'+t+'"><g transform="matrix(31.25, 0, 0, 31.25, -625.023, -1325)" id="g9447_'+t+'"><path fill="url(#linearGradient6644_'+t+')" stroke-width="0.8" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="4" id="path6596_'+t+'" d="m21.60074,43.19165c0,0.441601 -0.3584,0.799999 -0.800001,0.799999c-0.441599,0 -0.799999,-0.358398 -0.799999,-0.799999c0,-0.441601 0.3584,-0.799999 0.799999,-0.799999c0.441601,0 0.800001,0.358398 0.800001,0.799999z" /><path fill="url(#linearGradient6646_'+t+')" stroke-width="0.8" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="4" id="path6598_'+t+'" d="m21.44627,43.191471c0,0.35638 -0.28924,0.645618 -0.64562,0.645618c-0.35638,0 -0.64562,-0.289238 -0.64562,-0.645618c0,-0.35638 0.28924,-0.645611 0.64562,-0.645611c0.35638,0 0.64562,0.28923 0.64562,0.645611z" /><path fill="url(#svg_1_'+t+')" stroke-width="0.8" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="4" id="path6600_'+t+'" d="m21.378719,43.191639c0,0.31905 -0.25893,0.577991 -0.57798,0.577991c-0.31905,0 -0.57799,-0.258942 -0.57799,-0.577991c0,-0.319038 0.25894,-0.577969 0.57799,-0.577969c0.31905,0 0.57798,0.25893 0.57798,0.577969z" /><path transform="rotate(-34.3336, 20.5508, 42.8652)" fill="url(#linearGradient6650_'+t+')" stroke-width="0.8" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="4" id="path6602_'+t+'" d="m20.7453,42.86636c0,0.065899 -0.087271,0.11937 -0.194811,0.11937c-0.107529,0 -0.194809,-0.053471 -0.194809,-0.11937c0,-0.06588 0.08728,-0.119358 0.194809,-0.119358c0.10754,0 0.194811,0.053478 0.194811,0.119358z" /></g></g></g></svg>'}function ledWidgetsPluginClass(){this.statusLedWidget=function(e,t,i,a){this.constructor(e,t,i,a);var r=this;this.enable=function(){},this.disable=function(){},this.backwardCompatibility=function(){modelsParameters[i].redAtStateOff&&delete modelsParameters[i].redAtStateOff,_.isUndefined(modelsParameters[i].onColor)&&(modelsParameters[i].onColor="#00b700"),_.isUndefined(modelsParameters[i].offColor)&&(modelsParameters[i].offColor="#004d00")},this.backwardCompatibility(),this.insertLabel=function(e){const a=this.getTransformedText("label"),r=$("<span>",{class:"led-span",id:"led-span"+t,html:a});let o="height: inherit; "+this.labelFontSize()+this.labelColor()+this.labelFontFamily();_.isUndefined(modelsParameters[i].labelWidthProportion)?o+=" width: 20%; ":o+=modelsParameters[i].labelWidthProportion+"; ",r.attr("style",o),e.append(r[0])},this.rescale=function(){this.render()},this.render=function(){var a,o=document.createElement("div");a=this.bIsInteractive?modelsHiddenParams[i].status?"on":"off":"inactive";var s=1;modelsParameters[i].displayLabel&&(s=(100-Number(modelsParameters[i].labelWidthProportion.replace("%","")))/100);var n=0,l=0;$("#"+e).width()*s>$("#"+e).height()?n=$("#"+e).height()-2:(n=$("#"+e).width()*s-2,l=($("#"+e).height()-n-2)/2),o.setAttribute("class","led-widget-html"),o.setAttribute("style","height: inherit");var d=document.createElement("div");d.setAttribute("class","svg-container"),d.setAttribute("style","display: inline-block; margin-top: "+l+"px; cursor: inherit; width:"+n+"px; height: "+n+"px");var c=getLedSvg(a,t,i);d.innerHTML=c,o.appendChild(d),modelsParameters[i].displayLabel&&this.insertLabel(o),$("#"+e).html(o),this.bIsInteractive?r.enable():r.disable()};const o=new WidgetActuatorDescription("status","Current status (boolean)",WidgetActuatorDescription.READ,WidgetPrototypesManager.SCHEMA_BOOLEAN);this.getActuatorDescriptions=function(){return[o]},this.status={updateCallback:function(){},setValue:function(e){e!=modelsHiddenParams[i].status&&(modelsHiddenParams[i].status=e,r.render())},getValue:function(){return modelsHiddenParams[i]},addValueChangedHandler:function(e){this.updateCallback=e,r.enable()},removeValueChangedHandler:function(e){r.disable()},setCaption:function(e,t){modelsParameters[i].inheritLabelFromData&&r.captionHelper(e,r.bIsInteractive,t)},clearCaption:function(){modelsParameters[i].inheritLabelFromData&&(modelsParameters[i].label=""),r.render()}},r.render()},this.statusLedWidget.prototype=baseWidget.prototype,this.pluginDefinition={name:"led",widgetsDefinitionList:{ledStatus:{factory:"statusLedWidget",title:"Status led",icn:"status"}}},this.constructor()}modelsHiddenParams.ledStatus={status:!1},modelsParameters.ledStatus={label:"labelText",inheritLabelFromData:!0,displayLabel:!0,labelFontSize:.5,labelColor:"var(--widget-label-color)",labelFontFamily:"var(--widget-font-family)",labelWidthProportion:"60%",onColor:"#00b700",offColor:"#004d00"},modelsLayout.ledStatus={height:"10vh",width:"10vw",minWidth:"40px",minHeight:"40px"},ledWidgetsPluginClass.prototype=basePlugin.prototype;var ledWidgetsPlugin=new ledWidgetsPluginClass;widgetsPluginsHandler.loadWidgetPlugin(ledWidgetsPlugin);
function flatUiComplexWidgetsPluginClass(){this.selectFlatUiWidget=function(e,t,l,a){this.constructor(e,t,l,a);const i=this;this.bFirstExec=!0,this.tmpSelectedValue="",this.enable=function(){$("#select"+t).off("click").on("click",(function(e,t){modelsHiddenParams[l].selectedValue=i.selectedValue.getValue(),i.selectedValue.updateCallback(i.selectedValue,i.selectedValue.getValue())})),$("#select"+t).prop("disabled",!1),document.styleSheets[0].addRule("#s2id_select"+t+" > .select2-choice > .select2-chosen",this.selectedValueColor()),document.styleSheets[0].addRule("#s2id_select"+t+" > .select2-choice",this.selectedItemDefaultColor()),document.styleSheets[0].addRule("#s2id_select"+t+" > .select2-choice:hover",this.selectedItemHoverColor())},this.disable=function(){$("#select"+t).prop("disabled",!0)},this.rescale=function(){this.render()},this.render=function(){const a=document.createElement("div");a.setAttribute("id","select-widget-html"+t),a.setAttribute("class","select-widget-html");let s=Math.min($("#"+e).height(),$("#"+e).width()/2),o="";if(modelsParameters[l].displayLabel){const a=this.getTransformedText("label");if(s=Math.min($("#"+e).height(),$("#"+e).width()/4),_.isUndefined(modelsParameters[l].selectWidthProportion))o='<span id="select-span'+t+'" class="select-span" style="max-width: 45%; '+this.labelFontSize()+this.labelColor()+this.labelFontFamily()+'">'+a+"</span>";else{const e=Math.max(0,100-parseFloat(modelsParameters[l].selectWidthProportion))+"%";o='<span id="select-span'+t+'" class="select-span" style="width:'+e+"; "+this.labelFontSize()+this.labelColor()+this.labelFontFamily()+'">'+a+"</span>"}}let r=[];if(_.isUndefined(modelsParameters[l].isKeyValuePairs)&&(modelsParameters[l].isKeyValuePairs=!0),!_.isUndefined(modelsHiddenParams[l].value))if(0!=modelsHiddenParams[l].value.length)r=modelsHiddenParams[l].value;else if(0!=modelsHiddenParams[l].values.length){for(let e=0;e<modelsHiddenParams[l].values.length;e++)r[e]={},r[e].value=modelsHiddenParams[l].values[e];for(let e=0;e<modelsHiddenParams[l].keys.length;e++)r[e].key=modelsHiddenParams[l].keys[e]}o+='<select data-toggle="select" id="select'+t+'" class="select-div form-control select select-primary select-block mbl" style="height: '+s+'px;">';for(let e=0;e<r.length;e++)o+='<option value="'+r[e].value+'">'+r[e].key+"</option>";o+="</select>",a.innerHTML=o,a.setAttribute("id","select-div-container"+t),a.setAttribute("style","height: "+s+"px; "+this.selectFontSize()+this.selectValueFontFamily()),$("#"+e).html(a),this.bIsInteractive?i.enable():i.disable();new MutationObserver((function(e,l){for(const a of e)if("childList"===a.type&&a.addedNodes.length){const e=document.querySelector("#s2id_select"+t+" > a > span:first-child");if(e){const t=e.getAttribute("id").split("-"),a=t[t.length-1];document.styleSheets[0].addRule("#select2-results-"+a,i.selectValueFontFamily()),l.disconnect()}}})).observe(document.body,{childList:!0,subtree:!0}),""!=modelsHiddenParams[l].selectedValue&&($("#select"+t)[0].value=modelsHiddenParams[l].selectedValue),this.findInSelect(this.tmpSelectedValue)&&($("#select"+t)[0].value=this.tmpSelectedValue),$("#select"+t).select2(),i.bFirstExec=!1},this.findInSelect=function(e){let t={};return _.isUndefined(i.values)?_.isUndefined(i.keyValuePairs)||(t=i.keyValuePairs):t=i.values,bFind=_.find(t.selectionValues,(function(t){return t==e})),bFind};const s=new WidgetActuatorDescription("selectedValue","Selected value",WidgetActuatorDescription.READ_WRITE,WidgetPrototypesManager.SCHEMA_NUMBER),o=new WidgetActuatorDescription("selectedValue","Selected value",WidgetActuatorDescription.READ_WRITE,WidgetPrototypesManager.SCHEMA_STRING),r=new WidgetActuatorDescription("selectedValue","Selected value",WidgetActuatorDescription.READ_WRITE,WidgetPrototypesManager.SCHEMA_BOOLEAN),n=new WidgetActuatorDescription("selectedValue","Selected value",WidgetActuatorDescription.READ_WRITE,WidgetPrototypesManager.SCHEMA_NUMBER_OR_STRING),d=new WidgetActuatorDescription("keys","Labels of the selectable options",WidgetActuatorDescription.READ,WidgetPrototypesManager.SCHEMA_STRING_ARRAY),c=new WidgetActuatorDescription("values","Selectable values. Must match 'keys'.",WidgetActuatorDescription.READ,WidgetPrototypesManager.SCHEMA_STRING_ARRAY),u=new WidgetActuatorDescription("values","Selectable values. Must match 'keys'.",WidgetActuatorDescription.READ,WidgetPrototypesManager.SCHEMA_NUMBER_ARRAY),h=new WidgetActuatorDescription("values","Selectable values. Must match 'keys'.",WidgetActuatorDescription.READ,WidgetPrototypesManager.SCHEMA_BOOLEAN_ARRAY),m=new WidgetActuatorDescription("keyValuePairs","Array of selectable key-value objects; Key being the displayed label",WidgetActuatorDescription.READ,{$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:selectFlatUiWidget_keyValuePairs_isNumber",type:"array",items:{type:"object",properties:{key:{type:["string","number","boolean"]},value:{type:"number"}},required:["key"]}}),g=new WidgetActuatorDescription("keyValuePairs","Array of selectable key-value objects; Key being the displayed label",WidgetActuatorDescription.READ,{$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:selectFlatUiWidget_keyValuePairs",type:"array",items:{type:"object",properties:{key:{type:["string","number","boolean"]},value:{type:"string"}},required:["key"]}}),p=new WidgetActuatorDescription("keyValuePairs","Array of selectable key-value objects; Key being the displayed label",WidgetActuatorDescription.READ,{$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:selectFlatUiWidget_keyValuePairs",type:"array",items:{type:"object",properties:{key:{type:["string","number","boolean"]},value:{type:"boolean"}},required:["key"]}});this.getActuatorDescriptions=function(e=null){const t=e||modelsParameters[l],a=[];t&&t.isKeyValuePairs?a.push(t.isNumber?m:t.isBoolean?p:g):(a.push(d),a.push(t&&t.isNumber?u:t.isBoolean?h:c));let i=n;return t&&(i=t.isNumber?s:t.isBoolean?r:o),a.push(i),a},this.selectedValue={updateCallback:function(){},setValue:function(e){i.tmpSelectedValue=e;i.findInSelect(e)&&($("#select"+t)[0].value=e,modelsHiddenParams[l].selectedValue=e,i.render())},getValue:function(){return modelsParameters[l].isNumber?Number($("#select"+t)[0].value):modelsParameters[l].isBoolean?"false"!==$("#select"+t)[0].value&&Boolean($("#select"+t)[0].value):$("#select"+t)[0].value},addValueChangedHandler:function(e){this.updateCallback=e,""!=$("#select"+t)[0].value&&e(this,$("#select"+t)[0].value),i.enable()},removeValueChangedHandler:function(e){i.disable()},setCaption:function(e,a){modelsParameters[l].inheritLabelFromData&&(i.captionHelper(e,i.bIsInteractive,a),$("#select-span"+t).text(modelsParameters[l].label))},clearCaption:function(){modelsParameters[l].inheritLabelFromData&&(modelsParameters[l].label=""),i.render()}},modelsParameters[l].isKeyValuePairs?this.keyValuePairs={selectionValues:[],setValue:function(e){if(""==e)selectionValues=[],modelsHiddenParams[l].value=e,i.render();else{const t='"keyValuePairs" must be an array of key or an array of key/value pairs (in widget'+l+")",a='Example1: [{"key":"choice1"}, {"key":"choice2"}] \n or Example2: [{"key":"choice1", "value":"1"}, {"key":"choice2", "value":"2"}]';if(!Array.isArray(e))return void swal(t,a,"info");for(let l=0;l<e.length;l++){if(_.isUndefined(e[l].key))return void swal(t,a,"info");_.isUndefined(e[l].value)&&(e[l].value=e[l].key),this.selectionValues[l]=e[l].value}modelsHiddenParams[l].value=e,i.render()}},getValue:function(){return modelsHiddenParams[l].value},addValueChangedHandler:function(e){i.enable()},removeValueChangedHandler:function(e){i.disable()}}:(this.keys={selectionValues:[],setValue:function(e){if(""===e)selectionValues=[],modelsHiddenParams[l].value=e,i.render();else{const t='"keys" must be an array (in widget'+l+")",a='Example: ["choice1","choice2"]';if(!Array.isArray(e))return void swal(t,a,"info");if("object"==typeof e[0])return void swal(t,a,"info");for(let t=0;t<e.length;t++)this.selectionValues[t]=e[t];modelsHiddenParams[l].value=[],modelsHiddenParams[l].keys=e,i.render()}},getValue:function(){return modelsHiddenParams[l].value},addValueChangedHandler:function(e){i.enable()},removeValueChangedHandler:function(e){i.disable()}},this.values={selectionValues:[],setValue:function(e){if(""===e)selectionValues=[],modelsHiddenParams[l].value=e,i.render();else{const t='"value" must be an array (in widget'+l+")",a="Example: [1, 2]";if(_.isNull(e)&&(e=modelsHiddenParams[l].keys),!Array.isArray(e))return void swal(t,a,"info");if("object"==typeof e[0])return void swal(t,a,"info");for(let t=0;t<e.length;t++)this.selectionValues[t]=e[t];modelsHiddenParams[l].value=[],modelsHiddenParams[l].values=e,i.render()}},getValue:function(){return modelsHiddenParams[l].value},addValueChangedHandler:function(e){i.enable()},removeValueChangedHandler:function(e){i.disable()}}),i.render()},this.selectFlatUiWidget.prototype=baseWidget.prototype,this.multiSelectFlatUiWidget=function(e,t,l,a){this.constructor(e,t,l,a);const i=this;this.enable=function(){$("#multi-select"+t).on("click",(function(e){i.selectedValue.updateCallback(i.selectedValue,i.selectedValue.getValue())})),$("#multi-select"+t)[0].style.opacity="1"},this.disable=function(){$("#multi-select"+t)[0].style.opacity="0.7"},this.rescale=function(){this.render()},this.hasScrollBar=function(e){return e.get(0).scrollHeight>e.get(0).clientHeight},this.render=function(){const a=document.createElement("div"),s=$("#"+e).height();a.setAttribute("style","width: inherit; height: "+s+"px; cursor: inherit;");let o='<div class="multi-select-div" id="multi-select'+t+'" style="height: '+s+"px; "+this.valueDefaultColor()+this.border()+'">';const r=modelsHiddenParams[l].value;let n="";if(n=this.bIsInteractive?"cursor: pointer; ":"cursor: inherit; ",_.isUndefined(modelsParameters[l].valueFontSize)&&(modelsParameters[l].valueFontSize=.4),Array.isArray(r))for(const e of r)o+="<label >",o+='<input type="checkbox" value="'+e+'" />',o+='<span id="multi-select-label'+t+'" style="'+n+this.valueFontFamily()+this.valueFontSize()+this.checkboxWidth()+this.checkboxHeight()+'" tabindex="-1">'+e+"</span>",o+="</label>";o+="</div>",a.innerHTML=o,$("#"+e).html(a);i.hasScrollBar($("#multi-select"+t))||$("#multi-select"+t+".multi-select-div").css("align-content","center");const d=window.mobileAndTabletCheck();("ontouchstart"in document.documentElement||d)&&($("#multi-select"+t)[0].style.height="auto"),modelsParameters[l].resetPastSelection||_.isEmpty(modelsHiddenParams[l].selectedValue)||$("#multi-select"+t+" > label > input[type='checkbox']").each((function(){for(const e of modelsHiddenParams[l].selectedValue)$(this).val()==e&&$(this).attr("checked",!0)})),document.styleSheets[0].addRule("#multi-select-label"+t,this.valueDefaultColor()),document.styleSheets[0].addRule("#multi-select-label"+t,this.checkboxDefaultColor()),document.styleSheets[0].addRule("#multi-select-label"+t,this.checkboxBorder()),document.styleSheets[0].addRule("#multi-select-label"+t+":hover",this.valueHoverColor()),document.styleSheets[0].addRule("#multi-select-label"+t+":hover",this.checkboxHoverColor()),document.styleSheets[0].addRule("#multi-select-label"+t+":hover",this.checkboxHoverBorderColor()),document.styleSheets[0].addRule('input[type="checkbox"]:checked + #multi-select-label'+t,this.valueFocusColor()),document.styleSheets[0].addRule('input[type="checkbox"]:checked + #multi-select-label'+t,this.checkboxFocusColor()),document.styleSheets[0].addRule('input[type="checkbox"]:checked + #multi-select-label'+t,this.checkboxFocusBorderColor()),this.bIsInteractive?i.enable():i.disable()};const s=new WidgetActuatorDescription("value","Available choices",WidgetActuatorDescription.READ,WidgetPrototypesManager.SCHEMA_PRIMITIVE_ARRAY),o=new WidgetActuatorDescription("selectedValue","Currently selected choices",WidgetActuatorDescription.READ_WRITE,WidgetPrototypesManager.SCHEMA_STRING_ARRAY);this.getActuatorDescriptions=function(){return[s,o]},this.value={updateCallback:function(){},setValue:function(e){modelsHiddenParams[l].value=e,i.render(),i.selectedValue.updateCallback(i.selectedValue,i.selectedValue.getValue())},getValue:function(){return modelsParameters[l].isNumber?Number(modelsHiddenParams[l].value):modelsParameters[l].isBoolean?"false"!==modelsHiddenParams[l].value&&Boolean(modelsHiddenParams[l].value):modelsHiddenParams[l].value},addValueChangedHandler:function(e){this.updateCallback=e},removeValueChangedHandler:function(e){},setCaption:function(e,t){},clearCaption:function(){}},this.selectedValue={updateCallback:function(){},setValue:function(e){$("#multi-select"+t+" > label > input[type='checkbox']").each((function(){for(const t of e)$(this).val()===t&&$(this).attr("checked",!0)})),modelsHiddenParams[l].selectedValue=e},getValue:function(){const e=[];return $("#multi-select"+t+" > label > input[type='checkbox']:checked").each((function(){if(modelsParameters[l].isNumber)e.push(Number($(this).val()));else if(modelsParameters[l].isBoolean){const t="false"!==$(this).val()&&Boolean($(this).val());e.push(t)}else e.push($(this).val())})),e},addValueChangedHandler:function(e){this.updateCallback=e},removeValueChangedHandler:function(e){},setCaption:function(e,t){},clearCaption:function(){}},i.render()},this.multiSelectFlatUiWidget.prototype=baseWidget.prototype,this.listFlatUiWidget=function(e,t,l,a){this.constructor(e,t,l,a);const i=this;this.enable=function(){let e=!1,l=!1;$("#list"+t).on("keyup",(function(e){l&&(65!=e.keyCode&&97!=e.keyCode&&17!=e.keyCode||(i.selectedValue.updateCallback(i.selectedValue,i.selectedValue.getValue()),l=!1))})),$("#list"+t).on("click keyup",(function(a){l=!1,a.ctrlKey?e||(e=!0,$("#list"+t).one("keyup",(function(t){i.selectedValue.updateCallback(i.selectedValue,i.selectedValue.getValue()),e=!1,l=!0}))):(i.selectedValue.updateCallback(i.selectedValue,i.selectedValue.getValue()),e||(e=!0,$("#list"+t).one("keyup",(function(t){65!=t.keyCode&&97!=t.keyCode&&17!=t.keyCode||(i.selectedValue.updateCallback(i.selectedValue,i.selectedValue.getValue()),e=!1,l=!0)}))))})),$("#list"+t)[0].style.opacity="1"},this.disable=function(){$("#list"+t)[0].style.opacity="0.7"},this.rescale=function(){this.render()},this.render=function(){const a=document.createElement("div"),s=$("#"+e).height();a.setAttribute("style","width: inherit; height: "+s+"px; cursor: inherit;");const o=this.border();let r='<select class="form-control" id="list'+t+'" multiple size="10" style="width: 100%; height: '+s+"px;/*background-color: rgba(255, 255, 255, 0)*/; border-radius: 6px; color: "+modelsParameters[l].listValueColor+"; "+o+"; "+this.valueFontFamily()+"box-sizing: border-box; font-size: calc(7px + "+modelsParameters[l].listValueFontSize*getFontFactor()+'vw + 0.4vh); cursor: inherit; max-width : 2000px">';const n=modelsHiddenParams[l].value;let d="";if(d=this.bIsInteractive?"cursor: pointer; ":"cursor: inherit; ",Array.isArray(n))for(const e of n)r+='<option style="'+d+'">'+e+"</option>";r+="</select>",a.innerHTML=r,$("#"+e).html(a);const c=window.mobileAndTabletCheck();("ontouchstart"in document.documentElement||c)&&($("#list"+t)[0].style.height="auto"),_.isEmpty(modelsHiddenParams[l].selectedValue)||$("#list"+t).val(modelsHiddenParams[l].selectedValue),document.styleSheets[0].addRule("#list"+t+" option",modelsParameters[l].listValueColor),document.styleSheets[0].addRule("#list"+t+" option",this.listBackgroundColor()),document.styleSheets[0].addRule("#list"+t+" option:checked",this.selectValueColor()),document.styleSheets[0].addRule("#list"+t+" option:checked",this.selectValueBackgroundColor()),this.bIsInteractive?i.enable():i.disable()};const s=new WidgetActuatorDescription("value","Available choices",WidgetActuatorDescription.READ,WidgetPrototypesManager.SCHEMA_PRIMITIVE_ARRAY),o=new WidgetActuatorDescription("selectedValue","Currently selected choices",WidgetActuatorDescription.READ_WRITE,{$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:listFlatUiWidget_selectedValue",anyOf:[{type:"string"},{type:"array",items:{type:"string"}}]});this.getActuatorDescriptions=function(){return[s,o]},this.value={updateCallback:function(){},setValue:function(e){pastSelect=JSON.stringify(modelsHiddenParams[l].selectedValue),modelsHiddenParams[l].value=e,i.render(),selected=JSON.stringify(i.selectedValue.getValue()),selected!==pastSelect&&i.selectedValue.updateCallback(i.selectedValue,i.selectedValue.getValue())},getValue:function(){return modelsHiddenParams[l].value},addValueChangedHandler:function(e){this.updateCallback=e},removeValueChangedHandler:function(e){},setCaption:function(e,t){},clearCaption:function(){}},this.selectedValue={updateCallback:function(){},setValue:function(e){$("#list"+t).val(e),modelsHiddenParams[l].selectedValue=e},getValue:function(){const e=document.getElementById("list"+t),a=$("#list"+t).val(),i=e.selectedOptions;let s=0;if(Array.isArray(modelsHiddenParams[l].value)&&(s=modelsHiddenParams[l].value.length),0===i.length)return"";for(const e of i)if(e.index<0||e.index>=s)return"";return a},addValueChangedHandler:function(e){this.updateCallback=e},removeValueChangedHandler:function(e){},setCaption:function(e,t){},clearCaption:function(){}},i.render()},this.listFlatUiWidget.prototype=baseWidget.prototype,this.tableFlatUiWidget=function(e,t,l,a){this.constructor(e,t,l,a);const i=this;this.enable=function(){$("#table"+t).editableTableWidget(),$("#table"+t+" td").on("change",(function(e,t){const a=$(this),s=a.parent(),o=a.index();let r=s.index(),n=.5;_.isUndefined(modelsParameters[l].tableValueFontSize)||(n=modelsParameters[l].tableValueFontSize),modelsParameters[l].headerLine&&(r+=1),_.isNaN(Number(t))||(t=Number(t)),modelsHiddenParams[l].value[r][o]=t,a.html('<span style="'+i.valueColor()+i.valueFontFamily()+" font-size: calc(7px + "+n*getFontFactor()+'vw)">'+t+"<span>"),i.value.updateCallback(i.value,i.value.getValue())}))},this.disable=function(){$("#table"+t+" td").on("change",(function(e,t){}))},this.buildTable=function(e){let t,a="",i=0,s=.5;_.isUndefined(modelsParameters[l].tableValueFontSize)||(s=modelsParameters[l].tableValueFontSize);let o=Array.isArray(e);if(o){let r=e[0];if(o=Array.isArray(r),o){if(modelsParameters[l].headerLine){i=1,a+="<thead><tr>";for(const t of e[0])a+='<th style="'+this.valueAlign()+'"><span style="'+this.valueColor()+this.valueFontFamily()+" font-size: calc(7px + "+s*getFontFactor()+'vw);"><b>'+t+"</b></span></th>";a+="</tr></thead>"}a+="<tbody>";for(let o=i;o<e.length;o++){modelsParameters[l].striped?o%2!=0&&(a+='<tr style="'+this.tableBackgroundColor("secondary")+'">'):a+="<tr>";for(let i=0;i<e[o].length;i++){let r=[];try{r=JSON.parse(modelsParameters[l].editableCols)}catch(e){}let n="";-1==_.indexOf(r,i)?t="false":(t="true",this.bIsInteractive&&(n="cursor: cell;")),a+='<td style="'+n+this.valueAlign()+'" data-editable="'+t+'"><span style="'+this.valueColor()+this.valueFontFamily()+" font-size: calc(7px + "+s*getFontFactor()+'vw)">'+e[o][i]+"</span></td>"}a+="</tr>"}a+="</tbody>"}else{a+="<tbody><tr>";for(let t=i;t<e.length;t++)r=e[t],a+='<td style="'+this.valueAlign()+'"><span style="'+this.valueColor()+this.valueFontFamily()+" font-size: calc(7px + "+s*getFontFactor()+'vw)">'+r+"</span></td>";a+="</tr></tbody>"}}return a},this.rescale=function(){this.render()},this.render=function(){const a=document.createElement("div"),s="cursor: "+(this.bIsInteractive?"auto":"inherit")+"; width: inherit; height: inherit; overflow: auto";a.setAttribute("style",s);let o='<table style="margin: 0; height: 100%; '+this.tableBackgroundColor("primary")+'" class="table';modelsParameters[l].bordered&&(o+=" table-bordered "),_.isUndefined(modelsParameters[l].noBorder)?modelsParameters[l].noBorder=!1:modelsParameters[l].noBorder&&(o+=" no-border "),o+=' table-responsive" id="table'+t+'" >';const r=modelsHiddenParams[l].value;let n=i.buildTable(r);""==n&&(n="<tbody><tr><td/><td/><td/></tr><tr><td/><td/><td/></tr></tbody>"),o+=n+"</table>",a.innerHTML=o,$("#"+e).html(a),this.bIsInteractive?i.enable():i.disable()};const s={$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:tableFlatUiWidget",anyOf:[{type:"array",items:{anyOf:[{type:"string"},{type:"number"},{type:"boolean"}]}},{type:"array",items:{type:"array",items:{anyOf:[{type:"string"},{type:"number"},{type:"boolean"}]}}}]},o=new WidgetActuatorDescription("value","Table content as an array or array of arrays",WidgetActuatorDescription.READ,s),r=new WidgetActuatorDescription("value","Table content as an array or array of arrays",WidgetActuatorDescription.READ_WRITE,s);this.getActuatorDescriptions=function(e=null){const t=e||modelsParameters[l];let a=[];try{a=JSON.parse(t.editableCols)}catch(e){}return Array.isArray(a)&&a.length?[r]:[o]},this.value={updateCallback:function(){},setValue:function(e){modelsHiddenParams[l].value=e,i.render()},getValue:function(){return modelsHiddenParams[l].value},addValueChangedHandler:function(e){this.updateCallback=e},removeValueChangedHandler:function(e){},setCaption:function(e,t){},clearCaption:function(){}},i.render()},this.tableFlatUiWidget.prototype=baseWidget.prototype,this.pluginDefinition={name:"flatUi",widgetsDefinitionList:{flatUiSelect:{factory:"selectFlatUiWidget",title:"Select",icn:"select",help:"wdg/wdg-basics/#select"},flatUiMultiSelect:{factory:"multiSelectFlatUiWidget",title:"Multi-select",icn:"multi-select",help:"wdg/wdg-basics/#multi-select"},flatUiList:{factory:"listFlatUiWidget",title:"List",icn:"list",help:"wdg/wdg-basics/#list"},flatUiTable:{factory:"tableFlatUiWidget",title:"Table",icn:"board",help:"wdg/wdg-basics/#table"}}},this.constructor()}modelsHiddenParams.flatUiSelect={keys:[],values:[],value:[],selectedValue:""},modelsHiddenParams.flatUiMultiSelect={value:[],selectedValue:""},modelsHiddenParams.flatUiList={value:[],selectedValue:""},modelsHiddenParams.flatUiTable={value:null},modelsParameters.flatUiSelect={label:"labelText",inheritLabelFromData:!0,displayLabel:!0,labelFontSize:.5,labelColor:"var(--widget-label-color)",labelFontFamily:"var(--widget-font-family)",selectWidthProportion:"70%",isNumber:!1,isBoolean:!1,selectValueFontFamily:"var(--widget-font-family)",selectValueFontSize:.5,selectedValueColor:"var(--widget-select-option-highlighted-text)",selectedItemDefaultColor:"var(--widget-select-option-highlighted-color)",selectedItemHoverColor:"var(--widget-select-option-highlighted-color)",isKeyValuePairs:!1},modelsParameters.flatUiMultiSelect={addControls:!1,resetPastSelection:!1,valueFontSize:.4,valueFontFamily:"var(--widget-font-family)",checkboxWidth:7,checkboxHeight:1.5,valueDefaultColor:"var(--widget-label-color)",checkboxDefaultColor:"var(--widget-multiselect-color)",checkboxBorderColor:"var(--widget-multiselect-border-color)",valueHoverColor:"var(--widget-multiselect-hover-text)",checkboxHoverColor:"var(--widget-multiselect-hover-color)",checkboxHoverBorderColor:"var(--widget-multiselect-hover-border-color)",valueFocusColor:"var(--widget-multiselect-checked-text)",checkboxFocusColor:"var(--widget-multiselect-checked-color)",checkboxFocusBorderColor:"var(--widget-multiselect-checked-border-color)",displayBorder:!0,borderColor:"var(--widget-border-color)",isNumber:!1,isBoolean:!1},modelsParameters.flatUiList={addControls:!1,listValueFontSize:.5,listValueColor:"var(--widget-select-drop-text)",listBackgroundColor:"var(--widget-select-drop-color)",selectValueColor:"var(--widget-select-option-highlighted-text)",selectValueBackgroundColor:"var(--widget-select-option-highlighted-color)",valueFontFamily:"var(--widget-font-family)",borderColor:"var(--widget-border-color)",displayBorder:!0},modelsParameters.flatUiTable={headerLine:!1,tableValueFontSize:.5,striped:!0,valueColor:"var(--widget-table-value-color)",valueFontFamily:"var(--widget-font-family)",valueAlign:"left",bordered:!0,noBorder:!1,editableCols:"[]",backgroundColor:{primary:"var(--widget-color-0)",secondary:"var(--widget-table-striped-odd)"}},modelsLayout.flatUiSelect={height:"5vh",width:"19vw",minWidth:"40px",minHeight:"27px"},modelsLayout.flatUiMultiSelect={height:"16vh",width:"11vw",minWidth:"80px",minHeight:"75px"},modelsLayout.flatUiList={height:"16vh",width:"11vw",minWidth:"80px",minHeight:"75px"},modelsLayout.flatUiTable={height:"10vh",width:"11vw",minWidth:"88px",minHeight:"79px"},flatUiComplexWidgetsPluginClass.prototype=basePlugin.prototype;var flatUiComplexWidgetsPlugin=new flatUiComplexWidgetsPluginClass;widgetsPluginsHandler.loadWidgetPlugin(flatUiComplexWidgetsPlugin);
function flatUiBooleanWidgetsPluginClass(){this.checkboxFlatUiWidget=function(e,t,i,l){this.constructor(e,t,i,l);const a=this;this.enable=function(){$("#checkbox"+t).off("click").on("click",(function(e,t){a.value.updateCallback(a.value,a.value.getValue())})),$("#checkbox"+t).radiocheck("enable")},this.disable=function(){$("#checkbox"+t).unbind("click"),$("#checkbox"+t).radiocheck("disable")},this.rescale=function(){this.render()},this.render=function(){let l=20,s=20;_.isNull($(".icons").height())||(l=$(".icons").height()),_.isNull($(".icons").width())||(s=$(".icons").width()),_.isUndefined(modelsParameters[i].checkboxSize)&&(modelsParameters[i].checkboxSize=1);const o=modelsParameters[i].checkboxSize*s,c=modelsParameters[i].checkboxSize*l;let d="";const n=document.createElement("div");n.setAttribute("id","checkbox-widget-html"+t);modelsParameters[i].checkboxSize,$("#"+e).height();n.setAttribute("style","width: inherit; cursor: inherit; display: flex; justify-content: center;");const r=_.isUndefined(modelsParameters[i].labelPosition)||"right"!==modelsParameters[i].labelPosition?"left":"right",h="left"===r?"rtl":"ltr";if(document.styleSheets[0].addRule("#checkbox-widget-html"+t,"direction: "+h),modelsParameters[i].displayLabel){const e=this.getTransformedText("label");let l='style = "cursor: inherit; padding-top:'+c+"px;";l+="right"===r?" padding-right: "+o+'px; padding-left: 0px; margin-right: 6px;"':" padding-left: "+o+'px; padding-right: 0px; margin-left: 6px;"',d+='<label class="checkbox" id="label'+t+'" '+l+' for="checkbox'+t+'">',d+='<input type="checkbox" class="nohover" data-toggle="radio" style="zoom:'+modelsParameters[i].checkboxSize+'" value="" id="checkbox'+t+'" disabled>',d+="</input>",d+="</label>";const a='style="display: flex; align-items: center; '+this.labelFontSize()+this.labelColor()+this.labelFontFamily()+'"';d+='<span id="checkbox-span'+t+'" class="checkbox-span" '+a+">"+e+"</span>"}else{d+='<label class="checkbox" id="label'+t+'" '+('style = "cursor: inherit; padding-top:'+c+"px; padding-left: "+o+'px; padding-right: 0px;"')+' for="checkbox'+t+'">',d+='<input type="checkbox" class="nohover" data-toggle="radio" style="zoom:'+modelsParameters[i].checkboxSize+' value="" id="checkbox'+t+'" disabled>',d+="</input>",d+="</label>"}n.innerHTML=d,$("#"+e).html(n),$('[data-toggle="checkbox"]').radiocheck(),$('[data-toggle="radio"]').radiocheck(),1==modelsHiddenParams[i].value?$("#checkbox"+t).radiocheck("check"):0==modelsHiddenParams[i].value&&$("#checkbox"+t).radiocheck("uncheck"),document.styleSheets[0].addRule("#label"+t+" .icons *","zoom: "+modelsParameters[i].checkboxSize),document.styleSheets[0].addRule("#label"+t+" .icons .icon-checked",this.checkedColor()),document.styleSheets[0].addRule("#label"+t+" .icons .icon-unchecked",this.uncheckedColor()),this.bIsInteractive?a.enable():a.disable()};const s=new WidgetActuatorDescription("value","Current value",WidgetActuatorDescription.READ_WRITE,WidgetPrototypesManager.SCHEMA_BOOLEAN);this.getActuatorDescriptions=function(){return[s]},this.value={updateCallback:function(){},setValue:function(e){modelsHiddenParams[i].value=e,$("#checkbox"+t)[0].checked=e},getValue:function(){return $("#checkbox"+t)[0].checked},addValueChangedHandler:function(e){this.updateCallback=e,a.enable()},removeValueChangedHandler:function(e){a.disable()},setCaption:function(e,t){modelsParameters[i].inheritLabelFromData&&(a.captionHelper(e,a.bIsInteractive,t),a.render())},clearCaption:function(){modelsParameters[i].inheritLabelFromData&&(modelsParameters[i].label=""),a.render()}},a.render()},this.checkboxFlatUiWidget.prototype=baseWidget.prototype,this.switchFlatUiWidget=function(e,t,i,l){this.constructor(e,t,i,l);const a=this;this.enable=function(i){$("#switch"+t).on("click",(function(i,l){if(a.value.updateCallback(a.value,a.value.getValue()),$("#switch"+t)[0].checked){const i=$("#switch-label"+t).height(),l=$("#"+e).width(),a=Math.min(l,i)-8,s=$("#slide"+t).width()-a-8;document.styleSheets[0].addRule("#slide"+t+":before","transform: translateX("+s+"px);")}else document.styleSheets[0].addRule("#slide"+t+":before","transform: translateX(0px);")})),$("#switch"+t).prop("disabled",!1)},this.disable=function(){$("#switch"+t).unbind("click"),$("#switch"+t).prop("disabled",!0)},this.updateSwitchStatus=function(){if(1==modelsHiddenParams[i].value){if(!$("#switch"+t)[0].checked){$("#switch"+t).prop("checked",!0);const i=$("#switch-label"+t).height(),l=$("#"+e).width(),a=Math.min(l,i)-8,s=$("#slide"+t).width()-a-8;document.styleSheets[0].addRule("#slide"+t+":before","transform: translateX("+s+"px);"),document.styleSheets[0].addRule("input:checked + #slide"+t,this.switchOnColor()),document.styleSheets[0].addRule("input:focus + #slide"+t,this.switchOnColor())}}else 0==modelsHiddenParams[i].value&&$("#switch"+t)[0].checked&&($("#switch"+t).prop("checked",!1),document.styleSheets[0].addRule("#slide"+t+":before","transform: translateX(0px);"))},this.rescale=function(){this.render()},this.render=function(){let l=1;_.isUndefined(modelsParameters[i].switchWidthProportion)||(l=Math.min(1,parseFloat(modelsParameters[i].switchWidthProportion)/100));const s=$("#"+e).height();let o=Math.min(s,260);o=Math.min(o,l*$("#"+e).width()/3),o=Math.ceil(o);const c=$("#"+e).width(),d=document.createElement("div");d.setAttribute("id","switch-widget-html"+t),d.setAttribute("class","switch-widget-html"),d.setAttribute("style","height: "+s+"px;");const n=_.isUndefined(modelsParameters[i].labelPosition)||"right"!==modelsParameters[i].labelPosition?"left":"right",r="left"===n?"rtl":"ltr";let h;if(document.styleSheets[0].addRule("#switch-widget-html"+t,"direction: "+r),_.isUndefined(modelsParameters[i].switchWidthProportion))h='<div class="switch-div" style="width: 100%;">';else{h='<div class="switch-div" style="width: '+(Math.min(100,parseFloat(modelsParameters[i].switchWidthProportion))+"%")+';">'}let u="";if(u=this.bIsInteractive?"cursor: pointer;":"cursor: inherit;",h+='<label id="switch-label'+t+'" class="switch-label" style="height:'+o+'px;">',h+='<input type="checkbox" id="switch'+t+'">',h+='<div id="slide'+t+'"class="slider round" style="'+u+'">',h+="</div>",h+="</label>",h+="</div>",modelsParameters[i].displayLabel){const e=this.getTransformedText("label");h+='<span id="switch-span'+t+'" class="switch-span" style="'+this.labelFontSize()+this.labelColor()+this.labelFontFamily()+" text-align: "+n+';">'+e+"</span>"}d.innerHTML=h,$("#"+e).html(d),document.styleSheets[0].addRule("input + #slide"+t,this.switchOffColor()),document.styleSheets[0].addRule("input:checked + #slide"+t,this.switchOnColor()),document.styleSheets[0].addRule("input:focus + #slide"+t,this.switchShadowColor());const m=Math.min(c,o)-8;if(document.styleSheets[0].addRule("#slide"+t+":before","width: "+m+"px;"),document.styleSheets[0].addRule("#slide"+t+":before","height: "+m+"px;"),null==modelsHiddenParams[i].value&&(modelsHiddenParams[i].value=!1),1==modelsHiddenParams[i].value){$("#switch"+t).prop("checked",!0);const e=$("#slide"+t).width()-m-8;document.styleSheets[0].addRule("#slide"+t+":before","transform: translateX("+e+"px);")}else 0==modelsHiddenParams[i].value&&($("#switch"+t).prop("checked",!1),document.styleSheets[0].addRule("#slide"+t+":before","transform: translateX(0px);"));this.bIsInteractive?a.enable():a.disable(),$("#switch"+t)[0].checked=modelsHiddenParams[i].value};const s=new WidgetActuatorDescription("value","Current value",WidgetActuatorDescription.READ_WRITE,WidgetPrototypesManager.SCHEMA_BOOLEAN);this.getActuatorDescriptions=function(){return[s]},this.value={updateCallback:function(){},setValue:function(e){modelsHiddenParams[i].value=e,a.updateSwitchStatus()},getValue:function(){return $("#switch"+t)[0].checked},addValueChangedHandler:function(e){this.updateCallback=e},removeValueChangedHandler:function(e){},setCaption:function(e,t){modelsParameters[i].inheritLabelFromData&&(a.captionHelper(e,a.bIsInteractive,t),a.render())},clearCaption:function(){modelsParameters[i].inheritLabelFromData&&(modelsParameters[i].label=""),a.render()}},a.render()},this.switchFlatUiWidget.prototype=baseWidget.prototype,this.pluginDefinition={name:"flatUiBoolean",widgetsDefinitionList:{flatUiCheckbox:{factory:"checkboxFlatUiWidget",title:"Checkbox",icn:"checkbox",help:"wdg/wdg-basics/#checkbox"},flatUiSwitch:{factory:"switchFlatUiWidget",title:"Switch",icn:"switch",help:"wdg/wdg-basics/#switch"}}},this.constructor()}modelsHiddenParams.flatUiCheckbox={value:!1},modelsHiddenParams.flatUiSwitch={value:!1},modelsParameters.flatUiCheckbox={label:"labelText",inheritLabelFromData:!0,displayLabel:!0,labelPosition:"right",labelFontSize:.5,labelColor:"var(--widget-label-color)",labelFontFamily:"var(--widget-font-family)",checkboxSize:1,checkedColor:"var(--widget-input-checked-color)",uncheckedColor:"var(--widget-input-unchecked-color)"},modelsParameters.flatUiSwitch={label:"labelText",inheritLabelFromData:!0,displayLabel:!0,labelPosition:"right",labelFontSize:.5,labelColor:"var(--widget-label-color)",labelFontFamily:"var(--widget-font-family)",switchWidthProportion:"30%",switchOnColor:"var(--widget-input-checked-color)",switchOffColor:"var(--widget-input-unchecked-color)"},modelsLayout.flatUiCheckbox={height:"5vh",width:"9vw",minWidth:"32px",minHeight:"24px"},modelsLayout.flatUiSwitch={height:"5vh",width:"10vw",minWidth:"50px",minHeight:"24px"},flatUiBooleanWidgetsPluginClass.prototype=basePlugin.prototype;var flatUiBooleanWidgetsPlugin=new flatUiBooleanWidgetsPluginClass;widgetsPluginsHandler.loadWidgetPlugin(flatUiBooleanWidgetsPlugin);
function flatUiAddressCompletionWidgetsPluginClass(){this.hereAutocompleteValueFlatUiWidget=function(e,t,a,i){this.constructor(e,t,a,i);var s=this;this.updateValue=function(e){if(!_.contains([9,16,17,18,20,33,34,35,36,37,38,39,40],e.which)&&(10==e.which||13==e.which||27==e.which)){var i=$("#ac-value"+t)[0].value;modelsHiddenParams[a].value=i,s.value.updateCallback(s.value,i),e.preventDefault()}},this.enable=function(){$("#ac-value"+t).prop("disabled",!1),$("#ac-value"+t).bind("typeahead:selected",(function(e,t,i){modelsHiddenParams[a].value=t.word,s.value.updateCallback(s.value,t.word)})),$("#ac-value"+t).on("keyup",(function(e,t){s.updateValue(e)})),$("#ac-value"+t).on("click",(function(e,t){widgetPreview.elevateZIndex(a,e)})),s.initTypeahead()},this.disable=function(){$("#ac-value"+t).prop("disabled",!0)},this.formatHereSuggestTable=function(e){var t=[];if(_.isUndefined(e))return t;if(_.isEmpty(e))return t;if(_.isUndefined(e.suggestions))return t;if(_.isEmpty(e.suggestions))return t;for(var a=0;a<e.suggestions.length;a++)t[a]=[],t[a][0]=e.suggestions[a].address.houseNumber,t[a][1]=e.suggestions[a].address.street,t[a][2]=e.suggestions[a].address.postalCode,t[a][3]=e.suggestions[a].address.city,t[a][4]=e.suggestions[a].address.county,t[a][5]=e.suggestions[a].address.state,t[a][6]=e.suggestions[a].address.country;return t},this.formatSuggestWords=function(e){var t,a,i,s=[];if(e.length<1)return"";for(var l=0;l<e.length;l++){s[l]="",i=!0;for(var o=0;o<=6;o++)a=i?"":", ",t=e[l][o],_.isNull(t)||_.isUndefined(t)||(s[l]=s[l]+a+t,i=!1)}var n=[];if(_.isArray(s))for(l=0;l<s.length;l++)n[l]={word:s[l]};return n},this.initTypeahead=function(){var e="";_.isUndefined(modelsParameters[a].countryIsoCodes)||(e="&country="+modelsParameters[a].countryIsoCodes),$("#ac-value"+t).typeahead("destroy"),$("#ac-value"+t).typeahead(null,{name:"suggestions",displayKey:"word",source:function(t,a){$.ajax({url:"https://xdashgateway.azure-api.net/autocomplete/suggest.json?query="+t+"&language=fr"+e,method:"GET",dataType:"json",success:function(e){var t=s.formatHereSuggestTable(e),i=s.formatSuggestWords(t);_.isUndefined(i)||a($.map(i,(function(e){return e})))}})}})},this.rescale=function(){this.render()},this.render=function(){let i=Math.min($("#"+e).height(),$("#"+e).width()/2);const l=document.createElement("div");l.setAttribute("id","ac-value-widget-html"+t),l.setAttribute("class","ac-value-widget-html");let o="";if(modelsParameters[a].displayLabel){let s="";if(i=Math.min($("#"+e).height(),$("#"+e).width()/4),_.isUndefined(modelsParameters[a].valueWidthProportion))s="max-width: 45%; ";else{s="width: "+(Math.max(0,100-parseFloat(modelsParameters[a].valueWidthProportion))+"%")+"; "}const l=this.getTransformedText("label");o+='<span id ="ac-value-span'+t+'" class="ac-value-span" style="'+this.labelFontSize()+this.labelColor()+this.labelFontFamily()+s+'">'+l+"</span>"}const n=this.border();o+='<div id="ac-value-no-input-group">',o+='<input id="ac-value'+t+'" type="text" placeholder="Type an address" autocomplete="off" spellcheck="false" class="value-input form-control" style="height: '+i+"px; "+n+"; float: right; "+this.valueFontSize()+this.valueColor()+this.valueFontFamily()+this.backgroundColor()+'text-align: left;">',o+="</input>",o+="</div>",l.innerHTML=o,this.bIsInteractive?l.setAttribute("style","height: "+i+"px; cursor: text;"):l.setAttribute("style","height: "+i+"px;"),$("#"+e).html(l),$("#ac-value"+t)[0].value=modelsHiddenParams[a].value,this.bIsInteractive?s.enable():s.disable()};const l=new WidgetActuatorDescription("value","Current value",WidgetActuatorDescription.READ_WRITE,WidgetPrototypesManager.SCHEMA_STRING);this.getActuatorDescriptions=function(){return[l]},this.value={updateCallback:function(){},setValue:function(e){modelsHiddenParams[a].value=e,$("#ac-value"+t)[0].value=modelsHiddenParams[a].value},getValue:function(){return modelsHiddenParams[a].value},addValueChangedHandler:function(e){this.updateCallback=e,s.enable()},removeValueChangedHandler:function(e){s.disable()},setCaption:function(e,i){modelsParameters[a].inheritLabelFromData&&(s.captionHelper(e,s.bIsInteractive,i),$("#ac-value-span"+t).text(modelsParameters[a].label))},clearCaption:function(){modelsParameters[a].inheritLabelFromData&&(modelsParameters[a].label=""),s.render()}},s.render()},this.hereAutocompleteValueFlatUiWidget.prototype=baseWidget.prototype,this.pluginDefinition={name:"flatUiAddressCompletion",widgetsDefinitionList:{flatUiHereAutocompleteValue:{factory:"hereAutocompleteValueFlatUiWidget",title:"Address auto-completion",iconWidth:70,icn:"address-autocompletion",help:"wdg/wdg-geo-time/#address-autocompletion"}}},this.constructor()}modelsHiddenParams.flatUiHereAutocompleteValue={value:""},modelsParameters.flatUiHereAutocompleteValue={label:"labelText",inheritLabelFromData:!0,displayLabel:!0,labelFontSize:.5,labelColor:"var(--widget-label-color)",labelFontFamily:"var(--widget-font-family)",valueWidthProportion:"70%",valueFontSize:.5,valueColor:"var(--widget-color)",valueFontFamily:"var(--widget-font-family)",displayBorder:!0,borderColor:"var(--widget-border-color)",backgroundColor:"var(--widget-input-color)",countryIsoCodes:"FRA"},modelsLayout.flatUiHereAutocompleteValue={height:"5vh",width:"19vw",minWidth:"150px",minHeight:"32px"},flatUiAddressCompletionWidgetsPluginClass.prototype=basePlugin.prototype;var flatUiAddressCompletionWidgetsPlugin=new flatUiAddressCompletionWidgetsPluginClass;widgetsPluginsHandler.loadWidgetPlugin(flatUiAddressCompletionWidgetsPlugin);
function flatUiWidgetsPluginClass(){const e=this;!function(e){e.fn.addSliderSegments=function(){return this.each((function(){var t=e(this),a=t.slider("option"),i=(a.max-a.min)/a.step;if("vertical"===a.orientation){for(var l="",r=1;r<=i-1;r++)l+='<div class="ui-slider-segment" style="top:'+100/i*r+'%;"></div>';t.prepend(l)}else{var o='<div class="ui-slider-segment" style="margin-left: '+(100/i+"%")+';"></div>';t.prepend(o.repeat(i-1))}}))}}(jQuery),this.buttonFlatUiWidget=function(e,t,a,i){this.constructor(e,t,a,i);const l=this;this.numberOfTriggers=modelsParameters[a].numberOfTriggers,this.enable=function(){},this.disable=function(){},this.readFileEvt=function(){const e=$("#button"+t+"_select_file");e.on("change",(function(e){const t=new FileReader,i=e.target.files[0],l=i.size;let r="";r=l<1024?`${l} bytes`:l<1048576?`${(l/1024).toFixed(1)} KB`:`${(l/1048576).toFixed(1)} MB`;const o={type:i.type,size:r,name:i.name};t.addEventListener("load",(function(e){const t=e.target.result;t instanceof ArrayBuffer?(o.content=btoa([].reduce.call(new Uint8Array(t),(function(e,t){return e+String.fromCharCode(t)}),"")),o.isBinary=!0):(o.content=t,o.isBinary=!1),updateDataNodeFileFromWidget(a,o)})),modelsParameters[a].binaryFileInput?t.readAsArrayBuffer(i):t.readAsText(i)})),$("#button"+t).mousedown((function(t){t.preventDefault(),e.trigger("click")}))},this.rescale=function(){this.render()},this.render=function(){const i=document.createElement("div");i.setAttribute("id","button-widget-html"+t),i.setAttribute("class","button-widget-html");const r=Math.min($("#"+e).height(),$("#"+e).width()/2);let o=.5;_.isUndefined(modelsParameters[a].buttonFontSize)||(o=modelsParameters[a].buttonFontSize);const n='style="height: inherit; font-size: calc(7px + '+o*getFontFactor()+"vw + 0.4vh); "+this.buttonFontFamily()+'" class="btn btn-table-cell btn-lg '+a+"widgetCustomColor";this.setButtonColorStyle();let s="";const d=this.getTransformedText("text");let u=d;if(this.displayIcon()){u='<i class="'+this.fontAwesomeIcon()+'"></i>'+" "+d}if(this.bIsInteractive){if(modelsParameters[a].fileInput||modelsParameters[a].binaryFileInput){s+="<a "+n+'" id="button'+t+'">'+u+("<input onclick=\"displaySpinnerOnInputFileButton('"+t+'\')" type="file" style="display : none;" id="button'+t+'_select_file"></input>')+"</a>"}else s+="<a onclick=\"updateDataNodeFromWidgetwithspinButton( '"+a+"', '"+t+"')\" "+n+'" id="button'+t+'">'+u+"</a>";l.enable()}else s+="<a "+n+' /*disabled*/" id="button'+t+'">'+u+"</a>",l.disable();i.innerHTML=s,i.setAttribute("style","height: "+r+"px;"),$("#"+e).html(i),(modelsParameters[a].fileInput||modelsParameters[a].binaryFileInput)&&l.readFileEvt()},this.getActuatorDescriptions=function(e=null){const t=e||modelsParameters[a],i=[];if(t&&t.numberOfTriggers){const e=t.fileInput||t.binaryFileInput;for(let a=1;a<=t.numberOfTriggers;a++){const t="trigger"+a;e?i.push(new WidgetActuatorDescription(t,"File content",WidgetActuatorDescription.FILE)):i.push(new WidgetActuatorDescription(t,"Node to trigger/re-evaluate",WidgetActuatorDescription.TRIGGER,WidgetPrototypesManager.SCHEMA_ANYTHING))}}return i};for(let e=1;e<=this.numberOfTriggers;e++){this["trigger"+e]={updateCallback:function(){},addValueChangedHandler:function(e){this.updateCallback=e,l.enable()},removeValueChangedHandler:function(e){l.disable()}}}l.render()},this.buttonFlatUiWidget.prototype=baseWidget.prototype,this.horizontalSliderFlatUiWidget=function(e,t,a,i){this.constructor(e,t,a,i);var l=this;l.updateValue=function(e){var i=Number($("#hslider-value"+t)[0].value);$("#slider"+t).slider({value:i}),modelsHiddenParams[a].value=i,l.value.updateCallback(l.value,l.value.getValue()),e.preventDefault()},this.enable=function(){$("#slider"+t).on("slidestop",(function(e,t){l.value.setValue(t.value),l.value.updateCallback(l.value,t)})),$("#slider"+t).on("slide",(function(e,t){l.value.setValue(t.value)})),$("#slider"+t).slider("enable"),modelsParameters[a].validationOnFocusOut&&$("#hslider-value"+t).on("focusout",(function(e,t){l.updateValue(e)})),modelsParameters[a].displayValue&&($("#hslider-value"+t).prop("disabled",!1),$("#hslider-value"+t).on("keypress",(function(e,t){13==e.which&&l.updateValue(e)})))},this.disable=function(){$("#slider"+t).on("slide",(function(e,t){})),$("#slider"+t).on("slidestop",(function(e,t){})),$("#slider"+t).slider("disable"),modelsParameters[a].displayValue&&$("#hslider-value"+t).prop("disabled",!0)},this.insertLabel=function(e){const t=this.getTransformedText("label"),i=document.createElement("span");i.setAttribute("class","label-h-slider"),i.setAttribute("id","h-slider-span"),_.isUndefined(modelsParameters[a].labelWidthProportion)?i.setAttribute("style","width: 20%; "+this.labelFontSize()+this.labelColor()+this.labelFontFamily()):i.setAttribute("style","width:"+modelsParameters[a].labelWidthProportion+"; "+this.labelFontSize()+this.labelColor()+this.labelFontFamily()),i.innerHTML=t,e.appendChild(i)},this.insertValue=function(i){var l;l=modelsParameters[a].displayLabel?Math.min($("#"+e).height(),$("#"+e).width()/6):Math.min($("#"+e).height(),$("#"+e).width()/8);var r=document.createElement("div");r.setAttribute("class","h-slider-value-div"),r.setAttribute("id","div-for-hslider-value"+t),_.isUndefined(modelsParameters[a].valueWidthProportion)?r.setAttribute("style","width:30%;"):r.setAttribute("style","width:"+modelsParameters[a].valueWidthProportion+";");var o="";o=this.bIsInteractive?"cursor: text;":"cursor: inherit;";var n='<input id="hslider-value'+t+'" type="text" placeholder="" class="hslider-input form-control" style="height: '+l+"px; "+this.valueFontSize()+this.valueColor()+this.valueFontFamily()+o+'" disabled></input>';r.innerHTML=n,i.appendChild(r)},this.rescale=function(){this.render()},this.render=function(){var i=document.createElement("div");i.setAttribute("class","sliderInput"),i.setAttribute("style","display: table");var r=document.createElement("div");r.setAttribute("id","h-slider-div"),_.isUndefined(modelsParameters[a].sliderWidthProportion)?r.setAttribute("style","width:50%;"):r.setAttribute("style","width:"+modelsParameters[a].sliderWidthProportion+";");var o=document.createElement("div");if(o.setAttribute("id","slider"+t),r.appendChild(o),modelsParameters[a].displayLabel&&this.insertLabel(i),i.appendChild(r),modelsParameters[a].displayValue&&this.insertValue(i),""!=modelsParameters[a].unit&&modelsParameters[a].displayUnit){const e=document.createElement("span");e.setAttribute("class","value-span"),e.setAttribute("style","max-width: 45%; font-size: calc(7px + "+modelsParameters[a].unitFontSize*getFontFactor()+"vw + 0.4vh);"),e.setAttribute("id","unit-span"+t),e.innerHTML=modelsParameters[a].unit,i.appendChild(e)}$("#"+e).html(i);var n=$("#slider"+t);n.length>0&&n.slider({min:modelsParameters[a].min,max:modelsParameters[a].max,step:modelsParameters[a].step,value:modelsHiddenParams[a].value,orientation:"horizontal",range:"min"}).addSliderSegments(),$("#slider"+t).addClass("h-slider-div-div"),document.styleSheets[0].addRule("#slider"+t,this.sliderSegmentColor()),document.styleSheets[0].addRule("#slider"+t+" > .ui-slider-range",this.sliderRangeColor()),document.styleSheets[0].addRule("#slider"+t+" > .ui-slider-handle",this.sliderHandleDefaultColor()),document.styleSheets[0].addRule("#slider"+t+" > .ui-slider-handle:hover",this.sliderHandleHoverColor()),document.styleSheets[0].addRule("#slider"+t+" > .ui-slider-handle:active",this.sliderHandleActiveColor()),document.styleSheets[0].addRule("#hslider-value"+t,this.valueBorderColor()),this.bIsInteractive?l.enable():l.disable(),modelsParameters[a].displayValue&&(modelsParameters[a].min>modelsHiddenParams[a].value?$("#hslider-value"+t)[0].value=modelsParameters[a].min:$("#hslider-value"+t)[0].value=modelsHiddenParams[a].value)};const r=new WidgetActuatorDescription("value","Current value",WidgetActuatorDescription.READ_WRITE,WidgetPrototypesManager.SCHEMA_NUMBER),o=new WidgetActuatorDescription("min","Value lower bound",WidgetActuatorDescription.READ,WidgetPrototypesManager.SCHEMA_NUMBER),n=new WidgetActuatorDescription("max","Value upper bound",WidgetActuatorDescription.READ,WidgetPrototypesManager.SCHEMA_NUMBER);this.getActuatorDescriptions=function(e=null){const t=e||modelsParameters[a],i=[r];return t&&t.rangeActuator&&(i.push(o),i.push(n)),i},this.value={updateCallback:function(){},setValue:function(e){modelsHiddenParams[a].value=e,$("#slider"+t).slider({value:e}),modelsParameters[a].displayValue&&($("#hslider-value"+t)[0].value=e)},getValue:function(){return modelsHiddenParams[a].value},addValueChangedHandler:function(e){this.updateCallback=e,l.enable()},removeValueChangedHandler:function(e){l.disable()},setCaption:function(e,t){modelsParameters[a].inheritLabelFromData&&(l.captionHelper(e,l.bIsInteractive,t),l.render())},clearCaption:function(){modelsParameters[a].inheritLabelFromData&&(modelsParameters[a].label=""),l.render()}},this.max={updateCallback:function(){},setValue:function(e){const t=Number(e);modelsParameters[a].max=t,l.render()},getValue:function(){return modelsParameters[a].max},addValueChangedHandler:function(e){this.updateCallback=e,l.enable()},removeValueChangedHandler:function(e){l.disable()}},this.min={updateCallback:function(){},setValue:function(e){const t=Number(e);modelsParameters[a].min=t,l.render()},getValue:function(){return modelsParameters[a].min},addValueChangedHandler:function(e){this.updateCallback=e,l.enable()},removeValueChangedHandler:function(e){l.disable()}},l.render()},this.horizontalSliderFlatUiWidget.prototype=baseWidget.prototype,this.verticalSliderFlatUiWidget=function(e,t,a,i){this.constructor(e,t,a,i);var l=this;this.enable=function(e){$("#vertical-slider"+t).on("slidestop",(function(e,t){l.value.setValue(t.value),l.value.updateCallback(l.value,t)})),$("#vertical-slider"+t).on("slide",(function(e,t){l.value.setValue(t.value)})),$("#vertical-slider"+t).slider("enable")},this.disable=function(){$("#vertical-slider"+t).on("slidestop",(function(e,t){})),$("#vertical-slider"+t).on("slide",(function(e,t){})),$("#vertical-slider"+t).slider("disable")},this.insertLabel=function(e){const t=this.getTransformedText("label"),a=document.createElement("div");a.setAttribute("class","v-slider-div");const i=document.createElement("span");i.setAttribute("class","v-slider-span label-v-slider"),i.setAttribute("style",this.labelFontSize()+this.labelColor()+this.labelFontFamily()),i.innerHTML=t,a.appendChild(i),e.appendChild(a)},this.rescale=function(){this.render()},this.render=function(){var i=document.createElement("div");i.setAttribute("class","sliderInput");var r=document.createElement("div");r.setAttribute("id","vertical-slider"+t),r.setAttribute("class","v-slider-div-div"),r.setAttribute("style","height: calc(100% - 24px);"),i.appendChild(r),modelsParameters[a].displayLabel&&""!=modelsParameters[a].label&&(r.setAttribute("style","height: 80%;"),this.insertLabel(i)),$("#"+e).html(i);var o=$("#vertical-slider"+t);o.length>0&&o.slider({min:modelsParameters[a].min,max:modelsParameters[a].max,step:modelsParameters[a].step,value:modelsHiddenParams[a].value,orientation:"vertical",range:"min"}).addSliderSegments(o.slider("option").max,"vertical"),document.styleSheets[0].addRule("#vertical-slider"+t,this.sliderSegmentColor()),document.styleSheets[0].addRule("#vertical-slider"+t+" > .ui-slider-range",this.sliderRangeColor()),document.styleSheets[0].addRule("#vertical-slider"+t+" > .ui-slider-handle",this.sliderHandleDefaultColor()),document.styleSheets[0].addRule("#vertical-slider"+t+" > .ui-slider-handle:hover",this.sliderHandleHoverColor()),document.styleSheets[0].addRule("#vertical-slider"+t+" > .ui-slider-handle:active",this.sliderHandleActiveColor()),this.bIsInteractive?l.enable():l.disable()};const r=new WidgetActuatorDescription("value","Current value",WidgetActuatorDescription.READ_WRITE,WidgetPrototypesManager.SCHEMA_NUMBER),o=new WidgetActuatorDescription("min","Value lower bound",WidgetActuatorDescription.READ,WidgetPrototypesManager.SCHEMA_NUMBER),n=new WidgetActuatorDescription("max","Value upper bound",WidgetActuatorDescription.READ,WidgetPrototypesManager.SCHEMA_NUMBER);this.getActuatorDescriptions=function(e=null){const t=e||modelsParameters[a],i=[r];return t&&t.rangeActuator&&(i.push(o),i.push(n)),i},this.value={updateCallback:function(){},setValue:function(e){modelsHiddenParams[a].value=e,$("#vertical-slider"+t).slider({value:e})},getValue:function(){return modelsHiddenParams[a].value},addValueChangedHandler:function(e){this.updateCallback=e,l.enable()},removeValueChangedHandler:function(e){l.disable()},setCaption:function(e,t){modelsParameters[a].inheritLabelFromData&&(l.captionHelper(e,l.bIsInteractive,t),l.render())},clearCaption:function(){modelsParameters[a].inheritLabelFromData&&(modelsParameters[a].label=""),l.render()}},this.max={updateCallback:function(){},setValue:function(e){const t=Number(e);modelsParameters[a].max=t},getValue:function(){return modelsParameters[a].max},addValueChangedHandler:function(e){this.updateCallback=e,l.enable()},removeValueChangedHandler:function(e){l.disable()}},this.min={updateCallback:function(){},setValue:function(e){const t=Number(e);modelsParameters[a].min=t},getValue:function(){return modelsParameters[a].min},addValueChangedHandler:function(e){this.updateCallback=e,l.enable()},removeValueChangedHandler:function(e){l.disable()}},l.render()},this.verticalSliderFlatUiWidget.prototype=baseWidget.prototype,this.progressBarFlatUiWidget=function(e,t,a,i){this.constructor(e,t,a,i);var l=this;this.enable=function(){modelsParameters[a].displayValue&&$("#progress-bar-value"+t).prop("disabled",!1)},this.disable=function(){modelsParameters[a].displayValue&&$("#progress-bar-value"+t).prop("disabled",!0)},this.insertLabel=function(e){const t=this.getTransformedText("label"),i=document.createElement("span");i.setAttribute("class","label-progress-bar"),i.setAttribute("id","progress-bar-span"),_.isUndefined(modelsParameters[a].labelWidthProportion)?i.setAttribute("style","width: 20%; "+this.labelFontSize()+this.labelColor()+this.labelFontFamily()):i.setAttribute("style","width:"+modelsParameters[a].labelWidthProportion+"; "+this.labelFontSize()+this.labelColor()+this.labelFontFamily()),i.innerHTML=t,e.appendChild(i)},this.insertValue=function(i){var l;l=modelsParameters[a].displayLabel?Math.min($("#"+e).height(),$("#"+e).width()/6):Math.min($("#"+e).height(),$("#"+e).width()/8);var r=document.createElement("div");r.setAttribute("class","progress-bar-value-div"),r.setAttribute("id","div-for-progress-bar-value"+t),_.isUndefined(modelsParameters[a].valueWidthProportion)?r.setAttribute("style","width:30%;"):r.setAttribute("style","width:"+modelsParameters[a].valueWidthProportion+";");var o="";o=this.bIsInteractive?"cursor: text;":"cursor: inherit;";var n='<input id="progress-bar-value'+t+'" type="text" placeholder="" class="hslider-input form-control" style="height: '+l+"px; "+this.valueFontSize()+this.valueColor()+this.valueFontFamily()+o+'" disabled></input>';r.innerHTML=n,i.appendChild(r)},this.updateProgressBarWidth=function(){if(!_.isUndefined(modelsHiddenParams[a].value)){var e,i=modelsHiddenParams[a].value,l=$("#progress-bar"+t+" div"),r=modelsParameters[a].min,o=modelsParameters[a].max;e=i<=r?0:Math.ceil((i-r)/(o-r)*100),l.css("width",e+"%")}},this.updateProgressBarValue=function(){modelsParameters[a].displayValue&&(modelsParameters[a].min>modelsHiddenParams[a].value?$("#progress-bar-value"+t)[0].value=modelsParameters[a].min:$("#progress-bar-value"+t)[0].value=modelsHiddenParams[a].value)},this.rescale=function(){this.render()},this.render=function(){var i=document.createElement("div");i.setAttribute("class","progress-bar-widget");var r=document.createElement("div");r.setAttribute("id","progress-bar-div"),_.isUndefined(modelsParameters[a].progressBarWidthProportion)?r.setAttribute("style","width:50%;"):r.setAttribute("style","width:"+modelsParameters[a].progressBarWidthProportion+";");var o=document.createElement("div");o.setAttribute("id","progress-bar"+t),o.setAttribute("class","progress");var n=document.createElement("div");n.setAttribute("class","progress-bar"),n.setAttribute("role","progressbar"),o.appendChild(n),r.appendChild(o),modelsParameters[a].displayLabel&&this.insertLabel(i),i.appendChild(r),modelsParameters[a].displayValue&&this.insertValue(i),$("#"+e).html(i),$("#progress-bar"+t).addClass("progress-bar-div-div"),document.styleSheets[0].addRule("#progress-bar"+t,this.progressBarSegmentColor()),document.styleSheets[0].addRule("#progress-bar"+t+" > .progress-bar",this.progressBarRangeColor()),this.bIsInteractive?l.enable():l.disable(),this.updateProgressBarWidth(),this.updateProgressBarValue()};const r=new WidgetActuatorDescription("value","Current progress",WidgetActuatorDescription.READ,WidgetPrototypesManager.SCHEMA_NUMBER),o=new WidgetActuatorDescription("min","Base progress value",WidgetActuatorDescription.READ,WidgetPrototypesManager.SCHEMA_NUMBER),n=new WidgetActuatorDescription("max","Final progress value",WidgetActuatorDescription.READ,WidgetPrototypesManager.SCHEMA_NUMBER);this.getActuatorDescriptions=function(e=null){const t=e||modelsParameters[a],i=[r];return t&&t.rangeActuator&&(i.push(o),i.push(n)),i},this.value={updateCallback:function(){},setValue:function(e){modelsHiddenParams[a].value=e,modelsParameters[a].displayValue&&($("#progress-bar-value"+t)[0].value=e),l.render()},getValue:function(){return modelsHiddenParams[a].value},addValueChangedHandler:function(e){this.updateCallback=e,l.enable()},removeValueChangedHandler:function(e){l.disable()},setCaption:function(e,t){modelsParameters[a].inheritLabelFromData&&(l.captionHelper(e,l.bIsInteractive,t),l.render())},clearCaption:function(){modelsParameters[a].inheritLabelFromData&&(modelsParameters[a].label=""),l.render()}},this.max={updateCallback:function(){},setValue:function(e){const t=Number(e);modelsParameters[a].max=t,l.render()},getValue:function(){return modelsParameters[a].max},addValueChangedHandler:function(e){this.updateCallback=e,l.enable()},removeValueChangedHandler:function(e){l.disable()}},this.min={updateCallback:function(){},setValue:function(e){const t=Number(e);modelsParameters[a].min=t,l.render()},getValue:function(){return modelsParameters[a].min},addValueChangedHandler:function(e){this.updateCallback=e,l.enable()},removeValueChangedHandler:function(e){l.disable()}},l.render()},this.progressBarFlatUiWidget.prototype=baseWidget.prototype,this.valueFlatUiWidgetModel=function(e,t,a,i,l,r){const o=l;o.updateValue=function(e){const i=$("#"+r+t)[0].value;modelsHiddenParams[a].value=i,o.value.updateCallback(o.value,o.value.getValue()),e.preventDefault()},o.enable=function(){$("#"+r+t).prop("disabled",!1),modelsParameters[a].validationButton&&$("#"+r+"-valid-btn"+t).prop("disabled",!1),$("#"+r+t).on("keypress",(function(e,t){13==e.which&&o.updateValue(e)})),modelsParameters[a].validationOnFocusOut?$("#"+r+t).on("focusout",(function(e,t){o.updateValue(e)})):$("#"+r+t).on("focusout",(function(e,t){})),$("#"+r+"-valid-btn"+t).off("click").on("click",(function(e,t){o.updateValue(e)}))},o.disable=function(){modelsParameters[a].validationButton},o.rescale=function(){this.render()},o.render=function(){let i=Math.min($("#"+e).height(),$("#"+e).width()/2);const l=document.createElement("div");l.setAttribute("id",r+"-widget-html"+t),l.setAttribute("class","value-widget-html");let n="",s="left";if(modelsParameters[a].displayLabel){"left"==modelsParameters[a].labelTextPosition||"right"==modelsParameters[a].labelTextPosition?s="display: table-cell":"top"==modelsParameters[a].labelTextPosition?s="display: table-header-group":"bottom"==modelsParameters[a].labelTextPosition&&(s="display: table-footer-group");const l=this.getTransformedText("label");if(i=Math.min($("#"+e).height(),$("#"+e).width()/4),_.isUndefined(modelsParameters[a].valueWidthProportion))n='<span id ="'+r+"-span"+t+'" class="value-span" style="max-width: 45%;'+ +this.labelFontSize()+this.labelColor()+this.labelFontFamily()+this.valueFontSize()+" text-align:"+modelsParameters[a].labelTextAlign+";"+s+'">'+l+"</span>";else{const e=Math.max(0,100-parseFloat(modelsParameters[a].valueWidthProportion))+"%";n='<span id ="'+r+"-span"+t+'" class="value-span" style="width:'+e+"; "+this.labelFontSize()+this.labelColor()+this.labelFontFamily()+" text-align:"+modelsParameters[a].labelTextAlign+";"+s+'">'+l+"</span>"}}let d,u="disabled ";switch(u="",r){case"value":case"text-input":d=modelsParameters[a].isPassword?"password":"text";break;case"numeric-input":d="number";break;case"value-display":d="text"}let c="",m="";"value-display"===r&&(c="readonly ",m="opacity: 1; ");let p="",h="",v="";modelsParameters[a].validationButton?(p='<div class="input-group">',h="border-bottom-right-radius: 0; border-top-right-radius: 0; ",v='<span class="input-group-btn"><button id="'+r+"-valid-btn"+t+'" class="/*ui-value-button*/ btn btn-primary" type="button" style="height:'+i+"px; width:"+i+'px; "><span class="fa fa-check" style="color: #ffffff"/></button></span>'):(p='<div id="value-no-input-group">',h="float: right;");let b="left";_.isUndefined(modelsParameters[a].valueTextAlign)||(b=modelsParameters[a].valueTextAlign),inputContent="<input "+c+' id="'+r+t+'" type='+d+' placeholder="" class="value-input form-control" style="height: '+i+"px; "+m+this.valueColor()+this.backgroundColor()+this.valueFontFamily()+this.border()+this.valueFontSize()+h+" text-align:"+b+';"</input>',inputContent+=v,p+=inputContent,p+="</div>","right"==modelsParameters[a].labelTextPosition?n=p+n:n+=p,"text-input"!=r&&""!=modelsParameters[a].unit&&modelsParameters[a].displayUnit&&(n=n+'<span id ="unit-span'+t+'" class="value-span" style="max-width: 45%; font-size: calc(7px + '+modelsParameters[a].unitFontSize*getFontFactor()+'vw + 0.4vh);">'+modelsParameters[a].unit+"</span>"),l.innerHTML=n,"value-display"!==r&&(document.styleSheets[0].addRule("#"+r+"-valid-btn"+t,this.validationButtonBorderColor()),document.styleSheets[0].addRule("#"+r+"-valid-btn"+t,this.validationButtonDefaultColor()),document.styleSheets[0].addRule("#"+r+"-valid-btn"+t+":hover"," outline: none; "+this.validationButtonHoverColor()),document.styleSheets[0].addRule("#"+r+"-valid-btn"+t+":focus"," outline: none; "),document.styleSheets[0].addRule("#"+r+"-valid-btn"+t+":active",this.validationButtonActiveColor())),this.bIsInteractive?l.setAttribute("style","height: "+i+"px; cursor: auto;"):l.setAttribute("style","height: "+i+"px;"),$("#"+e).html(l),$("#"+r+t)[0].value=o.valueFormat(modelsHiddenParams[a].value),this.bIsInteractive?o.enable():o.disable()},o.value={updateCallback:function(){},setValue:function(e){modelsHiddenParams[a].value=e,$("#"+r+t)[0].value=o.valueFormat(e)},getValue:function(){switch(r){case"value":case"value-display":return modelsParameters[a].isNumber?Number(modelsHiddenParams[a].value):modelsHiddenParams[a].value;case"text-input":return modelsHiddenParams[a].value;case"numeric-input":return Number(modelsHiddenParams[a].value)}},addValueChangedHandler:function(e){this.updateCallback=e,o.enable()},removeValueChangedHandler:function(e){o.disable()},setCaption:function(e,i){modelsParameters[a].inheritLabelFromData&&(o.captionHelper(e,o.bIsInteractive,i),$("#"+r+"-span"+t).text(modelsParameters[a].label))},clearCaption:function(){modelsParameters[a].inheritLabelFromData&&(modelsParameters[a].label=""),o.render()}},o.render()},this.valueFlatUiWidget=function(t,a,i,l){this.constructor(t,a,i,l),e.valueFlatUiWidgetModel(t,a,i,l,this,"value");const r=new WidgetActuatorDescription("value","Current number",WidgetActuatorDescription.READ_WRITE,WidgetPrototypesManager.SCHEMA_NUMBER),o=new WidgetActuatorDescription("value","Current string",WidgetActuatorDescription.READ_WRITE,WidgetPrototypesManager.SCHEMA_STRING);this.getActuatorDescriptions=function(e=void 0){return[(e=e||modelsParameters[i])&&e.isNumber?r:o]}},this.valueFlatUiWidget.prototype=baseWidget.prototype,this.textInputFlatUiWidget=function(t,a,i,l){this.constructor(t,a,i,l),e.valueFlatUiWidgetModel(t,a,i,l,this,"text-input");const r=new WidgetActuatorDescription("value","Current string",WidgetActuatorDescription.READ_WRITE,WidgetPrototypesManager.SCHEMA_STRING);this.getActuatorDescriptions=()=>[r]},this.textInputFlatUiWidget.prototype=baseWidget.prototype,this.numericInputFlatUiWidget=function(t,a,i,l){this.constructor(t,a,i,l),e.valueFlatUiWidgetModel(t,a,i,l,this,"numeric-input");const r=new WidgetActuatorDescription("value","Current number",WidgetActuatorDescription.READ_WRITE,WidgetPrototypesManager.SCHEMA_NUMBER);this.getActuatorDescriptions=()=>[r]},this.numericInputFlatUiWidget.prototype=baseWidget.prototype,this.valueDisplayFlatUiWidget=function(t,a,i,l){this.constructor(t,a,i,l),e.valueFlatUiWidgetModel(t,a,i,l,this,"value-display");const r=new WidgetActuatorDescription("value","Displayed value",WidgetActuatorDescription.READ,WidgetPrototypesManager.SCHEMA_NUMBER_OR_STRING);this.getActuatorDescriptions=()=>[r]},this.valueDisplayFlatUiWidget.prototype=baseWidget.prototype,this.pluginDefinition={name:"flatUi",widgetsDefinitionList:{flatUiHorizontalSlider:{factory:"horizontalSliderFlatUiWidget",title:"Horizontal slider",icn:"horizontal-slider",help:"wdg-basics/#horizontal-slider"},flatUiVerticalSlider:{factory:"verticalSliderFlatUiWidget",title:"Vertical slider",icn:"vertical-slider",help:"wdg/wdg-basics/#vertical-slider"},flatUiProgressBar:{factory:"progressBarFlatUiWidget",title:"Progress bar",icn:"progress-bar",help:"wdg-basics/#progress-bar"},flatUiValue:{factory:"valueFlatUiWidget",title:"Value",icn:"value",help:"wdg/wdg-basics/#value"},flatUiTextInput:{factory:"textInputFlatUiWidget",title:"Text Input",icn:"text-input",help:"wdg/wdg-basics/#text-input"},flatUiNumericInput:{factory:"numericInputFlatUiWidget",title:"Numeric Input",icn:"numeric-input",help:"wdg/wdg-basics/#numeric-input"},flatUiValueDisplay:{factory:"valueDisplayFlatUiWidget",title:"Value Display",icn:"value",help:"wdg/wdg-basics/#value-display"},flatUiButton:{factory:"buttonFlatUiWidget",title:"Push button",icn:"button",help:"wdg/wdg-basics/#push-button"}}},this.constructor()}String.prototype.repeat=function(e){return new Array(Math.round(e)+1).join(this)},modelsHiddenParams.flatUiHorizontalSlider={value:0},modelsHiddenParams.flatUiVerticalSlider={value:0},modelsHiddenParams.flatUiProgressBar={value:0},modelsHiddenParams.flatUiValue={value:""},modelsHiddenParams.flatUiTextInput={value:""},modelsHiddenParams.flatUiNumericInput={value:""},modelsHiddenParams.flatUiValueDisplay={value:""},modelsParameters.flatUiHorizontalSlider={label:"labelText",inheritLabelFromData:!0,displayLabel:!0,labelFontSize:.5,labelColor:"var(--widget-label-color)",labelFontFamily:"var(--widget-font-family)",rangeActuator:!1,min:0,max:100,step:1,displayValue:!0,validationOnFocusOut:!0,valueFontSize:.5,valueFontFamily:"var(--widget-font-family)",valueBorderColor:"var(--widget-border-color)",labelWidthProportion:"20%",sliderWidthProportion:"60%",valueWidthProportion:"20%",sliderRangeColor:"var(--widget-range-color)",sliderSegmentColor:"var(--widget-segment-color)",sliderHandleDefaultColor:"var(--widget-handle-default-color)",sliderHandleHoverColor:"var(--widget-handle-hover-color)",sliderHandleActiveColor:"var(--widget-handle-active-color)",valueColor:"var(--widget-color)",unit:"unitText",displayUnit:!1,unitFontSize:.5},modelsParameters.flatUiVerticalSlider={label:"labelText",inheritLabelFromData:!0,displayLabel:!0,labelFontSize:.5,labelColor:"var(--widget-label-color)",labelFontFamily:"var(--widget-font-family)",rangeActuator:!1,min:0,max:100,step:1,sliderRangeColor:"var(--widget-range-color)",sliderSegmentColor:"var(--widget-segment-color)",sliderHandleDefaultColor:"var(--widget-handle-default-color)",sliderHandleHoverColor:"var(--widget-handle-hover-color)",sliderHandleActiveColor:"var(--widget-handle-active-color)"},modelsParameters.flatUiProgressBar={label:"labelText",inheritLabelFromData:!0,displayLabel:!0,labelFontSize:.5,labelColor:"var(--widget-label-color)",labelFontFamily:"var(--widget-font-family)",rangeActuator:!1,min:0,max:100,displayValue:!1,valueFontSize:.5,valueFontFamily:"var(--widget-font-family)",labelWidthProportion:"20%",progressBarWidthProportion:"60%",valueWidthProportion:"20%",progressBarRangeColor:"var(--widget-range-color)",progressBarSegmentColor:"var(--widget-segment-color)",valueColor:"var(--widget-color)"},modelsParameters.flatUiValue={label:"labelText",inheritLabelFromData:!0,displayLabel:!0,labelFontSize:.5,labelColor:"var(--widget-label-color)",labelFontFamily:"var(--widget-font-family)",labelTextAlign:"left",labelTextPosition:"left",valueWidthProportion:"70%",validationButton:!1,validationBtnDefaultColor:"var(--widget-button-primary-color)",validationBtnActiveColor:"var(--widget-button-active-color)",validationBtnHoverColor:"var(--widget-button-hover-color)",validationOnFocusOut:!0,isNumber:!1,isPassword:!1,decimalDigits:3,valueFontSize:.5,valueColor:"var(--widget-input-text)",valueFontFamily:"var(--widget-font-family)",valueTextAlign:"left",displayBorder:!0,borderColor:"var(--widget-border-color)",unit:"unitText",displayUnit:!1,unitFontSize:.5},modelsParameters.flatUiTextInput={label:"labelText",inheritLabelFromData:!0,displayLabel:!0,labelFontSize:.5,labelColor:"var(--widget-label-color)",labelFontFamily:"var(--widget-font-family)",labelTextAlign:"left",labelTextPosition:"left",valueWidthProportion:"70%",validationButton:!1,validationBtnDefaultColor:"var(--widget-button-primary-color)",validationBtnActiveColor:"var(--widget-button-active-color)",validationBtnHoverColor:"var(--widget-button-hover-color)",validationOnFocusOut:!0,isPassword:!1,valueFontSize:.5,valueColor:"var(--widget-input-text)",valueFontFamily:"var(--widget-font-family)",valueTextAlign:"left",displayBorder:!0,borderColor:"var(--widget-border-color)",backgroundColor:"var(--widget-input-color)"},modelsParameters.flatUiNumericInput={label:"labelText",inheritLabelFromData:!0,displayLabel:!0,labelFontSize:.5,labelColor:"var(--widget-label-color)",labelFontFamily:"var(--widget-font-family)",labelTextAlign:"left",labelTextPosition:"left",valueWidthProportion:"70%",validationButton:!1,validationBtnDefaultColor:"var(--widget-button-primary-color)",validationBtnActiveColor:"var(--widget-button-active-color)",validationBtnHoverColor:"var(--widget-button-hover-color)",validationOnFocusOut:!0,valueFontSize:.5,valueColor:"var(--widget-input-text)",valueFontFamily:"var(--widget-font-family)",valueTextAlign:"left",displayBorder:!0,borderColor:"var(--widget-border-color)",backgroundColor:"var(--widget-input-color)",unit:"unitText",displayUnit:!1,unitFontSize:.5},modelsParameters.flatUiValueDisplay={label:"labelText",inheritLabelFromData:!0,displayLabel:!0,labelFontSize:.5,labelColor:"var(--widget-label-color)",labelFontFamily:"var(--widget-font-family)",labelTextAlign:"left",valueWidthProportion:"70%",decimalDigits:3,valueFontSize:.5,valueColor:"var(--widget-input-text)",valueFontFamily:"var(--widget-font-family)",valueTextAlign:"left",displayBorder:!0,borderColor:"var(--widget-border-color)",backgroundColor:"var(--widget-input-color)",unit:"unitText",displayUnit:!1,unitFontSize:.5},modelsParameters.flatUiButton={text:"Push button",numberOfTriggers:1,fileInput:!1,binaryFileInput:!1,buttonFontSize:.3,displayIcon:!1,fontAwesomeIcon:"",buttonFontFamily:"var(--widget-font-family)",buttonTextColor:"var(--widget-button-primary-text)",buttonDefaultColor:"var(--widget-button-primary-color)",buttonActiveColor:"var(--widget-button-active-color)",buttonHoverColor:"var(--widget-button-hover-color)"},modelsLayout.flatUiHorizontalSlider={height:"5vh",width:"24vw",minWidth:"200px",minHeight:"24px"},modelsLayout.flatUiVerticalSlider={height:"20vh",width:"5vw",minWidth:"32px",minHeight:"50px"},modelsLayout.flatUiProgressBar={height:"5vh",width:"24vw",minWidth:"200px",minHeight:"24px"},modelsLayout.flatUiValue={height:"5vh",width:"19vw",minWidth:"150px",minHeight:"24px"},modelsLayout.flatUiTextInput={height:"5vh",width:"19vw",minWidth:"150px",minHeight:"24px"},modelsLayout.flatUiNumericInput={height:"5vh",width:"19vw",minWidth:"150px",minHeight:"24px"},modelsLayout.flatUiValueDisplay={height:"5vh",width:"19vw",minWidth:"150px",minHeight:"24px"},modelsLayout.flatUiButton={height:"6vh",width:"8vw",minWidth:"55px",minHeight:"24px"},flatUiWidgetsPluginClass.prototype=basePlugin.prototype;var flatUiWidgetsPlugin=new flatUiWidgetsPluginClass;widgetsPluginsHandler.loadWidgetPlugin(flatUiWidgetsPlugin);
function saveToFileButtonWidgetsPluginClass(){this.buttonSaveToFileWidget=function(t,e,i,o){this.constructor(t,e,i,o);var n=this;this.enable=function(){},this.disable=function(){},this.saveFile=function(){const t=modelsParameters[i].fileName;let e=modelsHiddenParams[i].value;if(!e)return;e="data:text/plain;charset=utf-8,"+e;const o=encodeURI(e),n=document.createElement("a");n.setAttribute("href",o),n.setAttribute("download",t),n.click()},this.rescale=function(){this.render()},this.render=function(){var o=document.createElement("div");o.setAttribute("id","button-save-to-file-widget-html"+e),o.setAttribute("class","button-widget-html");var a=Math.min($("#"+t).height(),$("#"+t).width()/2),l=.5;_.isUndefined(modelsParameters[i].buttonFontSize)||(l=modelsParameters[i].buttonFontSize);var s='style="text-align: center; vertical-align: middle;font-size: calc(7px + '+l*getFontFactor()+"vw + 0.4vh); height: "+a+"px; display:table-cell; "+this.buttonFontFamily()+'" class="btn btn-block btn-lg '+i+"widgetCustomColor";this.setButtonColorStyle();const r=this.getTransformedText("text");var u;u="<a "+s+'" id="button-save-to-file'+e+'">  '+r+"  </a>",o.innerHTML=u,o.setAttribute("style","height: "+a+"px;"),$("#"+t).html(o),$("#button-save-to-file"+e).on("click",(function(){n.saveFile()}))};const a=new WidgetActuatorDescription("value","File content",WidgetActuatorDescription.READ,WidgetPrototypesManager.SCHEMA_STRING);this.getActuatorDescriptions=function(){return[a]},this.value={updateCallback:function(){},setValue:function(t){modelsHiddenParams[i].value=t},getValue:function(){return modelsHiddenParams[i].value},addValueChangedHandler:function(t){this.updateCallback=t,n.enable()},removeValueChangedHandler:function(t){n.disable()}},n.render()},this.buttonSaveToFileWidget.prototype=baseWidget.prototype,this.pluginDefinition={name:"saveToFileButton",widgetsDefinitionList:{saveToFileButton:{factory:"buttonSaveToFileWidget",title:"Save to file button",icn:"export-to-file",help:"wdg/wdg-basics/#save-to-file-button"}}},this.constructor()}modelsHiddenParams.saveToFileButton={value:""},modelsParameters.saveToFileButton={text:"Save to file",fileName:"export.txt",buttonFontSize:.5,buttonFontFamily:"var(--widget-font-family)",buttonTextColor:"var(--widget-button-primary-text)",buttonDefaultColor:"var(--widget-button-primary-color)",buttonActiveColor:"var(--widget-button-active-color)",buttonHoverColor:"var(--widget-button-hover-color)"},modelsLayout.saveToFileButton={height:"5vh",width:"8vw",minWidth:"55px",minHeight:"50px"},saveToFileButtonWidgetsPluginClass.prototype=basePlugin.prototype;var saveToFileButtonWidgetsPlugin=new saveToFileButtonWidgetsPluginClass;widgetsPluginsHandler.loadWidgetPlugin(saveToFileButtonWidgetsPlugin);
function loadFileWidgetsPluginClass(){this.loadFileWidget=function(idDivContainer,idWidget,idInstance,bInteractive){this.constructor(idDivContainer,idWidget,idInstance,bInteractive);const self=this;function _getFileSize(e){return e<1024?`${e} bytes`:e<1048576?`${(e/1024).toFixed(1)} KB`:`${(e/1048576).toFixed(1)} MB`}function _getFileExtension(e){return e.split(".").pop()}function _processTextFile(fileExtension,fileData){const extensions=["json","xprjson"];return extensions.includes(fileExtension)?JSON.parse(JSON.stringify(eval("("+fileData+")")),null,2):fileData}function _processBinaryFile(e){return btoa([].reduce.call(new Uint8Array(e),((e,t)=>e+String.fromCharCode(t)),""))}function _checkFileSize(e){if(e>104857600)throw new Error("Unable to load file due to large size over 100MB")}function _handleFileError(e,t){const i=new PNotify({title:"Unzip file",text:"Error reading "+e.name+": "+t,type:"error",styling:"bootstrap3"});return $(".ui-pnotify-container").on("click",(()=>i.remove())),console.error("Error reading "+e.name+": "+t),-1}this.enable=function(){},this.disable=function(){},this.updateValue=function(e){},this.readFile=async function(e){try{_checkFileSize(e.size)}catch(t){return _handleFileError(e,t.message)}const t={type:e.type,size:_getFileSize(e.size),name:e.name,content:""},i=_getFileExtension(e.name),a=["txt","json","xprjson","xml","svg","html","css","js","ts","md","csv"],d=[];if(i&&["","application/json"].includes(t.type)&&(t.type=i),"zip"===i)try{const i=await JSZip.loadAsync(e);for(const e in i.files){const t=i.files[e];if(t.dir)continue;const n=_getFileExtension(e);if(!(t._data.uncompressedSize>73400320))if(n&&a.includes(n)){const i=await t.async("string");d.push({name:e,content:_processTextFile(n,i)})}else{const i=await t.async("uint8array");d.push({name:e,content:_processBinaryFile(i)})}}t.content=d,modelsHiddenParams[idInstance].outputFile=t,updateDataNodeFileFromWidget(idInstance,t)}catch(t){return _handleFileError(e,t)}else{const a=new FileReader;a.addEventListener("load",(function(e){const a=e.target.result;if(a instanceof ArrayBuffer)t.content=_processBinaryFile(a),t.isBinary=!0;else{const e=_processTextFile(i,a);t.content=e,t.isBinary=!1}modelsHiddenParams[idInstance].outputFile=t,updateDataNodeFileFromWidget(idInstance,t)})),modelsParameters[idInstance].binaryFileInput?a.readAsArrayBuffer(e):a.readAsText(e)}},this.rescale=function(){this.render()},this.render=function(){const e=document.createElement("div");e.setAttribute("id","load-file-widget-html"+idWidget),_.isUndefined(modelsParameters[idInstance].displayBrowseButton)&&(modelsParameters[idInstance].displayBrowseButton=!0),modelsParameters[idInstance].displayBorder?e.setAttribute("class","load-file-widget-html load-file-widget-html--border"):e.setAttribute("class","load-file-widget-html");let t="";if(modelsParameters[idInstance].displayLabel){const e=this.getTransformedText("label");t+='<div id="load-file-label'+idWidget+'" class="label-wrapper" style="'+this.labelFontSize()+this.labelColor()+this.labelFontFamily()+" text-align: "+modelsParameters[idInstance].labelAlign+'">',t+="<p>"+e+"</p>",t+="</div>"}if(t+='<div id="drag-area'+idWidget+'" class="drag-area">',t+='<div id="drag-area-icon'+idWidget+'" class="drag-area__icon-wrapper">',t+='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor">\n          <path d="M28.992 21.44c-0.704-0.512-1.536-0.768-2.176-0.896v-10.752c0-0.192-0.064-0.32-0.192-0.448l-8.512-8.448c-0.128-0.128-0.256-0.192-0.448-0.192h-11.84c-0.32 0-0.64 0.256-0.64 0.64v29.312c0 0.32 0.256 0.576 0.64 0.576h20.352c0.32 0 0.64-0.256 0.64-0.576v-2.624h0.704c0.512 0 1.344-0.192 1.984-0.768 0.704-0.576 1.152-1.472 1.152-2.88-0.064-1.344-0.768-2.368-1.664-2.944zM24.704 9.088h-6.912v-6.912l6.912 6.912zM25.664 30.208h-19.392v-28.352h10.432v7.68c0 0.32 0.256 0.576 0.64 0.576h8.32v7.872c-0.064-0.064-0.064-0.128-0.128-0.192-0.896-1.28-2.432-2.368-4.992-2.368-3.712 0-5.44 2.048-6.016 3.456-2.624 0.192-4.864 1.92-4.864 4.352s1.792 4.736 4.8 4.736h11.2v2.24zM28.736 26.496c-0.448 0.384-0.96 0.512-1.28 0.512h-12.928c-2.368 0-3.712-1.792-3.712-3.712 0-1.728 1.792-3.264 4.16-3.264 0.256 0 0.512-0.192 0.576-0.448 0.256-0.96 1.6-3.008 5.056-3.008 2.112 0 3.392 0.896 4.096 1.92 0.768 1.024 0.96 2.176 0.96 2.496 0 0.064 0 0.128 0.064 0.192 0.064 0.192 0.256 0.384 0.512 0.384 0.192 0 0.384 0.064 0.576 0.128 0.512 0.128 1.088 0.32 1.6 0.64 0.704 0.448 1.152 1.152 1.152 2.112-0.064 1.088-0.384 1.728-0.832 2.048z"></path>\n          <path d="M20.992 19.712c-0.192-0.192-0.576-0.192-0.768 0l-2.048 2.048c-0.192 0.192-0.192 0.576 0 0.768s0.576 0.192 0.768 0l1.088-1.088v3.648c0 0.32 0.256 0.576 0.576 0.576s0.512-0.256 0.512-0.576v-3.648l1.088 1.088c0.192 0.192 0.576 0.192 0.768 0s0.192-0.576 0-0.768l-1.984-2.048z"></path>\n        </svg>',t+="</div>",t+='<div id="drag-area-text'+idWidget+'" class="drag-area__text-wrapper">',t+='<span style="'+this.labelFontFamily()+this.textSize()+this.textColor()+'">Drag & drop file here</span>',t+='<span style="'+this.labelFontFamily()+this.textSize()+this.subTextColor()+'">Limit 100MB per file</span>',t+="</div>",modelsParameters[idInstance].displayBrowseButton&&(t+='<div id="browse-btn'+idWidget+'" class="drag-area__browse-btn-wrapper">',t+='<input type="file" name="file" id="browse-btn-input'+idWidget+'_select_file" />',t+='<label id="browse-btn-label'+idWidget+'" style="'+this.labelFontFamily()+this.textSize()+this.browseButtonTextColor()+'" for="browse-btn-input'+idWidget+'_select_file">Browse files</label>',t+="</div>",t+="</div>"),e.innerHTML=t,$("#"+idDivContainer).html(e),document.styleSheets[0].addRule("#drag-area"+idWidget," background-color: "+modelsParameters[idInstance].backgroundColor),document.styleSheets[0].addRule("#load-file-widget-html"+idWidget," border-color: "+modelsParameters[idInstance].borderColor),document.styleSheets[0].addRule("#load-file-widget-html"+idWidget," background-color: "+modelsParameters[idInstance].labelBackgroundColor),document.styleSheets[0].addRule("#browse-btn-label"+idWidget,this.browseButtonDefaultColor()),document.styleSheets[0].addRule("#browse-btn-label"+idWidget+":hover",this.browseButtonHoverColor()),document.styleSheets[0].addRule("#browse-btn-label"+idWidget+":active",this.browseButtonActiveColor()),this.addFileDiv=function(e,t){let i='<div id="loaded-file'+idWidget+'" class="loaded-file">';i+='<div class="loaded-file__icon-wrapper">',i+='<i class="fa fa-file" aria-hidden="true"></i>',i+="</div>",i+='<div class="loaded-file__info-file-wrapper">',i+='<span id="file-name-'+idWidget+'" title="'+e+'" class="loaded-file__info-file-wrapper__name" style="'+this.labelFontFamily()+this.textSize()+this.textColor()+'">'+e+"</span>",i+='<span id="file-size-'+idWidget+'" title="'+t+'" class="loaded-file__info-file-wrapper__size" style="'+this.labelFontFamily()+this.textSize()+this.subTextColor()+'">'+t+"</span>",i+="</div>",i+='<div id="close-file-btn'+idWidget+'" class="loaded-file__close-btn-wrapper">',i+='<i class="fa fa-times" aria-hidden="true"></i>',i+="</div>",i+="</div>",$("#load-file-widget-html"+idWidget).append(i),document.styleSheets[0].addRule("#close-file-btn"+idWidget+" > i",this.deleteButtonDefaultColor()),document.styleSheets[0].addRule("#close-file-btn"+idWidget+" > i:hover",this.deleteButtonHoverColor()),document.styleSheets[0].addRule("#close-file-btn"+idWidget+" > i:active",this.deleteButtonActiveColor()),document.styleSheets[0].addRule("#close-file-btn"+idWidget+" > i","color: "+modelsParameters[idInstance].deleteButtonIconColor),document.styleSheets[0].addRule("#close-file-btn"+idWidget+" > i:hover","color: "+modelsParameters[idInstance].deleteButtonIconHoverColor),$("#close-file-btn"+idWidget).on("click",(function(){$("#browse-btn-input"+idWidget+"_select_file").val(""),$("#loaded-file"+idWidget).remove(),delete modelsTempParams[idInstance].fileName,delete modelsTempParams[idInstance].fileSize,modelsHiddenParams[idInstance].outputFile={},updateDataNodeFileFromWidget(idInstance,{}),self.render()}))},_.isUndefined(modelsHiddenParams[idInstance].outputFile)||(_.isEmpty(modelsHiddenParams[idInstance].outputFile)?(updateDataNodeFileFromWidget(idInstance,{}),delete modelsTempParams[idInstance].fileName,delete modelsTempParams[idInstance].fileSize):updateDataNodeFileFromWidget(idInstance,modelsHiddenParams[idInstance].outputFile)),!_.isUndefined(modelsTempParams[idInstance].fileName)&&!_.isUndefined(modelsTempParams[idInstance].fileSize)){const e=modelsTempParams[idInstance].fileName,t=modelsTempParams[idInstance].fileSize;self.addFileDiv(e,t)}this.addSpinner=function(){const e=document.getElementById("load-file-widget-html"+idWidget),t=document.createElement("div"),i=document.createElement("i");t.setAttribute("id","icon-wrapper"+idWidget),t.setAttribute("class","load-spinner-wrapper"),i.setAttribute("class","fa fa-spinner fa-spin load-spinner-wrapper__icon"),t.append(i),e.append(t)},this.removeSpinner=function(){document.getElementById("icon-wrapper"+idWidget).remove()},this.readFileEvent=async function(e){this.addSpinner();let t={};"change"==e.type?t=e.target.files[0]:"drop"==e.type&&(t=e.originalEvent.dataTransfer.files[0]);if(-1!=await self.readFile(t)){const e=t.name,i=_getFileSize(t.size);modelsTempParams[idInstance].fileName=e,modelsTempParams[idInstance].fileSize=i,$("#loaded-file"+idWidget).length?($("#file-name-"+idWidget).text(e),$("#file-size-"+idWidget).text(i)):self.addFileDiv(e,i)}this.removeSpinner()},this.displayFile=(modelsTempParams[idInstance].counter=0,$("#drag-area"+idWidget).on("dragenter",(function(e){e.preventDefault(),e.stopPropagation(),modelsTempParams[idInstance].counter++,$("#drag-area"+idWidget).css({opacity:".5"})})),$("#drag-area"+idWidget).on("dragover",(function(e){e.preventDefault(),e.stopPropagation()})),$("#drag-area"+idWidget).on("dragleave",(function(e){e.preventDefault(),e.stopPropagation(),modelsTempParams[idInstance].counter--,0===modelsTempParams[idInstance].counter&&$("#drag-area"+idWidget).css({opacity:""})})),$("#drag-area"+idWidget).on("drop",(function(e){$("#drag-area"+idWidget).css({opacity:""}),e.originalEvent.dataTransfer&&e.originalEvent.dataTransfer.files.length&&(e.preventDefault(),e.stopPropagation(),self.readFileEvent(e))})),void $("#browse-btn-input"+idWidget+"_select_file").on("change",(function(e){self.readFileEvent(e)})));const i=document.getElementById(idDivContainer),a=i.clientWidth,d=a<290,n=a<240,l=document.getElementById("drag-area"+idWidget),o=document.getElementById("drag-area-text"+idWidget),s=document.getElementById("drag-area-icon"+idWidget);if(this.updateWidgetContent=function(){d?document.styleSheets[0].addRule(`#loaded-file${idWidget} .loaded-file__icon-wrapper`,"display: none"):document.styleSheets[0].addRule(`#loaded-file${idWidget} .loaded-file__icon-wrapper`,"display: block"),s.classList.toggle("drag-area__icon-wrapper--hidden",d),l.classList.toggle("drag-area--column",n),o.children[0].textContent=n?"Drag & Drop":"Drag & drop file here",o.children[1].classList.toggle("drag-area__text-wrapper__span--hidden",n)},bInteractive)this.updateWidgetContent();else{new ResizeObserver((()=>{this.updateWidgetContent()})).observe(i)}};const _OUTPUT_DESCRIPTOR=new WidgetActuatorDescription("outputFile","File content",WidgetActuatorDescription.FILE);this.getActuatorDescriptions=function(){return[_OUTPUT_DESCRIPTOR]},this.outputFile={updateCallback:function(){},setValue:function(e){},getValue:function(){return modelsHiddenParams[idInstance].outputFile},addValueChangedHandler:function(e){this.updateCallback=e,self.enable()},removeValueChangedHandler:function(e){self.disable()},setCaption:function(e,t){},clearCaption:function(){}},self.render()},this.loadFileWidget.prototype=baseWidget.prototype,this.pluginDefinition={name:"loadFile",widgetsDefinitionList:{loadFile:{factory:"loadFileWidget",title:"Load file",icn:"load-file",help:"wdg/wdg-basics/#load-file"}}},this.constructor()}modelsHiddenParams.loadFile={outputFile:""},modelsParameters.loadFile={label:"Choose a file",displayLabel:!0,labelFontSize:.1,labelColor:"var(--widget-label-color)",labelFontFamily:"var(--widget-font-family)",labelAlign:"left",textColor:"var(--widget-color)",subTextColor:"var(--widget-color)",textSize:.1,binaryFileInput:!1,displayBorder:!0,borderColor:"var(--widget-border-color)",backgroundColor:"var(--widget-dropzone-background-color)",displayBrowseButton:!0,labelBackgroundColor:"var(--widget-dropzone-label-background-color)",browseButtonTextColor:"var(--widget-button-text)",browseButtonDefaultColor:"var(--widget-button-color)",browseButtonActiveColor:"var(--widget-button-active-color)",browseButtonHoverColor:"var(--widget-button-hover-color)",deleteButtonDefaultColor:"var(--widget-delete-button-default-color)",deleteButtonActiveColor:"var(--widget-delete-button-active-color)",deleteButtonHoverColor:"var(--widget-delete-button-hover-color)",deleteButtonIconColor:"var(--widget-delete-button-icon-color)",deleteButtonIconHoverColor:"var(--widget-delete-button-icon-hover-color)"},modelsLayout.loadFile={height:"15vh",width:"20vw",minWidth:"95px",minHeight:"70px"},loadFileWidgetsPluginClass.prototype=basePlugin.prototype;var loadFileWidgetsPlugin=new loadFileWidgetsPluginClass;widgetsPluginsHandler.loadWidgetPlugin(loadFileWidgetsPlugin);
function spinnerStatusWidgetsPluginClass(){this.spinnerStatusWidget=function(t,e,n,i){this.constructor(t,e,n,i);const s=this;this.enable=function(){},this.disable=function(){},this.addSpinner=function(){const t=document.getElementById("spinner-status-widget-html"+e);if(t.hasChildNodes())return;const i=document.createElement("div"),r=document.createElement("i");i.setAttribute("id","icon-wrapper"+e),i.setAttribute("class","spinner-wrapper"),r.setAttribute("class","fa fa-spinner fa-spin"),i.style.backgroundColor=modelsParameters[n].backgroundColor,i.style.color=modelsParameters[n].color,r.style.cssText=s.fontSize(),i.append(r),t.append(i)},this.removeSpinner=function(){const t=document.getElementById("icon-wrapper"+e);t?.remove()},this.render=function(){const n=document.createElement("div");n.setAttribute("id","spinner-status-widget-html"+e),n.setAttribute("class","spinner-status-widget-html"),$("#"+t).html(n),i||s.addSpinner()};const r=new WidgetActuatorDescription("trigger","Node to listen",WidgetActuatorDescription.TRIGGER,WidgetPrototypesManager.SCHEMA_ANYTHING);this.getActuatorDescriptions=function(){return[r]},this.trigger={updateCallback:function(){},setValue:function(t){const e=widgetConnector.widgetsConnection[n].sliders.trigger.dataNode;datanodesManager.getDataNodeByName(e).status.subscribe((t=>{"Pending"==t?(s.render(),s.addSpinner()):s.removeSpinner()}))},getValue:function(){},updateCallback:function(){},addValueChangedHandler:function(t){this.updateCallback=t,s.enable()},removeValueChangedHandler:function(t){s.disable()},setCaption:function(t,e){},clearCaption:function(){}},s.render()},this.spinnerStatusWidget.prototype=baseWidget.prototype,this.pluginDefinition={name:"spinnerStatus",widgetsDefinitionList:{spinnerStatus:{factory:"spinnerStatusWidget",title:"Spinner status",icn:"status",help:"wdg/wdg-basics/#spinner-status"}}},this.constructor()}modelsParameters.spinnerStatus={fontsize:1,color:"var(--widget-color)",backgroundColor:"var(--disabled-color-opacity)"},modelsLayout.spinnerStatus={height:"15vh",width:"10vw",minWidth:"60px",minHeight:"60px"},spinnerStatusWidgetsPluginClass.prototype=basePlugin.prototype;const spinnerStatusWidgetsPlugin=new spinnerStatusWidgetsPluginClass;widgetsPluginsHandler.loadWidgetPlugin(spinnerStatusWidgetsPlugin);
const USE_PLOTLY_VALIDATION=!0,colorway=["var(--widget-color-2)","var(--widget-color-5)","var(--widget-color-6)","var(--widget-color-7)"],textColor="var(--widget-color)",axisParams={title:"",tickfont:{color:textColor}},plotlyColorParams={paper_bgcolor:"rgba(0,0,0,0)",plot_bgcolor:"rgba(0,0,0,0)",colorway:colorway,legend:{font:{color:textColor}}},_SCHEMA_PLOTLY_DATA={$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:plotly_data",type:"array",items:{type:"object",properties:{type:{type:"string"}},required:["type"]}},_SCHEMA_PLOTLY_LAYOUT={$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:plotly_layout",type:"object"};modelsParameters.plotlyLine={numberOfAxis:1,layout:{title:"",xaxis:{title:"x",tickfont:{color:textColor}},yaxis:{title:"y",tickfont:{color:textColor}},paper_bgcolor:"rgba(0,0,0,0)",plot_bgcolor:"rgba(0,0,0,0)",colorway:colorway,legend:{font:{color:textColor}},showlegend:!1,margin:{l:50,r:50,b:100,t:100,pad:4}},hideModeBar:!1},modelsParameters.plotlyBar={numberOfAxis:1,layout:{title:"",barmode:"group",xaxis:{title:"x",tickfont:{color:textColor}},yaxis:{title:"y",tickfont:{color:textColor}},paper_bgcolor:"rgba(0,0,0,0)",plot_bgcolor:"rgba(0,0,0,0)",colorway:colorway,legend:{font:{color:textColor}},showlegend:!1,margin:{l:50,r:50,b:100,t:100,pad:4}},hideModeBar:!1},modelsParameters.plotlyPie={layout:{title:"",paper_bgcolor:"rgba(0,0,0,0)",plot_bgcolor:"rgba(0,0,0,0)",colorway:colorway,legend:{font:{color:textColor}},showlegend:!1,margin:{l:50,r:50,b:100,t:100,pad:4}},hideModeBar:!1},modelsParameters.plotly3dSurface={layout:{title:"",scene:{xaxis:{title:"x"},yaxis:{title:"y"},zaxis:{title:"z"}},paper_bgcolor:"rgba(0,0,0,0)",plot_bgcolor:"rgba(0,0,0,0)",showlegend:!1,margin:{l:50,r:50,b:100,t:100,pad:4}},hideModeBar:!1},modelsParameters.plotlyGeneric={hideModeBar:!1},modelsParameters.plotlyRealTime={hideModeBar:!1},modelsHiddenParams.plotlyLine={...modelsParameters.plotlyLine,data:[{type:"scatter",x:[0,1,2],y:[0,4,0],name:"trace 0"}],selection:[{}]},modelsHiddenParams.plotlyBar={...modelsParameters.plotlyBar,data:[{type:"bar",x:["first","second"],y:[1,2]}],selection:[{}]},modelsHiddenParams.plotlyPie={...modelsParameters.plotlyPie,data:[{type:"pie",labels:["half1","half2"],values:[.5,.5],sort:!1}],selection:[{}]},modelsHiddenParams.plotly3dSurface={...modelsParameters.plotly3dSurface,data:[{type:"surface",x:[1,2,3],y:[1,2,3],z:[[4,5,6],[16,19,20],[10,18,23]]}],selection:[{}]},modelsHiddenParams.plotlyRealTime={...modelsParameters.plotlyRealTime,data:[{y:[],mode:"lines"}],selection:[{}]},modelsHiddenParams.plotlyGeneric={data:[{}],layout:[{}],selection:[{}]},modelsTempParams.plotlyLine={lastEditTimeStamp:0,pngCache:""},modelsTempParams.plotlyBar={lastEditTimeStamp:0,pngCache:""},modelsTempParams.plotlyPie={lastEditTimeStamp:0,pngCache:""},modelsTempParams.plotly3dSurface={lastEditTimeStamp:0,pngCache:""},modelsTempParams.plotlyGeneric={lastEditTimeStamp:0,pngCache:""},modelsTempParams.plotlyRealTime={lastEditTimeStamp:0,pngCache:""},modelsLayout.plotlyLine={height:"30vh",width:"30vw",minWidth:"100px",minHeight:"100px"},modelsLayout.plotlyBar={height:"30vh",width:"30vw",minWidth:"100px",minHeight:"100px"},modelsLayout.plotlyPie={height:"30vh",width:"30vw",minWidth:"100px",minHeight:"100px"},modelsLayout.plotly3dSurface={height:"30vh",width:"30vw",minWidth:"378px",minHeight:"305px"},modelsLayout.plotlyGeneric={height:"30vh",width:"30vw",minWidth:"50px",minHeight:"32px"},modelsLayout.plotlyRealTime={height:"30vh",width:"30vw",minWidth:"100px",minHeight:"100px"};const _SCHEMA_PLOTLY_NUMERIC_DATA={$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:plotly_numeric_data",anyOf:[{type:"number"},{type:"array",items:{type:"number"}}]},_SCHEMA_PLOTLY_ANY_DATA={$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:plotly_any_data",anyOf:[{type:"string"},{type:"number"},{type:"boolean"},{type:"array",items:{anyOf:[{type:"string"},{type:"number"},{type:"boolean"}]}}]};function _createPlotlyAnyDataDescriptor(e){return new WidgetActuatorDescription(e,"Array of values to plot",WidgetActuatorDescription.READ,_SCHEMA_PLOTLY_ANY_DATA)}function _createPlotlyNumericDataDescriptor(e){return new WidgetActuatorDescription(e,"Array of numeric values to plot",WidgetActuatorDescription.READ,_SCHEMA_PLOTLY_NUMERIC_DATA)}function _isAxisLinear(e,t){return e&&e[t]&&"linear"===e[t].type}function plotlyWidgetsPluginClass(){var e=0;function t(e,t,a,o){this.bIsInteractive=o;var i="plotly"+t;o&&(i+="c");var r=this;_.isUndefined(modelsParameters[a].hideModeBar)&&(modelsParameters[a].hideModeBar=!1),this.getColorValueFromCSSProperty=function(e){var t=e;if(t.includes("var(--")){var a=e.substring(4,e.length-1);t=window.getComputedStyle(document.documentElement).getPropertyValue(a)}return t},this.checkNested=function(e,t,...a){return void 0!==e&&(!(0!=a.length||!e.hasOwnProperty(t))||this.checkNested(e[t],...a))},this.getTransformedText=function(e){if(e){if(!($("<div>").html(e).children().length>0)){e=(new DOMParser).parseFromString("<!doctype html><body>"+e,"text/html").body.textContent}}return e},this.render=function(){const t=modelsParameters[a].layout;if(_.isUndefined(t)||_.isUndefined(t.title)||(_.isUndefined(t.title.text)?t.title=this.getTransformedText(t.title):t.title.text=this.getTransformedText(t.title.text)),modelsHiddenParams[a].layout){let e=JSON.parse(JSON.stringify(modelsHiddenParams[a].layout));modelsHiddenParams[a].layout=e,modelsParameters[a].layout&&(e=JSON.parse(JSON.stringify(modelsParameters[a].layout))),this.checkNested(e,"colorway")&&(modelsHiddenParams[a].layout.colorway=e.colorway.map((e=>this.getColorValueFromCSSProperty(e)))),["xaxis","yaxis","zaxis"].forEach((t=>{this.checkNested(e,t,"tickfont","color")&&(modelsHiddenParams[a].layout[t].tickfont.color=this.getColorValueFromCSSProperty(e[t].tickfont.color))})),this.checkNested(e,"legend","font","color")&&(modelsHiddenParams[a].layout.legend.font.color=this.getColorValueFromCSSProperty(e.legend.font.color)),this.checkNested(e,"paper_bgcolor")&&(modelsHiddenParams[a].layout.paper_bgcolor=this.getColorValueFromCSSProperty(e.paper_bgcolor)),this.checkNested(e,"plot_bgcolor")&&(modelsHiddenParams[a].layout.plot_bgcolor=this.getColorValueFromCSSProperty(e.plot_bgcolor))}if(this.bIsInteractive){$("#"+i).html(""),_.isUndefined(modelsHiddenParams[a].layout)||_.isNull(modelsHiddenParams[a].layout)||modelsHiddenParams[a].layout.autosize&&(delete modelsHiddenParams[a].layout.width,delete modelsHiddenParams[a].layout.height);var o={};modelsParameters[a].hideModeBar&&(o={displayModeBar:!1}),Plotly.newPlot(i,modelsHiddenParams[a].data,modelsHiddenParams[a].layout,o),this.setSelectionActuator()}else{$("#"+i).html(""),$("#"+i).html('<img id="png-export-'+i+'"></img>');var r,l=$("#png-export-"+i);const t=6e3;if(Date.now()-modelsTempParams[a].lastEditTimeStamp<t){l.attr("src",modelsTempParams[a].pngCache);var s=document.getElementById(e);return l[0].style.minHeight=parseInt(s.parentNode.style.minHeight)-3+"px",l[0].style.minWidth=parseInt(s.parentNode.style.minWidth)-3+"px",l[0].style.width=parseFloat(s.parentNode.style.width)-1+"vw",l[0].style.height=parseFloat(s.parentNode.style.height)-1+"vh",void(l[0].style.margin="3px")}Plotly.newPlot(i,modelsHiddenParams[a].data,modelsHiddenParams[a].layout).then((function(t){Plotly.toImage(t,{height:$("#"+e).height(),width:$("#"+e).width()}).then((function(e){r=e,Plotly.purge(t),l.attr("src",r),t.style.minHeight=t.parentNode.style.minHeight,t.style.minWidth=t.parentNode.style.minWidth,t.style.width=t.parentNode.style.width,t.style.height=t.parentNode.style.height,l[0].style.minHeight=parseInt(t.parentNode.style.minHeight)-3+"px",l[0].style.minWidth=parseInt(t.parentNode.style.minWidth)-3+"px",l[0].style.width=parseFloat(t.parentNode.style.width)-1+"vw",l[0].style.height=parseFloat(t.parentNode.style.height)-1+"vh",l[0].style.margin="3px",modelsTempParams[a].lastEditTimeStamp=Date.now(),modelsTempParams[a].pngCache=r}))}))}},this.setSelectionActuator=function(){this.bIsInteractive=o;var e="plotly"+t;if(o){e+="c";var a=document.getElementById(e);a.on("plotly_selected",(function(e){if(!_.isUndefined(e)){var t=Array(a.data.length).fill(null).map((()=>[])),o=Array(a.data.length).fill(null).map((()=>[]));e.points.forEach((function(e){if(!_.isUndefined(e.pointNumber)){var i=e.curveNumber,r=e.pointNumber;t[i].push(r),_.isUndefined(a.data[i].customdata)||o[i].push(a.data[i].customdata[r])}if(!_.isUndefined(e.pointNumbers)){i=e.pointNumbers.curveNumber;pointNumbers.forEach((function(e){t[i].push(e),_.isUndefined(a.data[i].customdata)||o[i].push(a.data[i].customdata[e])}))}}));var i=t.map((function(e,t){return{trace:t,selection:e,customdata:o[t]}}));r.selection.setValue(i),r.selection.updateCallback(r.selection,r.selection.getValue())}})),a.on("plotly_deselect",(function(){r.selection.setValue({range:{}}),r.selection.updateCallback(r.selection,r.selection.getValue())}))}},r.render(),this.getByName=function(e){if(this.hasOwnProperty(e))return this[e]},this.getInteractive=function(){return this.bIsInteractive},this.setInteractive=function(e){e!=this.bIsInteractive&&(this.bIsInteractive=e,this.render())},this.rescale=function(){this.bIsInteractive?Plotly.Plots.resize($("#"+i)[0]):this.render()}}this.createWidget=function(t,a,o,i){switch(function(e,t,a){var o=document.createElement("div"),i="plotly"+t;a&&(i+="c"),o.setAttribute("id",i),o.setAttribute("class","js-plotly-plot"),o.setAttribute("style","text-align:center; height: inherit; width: inherit; background-color: transparent"),$("#"+e).html(o)}(t,e+=1,i),a){case"plotlyLine":return new this.linePlotlyWidget(t,e,o,i);case"plotlyBar":return new this.barPlotlyWidget(t,e,o,i);case"plotlyPie":return new this.piePlotlyWidget(t,e,o,i);case"plotly3dSurface":return new this.d3surfacePlotlyWidget(t,e,o,i);case"plotlyGeneric":return new this.genericPlotlyWidget(t,e,o,i);case"plotlyRealTime":return new this.realTimePlotlyWidget(t,e,o,i)}},this.copyWidget=function(e,t,a,o,i){return this.createWidget(e,t,o,i)},this.clear=function(){e=0},this.linePlotlyWidget=function(e,t,a,o){this.constructor(e,t,a,o);var i=this;this.numberOfAxis=modelsParameters[a].numberOfAxis,_.isUndefined(modelsParameters[a].layout)||(modelsParameters[a].layout={...plotlyColorParams,...modelsParameters[a].layout},["xaxis","yaxis"].forEach((e=>{_.isUndefined(modelsParameters[a].layout[e])||(modelsParameters[a].layout[e]={...axisParams,...modelsParameters[a].layout[e]})}))),modelsHiddenParams[a].data.length>this.numberOfAxis&&modelsHiddenParams[a].data.splice(this.numberOfAxis,modelsHiddenParams[a].data.length),this.getActuatorDescriptions=function(e=null){const t=e||modelsParameters[a],o=[t&&_isAxisLinear(t.layout,"xaxis")?_createPlotlyNumericDataDescriptor("x"):_createPlotlyAnyDataDescriptor("x")];if(t&&t.numberOfAxis){const e=_isAxisLinear(t.layout,"yaxis");for(let a=1;a<=t.numberOfAxis;a++){const t="y"+a;o.push(e?_createPlotlyNumericDataDescriptor(t):_createPlotlyAnyDataDescriptor(t))}}return o},this.x={setValue:function(e){if(_.isUndefined(e))swal("Invalid data value","value in x axis is undefined !","error");else{if(!Array.isArray(e)){if("number"!=typeof e&&"string"!=typeof e&&"bigint"!=typeof e)return void swal("Invalid data type","x axis must be an array !","error");e=[e],console.log("value in x axis is converted to an array.")}modelsHiddenParams[a].data[0].x=e,modelsHiddenParams[a].layout=modelsParameters[a].layout,i.render()}},getValue:function(){return modelsHiddenParams[a].data[0].x},addValueChangedHandler:function(e){},removeValueChangedHandler:function(e){},setCaption:function(e,t){modelsParameters[a].layout.xaxis.title=e,modelsHiddenParams[a].layout=modelsParameters[a].layout}};for(let e=1;e<=this.numberOfAxis;e++){const t="y"+e;e>1&&_.isUndefined(modelsHiddenParams[a].data[e-1])&&(modelsHiddenParams[a].data[e-1]={x:[],y:[],name:"caption "+(e-1)}),this[t]={index:e-1,setValue:function(e){const t=this.index+1;if(_.isUndefined(e))swal("Invalid data value","value in y"+t+" axis is undefined !","error");else{if(!Array.isArray(e)){if("number"!=typeof e&&"string"!=typeof e&&"bigint"!=typeof e)return void swal("Invalid data type","y"+t+" axis must be an array !","error");e=[e],console.log("value in y"+t+" axis is converted to an array.")}modelsHiddenParams[a].data[this.index].y=e,modelsHiddenParams[a].data[this.index].x=modelsHiddenParams[a].data[0].x,modelsHiddenParams[a].layout=modelsParameters[a].layout,i.render()}},getValue:function(){return modelsHiddenParams[a].data[this.index].y},addValueChangedHandler:function(e){},removeValueChangedHandler:function(e){},setCaption:function(e,t){1==modelsParameters[a].numberOfAxis?(modelsParameters[a].layout.yaxis.title=e,modelsHiddenParams[a].layout=modelsParameters[a].layout):(modelsHiddenParams[a].data[this.index].name=e,modelsParameters[a].layout.yaxis.title="",modelsHiddenParams[a].layout=modelsParameters[a].layout)}}}},this.linePlotlyWidget.prototype=t.prototype,this.barPlotlyWidget=function(e,t,a,o){this.constructor(e,t,a,o);const i=this;this.numberOfAxis=modelsParameters[a].numberOfAxis,_.isUndefined(modelsParameters[a].layout)||(modelsParameters[a].layout={...plotlyColorParams,...modelsParameters[a].layout},["xaxis","yaxis"].forEach((e=>{_.isUndefined(modelsParameters[a].layout[e])||(modelsParameters[a].layout[e]={...axisParams,...modelsParameters[a].layout[e]})}))),this.getActuatorDescriptions=function(e=null){const t=e||modelsParameters[a],o=[];if(t&&t.numberOfAxis){const e=_isAxisLinear(t.layout,"xaxis"),a=_isAxisLinear(t.layout,"yaxis");for(let i=1;i<=t.numberOfAxis;i++)o.push(e?_createPlotlyNumericDataDescriptor("x"+i):_createPlotlyAnyDataDescriptor("x"+i)),o.push(a?_createPlotlyNumericDataDescriptor("y"+i):_createPlotlyAnyDataDescriptor("y"+i))}return o},modelsHiddenParams[a].data.length>this.numberOfAxis&&modelsHiddenParams[a].data.splice(this.numberOfAxis,modelsHiddenParams[a].data.length),delete this.x;for(let e=1;e<=2;e++){const t=1===e?"x":"y";for(let e=1;e<=this.numberOfAxis;e++){const o=t+e;e>1&&"x"===t&&_.isUndefined(modelsHiddenParams[a].data[e-1])&&(modelsHiddenParams[a].data[e-1]={x:[],y:[],type:"bar"}),this[o]={index:e-1,strAxis:t,setValue:function(e){modelsHiddenParams[a].data[this.index][this.strAxis]=e,modelsHiddenParams[a].layout=modelsParameters[a].layout,i.render()},getValue:function(){return modelsHiddenParams[a].data[this.index][this.strAxis]},addValueChangedHandler:function(e){},removeValueChangedHandler:function(e){},setCaption:function(e,t){1==modelsParameters[a].numberOfAxis?(modelsParameters[a].layout[this.strAxis+"axis"].title=e,modelsHiddenParams[a].layout=modelsParameters[a].layout):modelsHiddenParams[a].data[this.index].name=e}}}}},this.barPlotlyWidget.prototype=t.prototype,this.piePlotlyWidget=function(e,t,a,o){this.constructor(e,t,a,o);var i=this;_.isUndefined(modelsParameters[a].layout)||(modelsParameters[a].layout={...plotlyColorParams,...modelsParameters[a].layout});const r=new WidgetActuatorDescription("labels","Array of labels",WidgetActuatorDescription.READ,WidgetPrototypesManager.SCHEMA_STRING_ARRAY),l=new WidgetActuatorDescription("values","Array of numeric values",WidgetActuatorDescription.READ,WidgetPrototypesManager.SCHEMA_NUMBER_ARRAY);this.getActuatorDescriptions=function(){return[r,l]},this.labels={setValue:function(e){modelsHiddenParams[a].data[0].labels=e,modelsHiddenParams[a].layout=modelsParameters[a].layout,i.render()},getValue:function(){return modelsHiddenParams[a].data[0].labels},addValueChangedHandler:function(e){},removeValueChangedHandler:function(e){}},this.values={setValue:function(e){modelsHiddenParams[a].data[0].values=e,modelsHiddenParams[a].layout=modelsParameters[a].layout,i.render()},getValue:function(){return modelsHiddenParams[a].data[0].values},addValueChangedHandler:function(e){},removeValueChangedHandler:function(e){}}},this.piePlotlyWidget.prototype=t.prototype,this.d3surfacePlotlyWidget=function(e,t,a,o){this.constructor(e,t,a,o);const i=this;_.isUndefined(modelsParameters[a].layout)||(modelsParameters[a].layout={...plotlyColorParams,...modelsParameters[a].layout},delete modelsParameters[a].layout.colorway,delete modelsParameters[a].layout.legend);const r=new WidgetActuatorDescription("x","1d array for the grid's Xs",WidgetActuatorDescription.READ,WidgetPrototypesManager.SCHEMA_NUMBER_ARRAY),l=new WidgetActuatorDescription("y","1d array for the grid's Ys",WidgetActuatorDescription.READ,WidgetPrototypesManager.SCHEMA_NUMBER_ARRAY),s=new WidgetActuatorDescription("z","2d array of arrays for the grid's Zs",WidgetActuatorDescription.READ,WidgetPrototypesManager.SCHEMA_NUMBER_ARRAY_2D);this.getActuatorDescriptions=function(){return[r,l,s]},this.x={setValue:function(e){modelsHiddenParams[a].data[0].x=e,modelsHiddenParams[a].layout=modelsParameters[a].layout,i.render()},getValue:function(){return modelsHiddenParams[a].data[0].x},addValueChangedHandler:function(e){},removeValueChangedHandler:function(e){},setCaption:function(e,t){modelsParameters[a].layout.scene.xaxis.title=e,modelsHiddenParams[a].layout=modelsParameters[a].layout}},this.y={setValue:function(e){modelsHiddenParams[a].data[0].y=e,modelsHiddenParams[a].layout=modelsParameters[a].layout,i.render()},getValue:function(){return modelsHiddenParams[a].data[0].y},addValueChangedHandler:function(e){},removeValueChangedHandler:function(e){},setCaption:function(e,t){modelsParameters[a].layout.scene.yaxis.title=e,modelsHiddenParams[a].layout=modelsParameters[a].layout}},this.z={setValue:function(e){modelsHiddenParams[a].data[0].z=e,i.render()},getValue:function(){return modelsHiddenParams[a].data[0].z},addValueChangedHandler:function(e){},removeValueChangedHandler:function(e){},setCaption:function(e,t){modelsParameters[a].layout.scene.zaxis.title=e,modelsHiddenParams[a].layout=modelsParameters[a].layout}}},this.d3surfacePlotlyWidget.prototype=t.prototype,this.genericPlotlyWidget=function(e,t,a,o){this.constructor(e,t,a,o);const i=this,r=new WidgetActuatorDescription("data","Plotly data array",WidgetActuatorDescription.READ,void 0,(e=>(Plotly.validate(e,{})||[]).map((e=>new WidgetActuatorValidationError(e.msg))))),l=new WidgetActuatorDescription("layout","Plotly layout object",WidgetActuatorDescription.READ,void 0,(e=>(Plotly.validate([],e)||[]).map((e=>new WidgetActuatorValidationError(e.msg))))),s=new WidgetActuatorDescription("selection","Plotly selection",WidgetActuatorDescription.WRITE);this.getActuatorDescriptions=function(){return[r,l,s]},this.data={setValue:function(e){modelsHiddenParams[a].data=e,i.render()},getValue:function(){return modelsHiddenParams[a].data},addValueChangedHandler:function(e){},removeValueChangedHandler:function(e){}},this.layout={setValue:function(e){modelsHiddenParams[a].layout=e,i.render()},getValue:function(){return modelsHiddenParams[a].layout},addValueChangedHandler:function(e){},removeValueChangedHandler:function(e){}},this.selection={setValue:function(e){modelsHiddenParams[a].selection=e},getValue:function(){return modelsHiddenParams[a].selection},addValueChangedHandler:function(e){this.updateCallback=e},removeValueChangedHandler:function(e){}}},this.genericPlotlyWidget.prototype=t.prototype,this.realTimePlotlyWidget=function(e,t,a,o){var i=this;this.numberOfAxis=1;const r=new WidgetActuatorDescription("layout","Plotly layout object",WidgetActuatorDescription.READ,void 0,(e=>(Plotly.validate([],e)||[]).map((e=>new WidgetActuatorValidationError(e.msg))))),l=new WidgetActuatorDescription("y1","Numeric value to add to the plot",WidgetActuatorDescription.READ,WidgetPrototypesManager.SCHEMA_NUMBER);this.getActuatorDescriptions=function(){const e=[];return e.push(l),e.push(r),e},modelsHiddenParams[a].data.length>this.numberOfAxis&&modelsHiddenParams[a].data.splice(this.numberOfAxis,modelsHiddenParams[a].data.length);for(let e=1;e<=this.numberOfAxis;e++){const i="y"+e;e>1&&_.isUndefined(modelsHiddenParams[a].data[e-1])&&(modelsHiddenParams[a].data[e-1]={x:[],y:[],name:"caption "+(e-1)}),this[i]={index:e-1,setValue:function(e){new Date;var a="plotly"+t;o&&(a+="c"),Plotly.extendTraces(a,{y:[[e]]},[this.index])},getValue:function(){return modelsHiddenParams[a].data[this.index].y},addValueChangedHandler:function(e){},removeValueChangedHandler:function(e){},setCaption:function(e,t){}}}this.layout={setValue:function(e){modelsHiddenParams[a].layout=e,i.render()},getValue:function(){return modelsHiddenParams[a].layout},addValueChangedHandler:function(e){},removeValueChangedHandler:function(e){}},this.constructor(e,t,a,o)},this.realTimePlotlyWidget.prototype=t.prototype,this.pluginDefinition={name:"plotly",widgetsDefinitionList:{plotlyLine:{factory:"linePlotlyWidget",title:"Plotly line",icn:"plotly-line",help:"wdg/wdg-plots/#plotly-line"},plotlyBar:{factory:"barPlotlyWidget",title:"Plotly bar",icn:"plotly-bar",help:"wdg/wdg-plots/#plotly-bar"},plotlyPie:{factory:"piePlotlyWidget",title:"Plotly pie",icn:"plotly-pie",help:"wdg/wdg-plots/#plotly-pie"},plotly3dSurface:{factory:"d3surfacePlotlyWidget",title:"Plotly 3D surface",icn:"plotly-3D",help:"wdg/wdg-plots/#plotly-3d-surface"},plotlyGeneric:{factory:"genericPlotlyWidget",title:"Plotly generic",icn:"plotly-javascript-generic",help:"wdg/wdg-plots/#plotly-generic"},plotlyRealTime:{factory:"realTimePlotlyWidget",title:"Plotly real-time",icn:"plotly-real-time"}}}}var plotlyWidgetsPlugin=new plotlyWidgetsPluginClass;widgetsPluginsHandler.loadWidgetPlugin(plotlyWidgetsPlugin);
function pyodideWidgetsPluginClass(){var t=document.createElement("div");t.setAttribute("style","height: 1in; width: 1in; left: 100%; position: fixed; top: 100%;"),t.setAttribute("id","hiddenDivDpi"),document.body.appendChild(t);var e=document.getElementById("hiddenDivDpi").offsetWidth,i=document.getElementById("hiddenDivDpi").offsetHeight;function n(t,e){var i=document.createElement("div");i.setAttribute("id",e),i.setAttribute("style","text-align:center; height: inherit; width: inherit; background-color: transparent"),$("#"+t).html(i)}this.genericPlotlyPythonWidget=function(t,e,i,o){this.constructor(t,e,i,o);var d=this;this.rescale=function(){},this.render=async function(){var d="plotlyPython"+e;o&&(d+="c"),n(t,d);let a=modelsHiddenParams[i].fig;if(a&&"OK"==datanodesManager.getDataNodeByName(a).status()){let e='fig = globalScope["'+a+'"]\n';e+="\n# convert figure to JSON\nfig_json = fig.to_json(\nvalidate=True,\npretty=False)\nfig_json\n";try{const i=await pyodideManager.runPythonScript(e),n=JSON.parse(i);if(o)Plotly.newPlot(d,n.data,n.layout,n.config);else{$("#"+d).html(""),$("#"+d).html('<img id="png-export-'+d+'"></img>');var l,r=$("#png-export-"+d);Plotly.newPlot(d,n.data,n.layout,n.config).then((function(e){Plotly.toImage(e,{height:$("#"+t).height(),width:$("#"+t).width()}).then((function(t){l=t,Plotly.purge(e),r.attr("src",l),e.style.minHeight=e.parentNode.style.minHeight,e.style.minWidth=e.parentNode.style.minWidth,e.style.width=e.parentNode.style.width,e.style.height=e.parentNode.style.height,r[0].style.minHeight=parseInt(e.parentNode.style.minHeight)+"px",r[0].style.minWidth=parseInt(e.parentNode.style.minWidth)+"px",r[0].style.width=parseFloat(e.parentNode.style.width)+"vw",r[0].style.height=parseFloat(e.parentNode.style.height)+"vh"}))}))}}catch(t){console.log(t)}}};const a=new WidgetActuatorDescription("fig","Plotly figure object",WidgetActuatorDescription.READ);this.getActuatorDescriptions=function(){return[a]},this.fig={setValue:function(t){modelsHiddenParams[i].fig=t,d.render()},getValue:function(){return modelsHiddenParams[i].fig},addValueChangedHandler:function(t){},removeValueChangedHandler:function(t){}},pyodideManager.loadPyodideLibs({standardLibs:[],micropipLibs:["plotly"]}),d.render()},this.genericPlotlyPythonWidget.prototype=baseWidget.prototype,this.genericMatplotlibWidget=function(t,o,d,a){this.constructor(t,o,d,a);var l=this;this.render=async function(){var l="innerMatplotlib"+o;a&&(l+="c"),n(t,l);let r=modelsHiddenParams[d].fig;if(r&&"OK"==datanodesManager.getDataNodeByName(r).status()){let t='fig = globalScope["'+r+'"]\n';t=t+"fig.set_size_inches("+$("#"+l).width()/e+","+$("#"+l).height()/i+")\n",t+="\nimport io, base64\nbuf = io.BytesIO()\nfig.savefig(buf, format='png')\nbuf.seek(0)\nimg_str = 'data:image/png;base64,' + base64.b64encode(buf.read()).decode('UTF-8')\nimg_str\n";try{const e=await pyodideManager.runPythonScript(t);$("#"+l).html('<img id="png-export-'+l+'"></img>');var s=$("#png-export-"+l),g=e;s.attr("src",g),s[0].style.width="inherit",s[0].style.height="inherit"}catch(t){console.log(t)}}};const r=new WidgetActuatorDescription("fig","Matplotlib figure object",WidgetActuatorDescription.READ);this.getActuatorDescriptions=function(){return[r]},this.fig={setValue:function(t){modelsHiddenParams[d].fig=t,l.render()},getValue:function(){return modelsHiddenParams[d].fig},addValueChangedHandler:function(t){},removeValueChangedHandler:function(t){}},pyodideManager.loadPyodideLibs({standardLibs:["matplotlib"],micropipLibs:[]}),l.render()},this.genericMatplotlibWidget.prototype=baseWidget.prototype,this.pluginDefinition={name:"pyodide",widgetsDefinitionList:{plotlyPyGeneric:{factory:"genericPlotlyPythonWidget",title:"Plotly Python generic",icn:"plotly-python-generic",help:"wdg/wdg-plots/#plotly-python-generic"},matplotlib:{factory:"genericMatplotlibWidget",title:"Matplotlib generic",icn:"matplolib-generic",help:"wdg/wdg-plots/#matplotlib"}}},this.constructor()}modelsParameters.plotlyPyGeneric={},modelsParameters.matplotlib={},modelsHiddenParams.plotlyPyGeneric={fig:""},modelsHiddenParams.matplotlib={fig:""},modelsLayout.plotlyPyGeneric={height:"30vh",width:"30vw",minWidth:"50px",minHeight:"32px"},modelsLayout.matplotlib={height:"30vh",width:"30vw",minWidth:"50px",minHeight:"32px"},pyodideWidgetsPluginClass.prototype=basePlugin.prototype;var pyodideWidgetsPlugin=new pyodideWidgetsPluginClass;widgetsPluginsHandler.loadWidgetPlugin(pyodideWidgetsPlugin);
function vegaWidgetsPluginClass(){let e;this.genericVegaWidget=function(t,i,n,a){void 0!==window.xdash&&void 0===e&&(e=null,fetch("assets/data/vega_json_schema_v5.json").then((e=>e.json())).then((t=>{e=t,e.$id=WidgetPrototypesManager.ID_URI_SCHEME+"xdash:vega"})).catch((e=>console.error(e)))),this.constructor(t,i,n,a);var r=this;this.rescale=function(){},this.render=function(){var e=JSON.parse(JSON.stringify(modelsHiddenParams[n].spec));if(function(e,t,i){var n=document.createElement("div"),a="vega"+t;i&&(a+="c"),n.setAttribute("id",a),n.setAttribute("style","text-align:center; height: inherit; width: inherit; background-color: transparent"),$("#"+e).html(n)}(t,i,a),modelsParameters[n].inheritWidthAndHeight&&(a?(e.width=$("#vega"+i+"c").width(),e.height=$("#vega"+i+"c").height()):(e.width=$("#vega"+i).width(),e.height=$("#vega"+i).height())),a)return new vega.View(vega.parse(e),{renderer:"canvas",container:"#vega"+i+"c",hover:!0}).runAsync();new vega.View(vega.parse(e),{renderer:"none"}).toCanvas().then((function(e){var t=e.toDataURL("image/png");$("#vega"+i).html('<img src="'+t+'"/>')})).catch((function(e){console.error(e)}))};const s=new WidgetActuatorDescription("spec","Vega JSON specification",WidgetActuatorDescription.READ,e);this.getActuatorDescriptions=function(){return[s]},this.spec={setValue:function(e){e!=modelsHiddenParams[n].spec&&(modelsHiddenParams[n].spec=JSON.parse(JSON.stringify(e)),r.render())},getValue:function(){return modelsHiddenParams[n].spec},addValueChangedHandler:function(e){},removeValueChangedHandler:function(e){}},r.render()},this.genericVegaWidget.prototype=baseWidget.prototype,this.pluginDefinition={name:"vega",widgetsDefinitionList:{vegaGeneric:{factory:"genericVegaWidget",title:"Vega generic",icn:"vega-generic-javascript",help:"wdg/wdg-plots/#vega"}}},this.constructor()}modelsParameters.vegaGeneric={inheritWidthAndHeight:!0},modelsHiddenParams.vegaGeneric={spec:{marks:[{type:"text",encode:{update:{text:{value:"Write then connect your Vega spec"}}}}]}},modelsLayout.vegaGeneric={height:"30vh",width:"30vw",minWidth:"50px",minHeight:"32px"},vegaWidgetsPluginClass.prototype=basePlugin.prototype;var vegaWidgetsPlugin=new vegaWidgetsPluginClass;widgetsPluginsHandler.loadWidgetPlugin(vegaWidgetsPlugin);
modelsParameters.echartsGeneric={};const echartsDefaultColors=["var(--widget-color-2)","var(--widget-color-5)","var(--widget-color-6)","var(--widget-color-7)"];function echartsWidgetsPluginClass(){this.genericEchartsWidget=function(e,t,i,n){this.constructor(e,t,i,n);var r=this;this.rescale=function(){this.render()},this.updateValue=function(e){modelsHiddenParams[i].selection&&(modelsHiddenParams[i].selection=e,_.isUndefined(r.selection.updateCallback)||r.selection.updateCallback(r.selection,r.selection.getValue()))},this.getColorValueFromCSSProperty=function(e){var t=e;if(t.includes("var(--")){var i=e.substring(4,e.length-1);t=window.getComputedStyle(document.documentElement).getPropertyValue(i)}return t},this.render=function(){var o=JSON.parse(JSON.stringify(modelsHiddenParams[i].option));if(o.hasOwnProperty("color")||(o.color=echartsDefaultColors),o.color=o.color.map((e=>this.getColorValueFromCSSProperty(e))),function(e,t,i){var n=document.createElement("div"),r="echarts"+t;i&&(r+="c"),n.setAttribute("id",r),n.setAttribute("style","text-align:center; height: inherit; width: inherit; background-color: transparent"),$("#"+e).html(n)}(e,t,n),n){var a=echarts.init(document.getElementById("echarts"+t+"c"));try{a.setOption(o)}catch(e){console.log(e)}a.on("datazoom",(e=>{r.updateValue({start:e.start,end:e.end})}))}else{a=echarts.init(document.getElementById("echarts"+t));try{a.setOption(o)}catch(e){console.log(e)}var s=a.getDataURL();a.dispose(),$("#echarts"+t).html('<img src="'+s+'"/>')}};const o=new WidgetActuatorDescription("option","Chart definition",WidgetActuatorDescription.READ,WidgetPrototypesManager.SCHEMA_ANY_OBJECT),a=new WidgetActuatorDescription("selection","Current selection",WidgetActuatorDescription.WRITE,WidgetPrototypesManager.SCHEMA_ANY_OBJECT);this.getActuatorDescriptions=function(){return[o,a]},this.option={setValue:function(e){e==modelsHiddenParams[i].option||""==e||_.isUndefined(e)||(modelsHiddenParams[i].option=e,r.render())},getValue:function(){return modelsHiddenParams[i].option},addValueChangedHandler:function(e){},removeValueChangedHandler:function(e){}},this.selection={setValue:function(e){modelsHiddenParams[i].selection=e},getValue:function(){return modelsHiddenParams[i].selection},addValueChangedHandler:function(e){this.updateCallback=e},removeValueChangedHandler:function(e){}},r.render()},this.genericEchartsWidget.prototype=baseWidget.prototype,this.pluginDefinition={name:"echarts",widgetsDefinitionList:{echartsGeneric:{factory:"genericEchartsWidget",title:"Echarts generic",icn:"echarts-generic-javascript",help:"wdg/wdg-plots/#echarts"}}},this.constructor()}modelsHiddenParams.echartsGeneric={option:{color:echartsDefaultColors},selection:{}},modelsLayout.echartsGeneric={height:"30vh",width:"30vw",minWidth:"50px",minHeight:"32px"},echartsWidgetsPluginClass.prototype=basePlugin.prototype;var echartsWidgetsPlugin=new echartsWidgetsPluginClass;widgetsPluginsHandler.loadWidgetPlugin(echartsWidgetsPlugin);
modelsHiddenParams.hereMaps={inputGeoJson:{},mapMatchingResult:{},heatMapData:{}},modelsHiddenParams.openStreetMaps={geoJson:{geoJsonLayers:[],geoJsonBounds:[]},choropleth:{choroplethLayers:[],choroplethBounds:[]},lineHeatMap:{lineHeatMapLayers:[],lineHeatMapBounds:[]},heatMap:{heatMapData:[],heatMapBuffer:[]},imageOverlay:{imageData:[]},svgOverlay:{svgData:[],svgElements:[]},legends:[],colors:["#800080","#FF00FF","#000080","#0000FF","#008080","#00FFFF","#FFFF00","#800000","#6666ff","#cc6699","#66ff66","#666699","#996633","#ff0000","#669999","#ffff99"]},modelsTempParams.openStreetMaps={geoJson:{geoJsonLayers:[]},choropleth:{choroplethLayers:[]},lineHeatMap:{lineHeatMapLayers:[]},heatMap:{heatMapLayers:[]},imageOverlay:{imageLayers:[]},svgOverlay:{svgLayers:[]},mapObj:null},modelsParameters.openStreetMaps={geoJson:{numberOfLayers:1},choropleth:{numberOfLayers:0},heatMap:{numberOfLayers:0,sampledDisplay:!1,densityHeatMap:!1},lineHeatMap:{numberOfLayers:0},imageOverlay:{numberOfLayers:0},svgOverlay:{numberOfLayers:0},defaultCenter:{latitude:48.872063,longitude:2.331773,zoom:16},offlineSupport:!1,tileServer:"MapboxStreets",drawingFeatures:!1,drawingFeaturesOptions:{point:!0,line:!0,polygone:!0,rectangle:!0,modal:!1},captureClickEvent:!1,markerCluster:!0},modelsLayout.openStreetMaps={height:"35vh",width:"35vw"};const _SCHEMA_SELECTED_POINT={$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:leaflet_imageOverlay",type:"object",properties:{lat:{type:"number"},lag:{type:"number"}},required:["lat","lag"]},_SCHEMA_IMAGE_OVERLAY={$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:leaflet_imageOverlay",type:"object",properties:{imageUrl:{type:"string"},imageBounds:{type:"array",items:{type:"array",items:{type:"number"},minItems:2,maxItems:2},minItems:2,maxItems:2},title:{type:"string"},addAs:{enum:["overlay","baseLayer"]}},required:["imageUrl","imageBounds","title","addAs"]},_SCHEMA_SVG_POINT_OVERLAY={$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:leaflet_svgPointOverlay",type:"object",properties:{data:{anyOf:[{type:"object",properties:{lat:{type:"number"},lng:{type:"number"},direction:{type:"number"}},required:["lat","lng"]},{type:"object",properties:{lat:{type:"number"},lng:{type:"number"},rotation:{type:"number"}},required:["lat","lng"]}]},config:{type:"object",properties:{title:{type:"string"},addAs:{enum:["overlay","baseLayer"]},disableAutoscale:{type:"boolean"},marker:{enum:["arrow","triangle","emptyTriangle","fullTriangle","circle"]},length:{type:"number"},color:{type:"string"}},required:["title","length"]}},required:["data","config"]},_SCHEMA_SVG_OVERLAY={$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:leaflet_svgOverlay",type:"object",properties:{data:{type:"array",items:{anyOf:[{type:"object",properties:{lat:{type:"number"},lng:{type:"number"},direction:{type:"number"}},required:["lat","lng"]},{type:"object",properties:{lat:{type:"number"},lng:{type:"number"},rotation:{type:"number"}},required:["lat","lng"]}]}},config:{type:"object",properties:{title:{type:"string"},addAs:{enum:["overlay","baseLayer"]},disableAutoscale:{type:"boolean"},marker:{enum:["arrow","triangle","emptyTriangle","fullTriangle","circle"]},length:{type:"number"},color:{type:"string"}},required:["title","length"]}},required:["data","config"]},__SCHEMA_VALUED_COORD={$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:leaflet__valued_coord",anyOf:[{type:"object",properties:{lat:{type:"number",minimum:-90,maximum:90},lng:{type:"number",minimum:-180,maximum:180}},required:["lat","lng"],minProperties:3,maxProperties:3,additionalProperties:{type:"number"}},{type:"array",items:[{type:"number",minimum:-90,maximum:90},{type:"number",minimum:-180,maximum:180},{type:"number"}],minItems:3,maxItems:3}]},__SCHEMA_COORD={$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:leaflet__coord",anyOf:[{type:"object",properties:{lat:{type:"number",minimum:-90,maximum:90},lng:{type:"number",minimum:-180,maximum:180}},required:["lat","lng"]},{type:"array",items:[{type:"number",minimum:-90,maximum:90},{type:"number",minimum:-180,maximum:180}],minItems:2,maxItems:2}]},__SCHEMA_HEATMAP_DENSITY_CONFIG={$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:leaflet__heatmap_density_config",type:"object",properties:{minOpacity:{type:"number",minimum:0,maximum:1},maxZoom:{type:"number",minimum:0},radius:{type:"number",minimum:0},blur:{type:"number",minimum:0},disableAutoscale:{type:"boolean"},colorScale:{type:"string"},reverseColorScale:{type:"boolean"}}},__SCHEMA_HEATMAP_CONFIG={$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:leaflet__heatmap_config",type:"object",properties:{opacity:{type:"number",minimum:0,maximum:1},radius:{type:"number",minimum:0},max:{type:"number"},min:{type:"number"},disableAutoscale:{type:"boolean"},addTextLabel:{type:"boolean"},colorScale:{type:"string"},reverseColorScale:{type:"boolean"}}},_SCHEMA_HEATMAP_DENSITY=[{$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:leaflet_heatmap_density",type:"object",properties:{data:{type:"array",items:{$ref:__SCHEMA_VALUED_COORD.$id}},config:{$ref:__SCHEMA_HEATMAP_DENSITY_CONFIG.$id}},required:["data"]},__SCHEMA_VALUED_COORD,__SCHEMA_HEATMAP_DENSITY_CONFIG],_SCHEMA_HEATMAP_DENSITY_SAMPLED=[{$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:leaflet_heatmap_density_sampled",type:"object",properties:{data:{$ref:__SCHEMA_VALUED_COORD.$id},config:{$ref:__SCHEMA_HEATMAP_DENSITY_CONFIG.$id}},required:["data"]},__SCHEMA_VALUED_COORD,__SCHEMA_HEATMAP_DENSITY_CONFIG],_SCHEMA_HEATMAP=[{$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:leaflet_heatmap",type:"object",properties:{data:{type:"array",items:{$ref:__SCHEMA_VALUED_COORD.$id}},config:{$ref:__SCHEMA_HEATMAP_CONFIG.$id}},required:["data"]},__SCHEMA_VALUED_COORD,__SCHEMA_HEATMAP_CONFIG],_SCHEMA_HEATMAP_SAMPLED=[{$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:leaflet_heatmap_sampled",type:"object",properties:{data:{$ref:__SCHEMA_VALUED_COORD.$id},config:{$ref:__SCHEMA_HEATMAP_CONFIG.$id}},required:["data"]},__SCHEMA_VALUED_COORD,__SCHEMA_HEATMAP_CONFIG],__SCHEMA_GEOJSON_COORD={$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:leaflet_geojson_coord",anyOf:[{type:"array",items:[{type:"number",minimum:-180,maximum:180},{type:"number",minimum:-90,maximum:90}],minItems:2,maxItems:2},{type:"array",items:[{type:"number",minimum:-180,maximum:180},{type:"number",minimum:-90,maximum:90},{type:"number"}],minItems:3,maxItems:3}]},__SCHEMA_GEOJSON_COORDINATES={$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:leaflet_geojson_coordinates",type:"array",items:{$ref:__SCHEMA_GEOJSON_COORD.$id}},_SCHEMA_LINE_HEATMAP=[{$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:leaflet_line_heatmap",type:"object",properties:{data:{type:"array",items:{type:"object",properties:{coordinates:{type:"array",items:{$ref:__SCHEMA_GEOJSON_COORD.$id},minItems:2}},required:["coordinates"],patternProperties:{"^(?!coordinates).*$":{type:"number"}},minProperties:2,maxProperties:2}},config:{type:"object",properties:{opacity:{type:"number",minimum:0,maximum:1},weight:{type:"number",minimum:0},max:{type:"number"},min:{type:"number"},disableAutoscale:{type:"boolean"},colorScale:{type:"string"},reverseColorScale:{type:"boolean"}},required:["weight"]}},required:["data","config"]},__SCHEMA_GEOJSON_COORD],__SCHEMA_GEOJSON_GEOMETRY_PRIMITIVE={$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:leaflet_geojson_geometry_primitive",anyOf:[{type:"object",properties:{type:{const:"Point"},coordinates:{$ref:__SCHEMA_GEOJSON_COORD.$id}},required:["type","coordinates"]},{type:"object",properties:{type:{const:"LineString"},coordinates:{$ref:__SCHEMA_GEOJSON_COORDINATES.$id}},required:["type","coordinates"]},{type:"object",properties:{type:{const:"Polygon"},coordinates:{type:"array",items:{$ref:__SCHEMA_GEOJSON_COORDINATES.$id}}},required:["type","coordinates"]}]},__SCHEMA_GEOJSON_GEOMETRY_ALL={$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:leaflet_geojson_geometry_all",anyOf:[{$ref:__SCHEMA_GEOJSON_GEOMETRY_PRIMITIVE.$id},{type:"object",properties:{type:{const:"MultiPoint"},coordinates:{$ref:__SCHEMA_GEOJSON_COORDINATES.$id}},required:["type","coordinates"]},{type:"object",properties:{type:{const:"MultiLineString"},coordinates:{type:"array",items:{$ref:__SCHEMA_GEOJSON_COORDINATES.$id}}},required:["type","coordinates"]},{type:"object",properties:{type:{const:"MultiPolygon"},coordinates:{type:"array",items:{type:"array",items:{$ref:__SCHEMA_GEOJSON_COORDINATES.$id}}}},required:["type","coordinates"]},{type:"object",properties:{type:{const:"GeometryCollection"},geometries:{type:"array",items:{$ref:__SCHEMA_GEOJSON_GEOMETRY_PRIMITIVE.$id}}},required:["type","geometries"]}]},_SCHEMA_CHOROPLETH=[{$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:leaflet_choropleth",type:"object",properties:{data:{type:"array",items:{type:"object",properties:{geometry:{$ref:__SCHEMA_GEOJSON_GEOMETRY_ALL.$id}},required:["geometry"],patternProperties:{"^(?!geometry).*$":{type:"number"}},minProperties:2,maxProperties:2}},config:{type:"object",properties:{opacity:{type:"number",minimum:0,maximum:1},weight:{type:"number",minimum:0},max:{type:"number"},min:{type:"number"},disableAutoscale:{type:"boolean"},colorScale:{type:"string"},reverseColorScale:{type:"boolean"}}}},required:["data"]},__SCHEMA_GEOJSON_COORD,__SCHEMA_GEOJSON_COORDINATES,__SCHEMA_GEOJSON_GEOMETRY_PRIMITIVE,__SCHEMA_GEOJSON_GEOMETRY_ALL],_SCHEMA_GEOJSON=[{$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:leaflet_geojson",type:"object",properties:{type:{const:"FeatureCollection"},features:{type:"array",items:{type:"object",properties:{type:{const:"Feature"},id:{type:"string"},geometry:{$ref:__SCHEMA_GEOJSON_GEOMETRY_ALL.$id},properties:{type:"object",properties:{description:{type:"string"},style:{type:"object",properties:{color:{type:"string"},weight:{type:"number"},opacity:{type:"number"}},additionalProperties:{$ref:WidgetPrototypesManager.SCHEMA_ANY_PRIMITIVE.$id}}}}},if:{properties:{geometry:{type:"object",properties:{type:{const:"Point"}},required:["type"]}}},then:{properties:{properties:{type:"object",properties:{awesomeMarker:{type:"object",properties:{icon:{type:"string"},prefix:{type:"string"},markerColor:{type:"string"},iconColor:{type:"string"},spin:{type:"boolean"},extraClasses:{type:"string"}},required:["icon"]},comment:{type:"string"},html:{type:"string"}},anyOf:[{not:{required:["comment"]}},{not:{required:["html"]}}]}}},required:["type","geometry","properties"]}},properties:{type:"object",properties:{description:{type:"string"}}}},required:["type","features"]},__SCHEMA_GEOJSON_COORD,__SCHEMA_GEOJSON_COORDINATES,__SCHEMA_GEOJSON_GEOMETRY_PRIMITIVE,__SCHEMA_GEOJSON_GEOMETRY_ALL,WidgetPrototypesManager.SCHEMA_ANY_PRIMITIVE],_SCHEMA_SELECTED_GEOJSON=[{$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:leaflet_selected_geojson",type:"object",properties:{type:{const:"FeatureCollection"},features:{type:"array",items:{type:"object",required:["type","geometry","properties"],properties:{type:{const:"Feature"},geometry:{$ref:__SCHEMA_GEOJSON_GEOMETRY_PRIMITIVE.$id},properties:{type:"object",properties:{layerId:{type:"number"}},required:["layerId"]}},if:{properties:{geometry:{type:"object",properties:{type:{const:"Polygon"}},required:["type"]}}},then:{properties:{geometry:{type:"object",properties:{isRectangle:{type:"boolean"},isCut:{type:"boolean"}},required:["isRectangle","isCut"]}}}}}},required:["type","features"]},__SCHEMA_GEOJSON_COORD,__SCHEMA_GEOJSON_COORDINATES,__SCHEMA_GEOJSON_GEOMETRY_PRIMITIVE,WidgetPrototypesManager.SCHEMA_ANY_PRIMITIVE];function mapWidgetsPluginClass(){var e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("xmlns","http://www.w3.org/2000/svg"),e.setAttribute("width","0"),e.setAttribute("height","0");e.innerHTML='<defs><marker id="styledArrow" markerUnits="strokeWidth" markerWidth="12" markerHeight="12" viewBox="0 0 12 12" refX="6" refY="6" orient="auto"><path d="M2,2 L10,6 L2,10 L6,6 L2,2" style="fill: black;"></path></marker></defs>';var a=document.createElement("div");a.setAttribute("style","width:0px; height:0px; margin:0px; padding: 0px"),a.setAttribute("id","hiddenDiv"),a.appendChild(e),document.body.appendChild(a),this.openStreetMapsWidget=function(e,a,t,r){var o=modelsParameters[t].drawingFeatures,s=modelsParameters[t].captureClickEvent,n=modelsParameters[t].markerCluster,i={drawCircle:!1,drawCircleMarker:!1,drawMarker:!0,drawPolyline:!0,drawPolygon:!0,drawRectangle:!0};o&&(i={drawCircle:!1,drawCircleMarker:!1,drawMarker:modelsParameters[t].drawingFeaturesOptions.point,drawPolyline:modelsParameters[t].drawingFeaturesOptions.line,drawPolygon:modelsParameters[t].drawingFeaturesOptions.polygone,drawRectangle:modelsParameters[t].drawingFeaturesOptions.rectangle}),this.constructor(e,a,t,r);var l=this,d=(d3.select("body"),[0,25,50,75,100]);function m(e,a,t,r){var o=(a-e)/8;return r(Math.floor((t-e)/o)*(1/8))}if(this.numberOfGeoJsonLayers=modelsParameters[t].geoJson.numberOfLayers,modelsParameters[t].choropleth?this.numberOfChoroplethLayers=modelsParameters[t].choropleth.numberOfLayers:this.numberOfChoroplethLayers=0,modelsParameters[t].lineHeatMap?this.numberOfLineHeatMapLayers=modelsParameters[t].lineHeatMap.numberOfLayers:this.numberOfLineHeatMapLayers=0,this.numberOfHeatMapLayers=modelsParameters[t].heatMap.numberOfLayers,_.isUndefined(modelsHiddenParams[t].heatMap.heatMapBuffer)&&(modelsHiddenParams[t].heatMap.heatMapBuffer=[]),_.isUndefined(modelsParameters[t].imageOverlay)?(this.numberOfImageLayers=0,modelsParameters[t].imageOverlay={numberOfLayers:0}):this.numberOfImageLayers=modelsParameters[t].imageOverlay.numberOfLayers,_.isUndefined(modelsHiddenParams[t].imageOverlay)&&(modelsHiddenParams[t].imageOverlay={imageData:[]}),_.isUndefined(modelsParameters[t].svgOverlay)?(this.numberOfSvgLayers=0,modelsParameters[t].svgOverlay={numberOfLayers:0}):this.numberOfSvgLayers=modelsParameters[t].svgOverlay.numberOfLayers,_.isUndefined(modelsHiddenParams[t].svgOverlay)&&(modelsHiddenParams[t].svgOverlay={svgData:[],svgElements:[]}),_.isUndefined(modelsParameters[t].lineHeatMap)?(this.numberOfLineHeatMapLayers=0,modelsParameters[t].lineHeatMap={numberOfLayers:0}):this.numberOfLineHeatMapLayers=modelsParameters[t].lineHeatMap.numberOfLayers,_.isUndefined(modelsHiddenParams[t].lineHeatMap)&&(modelsHiddenParams[t].lineHeatMap={lineHeatMapLayers:[],lineHeatMapBounds:[]}),_.isUndefined(modelsParameters[t].choropleth)?(this.numberOfChoroplethLayers=0,modelsParameters[t].choropleth={numberOfLayers:0}):this.numberOfChoroplethLayers=modelsParameters[t].choropleth.numberOfLayers,_.isUndefined(modelsHiddenParams[t].choropleth)&&(modelsHiddenParams[t].choropleth={choroplethLayers:[],choroplethBounds:[]}),_.isUndefined(l.mapLayers)&&(l.mapLayers=jQuery.extend(!0,{},modelsTempParams.openStreetMaps)),this.configStore=[],modelsHiddenParams[t].geoJson.geoJsonLayers.length>l.numberOfGeoJsonLayers&&modelsHiddenParams[t].geoJson.geoJsonLayers.splice(l.numberOfGeoJsonLayers),modelsHiddenParams[t].geoJson.geoJsonBounds.length>l.numberOfGeoJsonLayers&&modelsHiddenParams[t].geoJson.geoJsonBounds.splice(l.numberOfGeoJsonLayers),l.mapLayers.geoJson.geoJsonLayers.length>l.numberOfGeoJsonLayers&&l.mapLayers.geoJson.geoJsonLayers.splice(l.numberOfGeoJsonLayers),modelsHiddenParams[t].choropleth.choroplethLayers.length>l.numberOfChoroplethLayers&&modelsHiddenParams[t].choropleth.choroplethLayers.splice(l.numberOfChoroplethLayers),modelsHiddenParams[t].choropleth.choroplethBounds.length>l.numberOfChoroplethLayers&&modelsHiddenParams[t].choropleth.choroplethBounds.splice(l.numberOfChoroplethLayers),l.mapLayers.choropleth.choroplethLayers.length>l.numberOfChoroplethLayers&&l.mapLayers.choropleth.choroplethLayers.splice(l.numberOfChoroplethLayers),modelsHiddenParams[t].lineHeatMap.lineHeatMapLayers.length>l.numberOfLineHeatMapLayers&&modelsHiddenParams[t].lineHeatMap.lineHeatMapLayers.splice(l.numberOfLineHeatMapLayers),modelsHiddenParams[t].lineHeatMap.lineHeatMapBounds.length>l.numberOfLineHeatMapLayers&&modelsHiddenParams[t].lineHeatMap.lineHeatMapBounds.splice(l.numberOfLineHeatMapLayers),l.mapLayers.lineHeatMap.lineHeatMapLayers.length>l.numberOfLineHeatMapLayers&&l.mapLayers.lineHeatMap.lineHeatMapLayers.splice(l.numberOfLineHeatMapLayers),modelsHiddenParams[t].heatMap.heatMapData.length>l.numberOfHeatMapLayers&&(modelsHiddenParams[t].heatMap.heatMapData.splice(l.numberOfHeatMapLayers),modelsHiddenParams[t].legends.splice(l.numberOfHeatMapLayers)),modelsHiddenParams[t].heatMap.heatMapBuffer.length>l.numberOfHeatMapLayers&&(modelsHiddenParams[t].heatMap.heatMapBuffer.splice(l.numberOfHeatMapLayers),modelsHiddenParams[t].legends.splice(l.numberOfHeatMapLayers)),l.mapLayers.heatMap.heatMapLayers.length>l.numberOfHeatMapLayers&&l.mapLayers.heatMap.heatMapLayers.splice(l.numberOfHeatMapLayers),modelsHiddenParams[t].imageOverlay.imageData.length>l.numberOfImageLayers&&modelsHiddenParams[t].imageOverlay.imageData.splice(l.numberOfImageLayers),l.mapLayers.imageOverlay.imageLayers.length>l.numberOfImageLayers&&l.mapLayers.imageOverlay.imageLayers.splice(l.numberOfImageLayers),modelsHiddenParams[t].svgOverlay.svgData.length>l.numberOfSvgLayers&&(modelsHiddenParams[t].svgOverlay.svgData.splice(l.numberOfSvgLayers),modelsHiddenParams[t].svgOverlay.svgElements.splice(l.numberOfSvgLayers)),l.mapLayers.svgOverlay.svgLayers.length>l.numberOfSvgLayers&&l.mapLayers.svgOverlay.svgLayers.splice(l.numberOfSvgLayers),this.getColorScale=function(e,a,t,r){var o=d3.interpolateYlOrRd;return _.isUndefined(e)||_.isUndefined(d3[e])||!e.includes("interpolate")||(o=d3[e]),!_.isUndefined(a)&&a?d3.scaleSequential().interpolator(o).domain([r,t]):d3.scaleSequential().interpolator(o).domain([t,r])},this.goToFirstRadioButton=function(){if("play"==tabActive&&l.numberOfHeatMapLayers>0){var e=0;_.isUndefined($("input[name='leaflet-base-layers']"))||(e=$("input[name='leaflet-base-layers']").length);for(var a=0;a<e;a++)if($.contains(document.getElementById(t+"c"),$("input[name='leaflet-base-layers']")[a])&&!_.isUndefined(modelsHiddenParams[t])&&modelsHiddenParams[t].legends!=[]){$("input[name='leaflet-base-layers']")[a].click();var r=_.keys(modelsHiddenParams[t].legends)[0];return l.showLegend(r),l.currentBaseLayer=r,void document.removeEventListener("play-tab-loaded",l.goToFirstRadioButton)}}},this.updateValue=function(e){modelsHiddenParams[t].selectedGeoJson&&(modelsHiddenParams[t].selectedGeoJson.features?modelsHiddenParams[t].selectedGeoJson.features.push(e):modelsHiddenParams[t].selectedGeoJson={type:"FeatureCollection",features:[e]},l.selectedGeoJson.updateCallback(l.selectedGeoJson,l.selectedGeoJson.getValue()))},this.getGeoJsonPoint=function(e,a){var t=[];if("polygon"!==e.geometry.type&&"Polygon"!==e.geometry.type||!e.geometry.isCut){if("LineString"===e.geometry.type||"lineString"===e.geometry.type){for(var r=0;r<a._latlngs.length;r++){var o=a._latlngs[r];t.push([o.lng,o.lat])}return t}if("polygon"!==e.geometry.type&&"Polygon"!==e.geometry.type||e.geometry.isCut)return"Point"===e.geometry.type||"point"===e.geometry.type?t=[a._latlng.lng,a._latlng.lat]:[];var s=a._latlngs?a._latlngs[0]:a.pm._layers[0]._latlngs[0];for(r=0;r<s.length;r++){o=s[r];t.push([o.lng,o.lat])}return[t]}return(s=a._latlngs?a._latlngs:a.pm._layers[0]._latlngs).forEach((function(e){for(var a=[],r=0;r<e.length;r++)a.push([e[r].lng,e[r].lat]);t.push(a)})),t},this.getGeoJsonPoint1=function(e,a,t){var r=[],o=[];"rectangle"===e||"Polygon"===e&&t||"polygon"===e||"Polygon"===e&&!t?r=a[0]:"LineString"===e?r=a:"Point"===e&&(r=[],o=[a[1],a[0]]);for(var s=0;s<r.length;s++)o.push([r[s][1],r[s][0]]);return o},this.getLayerInformation=function(e){var a={title:"",description:"",timeStamp:""};if(modelsHiddenParams[t].selectedGeoJson){for(var r=0;r<modelsHiddenParams[t].selectedGeoJson.features.length;r++)modelsHiddenParams[t].selectedGeoJson.features[r].properties.layerId==e&&modelsHiddenParams[t].selectedGeoJson.features[r].properties.information&&(a.title=modelsHiddenParams[t].selectedGeoJson.features[r].properties.information.title,a.description=modelsHiddenParams[t].selectedGeoJson.features[r].properties.information.description,a.timeStamp=modelsHiddenParams[t].selectedGeoJson.features[r].properties.information.timeStamp);l.selectedGeoJson.updateCallback(l.selectedGeoJson,l.selectedGeoJson.getValue())}return a},this.updateLayerInformation=function(e,a){if(modelsHiddenParams[t].selectedGeoJson){for(var r=0;r<modelsHiddenParams[t].selectedGeoJson.features.length;r++)modelsHiddenParams[t].selectedGeoJson.features[r].properties.layerId==e&&(modelsHiddenParams[t].selectedGeoJson.features[r].properties.information=a);l.selectedGeoJson.updateCallback(l.selectedGeoJson,l.selectedGeoJson.getValue())}},this.editList=function(e){if(modelsHiddenParams[t].selectedGeoJson){for(var a=e.map._layers,r=Object.keys(a),o=0;o<r.length;o++)for(var s=0;s<modelsHiddenParams[t].selectedGeoJson.features.length;s++)if(modelsHiddenParams[t].selectedGeoJson.features[s].properties.layerId==a[r[o]]._leaflet_id){var n=l.getGeoJsonPoint(modelsHiddenParams[t].selectedGeoJson.features[s],a[r[o]]);modelsHiddenParams[t].selectedGeoJson.features[s].geometry.coordinates=n}l.selectedGeoJson.updateCallback(l.selectedGeoJson,l.selectedGeoJson.getValue())}},this.rotateLayer=function(e){var a=e.layer._drawnByGeoman?e.layer._leaflet_id:e.layer.feature.properties.layerId;if(modelsHiddenParams[t].selectedGeoJson){for(var r=0;r<modelsHiddenParams[t].selectedGeoJson.features.length;r++)if(modelsHiddenParams[t].selectedGeoJson.features[r].properties.layerId==a){var o=l.getGeoJsonPoint(modelsHiddenParams[t].selectedGeoJson.features[r],e.layer);modelsHiddenParams[t].selectedGeoJson.features[r].geometry.coordinates=o}l.selectedGeoJson.updateCallback(l.selectedGeoJson,l.selectedGeoJson.getValue())}},this.deleteLayer=function(e){var a=e.layer._drawnByGeoman?e.layer._leaflet_id:e.layer.feature.properties.layerId;if(modelsHiddenParams[t].selectedGeoJson){for(var r=0;r<modelsHiddenParams[t].selectedGeoJson.features.length;r++)modelsHiddenParams[t].selectedGeoJson.features[r].properties.layerId==a&&modelsHiddenParams[t].selectedGeoJson.features.splice(r,1);l.selectedGeoJson.updateCallback(l.selectedGeoJson,l.selectedGeoJson.getValue())}},s&&(this.selectedPoint={updateCallback:function(){},getValue:function(){return modelsHiddenParams[t].selectedPoint},setValue:function(e){},addValueChangedHandler:function(e){this.updateCallback=e},removeValueChangedHandler:function(e){},setCaption:function(e){},clearCaption:function(){}}),o&&(this.selectedGeoJson={updateCallback:function(){},getValue:function(){return modelsHiddenParams[t].selectedGeoJson},setValue:function(e){modelsHiddenParams[t].selectedGeoJson=e},addValueChangedHandler:function(e){"None"!==widgetConnector.widgetsConnection[t].sliders.selectedGeoJson.dataNode&&(this.updateCallback=e,l.addDrawingFeatures())},removeValueChangedHandler:function(e){},setCaption:function(e){},clearCaption:function(){}}),this.modal=function(e){if(modelsParameters[t].drawingFeaturesOptions.modal){var a=l.getLayerInformation(e.leafletId),r=['<div class="modal-header"><h4>{title} </h4></div>','<h5 class="pull-left" style="padding-left: 10px"><a>Please add a title and a short description</a></h5>','<div class="modal-body">','<div class="row">{content}</div>',"</div>",'<div class="modal-footer">','<input id="dialog-ok" type="submit" class="bouton {OK_CLS}" value="Ok">','<input id="dialog-ok" type="submit" class="bouton  {CANCEL_CLS}" value="Cancel">',"</div>"].join(""),o=["<table>","<body>","<tr>",'<td style="width: 40%;padding-top: 20px;">Title</td>','<td style="width: 60%;padding-top: 20px;">','<textarea type="text" class="form-control"  style="width:190px;max-width: 200px ;max-height: 40px  ;color: #34495e" rows="1" id="modalInput1"  placeholder="Enter title">',a.title,"</textarea>","</td>","</tr>","<tr>",'<td style="width: 30%;padding-top: 20px;">Description</td>','<td style="width: 70%;padding-top: 20px;">','<textarea type="text" class="form-control"  style="width:190px;max-width: 200px ;max-height: 70px  ;color: #34495e" rows="2" id="modalInput2"  placeholder="Enter Description">',a.description,"</textarea>","</td>","</tr>","</body>","</table>"].join("");e.type,l.map.openModal({leafletId:e.leafletId||"NA",content:o,template:r,okText:"Ok",title:a.title,description:a.description,cancelText:"Cancel",OK_CLS:"modal-ok",CANCEL_CLS:"modal-cancel",MODAL_CONTENT_CLS:"modal-content modal-content-black",width:350,onShow:function(a){var t=a.modal;L.DomEvent.on(t._container.querySelector(".modal-ok"),"click",(function(){e.title=document.getElementById("modalInput1").value,e.description=document.getElementById("modalInput2").value;var a=new Date;e.timeStamp=a.toISOString(),l.updateLayerInformation(e.leafletId,e),t.hide()})).on(t._container.querySelector(".modal-cancel"),"click",(function(){t.hide()}))}})}},this.addDrawingFeatures=function(){var e=new L.FeatureGroup;if(l.map.addLayer(e),this.bIsInteractive){if(modelsHiddenParams[t].selectedGeoJson)if(modelsHiddenParams[t].selectedGeoJson.features){for(var a=0;a<modelsHiddenParams[t].selectedGeoJson.features.length;a++){var r=l.getGeoJsonPoint1(modelsHiddenParams[t].selectedGeoJson.features[a].geometry.type,modelsHiddenParams[t].selectedGeoJson.features[a].geometry.coordinates,modelsHiddenParams[t].selectedGeoJson.features[a].geometry.isRectangle),o=null;"LineString"===modelsHiddenParams[t].selectedGeoJson.features[a].geometry.type?o=L.polyline(r):"Point"===modelsHiddenParams[t].selectedGeoJson.features[a].geometry.type?o=L.marker(r):"Polygon"===modelsHiddenParams[t].selectedGeoJson.features[a].geometry.type&&(o=(modelsHiddenParams[t].selectedGeoJson.features[a].geometry.isRectangle,L.geoJSON(modelsHiddenParams[t].selectedGeoJson.features[a],{}))),o&&(o.on("click",(function(e){console.log("click pol leaflet_id",e.target._leaflet_id),l.modal({leafletId:e.target._leaflet_id})})),e.addLayer(o),modelsHiddenParams[t].selectedGeoJson.features[a].properties.layerId=o._leaflet_id)}l.selectedGeoJson.updateCallback(l.selectedGeoJson,l.selectedGeoJson.getValue())}else modelsHiddenParams[t].selectedGeoJson.type="FeatureCollection",modelsHiddenParams[t].selectedGeoJson.features=[],l.selectedGeoJson.updateCallback(l.selectedGeoJson,l.selectedGeoJson.getValue());else modelsHiddenParams[t].selectedGeoJson={type:"FeatureCollection",features:[]},l.selectedGeoJson.updateCallback(l.selectedGeoJson,l.selectedGeoJson.getValue());l.map.on("pm:globaleditmodetoggled",(function(e){console.log("pm:globaleditmodetoggled",e),l.editList(e)})),l.map.on("pm:globaldragmodetoggled",(function(e){console.log("pm:globaldragmodetoggled",e),l.editList(e)})),l.map.on("pm:rotateend",(function(e){console.log("pm:rotateend",e),l.rotateLayer(e)})),l.map.on("pm:remove",(function(e){console.log("pm:remove",e),l.deleteLayer(e)})),l.map.on("pm:cut",(function(e){console.log("pm:cut",e);for(var a=e.originalLayer._drawnByGeoman?e.originalLayer._leaflet_id:e.originalLayer.feature.properties.layerId,r=0;r<modelsHiddenParams[t].selectedGeoJson.features.length;r++)modelsHiddenParams[t].selectedGeoJson.features[r].properties.layerId==a&&(modelsHiddenParams[t].selectedGeoJson.features[r].properties.layerId=e.layer._leaflet_id,modelsHiddenParams[t].selectedGeoJson.features[r].geometry.coordinates=e.layer.feature.geometry.coordinates,modelsHiddenParams[t].selectedGeoJson.features[r].geometry.isCut=!0);l.selectedGeoJson.updateCallback(l.selectedGeoJson,l.selectedGeoJson.getValue())})),l.map.on("pm:create",(a=>{console.log("pm:create",a),e.addLayer(a.layer);var r=[];if(modelsHiddenParams[t].selectedGeoJson)if("Polygon"==a.shape){for(var o=0;o<a.layer._latlngs[0].length;o++){var s=a.layer._latlngs[0][o];r.push([s.lng,s.lat])}l.updateValue({type:"Feature",geometry:{type:"Polygon",coordinates:[r],isRectangle:!1,isCut:!1},properties:{layerId:a.layer._leaflet_id}})}else if("Line"==a.shape){for(o=0;o<a.layer._latlngs.length;o++){s=a.layer._latlngs[o];r.push([s.lng,s.lat])}l.updateValue({type:"Feature",geometry:{type:"LineString",coordinates:r},properties:{layerId:a.layer._leaflet_id}})}else if("Rectangle"==a.shape){for(o=0;o<a.layer._latlngs[0].length;o++){s=a.layer._latlngs[0][o];r.push([s.lng,s.lat])}l.updateValue({type:"Feature",geometry:{type:"Polygon",coordinates:[r],isRectangle:!0,isCut:!1},properties:{layerId:a.layer._leaflet_id}})}else"Marker"==a.shape&&(r=[a.layer._latlng.lng,a.layer._latlng.lat],l.updateValue({type:"Feature",geometry:{type:"Point",coordinates:r},properties:{layerId:a.layer._leaflet_id}}))}))}else modelsHiddenParams[t].selectedGeoJson={type:"FeatureCollection",features:[]},l.selectedGeoJson.updateCallback(l.selectedGeoJson,l.selectedGeoJson.getValue())},this.render=function(){var r=document.createElement("div");r.setAttribute("id","openStreetMap"+a),r.setAttribute("style","width: inherit; height: inherit"),document.addEventListener("play-tab-loaded",l.goToFirstRadioButton),$("#"+e).html(r),l.map=L.map("openStreetMap"+a,{preferCanvas:!0}).setView([modelsParameters[t].defaultCenter.latitude,modelsParameters[t].defaultCenter.longitude],modelsParameters[t].defaultCenter.zoom),modelsTempParams[t].mapObj=l.map,s&&this.bIsInteractive&&l.map.on("click",(function(e){modelsHiddenParams[t].selectedPoint,modelsHiddenParams[t].selectedPoint={lat:e.latlng.lat,lag:e.latlng.lng},l.selectedPoint.updateCallback(l.selectedPoint,l.selectedPoint.getValue())})),this.bIsInteractive||(l.map.dragging.disable(),l.map.touchZoom.disable(),l.map.doubleClickZoom.disable(),l.map.scrollWheelZoom.disable(),l.map.boxZoom.disable(),l.map.keyboard.disable());var n={};n.MapboxStreets={url:"https://xdashgateway.azure-api.net/mapbox/tiles?z={z}&x={x}&y={y}",attribution:'Imagery © <a href="http://mapbox.com">Mapbox</a>',maxZoom:18,id:"streets-v11",tileSize:512,zoomOffset:-1},n.MapboxDark={url:"https://xdashgateway.azure-api.net/mapbox/tilesgeneral?z={z}&x={x}&y={y}&id={id}",attribution:'Imagery © <a href="http://mapbox.com">Mapbox</a>',maxZoom:18,id:"dark-v10",tileSize:512,zoomOffset:-1},n.HereSatelliteDay={url:"https://xdashgateway.azure-api.net/here{s}/maptile?z={z}&x={x}&y={y}&lg=eng",attribution:'Map &copy; 1987-2014 <a href="http://developer.here.com">HERE</a>',id:" satellite.day",maxZoom:20,subdomains:"1234"},n.HereTerrainDay={url:"https://xdashgateway.azure-api.net/here{s}/maptile?z={z}&x={x}&y={y}&lg=eng",attribution:'Map &copy; 1987-2014 <a href="http://developer.here.com">HERE</a>',id:"terrain.day",maxZoom:20,subdomains:"1234"},n.HereHybridDay={url:"https://xdashgateway.azure-api.net/here{s}/maptile?z={z}&x={x}&y={y}&lg=eng",attribution:'Map &copy; 1987-2014 <a href="http://developer.here.com">HERE</a>',id:" HERE.hybridDay",maxZoom:20,subdomains:"1234"},"true"!=xDashConfig.xDashBasicVersion&&(n.EsriWorldImagery={url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",attribution:"Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community",id:"Esri.WorldImagery",maxZoom:19},n["GeoportailFrance.orthos"]={url:"https://wxs.ign.fr/{apikey}/geoportail/wmts?REQUEST=GetTile&SERVICE=WMTS&VERSION=1.0.0&STYLE={style}&TILEMATRIXSET=PM&FORMAT={format}&LAYER=ORTHOIMAGERY.ORTHOPHOTOS&TILEMATRIX={z}&TILEROW={y}&TILECOL={x}",attribution:'<a target="_blank" href="https://www.geoportail.gouv.fr/">Geoportail France</a>',minZoom:2,maxZoom:19,apikey:"choisirgeoportail",format:"image/jpeg",style:"normal"});var d="MapboxStreets";_.isUndefined(modelsParameters[t].tileServer)||_.contains(_.keys(n),modelsParameters[t].tileServer)&&(d=modelsParameters[t].tileServer);var m={url:n[d].url,maxZoom:n[d].maxZoom,attribution:'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, '+n[d].attribution};if(_.isUndefined(n[d].subdomains)||(m.subdomains=n[d].subdomains),_.isUndefined(n[d].id)||(m.id=n[d].id),_.isUndefined(n[d].apikey)||(m.apikey=n[d].apikey),_.isUndefined(n[d].format)||(m.format=n[d].format),_.isUndefined(n[d].style)||(m.style=n[d].style),_.isUndefined(n[d].tileSize)||(m.tileSize=n[d].tileSize),_.isUndefined(n[d].zoomOffset)||(m.zoomOffset=n[d].zoomOffset),_.isUndefined(n[d].accessToken)||(m.accessToken=n[d].accessToken),modelsParameters[t].offlineSupport){m.attribution='Progress: <span id="leafletProgress'+a+'"></span> / <span id="leafletTotal'+a+'"></span>. Current storage: <span id="leafletStorage'+a+'"></span> files.Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, '+n[d].attribution,l.baseLayer=L.tileLayer.offline(n[d].url,m),l.baseLayer.addTo(l.map);var p=[];if(modelsParameters[t].defaultCenter.zoom<=n[d].maxZoom)for(var y=0;y<n[d].maxZoom-modelsParameters[t].defaultCenter.zoom;y++)p[y]=modelsParameters[t].defaultCenter.zoom+y;else p=modelsParameters[t].defaultCenter.zoom;var c,g=L.control.savetiles(l.baseLayer,{zoomlevels:p,confirm:function(e,a){window.confirm("Save "+e._tilesforSave.length)&&a()},confirmRemoval:function(e,a){window.confirm("Remove all the tiles?")&&a()},saveText:'<i class="icon-download-alt icon" aria-hidden="true"></i>',rmText:'<i class="icon-trash icon" aria-hidden="true"></i>'});g.addTo(l.map),l.baseLayer.on("storagesize",(function(e){document.getElementById("leafletStorage"+a).innerHTML=e.storagesize})),g.setPosition("topright"),l.baseLayer.on("savestart",(function(e){c=0,document.getElementById("leafletTotal"+a).innerHTML=e._tilesforSave.length})),l.baseLayer.on("savetileend",(function(e){c++,document.getElementById("leafletProgress"+ +a).innerHTML=c})),l.baseLayer.on("loadend",(function(e){swal("","Saved all tiles","info")})),l.baseLayer.on("tilesremoved",(function(e){document.getElementById("leafletProgress"+ +a).innerHTML="",document.getElementById("leafletTotal"+a).innerHTML="",swal("","Removed all tiles","info")}))}else l.baseLayer=L.tileLayer(n[d].url,m),l.baseLayer.addTo(l.map);L.control.scale().addTo(l.map),l.map.zoomControl.setPosition("topright"),l.ctrl=L.control.layers({},{},{position:"topright",collapsed:!0,autoZIndex:!0}).addTo(l.map),o&&l.map.pm.addControls(i);try{for(y=0;y<l.numberOfGeoJsonLayers;y++)_.isUndefined(modelsHiddenParams[t].geoJson.geoJsonLayers[y])||_.isUndefined(modelsHiddenParams[t].geoJson.geoJsonLayers[y])||l.addGeoJson(modelsHiddenParams[t].geoJson.geoJsonLayers[y],y+1);for(y=0;y<l.numberOfChoroplethLayers;y++)_.isUndefined(modelsHiddenParams[t].choropleth.choroplethLayers[y])||_.isUndefined(modelsHiddenParams[t].choropleth.choroplethLayers[y])||l.addChoropleth(modelsHiddenParams[t].choropleth.choroplethLayers[y],y+1);for(y=0;y<l.numberOfLineHeatMapLayers;y++)_.isUndefined(modelsHiddenParams[t].lineHeatMap.lineHeatMapLayers[y])||_.isUndefined(modelsHiddenParams[t].lineHeatMap.lineHeatMapLayers[y])||l.addLineHeatMap(modelsHiddenParams[t].lineHeatMap.lineHeatMapLayers[y],y+1);for(y=0;y<l.numberOfHeatMapLayers;y++)modelsHiddenParams[t].heatMap.heatMapBuffer[y]=[],_.isUndefined(modelsHiddenParams[t].heatMap.heatMapData[y])||_.isUndefined(modelsHiddenParams[t].heatMap.heatMapData[y])||l.drawHeatMap(modelsHiddenParams[t].heatMap.heatMapData[y],y+1);for(y=0;y<l.numberOfImageLayers;y++)_.isUndefined(modelsHiddenParams[t].imageOverlay.imageData[y])||_.isUndefined(modelsHiddenParams[t].imageOverlay.imageData[y])||l.addImageOverlay(modelsHiddenParams[t].imageOverlay.imageData[y],y+1);for(y=0;y<l.numberOfSvgLayers;y++)_.isUndefined(modelsHiddenParams[t].svgOverlay.svgData[y])||_.isUndefined(modelsHiddenParams[t].svgOverlay.svgData[y])||l.addSvgOverlay(modelsHiddenParams[t].svgOverlay.svgData[y],y+1,!1)}catch(e){console.error(e)}l.map.on("baselayerchange",(function(e){l.showLegend(e.name),l.currentBaseLayer=e.name}))},this.showLegend=function(e){var a=_.keys(modelsHiddenParams[t].legends);if(_.has(modelsHiddenParams[t].legends,e)){var r=_.without(a,e);_.each(r,(function(e){l.map.removeControl(modelsHiddenParams[t].legends[e])})),modelsHiddenParams[t].legends[e].addTo(l.map),o&&(l.map.pm.removeControls(),l.map.pm.addControls(i))}},this.rescale=function(){try{l.map.invalidateSize()}catch(e){console.log(e.message)}},this.addGeoJson=function(e,a){if(modelsHiddenParams[t].geoJson.geoJsonBounds[a-1]=null,!(_.isUndefined(e)||(_.isEmpty(l.mapLayers.geoJson.geoJsonLayers[a-1])||(l.ctrl.removeLayer(l.mapLayers.geoJson.geoJsonLayers[a-1]),l.map.removeLayer(l.mapLayers.geoJson.geoJsonLayers[a-1])),_.isEmpty(e)||e=={}||_.isUndefined(e.features)||_.isEmpty(e.features)))){var r="Trace"+a;_.isUndefined(e.properties)||_.isUndefined(e.properties.description)||(r=e.properties.description);var o={color:modelsHiddenParams[t].colors[a-1],weight:4,opacity:1},s=L.geoJSON(e,{style:function(e){return _.isUndefined(e.properties)?o:(_.isUndefined(e.properties.description)||(r=e.properties.description),_.isUndefined(e.properties.style)?o:e.properties.style)},onEachFeature:function(e,a){if("Point"==e.geometry.type&&e.properties)if(e.properties.comment)if(e.properties.openPopup){a.bindPopup(e.properties.comment,{autoClose:!1,autoPan:!1}).on("add",(function(e){e.target.openPopup()}))}else a.bindPopup(e.properties.comment);else if(e.properties.html)e.properties.openPopup?(mk=a.bindPopup(e.properties.html,{autoClose:!1,autoPan:!1}),mk.on("add",(function(e){e.target.openPopup()}))):a.bindPopup(e.properties.html);else{var t=jQuery.extend(!0,{},e.properties);t.awesomeMarker&&delete t.awesomeMarker,e.properties.openPopup?(mk=a.bindPopup(syntaxHighlight(JSON.stringify(t)),{autoClose:!1,autoPan:!1}),mk.on("add",(function(e){e.target.openPopup()}))):a.bindPopup(syntaxHighlight(JSON.stringify(t)))}},pointToLayer:function(e,a){if("Point"==e.geometry.type){if(e.properties&&e.properties.awesomeMarker){var t=L.AwesomeMarkers.icon(e.properties.awesomeMarker);return L.marker(a,{icon:t})}return L.marker(a)}}});if(n){var i=L.markerClusterGroup();i.addLayer(s),l.mapLayers.geoJson.geoJsonLayers[a-1]=i}else l.mapLayers.geoJson.geoJsonLayers[a-1]=s;l.map.addLayer(l.mapLayers.geoJson.geoJsonLayers[a-1]),l.ctrl.addOverlay(l.mapLayers.geoJson.geoJsonLayers[a-1],r);try{var d=geojsonExtent(e),m=L.latLng(d[1],d[0]),p=L.latLng(d[3],d[2]),y=L.latLngBounds(m,p);modelsHiddenParams[t].geoJson.geoJsonBounds[a-1]=y;var c=!1;_.isUndefined(e.properties)||_.isUndefined(e.properties.disableAutoscale)||(c=e.properties.disableAutoscale),c||l.map.fitBounds(l.globalLayersBounds())}catch(e){console.log(e)}}},this.addChoropleth=function(e,a){if(_.isUndefined(e))return;if(_.isEmpty(e))return;if(e=={})return;var r=l.convertToChoroplethObject(e);if(modelsHiddenParams[t].choropleth.choroplethBounds[a-1]=null,_.isEmpty(l.mapLayers.choropleth.choroplethLayers[a-1])||(l.ctrl.removeLayer(l.mapLayers.choropleth.choroplethLayers[a-1]),l.map.removeLayer(l.mapLayers.choropleth.choroplethLayers[a-1])),_.isUndefined(r.features))return;if(_.isEmpty(r.features))return;var o=_.without(_.keys(e.data[0]),"geometry")[0];_.isUndefined(r.properties)||_.isUndefined(r.properties.description)||(o=r.properties.description);var s=_.max(_.pluck(e.data,o)),n=_.min(_.pluck(e.data,o)),i=4,d=.7;let p;try{_.isUndefined(e.config.max)||(s=e.config.max),_.isUndefined(e.config.min)||(n=e.config.min),_.isUndefined(e.config.weight)||(i=e.config.weight),_.isUndefined(e.config.opacity)||(d=e.config.opacity),p=l.getColorScale(e.config.colorScale,e.config.reverseColorScale,0,1)}catch(e){}l.createChoroplethLegend(n,s,o,p),l.showLegend(o),l.mapLayers.choropleth.choroplethLayers[a-1]=L.geoJSON(r,{style:function(e){return{weight:i,opacity:d,color:"white",dashArray:"3",fillOpacity:d,fillColor:m(n,s,e.properties.density,p)}}}).addTo(l.map),l.ctrl.addBaseLayer(l.mapLayers.choropleth.choroplethLayers[a-1],o);var y=!1;try{y=e.config.disableAutoscale}catch(e){}try{if(!y){var c=geojsonExtent(r),g=L.latLng(c[1],c[0]),u=L.latLng(c[3],c[2]),f=L.latLngBounds(g,u);modelsHiddenParams[t].choropleth.choroplethBounds[a-1]=f,l.map.fitBounds(f)}}catch(e){console.log(e)}},this.convertToChoroplethObject=function(e){let a=[];const t=e.data;if(t.length){const e=_.without(_.keys(t[0]),"geometry")[0];a=t.map(((a,t)=>({type:"Feature",id:t,properties:{},geometry:a.geometry,properties:{density:a[e]}})))}return{type:"FeatureCollection",features:a}},this.createChoroplethLegend=function(e,a,r,o){_.isUndefined(modelsHiddenParams[t].legends[r])||l.map.removeControl(modelsHiddenParams[t].legends[r]),modelsHiddenParams[t].legends[r]=L.control({position:"topright"}),modelsHiddenParams[t].legends[r].onAdd=function(t){for(var r,s,n=(a-e)/8,i=L.DomUtil.create("div","info legend"),l=[e,e+n,e+2*n,e+3*n,e+4*n,e+5*n,e+6*n,a],d=[],p=0;p<l.length;p++)r=l[p],s=l[p+1],d.push('<i style="background:'+m(e,a,r+1,o)+'"></i> <span>'+d3.format("~s")(r)+(s?"&ndash;"+d3.format("~s")(s):"+")+"</span>");return i.innerHTML=d.join("<br>"),i}},this.convertToGeoJSONObject=function(e){var a=[],t="";return _.each(e.data,(function(r){var o=Object.keys(r);_.each(o,(function(e){"coordinates"!=e&&(t=e)}));var s,n,i,d={type:"Feature",geometry:{type:"LineString",coordinates:r.coordinates},properties:{style:{color:l.getColorScale(e.config.colorScale,e.config.reverseColorScale,0,100)((s=r[t],n=e.config.min,i=100*(s-n)/(e.config.max-n),i>100&&(i=100),i<0&&(i=0),i)),weight:e.config.weight,opacity:e.config.opacity}}};a.push(d)})),{type:"FeatureCollection",features:a,properties:{description:t}}},this.addLineHeatMap=function(e,a){if(!_.isUndefined(e)&&!_.isEmpty(e)&&e!={}){var r=l.convertToGeoJSONObject(e);if(modelsHiddenParams[t].lineHeatMap.lineHeatMapBounds[a-1]=null,_.isEmpty(l.mapLayers.lineHeatMap.lineHeatMapLayers[a-1])||(l.ctrl.removeLayer(l.mapLayers.lineHeatMap.lineHeatMapLayers[a-1]),l.map.removeLayer(l.mapLayers.lineHeatMap.lineHeatMapLayers[a-1])),!_.isUndefined(r.features)&&!_.isEmpty(r.features)){var o="Trace"+a;_.isUndefined(r.properties)||_.isUndefined(r.properties.description)||(o=r.properties.description);var s={color:modelsHiddenParams[t].colors[a-1],weight:4,opacity:1},n=_.max(_.pluck(e.data,o)),i=_.min(_.pluck(e.data,o));try{_.isUndefined(e.config.max)||(n=e.config.max),_.isUndefined(e.config.min)||(i=e.config.min)}catch(e){}var m=l.getColorScale(e.config.colorScale,e.config.reverseColorScale,0,100);l.createLegend(m,100,d,i,n,o),l.showLegend(o),l.mapLayers.lineHeatMap.lineHeatMapLayers[a-1]=L.geoJSON(r,{style:function(e){return _.isUndefined(e.properties)?s:(_.isUndefined(e.properties.description)||(o=e.properties.description),_.isUndefined(e.properties.style)?s:e.properties.style)},onEachFeature:function(e,a){"Point"==e.geometry.type&&e.properties&&a.bindPopup(syntaxHighlight(JSON.stringify(e.properties)))}}).addTo(l.map),l.ctrl.addBaseLayer(l.mapLayers.lineHeatMap.lineHeatMapLayers[a-1],o);var p=!1;try{p=e.config.disableAutoscale}catch(e){}if(!p)try{var y=geojsonExtent(r),c=L.latLng(y[1],y[0]),g=L.latLng(y[3],y[2]),u=L.latLngBounds(c,g);modelsHiddenParams[t].lineHeatMap.lineHeatMapBounds[a-1]=u,l.map.fitBounds(l.globalLayersLineHeatBounds())}catch(e){console.log(e)}}}},this.addImageOverlay=function(e,a){if(_.isUndefined(e))return;if(_.isEmpty(e))return;if(e=={})return;const t=e.imageUrl,r=e.imageBounds,o=e.title,s=e.addAs,n=e.options;_.isEmpty(l.mapLayers.imageOverlay.imageLayers[a-1])||(l.ctrl.removeLayer(l.mapLayers.imageOverlay.imageLayers[a-1]),l.map.removeLayer(l.mapLayers.imageOverlay.imageLayers[a-1])),l.mapLayers.imageOverlay.imageLayers[a-1]=L.imageOverlay(t,r,n).addTo(l.map),"overlay"==s?l.ctrl.addOverlay(l.mapLayers.imageOverlay.imageLayers[a-1],o):l.ctrl.addBaseLayer(l.mapLayers.imageOverlay.imageLayers[a-1],o)},this.globalLayersBounds=function(){for(var e=L.latLngBounds(l.map.getCenter()),a=0;a<l.numberOfGeoJsonLayers;a++)null!=modelsHiddenParams[t].geoJson.geoJsonBounds[a]&&e.extend(modelsHiddenParams[t].geoJson.geoJsonBounds[a]);return e},this.globalLayersLineHeatBounds=function(){for(var e=L.latLngBounds(l.map.getCenter()),a=0;a<l.numberOfLineHeatMapLayers;a++)null!=modelsHiddenParams[t].lineHeatMap.lineHeatMapBounds[a]&&e.extend(modelsHiddenParams[t].lineHeatMap.lineHeatMapBounds[a]);return e},this.createSvgOverlay=function(e,a){var t=l.createOneCircle,r=e.config.marker;switch(r){case"arrow":t=l.createOneArrow;break;case"triangle":case"emptyTriangle":case"fullTriangle":t=l.createOneTriangle;break;default:r="circle",t=l.createOneCircle}return l.createObjectsOverlay(e,a,r,t)},this.appendSvgOverlay=function(e,a){if("arrow"===e.config.marker)return l.appendArrowsOverlay(e,a)},this.appendArrowsOverlay=function(e,a){var r=e.data[0],o=L.latLng([r.lat,r.lng]),s=l.map.latLngToLayerPoint(o).x,n=l.map.latLngToLayerPoint(o).y,i=0,d="black";_.isUndefined(r.direction)||(i=r.direction),_.isUndefined(r.rotation)||(i=r.rotation),_.isUndefined(r.color)||(d=r.color);var m=l.createOneArrow(s,n,i,modelsHiddenParams[t].svgOverlay.svgElements[a-1].reductionFactor,modelsHiddenParams[t].svgOverlay.svgElements[a-1].lengthInPx,d);modelsHiddenParams[t].svgOverlay.svgElements[a-1].SVG.innerHTML=modelsHiddenParams[t].svgOverlay.svgElements[a-1].SVG.innerHTML+m},this.createObjectsOverlay=function(e,a,r,o){modelsHiddenParams[t].svgOverlay.svgElements[a-1]={},modelsHiddenParams[t].svgOverlay.svgElements[a-1].currentZoom=l.map.getZoom(),[modelsHiddenParams[t].svgOverlay.svgElements[a-1].reductionFactor,modelsHiddenParams[t].svgOverlay.svgElements[a-1].lengthInPx]=l.computeDimensions(e);var s="",n=e.config.color||"#000";e.data.forEach((function(e){var i=L.latLng([e.lat,e.lng]),d=0;_.isUndefined(e.direction)||(d=e.direction),_.isUndefined(e.rotation)||(d=e.rotation);var m=l.map.latLngToContainerPoint(i).x,p=l.map.latLngToContainerPoint(i).y;s+=o(m,p,d,modelsHiddenParams[t].svgOverlay.svgElements[a-1].reductionFactor,modelsHiddenParams[t].svgOverlay.svgElements[a-1].lengthInPx,r,n)}));var i=document.createElementNS("http://www.w3.org/2000/svg","svg");i.setAttribute("xmlns","http://www.w3.org/2000/svg");var d="0 0 "+l.map.getSize().x+" "+l.map.getSize().y;return i.setAttribute("viewBox",d),modelsHiddenParams[t].svgOverlay.svgElements[a-1].SVG=i,modelsHiddenParams[t].svgOverlay.svgElements[a-1].SVG.innerHTML=s,L.svgOverlay(modelsHiddenParams[t].svgOverlay.svgElements[a-1].SVG,l.map.getBounds())},this.computeDimensions=function(e){const a=e.config.length,t=l.map.getBounds(),r=t.getSouthWest(),o=t.getNorthEast(),s=l.map.latLngToContainerPoint(r).y-l.map.latLngToContainerPoint(o).y,n=L.latLng(o.lat,r.lng),i=a/l.map.distance(r,n);return[i,s*i]},this.autoscaleSvg=function(e){var a,t,r,o=[],s=[];_.isEmpty(e.data)||(e.data.forEach((function(e){o.push(e.lat),s.push(e.lng)})),o.length>1?(a=L.latLng(_.max(o),_.max(s)),t=L.latLng(_.min(o),_.min(s)),r=L.latLngBounds(a,t),l.map.fitBounds(r)):l.map.setView(L.latLng(o[0],s[0]),l.map.getZoom()))},this.createOneArrow=function(e,a,t,r,o,s){var n='<line x1="'+e+'" y1="'+a+'" x2="'+e+'" y2="'+(a-o)+'" stroke="#000" stroke-width="'+50*r+'" marker-end="url(#styledArrow)" ';return n=n+'transform="rotate('+t+" "+e+" "+a+')"  />'},this.createOneCircle=function(e,a,t,r,o){var s='<circle cx="'+e+'" cy="'+a+'" stroke="#000" r="'+50*r+'"';return s+="/>"},this.rotationPoint=function(e,a,t,r,o){var s=Math.PI/180*o,n=Math.cos(s),i=Math.sin(s);return[n*(t-e)+i*(r-a)+e,n*(r-a)-i*(t-e)+a]},this.getTrianglePoints=function(e,a,t){var r=e.y,o=e.x-0,s=e.y,n=e.x-a,i=e.y-a/2,d=e.x,m=e.y+a/2,p=e.x,y=l.rotationPoint(o,r,n,s,t),c=l.rotationPoint(o,r,d,i,t),g=l.rotationPoint(o,r,p,m,t);return y[1]+" "+y[0]+" "+c[1]+" "+c[0]+" "+g[1]+" "+g[0]},this.createOneTriangle=function(e,a,t,r,o,s,n){var i=l.getTrianglePoints({x:a,y:e},o,t),d='<polygon points="'+i+'"  style="fill:'+n+";stroke:"+n+";stroke-width:"+50*r+'"   />';return"emptyTriangle"==s&&(d='<polygon points="'+i+'"  fill="none" style="stroke:'+n+";stroke-width:"+50*r+'"   />'),d},this.addSvgOverlay=function(e,a,r){if(!_.isUndefined(e)&&!_.isEmpty(e)&&e!={}&&!_.isUndefined(e.data)){var o=e.config.title,s=e.config.addAs,n=e.config.disableAutoscale;if(!_.isUndefined(modelsHiddenParams[t].svgOverlay.svgElements[a-1])&&!_.isUndefined(modelsHiddenParams[t].svgOverlay.svgElements[a-1].currentZoom)){var i=l.map.getZoom();modelsHiddenParams[t].svgOverlay.svgElements[a-1].currentZoom!=i&&(r=!1)}r?l.appendSvgOverlay(e,a):(n||l.autoscaleSvg(e),_.isEmpty(l.mapLayers.svgOverlay.svgLayers[a-1])||(l.ctrl.removeLayer(l.mapLayers.svgOverlay.svgLayers[a-1]),l.map.removeLayer(l.mapLayers.svgOverlay.svgLayers[a-1])),l.mapLayers.svgOverlay.svgLayers[a-1]=L.layerGroup().addLayer(l.createSvgOverlay(e,a)).addTo(l.map),"overlay"==s?l.ctrl.addOverlay(l.mapLayers.svgOverlay.svgLayers[a-1],o):l.ctrl.addBaseLayer(l.mapLayers.svgOverlay.svgLayers[a-1],o))}},this.psetSvg=function(e,a){if(!_.isUndefined(e)&&!_.isEmpty(e)&&!_.isEmpty(e.data)){var t,r=e.data;t=_.isUndefined(e.config)?{data:[r]}:{data:[r],config:e.config},_.isEmpty(l.mapLayers.svgOverlay.svgLayers[a-1])?l.addSvgOverlay(t,a,!1):l.addSvgOverlay(t,a,!0)}},this.createLabelIcon=function(e,a){return L.divIcon({className:e,html:a})},this.drawHeatMap2=function(e,a){if(_.isEmpty(l.mapLayers.heatMap.heatMapLayers[a-1])||(l.ctrl.removeLayer(l.mapLayers.heatMap.heatMapLayers[a-1]),l.map.removeLayer(l.mapLayers.heatMap.heatMapLayers[a-1]),l.mapLayers.heatMap.heatMapLayers[a-1].remove(),delete l.mapLayers.heatMap.heatMapLayers[a-1]),_.isUndefined(e))return;if(_.isEmpty(e))return;if(_.isUndefined(e.data))return;if(heatMapData=e.data,_.isEmpty(heatMapData)||0==heatMapData.length){var t=L.layerGroup([]);return l.mapLayers.heatMap.heatMapLayers[a-1]=t.addTo(l.map),l.ctrl.addBaseLayer(l.mapLayers.heatMap.heatMapLayers[a-1],"none"),void(_.isUndefined($("input[name='leaflet-base-layers']")[l.numberOfHeatMapLayers-1])||$("input[name='leaflet-base-layers']")[l.numberOfHeatMapLayers-1].click())}let r,o,s,n=.8,i=5,m=!1,p=!1;try{heatMapConfig=e.config,n=heatMapConfig.opacity||n,i=heatMapConfig.radius||i,r=heatMapConfig.max,o=heatMapConfig.min,m=heatMapConfig.disableAutoscale,p=heatMapConfig.addTextLabel,s=l.getColorScale(heatMapConfig.colorScale,heatMapConfig.reverseColorScale,0,100)}catch(e){}const y=[];let c=-Number.MAX_VALUE,g=Number.MAX_VALUE;const u=[],f=[],h=[],M=_.keys(heatMapData[0])[2];for(var H=0;H<heatMapData.length;H++)y[H]=_.values(heatMapData[H]),u[H]=y[H][0],f[H]=y[H][1],null!==y[H][2]&&(y[H][2]>c&&(c=y[H][2]),y[H][2]<g&&(g=y[H][2]));for(_.isUndefined(r)&&(r=1==heatMapData.length?1:c),_.isUndefined(o)&&(o=1==heatMapData.length?0:g),H=0;H<heatMapData.length;H++)null!==y[H][2]&&(y[H][2]>r?h[H]=100:y[H][2]<o?h[H]=0:h[H]=100*(y[H][2]-o)/(r-o));var O=[],v="#000000";for(H=0;H<y.length;H++)v=null!==h[H]?s(h[H]):"#000000",O.push(L.circle([u[H],f[H]],{stroke:!1,color:v,fillColor:v,fillOpacity:n,radius:i,stroke:!1})),p&&O.push(L.marker(new L.LatLng(u[H],f[H]),{icon:l.createLabelIcon("boldWhiteHeatMapLabel",nFormatter(y[H][2]))}));l.configStore[a-1]={color:s,fillOpacity:n,radius:i,minValue:o,maxValue:r};t=L.layerGroup(O);if(l.mapLayers.heatMap.heatMapLayers[a-1]=t.addTo(l.map),l.ctrl.addBaseLayer(l.mapLayers.heatMap.heatMapLayers[a-1],M),!m){var P=L.latLng(_.max(u),_.max(f)),E=L.latLng(_.min(u),_.min(f)),b=L.latLngBounds(P,E);l.map.fitBounds(b)}l.map.invalidateSize(),l.createLegend(s,100,d,o,r,M),l.showLegend(M),_.isUndefined($("input[name*='leaflet-base-layers']")[l.numberOfHeatMapLayers-1])||$("input[name*='leaflet-base-layers']")[l.numberOfHeatMapLayers-1].click()},this.createLegend=function(e,a,r,o,s,n){o=Number(o),s=Number(s);_.isUndefined(modelsHiddenParams[t].legends[n])||l.map.removeControl(modelsHiddenParams[t].legends[n]),modelsHiddenParams[t].legends[n]=L.control({position:"topleft"}),modelsHiddenParams[t].legends[n].onAdd=function(t){for(var i=L.DomUtil.create("div","scaleLegend"),l="",d=0;d<a;d++)l=l+'<rect height="10" x="'+4*d+'" width="4" style="fill: '+e(d)+';"></rect>';var m,p='<svg id="legend" width="450" height="50"><g class="key" transform="translate(25,16)">'+l,y=o;m=nFormatter(o,2);for(d=0;d<r.length;d++)p=p+'<g class="tick" transform="translate('+4*r[d]+',0)" style="opacity: 1;"><line y2="-1" x2="0"></line><text dy="0em" y="-4" x="0" style="text-anchor: middle;">'+m+"</text></g>",y+=(s-o)/4,m=nFormatter(y,2);return p=(p+='<path class="domain" d="M0,-1V0H400V-1"></path>')+'<text class="" y="21">'+n+"</text>",p+="</g></svg>",i.innerHTML=p,i}},this.drawHeatMap1=function(e,a){if(_.isEmpty(l.mapLayers.heatMap.heatMapLayers[a-1])||(l.ctrl.removeLayer(l.mapLayers.heatMap.heatMapLayers[a-1]),l.map.removeLayer(l.mapLayers.heatMap.heatMapLayers[a-1]),l.mapLayers.heatMap.heatMapLayers[a-1].remove(),delete l.mapLayers.heatMap.heatMapLayers[a-1]),!(_.isUndefined(e)||_.isEmpty(e)||_.isUndefined(e.data)||(heatMapData=e.data,_.isUndefined(heatMapData.length)))){for(var t=[],r=Number.MIN_VALUE,o=[],s=[],n=_.keys(heatMapData[0])[2],i=0;i<heatMapData.length;i++)t[i]=_.values(heatMapData[i]),o[i]=t[i][0],s[i]=t[i][1],t[i][2]>r&&(r=t[i][2]);1==heatMapData.length&&(r=1),r=1;var d,m,p,y,c,g=null,u=!1;try{heatMapConfig=e.config,d=heatMapConfig.minOpacity,m=heatMapConfig.maxZoom,p=heatMapConfig.radius,y=heatMapConfig.blur,u=heatMapConfig.disableAutoscale,g=new Object,c=l.getColorScale(heatMapConfig.colorScale,heatMapConfig.reverseColorScale,0,1),d3.range(11).forEach((e=>g[.1*e]=c(.1*e)))}catch(e){g=null}if(l.mapLayers.heatMap.heatMapLayers[a-1]=L.meanLayer(t,{minOpacity:d,maxZoom:m,max:r,radius:p,blur:y,gradient:g}).addTo(l.map),l.ctrl.addBaseLayer(l.mapLayers.heatMap.heatMapLayers[a-1],n),!u){var f=L.latLng(_.max(o),_.max(s)),h=L.latLng(_.min(o),_.min(s)),M=L.latLngBounds(f,h);l.map.fitBounds(M)}l.map.invalidateSize()}},_.isUndefined(modelsParameters[t].heatMap.densityHeatMap)||modelsParameters[t].heatMap.densityHeatMap?this.drawHeatMap=l.drawHeatMap1:this.drawHeatMap=l.drawHeatMap2,this.clearHeatMapLayer=function(e){l.mapLayers.heatMap.heatMapLayers[e-1].clearLayers()},this.psetHeatMap=function(e,a){if(!_.isUndefined(e)&&!_.isEmpty(e)&&!_.isEmpty(e.data)){var r,o=e.data;r=_.isUndefined(e.config)?{data:[o]}:{data:[o],config:e.config};var s=_.values(e.data);if(_.isEmpty(l.mapLayers.heatMap.heatMapLayers[a-1]))l.drawHeatMap(r,a);else{if(_.isUndefined(modelsParameters[t].heatMap.densityHeatMap))l.mapLayers.heatMap.heatMapLayers[a-1].addLatLng(s);else if(modelsHiddenParams[t].heatMap.densityHeatMap)l.mapLayers.heatMap.heatMapLayers[a-1].addLatLng(s);else{const n=r.config||{},i={circleFillOpacity:n.opacity,circleRadius:n.radius,maxValue:n.max,minValue:n.min},d=l.configStore[a-1],m={circleFillOpacity:d.fillOpacity,circleRadius:d.radius,maxValue:d.maxValue,minValue:d.minValue};if(!(void 0!==i.circleFillOpacity&&i.circleFillOpacity!==m.circleFillOpacity||void 0!==i.circleRadius&&i.circleRadius!==m.circleRadius||void 0!==i.maxValue&&i.maxValue!==m.maxValue||void 0!==i.minValue&&i.minValue!==m.minValue)){let e=100*(s[2]-l.configStore[a-1].minValue)/(l.configStore[a-1].maxValue-l.configStore[a-1].minValue);e<0&&(e=0),e>100&&(e=100),modelsHiddenParams[t].heatMap.heatMapBuffer[a-1].push(o);const r=L.circle([o.lat,o.lng],{color:l.configStore[a-1].color(e),fillColor:l.configStore[a-1].color(e),fillOpacity:l.configStore[a-1].fillOpacity,radius:l.configStore[a-1].radius,stroke:!1});l.mapLayers.heatMap.heatMapLayers[a-1].addLayer(r)}else{l.configStore[a-1].minValue=r.config.min,l.configStore[a-1].maxValue=r.config.max,l.configStore[a-1].radius=r.config.radius,l.configStore[a-1].fillOpacity=r.config.opacity,l.clearHeatMapLayer(a),modelsHiddenParams[t].heatMap.heatMapBuffer[a-1].push(o);const s={data:modelsHiddenParams[t].heatMap.heatMapBuffer[a-1],config:e.config};l.drawHeatMap(s,a)}}_.isUndefined(e.config)||_.isUndefined(e.config.disableAutoscale)?l.map.setView(o):e.config.disableAutoscale||l.map.setView(o)}}},modelsParameters[t].geoJson.numberOfLayers>0)for(let e=1;e<=l.numberOfGeoJsonLayers;e++){_.isUndefined(modelsHiddenParams[t].geoJson.geoJsonLayers[e-1])&&(modelsHiddenParams[t].geoJson.geoJsonLayers[e-1]={}),_.isUndefined(l.mapLayers.geoJson.geoJsonLayers[e-1])&&(l.mapLayers.geoJson.geoJsonLayers[e-1]={});this["geoJson"+e]={layerIndex:e,updateCallback:function(){},setValue:function(e){modelsHiddenParams[t].geoJson.geoJsonLayers[this.layerIndex-1]=e,l.addGeoJson(e,this.layerIndex)},getValue:function(){return modelsHiddenParams[t].geoJson.geoJsonLayers[e-1]},addValueChangedHandler:function(e){this.updateCallback=e},removeValueChangedHandler:function(e){}}}if(modelsParameters[t].choropleth&&modelsParameters[t].choropleth.numberOfLayers>0)for(let e=1;e<=l.numberOfChoroplethLayers;e++){_.isUndefined(modelsHiddenParams[t].choropleth.choroplethLayers[e-1])&&(modelsHiddenParams[t].choropleth.choroplethLayers[e-1]={}),_.isUndefined(l.mapLayers.choropleth.choroplethLayers[e-1])&&(l.mapLayers.choropleth.choroplethLayers[e-1]={});this["choropleth"+e]={layerIndex:e,updateCallback:function(){},setValue:function(e){modelsHiddenParams[t].choropleth.choroplethLayers[this.layerIndex-1]=e,l.addChoropleth(e,this.layerIndex)},getValue:function(){return modelsHiddenParams[t].choropleth.choroplethLayers[e-1]},addValueChangedHandler:function(e){this.updateCallback=e},removeValueChangedHandler:function(e){}}}if(modelsParameters[t].lineHeatMap&&modelsParameters[t].lineHeatMap.numberOfLayers>0)for(let e=1;e<=l.numberOfLineHeatMapLayers;e++){_.isUndefined(modelsHiddenParams[t].lineHeatMap.lineHeatMapLayers[e-1])&&(modelsHiddenParams[t].lineHeatMap.lineHeatMapLayers[e-1]={}),_.isUndefined(l.mapLayers.lineHeatMap.lineHeatMapLayers[e-1])&&(l.mapLayers.lineHeatMap.lineHeatMapLayers[e-1]={});this["lineHeatMap"+e]={layerIndex:e,updateCallback:function(){},setValue:function(e){modelsHiddenParams[t].lineHeatMap.lineHeatMapLayers[this.layerIndex-1]=e,l.addLineHeatMap(e,this.layerIndex)},getValue:function(){return modelsHiddenParams[t].lineHeatMap.lineHeatMapLayers[e-1]},addValueChangedHandler:function(e){this.updateCallback=e},removeValueChangedHandler:function(e){}}}if(modelsParameters[t].heatMap.numberOfLayers>0)for(let e=1;e<=l.numberOfHeatMapLayers;e++){const a="heatMapData"+e,r="heatMapPoint"+e;_.isUndefined(modelsHiddenParams[t].heatMap.heatMapData[e-1])&&(modelsHiddenParams[t].heatMap.heatMapData[e-1]={}),_.isUndefined(modelsHiddenParams[t].heatMap.heatMapBuffer[e-1])&&(modelsHiddenParams[t].heatMap.heatMapBuffer[e-1]=[]),_.isUndefined(l.mapLayers.heatMap.heatMapLayers[e-1])&&(l.mapLayers.heatMap.heatMapLayers[e-1]={}),modelsParameters[t].heatMap.sampledDisplay?this[r]={layerIndex:e,updateCallback:function(){},setValue:function(e){l.bIsInteractive&&l.psetHeatMap(e,this.layerIndex)},getValue:function(){},addValueChangedHandler:function(e){this.updateCallback=e},removeValueChangedHandler:function(e){}}:this[a]={layerIndex:e,updateCallback:function(){},setValue:function(e){e!=modelsHiddenParams[t].heatMap.heatMapData[this.layerIndex-1]&&(modelsHiddenParams[t].heatMap.heatMapData[this.layerIndex-1]=e,l.drawHeatMap(e,this.layerIndex))},getValue:function(){return modelsHiddenParams[t].heatMap.heatMapData[this.layerIndex-1]},addValueChangedHandler:function(e){this.updateCallback=e},removeValueChangedHandler:function(e){}}}if(l.numberOfImageLayers>0)for(let e=1;e<=l.numberOfImageLayers;e++){const a="imageOverlay"+e;_.isUndefined(modelsHiddenParams[t].imageOverlay.imageData[e-1])&&(modelsHiddenParams[t].imageOverlay.imageData[e-1]={}),_.isUndefined(l.mapLayers.imageOverlay.imageLayers[e-1])&&(l.mapLayers.imageOverlay.imageLayers[e-1]={}),this[a]={layerIndex:e,updateCallback:function(){},setValue:function(e){e!=modelsHiddenParams[t].imageOverlay.imageData[this.layerIndex-1]&&(modelsHiddenParams[t].imageOverlay.imageData[this.layerIndex-1]=e,l.addImageOverlay(e,this.layerIndex))},getValue:function(){return modelsHiddenParams[t].imageOverlay.imageData[this.layerIndex-1]},addValueChangedHandler:function(e){this.updateCallback=e},removeValueChangedHandler:function(e){}}}if(l.numberOfSvgLayers>0)for(let e=1;e<=l.numberOfSvgLayers;e++){const a="svgOverlay"+e,r="svgPoint"+e;_.isUndefined(modelsHiddenParams[t].svgOverlay.svgData[e-1])&&(modelsHiddenParams[t].svgOverlay.svgData[e-1]={}),_.isUndefined(l.mapLayers.svgOverlay.svgLayers[e-1])&&(l.mapLayers.svgOverlay.svgLayers[e-1]={}),modelsParameters[t].svgOverlay.sampledDisplay?this[r]={layerIndex:e,updateCallback:function(){},setValue:function(e){l.bIsInteractive&&l.psetSvg(e,this.layerIndex)},getValue:function(){},addValueChangedHandler:function(e){this.updateCallback=e},removeValueChangedHandler:function(e){}}:this[a]={layerIndex:e,updateCallback:function(){},setValue:function(e){modelsHiddenParams[t].svgOverlay.svgData[this.layerIndex-1]=e,l.addSvgOverlay(e,this.layerIndex,!1)},getValue:function(){return modelsHiddenParams[t].svgOverlay.svgData[this.layerIndex-1]},addValueChangedHandler:function(e){this.updateCallback=e},removeValueChangedHandler:function(e){}}}const p=new WidgetActuatorDescription("selectedPoint","Selected coordinates",WidgetActuatorDescription.WRITE,_SCHEMA_SELECTED_POINT),y=new WidgetActuatorDescription("selectedGeoJson","Drawn GeoJSON figure",WidgetActuatorDescription.WRITE,_SCHEMA_SELECTED_GEOJSON);this.getActuatorDescriptions=function(e=null){const a=e||modelsParameters[t],r=[];if(a){if(a.captureClickEvent&&r.push(p),a.drawingFeatures&&r.push(y),a.geoJson&&a.geoJson.numberOfLayers)for(let e=1;e<=a.geoJson.numberOfLayers;e++)r.push(new WidgetActuatorDescription("geoJson"+e,"GeoJSON features",WidgetActuatorDescription.READ,_SCHEMA_GEOJSON));if(a.lineHeatMap&&a.lineHeatMap.numberOfLayers)for(let e=1;e<=a.lineHeatMap.numberOfLayers;e++)r.push(new WidgetActuatorDescription("lineHeatMap"+e,"Lines colored by values",WidgetActuatorDescription.READ,_SCHEMA_LINE_HEATMAP));if(a.choropleth&&a.choropleth.numberOfLayers)for(let e=1;e<=a.choropleth.numberOfLayers;e++)r.push(new WidgetActuatorDescription("choropleth"+e,"Choropleth data",WidgetActuatorDescription.READ,_SCHEMA_CHOROPLETH));if(a.heatMap&&a.heatMap.numberOfLayers)for(let e=1;e<=a.heatMap.numberOfLayers;e++)if(a.heatMap.sampledDisplay){const t="heatMapPoint"+e;a&&!a.densityHeatMap?r.push(new WidgetActuatorDescription(t,"Cumulative heatmap",WidgetActuatorDescription.READ,_SCHEMA_HEATMAP_SAMPLED)):r.push(new WidgetActuatorDescription(t,"Cumulative density heatmap",WidgetActuatorDescription.READ,_SCHEMA_HEATMAP_DENSITY_SAMPLED))}else{const t="heatMapData"+e;a&&!a.densityHeatMap?r.push(new WidgetActuatorDescription(t,"Heatmap",WidgetActuatorDescription.READ,_SCHEMA_HEATMAP)):r.push(new WidgetActuatorDescription(t,"Density heatmap",WidgetActuatorDescription.READ,_SCHEMA_HEATMAP_DENSITY))}if(a.imageOverlay&&a.imageOverlay.numberOfLayers)for(let e=1;e<=a.imageOverlay.numberOfLayers;e++)r.push(new WidgetActuatorDescription("imageOverlay"+e,"Image to place on the map",WidgetActuatorDescription.READ,_SCHEMA_IMAGE_OVERLAY));if(a.svgOverlay&&a.svgOverlay.numberOfLayers)for(let e=1;e<=a.svgOverlay.numberOfLayers;e++)a.svgOverlay.sampledDisplay?r.push(new WidgetActuatorDescription("svgPoint"+e,"Place a symbol on the map",WidgetActuatorDescription.READ,_SCHEMA_SVG_POINT_OVERLAY)):r.push(new WidgetActuatorDescription("svgOverlay"+e,"Place symbols on the map",WidgetActuatorDescription.READ,_SCHEMA_SVG_OVERLAY))}return r},l.render()},this.openStreetMapsWidget.prototype=baseWidget.prototype,this.pluginDefinition={name:"Maps",widgetsDefinitionList:{openStreetMaps:{factory:"openStreetMapsWidget",title:"Leaflet maps",icn:"map",help:"wdg/wdg-geo-time/#leaflet-maps"}}},this.constructor()}mapWidgetsPluginClass.prototype=basePlugin.prototype;var mapWidgetsPlugin=new mapWidgetsPluginClass;widgetsPluginsHandler.loadWidgetPlugin(mapWidgetsPlugin);
function foliumWidgetPluginClass(){this.foliumMapWidget=function(i,t,e,n){this.constructor(i,t,e,n);var l=this;this.enable=function(){},this.disable=function(){},this.rescale=function(){this.render()},this.hasScrollBar=function(i){return i.get(0).scrollHeight>i.get(0).clientHeight},this.render=function(){let l=document.createElement("div"),o="folium-map"+t;if(n&&(o+="c"),l.setAttribute("id",o),modelsHiddenParams[e].map){l.innerHTML=modelsHiddenParams[e].map;try{div1=l.firstElementChild,"DIV"==div1.tagName&&(div1.style.height="100%",div2=div1.firstElementChild,"DIV"==div2.tagName&&(div2.style.height="100%",div2.style["padding-bottom"]=null,div3=div2.firstElementChild,"DIV"==div3.tagName&&(div3.style.height="100%")))}catch(i){console.log(i)}}l.setAttribute("style","width: inherit; height: inherit; background-color:"+modelsParameters[e].backgroundColor),$("#"+i).html(l)};const o=new WidgetActuatorDescription("_repr_html_","Folium Map _repr_html_",WidgetActuatorDescription.READ,WidgetPrototypesManager.SCHEMA_STRING);this.getActuatorDescriptions=function(){return[o]},this._repr_html_={setValue:function(i){modelsHiddenParams[e].map=i,l.render()},getValue:function(){return modelsHiddenParams[e].map},addValueChangedHandler:function(i){l.enable()},removeValueChangedHandler:function(i){l.disable()}},l.render()},this.foliumMapWidget.prototype=baseWidget.prototype,this.pluginDefinition={name:"Maps",widgetsDefinitionList:{foliumMaps:{factory:"foliumMapWidget",title:"Folium Map",icn:"folium",help:""}}},this.constructor()}modelsHiddenParams.foliumMaps={map:""},modelsParameters.foliumMaps={backgroundColor:"rgba(0, 0, 0, 0)"},modelsLayout.foliumMaps={height:"30vh",width:"30vw",minWidth:"50px",minHeight:"32px"},foliumWidgetPluginClass.prototype=basePlugin.prototype;var foliumWidgetPlugin=new foliumWidgetPluginClass;widgetsPluginsHandler.loadWidgetPlugin(foliumWidgetPlugin);
function annotationWidgetsPluginClass(){this.iconInfoAnnotationWidget=function(e,t,i,a){this.constructor(e,t,i,a);var n=this;this.enable=function(){},this.disable=function(){},this.rescale=function(){this.render()},this.render=function(){var a=20;_.isNull($(".icons").height())||(a=$(".icons").height()),_.isNull($(".icons").width())||$(".icons").width();var n=$("#"+e).height(),o=$("#"+e).width(),r=modelsParameters[i].iconSize*a,s=(n-a*modelsParameters[i].iconSize)/2,d=document.createElement("div"),l='<i class="fa fa-'+modelsParameters[i].iconSign+'" style="line-height:normal;zoom:'+modelsParameters[i].iconSize+'"></i>';d.innerHTML=l,d.setAttribute("class","btn"),d.setAttribute("id","annotationiconInfo"+t),d.setAttribute("style","width: "+o+"px; height:"+n+"px; cursor: pointer; margin: auto; color:"+modelsParameters[i].iconColor+"; line-height:"+r+"px;padding-top: "+s+"px; "),$("#"+e).html(d);const c=this.getTransformedText("text");$("#annotationiconInfo"+t).bt(c,{fill:this.tipBackgroundColor(),cssStyles:{color:modelsParameters[i].textColor,fontWeight:modelsParameters[i].fontWeight,fontSize:modelsParameters[i].fontSize,fontFamily:modelsParameters[i].fontFamily},width:modelsParameters[i].tipWidth,shrinkToFit:!0,padding:modelsParameters[i].textPadding,cornerRadius:modelsParameters[i].cornerRadius,spikeLength:modelsParameters[i].spikeLength,spikeGirth:modelsParameters[i].spikeGirth,strokeStyle:this.tipBorderColor(),shadowColor:"rgba(0,0,0,.9)",positions:modelsParameters[i].tipPositions,trigger:modelsParameters[i].tipEventTrigger})};const o=new WidgetActuatorDescription("value","Hover text of the icon",WidgetActuatorDescription.READ,WidgetPrototypesManager.SCHEMA_STRING);this.getActuatorDescriptions=function(e=null){const t=e||modelsParameters[i];return t&&t.enableActuator?[o]:[]},this.value={setValue:function(e){modelsParameters[i].text=e,$("#annotationiconInfo"+t)[0].value=e},getValue:function(){return $("#annotationiconInfo"+t)[0].value},addValueChangedHandler:function(e){n.enable()},removeValueChangedHandler:function(e){n.disable()}},n.render()},this.iconInfoAnnotationWidget.prototype=baseWidget.prototype,this.labelAnnotationWidget=function(e,t,i,a){this.constructor(e,t,i,a);var n=this;_.isUndefined(modelsParameters[i].textAlign)&&(modelsParameters[i].textAlign="left"),this.enable=function(){},this.disable=function(){},this.rescale=function(){this.render()},_.isUndefined(modelsParameters[i].centerVertically)&&(modelsParameters[i].centerVertically=!0),this.render=function(){var a=document.createElement("div"),n="table",o="table-cell";if(!modelsParameters[i].centerVertically)n="flex",o="table";const r=this.getTransformedText("text");let s="font-weight: normal;",d="text-decoration: none;",l="font-style: normal;";modelsParameters[i].textBold&&(s="font-weight: bold;"),modelsParameters[i].textUnderline&&(d="text-decoration: underline;"),modelsParameters[i].textBold&&(l="font-style: italic;");var c='<div id="annotationLabelTextArea'+t+'" style="max-width: 2000px; background-color: transparent;  box-shadow: none; width: inherit;  height: inherit; white-space: pre-wrap; color:'+modelsParameters[i].textColor+"; text-align: "+modelsParameters[i].textAlign+";"+s+d+l+"; background-color: "+modelsParameters[i].backgroundColor+"; padding: 4px; resize: inherit; margin: auto; vertical-align: middle ; border-radius: 6px; "+this.fontSize()+this.valueFontFamily()+this.border()+"display: "+o+'" readonly>'+r+"</textarea>";a.innerHTML=c,a.setAttribute("style","width: inherit; height: inherit; display: "+n+"; justify-content: center;"),$("#"+e).html(a)};const o=new WidgetActuatorDescription("value","Label text",WidgetActuatorDescription.READ,WidgetPrototypesManager.SCHEMA_ANY_PRIMITIVE);this.getActuatorDescriptions=function(e=null){const t=e||modelsParameters[i];return t&&t.enableActuator?[o]:[]},this.value={setValue:function(e){modelsParameters[i].text=e,$("#annotationLabelTextArea"+t)[0].value=e},getValue:function(){return $("#annotationLabelTextArea"+t)[0].value},addValueChangedHandler:function(e){n.enable()},removeValueChangedHandler:function(e){n.disable()}},n.render()},this.labelAnnotationWidget.prototype=baseWidget.prototype,this.imageAnnotationWidget=function(e,t,i,a){this.constructor(e,t,i,a);var n=this;if(_.isUndefined(modelsHiddenParams[i].ratio)){var o=$("#"+e),r=o.width(),s=o.height();modelsHiddenParams[i].ratio=r/s}this.enable=function(){},this.disable=function(){},this.renderOriginalSize=function(){var a=modelsHiddenParams[i].widthPx,n=modelsHiddenParams[i].heightPx,o=$("#"+i);o.width(unitW(a+2)),o.height(unitH(n+2));var r=$("#"+e);r.width(unitW(a)),r.height(unitH(n)),r.css("left","0px"),r.css("top","0px"),r.css("position","absolute"),$("#imgContainer"+t).attr("style","width: "+unitW(a)+"; height: "+unitH(n)+";")},this.rescale=function(){this.render()},this.render=function(){var a=document.createElement("div");a.setAttribute("style","width: inherit; height: inherit; margin: auto; position: absolute; top: 0; left: 0"),a.setAttribute("id","imgContainer"+t);var o="";if(""!=modelsHiddenParams[i].fileContentBase64){o=o+'<img id="img'+t+'" style="position: relative;';var r=$("#"+e);o+="width: inherit; height: inherit; ",modelsParameters[i].keepRatio?o+="object-fit: contain; ":o+="object-fit: fill; ",r.width(inheritWcWidthFromIdInst(i)),r.height(inheritWcHeightFromIdInst(i)),r.css("left","0px"),r.css("top","0px"),r.css("position","absolute"),a.setAttribute("style","width: inherit; height: inherit; margin: auto;"),n.bIsInteractive||(o+=" opacity: 0.75"),o=o+'" src="data:'+modelsHiddenParams[i].mimeType+";base64,"+modelsHiddenParams[i].fileContentBase64+'">',o+="</img>"}if(!n.bIsInteractive&&!modelsParameters[i].hideImageURL){o=(o=o+'<div id="image_drop_zone'+t+'" style="z-index: 1000000; position: absolute; display: table; top: 20px; left:20px; height: calc(100%-40px); width: calc(100%-40px)">')+'<div id="image_drop_zone_new'+t+'" style="; cursor: pointer; display: table-cell; vertical-align: middle"><a><center id="image_import_handle'+t+'">Click here to import your image file</center></a></div>',o+="</div>";var s=document.getElementById("_otherUse"),d='<input type="file" id="image-file'+t+'" name="files[]" accept=".jpg,.jpeg,.png,.gif" style="padding-bottom: 15px; display: none" required="">';s.insertAdjacentHTML("beforeend",d)}(a.innerHTML=o,$("#"+e).html(a),n.bIsInteractive||modelsParameters[i].hideImageURL)||document.getElementById("image_import_handle"+t).addEventListener("click",(function(e){return e.stopPropagation(),document.getElementById("image-file"+t).addEventListener("change",(function(e){e.stopPropagation();var t=new FileReader;return t.addEventListener("load",(function(e){e.stopPropagation();var t=e.target;modelsHiddenParams[i].mimeType=getRealMimeType(t.result),modelsHiddenParams[i].fileContentBase64=encodeURIComponent(base64ArrayBuffer(t.result));var a=new Image;return a.onload=function(){modelsHiddenParams[i].widthPx=a.width,modelsHiddenParams[i].heightPx=a.height,modelsHiddenParams[i].ratio=a.width/a.height,n.renderOriginalSize()},a.src="data:"+modelsHiddenParams[i].mimeType+";base64,"+modelsHiddenParams[i].fileContentBase64,n.render(),!1}),!1),t.readAsArrayBuffer(e.target.files[0]),modelsParameters[i].hideImageURL=!0,!1}),!1),$("#image-file"+t).trigger("click"),!1}),!0)};const d='^data:image/([a-zA-Z]*);base64,([^"]*)$',l=new WidgetActuatorDescription("base64Image","Image encoded as a data URL",WidgetActuatorDescription.READ,{$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:imageAnnotationWidget",type:"string",pattern:d});this.getActuatorDescriptions=function(e=null){const t=e||modelsParameters[i];return t&&t.enableActuator?[l]:[]},this.base64Image={setValue:function(e){if(""!=e){var t=new RegExp(d).exec(e);null==t||3!=t.length?modelsHiddenParams[i].fileContentBase64=e:(modelsHiddenParams[i].mimeType=t[1],modelsHiddenParams[i].fileContentBase64=t[2]),n.render()}},getValue:function(){return modelsHiddenParams[i].fileContentBase64},addValueChangedHandler:function(e){n.enable()},removeValueChangedHandler:function(e){n.disable()}},n.render()},this.imageAnnotationWidget.prototype=baseWidget.prototype,this.videoAnnotationWidget=function(e,t,i,a){this.constructor(e,t,i,a);var n=this;n.showCropBar=!1,n.cropPercentage=100;const o="btn btn-xs btn-block btn-primary "+i+"widgetCustomColor",r="btn btn-xs btn-block btn-primary disabled "+i+"widgetCustomColor",s="start",d="stop";this.enable=function(){$("#video-capture-button-"+t).attr("class",o),$("#video-crop-button-"+t).attr("class",o),$("#video-screenshot-button-"+t).attr("class",o)},this.disable=function(){$("#video-capture-button-"+t).attr("class",r),$("#video-crop-button-"+t).attr("class",r),$("#video-screenshot-button-"+t).attr("class",r)},this.placeCanvas=function(){if(n.canvas&&n.video){const e=n.video.videoWidth,t=n.video.videoHeight,i=n.video.clientWidth,a=n.video.clientHeight;if(e&&t&&i&&a){const o=e/t;let r=Math.round(o*a),s=a;r>i&&(r=i,s=Math.min(a,Math.round(i/o)));const d=Math.round((i-r)/2),l=Math.round((a-s)/2);n.canvas.style.left=d.toString()+"px",n.canvas.style.top=l.toString()+"px"}}},this.handleSuccess=function(e){n.video.srcObject=e,n.video.addEventListener("loadeddata",(function(){n.canvas.width=n.video.videoWidth,n.canvas.height=n.video.videoHeight,n.drawCanvas(),n.placeCanvas()}))},this.handleError=function(e){swal("Annotation Video Widget","navigator.getUserMedia error: "+e,"error")},this.toggleCrop=function(){n.showCropBar=!n.showCropBar,$("#video-crop-button-"+t).toggleClass(i+"widgetCustomColor"),$("#video-crop-button-"+t).toggleClass("btn-warning"),n.showCropBar?$("#cropbar"+t).show():$("#cropbar"+t).hide(),n.drawCanvas(),n.placeCanvas()},this.captureWindow=function(){const e=n.canvas.width,t=n.canvas.height;let i=e,a=t,o=n.ratio;if(!o){if(!n.showCropBar||100===n.cropPercentage)return{x:0,y:0,width:i,height:a};o=e/t}i=Math.round(o*a),i>e&&(i=e,a=i/o),n.showCropBar&&100!==n.cropPercentage&&(i=i*n.cropPercentage/100,a=a*n.cropPercentage/100),i=Math.min(Math.round(i),e),a=Math.min(Math.round(a),t),i=Math.max(1,i),a=Math.max(1,a);return{x:Math.round((e-i)/2),y:Math.round((t-a)/2),width:i,height:a}},this.drawCanvas=function(){const e=n.canvas.width,t=n.canvas.height,i=n.canvas.getContext("2d");if(i.clearRect(0,0,e,t),this.bIsInteractive&&n.video.srcObject&&(n.showCropBar||n.ratio)){const e=n.captureWindow();i.globalAlpha=.6,i.strokeStyle="#FFFF00",i.lineWidth=3,i.strokeRect(e.x,e.y,e.width,e.height)}},this.screenshot=function(){const e=n.captureWindow(),t=document.createElement("canvas");t.width=e.width,t.height=e.height;t.getContext("2d").drawImage(n.video,e.x,e.y,e.width,e.height,0,0,e.width,e.height);const a=t.toDataURL("image/jpeg");modelsHiddenParams[i].screenshotBase64=a,modelsHiddenParams[i].screenshotMimeType="image/jpeg",modelsHiddenParams[i].screenshotData=a.replace("data:image/jpeg;base64,","")},this.handleSliderColors=function(){var e="#slider-crop"+t;$(e).find("div").css("background-color",modelsParameters[i].buttonDefaultColor),$(e).find("a").css("background-color",modelsParameters[i].buttonActiveColor),$(e).find("a").hover((function(){$(this).css("background-color",modelsParameters[i].buttonHoverColor)}),(function(){$(this).css("background-color",modelsParameters[i].buttonActiveColor)}))},this.rescale=function(){this.render()},this.render=function(){const a=document.createElement("div");let o="border: 1px solid black; ";this.bIsInteractive||(o+="background-color: lightgrey; opacity: 0.2 "),videoHeightPx=$("#"+e).height()-45;let r='<div id="videoContainer'+t+'" style="text-align: center; align: center; width: inherit; height: inherit;">';if(r+='<div style="display: flex;">',r=r+'<div style="margin: 0 auto; position: relative; height: '+(videoHeightPx+2)+"px; "+o+'; flex: 100%;">',r=r+'<video id="video'+t+'" class="videostream" style="position: absolute; top: 0; left: 0;" width="100%" height="'+videoHeightPx+'px" autoplay></video>',r=r+'<canvas id="canvas'+t+'" style="max-width: 100%; max-height: 100%; position: absolute; top: 0; left: 0; z-index: 10;"></canvas>',r+="</div>",r=r+'<div id="cropbar'+t+'" style="flex: 5px;" hidden><div class="v-slider-div-div" id="slider-crop'+t+'" style="height: '+(videoHeightPx+2)+'px;"></div></div>',r+="</div>",r+='<div style="display:table; width:100%"><div class="container"><div style="margin: 0px" class="row">',r=r+'<div class="col-3" style="padding: 1px"><button id="video-capture-button-'+t+'">'+s+"</button></div>",r=r+'<div class="col-6" style="padding: 1px"><button id="video-screenshot-button-'+t+'">screenshot</button></div>',r=r+'<div class="col-3" style="padding: 1px"><button id="video-crop-button-'+t+'">crop</button></div>',r+="</div></div></div></div>",a.innerHTML=r,a.setAttribute("style","width: inherit; height: inherit; text-align:center; align: center"),$("#"+e).html(a),this.setButtonColorStyle(),this.bIsInteractive?n.enable():n.disable(),$("#slider-crop"+t).slider({orientation:"vertical",range:"min",min:0,max:100,value:100,slide:function(e,t){n.cropPercentage=t.value,n.drawCanvas()}}),$("#cropbar"+t).hide(),this.handleSliderColors(),n.video=document.getElementById("video"+t),n.canvas=document.getElementById("canvas"+t),modelsParameters[i].enforceCaptureRatio?n.ratio=modelsParameters[i].captureRatio:n.ratio&&delete n.ratio,this.bIsInteractive){const e=document.getElementById("video-capture-button-"+t);e.onclick=function(){n.video.srcObject?n.video.paused?(n.video.play(),e.textContent=d):(n.video.pause(),e.textContent=s):navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"},audio:!1}).then((t=>{n.handleSuccess(t),e.textContent=d})).catch(n.handleError)};document.getElementById("video-crop-button-"+t).onclick=function(){n.toggleCrop()};document.getElementById("video-screenshot-button-"+t).onclick=function(){_.isUndefined(n.video)||(modelsParameters[i].pauseOnCapture&&(n.video.pause(),e.textContent=s),n.screenshot(),n.base64Image.updateCallback(n.base64Image,n.base64Image.getValue()),n.mimeType.updateCallback(n.mimeType,n.mimeType.getValue()),n.imageData.updateCallback(n.imageData,n.imageData.getValue()))}}};const l=new WidgetActuatorDescription("base64Image","Sceenshot as a data URL",WidgetActuatorDescription.WRITE,WidgetPrototypesManager.SCHEMA_STRING),c=new WidgetActuatorDescription("mimeType","MIME type of the screenshot",WidgetActuatorDescription.WRITE,WidgetPrototypesManager.SCHEMA_STRING),h=new WidgetActuatorDescription("imageData","Sceenshot image raw data encoded as base 64",WidgetActuatorDescription.WRITE,WidgetPrototypesManager.SCHEMA_STRING);this.getActuatorDescriptions=function(){return[l,c,h]},this.base64Image={updateCallback:function(){},setValue:function(e){},getValue:function(){return modelsHiddenParams[i].screenshotBase64},addValueChangedHandler:function(e){this.updateCallback=e,n.enable()},removeValueChangedHandler:function(e){n.disable()}},this.mimeType={updateCallback:function(){},setValue:function(e){},getValue:function(){return modelsHiddenParams[i].screenshotMimeType},addValueChangedHandler:function(e){this.updateCallback=e,n.enable()},removeValueChangedHandler:function(e){n.disable()}},this.imageData={updateCallback:function(){},setValue:function(e){},getValue:function(){return modelsHiddenParams[i].screenshotData},addValueChangedHandler:function(e){this.updateCallback=e,n.enable()},removeValueChangedHandler:function(e){n.disable()}},n.render()},this.videoAnnotationWidget.prototype=baseWidget.prototype,this.pluginDefinition={name:"annotation",widgetsDefinitionList:{annotationIconInfo:{factory:"iconInfoAnnotationWidget",title:"Info",icn:"info"},annotationLabel:{factory:"labelAnnotationWidget",title:"Label",icn:"label",help:"wdg/wdg-annotation-video/#label"},annotationImage:{factory:"imageAnnotationWidget",title:"Image",icn:"image",help:"wdg/wdg-annotation-video/#image"},annotationVideo:{factory:"videoAnnotationWidget",title:"Camera",icn:"camera",help:"wdg/wdg-annotation-video/#camera"}}},this.constructor()}modelsHiddenParams.annotationIconInfo={},modelsHiddenParams.annotationLabel={},modelsHiddenParams.annotationImage={fileContentBase64:"",mimeType:"",widthPx:100,heightPx:100,ratio:1},modelsHiddenParams.annotationVideo={screenshotBase64:"",screenshotMimeType:"",screenshotData:""},modelsParameters.annotationIconInfo={text:"Type texte",enableActuator:!1,fontSize:"medium",fontWeight:"bold",fontFamily:"var(--widget-font-family)",textColor:"var(--widget-button-text)",textPadding:10,tipBackgroundColor:"var(--widget-button-color)",tipBorderColor:"var(--widget-button-text)",tipWidth:200,tipPositions:["right"],tipEventTrigger:"hover",iconColor:"var(--widget-label-color)",iconSize:1,iconSign:"info-circle",cornerRadius:10,spikeLength:15,spikeGirth:5},modelsParameters.annotationLabel={text:"Type texte",enableActuator:!1,fontsize:.5,backgroundColor:"rgba(0, 0, 0, 0)",textColor:"var(--widget-label-color)",valueFontFamily:"var(--widget-font-family)",textAlign:"left",textBold:!1,textUnderline:!1,textItalic:!1,displayBorder:!1,borderColor:"var(--widget-border-color)",borderWidth:"2px",centerVertically:!0},modelsParameters.annotationImage={keepRatio:!0,hideImageURL:!1,enableActuator:!1},modelsParameters.annotationVideo={enforceCaptureRatio:!1,captureRatio:1,pauseOnCapture:!1,buttonTextColor:"var(--widget-button-text)",buttonDefaultColor:"var(--widget-button-color)",buttonActiveColor:"var(--widget-button-active-color)",buttonHoverColor:"var(--widget-button-active-color)"},modelsLayout.annotationIconInfo={height:"4vh",width:"2vw"},modelsLayout.annotationLabel={height:"5vh",width:"12vw",minWidth:"5px",minHeight:"5px"},modelsLayout.annotationImage={height:"20vh",width:"17vw"},modelsLayout.annotationVideo={height:"30vh",width:"20vw"},annotationWidgetsPluginClass.prototype=basePlugin.prototype;var annotationWidgetsPlugin=new annotationWidgetsPluginClass;widgetsPluginsHandler.loadWidgetPlugin(annotationWidgetsPlugin);
var scalingManager=function(h,t,e){var i=this;function w(h){switch(i.method){case"scaleTwSp":return i.scaleTwSp(h);case"scaleTwSpWS":return i.scaleTwSpWS(h);case"scaleTwSd":return i.scaleTwSd(h);case"scaleTwh":return i.scaleTwh(h);case"scaleTwhS":return i.scaleTwhS(h);default:return i.scaleIdent(h)}}return i.srcDash=h,i.tgDash=t,i.method=e,this.scaleTwSp=function(h){if(_.isUndefined(i.srcDash))return h;var t={},e=i.tgDash,w=i.srcDash;return t.widthVw=h.widthVw/w.widthVw*e.widthVw,t.leftVw=h.leftVw/w.widthVw*e.widthVw,t.heightVh=h.heightVh*(w.heightPx/w.widthPx)*(e.widthPx/e.heightPx)*(e.heightVh/w.heightVh),t.topVh=h.topVh*(w.heightPx/w.widthPx)*(e.widthPx/e.heightPx)*(e.heightVh/w.heightVh),t},this.scaleTwSpWS=function(h){if(_.isUndefined(i.srcDash))return h;var t={},e=i.tgDash,w=i.srcDash;return t.widthVw=h.widthVw/w.scrollWidthVw*e.widthVw,t.leftVw=h.leftVw/w.scrollWidthVw*e.widthVw,t.heightVh=h.heightVh*(w.heightPx/w.scrollWidthPx)*(e.widthPx/e.heightPx)*(e.heightVh/w.heightVh),t.topVh=h.topVh*(w.heightPx/w.scrollWidthPx)*(e.widthPx/e.heightPx)*(e.heightVh/w.heightVh),t},this.scaleTwSd=function(h){if(_.isUndefined(i.srcDash))return h;var t={},e=i.tgDash,w=i.srcDash;return t.widthVw=h.widthVw/w.widthVw*e.widthVw,t.leftVw=h.leftVw/w.widthVw*e.widthVw,h.widthPx=h.widthVw/w.widthVw*w.widthPx,h.heightPx=h.heightVh/w.heightVh*w.heightPx,h.topPx=h.topVh/w.heightVh*w.heightPx,t.heightPx=h.heightPx,t.topPx=h.topPx,t},this.scaleTwh=function(h){if(_.isUndefined(i.srcDash))return h;var t={},e=i.tgDash,w=i.srcDash;return t.widthVw=h.widthVw/w.widthVw*e.widthVw,t.leftVw=h.leftVw/w.widthVw*e.widthVw,t.heightVh=h.heightVh/w.heightVh*e.heightVh,t.topVh=h.topVh/w.heightVh*e.heightVh,t},this.scaleTwhS=function(h){if(_.isUndefined(i.srcDash))return h;var t={},e=i.tgDash,w=i.srcDash;return t.widthVw=h.widthVw/w.scrollWidthVw*e.widthVw,t.leftVw=h.leftVw/w.scrollWidthVw*e.widthVw,t.heightVh=h.heightVh/w.scrollHeightVh*e.heightVh,t.topVh=h.topVh/w.scrollHeightVh*e.heightVh,t},this.scaleIdent=function(h){if(_.isUndefined(i.srcDash))return h;var t={};i.tgDash,i.srcDash;return t.widthVw=h.widthVw,t.leftVw=h.leftVw,t.heightVh=h.heightVh,t.topVh=h.topVh,t},{setMethod:function(h){i.method=h},scale:w,applyRescale:function(h){var t,e,i,V,s,d,r,n;if(h.nodeType==Node.ELEMENT_NODE)for(t=h.style.width,s=rmUnit(t),V=h.style.left,d=rmUnit(V),e=h.style.height,r=rmUnit(e),i=h.style.top,n=w({widthVw:s,leftVw:d,heightVh:r,topVh:rmUnit(i)}),h.style.width=n.widthVw+"vw",h.style.left=n.leftVw+"vw",h.style.height=n.heightVh+"vh",h.style.top=n.topVh+"vh",wcChildren=h.getElementsByTagName("div"),k=0;k<wcChildren.length;k++)-1!=wcChildren[k].id.search("WidgetContainer")&&(wcChildren[k].style.width=n.widthVw-100/document.documentElement.clientWidth*2+"vw",wcChildren[k].style.height=n.heightVh-100/document.documentElement.clientHeight*2+"vh")}}};
var inputHandler={encodeInputPars:function(a){return btoa(JSON.stringify(a))},decodeInputPars:function(a){try{return JSON.parse(atob(a))}catch(a){return console.log(a),null}},patchInputVariables:function(a,t){return _.each(t,(t=>{a=function(a,t,e){let n=!1;_.isUndefined(a.data.datanodes)&&(a.data.datanodes=a.data.datasources);for(var d=0;d<a.data.datanodes.length;d++)a.data.datanodes[d].name==t&&(n=!0,"JSON_var_plugin"==a.data.datanodes[d].type?a.data.datanodes[d].settings.json_var=JSON.stringify(e):console.log("patchVariableDataNode failed : dataNode "+t+"  is not a variable"));return n||console.log("patchVariableDataNode failed : unable to find dataNode "+t),a}(a,t.dsName,t.dsVal)})),a}};
var rescaleHelper=function(e,t,i){var o=this;function s(){switch(o.mode){case"edit":return"";case"preview":return"c"}}function r(){var e="";switch(o.mode){case"edit":break;case"preview":e="c"}if(o.rows){const t=o.cols*o.rows;switch(o.scalingMethod){case"scaleTwhS":for(let i=1;i<=t;i++)$("#dpr"+i+e)[0].style.height="100%";break;case"scaleTwSp":for(let t=1;t<=o.rows;t++){const i=o.cellProportion[t],s=(t-1)*o.cols+1,r=$("#dpr"+s+e).width(),n=Math.floor(i*r)+2;for(let t=0;t<o.cols;t++)$("#dpr"+(s+t)+e)[0].style.height=n+"px"}break;case"scaleTwh":case"scaleIdent":for(let e=1;e<=o.rows;e++){o.cols;for(let e=0;e<o.cols;e++);}}if("edit"===o.mode)layoutMgr.updateMaxTopAndLeft()}}function n(){let e=null;const t=$("#dpr1"+s());switch(o.rows){case 0:break;case 1:if(e={widthPx:t.width()+2,heightPx:t.height()+2,widthVw:100*(t.width()+2)/document.documentElement.clientWidth,heightVh:100*(t.height()+2)/document.documentElement.clientHeight},"undefined"!=typeof layoutMgr){const t=layoutMgr.getHeightCols();e.rowHeightPercent=t.length?t[0]:100}break;default:if(e={widthPx:t.width()+16,heightPx:t.height()+2,widthVw:100*(t.width()+16)/document.documentElement.clientWidth,heightVh:100*(t.height()+2)/document.documentElement.clientHeight},"undefined"!=typeof layoutMgr){const t=layoutMgr.getHeightCols();e.rowHeightPercent=t.length?t[0]:100}}return e}function d(){if(0===o.rows)o.cellProportion=1;else{o.cellProportion=[];for(let e=1;e<=o.rows;e++){const t=1+(e-1)*o.cols,i=$("#dpr"+t+s());o.cellProportion[e]=i.height()/i.width()}}}return o.dashboardDimensions=e,o.scalingMethod=t,o.mode=i,o.cellProportion=1,o.rows=0,o.cols=1,{setDimensions:function(e){o.dashboardDimensions=e},setScalingMethod:function(e){o.scalingMethod=e},setRows:function(e){o.rows=e},setCols:function(e){o.cols=e},getCols:function(){return o.cols},resizeDashboard:function(e){r();var t=function(){switch(o.mode){case"edit":return widgetEditor.getCurrentDashZoneDims();case"preview":return widgetPreview.getCurrentDashZoneDims()}}(o.mode);_.isUndefined(e)||(t=e);var i=new scalingManager(o.dashboardDimensions,t,o.scalingMethod);o.dashboardDimensions=t;const n=function(){switch(o.mode){case"edit":return document.getElementById("drop-zone");case"preview":return document.getElementById("dashboard-zone")}}(o.mode);for(let e=0;e<n.childNodes.length;e++){const t=n.childNodes[e];if(t.id=="DropperDroite"+s(o.mode))for(let e=0;e<t.childNodes.length;e++){const s=t.childNodes[e];if(""===s.id)return;if($("#"+s.id).hasClass("device-col"))for(let e=0;e<s.childNodes.length;e++){let t;t="edit"==o.mode?s.childNodes[e].childNodes[0]:s.childNodes[e],i.applyRescale(t)}else{let e;e="edit"==o.mode?s.childNodes[0]:s,i.applyRescale(e)}}}},resizeWidgetOnMediaChange:function(e,t){const i=function(){switch(o.mode){case"edit":return widgetEditor.getWidgetsRelativeDims().width;case"preview":return widgetPreview.getWidgetsRelativeDims().width}}(),s=function(){switch(o.mode){case"edit":return widgetEditor.getWidgetsRelativeDims().height;case"preview":return widgetPreview.getWidgetsRelativeDims().height}}(),r=function(){switch(o.mode){case"edit":return widgetEditor.getWidgetsRelativeDims().left;case"preview":return widgetPreview.getWidgetsRelativeDims().left}}(),n=function(){switch(o.mode){case"edit":return widgetEditor.getWidgetsRelativeDims().top;case"preview":return widgetPreview.getWidgetsRelativeDims().top}}(),d=$("#"+t)[0];let c=0,h=0,l=0,a=0;switch(o.mode){case"edit":c=$(d.parentNode.parentNode).width()*i[e]+2,h=$(d.parentNode.parentNode).height()*s[e]+2,l=$(d.parentNode.parentNode).width()*r[e],a=$(d.parentNode.parentNode).height()*n[e];break;case"preview":c=$(d.parentNode).width()*i[e]+2,h=$(d.parentNode).height()*s[e]+2,l=$(d.parentNode).width()*r[e],a=$(d.parentNode).height()*n[e]}const g=rmUnit(unitW(c)),w=rmUnit(unitH(h)),m=rmUnit(unitW(l)),u=rmUnit(unitH(a));d.style.left=m+"vw",d.style.top=u+"vh",d.style.width=g+"vw",d.style.height=w+"vh"},getCurrentDropperDims:n,resizeDashboardCols:r,mediaChangeProjection:function(e,t,i){var o,s=e,r=isMediaChanged(e.media);return r.bChanged,o=r.lastMedia,i?(s.widthVw=e.colDims.widthVw,s.widthPx=e.colDims.widthPx,s.scrollWidthVw=e.colDims.widthVw,s.scrollWidthPx=e.colDims.widthPx,s.heightVh=e.colDims.heightVh,s.heightPx=e.colDims.heightPx,s.scrollHeightVh=e.colDims.heightVh,s.scrollHeightPx=e.colDims.heightPx,{lastMedia:o,referenceFrame:s,targetFrame:t=n()}):{lastMedia:o,referenceFrame:s,targetFrame:t}},setCellProportion:function(e){o.cellProportion=e},updateCellsProportions:d,computeRelativeColHeigth:function(e){var t=100,i=e.heightPx;if(_.isUndefined(e.colDims.heightPx))return 100;switch(t=e.colDims.heightPx,o.scalingMethod){case"scaleTwhS":return 100;case"scaleTwSp":case"scaleTwh":case"scaleIdent":return Math.ceil((t+2)/i*100)}},deserialize:function(e){if(!_.isUndefined(e)){if(e.colDims)if(0===o.rows)o.cellProportion=1;else{o.cellProportion=[];for(let t=1;t<=o.rows;t++)o.cellProportion[t]=e.colDims.heightPx/e.colDims.widthPx}switch(e.scalingMethod){case"scaleTwSp":break;case"scaleTwh":case"scaleIdent":for(var t=1;t<=o.rows;t++)for(var i=(t-1)*o.cols+1,r=0;r<o.cols;r++)$("#dpr"+(i+r)+s())[0].style.height=e.colDims.heightVh+"vh";d()}}}}};
var widgetConnector=function(){var e=[];function t(){const e=angular.element(document.body).injector();e&&e.has("EventCenterService")&&e.invoke(["EventCenterService",e=>{e.sendEvent(EVENTS_EDITOR_CONNECTIONS_CHANGED)}])}function n(){for(const t in e)widgetEditor.widgetContainers.get(e[t].id)||delete e[t];for(const[t,n]of widgetEditor.widgetContainers)if(e[t]){if(widgetEditor.widgetObject[t]){if(!_.isNull(e[t].widgetObjEdit)&&!_.isNull(widgetEditor.widgetObject[t])){let n=e[t].widgetObjEdit.numberOfTriggers-widgetEditor.widgetObject[t].numberOfTriggers;for(;n>0;){let i=Object.keys(e[t].sliders);delete e[t].sliders[i[i.length-1]],n--}}e[t].widgetObjEdit=widgetEditor.widgetObject[t]}}else e[t]={name:t,id:t,instanceId:t,modelJsonId:n.modelJsonId,sliders:[],widgetObjEdit:widgetEditor.widgetObject[t],widgetObjConnect:null};t()}function i(){for(const t in e)d(t);t()}function d(t){const n=e[t];for(const e in n.sliders){const t=n.sliders[e];t.dataNode="None",t.dataFields.length=0}}function o(){for(const t in e)delete e[t];i()}return{widgetsConnection:e,updateWidgetsConnections:n,effectiveSliders:function(){let t=[];return _.each(_.keys(e),(n=>{let i=_.keys(e[n].sliders);for(let e=0;e<i.length;e++)_.isEmpty(i[e])||t.push(i[e])})),_.uniq(t)},resetSingleMatchingBox:i,serialize:function(){const t={};for(const n in e){t[n]={};for(const i in e[n].sliders)t[n][i]=jQuery.extend(!0,{},e[n].sliders[i])}return t},deserialize:function(i){o(),n();for(var d=[],r=0;r<datanodesManager.getAllDataNodes().length;r++)d[r]=datanodesManager.getAllDataNodes()[r].name();for(const t in e)for(const n in i[t])_.isUndefined(i[t][n].dataNode)&&(i[t][n].dataNode=i[t][n].dataSource,delete i[t][n].dataSource),e[t].sliders[n]=i[t][n];for(let t in e)try{widgetPreview.plotConstantData(t,!1)}catch(e){console.error(e)}t()},clear:o,duplicateConnection:function(n,i){e[n]=jQuery.extend(!0,{},e[i.id]),e[n].id=n,e[n].name=n,e[n].instanceId=n,t()},refreshDatanodeConsumers:function(t,n,i,d){for(const o in e){const r=e[o];for(const e in r.sliders){const s=r.sliders[e];if("None"!=s.name){let a=null;null!=r.widgetObjEdit?a=r.widgetObjEdit.getByName(s.name):null!=r.widgetObjConnect&&(a=r.widgetObjConnect.getByName(s.name)),null!=a&&(s.dataNode===n?"Python_pyodide_plugin"==datanodesManager.getDataNodeByName(n).type()&&"fig"===e?widgetPreview.setDataOnWidget(o,e,a,n,i,d,!1):widgetPreview.setDataOnWidget(o,e,a,t,i,d,!1):s.dataNode)}}}}}}();
function displaySpinnerOnInputFileButton(e){const t=this,n=document.getElementById("button"+e),o=document.getElementById("button"+e+"_select_file"),a=document.createElement("i");let i;this.disableButton=function(){n.classList.add("disabled"),a.setAttribute("id","icon"+e),a.setAttribute("class","fa fa-spinner fa-spin"),n.append(a)},this.enableButton=function(){n.classList.remove("disabled"),a&&a.remove()},this.disableButton(),o.onchange=function(){clearTimeout(i),document.body.focus(),t.enableButton()},document.body.onfocus=function(){i=setTimeout((()=>{t.enableButton(),document.body.onfocus=null}),200)}}function updateDataSourceFromWidget(e,t){if(_.isUndefined(widgetConnector.widgetsConnection[e]))return;const n=widgetConnector.widgetsConnection[e].sliders,o=[];if(!_.isUndefined(n)){for(const e in n){const t=n[e].dataNode;"None"!==t&&o.push(datanodesManager.getDataNodeByName(t).name())}o.length>0&&datanodesManager.getDataNodeByName(o[0]).schedulerStart(o,o[0],"triggerButton")}}function updateDataNodeFromWidgetwithspinButton(e,t){if(_.isUndefined(widgetConnector.widgetsConnection[e]))return;const n=widgetConnector.widgetsConnection[e].sliders,o=[];if(!_.isUndefined(n)){for(let e in n){const t=n[e].dataNode;"None"!=t&&o.push(datanodesManager.getDataNodeByName(t).name())}if(o.length>0){const n=document.getElementById("button"+t),a=document.createElement("i");a.setAttribute("id","icon"+t),datanodesManager.getDataNodeByName(o[0]).schedulerStart(o,o[0],"triggerButton");const i=setInterval((function(){const d=[];o.forEach((e=>{"Pending"==datanodesManager.getDataNodeByName(e).status()&&($("#button"+t).attr("class","btn btn-table-cell btn-lg disabled"),d.push(!0),$(a).hasClass("fa fa-spinner fa-spin")||a.setAttribute("class","fa fa-spinner fa-spin"),n.contains(a)||n.append(a))})),0==d.length&&($("#button"+t).attr("class","btn btn-table-cell btn-lg "+e+"widgetCustomColor "),_.isUndefined($("#icon"+t)[0])||$("#icon"+t)[0].remove(),a.remove(),clearInterval(i))}),100)}}}function updateDataNodeFileFromWidget(e,t){if(!_.isUndefined(widgetConnector.widgetsConnection[e])){var n=widgetConnector.widgetsConnection[e].sliders;if(!_.isUndefined(n))for(var o in n){let e=n[o].dataNode;"None"!=e&&datanodesManager.getDataNodeByName(e).isSetFileValid()&&datanodesManager.getDataNodeByName(e).setFile(t)}}}
var widgetPreview=function(){var e,t=[],n="scaleTwh",o=0,i=1,d=new rescaleHelper(e,n,"preview"),a=[],s=[],l=[],r=[],c="",g={};function u(){return{widthPx:$("#dashboard-zone").width(),heightPx:$("#dashboard-zone").height(),scrollWidthPx:$("#dashboard-zone")[0].scrollWidth,scrollHeightPx:$("#dashboard-zone")[0].scrollHeight,widthVw:100*$("#dashboard-zone").width()/document.documentElement.clientWidth,heightVh:100*$("#dashboard-zone").height()/document.documentElement.clientHeight,scrollWidthVw:100*$("#dashboard-zone")[0].scrollWidth/document.documentElement.clientWidth,scrollHeightVh:100*$("#dashboard-zone")[0].scrollHeight/document.documentElement.clientHeight,scalingMethod:n}}function f(){for(let e in t)for(let n of widgetConnector.effectiveSliders())null!=t[e]&&null!=t[e].getByName(n)&&(slider=t[e].getByName(n),slider.addValueChangedHandler(v))}function C(e,n){_.each(_.keys(e.dashboard),(e=>{let o=document.getElementById(e+"c"),i=e.substring(0,e.length-1),d=o.firstElementChild.id;t[e]=n?widgetsPluginsHandler.createWidget(d,i,e,!0):widgetsPluginsHandler.copyWidget(d,i,null,e,!0),function(e){$("#"+e+"c")[0].style.position="absolute",$("#"+e+"c")[0].style.border="1px solid rgba(255, 255, 255, 0)"}(e),null!=widgetConnector.widgetsConnection[e]&&(widgetConnector.widgetsConnection[e].widgetObjEdit=null,widgetConnector.widgetsConnection[e].widgetObjConnect=t[e],m(e,!1))})),d.updateCellsProportions(),_.each(_.keys(t),(e=>{!function(e,t){a[e]=$("#"+t).width()/$("#"+$("#"+t)[0].parentNode.id).width(),s[e]=$("#"+t).height()/$("#"+$("#"+t)[0].parentNode.id).height(),l[e]=$("#"+t).position().left/$("#"+$("#"+t)[0].parentNode.id).width(),r[e]=$("#"+t).position().top/$("#"+$("#"+t)[0].parentNode.id).height(),c=getMedia()}(e,e+"c")}))}function m(e,t){var n=null;if(_.isUndefined(widgetConnector.widgetsConnection[e]))console.log("connection of "+e+" is undefned");else for(var o in widgetConnector.widgetsConnection[e].sliders)if(b(e),"None"!=widgetConnector.widgetsConnection[e].sliders[o].name&&(n=null,null!=widgetConnector.widgetsConnection[e].widgetObjEdit?n=widgetConnector.widgetsConnection[e].widgetObjEdit.getByName(widgetConnector.widgetsConnection[e].sliders[o].name):null!=widgetConnector.widgetsConnection[e].widgetObjConnect&&(n=widgetConnector.widgetsConnection[e].widgetObjConnect.getByName(widgetConnector.widgetsConnection[e].sliders[o].name)),null!=n))if("None"!=widgetConnector.widgetsConnection[e].sliders[o].dataNode){let i=widgetConnector.widgetsConnection[e].sliders[o].dataNode;if("None"!=i)if(_.isUndefined(datanodesManager.getDataNodeByName(i)))msg="Invalid connection with data",p(e,o,msg);else{let d=datanodesManager.getDataNodeByName(i).latestData(),a=datanodesManager.getDataNodeByName(i).name(),s=datanodesManager.getDataNodeByName(i).status(),l=datanodesManager.getDataNodeByName(i).last_updated();"Python_pyodide_plugin"==datanodesManager.getDataNodeByName(a).type()&&"fig"==o?y(e,o,n,a,s,l,t):y(e,o,n,d,s,l,t)}else msg="Invalid connection with data",p(e,o,msg)}else $("#collapse-matching-box").hasClass("collapse in")&&widgetPreview.clearDataFromWidget(e,o,n,!0)}function p(e,t,n){if(!g[e]){var o=widgetConnector.widgetsConnection[e].instanceId+"c";_.isUndefined($("#"+o)[0])||"3px groove #e40000"!=$("#"+o)[0].style.border&&(w=parseFloat($("#"+o)[0].style.width)+1,h=parseFloat($("#"+o)[0].style.height)+1,$("#"+o)[0].style.width=w+"vw",$("#"+o)[0].style.height=h+"vh",$("#"+o)[0].style.border="3px groove #e40000",$("#"+o)[0].style.borderRadius="6px",$("#"+o)[0].style.background="rgba(255, 0, 0, 0.26)",$("#"+o).append('<br/><span style="color:red">'+n+' "'+widgetConnector.widgetsConnection[e].sliders[t].dataNode+'" !</span>')),g[e]=!0}}function b(e){var t=widgetConnector.widgetsConnection[e].instanceId+"c";if(!_.isUndefined($("#"+t)[0])&&"1px solid rgba(255, 255, 255, 0)"!=$("#"+t)[0].style.border){w=parseFloat($("#"+t)[0].style.width)-1,h=parseFloat($("#"+t)[0].style.height)-1,$("#"+t)[0].style.width=w+"vw",$("#"+t)[0].style.height=h+"vh",$("#"+t)[0].style.border="1px solid rgba(255, 255, 255, 0)",$("#"+t)[0].style.borderRadius="",$("#"+t)[0].style.background="";for(var n=0;n<$("#"+t)[0].childNodes.length;n++)"span"==$("#"+t)[0].childNodes[n].localName&&$("#"+t)[0].childNodes[n].remove()}g[e]=!1}function y(e,t,n,o,i,d,a){if(_.isUndefined(o)&&"never"!=d||"Error"==i)return msg="Invalid data",void p(e,t,msg);if(b(e),!_.isUndefined(o)&&!_.isNull(o)){const i=widgetConnector.widgetsConnection[e].sliders[t];let d=o,s=i.dataNode;for(let e=0;e<i.dataFields.length;e++){const t=i.dataFields[e];"string"==typeof t&&t.includes(" ... ")||(s=t,"object"==typeof d&&(d=_.isNull(d)||_.isUndefined(d)?o[s]:d[s]))}if(null===d)widgetPreview.clearDataFromWidget(e,t,n,!0);else if("D"===i.name.substring(0,1))try{n.setText(d)}catch(e){console.log("setText got exception with data '"+i.dataNode+"'. "+e)}else{if(!_.isUndefined(n.setCaption))try{n.setCaption(s,a)}catch(e){console.log("setCaption got exception with data '"+i.dataNode+"'. "+e)}if(!_.isUndefined(n.setValue))try{n.setValue(d)}catch(e){console.log("setValue got exception with data '"+i.dataNode+"'. "+e)}}}}function v(e,t){var n=null;if(0==datanodesManager.getAllDataNodes().length);else{var o=!1;for(var i in widgetConnector.widgetsConnection)for(var d in widgetConnector.widgetsConnection[i].sliders)if(null!=widgetConnector.widgetsConnection[i].widgetObjConnect&&null!=widgetConnector.widgetsConnection[i].widgetObjConnect.getByName(widgetConnector.widgetsConnection[i].sliders[d].name)&&e==widgetConnector.widgetsConnection[i].widgetObjConnect.getByName(widgetConnector.widgetsConnection[i].sliders[d].name)){o=!0,n=widgetConnector.widgetsConnection[i].sliders[d];break}if(o&&"None"!=n.dataNode){let t=datanodesManager.getDataNodeByName(n.dataNode);if(_.isUndefined(t))console.log("data was removed or data index was modified!");else if(t.isSetValueValid()&&!_.isUndefined(e.getValue))try{t.setValue(n.dataFields,e.getValue())}catch(e){console.log("setValue got exception with data: "+t.name()+". "+e.message)}else console.log("setValue is not possible with data: "+t.name())}}}function N(){e=u(),d.setDimensions(e);var n,o=isMediaChanged(c);n=o.bChanged,c=o.lastMedia,n?_.each(_.keys(t),(e=>{let n=e+"c";d.resizeWidgetOnMediaChange(e,n),function(e){let n=e+"c";for(var o=document.getElementById(n),i=o.id.substring(0,o.id.length-2),d=(e=o.id.substring(0,o.id.length-1),o.firstElementChild),a=o.childNodes.length-1;a>=0;a--)o.removeChild(o.childNodes[a]);var s=document.createElement("div");s.style.height=unitH(o.offsetHeight-2),s.style.width=unitW(o.offsetWidth-2),s.style.minWidth=parseFloat(o.style.minWidth)-5+"px",s.style.minHeight=parseFloat(o.style.minHeight)-5+"px",o.appendChild(s),s.id=d.id;var l=d.id;t[e]=widgetsPluginsHandler.copyWidget(l,i,t[e],e,!0),g[e]=!1}(e),null!=widgetConnector.widgetsConnection[e]&&(widgetConnector.widgetsConnection[e].widgetObjConnect=t[e],m(e))})):_.each(_.keys(t),(e=>{rescaleWidget(t,e)}))}function x(){for(var e in t)delete t[e];for(var e in $("#dashboard-zone").html(""),a)delete a[e];for(var e in s)delete s[e];for(var e in l)delete l[e];for(var e in r)delete r[e];c=""}return{loadPlayMode:function(){x(),e=widgetEditor.getSnapshotDashZoneDims(),d.setDimensions(e),d.setScalingMethod(n),d.setRows(o),d.setCols(i),C(function(){var e=xdash.serialize();e.scaling=widgetEditor.getSnapshotDashZoneDims();var t=document.getElementById("dashboard-zone"),n=document.createElement("div");return n.id="DropperDroitec",n.className="dropperR",n.style.zIndex=0,n.style.borderRadius="10px",t.appendChild(n),reconstructFoundations.buildDivsFromXprjson(e),e}(),!1),0!=datanodesManager.getAllDataNodes().length&&f()},renderDashboardWidgets:C,updateDataFromWidget:v,resizeDashboard:function(e){if("undefined"!=typeof execOutisdeEditor&&execOutisdeEditor){var t=0;switch($("#nav-menu")[0]&&(t=parseInt($("#nav-menu")[0].style.height),isNaN(t)&&(t=0)),jsonContent.exportOptions){case"rowToPage":rowToPageRuntime.rowToPagePrepareRescale(o,i);break;case"rowToTab":rowToTabRuntime.rowToTabPrepareRescale(o,i);break;case"customNavigation":customNavigationRuntime.customNavigationPrepareRescale(o,i);break;case"keepOriginalWidth":$("#dashboard-zone")[0].style.height=scalingSrc.scrollHeightPx+t+"px";break;default:$("#dashboard-zone")[0].style.height=document.body.clientHeight-t+"px"}}d.setScalingMethod(n),d.setRows(o),d.setCols(i),d.resizeDashboard(e),N(),"undefined"!=typeof execOutsideEditor&&execOutsideEditor&&"rowToPage"==jsonContent.exportOptions&&setTimeout(rowToPageRuntime.rowToPageFinishRescale,500,o,i)},resizeDashboardCols:function(){d.resizeDashboardCols()},widget:t,plotConstantData:m,assignValueChangeHandlers:f,rescale:N,clear:function(){x(),htmlExport.exportOptions="ajustToTargetWindow"},deserialize:function(e){let t;for(t in _.each(_.keys(e),(e=>{let t=e.substring(0,e.length-1),n=e+"c";null==widgetConnector.widgetsConnection[e]&&(widgetConnector.widgetsConnection[e]={name:n,id:n,instanceId:e,modelJsonId:t,sliders:[],widgetObjEdit:null,widgetObjConnect:null})})),widgetConnector.widgetsConnection)for(var n in e[t])_.isUndefined(e[t][n].dataNode)&&(e[t][n].dataNode=e[t][n].dataSource,delete e[t][n].dataSource),widgetConnector.widgetsConnection[t].sliders[n]=e[t][n];for(t in widgetConnector.widgetsConnection)try{widgetPreview.plotConstantData(t,!1),widgetConnector.widgetsConnection[t].widgetObjEdit=null}catch(e){}},setDataOnWidget:y,clearDataFromWidget:function(e,t,n,o){"D"===widgetConnector.widgetsConnection[e].sliders[t].name.substring(0,1)?n.setText(""):(!_.isUndefined(n.clearCaption)&&o&&n.clearCaption(),_.isUndefined(n.setValue)||n.setValue(null))},getCurrentDashZoneDims:u,getSnapshotDashZoneDims:function(){return e},getWidgetsRelativeDims:function(){return{width:a,height:s,left:l,top:r}},setScalingInformation:function(e,t,a,s){null!=e&&(d.setDimensions(e),null!=e.colDims&&d.deserialize(e)),null!=t&&(n=t,d.setScalingMethod(n)),null!=a&&(o=a,d.setRows(o)),null!=s&&(i=s,d.setCols(i))},getCols:function(){return d.getCols()},mediaChangeProjection:function(e,t,n){return d.mediaChangeProjection(e,t,n)},toPng:function(){var e=function(){var e,n,o=0,i=0,d=$("#dashboard-zone").offset().left,a=$("#dashboard-zone").offset().top,s=$("#dashboard-zone").height();for(var l in t)(e=$("#"+l+"c").offset().left-d+$("#"+l+"c").width())>o&&(o=e),(n=$("#"+l+"c").offset().top-a+$("#"+l+"c").height())>i&&(i=n),i>s&&(i=s);return{right:o,bottom:i}}(),n=document.getElementById("dashboard-zone"),o=n.style.height,i=n.style.width;n.style.height=e.bottom+"px",n.style.width=e.right+"px",html2canvas(n,{allowTaint:!1,useCORS:!0}).then((function(t){var d=Canvas2Image.convertToPNG(t,e.right,e.bottom),a=document.createElement("a");a.setAttribute("download",$("#projectName")[0].value+".png"),a.setAttribute("href",d.src.replace("image/png","image/octet-stream")),a.click(),n.style.height=o,n.style.width=i}))},elevateZIndex:function(e,n){var o=0;_.each(Object.keys(t),(function(e){var t=Number($("#"+e+"c")[0].style["z-index"]);t>o&&(o=t)})),$("#"+e+"c")[0].style["z-index"]=o+1}}}();
var pyodideLib={serialize:function(){const{standardLibs:i,micropipLibs:d}=pyodideManager.getProjectLibs();return{pyodideStandard:i.sort(),pyodideMicropip:d.sort()}},deserialize:async function(i){_.isUndefined(i.data.datanodes)&&(i.data.datanodes=i.data.datasources);const d=i.data.datanodes;let a=!1,o={standardLibs:[],micropipLibs:[]};if(d.forEach((i=>{"Python_pyodide_plugin"===i.type&&(a=!0)})),a){const i=pyodideManager.getDefaultLibs();for(const d in o)o[d]=_.union(o[d],i[d])}if(!_.isUndefined(i.libraries)){const{pyodideStandard:d,pyodideMicropip:a}=i.libraries,e={standardLibs:d,micropipLibs:a};for(const i in o)o[i]=_.union(o[i],e[i])}await pyodideManager.loadPyodideLibs(o)}};
var runtimeToolbar={toolbar:['<div class="top-nav" ng-if="showNavBar">','   <nav class="top-nav__menu" id="nav-menu">','       <ul class="top-nav__nav">','           <li class="top-nav__nav-item">','               <a class="top-nav__brand" target="_blank" href="'+xDashConfig.urlWebSite+'" title="Chalk\'it website">',"                   Powered by Chalk'it",'                   <img src="'+xDashConfig.urlBaseForExport+'assets/img/chalk-it-icon.svg" />',"               </a>","           </li>",'           <li ng-if="showPagination && (exportOptions == \'rowToPage\')" class="top-nav__nav-item top-nav__nav-item--row-to-page">\n                  <button class="top-nav__btn top-nav__btn--rounded" ng-click="rowToPageChange(\'previous\')">\n                    <i class="fa fa-chevron-left" aria-hidden="true"></i>\n                  </button>\n                  <div class="top-nav__title">Page {{pageNumber}} / {{totalPages}}</div>\n                  <button class="top-nav__btn top-nav__btn--rounded" ng-click="rowToPageChange(\'next\')">\n                    <i class="fa fa-chevron-right" aria-hidden="true"></i>\n                  </button>\n                </li>\n                <li ng-if="showPagination && (exportOptions == \'rowToTab\')" class="top-nav__nav-item top-nav__nav-item--row-to-tab">\n                  <div class="top-nav__btn-wrapper" ng-repeat="pageName in pageNames">\n                    <button id="btn-page-{{$index + 1}}" class="btn btn-rounded-fill primary" ng-class="{\'cancel\': pageNumber != $index + 1}"  ng-click="rowToTabChange($index + 1)">\n                      {{pageName}}\n                    </button>\n                  </div>\n                </li>',"       </ul>","       <ul class='top-nav__nav top-nav__nav--right'>",'            <li class="top-nav__nav-item dropdown" ng-if="navBarNotification">','                <a class="dropdown-toggle info-number" data-toggle="dropdown" aria-expanded="false">','                    <i class="fa fa-envelope-o" aria-hidden="true"></i>','                    <span class="badge bg-red">{{nbNotifications}}</span>',"                </a>",'                <ul id="menu1" class="dropdown-menu list-unstyled top-nav__msg-list" role="menu">',"                    <form>",'                        <li class="top-nav__msg-item" ng-if="nbNotifications">','                            <div class="text-center">','                                <div ng-show="!searchFrom" style="display: inline-block; width:80%;margin:13px">','                                    <h3 style="margin:0; line-height:normal"> Notifications list</h3>',"                                </div>","                            </div>","                        </li>",'                        <li class="top-nav__msg-item" ng-if="nbNotifications>shownNotificationsMax">','                            <div class="text-center">',"                                <strong>..too many notifications! Please acquit a few to display more.</strong>","                            </div>","                        </li>",'                        <li class="top-nav__msg-item" ng-repeat="notification in listNotifications | limitTo:- 100 |orderBy:-$index " ',"                            ng-show=\"!notification.hide&&(notification.dataNode.indexOf(notificationFilterDataValue)>=0||notificationFilterDataValue=='')\">",'                            <a class="top-nav__msg-link" ng-click="hideNotificationFromNavBar(notification)" title="Click to acquit this notification">','                                <span class="image"><img ng-src="{{urlBase+notification.img}}" alt="error Message"></span>',"                                <span>","                                    <span>{{notification.title || 'Error'}}</span>","                                <span class=\"data\">{{'Data: '}} {{notification.dataNode}}</span>","                                </span>","                                <span class=\"message\">{{notification.text + '. '}}</span>",'                                <span class="time">{{notification.time}}</span>',"                            </a>","                        </li>",'                        <li class="top-nav__msg-item text-center" ng-if="nbNotifications">','                            <a ng-click="clearAllNotifications()">',"                                <strong>Clear All Notifications</strong>",'                                <i class="fa fa-angle-right"></i>',"                            </a>","                        </li>","                    </form>","                </ul>","            </li>","        </ul>","    </nav>","</div>",""]};
var rowToPageRuntime=function(){const e=this;function o(){return e.grid}function r(o){e.grid=o}return e.grid={rows:1,cols:1},{rowToPagePrepareRescale:function(e,s){let{rows:c,cols:t}=o();c=Number(e)||1,t=Number(s)||1,r({rows:c,cols:t}),c>1&&$("[id^=dpr][id$=c]").show()},rowToPageFinishRescale:function(e,s){const c=angular.element(document.body).scope().$root.pageNumber;let{rows:t,cols:i}=o();if(t=Number(e)||1,i=Number(s)||1,r({rows:t,cols:i}),t>1)if($("[id^=dpr][id$=c]").hide(),i>1){const e=c*i;for(let o=e-i+1;o<=e;o++)$("#dpr"+o+"c").show()}else $("#dpr"+c+"c").show()},rowToPageModeInit:function(e){const s=angular.element(document.body).scope().$root;let{rows:c,cols:t}=o();if(c=Number(e.device.cols.valueRow)||1,t=Number(e.device.cols.valueCol)||1,r({rows:c,cols:t}),s.pageNumber=1,s.totalPages=c,s.showPagination=!0,s.exportOptions=e.exportOptions,s.$apply(),c>1)if($("[id^=dpr][id$=c]").hide(),t>1)for(let e=1;e<=t;e++)$("#dpr"+e+"c").show();else $("#dpr"+s.pageNumber+"c").show();s.rowToPageChange=function(e){let o=!0,r="";switch(e){case"previous":o=s.pageNumber>1,r="-";break;case"next":o=s.pageNumber<s.totalPages,r="+"}if(o){switch($("[id^=dpr][id$=c]").hide(),r){case"-":s.pageNumber-=1;break;case"+":s.pageNumber+=1}if(t>1){const e=s.pageNumber*t;for(let o=e-t+1;o<=e;o++)$("#dpr"+o+"c").show()}else $("#dpr"+s.pageNumber+"c").show()}}}}}();
var rowToTabRuntime=function(){const o=this;function e(){return o.grid}function r(e){o.grid=e}return o.grid={rows:1,cols:1},{rowToTabPrepareRescale:function(o,s){let{rows:c,cols:i}=e();c=Number(o)||1,i=Number(s)||1,r({rows:c,cols:i}),c>1&&$("[id^=dpr][id$=c]").show()},rowToTabFinishRescale:function(o,s){const c=angular.element(document.body).scope().$root.pageNumber;let{rows:i,cols:n}=e();if(i=Number(o)||1,n=Number(s)||1,r({rows:i,cols:n}),$("#page-"+c).removeClass("cancel").addClass("primary"),i>1)if($("[id^=dpr][id$=c]").hide(),n>1){const o=c*n;for(let e=o-n+1;e<=o;e++)$("#dpr"+e+"c").show()}else $("#dpr"+c+"c").show()},rowToTabModeInit:function(o){const s=angular.element(document.body).scope().$root;let{rows:c,cols:i}=e();if(c=Number(o.device.cols.valueRow)||1,i=Number(o.device.cols.valueCol)||1,r({rows:c,cols:i}),s.pageNumber=1,s.pageNames=o.pages.pageNames,s.showPagination=!0,s.exportOptions=o.exportOptions,s.$apply(),c>1)if($("[id^=dpr][id$=c]").hide(),i>1)for(let o=1;o<=i;o++)$("#dpr"+o+"c").show();else $("#dpr"+s.pageNumber+"c").show();s.rowToTabChange=function(o){if(s.pageNumber=o,$("[id^=dpr][id$=c]").hide(),i>1){const e=o*i;for(let o=e-i+1;o<=e;o++)$("#dpr"+o+"c").show()}else $("#dpr"+o+"c").show()}}}}();
var customNavigationRuntime=function(){const o=this;function e(){return o.grid}function t(e){o.grid=e}return o.jsonContent={},o.grid={rows:1,cols:1},{customNavigationPrepareRescale:function(o,s){let{rows:n,cols:r}=e();n=Number(o)||1,r=Number(s)||1,t({rows:n,cols:r}),n>1&&$("[id^=dpr][id$=c]").show()},customNavigationModeInit:function(o){const s=Number(o.pages.defaultPage.id);let{rows:n,cols:r}=e();if(n=Number(o.device.cols.valueRow)||1,r=Number(o.device.cols.valueCol)||1,t({rows:n,cols:r}),n>1)if($("[id^=dpr][id$=c]").hide(),r>1){const o=s*r;for(let e=o-r+1;e<=o;e++)$("#dpr"+e+"c").show()}else $("#dpr"+s+"c").show()},setJsonContent:function(e){o.jsonContent=e},customNavigationGoToPage:function(s){const n=angular.element(document.body).scope().$root;if(n.pageNumber=s,"undefined"!=typeof layoutMgr&&!n.bIsPlayMode)return;const r=o.jsonContent;let i="",{rows:c,cols:l}=e();if(_.isEmpty(r)?(c=layoutMgr.getRows()||1,l=layoutMgr.getCols()||1,i=htmlExport.exportOptions):(c=Number(r.device.cols.valueRow)||1,l=Number(r.device.cols.valueCol)||1,i=r.exportOptions),t({rows:c,cols:l}),c>1)if("projectToTargetWindow"==i){$("#dpr"+s*l+"c")[0].scrollIntoView(!1)}else if($("[id^=dpr][id$=c]").hide(),l>1){const o=s*l;for(let e=o-l+1;e<=o;e++)$("#dpr"+e+"c").show()}else $("#dpr"+s+"c").show()}}}();
var xDashApi={setVariable:function(a,e){datanodesManager.getDataNodeByName(a).notificationCallback("warning",a,"Deprecated feature: please rename 'xDashApi' by 'chalkit'"),chalkit.setVariable(a,e)},setVariables:function(a,e){datanodesManager.getDataNodeByName(a[0]).notificationCallback("warning",a[0],"Deprecated feature: please rename 'xDashApi' by 'chalkit'"),chalkit.setVariables(a,e)},getVariable:function(a){datanodesManager.getDataNodeByName(a).notificationCallback("error",a,"Deprecated feature: 'getVariable' feature is no longer supported")},setVariableProperty:function(a,e,t){datanodesManager.getDataNodeByName(a).notificationCallback("warning",a,"Deprecated feature: please rename 'xDashApi' by 'chalkit'"),chalkit.setVariableProperty(a,e,t)},executeDataNode:function(a){datanodesManager.getDataNodeByName(a).notificationCallback("warning",a,"Deprecated feature: please rename 'xDashApi' by 'chalkit'"),chalkit.executeDataNode(a)},executeDataNodes:function(a){datanodesManager.getDataNodeByName(a[0]).notificationCallback("warning",a[0],"Deprecated feature: please rename 'xDashApi' by 'chalkit'"),chalkit.executeDataNodes(a)},viewProject:function(a,e,t){const n=datanodesManager.getCurrentDataNode();datanodesManager.getDataNodeByName(n).notificationCallback("warning",n,"Deprecated feature: please rename 'xDashApi' by 'chalkit'"),chalkit.viewProject(a,e,t)},viewPage:function(a,e,t){const n=datanodesManager.getCurrentDataNode();datanodesManager.getDataNodeByName(n).notificationCallback("warning",n,"Deprecated feature: please rename 'xDashApi' by 'chalkit'"),chalkit.viewPage(a,e,t)},goToPage:function(a){const e=datanodesManager.getCurrentDataNode();datanodesManager.getDataNodeByName(e).notificationCallback("warning",e,"Deprecated feature: please rename 'xDashApi' by 'chalkit'"),chalkit.goToPage(a)}};
var chalkit={setVariable:function(e,a){const t=JSON.parse(JSON.stringify(a)),n=datanodesManager.getCurrentDataNode();let o=datanodesManager.getDataNodeByName(e);_.isUndefined(o)?(o=datanodesManager.getDataNodeByName(n),o.notificationCallback("error",n,"The dataNode referenced in setVariable api doesn't exist. Please verify your parameters")):(datanodesManager.datanodesDependency().addSetvarList(e,n),o.setValue([],t,!0))},setVariables:function(e,a){const t=datanodesManager.getCurrentDataNode();for(let n=0;n<e.length;n++){let o=datanodesManager.getDataNodeByName(e[n]);if(_.isUndefined(o))o=datanodesManager.getDataNodeByName(t),o.notificationCallback("error",t,"The dataNode referenced in setVariables api doesn't exist. Please verify your parameters");else{datanodesManager.datanodesDependency().addSetvarList(e[n],t);const d=JSON.parse(JSON.stringify(a[n]));o.setValue([],d,!0)}}},setVariableProperty:function(e,a,t){const n=datanodesManager.getCurrentDataNode(),o=JSON.parse(JSON.stringify(t));let d=datanodesManager.getDataNodeByName(e);_.isUndefined(d)?(d=datanodesManager.getDataNodeByName(n),d.notificationCallback("error",n,"The dataNode referenced in setVariableProperty api doesn't exist. Please verify your parameters")):(datanodesManager.datanodesDependency().addSetvarList(e,n),d.setValue(a,o,!0))},executeDataNode:function(e){const a=datanodesManager.getCurrentDataNode();datanodesManager.foundDatanode(e)?datanodesManager.datanodesDependency().addSetvarList(e,a):datanodesManager.getDataNodeByName(a).notificationCallback("error",a,"The dataNode referenced in executeDataNode api doesn't exist. Please verify your parameters")},executeDataNodes:function(e){const a=datanodesManager.getCurrentDataNode();for(let t=0;t<e.length;t++)datanodesManager.foundDatanode(e[t])?datanodesManager.datanodesDependency().addSetvarList(e[t],a):datanodesManager.getDataNodeByName(a).notificationCallback("error",a,"The dataNode referenced in executeDataNodes api doesn't exist. Please verify your parameters")},viewProject:function(e,a,t){const n=xDashConfig.urlBaseForExport;let o=!1;"999"==xDashConfig.version.minor&&(o=!0);let d="";o||(d="-"+xDashConfig.version.fullVersion);const i=n+"index-view"+d+".html?projectUrl="+e+"&inputParams="+inputHandler.encodeInputPars(a);t?window.open(i,"_blank"):window.location=i},viewPage:function(e,a,t){const n=e+"?inputParams="+inputHandler.encodeInputPars(a);t?window.open(n,"_blank"):window.location=n},goToPage:function(e){customNavigationRuntime.customNavigationGoToPage(e)},enableWidget:function(e){let a=$("#"+e+"c")[0];_.isUndefined(a)||(a.style.pointerEvents="",a.style.opacity="")},disableWidget:function(e){let a=$("#"+e+"c")[0];_.isUndefined(a)||(a.style.pointerEvents="none",a.style.opacity="0.5")},showWidget:function(e){let a=$("#"+e+"c");_.isUndefined(a)||a.show()},hideWidget:function(e){let a=$("#"+e+"c");_.isUndefined(a)||a.hide()}};
!function(e){e.fn.hasVScrollBar=function(){return this.get(0).scrollHeight>this.height()},e.fn.hasHScrollBar=function(){return this.get(0).scrollWidth>this.width()},e.fn.computeRatio=function(){return this.get(0).scrollWidth/this.width()}}(jQuery);var RuntimeDashboard=function(){var e;function a(a,o){e=jQuery.extend(!0,{},a.scaling);var s=0;switch($("#nav-menu")[0]&&(s=parseInt($("#nav-menu")[0].style.height),isNaN(s)&&(s=0)),o){case"keepOriginalWidth":$("#dashboard-zone")[0].style.width=e.scrollWidthPx+"px",$("#dashboard-zone")[0].style.height=e.scrollHeightPx+s+"px",e.scalingMethod="scaleTwSp";break;case"adjustToFullWidth":$("#dashboard-zone")[0].style.width="100%",$("#dashboard-zone")[0].style.height=document.body.clientHeight-s+"px",e.scalingMethod="scaleTwSpWS";break;case"ajustToTargetWindow":$("#dashboard-zone")[0].style.width="100%",$("#dashboard-zone")[0].style.height=document.body.clientHeight-s+"px",e.scalingMethod="scaleTwh";break;case"projectToTargetWindow":case"customNavigation":case"rowToTab":case"rowToPage":$("#dashboard-zone")[0].style.width="100%",$("#dashboard-zone")[0].style.height=document.body.clientHeight-s-1+"px",e.scalingMethod="scaleTwhS";break;default:$("#dashboard-zone")[0].style.width="100%",$("#dashboard-zone")[0].style.height="100%"}if($("#dashboard-zone")[0].style.margin="auto",$("#dashboard-zone")[0].style["overflow-x"]="hidden",$("#dashboard-zone")[0].style["overflow-y"]="hidden",$("#DropperDroitec")[0].style.height="100%",$("#DropperDroitec")[0].style.width="100%",$("#DropperDroitec")[0].style["overflow-y"]="auto",_.isUndefined(a.device))a.device={cols:{valueRow:"none",valueCol:"1",maxCells:0,maxCols:0,classType:""}};else{if(_.isUndefined(a.device.cols.valueRow))if(_.isUndefined(a.device.cols.value))a.device.cols.valueRow="none";else switch(a.device.cols.value){case"none":default:a.device.cols.valueRow="none";break;case"1":case"3":a.device.cols.valueRow="1";break;case"6":a.device.cols.valueRow="6"}if(_.isUndefined(a.device.cols.valueCol))if(_.isUndefined(a.device.cols.value))a.device.cols.valueCol="1";else switch(a.device.cols.value){case"none":case"1":default:a.device.cols.valueCol="1";break;case"3":case"6":a.device.cols.valueCol="3"}}const i=a.device.cols.maxCols,t=a.device.cols.maxCells/(i||1);var d=jQuery.extend(!0,{},e),r=widgetPreview.getCurrentDashZoneDims();widgetPreview.setScalingInformation(d,e.scalingMethod,t,i),widgetPreview.resizeDashboardCols();var n=widgetPreview.mediaChangeProjection(d,r,t);d=n.referenceFrame,r=n.targetFrame,widgetPreview.setScalingInformation(d,e.scalingMethod,t,i),widgetPreview.resizeDashboard(r)}return{initContainers:a,loadDashboard:async function(e,o){let s=JSON.stringify(e.data);s=s.replace(/[\u007F-\uFFFF]/g,(function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).substr(-4)}));var i="";try{i=JSON.parse(s)}catch(e){return void swal("JSON Parse error",e.message,"error")}for(var t in await pyodideLib.deserialize(e),datanodesManager.load(i,!0),a(e,o),e.dashboard)if(_.isEmpty(e.dashboard[t].modelParameters)||(modelsParameters[t]=e.dashboard[t].modelParameters),_.isEmpty(e.dashboard[t].modelHiddenParams)||(modelsHiddenParams[t]=e.dashboard[t].modelHiddenParams),_.isUndefined(modelsTempParams[t])){var d=t.substring(0,t.length-1);modelsTempParams[t]=jQuery.extend(!0,{},modelsTempParams[d])}switch(!!_.isUndefined(e.meta.schedulerLogOff)||e.meta.schedulerLogOff,$("html").attr("data-theme",e.device.theme),widgetPreview.deserialize(e.connections),widgetPreview.renderDashboardWidgets(e,!0),$(".dropperR").css("background-color",e.device.backgroundColor),e.exportOptions){case"rowToPage":rowToPageRuntime.rowToPageModeInit(e);break;case"rowToTab":rowToTabRuntime.rowToTabModeInit(e);break;case"customNavigation":customNavigationRuntime.customNavigationModeInit(e);break;case"projectToTargetWindow":customNavigationRuntime.setJsonContent(e)}setTimeout((()=>{widgetPreview.assignValueChangeHandlers()}),2e3)}}}();
var reconstructFoundations=function(){var e=401;function t(e){var t=document.getElementById("DropperDroitec");_.isUndefined(e.scaling)?(t.style.width="100",t.style.height="100"):(t.style.width=e.scaling.widthVw,t.style.height=e.scaling.heightVh),function(e){var t,i,n;if(_.isUndefined(e.device)?(t="",i=0,n=0):(t=e.device.cols.classType,i=e.device.cols.maxCells,n=e.device.cols.maxCols),0!=i)for(var r=document.getElementById("DropperDroitec"),o=i/n,a=1;a<=o;a++)for(var d=1+(a-1)*n;d<=a*n;d++){var s=document.createElement("div");s.setAttribute("class",t+" device-col"),s.setAttribute("id","dpr"+d+"c"),s.style.height=e.scaling.colDims.heightVh+"vh",r.appendChild(s),$("#dpr"+d+"c").hasClass("col-invisible")||$("#dpr"+d+"c").addClass("col-invisible")}}(e)}function i(t,i){var n=document.getElementById(i),r=function(t){var i=document.createElement("div");i.id=t.container.instanceId+"c",i.style.top=t.layout.top,i.style.left=t.layout.left,i.style.width=t.layout.width,i.style.height=t.layout.height,_.isUndefined(t.layout["z-index"])||(i.style["z-index"]=t.layout["z-index"]);i.style.position="absolute",i.style.cursor="default";var n=document.createElement("div");return n.id="WidgetContainer"+e+"c",e++,n.style.width=rmUnit(t.layout.width)-100/document.documentElement.clientWidth*2+"vw",n.style.height=rmUnit(t.layout.height)-100/document.documentElement.clientHeight*2+"vh",i.appendChild(n),i}(t);n.appendChild(r)}function n(e){reconstructFoundations.buildDivsFromXprjson(e);var t=e.exportOptions;_.isUndefined(e)||_.isUndefined(e.meta)||(document.title=e.meta.name),RuntimeDashboard.loadDashboard(e,t)}function r(e){var t=findGetParameter("inputParams");if(null!=t){var i=inputHandler.decodeInputPars(t);e=inputHandler.patchInputVariables(e,i)}}return{buildDivsFromXprjson:function(e){t(e),function(e){var t;if(_.isEmpty(e.device)||_.isEmpty(e.device.droppers))for(t in e.dashboard)i(e.dashboard[t],"DropperDroitec");else for(var n in e.device.droppers){var r=_.values(e.device.droppers[n]);for(var o in r)i(e.dashboard[r[o]],n+"c")}}(e)},loadXprjson:function(e){var t=findGetParameter("projectUrl");if(null==t){var i=e;e=r(e),n(i)}else $.get(t,(function(e){})).done((function(i){var o;try{o=JSON.parse(i),e=r(o),n(o)}catch(e){swal("Unable to parse "+t+" project",e,"error"),$(".wrapperloading").hide()}})).fail((function(e,t){datanodesManager.showLoadingIndicator(!1),swal("Error in loading xprjson from URL","Server response : "+e.status,"error")}))}}}();
var xdashNotifications=function(){var t=null,a=null;function e(){t&&a||(t=angular.element(document.body),(a=t.scope().$root).pageScalingMethod="ajustToTargetWindow")}return{addNotification:function(t,n){e(),a.notificationsDisabled||t.title&&t.text&&t.type&&(a.PnotifyStatus=false,a.listNotifications.unshift(t),a.nbNotifications++,n||a.PnotifyStatus||(a.PnotifyStatus=!0,setTimeout((function(){a.PnotifyStatus=!1,function(t){let a=new PNotify({title:t.title,text:t.text,type:t.type,delay:1800,styling:"bootstrap3"});$(".ui-pnotify-container").on("click",(function(){a.remove()}))}(t)}),300)),a.safeApply())},manageNotification:function(t,n,i,o){if(e(),a.navBarNotification){var s="dataNode",c="",d="",r="",f=!0;switch(t){case"warning":c="warning",d="Warning",r="assets/img/flat-icon/warning.png";break;case"success":c="success",d="Success",r="assets/img/flat-icon/success.png";break;case"error":c="error",d="Error",r="assets/img/flat-icon/error.png";break;default:c="info",d="Info",r="assets/img/flat-icon/info.png"}if(!_.isUndefined(datanodesManager.getDataNodeByName(n))){if(_.isUndefined(datanodesManager.getDataNodeByName(n).__notifications)&&(datanodesManager.getDataNodeByName(n).__notifications=[]),o){f=!1;var g="none";datanodesManager.getDataNodeByName(n).__notifications.length>0&&(g=datanodesManager.getDataNodeByName(n).__notifications[datanodesManager.getDataNodeByName(n).__notifications.length-1].type),"error"!==g&&"warning"!==g||(f=!0)}if(f){datanodesManager.getDataNodeByName(n).__notifications.push({type:c,title:d,text:i,kind:s,dataNode:n,img:r,time:(new Date).timeNow()});var l=!1,N="";null!==datanodesManager.getDataNodeByName(n).execInstance()&&(N=datanodesManager.getDataNodeByName(n).execInstance().getSchedulerCallOrigin()),datanodesManager.getDataNodeByName(n).sampleTime()<"60"&&"timer"==N&&(l=!0),xdashNotifications.addNotification({type:c,title:d,text:i,kind:s,dataNode:n,img:r,time:(new Date).timeNow()},l)}}}},clearAllNotifications:function(){e(),a.listNotifications=[],a.nbNotifications=0,a.safeApply()}}}();