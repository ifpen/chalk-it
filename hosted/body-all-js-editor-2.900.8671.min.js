/*!
 * ClockPicker v0.0.7 (http://weareoutman.github.io/clockpicker/)
 * Copyright 2014 Wang Shenwei.
 * Licensed under MIT (https://github.com/weareoutman/clockpicker/blob/gh-pages/LICENSE)
 */
!function(){var t,i,e,s,o=window.jQuery,c=o(window),n=o(document),a="http://www.w3.org/2000/svg",r="SVGAngle"in window&&((e=document.createElement("div")).innerHTML="<svg/>",i=(e.firstChild&&e.firstChild.namespaceURI)==a,e.innerHTML="",i),p="transition"in(s=document.createElement("div").style)||"WebkitTransition"in s||"MozTransition"in s||"msTransition"in s||"OTransition"in s,l="ontouchstart"in window,h="mousedown"+(l?" touchstart":""),u="mousemove.clockpicker"+(l?" touchmove.clockpicker":""),k="mouseup.clockpicker"+(l?" touchend.clockpicker":""),d=navigator.vibrate?"vibrate":navigator.webkitVibrate?"webkitVibrate":null;function f(t){return document.createElementNS(a,t)}function v(t){return(t<10?"0":"")+t}var m=0;var b=p?350:1,g=['<div class="popover clockpicker-popover">','<div class="arrow"></div>','<div class="popover-title">','<span class="clockpicker-span-hours text-primary"></span>'," : ",'<span class="clockpicker-span-minutes"></span>','<span class="clockpicker-span-am-pm"></span>',"</div>",'<div class="popover-content">','<div class="clockpicker-plate">','<div class="clockpicker-canvas"></div>','<div class="clockpicker-dial clockpicker-hours"></div>','<div class="clockpicker-dial clockpicker-minutes clockpicker-dial-out"></div>',"</div>",'<span class="clockpicker-am-pm-block">',"</span>","</div>","</div>"].join("");function w(i,e){var s,c,a=o(g),p=a.find(".clockpicker-plate"),l=a.find(".clockpicker-hours"),d=a.find(".clockpicker-minutes"),w=a.find(".clockpicker-am-pm-block"),M="INPUT"===i.prop("tagName"),A=M?i:i.find("input"),V=i.find(".input-group-addon"),T=this;if(this.id=(c=++m+"",(s="cp")?s+c:c),this.element=i,this.options=e,this.isAppended=!1,this.isShown=!1,this.currentView="hours",this.isInput=M,this.input=A,this.addon=V,this.popover=a,this.plate=p,this.hoursView=l,this.minutesView=d,this.amPmBlock=w,this.spanHours=a.find(".clockpicker-span-hours"),this.spanMinutes=a.find(".clockpicker-span-minutes"),this.spanAmPm=a.find(".clockpicker-span-am-pm"),this.amOrPm="PM",e.twelvehour){var C=['<div class="clockpicker-am-pm-block">','<button type="button" class="btn btn-sm btn-default clockpicker-button clockpicker-am-button">',"AM</button>",'<button type="button" class="btn btn-sm btn-default clockpicker-button clockpicker-pm-button">',"PM</button>","</div>"].join("");o(C);o('<button type="button" class="btn btn-sm btn-default clockpicker-button am-button">AM</button>').on("click",(function(){T.amOrPm="AM",o(".clockpicker-span-am-pm").empty().append("AM")})).appendTo(this.amPmBlock),o('<button type="button" class="btn btn-sm btn-default clockpicker-button pm-button">PM</button>').on("click",(function(){T.amOrPm="PM",o(".clockpicker-span-am-pm").empty().append("PM")})).appendTo(this.amPmBlock)}e.autoclose||o('<button type="button" class="btn btn-sm btn-default btn-block clockpicker-button">'+e.donetext+"</button>").click(o.proxy(this.done,this)).appendTo(a),"top"!==e.placement&&"bottom"!==e.placement||"top"!==e.align&&"bottom"!==e.align||(e.align="left"),"left"!==e.placement&&"right"!==e.placement||"left"!==e.align&&"right"!==e.align||(e.align="top"),a.addClass(e.placement),a.addClass("clockpicker-align-"+e.align),this.spanHours.click(o.proxy(this.toggleView,this,"hours")),this.spanMinutes.click(o.proxy(this.toggleView,this,"minutes")),A.on("focus.clockpicker click.clockpicker",o.proxy(this.show,this)),V.on("click.clockpicker",o.proxy(this.toggle,this));var H,P,x,S,E=o('<div class="clockpicker-tick"></div>');if(e.twelvehour)for(H=1;H<13;H+=1)P=E.clone(),x=H/6*Math.PI,S=80,P.css("font-size","120%"),P.css({left:100+Math.sin(x)*S-13,top:100-Math.cos(x)*S-13}),P.html(0===H?"00":H),l.append(P),P.on(h,I);else for(H=0;H<24;H+=1){P=E.clone(),x=H/6*Math.PI;var D=H>0&&H<13;S=D?54:80,P.css({left:100+Math.sin(x)*S-13,top:100-Math.cos(x)*S-13}),D&&P.css("font-size","120%"),P.html(0===H?"00":H),l.append(P),P.on(h,I)}for(H=0;H<60;H+=5)P=E.clone(),x=H/30*Math.PI,P.css({left:100+80*Math.sin(x)-13,top:100-80*Math.cos(x)-13}),P.css("font-size","120%"),P.html(v(H)),d.append(P),P.on(h,I);function I(i,s){var o=p.offset(),c=/^touch/.test(i.type),a=o.left+100,l=o.top+100,h=(c?i.originalEvent.touches[0]:i).pageX-a,d=(c?i.originalEvent.touches[0]:i).pageY-l,f=Math.sqrt(h*h+d*d),v=!1;if(!s||!(f<67||f>93)){i.preventDefault();var m=setTimeout((function(){t.addClass("clockpicker-moving")}),200);r&&p.append(T.canvas),T.setHand(h,d,!s,!0),n.off(u).on(u,(function(t){t.preventDefault();var i=/^touch/.test(t.type),e=(i?t.originalEvent.touches[0]:t).pageX-a,s=(i?t.originalEvent.touches[0]:t).pageY-l;(v||e!==h||s!==d)&&(v=!0,T.setHand(e,s,!1,!0))})),n.off(k).on(k,(function(i){n.off(k),i.preventDefault();var o=/^touch/.test(i.type),c=(o?i.originalEvent.changedTouches[0]:i).pageX-a,r=(o?i.originalEvent.changedTouches[0]:i).pageY-l;(s||v)&&c===h&&r===d&&T.setHand(c,r),"hours"===T.currentView?T.toggleView("minutes",b/2):e.autoclose&&(T.minutesView.addClass("clockpicker-dial-out"),setTimeout((function(){T.done()}),b/2)),p.prepend(B),clearTimeout(m),t.removeClass("clockpicker-moving"),n.off(u)}))}}if(p.on(h,(function(t){0===o(t.target).closest(".clockpicker-tick").length&&I(t,!0)})),r){var B=a.find(".clockpicker-canvas"),z=f("svg");z.setAttribute("class","clockpicker-svg"),z.setAttribute("width",200),z.setAttribute("height",200);var O=f("g");O.setAttribute("transform","translate(100,100)");var j=f("circle");j.setAttribute("class","clockpicker-canvas-bearing"),j.setAttribute("cx",0),j.setAttribute("cy",0),j.setAttribute("r",2);var L=f("line");L.setAttribute("x1",0),L.setAttribute("y1",0);var U=f("circle");U.setAttribute("class","clockpicker-canvas-bg"),U.setAttribute("r",13);var W=f("circle");W.setAttribute("class","clockpicker-canvas-fg"),W.setAttribute("r",3.5),O.appendChild(L),O.appendChild(U),O.appendChild(W),O.appendChild(j),z.appendChild(O),B.append(z),this.hand=L,this.bg=U,this.fg=W,this.bearing=j,this.g=O,this.canvas=B}y(this.options.init)}function y(t){t&&"function"==typeof t&&t()}w.DEFAULTS={default:"",fromnow:0,placement:"bottom",align:"left",donetext:"完成",autoclose:!1,twelvehour:!1,vibrate:!0},w.prototype.toggle=function(){this[this.isShown?"hide":"show"]()},w.prototype.locate=function(){var t=this.element,i=this.popover,e=t.offset(),s=t.outerWidth(),o=t.outerHeight(),c=this.options.placement,n=this.options.align,a={};switch(i.show(),c){case"bottom":a.top=e.top+o;break;case"right":a.left=e.left+s;break;case"top":a.top=e.top-i.outerHeight();break;case"left":a.left=e.left-i.outerWidth()}switch(n){case"left":a.left=e.left;break;case"right":a.left=e.left+s-i.outerWidth();break;case"top":a.top=e.top;break;case"bottom":a.top=e.top+o-i.outerHeight()}i.css(a)},w.prototype.show=function(i){if(!this.isShown){y(this.options.beforeShow);var e=this;this.isAppended||(t=o(document.body).append(this.popover),c.on("resize.clockpicker"+this.id,(function(){e.isShown&&e.locate()})),this.isAppended=!0);var s=((this.input.prop("value")||this.options.default||"")+"").split(":");if("now"===s[0]){var a=new Date(+new Date+this.options.fromnow);s=[a.getHours(),a.getMinutes()]}this.hours=+s[0]||0,this.minutes=+s[1]||0,this.spanHours.html(v(this.hours)),this.spanMinutes.html(v(this.minutes)),this.toggleView("hours"),this.locate(),this.isShown=!0,n.on("click.clockpicker."+this.id+" focusin.clockpicker."+this.id,(function(t){var i=o(t.target);0===i.closest(e.popover).length&&0===i.closest(e.addon).length&&0===i.closest(e.input).length&&e.hide()})),n.on("keyup.clockpicker."+this.id,(function(t){27===t.keyCode&&e.hide()})),y(this.options.afterShow)}},w.prototype.hide=function(){y(this.options.beforeHide),this.isShown=!1,n.off("click.clockpicker."+this.id+" focusin.clockpicker."+this.id),n.off("keyup.clockpicker."+this.id),this.popover.hide(),y(this.options.afterHide)},w.prototype.toggleView=function(t,i){var e=!1;"minutes"===t&&"visible"===o(this.hoursView).css("visibility")&&(y(this.options.beforeHourSelect),e=!0);var s="hours"===t,c=s?this.hoursView:this.minutesView,n=s?this.minutesView:this.hoursView;this.currentView=t,this.spanHours.toggleClass("text-primary",s),this.spanMinutes.toggleClass("text-primary",!s),n.addClass("clockpicker-dial-out"),c.css("visibility","visible").removeClass("clockpicker-dial-out"),this.resetClock(i),clearTimeout(this.toggleViewTimer),this.toggleViewTimer=setTimeout((function(){n.css("visibility","hidden")}),b),e&&y(this.options.afterHourSelect)},w.prototype.resetClock=function(t){var i=this.currentView,e=this[i],s="hours"===i,o=e*(Math.PI/(s?6:30)),c=s&&e>0&&e<13?54:80,n=Math.sin(o)*c,a=-Math.cos(o)*c,p=this;r&&t?(p.canvas.addClass("clockpicker-canvas-out"),setTimeout((function(){p.canvas.removeClass("clockpicker-canvas-out"),p.setHand(n,a)}),t)):this.setHand(n,a)},w.prototype.setHand=function(t,i,e,s){var c,n=Math.atan2(t,-i),a="hours"===this.currentView,p=Math.PI/(a||e?6:30),l=Math.sqrt(t*t+i*i),h=this.options,u=a&&l<67,k=u?54:80;if(h.twelvehour&&(k=80),n<0&&(n=2*Math.PI+n),n=(c=Math.round(n/p))*p,h.twelvehour?a?0===c&&(c=12):(e&&(c*=5),60===c&&(c=0)):a?(12===c&&(c=0),c=u?0===c?12:c:0===c?0:c+12):(e&&(c*=5),60===c&&(c=0)),this[this.currentView]!==c&&d&&this.options.vibrate&&(this.vibrateTimer||(navigator[d](10),this.vibrateTimer=setTimeout(o.proxy((function(){this.vibrateTimer=null}),this),100))),this[this.currentView]=c,this[a?"spanHours":"spanMinutes"].html(v(c)),r){s||!a&&c%5?(this.g.insertBefore(this.hand,this.bearing),this.g.insertBefore(this.bg,this.fg),this.bg.setAttribute("class","clockpicker-canvas-bg clockpicker-canvas-bg-trans")):(this.g.insertBefore(this.hand,this.bg),this.g.insertBefore(this.fg,this.bg),this.bg.setAttribute("class","clockpicker-canvas-bg"));var f=Math.sin(n)*k,m=-Math.cos(n)*k;this.hand.setAttribute("x2",f),this.hand.setAttribute("y2",m),this.bg.setAttribute("cx",f),this.bg.setAttribute("cy",m),this.fg.setAttribute("cx",f),this.fg.setAttribute("cy",m)}else this[a?"hoursView":"minutesView"].find(".clockpicker-tick").each((function(){var t=o(this);t.toggleClass("active",c===+t.html())}))},w.prototype.done=function(){y(this.options.beforeDone),this.hide();var t=this.input.prop("value"),i=v(this.hours)+":"+v(this.minutes);this.options.twelvehour&&(i+=this.amOrPm),this.input.prop("value",i),i!==t&&(this.input.triggerHandler("change"),this.isInput||this.element.trigger("change")),this.options.autoclose&&this.input.trigger("blur"),y(this.options.afterDone)},w.prototype.remove=function(){this.element.removeData("clockpicker"),this.input.off("focus.clockpicker click.clockpicker"),this.addon.off("click.clockpicker"),this.isShown&&this.hide(),this.isAppended&&(c.off("resize.clockpicker"+this.id),this.popover.remove())},o.fn.clockpicker=function(t){var i=Array.prototype.slice.call(arguments,1);return this.each((function(){var e=o(this),s=e.data("clockpicker");if(s)"function"==typeof s[t]&&s[t].apply(s,i);else{var c=o.extend({},w.DEFAULTS,e.data(),"object"==typeof t&&t);e.data("clockpicker",new w(e,c))}}))}}();
function DatanodeDependency(){var e={},n=[],t=[],o=[];function r(e,n){var t,o,r,s=[];[t,o]=c();var a=new Set;if(e.forEach((function(e){let n=new Set(t.getDescendants(e));n.add(e),s.push(n)})),1==e.length&&0==n.length)n.push(s[0]);else for(let e=0;e<s.length;e++){a=s[e];for(let n=e+1;n<s.length;n++){0!=new Set([...a].filter(e=>s[n].has(e))).size&&(a=union(a,s[n]))}if(0==n.length)n.push(a);else{for(let e in n){let t=new Set([...a].filter(t=>n[e].has(t)));if(0!=t.size){t.size<a.size&&(a=union(a,n[e]),n.splice(e,1,a)),r=!0;break}r=!1}r||n.push(a)}a=new Set}let i=0;return n.forEach((function(e){e.id=e.values().next().value+Math.random(),e.index=i,i++})),n}function s(){var e=i();t=r(e,[]),offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("All disconnected Graphs: ",t),o=[],t.some((function(e){1==e.size&&e.forEach((function(e,n,t){o.push(n)}))}))}function a(e){return o.includes(e)}function i(){var e=d(),n=e.nodes(),t=[];for(var o in n)0==e.indegree(n[o])&&t.push(n[o]);return t}function c(){var n,t=new Graph,o=!1;for(n in e){var r=n,s=[];for(var a in e[n].forEach((function(e){s.push(e)})),t.add(r,s),s)s[a]===r&&(o=!0)}return[t,o]}function d(){var n=new GraphDS;for(var t in e){var o=t;n.addNode(o),e[t].forEach((function(e){n.addEdge(o,e)}))}return n}return{dependencyStructure:e,addNode:function(n){e[n]=new Set},removeNode:function(n){for(var t in delete e[n],e)e[t].has(n)&&e[t].delete(n)},addEdge:function(n,t){e[n].add(t)},removeEdge:function(n,t){e[n].delete(t)},removeMissedDependantDatanodes:function(n,t){for(var o in e)n.has(o)||e[o].has(t)&&e[o].delete(t)},getSuccessors:function(n){return e[n].values()},getPredecessorsSet:function(n){var t=new Set;for(var o in e)e[o].has(n)&&t.add(o);return t},hasSuccessors:function(n){return e[n].size>0},hasPredecessors:function(n){var t=!1;for(var o in e)if(e[o].has(n)){t=!0;break}return t},getSourceNodes:i,getDescendantsinBFS:function(e){},getDescendants:function(e){var n,t;return[n,t]=c(),startNodesDesc=new Set,e.forEach((function(e){elemDesc=new Set(n.getDescendants(e)),startNodesDesc=union(startNodesDesc,elemDesc)})),startNodesDesc},getDisconnectedGraphs:r,getBelongingDisconnectedGraph:function(e,n){var t;return n.some((function(n){n.has(e)&&(offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("node ",e," is found in disconnected graph: ",n),t=n)})),t},computeAllDisconnectedGraphs:s,getAllDisconnectedGraphs:function(){return t},resetGraphList:function(){t=[],o=[]},isNode:function(n){return!_.isUndefined(e[n])},renameNode:function(n,t){for(var o in e)e[o].has(n)&&(e[o].delete(n),e[o].add(t));var r=e[n];delete e[n],e[t]=r},topologicalSort:function(){var e=d();return e.nodes().forEach((function(n){datanodesManager.foundDatanode(n)||e.removeNode(n)})),e.topologicalSort()},detectCycles:function(){var e,n;return[e,n]=c(),{hasCycle:e.hasCycle(),getCycles:e.getCycles(),hasLoop:n}},getExtraStartNodes:function(){return n},setExtraStartNodes:function(e,t){_.isUndefined(n[e])||xdashNotifications.manageNotification("info",e,e+" is called many consecutif times while scheduler is in progress"),n[e]=t},clearExtraStartNodes:function(){for(var e in n)delete n[e]},getAllsingletonNodes:function(){return offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("SingletonNodeList: ",o),o},isSingletonNode:a,updateDisconnectedGraphsList:function(e,n){switch(n){case"add":s();break;case"delete":a(e)?function(e){t.some((function(n){if(n.has(e)){n.delete(e);let t=o.indexOf(e);o.splice(t,1)}}))}(e):s();break;case"default":s()}}}}
function GraphVisu(e){var t,n,o,a,r,d=null,i=[],c=[],l={},s=[],u=[];let g=[],p=[],f=[],h=0;function v(e){let t=datanodesManager.getDataNodeByName(e).beautifulString();void 0===t&&(t="NO DATA");var n=document.createElement("div");return n.innerHTML=t,n}function m(e){y();var i={scale:o,offset:{x:t,y:n},animation:{duration:a,easingFunction:r}};d.focus(e,i)}function y(){t=0,n=0,a=1e3,o=3,positionx=300,positiony=300,r="easeInOutQuint"}function b(){y();var e={offset:{x:t,y:n},duration:a,easingFunction:r};d.fit({animation:e})}return $("#inputSearchGraph").on("input",(function(e){var t,n=$(this).val();h=0;for(let e=0;e<u.length;e++)i.update([{id:l[u[e].label],font:{color:"#0843b9",background:"#e3ecff"}}]),u[e].label.toLowerCase().match(n)&&n.length>2&&(i.update([{id:l[u[e].label],font:{color:"white",background:"black"}}]),t=u[e].label,h++);1===h?m(l[t]):b()})),$("#exportGraph").on("click",(function(){var e=document.getElementById("canvas");console.log("mynetworkCanvas",e),e.toBlob((function(e){var t=document.createElement("a");document.body.appendChild(t),t.download="network.png",t.href=window.URL.createObjectURL(e),t.click()}))})),$("#openFullScreen").on("click",(function(){var e=document.getElementById("dependencyGraphBody");e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen()})),$("#zoomIn").on("click",(function(){d.setScale(d.getScale()+.3)})),$("#zoomOut").on("click",(function(){d.setScale(d.getScale()-.3)})),{showDepGraph:function(t){let n=datanodesManager.getAllDataNodes(),o=[];for(let e in n)o[e]=n[e].name();let a=[];for(var r=0;r<o.length;r++)a.push({id:r,label:o[r],title:v(o[r]),type:datanodesManager.getDataNodeByName(o[r]).type(),disconnected:e.isSingletonNode(o[r]),widgetConnection:datanodesManager.isConnectedWithWidgt(o[r])[0]}),l[o[r]]=r;u=a;let s=[],p=[];for(var f=0;f<o.length;f++){p=Array.from(e.dependencyStructure[o[f]]);for(var h=0;h<p.length;h++)s.push({from:f,to:l[p[h]],arrows:"to"})}i=new vis.DataSet(a),c=new vis.DataSet(s),function(e,t){var n=$('<div id="dependencyGraphBody" class="modal-body" style="vertical-align: middle; overflow: auto; display: block; margin: auto; width: 938px; height: 625px; border: 1px solid lightgray;"></div>');document.getElementById("dependencyGraph").hasChildNodes()||n.appendTo($("#dependencyGraph"));var o=document.getElementById("dependencyGraphBody");d=new vis.Network(o,e,{layout:{randomSeed:3},nodes:{borderWidth:1,font:{size:15,color:"#0843b9"},color:{border:"#478dec",background:"#e3ecff"},shape:"box",margin:15},edges:{color:"#9fb8ed"},interaction:{hover:!0,zoomView:!0},physics:{forceAtlas2Based:{theta:.2,gravitationalConstant:-65,centralGravity:.015,springLength:70,damping:.7,avoidOverlap:.95},minVelocity:20,solver:"forceAtlas2Based",timestep:.1}}),$("#dependencyGraphBody canvas").attr("id","canvas"),d.on("doubleClick",(function(e){var t=e.nodes[0];let n=datanodesManager.getAllDataNodes();datanodesManager.editNodeFromGraph(n[t])}));var a=document.getElementById("dependencyGraphBody").getElementsByTagName("canvas")[0];d.on("hoverNode",(function(){a.style.cursor="pointer"})),d.on("blurNode",(function(){a.style.cursor="default"})),d.on("stabilizationIterationsDone",(function(){!function(e){if(g=[],"string"==typeof e)i.update([{id:l[e],color:{background:"orange"}}]),m(l[e]);else if("object"==typeof e){e=JSON.parse(e.target.attributes.name.value);for(let t=0;t<e.length;t++)g.push({id:l[e[t]],color:{background:"orangered"}});i.update(g),1===e.length&&m(l[e[0]])}}(t)})),vis.Network.prototype.setScale=function(e){var t={position:{x:0,y:0},scale:e,animation:{duration:300}};t.scale>=0&&this.view.moveTo(t)}}({nodes:i,edges:c},t)},selectNodeFromTagList:function(e){var t=document.getElementById(e),n=[];if(t.classList.contains("active")){t.classList.remove("active");for(let t=0;t<p.length;t++)p[t].type===e&&(p[t].color={background:"#e3ecff"},n.push(p[t]));i.update(p),b(),-1!==s.indexOf(e)&&s.splice(s.indexOf(e),1);for(let e=0;e<n.length;e++)p.splice(p.indexOf(n[e]),1)}else{h=0,-1===s.indexOf(e)&&s.push(e),t.classList.add("active");for(let t=0;t<u.length;t++)u[t].type===e&&(p.push({id:l[u[t].label],type:e,color:{background:"yellow"}}),h++);i.update(p),1===h?m(p[0].id.toString()):b()}},selectConnectedWithWidget:function(e){var t=document.getElementById(e),n=[];if(t.classList.contains("active")){t.classList.remove("active");for(let t=0;t<f.length;t++)"green"===f[t].color.border&&"connectedtowidget"===e&&(f[t].color={border:"#478dec"},f[t].borderWidth=1,n.push(f[t])),"red"===f[t].color.border&&"notconnectedtowidget"===e&&(f[t].color={border:"#478dec"},f[t].borderWidth=1,n.push(f[t]));i.update(f),b();for(let e=0;e<n.length;e++)f.splice(f.indexOf(n[e]),1)}else{h=0,t.classList.add("active");for(let t=0;t<u.length;t++)!0===u[t].widgetConnection&&"connectedtowidget"===e&&(f.push({id:l[u[t].label],borderWidth:3,color:{border:"green"}}),h++),!1===u[t].widgetConnection&&"notconnectedtowidget"===e&&(f.push({id:l[u[t].label],borderWidth:3,color:{border:"red"}}),h++);i.update(f),1===h?m(f[f.length-1].id.toString()):b()}},closeGraph:function(){for(g=[],p=[],f=[],h=0,$("#inputSearchGraph").val("");s.length;){for(var e=0;e<s.length;e++){document.getElementById(s[e]).classList.remove("active")}s.pop()}document.getElementById("connectedtowidget").classList.remove("active"),document.getElementById("notconnectedtowidget").classList.remove("active")}}}
function DatanodesListModel(e,a,t,s){var n=this,d=[];function r(a){var d=new DatanodeModel(n,e,t,s);return d.deserialize(a)?(n.addDatanode(d),!0):(n.error(!0),!1)}this.datanodes=ko.observableArray(),this.datasourceData={},this.processDatanodeUpdate=function(e,a){n.datasourceData[e]=a},this.renameDatanodeData=function(e,a){n.datasourceData[a]=n.datasourceData[e],delete n.datasourceData[e]},this._datanodeTypes=ko.observable(),this.datanodeTypes=ko.computed({read:function(){n._datanodeTypes();var a=[];return _.each(e,(function(e){var t=e.type_name,s=t;_.isUndefined(e.display_name)||(s=e.display_name),a.push({name:t,display_name:s})})),a}}),this.serialize=function(){var e=[];_.each(n.datanodes(),(function(a){e.push(a.serialize())}));var a=angular.element(document.body).scope().$root;return a.alldatanodes=datanodesManager.getAllDataNodes(),a.showNotifications=!1,a.safeApply(),{datanodes:e}},this.deserialize=function(e,a,o){return a&&n.clear(),function(){n.error=ko.observable(!1),d=[];var a,i=[];_.isUndefined(e.datanodes)&&(e.datanodes=e.datasources,delete e.datasources);for(let a=0;a<e.datanodes.length;a++)"REST_web-service_from_datasource"===e.datanodes[a].type||"FMI_web-service_from_datasource"===e.datanodes[a].type||"Map_matching_from_datasource"===e.datanodes[a].type||"Clock_web-service"===e.datanodes[a].type||"Generic_file_reader_plugin"===e.datanodes[a].type||e.datanodes[a].type;if(i=e.datanodes,_.each(i,(function(e){if(function(e){for(var a=!1,t=0;t<n.datanodes().length;t++)if(a=!1,n.datanodes()[t].name()==e){a=!0;break}return!!a}(e.name))d.push(e);else if(!r(e))return!1})),0!=d.length&&(a=xdsjson.getDuplicateDataList(d,"Please check data to be loaded after choosing rename or overwite option"),new DialogBoxForDuplicateData(a,"List of duplicate data name","Load","Close",(function(){var e=0;for(e=0;e<d.length;e++)$("#data-checkbox-"+e).is(":checked")&&(d[e].name=$("#data-check-"+e)[0].value);for(e=0;e<d.length;e++)if($("#data-checkbox-"+e).is(":checked"))if(d[e].name=$("#data-check-"+e)[0].value,$("#data-rename-"+e).is(":checked"))r(d[e]);else for(var a=0;a<n.datanodes().length;a++)if(n.datanodes()[a].name()==d[e].name){n.deleteDatanode(n.datanodes()[a]),n.datanodes.remove(n.datanodes()[a]),r(d[e]);break}}))),n.datanodes().length>0){var c=!1,l=Object.keys(t.dependencyStructure).length-i.length;if(0!=l)for(var f in t.dependencyStructure){c=!1;for(var u=0;u<i.length;u++)if(f===i[u].name){c=!0;break}if(!c){var h=Array.from(t.getSuccessors(f));swal("Missed dataNodes!","'"+f+"' is referenced in formula of '"+h+"' but doesn't exist in list of datanodes","error"),l--}if(0==l)break}for(var g=!1,m=!1,p=0,v=0,b=0;b<n.datanodes().length;b++){i=n.datanodes()[b],_.isUndefined(i.settings().refresh)?_.isUndefined(i.settings().refresh_time)?_.isUndefined(i.settings().refresh_rate)?_.isUndefined(i.settings().refreshRate)||(i.settings().sampleTime=i.settings().refreshRate,delete i.settings().refreshRate):(i.settings().sampleTime=i.settings().refresh_rate,delete i.settings().refresh_rate):(i.settings().sampleTime=i.settings().refresh_time,delete i.settings().refresh_time):(i.settings().sampleTime=i.settings().refresh,delete i.settings().refresh);const a=e.version,t=/^(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)$/.exec(a);if(t){const e=parseInt(t[1],10),a=parseInt(t[2],10);(e<2||2===e&&a<890)&&i.settings().explicitTrig&&i.settings().autoStart&&(i.settings().autoStart=!1)}}t.computeAllDisconnectedGraphs();for(b=0;b<n.datanodes().length;b++)i=n.datanodes()[b],_.isUndefined(i.settings().sampleTime)||0==i.settings().sampleTime?(m=!0,v=b):(g=!0,p=b,i.sampleTime(i.settings().sampleTime),s.registerDatanode(i.sampleTime(),i.name(),"globalFirstUpdate"));g&&(i=n.datanodes()[p],s.registerDatanode(i.sampleTime(),i.name())),m&&(i=n.datanodes()[v],n.launchGlobalFirstUpdate(i))}_.isFunction(o)&&o()}(),!n.error()},this.launchGlobalFirstUpdate=function(e){var a=t.getSourceNodes();0!=a.length&&e.schedulerStart(a,a[0],"globalFirstUpdate")},this.clear=function(){if(Object.keys(t.getExtraStartNodes()).length&&t.clearExtraStartNodes(),_.each(n.datanodes(),(function(e){n.deleteDatanode(e)})),Object.keys(t.dependencyStructure).length)for(var e in t.dependencyStructure)t.removeNode(e),console.log("extra nodes are deleted");t.resetGraphList(),n.datanodes.removeAll()},this.load=function(e,t,s){a.showLoadingIndicator(!0),n.deserialize(e,t,(function(){return a.showLoadingIndicator(!1),_.isFunction(s)&&s(),!n.error()}))},this.addDatanode=function(e){for(var a=!1,t=0;t<n.datanodes().length;t++)if(a=!1,n.datanodes()[t].name()==e.name()){a=!0;break}a||n.datanodes.unshift(e)},this.deleteDatanode=function(e){var a=e.name();delete n.datasourceData[a],e.dispose()}}
function FormulaInterpreter(e,a,t,n){var s=this;s.bCalculatedSettings=!0,this.callValueFunction=function(a){return a.call(void 0,e.datasourceData)},this.processCalculatedSetting=function(e,t){for(var n="",r=!1,i=t.split("\n"),o=0;o<i.length;o++)for(var c=new RegExp("dataNodes.([\\w\\-]{1,}\\.{0,}[\\w\\-]{0,})|dataNodes\\[['\"]([\\w\\\\\\-]{1,})['\"]\\]((\\[['\"]([\\w\\W]){1,}['\"](?=\\])\\])){0,1}","g");matches=c.exec(i[o]);){var l,d;if(_.isUndefined(matches[1])){l=matches[2].split('"]')[0],d=matches[0];var u=1,m=matches[0].split('"]').length-1;if(m>2)for(var g=0;g<m-2;g++)for(d=matches[0].substring(0,matches[0].length-u),u++;!d.endsWith('"]',d.length);)d=matches[0].substring(0,matches[0].length-u),u++}else l=matches[1].split(".")[0],d=matches[0];try{var f=new Function("dataNodes",d);s.callValueFunction(f)}catch(e){a.statusCallback("Error",e.message),n="var "+l+" in line "+o+" : "+e.message,a.notificationCallback("error",a.settings().name,n,"Error evaluation at datanode : '"+a.name()+"'"),r=!0,s.bCalculatedSettings=!1}}if(!r&&_.isFunction(a.calculatedSettingScripts[e])){var h;try{h=s.callValueFunction(a.calculatedSettingScripts[e])}catch(t){a.statusCallback("Error",t.message),a.notificationCallback("error",a.settings().name,t.message,"Parse error");a.settings()[e];h=null,s.bCalculatedSettings=!1}if(!_.isUndefined(a.datanodeInstance)&&_.isFunction(a.datanodeInstance.onCalculatedValueChanged)){if(!_.isEmpty(t))if(_.isUndefined(h)){n="Parse error while parsing formula in : '"+a.name()+"'",a.notificationCallback("warning",a.settings().name,n,"Parse error"),a.statusCallback("Error","Parse error");try{a.datanodeInstance.onCalculatedValueChanged(e,void 0)}catch(e){console.log(e.toString())}}else if(!_.isNull(h)){n="Success while parsing formula in : '"+a.name()+"'",a.notificationCallback("success",a.settings().name,n,"Parse success",!0);try{a.datanodeInstance.onCalculatedValueChanged(e,h)}catch(e){console.log(e.toString())}}}else console.log("datanodeInstance or onCalculatedValueChanged function is not defined")}return!0},this.updateCalculatedSettings=function(e,r){s.bCalculatedSettings=!0,a.datanodeRefreshNotifications={},a.calculatedSettingScripts={};if(_.isUndefined(a.type()))return!1;var i=t[a.type()].settings,o=new RegExp("dataNodes.([\\w_-]+)|dataNodes\\[['\"]([^'\"]+)","g");const c=/(?=["'])(?:"[^"\\]*(?:\\[\s\S][^"\\]*)*"|'[^'\\]*(?:\\[\s\S][^'\\]*)*')|(#.*$)/gm;var l=a.settings(),d=!0;return _.each(i,(function(t){if("calculated"==t.type||"custom2"==t.type){var i=l[t.name];if(!_.isUndefined(i)){var u,m;if(i=(i=(i="custom2"==t.type?i.replace(c,(function(e,a){return null==a?e:""})):i.replace(/\/\*[\s\S]*?\*\/|([^\\:]|^)\/\/.*$/gm,"$1")).replace(/datasources/g,"dataNodes")).replace(/headersFromDatasourceWS/g,"headersFromDataNodeWS"),_.isArray(i)&&(i="["+i.join(",")+"]"),(i.match(/;/g)||[]).length<=1&&-1==i.indexOf("return")&&(_.isEmpty(i)?_.isUndefined(a.settings().method)||"POST"==a.settings().method&&(p="Cannot have an empty body with a POST method",a.notificationCallback("warning",l.name,p,"Cannot have an empty body with a POST method in datanode : '"+a.name()+"'")):i="return "+i),"custom2"!=t.type)try{u=new Function("dataNodes",i)}catch(e){p=e+".\n Formula interpreted as literal text",a.notificationCallback("warning",l.name,p,"Syntax error at datanode : '"+a.name()+"'");var g=l[t.name].replace(/"/g,'\\"').replace(/[\r\n]/g," \\\n");u=new Function("dataNodes",'return "'+g+'";')}for(var f=new Set;m=o.exec(i);){var h=m[1]||m[2];if(a.name()===h)return p='DataNode "'+h+'": Please remove from formula the expression dataNodes["'+a.name()+'"].',a.statusCallback("Error"),swal("Loop detection",p,"error"),s.bCalculatedSettings=!1,void(d=!1);if(n.isNode(h)||n.addNode(h),n.addEdge(h,a.name()),f.add(h),!e&&!datanodesManager.foundDatanode(h))return p="DataNode '"+h+"' does not exist in dataNodes list",a.statusCallback("Error",p),a.notificationCallback("error",a.name(),p,"Error in formula"),void(s.bCalculatedSettings=!1);var p="";if(n.detectCycles().hasCycle)return n.removeEdge(h,a.name()),p='Cycle detected while computing dataNode "'+h+'" while parsing formula in : "'+a.name()+'"',a.statusCallback("Error"),swal("Cycle detection",p,"error"),s.bCalculatedSettings=!1,void(d=!1);var C=a.datanodeRefreshNotifications[h];_.isUndefined(C)&&(C=[],a.datanodeRefreshNotifications[h]=C),-1==_.indexOf(C,t.name)&&C.push(t.name)}if(n.removeMissedDependantDatanodes(f,a.name()),"custom2"!=t.type&&(a.calculatedSettingScripts[t.name]=u,r&&!s.processCalculatedSetting(t.name,i)))return s.bCalculatedSettings=!1,void(d=!1)}}})),d}}
function TimeManager(){var e,n,r=[],i=0,o=0,t=[];function a(e,n){_.isUndefined(n)&&(n=e);var r;if(e<n){var i=e;e=n,n=i}return 0==(r=e%n)?n:a(n,r)}function d(e){var n=e;for(var i in r)n=a(r[i],n),offSchedLogUser||xDashConfig.disableSchedulerLog||console.log(o);return n}function l(n){e&&clearInterval(e),e=setInterval((function(){c(!1)}),n),c(!0)}function c(r){if(r)offSchedLogUser||xDashConfig.disableSchedulerLog||console.log(n," timer initialization");else{if(n){var o=datanodesManager.getDataNodeByName(n);o?o.schedulerStart(t,n,"timer"):(clearInterval(e),console.log("initiatorDatanodeModel is undefined"))}else clearInterval(e),console.log("initiatorDatanode is undefined");i+=1}}return{registerDatanode:function(e,a,c){r[a]=e,-1==t.indexOf(a)&&t.push(a),n=t[0],o=d(e),i=0,"globalFirstUpdate"!=c&&l(1e3*o)},unregisterDatanode:function(a){delete r[a];var c=t.indexOf(a);-1!=c?(t.splice(c,1),i=0,0==Object.keys(r).length?(n=void 0,clearInterval(e),e=void 0,o=0):(n=t[0],l(1e3*(o=d())))):offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("error in datanode "+a)},isRegisteredDatanode:function(e){return!_.isUndefined(r[e])},getBasePeriod:function(){return o},getHyperPeriod:function(){},getCurrentTick:function(){return i},getCurrentTime:function(){return i*o}}}
var schedulerProfiling={},schedulerProfilingItem={};function DatanodeScheduler(e,a,t,o,n){if(!_.isUndefined(datanodesManager)){var d=new Set(a),s=new Set,r=new Set,i=new Set,l=new Set,c=new Set;datanodesManager.getAllDataNodes().forEach((function(e){c.add(e.name()),xDashConfig.disableSchedulerProfiling||(schedulerProfiling[e.name()]=[])}));var g=e.getDescendants(a),u=difference(c,g),f=new Set;return u.forEach((function(e){"OK"==datanodesManager.getDataNodeByName(e).status()&&f.add(e)})),{launchSchedule:function(){D()},operationCompleted:function(a,t){var n=!0;switch(t){case"OK":r.add(a),s.delete(a),e.dependencyStructure[a].forEach((function(e){m(e)&&(S(e)?offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("operation "+e+" not added because already executed"):d.add(e))})),offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("operation "+a+" completed with status "+t),xDashConfig.disableSchedulerProfiling||(schedulerProfilingItem.completion=Date.now(),schedulerProfilingItem.status=t,schedulerProfiling[a].push(schedulerProfilingItem)),d.size&&(n=!1,D());break;case"Error":i.add(a),s.delete(a),e.getDescendants([a]).forEach((function(e){i.add(e),datanodesManager.getDataNodeByName(e).statusCallback("None"),datanodesManager.getDataNodeByName(e).updateCallback("","None")})),d=difference(d,i),offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("operation "+a+" completed with status "+t),xDashConfig.disableSchedulerProfiling||(schedulerProfilingItem.completion=Date.now(),schedulerProfilingItem.status=t,schedulerProfiling[a].push(schedulerProfilingItem));break;case"NOP":if("OK"===datanodesManager.getDataNodeByName(a).status()){r.add(a),s.delete(a),e.dependencyStructure[a].forEach((function(e){m(e)&&(S(e)?offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("operation "+e+" not added because already executed"):d.add(e))})),offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("operation "+a+" completed with status "+t),xDashConfig.disableSchedulerProfiling||(schedulerProfilingItem.completion=Date.now(),schedulerProfilingItem.status=t,schedulerProfiling[a].push(schedulerProfilingItem)),d.size&&(n=!1,D());break}"None"===datanodesManager.getDataNodeByName(a).status()||"Error"===datanodesManager.getDataNodeByName(a).status()?(i.add(a),s.delete(a),e.getDescendants([a]).forEach((function(e){i.add(e)})),d=difference(d,i),offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("operation "+a+" completed with status "+t),xDashConfig.disableSchedulerProfiling||(schedulerProfilingItem.completion=Date.now(),schedulerProfilingItem.status=t,schedulerProfiling[a].push(schedulerProfilingItem))):console.log("datanode with explicitTrig ended with status ",datanodesManager.getDataNodeByName(a).status());break;default:return{initiatorNode:o,schedulingInstanceTerminated:!1}}return 0==s.size&&0==d.size&&n?{initiatorNode:o,schedulingInstanceTerminated:!0}:{initiatorNode:o,schedulingInstanceTerminated:!1}},stopAllOperations:function(){d.forEach((function(e){d.delete(e)})),s.forEach((function(e){s.delete(e),datanodesManager.getDataNodeByName(e).completeExecution("NOP"),datanodesManager.getDataNodeByName(e).statusCallback("None"),datanodesManager.getDataNodeByName(e).updateCallback(void 0,"None")}));var e=new Set;for(var a in datanodesManager.getAllDataNodes()){datanodesManager.getAllDataNodes()[a].schedulerStatus("Stop");var t=datanodesManager.getAllDataNodes()[a].getXHR();_.isUndefined(t)||e.add(t)}e.forEach((function(a){a.abort(),e.delete(a)})),null!=datanodesManager.getDataNodeByName(o).execInstance()&&datanodesManager.getDataNodeByName(o).schedulerEnd()},stopOperation:function(e){if(s.has(e)){s.delete(e),datanodesManager.getDataNodeByName(e).completeExecution("NOP"),datanodesManager.getDataNodeByName(e).statusCallback("None"),datanodesManager.getDataNodeByName(e).updateCallback(void 0,"None"),datanodesManager.getDataNodeByName(e).schedulerStatus("Stop");var a=datanodesManager.getDataNodeByName(e).getXHR();_.isUndefined(a)||a.abort()}},getInitiatorNode:function(){return o},getSchedulerCallOrigin:function(){return n},clear:function(){}}}function h(e){if(!_.contains(t,e))return"globalFirstUpdate"!==n;switch(n){case"triggerButton":case"vignette":case"setValue":case"setFile":case"unidentified":case"edit":case"refresh":case"globalFirstUpdate":default:return!1}}function N(e){if(!_.contains(t,e))return!1;switch(n){case"triggerButton":case"vignette":case"setValue":case"setFile":case"refresh":return!0;default:return!1}}function D(){var a=!0,t=!1;d.forEach((function(o){if(0!=d.size){if(_.isUndefined(datanodesManager.getDataNodeByName(o)))return offSchedLogUser||xDashConfig.disableSchedulerLog||console.log(o+" is not treated because it does not exist"),d.delete(o),void i.add(o);switch(datanodesManager.getDataNodeByName(o).statusForScheduler()){case"Ready":if(datanodesManager.foundDatanode(o)){var c=m(o);c?(d.delete(o),s.add(o),offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("operation "+o+" released"),xDashConfig.disableSchedulerProfiling||(schedulerProfilingItem={release:Date.now()}),a=h(o),t=N(o),datanodesManager.getDataNodeByName(o).updateNow(a,t,c)):(d.delete(o),l.add(o),"refresh"==n||"triggerButton"==n?(swal("Update is not available","Predecessors: "+(u=o,D="[",S=e.getPredecessorsSet(u),p=union(r,f),difference(S,p).forEach(e=>{D=D+' "'+e+'" '}),D+' ] of operation "')+o+'" need to be executed first.',"info"),datanodesManager.getDataNodeByName(o).completeExecution("NOP")):"edit"==n||"unidentified"==n?(l.delete(o),s.add(o),offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("operation "+o+" released"),xDashConfig.disableSchedulerProfiling||(schedulerProfilingItem={release:Date.now()}),a=h(o),t=N(o),datanodesManager.getDataNodeByName(o).updateNow(a,t,c)):(offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("operation "+o+" is ready but cannot be executed because of its predecessors."),datanodesManager.getDataNodeByName(o).completeExecution("NOP")))}else{var g=Array.from(e.getSuccessors(o));offSchedLogUser||xDashConfig.disableSchedulerLog||console.log(o+" is referenced in '"+g+"' but not defined as a datanode."),datanodesManager.getDataNodeByName(o).completeExecution("NOP")}break;case"Wait":d.delete(o),l.add(o),m(o)?offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("operation "+o+" is waiting for initialization to be done."):offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("operation "+o+" cannot be executed because of its predecessors."),datanodesManager.getDataNodeByName(o).completeExecution("NOP");break;case"NotReady":case"Stop":d.delete(o),i.add(o),offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("operation "+o+" cannot not be scheduled because it needs initialization."),e.getDescendants([o]).forEach((function(e){i.add(e)})),d=difference(d,i),datanodesManager.getDataNodeByName(o).completeExecution("Error")}var u,D,S,p}else offSchedLogUser||xDashConfig.disableSchedulerLog||console.log(o+" is already treated")}))}function m(a){var t=e.getPredecessorsSet(a),o=union(r,f);return!!isSuperset(o,t)}function S(e){return!!union(r,f).has(e)}}
function DataPreviewFormat(){"undefined"==typeof execOutsideEditor?this.execOutsideEditor=!1:execOutsideEditor?this.execOutsideEditor=!0:this.execOutsideEditor=!1,this.format=function(e){var t="",i="";if("string"==typeof e){if(e.match("base64ImageDetected")){var a=e.replace("base64ImageDetected","");return this.execOutsideEditor||(i='<img src="data:image/jpeg;base64,'+a+'"/>'),e=a,{newData:a,previewData:i}}return e.match("<div>\n<style scoped>\n")?(this.execOutsideEditor||(t=e),{newData:e,previewData:t}):(this.execOutsideEditor||(t=syntaxHighlight(JSON.stringify(e,void 0,4))),{newData:e,previewData:t})}return this.execOutsideEditor||(t=syntaxHighlight(JSON.stringify(e,void 0,4))),{newData:e,previewData:t}}}
DatanodeModel=function(e,t,a,n){var o=this,s=!0;function i(){_.isUndefined(o.datanodeInstance)||(_.isFunction(o.datanodeInstance.onDispose)&&o.datanodeInstance.onDispose(),o.datanodeInstance=void 0)}this.datanodeRefreshNotifications={},this.calculatedSettingScripts={},this.formulaInterpreter=new FormulaInterpreter(e,o,t,a),this.execInstance=ko.observable(null),this.dataPreviewFormat=new DataPreviewFormat,this.name=ko.observable(),this.latestData=ko.observable(),this.beautifulString=ko.observable(),this.status=ko.observable("None"),this.last_updated=ko.observable("never"),this.last_error=ko.observable(),this.last_error_msg=ko.observable("none"),this.error=ko.observable(),this.isSchedulerStartSafe=ko.observable(!1),this.sampleTime=ko.observable(0),this.statusForScheduler=ko.observable("Ready"),this.schedulerStatus=ko.observable("Running"),this.iconType=ko.observable(),this.settings=ko.observable({}),this.settings.subscribe((function(e){if(!_.isUndefined(o.datanodeInstance)&&_.isFunction(o.datanodeInstance.onSettingsChanged)){if(!o.formulaInterpreter.updateCalculatedSettings(!0,!1))return void o.error(!0);o.datanodeInstance.onSettingsChanged(e,o.status())?o.error(!1):o.error(!0)}})),this.completeExecution=function(e){var t,a=o.name(),n={};_.isUndefined(datanodesManager.getDataNodeByName(a))||"Stop"==datanodesManager.getDataNodeByName(a).schedulerStatus()&&"NOP"!==e||(t=_.isUndefined(e)?o.status():e,null!==o.execInstance()?n=o.execInstance().operationCompleted(a,t):"Error"===t?offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("scheduling is already terminated. "+a+" is ended with status = "+o.status()):(offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("statusCallback of "+a+" is called before scheduling instance created. Status = "+o.status()),n={schedulingInstanceTerminated:!1}),n.schedulingInstanceTerminated&&(null==o.execInstance()?offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("scheduling is already terminated. "+a+" is ended with status = "+o.status()):datanodesManager.getDataNodeByName(n.initiatorNode).schedulerEnd()))},this.statusCallback=function(e,t){o.name();o.status(e),"OK"==e?(o.last_error_msg("No error message"),$('[data-toggle="tooltip"]').tooltip("fixTitle")):"Pending"!==e&&"None"!==e&&"Running"!==e&&o.completeExecution(),_.isUndefined(t)||"Error"!=e||(o.last_error_msg(t),$('[data-toggle="tooltip"]').tooltip("fixTitle"))},this.statusForSchedulerCallback=function(e){o.statusForScheduler(e),"Ready"===e?(offSchedLogUser||xDashConfig.disableSchedulerLog||console.log(o.name()+" is ready now."),o.schedulerStart([o.name()],o.name(),"ReadyNow")):"NotReady"===e?(offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("initialization of "+o.name()+" is interrupted due to error."),o.status("Error"),o.updateCallback(void 0,"Error")):"Stop"===e&&(offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("initialization of "+o.name()+" need to be redone due to stop."),o.status("None"),o.updateCallback("","None"))},this.notificationCallback=function(e,t,a,n,o){xdashNotifications?xdashNotifications.manageNotification(e,t,a,o):(console.log("no notification lib was found. "),_.isUndefined(n)||_.isNull(n)||swal(n,a,e))},this.updateCallback=function(t,a){let n=o.name();var s=new Date,i=o.dataPreviewFormat.format(t);t=i.newData,o.beautifulString(i.previewData),e.processDatanodeUpdate(n,t),o.latestData(t),o.last_updated(s.toLocaleTimeString()),"Error"!==a&&"None"!==a&&"Running"!==a&&o.completeExecution();var r=angular.element(document.body).scope().$root;r.alldatanodes=datanodesManager.getAllDataNodes(),r.safeApply(),widgetConnector.refreshDatanodeConsumers(t,o.name(),o.status(),o.last_updated())},this.type=ko.observable(),this.type.subscribe((function(e){if(i(),e in t&&_.isFunction(t[e].newInstance)){var n=t[e],s=!0;function r(){var e=o.name();return a.isNode(e)||a.addNode(e),n.newInstance(o.settings(),(function(e){if(o.datanodeInstance=e,!o.formulaInterpreter.updateCalculatedSettings(!0,!1))return s=!1,!1}),o.updateCallback,o.statusCallback,o.notificationCallback,o.statusForSchedulerCallback)||(s=!1),!!s}var d=!1;_.isUndefined(n.external_scripts)||_.isUndefined(n.external_scripts[0])||""!==n.external_scripts[0]&&(d=!0),d?head.js(n.external_scripts.slice(0),r):r(),s||o.error(!0)}else swal("DataNode Plugin Error","The required '"+e+"' plugin does not exist in this Chalk'it version !","error"),o.error(!0)})),this.serialize=function(){return{name:o.name(),type:o.type(),settings:o.settings()}},this.deserialize=function(e){o.settings(e.settings),o.name(e.name),o.type(e.type);let a="icn-";return _.isUndefined(t[e.type])?a+="json-variable":a+=t[e.type].icon_type.replace(/\.[^/.]+$/,""),o.iconType(a),o.error(),!0},this.getDataRepresentation=function(e){return new Function("data","return "+e+";").call(void 0,o.latestData())},this.schedulerStart=function(e,t,s){var i,r,d=o.name();offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("schedulerStart with sourceNodesArg:",e," and initiatorNodeArg:",t),_.isUndefined(e)?(i=[d],r=d):(i=e,r=t),_.isUndefined(s)&&(s="unidentified");var l={disconSourceNodes:[],disconGraphs:[],indicesDisconGraphs:[]};fillRunningList(i,l),l.disconSourceNodes.forEach((function(t,o){if(!datanodesManager.foundDatanode(t[0]))return text="Datanode '"+t[0]+"' does not exist but referenced in another datanode",void(offSchedLogUser||xDashConfig.disableSchedulerLog||console.log(text));if(null==datanodesManager.getDataNodeByName(t[0]).execInstance()){let e=Object.assign({},t);i=updateSourceNodes(t),r=i[0],offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("new scheduler instance with sourceNodes:",i," and initiator:",r);var d=new DatanodeScheduler(a,i,e,r,s);if(currentGraph=l.disconGraphs[o],null!=currentGraph?currentGraph.forEach((function(e){if(!datanodesManager.foundDatanode(e))return text="Datanode '"+e+"' does not exist but referenced in another datanode",void(offSchedLogUser||xDashConfig.disableSchedulerLog||console.log(text));null!=datanodesManager.getDataNodeByName(e).execInstance()?offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("Instance of ",e," is already running"):(datanodesManager.getDataNodeByName(e).execInstance(d),datanodesManager.getDataNodeByName(e).schedulerStatus("Running"))})):offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("error in building disconnected graphs"),!offSchedLogUser&&!xDashConfig.disableSchedulerLog){console.log("scheduling instance created, clkTick:"+n.getCurrentTick()+", clkTime(s):"+n.getCurrentTime());let e=datanodesManager.getDataNodeByName(i[0]).execInstance().getInitiatorNode();console.log("scheduling instance of started with "+e)}datanodesManager.getDataNodeByName(i[0]).execInstance().launchSchedule()}else if("globalFirstUpdate"===s&&0!=n.getCurrentTick())for(var c in e)offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("operation "+e[c]+", called from "+s+", is added to extraStartNodes list"),a.setExtraStartNodes(e[c],s);else"timer"===s&&0!=n.getCurrentTick()?offSchedLogUser||xDashConfig.disableSchedulerLog||(console.log("Execution of operation "+t[0]+" is ignored at clkTick:"+n.getCurrentTick()+" because scheduling instance is not terminated yet"),console.log("Try to increase sample time of operation "+t[0])):"timer"!==s&&"globalFirstUpdate"!==s&&(offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("operation "+t[0]+", called from "+s+", is added to extraStartNodes list"),a.setExtraStartNodes(t[0],s))}))},this.schedulerEnd=function(){if(o.name()!==o.execInstance().getInitiatorNode()&&(offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("scheduling instance will not be terminated by the initiator "+o.execInstance().getInitiatorNode())),null!=o.execInstance()){var e=a.getAllDisconnectedGraphs();offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("get belonging disconnected graph (from schedulerEnd)"),graph=a.getBelongingDisconnectedGraph(o.name(),e),null!=graph&&graph.forEach((function(e){if(!datanodesManager.foundDatanode(e))return text="Datanode '"+e+"' does not exist but referenced in another datanode",void(offSchedLogUser||xDashConfig.disableSchedulerLog||console.log(text));null==datanodesManager.getDataNodeByName(e).execInstance()?offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("Instance of ",e," is already terminated"):(datanodesManager.getDataNodeByName(e).execInstance(null),datanodesManager.getDataNodeByName(e).isSchedulerStartSafe(!0))})),offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("scheduling instance terminated by "+o.name());var t=a.getExtraStartNodes();if(Object.keys(t).length){offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("Start schedule from extraStartNodes:"+t);var n=Object.keys(t),s=t[n[0]];a.clearExtraStartNodes(),o.schedulerStart(n,n[0],s)}}else offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("Problem : request for ending a scheduling instance whereas no instance exists")},this.updateNow=function(e,t,s){var i=!1;if(o.sampleTime()<1&&o.sampleTime()>=.1?Math.floor(10*n.getCurrentTime())%(10*o.sampleTime())==0&&(i=!0):o.sampleTime()>=1?n.getCurrentTime()%o.sampleTime()==0&&(i=!0):0!=o.sampleTime()&&console.log("sampleTime cannot be lesser than 0.1s"),0==o.sampleTime()||i){if(e&&o.settings().explicitTrig)return o.completeExecution("NOP"),void(offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("ExplicitTrigger of ",o.settings().name+" is true"));if(!_.isUndefined(o.datanodeInstance)&&_.isFunction(o.datanodeInstance.updateNow)){if(!o.formulaInterpreter.updateCalculatedSettings(!1,s))return void o.error(!0);if(s)if(o.formulaInterpreter.bCalculatedSettings){let n=Array.from(a.getPredecessorsSet(o.name()));var r=o.datanodeInstance.updateNow(e,t,n);_.isUndefined(r)||r.notTobeExecuted&&o.completeExecution("NOP")}else o.notificationCallback("info",o.settings().name,"Scheduling of this operation is interrupted because of its last error","Scheduler interruption"),o.updateCallback(void 0,"Error");else o.settings().explicitTrig&&!o.settings().autoStart||swal("Update is not available",'Predecessors of operation "'+o.settings().name+'" need to be executed first.',"info"),o.completeExecution("NOP"),o.updateCallback(void 0,"None")}}else offSchedLogUser||xDashConfig.disableSchedulerLog||console.log(o.name()+" is not executed because currentTime: "+n.getCurrentTime()+" is not multiple of sampleTime: "+o.sampleTime()),o.completeExecution("NOP")},this.dispose=function(){var e=o.name();a.removeNode(e),o.sampleTime()&&n.unregisterDatanode(e),null!=o.execInstance()&&(e!==o.execInstance().getInitiatorNode()?o.execInstance().stopOperation(e):(o.notificationCallback("info",e,"Scheduling is aborted because datanode "+e+" is part of scheduling operations","Scheduler stop"),o.execInstance().stopAllOperations())),i()},this.isSetValueValid=function(){return o.datanodeInstance.isSetValueValid()},this.isSetFileValid=function(){return o.datanodeInstance.isSetFileValid()},this.setValue=function(e,t,a,n){_.isFunction(o.datanodeInstance.getValue)?t!=o.datanodeInstance.getValue(e)&&setDirtyFlagSafe(!0):setDirtyFlagSafe(!0),o.datanodeInstance.setValue(e,t),n||!s&&a||o.schedulerStart([o.name()],o.name(),"setValue"),a&&(s=!s)},this.setValueSpec=function(t,a,n){let s=o.name();o.setValue(t,a,n),newData=JSON.parse(o.settings().json_var);var i=new Date,r=o.dataPreviewFormat.format(newData);newData=r.newData,o.beautifulString(r.previewData),e.processDatanodeUpdate(s,newData),o.latestData(newData),o.last_updated(i.toLocaleTimeString()),setDirtyFlagSafe(!0)},this.setFile=function(e){o.datanodeInstance.setFile(e)&&(o.schedulerStart([o.name()],o.name(),"setFile"),setDirtyFlagSafe(!0))},this.isSettingNameChanged=function(e){if(!_.isUndefined(o.datanodeInstance))return o.datanodeInstance.isSettingNameChanged(e)},this.getSavedSettings=function(){if(!_.isUndefined(o.datanodeInstance)&&_.isFunction(o.datanodeInstance.getSavedSettings))return o.datanodeInstance.getSavedSettings()},this.isSettingSampleTimeChanged=function(e){if(!_.isUndefined(o.datanodeInstance)&&_.isFunction(o.datanodeInstance.isSettingSampleTimeChanged))return o.datanodeInstance.isSettingSampleTimeChanged(e)},this.getXHR=function(){if(!_.isUndefined(o.datanodeInstance)&&_.isFunction(o.datanodeInstance.getXHR))return o.datanodeInstance.getXHR()},fillRunningList=function(e,t){var n=a.getAllDisconnectedGraphs();e.forEach((function(e){offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("get belonging disconnected graph (from schedulerStart)"),graph=a.getBelongingDisconnectedGraph(e,n),null!=graph?t.indicesDisconGraphs.includes(graph.index)?t.disconSourceNodes[t.indicesDisconGraphs.indexOf(graph.index)].push(e):(t.indicesDisconGraphs.push(graph.index),t.disconSourceNodes.push([e]),t.disconGraphs.push(graph)):offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("error in building disconnected graphs")}))},updateSourceNodes=function(e){let t=new Set(e);return descendants=a.getDescendants(e),new Set(Array.from(descendants).filter(e=>t.has(e))).forEach((function(t){e.splice(e.indexOf(t),1)})),e}};
function DialogBox(e,c,i,n,t,o){var a,d,l=$('<div class="modalDialog modalDialogOpen" style="z-index:1000"></div>');_.isUndefined($(".code-mirror-wrapper")[0])||($(l)[0].style.zIndex=6e3),_.isUndefined($(".showSweetAlert")[0])||($(l)[0].style.zIndex=99999);var s=$('<div class="modalDialog__wrapper"></div>');function p(){$(document).unbind("keydown",h),l.fadeOut(200,(function(){$(this).remove()}))}function h(e){27===e.keyCode&&(n||r())}$(document).on("keydown",h),s.append('<div class="modalDialog__header"><h2>'+c+"</h2></div>"),$('<div class="modalDialog__content"></div>').appendTo(s).append(e);var u=$('<div class="modalDialog__footer"></div>').appendTo(s);function r(){var e=!1;_.isFunction(t)&&(e=a?t(a):d?t(d):t()),e||p()}n&&($('<input id="dialog-cancel" type="button" class="btn btn-rounded-fill cancel"  value="'+n+'"></input>').appendTo(u).click((function(){_.isFunction(o)?o():_.isUndefined(o)||(a=o),p()})),_.isUndefined(o)||_.isFunction(o)||(d=o)),i&&$('<input id="dialog-ok" type="button" class="btn btn-rounded-fill primary" value="'+i+'"></input>').appendTo(u).click(r),l.append(s),$("body").append(l),l.fadeIn(200)}function DialogBoxForToolboxEdit(e,c,i,n,t){DialogBox(e,c,i,n,t)}function DialogBoxForData(e,c,i,n,t){DialogBox(e,c,i,n,t),_.isUndefined($("#check-all"))||($("#check-all").click((function(e){this.checked&&($(".check-option1").each((function(){this.checked=!0})),$("#uncheck-all")[0].checked=!1)})),$("#uncheck-all").click((function(e){this.checked&&($(".check-option1").each((function(){this.checked=!1})),$("#check-all")[0].checked=!1)})),$(".check-option1").click((function(){$("#check-all")[0].checked=!1,$("#uncheck-all")[0].checked=!1})))}function DialogBoxForDuplicateData(e,c,i,n,t){if(DialogBoxForData(e,c,i,n,t),!_.isUndefined($(".data-check-input")[0])){$(".data-check-input").each((function(){$(".data-check-input").on("change paste input",(function(e){for(var c=this.id.substring(this.id.length-1,this.id.length),i=!1,n=0;n<datanodesManager.getAllDataNodes().length;n++)if(datanodesManager.getAllDataNodes()[n].name()==this.value){i=!0;break}i?($("#data-overwrite-"+c)[0].checked=!0,$("#data-checkbox-"+c)[0].checked=!1):($("#data-rename-"+c)[0].checked=!0,$("#data-checkbox-"+c)[0].checked=!0)}))}))}}function copyURLtoClipboard(){document.getElementById("swal-input").select(),document.execCommand("copy"),$("#swal-p")[0].style.visibility="visible",setTimeout((function(){$("#swal-p")[0].style.visibility="hidden"}),1500)}function DialogBoxForHtmlExport(e,c,i,n,t,o){DialogBox(e,c,i,n,t,o),_.isUndefined(o)?($("#select-export-settings")[0].value=htmlExport.exportOptions,$("#check-scale-export")[0].checked=htmlExport.checkExportOptions):($("#select-export-settings")[0].value=o[0].exportOptions,$("#check-scale-export")[0].checked=o[0].checkExportOptions,$("#check-scale-export").attr("disabled",!0))}
PluginEditor=function(jsEditor){function _displayValidationError(e,t){var n,i=$('<div class="validation--error"></div>').html(t);_.isUndefined($("#setting-value-container-data_path")[0])||(n=$("#setting-value-container-data_path")[0].childNodes[$("#setting-value-container-data_path")[0].childNodes.length-1]),"data_path"==e&&(_.isUndefined(n)||(n.style.display="table-cell"),i[0].style.display="table-cell",i[0].style.height="25px"),"name"!=e&&"url"!=e||(_.isUndefined(n)||(n.style.display=""),i[0].style.display=""),$("#setting-value-container-"+e).append(i)}function _isNumerical(e){return!isNaN(parseFloat(e))&&isFinite(e)}function _appendCalculatedSettingRow(e,t,n,i,a,s){var l=$('<textarea autocorrect="off" autocomplete="off" spellcheck="false" class="calculated-value-input" style="display:none; width:78%"></textarea>');n.multi_input?l.change((function(){var i=[];$(e).find("textarea").each((function(){var e=$(this).val();e&&(i=i.concat(e))})),t.settings[n.name]=i})):l.change((function(){t.settings[n.name]=$(this).val()})),i&&l.val(i);var r=$('<div class="codemirror-wrapper__top"></div>'),o=$('<div class="calculated-setting-row codemirror-wrapper"></div>');o.append(r);var c=jsEditor.displayMiniJSEditor(o,l.val(),t,(function(e){l.val(e),l.change()}));o.append(l);var d=$('<a>Full Screen view<i class="basic icn-full-screen""></i></a>').mousedown((function(e){e.preventDefault(),jsEditor.displayJSEditor(l.val(),t,n,s,(function(e){c.setValue(e),l.val(e),l.change()}))}));if(r.append(d),a){var p=$('<li class="remove-setting-row"><i class="icon-minus icon"></i><label></label></li>').mousedown((function(t){t.preventDefault(),o.remove(),$(e).find("textarea:first").change()}));r.prepend(p)}$(e).append(o),_.isUndefined(n.description1)||$(e).append($('<div class="setting-description" style="display:block;">'+n.description1+"</div>"))}function saveSettings(e,t,n){$(".validation--error").remove(),""===newSettings.type&&(newSettings=t);for(var i=0;i<e.settings.length;i++){var a=e.settings[i];if(a.required&&(_.isUndefined(newSettings.settings[a.name])||""==newSettings.settings[a.name]))return _displayValidationError(a.name,"This is required."),!0;if("integer"==a.type&&newSettings.settings[a.name]%1!=0)return _displayValidationError(a.name,"Must be a whole number."),!0;if("number"==a.type&&!_isNumerical(newSettings.settings[a.name]))return _displayValidationError(a.name,"Must be a number."),!0;if("text"==a.type&&"name"==a.name&&-1!==newSettings.settings[a.name].indexOf("\\"))return _displayValidationError(a.name,"Backslash '\\' is forbidden."),!0}if("JSON_var_plugin"==newSettings.type){datanodesManager.getJsonEd().updateVal()}return"Map_matching_from_datanode"!=newSettings.type||navigator.onLine?_.isFunction(n)?!1!==n(newSettings):void 0:(swal("Need internet connection for '"+newSettings.settings.name+"'","Please verify your connection then reload the page","error"),!1)}var newSettings={type:"",iconType:"",settings:{}};function createPluginEditor(pluginTypes,currentTypeName,currentSettingsValues,flag){function createSettingRow(e,t){let n=$('<div id="setting-row-'+e+'" class="form-row"></div>').appendTo("#data-form-content");return n.append('<div class="form-label"><label class="control-label">'+t+"</label></div>"),$('<div id="setting-value-container-'+e+'" class="form-value"></div>').appendTo(n)}function removeRows(){let e=$("#data-form-content")[0];for(;e.firstChild;)e.removeChild(e.firstChild)}function typeSelectChange(e){(newSettings.type=e,newSettings.settings={},$(".input-wrapper-current").remove(),selectedType=pluginTypes[e],newSettings.iconType=selectedType.icon_type,_.isUndefined(selectedType))||(angular.element(document.body).scope().$root.dataNodeDescription=selectedType.description,_.isUndefined(selectedType.preFillBody)?createSettingsFromDefinition(selectedType.settings,selectedType.typeahead_source,selectedType.typeahead_data_segment):createSettingsFromDefinition(selectedType.settings,selectedType.typeahead_source,selectedType.typeahead_data_segment,selectedType.preFillBody))}var selectedType;if(newSettings={type:currentTypeName,iconType:"",settings:{}},_.isUndefined(flag)){for(var labels=[{name:"JSON",searchString:["Variable"]},{name:"Python",searchString:["Pyodide"]},{name:"JavaScript",searchString:["client-side"]},{name:"APIs",searchString:["REST"]},{name:"Files",searchString:["Generic","CSV file","Unzip"]},{name:"Streams & Real-time",searchString:["Clock","Delay","WebSocket","MQTT","Geoloc"]},{name:"Others",searchString:""}],typeOptGp=[],i=0;i<labels.length;i++)typeOptGp[labels[i].name]=[];if(_.each(pluginTypes,(function(e){for(var t=labels.length-1,n=0;n<labels.length;n++){for(var i=!1,a=0;a<labels[n].searchString.length;a++)if(-1!=e.display_name.search(labels[n].searchString[a])){t=n,i=!0;break}if(i)break}typeOptGp[labels[t].name].push({name:e.display_name,type:e.type_name})})),1==$("#datanode-list")[0].childNodes.length){$("#datanode-list")[0].innerHTML="",$('<div class="panel--content--top"><h1>New</h1><button ng-click="editorView.newDatanodePanel.view=!editorView.newDatanodePanel.view" class="btn btn-icon-only"><i class="basic icn-miniarrowleft"></i></button></div>').appendTo($("#datanode-list"));for(let e=0;e<labels.length;e++)if(typeOptGp[labels[e].name].length>0){var datanodeWrap=$('<div class="add__new__datanode--list--wrap"></div>').appendTo($("#datanode-list"));$("<span>"+labels[e].name+"</span>").appendTo(datanodeWrap);let t=$("<ul></ul>").appendTo(datanodeWrap);for(let n=0;n<typeOptGp[labels[e].name].length;n++)a=$('<a title="Open '+labels[e].name+" : "+typeOptGp[labels[e].name][n].name+' dataNode" ng-click="openDataNodeTypePlugin(\''+typeOptGp[labels[e].name][n].type+"')\"></a>").appendTo($("<li></li>").appendTo(t)),a.text(typeOptGp[labels[e].name][n].name),$('<i class="basic icn-miniarrowright"></i>').appendTo(a)}var $body=angular.element(document.body),$rootScope=$body.scope().$root;$rootScope.myDataNodeHTML=$("#datanode-list").html()}}else typeSelectChange(flag);function createSettingsFromDefinition(settingsDefs,typeaheadSource,typeaheadDataSegment,preFillBody){removeRows(),_.each(settingsDefs,(function(settingDef){!_.isUndefined(settingDef.default_value)&&_.isUndefined(currentSettingsValues[settingDef.name])&&(currentSettingsValues[settingDef.name]=settingDef.default_value),"body"==settingDef.name&&1==currentSettingsValues.bodyPrefill&&(_.isUndefined(settingDef.default_value)?currentSettingsValues[settingDef.name]="":""===currentSettingsValues[settingDef.name]&&(currentSettingsValues[settingDef.name]=settingDef.default_value));var displayName=settingDef.name,valueCell;switch(_.isUndefined(settingDef.display_name)||(displayName=settingDef.display_name),valueCell=createSettingRow(settingDef.name,displayName),settingDef.type){case"array":{var containerDiv=$('<div style="display:inline-table"></div>').appendTo(valueCell),subTableDiv=$('<div class="form-table-value-subtable" style="width:80%"></div>').appendTo(containerDiv),subTable=$('<table class="sub-table"></table>').appendTo(subTableDiv),subTableHead=$("<thead></thead>").hide().appendTo(subTable),subTableHeadRow=$("<tr></tr>").appendTo(subTableHead),subTableBody=$("<tbody></tbody>").appendTo(subTable),currentSubSettingValues=[];function processHeaderVisibility(){newSettings.settings[settingDef.name].length>0?subTableHead.show():subTableHead.hide()}function createSubsettingRow(e){var t=$("<tr></tr>").appendTo(subTableBody),n={},i=!1;_.isArray(newSettings.settings[settingDef.name])||(newSettings.settings[settingDef.name]=[],i=!0);var a=2*newSettings.settings[settingDef.name].length;newSettings.settings[settingDef.name].push(n),_.each(settingDef.settings,(function(s){var l=$("<td></td>").appendTo(t),r="";_.isUndefined(e[s.name])||(r=e[s.name]),n[s.name]=r;var o="table-row-value-"+settingDef.name+a;$("<input id="+o+' class="table--row-value" type="text">').appendTo(l).val(r).change((function(){n[s.name]=$(this).val()})),i&&$("input#"+o)[0].setAttribute("readonly","readonly"),a++})),i?t.append($('<td class="table-row-operation"></td>').append($('<ul class="board-toolbar"></ul>').append($("<li></li>").append($('<i class=" icon"></i>'))))):t.append($('<td class="table-row-operation"></td>').append($('<ul class="board-toolbar"></ul>').append($("<li></li>").append($('<i class="icon-trash icon"></i>').click((function(){var e=newSettings.settings[settingDef.name].indexOf(n);-1!=e&&(newSettings.settings[settingDef.name].splice(e,1),t.remove(),processHeaderVisibility())})))))),subTableDiv.scrollTop(subTableDiv[0].scrollHeight),processHeaderVisibility()}if(_.each(settingDef.settings,(function(e){var t=e.name;_.isUndefined(e.display_name)||(t=e.display_name),$("<th>"+t+"</th>").appendTo(subTableHeadRow)})),settingDef.name in currentSettingsValues&&(currentSubSettingValues=currentSettingsValues[settingDef.name]),$('<label class="board-toolbar datasource-input-suffix"><i class="fa-plus fa"></i>ADD</label>').appendTo(containerDiv).click((function(){var e={};_.each(settingDef.settings,(function(t){e[t.name]=""})),createSubsettingRow(e)})),_.each(currentSubSettingValues,(function(e,t){createSubsettingRow(e)})),0==currentSubSettingValues.length){var newSubsettingValue={};_.each(settingDef.settings,(function(e){newSubsettingValue[e.name]=""})),newSettings.settings.req_data_type="none",$("select#select-option-req_data_type")[0].value="none",createSubsettingRow(newSubsettingValue)}break}case"boolean":{newSettings.settings[settingDef.name]=currentSettingsValues[settingDef.name];let e=$("<div></div>").appendTo(valueCell);var onOffSwitch=$('<div class="onoffswitch" style="display:inline-block"><label class="onoffswitch-label" for="'+settingDef.name+'-onoff"><div class="onoffswitch-inner"><span class="on">YES</span><span class="off">NO</span></div><div class="onoffswitch-switch"></div></label></div>').appendTo(e),input=$('<input type="checkbox" name="onoffswitch" class="onoffswitch-checkbox" id="'+settingDef.name+'-onoff">').prependTo(onOffSwitch).change((function(){newSettings.settings[settingDef.name]=this.checked}));settingDef.name in currentSettingsValues&&input.prop("checked",currentSettingsValues[settingDef.name]);break}case"browseText":newSettings.settings[settingDef.name]=currentSettingsValues[settingDef.name],newSettings.settings.content=currentSettingsValues.content;var input=$('<input type="text" id="select_file_path" style="float:left"></input><input type="file" style="display: none" id="select_file"></input><label class="board-toolbar datasource-input-suffix"><i class="fa-folder-open fa"></i>Browse...</label>');if(input.mousedown((function(e){e.preventDefault(),$("#select_file").change((function(e){var t=this.value,n=Path2FileName(t);$("#select_file_path").val(n);var i=new FileReader;i.addEventListener("load",(function(e){var t=e.target;text=t.result,newSettings.settings.content=text})),i.readAsText(e.target.files[0])})),$("#select_file").trigger("click")})),input.appendTo(valueCell).change((function(){newSettings.settings[settingDef.name]=Path2FileName($(this).val())})),settingDef.name in currentSettingsValues){var fakeFilePath=currentSettingsValues[settingDef.name],fileName=Path2FileName(fakeFilePath);$("#select_file_path").val(fileName)}break;case"browseBinary":newSettings.settings[settingDef.name]=currentSettingsValues[settingDef.name],newSettings.settings.content=currentSettingsValues.content;var input=$('<input type="text" id="select_file_path" style="float:left"></input><input type="file" style="display: none" id="select_file"></input><label class="board-toolbar datasource-input-suffix"><i class="fa-folder-open fa"></i>Browse...</label>');if(input.mousedown((function(e){e.preventDefault(),$("#select_file").change((function(e){var t=this.value,n=Path2FileName(t);$("#select_file_path").val(n);var i=new FileReader;i.addEventListener("load",(function(e){const t=e.target.result;newSettings.settings.content=btoa([].reduce.call(new Uint8Array(t),(function(e,t){return e+String.fromCharCode(t)}),""))})),i.readAsArrayBuffer(e.target.files[0])})),$("#select_file").trigger("click")})),input.appendTo(valueCell).change((function(){newSettings.settings[settingDef.name]=Path2FileName($(this).val())})),settingDef.name in currentSettingsValues){var fakeFilePath=currentSettingsValues[settingDef.name],fileName=Path2FileName(fakeFilePath);$("#select_file_path").val(fileName)}break;case"unzip":newSettings.settings[settingDef.name]=currentSettingsValues[settingDef.name],newSettings.settings.content=currentSettingsValues.content;var input=$('<input type="text" id="select_file_path" style="float:left"></input><input type="file" style="display: none" id="select_file" accept="application/x-zip-compressed"></input><label class="board-toolbar datasource-input-suffix"><i class="fa-folder-open fa"></i>Browse...</label>');if(input.mousedown((function(event){event.preventDefault(),$("#select_file").change((async function(event){const freeboardUIInst=new FreeboardUI,file=event.target.files[0],fileSize=file.size;let fileSizeFormat="";fileSizeFormat=fileSize<1024?fileSize+" bytes":fileSize<1048576?(fileSize/1024).toFixed(1)+" KB":(fileSize/1048576).toFixed(1)+" MB";const result={type:file.type,size:fileSizeFormat,name:file.name,content:""},fileExtension=file.name.split(".").pop(),extensionsText=["txt","json","xprjson","xml","svg","html","css","js","ts","md","csv"],extensionsBinary=["xls","xlsx","jpg","jpeg","png","tiff","gif"],fileTypes=["","application/json"],zipContent=[];fileExtension&&fileTypes.includes(result.type)&&(result.type=fileExtension);try{freeboardUIInst.showLoadingIndicator(!0);const zip=await JSZip.loadAsync(file);for(const relativePath in zip.files){const zipEntry=zip.files[relativePath],isDir=zipEntry.dir;if(isDir)continue;const fileExtension=relativePath.split(".").pop(),fileSize=zipEntry._data.uncompressedSize;if(!(fileSize>73400320))if(fileExtension&&extensionsText.includes(fileExtension)){const fileData=await zipEntry.async("string");zipContent.push({name:relativePath,content:["json","xprjson"].includes(fileExtension)?JSON.parse(JSON.stringify(eval("("+fileData+")")),null,2):fileData})}else{const e=await zipEntry.async("uint8array");zipContent.push({name:relativePath,content:btoa([].reduce.call(new Uint8Array(e),(e,t)=>e+String.fromCharCode(t),""))})}}result.content=zipContent}catch(e){const t=new PNotify({title:"Unzip file",text:"Error reading "+file.name+": "+e,type:"error",styling:"bootstrap3"});$(".ui-pnotify-container").on("click",()=>t.remove()),console.error("Error reading "+file.name+": "+e)}finally{freeboardUIInst.showLoadingIndicator(!1)}newSettings.settings.content=result;const fakeFilePath=this.value,fileName=Path2FileName(fakeFilePath);$("#select_file_path").val(fileName)})),$("#select_file").trigger("click")})),input.appendTo(valueCell).change((function(){newSettings.settings[settingDef.name]=Path2FileName($(this).val())})),settingDef.name in currentSettingsValues){var fakeFilePath=currentSettingsValues[settingDef.name],fileName=Path2FileName(fakeFilePath);$("#select_file_path").val(fileName)}break;case"json":if(newSettings.settings[settingDef.name]=currentSettingsValues[settingDef.name],newSettings.settings.content=currentSettingsValues.content,_.isUndefined($("#var-body")[0])){var input=$('<input type="text" title="'+settingDef.display_name+'" class="input__wrapper--text" id="var-body" autocorrect="off" autocomplete="off" spellcheck="false" />');input.appendTo(valueCell).change((function(){newSettings.settings[settingDef.name]=$(this).val();let e=datanodesManager.getJsonEditor();datanodesManager.getJsonEd().updateEditor(e,$(this).val())})),$('<div class="btn-wrapper btn-wrapper--no-label input-wrapper-current" id="btn-json">').appendTo($("#data-form-content")),$('<div class="tree__preview__container input-wrapper-current" style="height:unset"><div id="full-screen-json" class="tree__preview__container--top"><a><p>Full Screen view</p><i class="basic icn-full-screen"></i></a></div><div id="tree-preview" style="height: 36vh;"></div></div>').appendTo($("#data-form-content")),$("#full-screen-json").on("click",(function(){var e=document.getElementById("tree-preview");e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen()}));var json=datanodesManager.getJsonEd();json.displayJSONEdit(input.val(),(function(e){input.val(e),input.change()}))}if(settingDef.name in currentSettingsValues){$("#var-body").val(currentSettingsValues[settingDef.name]);let e=datanodesManager.getJsonEditor(),t=datanodesManager.getJsonEd();t.updateEditor(e,currentSettingsValues[settingDef.name])}break;case"option":var defaultValue=currentSettingsValues[settingDef.name],selectId="select-option-"+settingDef.name,input=$('<select id="'+selectId+'"></select>').appendTo($('<div class="styled-select"></div>').appendTo(valueCell)).change((function(){newSettings.settings[settingDef.name]=$(this).val(),("FMI_webservice"===settingDef.name&&newSettings.settings.bodyPrefill||"req_data_type"===settingDef.name)&&preFillBody()}));_.each(settingDef.options,(function(e){var t,n;_.isObject(e)?(t=e.name,n=e.value):t=e,_.isUndefined(n)&&(n=t),_.isUndefined(defaultValue)&&(defaultValue=n),$("<option></option>").text(t).attr("value",n).appendTo(input)})),newSettings.settings[settingDef.name]=defaultValue,settingDef.name in currentSettingsValues&&input.val(currentSettingsValues[settingDef.name]);break;case"custom1":case"custom2":newSettings.settings[settingDef.name]=currentSettingsValues[settingDef.name],settingDef.implementation(valueCell,settingDef,currentSettingsValues,newSettings);break;default:var input;if(newSettings.settings[settingDef.name]=currentSettingsValues[settingDef.name],"calculated"==settingDef.type){if(settingDef.name in currentSettingsValues){var currentValue=currentSettingsValues[settingDef.name];if(settingDef.multi_input&&_.isArray(currentValue))for(var includeRemove=!1,i=0;i<currentValue.length;i++)_appendCalculatedSettingRow(valueCell,newSettings,settingDef,currentValue[i],includeRemove),includeRemove=!0;else _appendCalculatedSettingRow(valueCell,newSettings,settingDef,currentValue,!1)}else _appendCalculatedSettingRow(valueCell,newSettings,settingDef,null,!1);if(settingDef.multi_input){var inputAdder=$('<ul class="board-toolbar"><li class="add-setting-row"><i class="fa-plus fa"></i><label>ADD</label></li></ul>').mousedown((function(e){e.preventDefault(),_appendCalculatedSettingRow(valueCell,newSettings,settingDef,null,!0)}));$(valueCell).siblings(".form-label").append(inputAdder)}}else if(input=$('<input type="text" title="'+settingDef.display_name+'" class="input__wrapper--text" />').appendTo(valueCell).change((function(){if("name"==settingDef.name&&($('<input type="text">')[0].maxLength=40),"number"==settingDef.type)newSettings.settings[settingDef.name]=Number($(this).val());else{var e=!1,t="";for(var t in widgetConnector.widgetsConnection){for(var n in widgetConnector.widgetsConnection[t].sliders)if("None"!=widgetConnector.widgetsConnection[t].sliders[n].name&&!_.isUndefined(widgetConnector.widgetsConnection[t].sliders[n].connectedDataNodeS)&&widgetConnector.widgetsConnection[t].sliders[n].connectedDataNodeS===newSettings.settings[settingDef.name]){e=!0;break}if(e)break}e&&swal("'"+newSettings.settings[settingDef.name]+"' is now missing","Connections with widget '"+widgetConnector.widgetsConnection[t].modelJsonId+"' may be removed!","warning"),newSettings.settings[settingDef.name]=$(this).val()}})),settingDef.name in currentSettingsValues&&input.val(currentSettingsValues[settingDef.name]),typeaheadSource&&settingDef.typeahead_data_field&&input.addClass("typeahead_data_field-"+settingDef.typeahead_data_field),typeaheadSource&&settingDef.typeahead_field){var typeaheadValues=[];input.keyup((function(e){e.which>=65&&e.which<=91&&input.trigger("change")})),$(input).autocomplete({source:typeaheadValues,select:function(e,t){input.val(t.item.value),input.trigger("change")}}),input.change((function(e){var t=input.val(),n=_.template(typeaheadSource)({input:t});$.get(n,(function(e){if(typeaheadDataSegment&&(e=e[typeaheadDataSegment]),e=_.select(e,(function(e){return e[settingDef.typeahead_field][0]==t[0]})),typeaheadValues=_.map(e,(function(e){return e[settingDef.typeahead_field]})),$(input).autocomplete("option","source",typeaheadValues),1==e.length)for(var n in e=e[0])if(e.hasOwnProperty(n)){var i=$(_.template("input.typeahead_data_field-<%= field %>")({field:n}));i&&(i.val(e[n]),i.val()!=input.val()&&i.trigger("change"))}}))}))}}_.isUndefined(settingDef.suffix)||valueCell.append($('<div class="input--suffix">'+settingDef.suffix+"</div>")),_.isUndefined(settingDef.description)||valueCell.append($('<div class="setting-description">'+settingDef.description+"</div>"))}))}}return{createPluginEditor:function(e,t,n,i){createPluginEditor(e,t,n,i)},getNewSettings:function(){return newSettings},saveSettings:function(e,t,n){return saveSettings(e,t,n)}}};
JSONEdit=function(){var e,o="code";return{displayJSONEdit:function(t,n){$('<button class = "btn btn-rounded" onclick="var json = datanodesManager.getJsonEd();json.loadJSON()"> <i class = "basic icn-upload"></i>Import Json</button>').appendTo($("#btn-json")),$('<button class = "btn btn-rounded" onclick="var json = datanodesManager.getJsonEd();json.saveJSON()"> <i class = "basic icn-download"></i>Export Json</button>').appendTo($("#btn-json")),$('<div id="jsonedit"style="height:100%"></div>').appendTo($("#tree-preview")),function(t,n){function r(){var o={};try{o=e.get();var t=JSON.stringify(o);n(t)}catch(e){return void swal("Error",e.message,"error")}}var a=$("#jsonedit");$("#jsonedit")[0].innerHTML="";var s={mode:"code",modes:["code","tree"],onError:function(e){swal("Error",e.toString(),"error")},onModeChange:function(e,t){"tree"==e?($("#var-body").prop("disabled",!0),$("#jsonedit").off("focusout"),o="tree"):"code"==e&&($("#var-body").prop("disabled",!1),$("#jsonedit").on("focusout",r),o="code")},language:"en"};e=new JSONEditor(a[0],s),datanodesManager.setJsonEditor(e);try{t&&e.set(JSON.parse(t))}catch(e){swal("JSON Parse error",e.message,"error")}$("#jsonedit").on("focusout",r)}(t,n)},loadJSON:function(){if(e=datanodesManager.getJsonEditor(),window.File&&window.FileReader&&window.FileList&&window.Blob){var o=document.createElement("input");o.type="file",o.setAttribute("accept",".json"),$(o).on("change",(function(o){var t=o.target.files;if(t&&t.length>0){var n=t[0],r=new FileReader;r.addEventListener("load",(function(o){try{e.setText(o.target.result);var t=e.get(),n=JSON.stringify(t);$("#var-body").val(n),$("#var-body").change()}catch(e){swal("JSON Parse error",e.message,"error")}})),r.readAsText(n)}})),$(o).trigger("click")}else swal("Unable to load a file in this browser.","","error")},saveJSON:function(){e=datanodesManager.getJsonEditor(),swal({title:"Export JSON",text:"Save as ...",type:"input",showConfirmButton:!1,showConfirmButton1:!0,showCancelButton:!0,confirmButtonText:"Save",closeOnConfirm:!1,closeOnConfirm1:!1,inputPlaceholder:"please write JSON file name here ..."},(function(o){if(!1===o)return!1;if(""===o)return swal.showInputError("JSON file name is required!"),!1;if(null!=o){var t=o;-1==t.indexOf(".")?t+=".json":"json"==t.split(".").pop().toLowerCase()||(t=t.split(".")[0]+".json");var n=new Blob([e.getText()],{type:"application/json;charset=utf-8"});saveAs(n,t),swal.close()}}))},getJsonEd:function(){return e},updateEditor:function(e,o){datanodesManager.setJsonEditor(e);try{o&&e.set(JSON.parse(o))}catch(e){swal("JSON Parse error",e.message,"error")}},updateVal:function(){if("tree"==o){var t=e.get(),n=JSON.stringify(t);$("#var-body").val(n),$("#var-body").change()}}}};
JSEditor=function(){function e(e){e}function t(e,t,o,n,i){var a=t.settings.name,d="";"JSON_formula_plugin"===t.type?d='// Example: Convert temp from C to F and truncate to 2 decimal places.\n// return (dataNodes["MyDataNode"].sensor.tempInF * 1.8 + 32).toFixed(2);':"Python_inline_plugin"===t.type&&(d="//example: create 2 datanodes py_a a,d py_b then use them as follow:\n//return {'a':dataNodes[\"py_a\"],'b':dataNodes[\"py_b\"]}; \n//simple example:\nreturn {'key':'value'}; \n "),e||(e=d);var r=$('<div id="code-window-js" class="code-window cancel__box cancel__box--xl"></div>'),c=$('<div class="code-mirror-wrapper" id="codeWrapper"></div>'),l=$('<div class="cancel__box__bottom"></div>'),s=$('<div class="cancel__box__body"></div>'),p=$('<div class="cancel__box__top"><div class="code-window-header cm-s-ambiance"><span>This javaScript code will be re-evaluated any time this dataNode is updated, and the value you <code><span class="cm-keyword">return</span></code> will update the workspace. You can assume this code is wrapped in a function of the form <code><span class="cm-keyword">function</span>(<span class="cm-def">dataNodes</span>)</code> where dataNodes is a collection of javaScript objects (keyed by their name) defining the workspace. <br>Press <code><span class="cm-keyword">ctrl-space</span></code> to activate dataNodes autocompletion, <code><span class="cm-keyword">Tab</span></code> to go deeper into JSON and <code><span class="cm-keyword">Escape</span></code> to leave it.<br>Press <code><span class="cm-keyword">ctrl-K</span></code> to autoformat (beautify) selection. </span></div></div>'),g=$('<div class="cancel__box__container"></div>');s.append([c]),g.append([p,s,l]),r.append([g]);var u=$('<div id="codeWindowContainer" class="cancel__container open"></div>');u.append($('<div class="cancel__overlay"></div>')),u.append(r),$("body").append(u);var m=[],w=checkES6(),h=checkES7(),v=checkES8(),C=checkES9(),f=checkES10(),b=5;function y(){E.operation((function(){for(var e=0;e<m.length;++e)E.removeLineWidget(m[e]);m.length=0;var t="/*jshint esversion:"+b+"*/\n"+E.getValue();JSHINT(t);for(e=0;e<JSHINT.errors.length;++e){var o=JSHINT.errors[e];if(o){var n=document.createElement("div"),i=n.appendChild(document.createElement("span"));i.innerHTML="!!",i.className="lint-error-icon",n.appendChild(document.createTextNode(o.reason)),n.className="lint-error",m.push(E.addLineWidget(o.line-1,n,{coverGutter:!1,noHScroll:!0}))}}JSHINT.errors.length&&E.focus()}));var e=E.getScrollInfo(),t=E.charCoords({line:E.getCursor().line+1,ch:0},"local").top;e.top+e.clientHeight<t&&E.scrollTo(null,t-e.clientHeight+3)}function S(e,t){t.pick(),e.execCommand("autocomplete")}w&&(b=6),h&&(b=7),v&&(b=8),C&&(b=9),f&&(b=10);var N,k=datanodesManager.getAllDataNodes().sort((e,t)=>e.name().localeCompare(t.name())),x=CodeMirror(c.get(0),{value:e,mode:{name:"javascript",globalVars:!0},theme:"eclipse",indentUnit:4,lineNumbers:!0,matchBrackets:!0,autoCloseBrackets:!0,lineWrapping:!0,showCursorWhenSelecting:!0,extraKeys:{"Ctrl-Space":"autocomplete","Alt-C":e=>e.toggleComment(),"Ctrl-K":e=>e.autoFormatRange(e.getCursor(!0),e.getCursor(!1))},hintOptions:{hint:JSEditorCompletion.createCompletionFct(k),completeSingle:!1,extraKeys:{Tab:S,Right:S,Left:function(e,t){const o=e.getCursor(),n=o.line,i=e.getLine(n),a=o.ch,d=JSEditorCompletion.getPrecedingPathLength(i,a);d&&(e.replaceRange("",CodeMirror.Pos(n,a-d),CodeMirror.Pos(n,a)),t.close(),e.execCommand("autocomplete"))}}}}),E=x.doc.cm;if(E.on("change",(function(){clearTimeout(N),N=setTimeout(y,500)})),setTimeout(y,100),[bFoundConnection,prop]=datanodesManager.isConnectedWithWidgt(a),bFoundConnection){var T='<div style="display: table-cell; padding: 10px"><span>Connected widget(s): </span></div>';_.each(prop,e=>{T=T+'<div style="display: table-cell; padding: 10px"><input type="radio" id="'+e+'_radio" name="dataWidgetRadio" value="'+e+'" onchange="datanodesManager.previewWidget(this.value)"><label for="'+e+'_radio">'+e+"</label></div>"});var j=$('<button id="dialog-widget" class="btn btn-rounded-fill primary" js-reset-toggle="">Show widget</button>').click((function(){if("Show widget"==$("#dialog-widget").text()){$("#code-window-js").width("80%"),$("#dialog-widget").text("Hide widget");var e="";_.each(prop,t=>{e=e+'<div id="widget-preview-zone-'+t+'" style="background-color:white; border:1px dashed rgba(0, 0, 0, 0.5)" ></div>'});var t=$('<div id="code-widget-window-js"  style="width: 49%;float: right;z-index:5000;overflow:auto;height:100%"><div id="widgets-selection-header" class="code-window-header cm-s-ambiance" style="position:relative"><div style="display: table-row">'+T+'</div></div><div id="widgets-preview-top" class="code-widget-window-preview"> '+e+"</div></div>");c.append(t),$("#"+prop[0]+"_radio").prop("checked",!0);_.each(prop,e=>{!function(e){var t=[];$("#widgets-preview-top > div").each((e,o)=>{t.push(o.id),$("#"+o.id).hide()}),$("#widget-preview-zone-"+e).show();var o=Math.min($("#"+e).height(),$("#code-widget-window-js").height()-40-$("#widgets-selection-header").height()),n=Math.min($("#"+e).width(),$("#code-widget-window-js").width()-40);$("#widget-preview-zone-"+e).width(n),$("#widget-preview-zone-"+e).height(o);var i=e.substring(0,e.length-1),a=widgetsPluginsHandler.copyWidget("widget-preview-zone-"+e,i,null,e,!0);null!=widgetConnector.widgetsConnection[e]&&(widgetConnector.widgetsConnection[e].widgetObjEdit=null,widgetConnector.widgetsConnection[e].widgetObjConnect=a)}(e)});var o=prop[0];datanodesManager.previewWidget(o),$(".code-mirror-wrapper")[0].childNodes[0].style.float="left",$(".code-mirror-wrapper")[0].childNodes[0].style.width="50%"}else $("#dialog-widget").text("Show widget"),_.each(prop,e=>{null!=widgetConnector.widgetsConnection[e]&&(widgetConnector.widgetsConnection[e].widgetObjEdit=null,widgetConnector.widgetsConnection[e].widgetObjConnect=null)}),$("#code-widget-window-js").remove(),$("#code-window-js").width("80%"),$(".code-mirror-wrapper")[0].childNodes[0].style.float="unset",$(".code-mirror-wrapper")[0].childNodes[0].style.width="unset"}));l.append(j);var H=$('<button id="apply-widget" class="btn btn-rounded-fill primary" js-reset-toggle="">Apply</button>').click((function(){t.settings[o.name]=x.getValue(),angular.element(document.getElementById("dash-datanode-ctrl")).scope().saveDataNodeSettings(!0)}));l.append(H)}var J=$('<button id="dialog-cancel" class="btn btn-rounded-fill primary" js-reset-toggle="">Close </button>').click((function(){if(i){var e=x.getValue();i(e),"Hide widget"==$("#dialog-widget").text()&&(instanceId=prop[0],null!=widgetConnector.widgetsConnection[instanceId]&&(widgetConnector.widgetsConnection[instanceId].widgetObjEdit=null,widgetConnector.widgetsConnection[instanceId].widgetObjConnect=null))}$("#codeWindowContainer").remove()}));l.append(J)}return{displayJSEditor:function(e,o,n,i,a){t(e,o,n,0,a)},displayMiniJSEditor:function(e,t,o,n){return function(e,t,o,n){o.settings.name;var i="";"JSON_formula_plugin"===o.type?i='// Example: Convert temp from C to F and truncate to 2 decimal places.\n// return (dataNodes["MyDataNode"].sensor.tempInF * 1.8 + 32).toFixed(2);':"Python_inline_plugin"===o.type&&(i=""),t||(t=i);var a=$('<div class="codemirror-wrapper__content"></div>');e.append(a);var d=[],r=checkES6(),c=checkES7(),l=checkES8(),s=checkES9(),p=checkES10(),g=5;function u(){C.operation((function(){for(var e=0;e<d.length;++e)C.removeLineWidget(d[e]);d.length=0;var t="/*jshint esversion:"+g+"*/\n"+C.getValue();JSHINT(t);for(e=0;e<JSHINT.errors.length;++e){var o=JSHINT.errors[e];if(o){var n=document.createElement("div"),i=n.appendChild(document.createElement("span"));i.innerHTML="!!",i.className="lint-error-icon",n.appendChild(document.createTextNode(o.reason)),n.className="lint-error",d.push(C.addLineWidget(o.line-1,n,{coverGutter:!1,noHScroll:!0}))}}JSHINT.errors.length&&C.focus()}));var e=C.getScrollInfo(),t=C.charCoords({line:C.getCursor().line+1,ch:0},"local").top;e.top+e.clientHeight<t&&C.scrollTo(null,t-e.clientHeight+3)}function m(e,t){t.pick(),e.execCommand("autocomplete")}r&&(g=6),c&&(g=7),l&&(g=8),s&&(g=9),p&&(g=10);var w,h=datanodesManager.getAllDataNodes().sort((e,t)=>e.name().localeCompare(t.name())),v=CodeMirror(a.get(0),{value:t,mode:{name:"javascript",globalVars:!0},theme:"eclipse",indentUnit:4,lineNumbers:!0,matchBrackets:!0,autoCloseBrackets:!0,lineWrapping:!0,showCursorWhenSelecting:!0,extraKeys:{"Ctrl-Space":"autocomplete","Alt-C":e=>e.toggleComment(),"Ctrl-K":e=>e.autoFormatRange(e.getCursor(!0),e.getCursor(!1))},hintOptions:{hint:JSEditorCompletion.createCompletionFct(h),completeSingle:!1,extraKeys:{Tab:m,Right:m,Left:function(e,t){const o=e.getCursor(),n=o.line,i=e.getLine(n),a=o.ch,d=JSEditorCompletion.getPrecedingPathLength(i,a);d&&(e.replaceRange("",CodeMirror.Pos(n,a-d),CodeMirror.Pos(n,a)),t.close(),e.execCommand("autocomplete"))}}}}),C=v.doc.cm;C.on("change",(function(){clearTimeout(w),w=setTimeout(u,500);var e=v.getValue();n(e)})),w=setTimeout(u,500);var f=v.getValue();return setTimeout((function(){v.refresh()}),1),n(f),v}(e,t,o,n)},setAssetRoot:function(t){e(t)}}};
JSEditorCompletion=function(){function t(t,o,c){const a=i(o,c,!0);if(a){if(c<a.end)return n(t,a.start,a.end);{const n=u(o,a.end,c);if(n){const o=f(t,a.name);if(o){const t=l(o,n.path);let i=[];return Array.isArray(t)?i=[...t.keys()].map(e=>r(`[${e}]`,t[e])):"object"!=typeof t&&"function"!=typeof t||null===t||(i=Object.keys(t).map(n=>r(`[${e(n)}]`,t[n]))),{list:i,from:n.completionStart,to:n.completionEnd}}return}}}const d=s(o,c);if(d){const e=t.filter(t=>t.name().startsWith(d.prefix));return n(e.length>0?e:t,d.start,d.end)}const p=o.substring(0,c),h=/(?<=[^\w]|^)d(?:a(?:t(?:a(?:N(?:o(?:d(?:es?)?)?)?)?)?)?)?$/.exec(p);return h?n(t,h.index,c):n(t,c)}function e(t){return JSON.stringify(t)}function n(t,n,o){return void 0===o&&(o=n),{list:t.map(t=>r(`dataNodes[${e(t.name())}]`,t.latestData())),from:n,to:o}}function r(t,e){return{text:t,render:function(n,r,i){const s=document.createElement("div"),c=document.createElement("b");if(c.innerText=t,s.appendChild(c),void 0!==e){const t=document.createElement("span");t.innerText=" - ",s.appendChild(t);const n=document.createElement("i");n.innerText=o(e,75),s.appendChild(n)}n.appendChild(s)}}}function o(t,e=75){let n=JSON.stringify(t);if(n.length>e){let r;r=Array.isArray(t)?"...]":"object"!=typeof t&&"function"!=typeof t||null===t?"string"==typeof t||t instanceof String?'..."':"...":"...}",n=n.substr(0,e-r.length)+r}return n}function i(t,e,n=!1){const r=/dataNodes\s*\[\s*(["'])((?:(?=(\\?))\3.)*?)\1\s*\]/g;let o,i;for(;o=r.exec(t);){const t=o[0],n=o.index,r=n+t.length;if(i={name:c(o[2]),start:n,end:r},e>=n&&e<=r)return i}return n&&i&&i.end<=e?i:void 0}function s(t,e){const n=t.substring(0,e),r=/dataNodes\s*\[\s*["']([^"']*)/g;let o;for(;o=r.exec(n);){const t=o[0],n=o.index,r=n+t.length;if(r===e)return{prefix:o[1],start:n,end:r}}}function c(t){if(t){let e="",n=!1;for(let r of t)n?(n=!1,e+="b"===r?"\b":"f"===r?"\f":"n"===r?"\n":"r"===r?"\r":"t"===r?"\t":"v"===r?"\v":r):"\\"===r?n=!0:e+=r;return e}return t}function a(t){const e=/^\s*\[\s*(?:([0-9]+)|(["'])((?:(?=(\\?))\4.)*?)\2)\s*\]/,n=[];let r,o=0;for(;r=e.exec(t);){if(r[1])try{n.push(parseInt(r[1],10))}catch(e){return void console.error(`Invalid number '${r[1]}' in path '${t}'`)}else{if(!r[3])return void console.error(`No matched group in match '${r[0]}' in path '${t}'`);n.push(c(r[3]))}const e=r[0];o+=e.length,t=t.substring(e.length)}return{path:n,length:o}}function u(t,e,n){const r=t.substring(e,n),o=a(r);if(o){const t=o.length,n=e+t,i=r.substr(t);let s;if(s=/^\s*(?:\[\s*(?:["']\s*)?)?$/.exec(i))return{completionStart:n,completionEnd:n+s[0].length,path:o.path}}}function f(t,e){const n=t.find(t=>t.name()===e);return n?n.latestData():void 0}function l(t,e){let n=t;for(let t of e){if(null==n||"string"==typeof n||n instanceof String)return;n=n[t]}return n}return{getPrecedingPathLength:function(t,e){const n=t.substring(0,e);let r;if(r=/^.*(\s*\[\s*(?:[0-9]+|(["'])(?:(?=(\\?))\3.)*?)\2\s*\]\s*)$/.exec(n)){let n=r[1].length;const o="dataNodes";return t.substring(0,e-n).endsWith(o)&&(n+=o.length),n}},createCompletionFct:function(e){return function(n,r){if(!e||0===e.length)return;const o=n.getCursor(),i=o.line,s=n.getLine(i),c=o.ch,a=t(e,s,c);return a&&(a.from=CodeMirror.Pos(i,a.from),a.to=CodeMirror.Pos(i,a.to)),a}},_locateDataNodes:i,_locateDataNodesPrefix:s,_decodePath:a,_locatePath:u,_getDsData:f,_resolvePath:l,_quoteString:e,_valueToText:o,_complete:t}}();
var xdsjson=function(){function e(e,a){var t=$('<div class="datalist"></div>');t.append("<p>"+a+"</p>");var n=$('<ul class="datalist__elems list-unstyled"></ul>');if(!_.isUndefined(e))for(var o=0;o<e.length;o++){var l="";l=_.isFunction(e[o].name)?e[o].name():e[o],_.isUndefined(l)||n.append('<li><label for="data-checkbox-'+o+'"><input type="checkbox" class="check-option1" id="data-checkbox-'+o+'">'+l+"</label></li>")}t.append(n);var d=$('<ul class="datalist__actions list-unstyled"></ul>');return d.append('<li><label for="check-all"><input type="checkbox" class="check-option2" id="check-all">Check all</label></li>'),d.append('<li><label for="uncheck-all"><input type="checkbox" class="check-option2" id="uncheck-all">Uncheck all</label></li>'),t.append(d),t}return{saveJson:function(){var a,t,n,o,l,d,i,s;a="server",o=datanodesManager.getAllDataNodes(),l=o.sort((e,a)=>e.name().localeCompare(a.name())),d=[],i=!1,s=e(l,"Please check data to be saved in the xdsjson file: "),new DialogBoxForData(s,"List of data","Save","Cancel",(function(){for(t=0;t<o.length;t++)$("#data-checkbox-"+t).is(":checked")&&(d[t]=o[t].name(),i=!0);if(!i)return!0;var e=datanodesManager.serialize(),l=!1;for(t=0;t<e.datanodes.length;t++){for(l=!1,n=0;n<d.length;n++)if(e.datanodes[t].name==d[n]){l=!0;break}l||delete e.datanodes[t]}var s=[],c=0;for(t=0;t<e.datanodes.length;t++)_.isUndefined(e.datanodes[t])||(s[c]=e.datanodes[t],c++);e.datanodes=s,"server"==a&&fileManager.saveOnServer("datanode",null,e)}))},clearAllData:function(){swal({title:"Are you sure?",text:"All dataNodes will be deleted and their connections with widgets!",type:"warning",showCancelButton:!0,showConfirmButton:!1,showConfirmButton1:!0,confirmButtonText:"Yes",cancelButtonText:"Abandon",closeOnConfirm:!0,closeOnConfirm1:!0,closeOnCancel:!0},(function(e){if(e){datanodesManager.clear();var a=angular.element(document.body).scope().$root;a.alldatanodes=datanodesManager.getAllDataNodes(),a.filtredNodes=a.alldatanodes.length,a.showOneDatasource=!1,a.showNotifications=!1,a.updateFlagDirty(!0),a.safeApply()}}))},getDuplicateDataList:function(e,a){var t=document.createElement("div"),n='<p style="margin-bottom:5px;">'+a+"</p>";if(n+='<div style="height:220px;overflow:auto;width:80%; max-width:80%; margin-bottom:15px;border: 1px solid white; background:var(--fill-background-color); color:black;float:left">',!_.isUndefined(e))for(var o=0;o<e.length;o++)_.isUndefined(e[o].name)||(n=(n=(n=n+'<li style="list-style-type: none;padding: 5px 10px;"><input type="checkbox" class="check-option1" id=data-checkbox-'+o+">")+'<input type="text" style="width:70%" class="data-check-input" value="'+e[o].name+'" id="data-check-'+o+'">')+'<input type="radio" class="data-radio" style="margin: 0px 0px 0px 5px;" name="data-radio-'+o+'" id="data-rename-'+o+'">',n=(n+='<span class="data-radio-span">rename</span>')+'<input type="radio" class="data-radio" name="data-radio-'+o+'" checked id="data-overwrite-'+o+'">',n+='<span class="data-radio-span" >overwrite</span>',n+="</li>");return n+="</div>",n+='<div style="width: 16%; float:right">',n+='<div style="list-style-type: none;padding-left: 8px;"><input type="checkbox" class="check-option2"  id="check-all"><span> Check all</span></div>',n+='<div style="list-style-type: none;padding-left: 8px;"><input type="checkbox" class="check-option2"  id="uncheck-all"><span> Uncheck all</span></div>',n+="</div>",t.innerHTML=n,t},getDataList:e,openJsonManager:function(e){var a;try{a=JSON.parse(e)}catch(e){return void swal("Unable to load file","Project loading will be interrupted.","error")}0==datanodesManager.getAllDataNodes().length?datanodesManager.load(a,!0):swal({title:"Loading dataNodes from xdsjson file",text:"Do you want to append the xdsjson file to your existing list or overwrite it?",type:"warning",showCancelButton1:!0,showConfirmButton:!1,showConfirmButton1:!0,confirmButtonText:"Append",cancelButtonText:"Overwrite",closeOnConfirm:!0,closeOnConfirm1:!0,closeOnCancel1:!0},(function(e){var t=!0;t=!e,datanodesManager.load(a,t,(function(){var e=angular.element(document.body).scope().$root;e.filtredNodes=e.alldatanodes.length,e.updateFlagDirty(!0)}))})),datanodesManager.showLoadingIndicator(!1)}}}();
var panelDash={fullScreenWidth:window.outerWidth};
var geoJsonColors=["#800080","#FF00FF","#000080","#0000FF","#008080","#00FFFF","#FFFF00","#800000"],geoConversion=function(){function e(e,t,r,n){for(var o=[],i={type:"FeatureCollection",features:[]},s=0;s<t.length;s++)o.push([t[s],e[s]]);var u={type:"Feature",geometry:{type:"LineString",coordinates:o},properties:{style:{color:geoJsonColors[n],weight:4,opacity:.9},description:'<span style="color: '+geoJsonColors[n]+'">'+r+"</span>"}};return u&&i.features.push(u),i}return{geoJson2dqTrip:function(e){var t={longitude:[],latitude:[]};for(i=0;i<e.features.length&&"LineString"==e.features[i].geometry.type;i++){var r=e.features[i].geometry.coordinates;for(k=0;k<r.length;k++)curLat=Number(r[k][1]),curLng=Number(r[k][0]),t.latitude.push(curLat),t.longitude.push(curLng)}return t},dqTrip2geoJson:function(t,r,n){var o=t.longitude,i=t.latitude,s=r+"_gpsTrace",u=null;return _.isUndefined(o)||_.isUndefined(i)||(u=e(i,o,s,n)),u},dqTrip2Csv:function(e){for(var t="latitude,longitude\n",r=0;r<e.longitude.length;r++)t=t+e.latitude[r]+","+e.longitude[r]+"\n";return t},hereMm2geoJson:function(t,r,n){if(_.isUndefined(t))return{};if(t=={})return{};if(_.isUndefined(t.RouteLinks))return{};for(var o,i,s=[],u=[],p=0;p<t.RouteLinks.length;p++)for(var a=t.RouteLinks[p].shape.split(" "),l=0;l<a.length;l+=2)o=Number(a[l]),s.push(o),i=Number(a[l+1]),u.push(i);return e(s,u,r+"_here",n)},graphHopper2geoJson:function(e,t,r,n){var o={};if(e.paths){for(var i=0;i<e.paths.length;i++){var s=e.paths[i];if(s.points_encoded){var u=graphhopper.util.decodePath(s.points,void 0);s.points={type:"LineString",coordinates:u}}}o={type:"FeatureCollection",features:[{type:"Feature",geometry:e.paths[0].points,properties:{style:{color:geoJsonColors[n],weight:4,opacity:.9},description:'<span style="color: '+geoJsonColors[n]+'">'+t+"_mapMatch_"+r+"</span>"}}]}}return o}}}();function Point(e,t,r){this.label=e,this.x=360*(r+180),this.y=180*(t+90),this.distance=function(e){var t=e.x-this.x,r=e.y-this.y;return Math.sqrt(t*t+r*r)},this.slope=function(e){var t=e.x-this.x;return(e.y-this.y)/t},this.toString=function(){return this.label}}function Points(e){return this.points=e,upper=function(e){for(var t=e[0],r=1;r<e.length;r++){var n=e[r];(n.y>t.y||n.y==t.y&&n.x<t.x)&&(t=n)}return t}(e),{pointSort:function(e,t){if(e==upper)return-1;if(t==upper)return 1;var r=upper.slope(e),n=upper.slope(t);return r==n?e.distance(upper)<t.distance(upper)?-1:1:r<=0&&n>0?-1:r>0&&n<=0?1:r>n?-1:1}}}
function widgetsPluginsHandlerClass(){var i=[],e=[],n=[],t=[],o=0;function s(i){for(var n in e){var t=_.keys(e[n].pluginDefinition.widgetsDefinitionList);if(_.contains(t,i))return e[n]}}return{loadWidgetPlugin:function(s){var d=s.pluginDefinition;n[o]=d,i[o]=d.name,e[o]=s,_.each(_.keys(d.widgetsDefinitionList),i=>{t[i]=d.widgetsDefinitionList[i]}),o++},createWidget:function(i,e,n,t){var o=s(e);if(!_.isUndefined(o))return o.createWidget(i,e,n,t);console.log(e+" does not exist. Create widget failed")},copyWidget:function(i,e,n,t,o){var d=s(e);if(!_.isUndefined(d))return d.copyWidget(i,e,n,t,o);console.log(e+" does not exist. Copy widget failed")},widgetToolbarDefinitions:t}}var widgetsPluginsHandler=new widgetsPluginsHandlerClass;
function startIntroGallery(){var e=introJs();e.onbeforechange((function(e){switch(e.id){case"my-projects-cards-explorer":navHelper.gotoMyProjects()}})),e.onafterchange((function(e){console.log("onafterchange:"+e.id),e.id})),e.addSteps([{element:"#my-projects-cards-explorer",intro:"Here you will find all your saved projects",disableInteraction:!0},{element:"#my-personnal-projects-list",intro:"Projects can be managed here",disableInteraction:!0},{element:"#unexisting",intro:"live-demo project will be opened",disableInteraction:!0}])}function startIntroProject(){var e=introJs();e.setOptions({exitOnOverlayClick:!1,showBullets:!1,showStepNumbers:!0,tooltipPosition:"right",steps:[{element:"#dashboard-editor",intro:"This is dashboard edition area"},{element:"#editor-widget-toolbox",intro:"This is the widgets toolbox"},{element:"#widget__groups--wrapper--icons",intro:"Widgets are added to the dashboard edition area from the widgets toolbox"},{element:"#widgetGroups",intro:"Available widgets are arranged according to 5 main groups"},{element:"#kpiCard",intro:"Widgets are placed into the dashboard editor using click or drag and drop"},{element:"#editor-datanodes-list",intro:"This is the dataNodes editor"},{element:"#editor-left-side-panel",intro:"DataNodes are added, configured, listed and controlled here"},{element:"#li_flatUiHorizontalSliderj",intro:"This is widget connection and configuration menu"},{element:"#datanodes-widget-connect",intro:"Widget connection to dataNodes, configuration, placement, z-order, etc. features are provided by this menu"},{element:"#panel--right",intro:"Here, widget and dataNode connection is configured"}]}),e.onbeforechange((async function(e){switch(e.id){case"editor-widget-toolbox":"backward"==this._direction&&document.getElementById("editor-widget-toolbox").click();break;case"widget__groups--wrapper--icons":if("forward"==this._direction){document.getElementById("editor-widget-toolbox").click(),0!==angular.element(document.getElementById("widget__wrap")).scope().displayedWdgtIndex&&document.getElementById("collapse-basic").click()}else"backward"==this._direction&&document.getElementById("collapse-basic").click();break;case"widgetGroups":"forward"==this._direction?document.getElementById("collapse-basic").click():"backward"==this._direction&&document.getElementById("collapse-gauges").click();break;case"kpiCard":"forward"==this._direction?document.getElementById("collapse-gauges").click():"backward"==this._direction&&document.getElementById("editor-widget-toolbox").click();break;case"editor-datanodes-list":"forward"==this._direction&&document.getElementById("editor-datanodes-list").click();break;case"editor-left-side-panel":"backward"==this._direction&&document.getElementById("showHideWidgetMenu").click();break;case"li_flatUiHorizontalSliderj":"forward"==this._direction&&document.getElementById("showHideWidgetMenu").click();break;case"datanodes-widget-connect":"backward"==this._direction&&(document.getElementById("open-datanodes-widget-connect").click(),document.getElementById("editor-datanodes-list").click(),document.getElementById("showHideWidgetMenu").click());break;case"panel--right":"forward"==this._direction&&document.getElementById("open-datanodes-widget-connect").click()}})),e.onafterchange((async function(e){var t=document.querySelectorAll(".introjs-helperLayer")[0],o=document.querySelectorAll(".introjs-tooltipReferenceLayer")[0];setTimeout(()=>{let i=e.getBoundingClientRect();t.style.setProperty("left",parseInt(i.left)-5+"px"),o.style.setProperty("left",parseInt(i.left)-5+"px"),t.style.setProperty("top",parseInt(i.top)-5+"px"),o.style.setProperty("top",parseInt(i.top)-5+"px"),t.style.setProperty("width",parseInt(i.width)+10+"px"),o.style.setProperty("width",parseInt(i.width)+10+"px"),t.style.setProperty("height",parseInt(i.height)+10+"px"),o.style.setProperty("height",parseInt(i.height)+10+"px")},300)})),e.onchange((function(e){})),e.oncomplete((function(){document.getElementById("open-datanodes-widget-connect").click()})),e.start()}
var bRescaleNeededForModeSwitch=!1,currentDashboardScrollTop=0;function showEditMode(e,o){"widgets"==tabActive?"edit-dashboard"!=modeActive?("play-dashboard"==modeActive&&(currentDashboardScrollTop=$("#DropperDroitec").scrollTop()),$("#dashboard-preview-div").hide(0,(function(){$("#dashboard-editor-div").show(0,(function(){$("#dashboard-editor-div").removeClass("ng-hide"),switchToEditMode(e,o),setIsPlayModeStatus(!1)}))}))):switchToEditMode(e,o):console.log("showEditMode called while tabActive="+tabActive)}function showPlayMode(e){switchToPlayMode(e)}function switchToEditMode(e,o){if(bFirstExec){var t=getMedia();widgetEditor.setLastMedia(t)}e&&widgetEditor.resizeDashboard(),gridMgr.updateGrid(),document.dispatchEvent(tabWidgetsLoadedEvt),bFirstExec&&(bFirstExec=!1,widgetEditor.computeDropperMaxWidth()),modeActive="edit-dashboard",_.isUndefined(o)||o(),$("#DropperDroite").scrollTop(currentDashboardScrollTop)}function switchToPlayMode(){if("edit-dashboard"==modeActive){widgetEditor.updateSnapshotDashZoneDims();var e=xdash.serialize();currentDashboardScrollTop=$("#DropperDroite").scrollTop(),widgetPreview.setScalingInformation(null,widgetEditor.getCurrentDashZoneDims().scalingMethod,layoutMgr.getRows(),layoutMgr.getCols()),widgetEditor.unselectAllWidgets(),$("#dashboard-editor-div").hide(0,(function(){$("#dashboard-preview-div").show(0,(function(){$("#dashboard-preview-div").removeClass("ng-hide");try{widgetPreview.loadPlayMode(e)}catch(e){console.log(e)}layoutMgr.makeColsTrasparent(),modeActive="play-dashboard",setIsPlayModeStatus(!0),$("#DropperDroitec").scrollTop(currentDashboardScrollTop),document.dispatchEvent(tabPlayLoadedEvt)}))}))}else console.log("bad modeActive : "+modeActive+". Unable to switch to Play mode")}function setIsPlayModeStatus(e){var o=angular.element(document.body).scope().$root;o.bIsPlayMode!=e&&(o.bIsPlayMode=e,o.$apply())}function setEditPlaySwitchDisableStatus(e){var o=angular.element(document.body).scope().$root;o.bDisableEditPlaySwitch!=e&&(o.bDisableEditPlaySwitch=e,o.$apply())}
var offSchedLogUser=!0,ratioScroll=0,models={};modelsHiddenParams={},modelsTempParams={},modelsParameters={},modelsLayout={};try{var tabWidgetsLoadedEvt=new Event("widgets-tab-loaded"),tabPlayLoadedEvt=new Event("play-tab-loaded")}catch(e){}Date.prototype.today=function(){return(this.getDate()<10?"0":"")+this.getDate()+"/"+(this.getMonth()+1<10?"0":"")+(this.getMonth()+1)+"/"+this.getFullYear()},Date.prototype.timeNow=function(){return(this.getHours()<10?"0":"")+this.getHours()+":"+(this.getMinutes()<10?"0":"")+this.getMinutes()+":"+(this.getSeconds()<10?"0":"")+this.getSeconds()+":"+this.getMilliseconds()};var bFirstExec=!0,ua=navigator.userAgent.toLowerCase(),isAndroid=ua.indexOf("android")>-1;function isTouchDevice(){return"ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0}var isTouchDevice=isTouchDevice();function activeTab(){tabActive="widgets",setEditPlaySwitchDisableStatus(!1),"no-dashboard"==modeActive?(bRescaleNeededForModeSwitch=!0,showEditMode(!0,(function(){}))):console.log("tabActive="+tabActive+". modeActive="+modeActive)}function rescaleWidget(e,t){e[t].rescale()}function setDirtyFlagSafe(e){try{if("undefined"!=typeof execOutsideEditor){if(!execOutsideEditor)angular.element(document.body).scope().$root.updateFlagDirty(e)}else angular.element(document.body).scope().$root.updateFlagDirty(e)}catch(e){}}$((function(){$(window).on("resize",(function(){var e=angular.element(document.body).scope().$root;"play"==tabActive?isAndroid||isTouchDevice||widgetPreview.resizeDashboard():e.moduleOpened||"widgets"==tabActive&&("edit-dashboard"==modeActive?(widgetEditor.resizeDashboard(),gridMgr.updateGrid()):"play-dashboard"==modeActive&&widgetPreview.resizeDashboard())})),isAndroid||isTouchDevice||$(window).on("orientationchange",(function(){"play"==tabActive&&widgetPreview.resizeDashboard()}))})),window.mobileAndTabletCheck=function(){let e=!1;var t;return t=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(e=!0),e};
class WidgetPrototypesManager{static SCHEMA_VERSION="http://json-schema.org/draft-07/schema#";static ID_URI_SCHEME="json-schema:";static SCHEMA_ANYTHING={$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:anything"};static SCHEMA_STRING={$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:string",type:"string"};static SCHEMA_NUMBER={$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:number",type:"number"};static SCHEMA_STRING_ARRAY={$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:string_array",type:"array",items:{type:"string"}};static SCHEMA_NUMBER_ARRAY={$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:number_array",type:"array",items:{type:"number"}};static SCHEMA_NUMBER_ARRAY_2D={$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:number_array_2d",type:"array",items:{type:"array",items:{type:"number"}}};static SCHEMA_PRIMITIVE_ARRAY={$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:primitives_array",type:"array",items:{anyOf:[{type:"string"},{type:"number"},{type:"boolean"}]}};static SCHEMA_INTEGER={$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:integer",type:"integer"};static SCHEMA_BOOLEAN={$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:boolean",type:"boolean"};static SCHEMA_ANY_PRIMITIVE={$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:primitives",anyOf:[{type:"string"},{type:"number"},{type:"boolean"}]};static SCHEMA_ANY_OBJECT={$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:object",type:"object"};static SCHEMA_NUMBER_OR_STRING={$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:number_or_string",anyOf:[{type:"string"},{type:"number"}]};constructor(){this.ajv=new ajv7}getOrCompile(t){if(Array.isArray(t)){for(const e of t){const t=e.$id;this.ajv.getSchema(t)||this.ajv.addSchema(e)}return this.ajv.getSchema(t[0].$id)}const e=t.$id,a=this.ajv.getSchema(e);return a||this.ajv.compile(t)}formatErrors(t){const e=this;function a(t){return["anyOf","oneOf","allOf"].includes(t.keyword)}function r(t,e){let a=t.message;return"anyOf"===t.keyword?a="One the the following must be true":"const"===t.keyword&&void 0!==t.params.allowedValue&&(a=`${a} "${t.params.allowedValue}"`),new WidgetActuatorValidationError(t.instancePath?`"${t.instancePath}": ${a}`:a,e)}function s(t,a){return r(t,a=e.formatErrors(a))}let o,i=[];for(t=_.sortBy(t,t=>t.schemaPath.length);o=t.find(a);){const e=o.schemaPath,a=[],r=[];for(const s of t)s!==o&&(s.schemaPath.startsWith(e)?a.push(s):r.push(s));i.push(s(o,a)),t=r}return i=[...i,...t.map(t=>r(t,[]))],i=i.sort((t,e)=>t.compareTo(e)),i.filter((t,e,a)=>0===e||0!==t.compareTo(a[e-1]))}}var widgetPrototypesManager=new WidgetPrototypesManager;
window.addEventListener("click",e=>{var t=angular.element(document.body);let n=angular.element(document.getElementById("dash-ctrl")).scope();var a=t.scope().$root,l=angular.element(document.getElementById("dashboard-editor")).scope().vm,s=angular.element(document.getElementById("dataListDisplay")).scope(),i=angular.element(document.getElementById("isNavOpen_Project")).scope(),p=angular.element(document.getElementById("isExportOpen_Project")).scope(),d=angular.element(document.getElementById("isShareOpen_Page")).scope(),r=angular.element(document.getElementById("isLogoutOpen")).scope(),o=angular.element(document.getElementById("isLogoutOpen_Project")).scope(),g=angular.element(document.getElementById("isDataSortNavOpen")).scope();if(n.editorView.newDatanodePanel.view&&"widget-overlay"!==e.target.className&&widgetEditor.unselectAllWidgets(),"showHideWidgetMenu"!==e.target.id&&"introjs-button introjs-nextbutton"!==e.target.className&&"introjs-button introjs-prevbutton"!==e.target.className&&"introjs-showElement"!==e.target.className&&l.menuWidgetVisible&&(l.menuWidgetVisible=!1,a.safeApply()),"isExportOpen_Project"!==e.target.id&&(_.isUndefined(p)||!0===p.isExportOpen&&(p.isExportOpen=!1,a.safeApply())),"isShareOpen_Page"!==e.target.id&&(_.isUndefined(d)||!0===d.isShareOpen&&(d.isShareOpen=!1,a.safeApply())),!_.isNull(e.target.parentElement)&&("dataNavDisplay"!==e.target.parentElement.id&&a.displayedNavIndex>=0&&(a.displayedNavIndex=-1,a.safeApply()),"dataListDisplay"!==e.target.parentElement.id&&!0===s.isDataListNavOpen&&(s.isDataListNavOpen=!1,a.safeApply()),"isNavOpen_Project"!==e.target.parentElement.id&&!0===i.isNavOpen&&(i.isNavOpen=!1,a.safeApply()),"isLogoutOpen"!==e.target.id&&"isLogoutOpen"!==e.target.parentElement.id&&(_.isUndefined(r)||!0===r.isNavOpen&&(r.isNavOpen=!1,a.safeApply())),"isLogoutOpen_Project"!==e.target.id&&"isLogoutOpen_Project"!==e.target.parentElement.id&&(_.isUndefined(o)||!0===o.isNavOpen&&(o.isNavOpen=!1,a.safeApply())),"isDataSortNavOpen"!==e.target.parentElement.id&&!0===g.isDataSortNavOpen&&(g.isDataSortNavOpen=!1,a.safeApply()),"tagDisplay"!==e.target.id&&"tagDisplay"!==e.target.parentElement.id&&(_.isUndefined(a.displayedIndex)||a.displayedIndex>=0&&(a.displayedIndex=-1,a.safeApply()),!_.isUndefined(a.displayedIndexG))))for(let e=0;e<a.displayedIndexG.length;e++)a.displayedIndexG[e]>=0&&(a.displayedIndexG[e]=-1,a.displayedIndex=-1,a.safeApply());var m=0;if(angular.element(document.getElementById("my-personnal-projects-list")).scope()){_.isUndefined(angular.element(document.getElementById("my-personnal-projects-list")).scope().allFilesFiltred[0])||(m=angular.element(document.getElementById("my-personnal-projects-list")).scope().allFilesFiltred[0].FileList.length);for(var c=0;c<m;c++){var y=angular.element(document.getElementById("isNavOpen_Recent_All_Gallery"+c)).scope();_.isUndefined(y)||e.target.parentElement.id!=="isNavOpen_Recent_All_Gallery"+c&&!0===y.isNavOpen&&(y.isNavOpen=!1,a.safeApply())}let t=angular.element(document.getElementById("my-personnal-projects-list")).scope().grpFiles;for(const n in t){if("string"==typeof t[n])continue;let l=t[n].length;for(let t=0;t<l;t++){let l=angular.element(document.getElementById("isNavOpen_Group_"+n+t)).scope();_.isUndefined(l)||e.target.parentElement.id!=="isNavOpen_Group_"+n+t&&!0===l.isNavOpen&&(l.isNavOpen=!1,a.safeApply())}}}});
var workOnViewport=!0;function unitW(t){var e=(t*(100/document.documentElement.clientWidth)).toPrecision(23);return e+="vw"}function unitH(t){var e=(t*(100/document.documentElement.clientHeight)).toPrecision(23);return e+="vh"}function convertVwtoPx(t){return(t=rmUnit(t))/100*document.documentElement.clientWidth}function convertVhtoPx(t){return(t=rmUnit(t))/100*document.documentElement.clientHeight}function convertViewportToPx(t){return{left:convertVwtoPx(t.left),top:convertVhtoPx(t.top),width:convertVwtoPx(t.width),height:convertVhtoPx(t.height),minWidth:t.minWidth,minHeight:t.minHeight}}function inheritWcWidthFromPx(t){return(t-2)*(100/document.documentElement.clientWidth)+"vw"}function inheritWcHeightFromPx(t){return(t-2)*(100/document.documentElement.clientHeight)+"vh"}function inheritWcWidthFromIdInst(t){var e=t;return"play"==tabActive&&(e+="c"),inheritWcWidthFromPx($("#"+e).width)}function inheritWcHeightFromIdInst(t){var e=t;return"play"==tabActive&&(e+="c"),inheritWcHeightFromPx($("#"+e).height)}function getMedia(){return window.matchMedia("(min-width: 768px)").matches?"large":"small"}function isMediaChanged(t){var e=!1;return"small"==t&&window.matchMedia("(min-width: 768px)").matches?(t="large",e=!0):"large"==t&&window.matchMedia("(max-width: 767px)").matches?(t="small",e=!0):e=!1,{bChanged:e,lastMedia:t}}function getFontFactor(){return"play"==tabActive?window.matchMedia("(min-width: 768px)").matches?1:widgetPreview.getCols()||1:"widgets"==tabActive?window.matchMedia("(min-width: 768px)").matches?1:layoutMgr.getCols()||1:1}
function basePlugin(i){i&&(this.pluginDefinition=i),this.widgetsCount={},Object.keys(this.pluginDefinition.widgetsDefinitionList).forEach(i=>this.widgetsCount[i]=0),this.createWidget=function(i,t,n,e){this.widgetsCount[t]++;const s=this.pluginDefinition.widgetsDefinitionList[t].factory;return new("function"==typeof s?s:this[s])(i,this.widgetsCount[t],n,e)},this.copyWidget=function(i,t,n,e,s){return this.createWidget(i,t,e,s)},this.clear=function(){Object.keys(this.pluginDefinition.widgetsDefinitionList).forEach(i=>this.widgetsCount[i]=0)}}
function baseWidget(e,o,t,r){this.idDivContainer=e,this.idWidget=o,this.idInstance=t,this.bIsInteractive=r,this.getColorValueFromCSSProperty=function(e){let o=e;if(o.includes("var(--")){const t=e.substring(4,e.length-1);o=window.getComputedStyle(document.documentElement).getPropertyValue(t)}return o},this.setColorValueFromModelParameters=function(e,o){let r=o;_.isUndefined(modelsParameters[t][e])?modelsParameters[t][e]=o:r=modelsParameters[t][e];return this.getColorValueFromCSSProperty(r)},this.labelFontSize=function(){return"font-size: calc(7px + "+modelsParameters[t].labelFontSize*getFontFactor()+"vw + 0.4vh); "},this.valueFontSize=function(){return"font-size: calc(7px + "+modelsParameters[t].valueFontSize*getFontFactor()+"vw + 0.4vh); "},this.valueFormat=function(e){const o=parseInt(modelsParameters[t].decimalDigits,10);if(isNaN(o))return e;let r=e;if(-1!=o&&!isNaN(e)){if(r=parseFloat(e),isNaN(r))return e;r=Math.round10(r,-o)}return r},this.fontSize=function(){return"font-size: calc(7px + "+modelsParameters[t].fontsize*getFontFactor()+"vw + 0.4vh); "},this.selectFontSize=function(){return"font-size: calc(7px + "+modelsParameters[t].selectValueFontSize*getFontFactor()+"vw + 0.4vh); "},this.labelColor=function(){return"color:"+this.setColorValueFromModelParameters("labelColor","var(--widget-label-color)")+"; "},this.valueColor=function(){return"color:"+this.setColorValueFromModelParameters("valueColor","var(--widget-color)")+"; "},this.labelFontFamily=function(){_.isUndefined(modelsParameters[t].labelFontFamily)&&(modelsParameters[t].labelFontFamily="Helvetica Neue");return"font-family: "+modelsParameters[t].labelFontFamily+", Helvetica, Arial, sans-serif; "},this.valueFontFamily=function(){_.isUndefined(modelsParameters[t].valueFontFamily)&&(modelsParameters[t].valueFontFamily="Helvetica Neue");return"font-family: "+modelsParameters[t].valueFontFamily+", Helvetica, Arial, sans-serif; "},this.border=function(){let e="border: none; ";if(modelsParameters[t].displayBorder){e="border: 2px solid "+this.setColorValueFromModelParameters("borderColor","var(--widget-border-color)")+"; "}else e+=NaN,e+="-moz-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0);",e+="box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0);";return e},this.captionHelper=function(e,o,r){o?modelsParameters[t].label=e:r?modelsParameters[t].inheritLabelFromData=!1:modelsParameters[t].label=e},this.backgroundColor=function(){return"background-color:"+this.setColorValueFromModelParameters("backgroundColor","#ffffff")+"; "},this.getTransformedText=function(e){let o=modelsParameters[t][e]||"";if(o){if(!($("<div>").html(o).children().length>0)){o=(new DOMParser).parseFromString("<!doctype html><body>"+o,"text/html").body.textContent}}return o},this.buttonFontFamily=function(){_.isUndefined(modelsParameters[t].buttonFontFamily)&&(modelsParameters[t].buttonFontFamily="Helvetica Neue");return"font-family: "+modelsParameters[t].buttonFontFamily+", Helvetica, Arial, sans-serif; "},this.setButtonColorStyle=function(){const e=this.setColorValueFromModelParameters("buttonDefaultColor","var(--widget-button-color)"),o=this.setColorValueFromModelParameters("buttonHoverColor","var(--widget-button-hover-color)"),l=this.setColorValueFromModelParameters("buttonActiveColor","var(--widget-button-active-color)"),a=this.setColorValueFromModelParameters("buttonTextColor","var(--widget-button-text)"),s="styleNormalFor"+t+"widgetCustomColor";let n=document.getElementById(s);const i="."+t+"widgetCustomColor{ color: "+a+";background-color: "+e+";border-color: "+e+"; }";if(null==n?(n=document.createElement("style"),n.type="text/css",n.id=s,n.innerHTML=i,document.getElementsByTagName("head")[0].appendChild(n)):n.innerHTML=i,r){const e="styleHoverFor"+t+"widgetCustomColor";let r=document.getElementById(e);const a="."+t+"widgetCustomColor:hover{ background-color: "+o+";border-color: "+o+";}";null==r?(r=document.createElement("style"),r.type="text/css",r.id=e,r.innerHTML=a,document.getElementsByTagName("head")[0].appendChild(r)):r.innerHTML=a;const s="styleActiveFor"+t+"widgetCustomColor";let n=document.getElementById(s);const i="."+t+"widgetCustomColor:active{ background-color: "+l+";border-color: "+l+";}";null==n?(n=document.createElement("style"),n.type="text/css",n.id=s,n.innerHTML=i,document.getElementsByTagName("head")[0].appendChild(n)):n.innerHTML=i}},this.displayIcon=function(){return _.isUndefined(modelsParameters[t].displayIcon)&&(modelsParameters[t].displayIcon=!1),modelsParameters[t].displayIcon},this.fontAwesomeIcon=function(){return _.isUndefined(modelsParameters[t].fontAwesomeIcon)&&(modelsParameters[t].fontAwesomeIcon=""),modelsParameters[t].fontAwesomeIcon},this.validationButtonDefaultColor=function(){return"background-color:"+this.setColorValueFromModelParameters("validationBtnDefaultColor","var(--widget-button-primary-color)")+"; "},this.validationButtonHoverColor=function(){return"background-color:"+this.setColorValueFromModelParameters("validationBtnHoverColor","var(--widget-button-hover-color)")+"; "},this.validationButtonActiveColor=function(){return"background-color:"+this.setColorValueFromModelParameters("validationBtnActiveColor","var(--widget-button-active-color)")+"; "},this.validationButtonBorderColor=function(){let e="border: none; ";if(modelsParameters[t].displayBorder){e="border: 2px solid "+this.setColorValueFromModelParameters("validationBtnDefaultColor","var(--widget-border-color)")+"; "}else e+="-webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0);",e+="-moz-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0);",e+="box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0);";return e},this.graphColor=function(){return this.setColorValueFromModelParameters("graphColor","var(--widget-label-color)")},this.subLabelFontFamily=function(){_.isUndefined(modelsParameters[t].subLabelFontFamily)&&(modelsParameters[t].subLabelFontFamily="Helvetica Neue");return"font-family: "+modelsParameters[t].subLabelFontFamily+", Helvetica, Arial, sans-serif; "},this.subLabelColor=function(){return"color:"+this.setColorValueFromModelParameters("subLabelColor","var(--widget-subtext-color)")+"; "},this.subLabelFontSize=function(){return"font-size: calc(7px + "+modelsParameters[t].subLabelFontSize*getFontFactor()+"vw + 0.4vh); "},this.checkedColor=function(){_.isUndefined(modelsParameters[t].checkboxColor)||delete modelsParameters[t].checkboxColor;return"color: "+this.setColorValueFromModelParameters("checkedColor","var(--widget-input-checked-color)")+"; "},this.uncheckedColor=function(){return"color: "+this.setColorValueFromModelParameters("uncheckedColor","var(--widget-input-unchecked-color)")+"; "},this.switchOnColor=function(){return"background-color: "+this.setColorValueFromModelParameters("switchOnColor","var(--widget-input-checked-color)")+"; "},this.switchOffColor=function(){return"background-color: "+this.setColorValueFromModelParameters("switchOffColor","var(--widget-input-unchecked-color)")+"; "},this.switchShadowColor=function(){return"box-shadow: 0 0 1px "+this.setColorValueFromModelParameters("switchOnColor","var(--widget-input-checked-color)")+"; "},this.progressBarRangeColor=function(){return"background-color: "+this.setColorValueFromModelParameters("progressBarRangeColor","var(--widget-range-color)")+"; "},this.progressBarSegmentColor=function(){return"background-color: "+this.setColorValueFromModelParameters("progressBarSegmentColor","var(--widget-segment-color)")+"; "},this.sliderRangeColor=function(){return"background-color: "+this.setColorValueFromModelParameters("sliderRangeColor","var(--widget-range-color)")+"; "},this.sliderSegmentColor=function(){return"background-color: "+this.setColorValueFromModelParameters("sliderSegmentColor","var(--widget-segment-color)")+"; "},this.sliderHandleDefaultColor=function(){return"background-color: "+this.setColorValueFromModelParameters("sliderHandleDefaultColor","var(--widget-handle-default-color)")+"; "},this.sliderHandleHoverColor=function(){return"background-color: "+this.setColorValueFromModelParameters("sliderHandleHoverColor","var(--widget-handle-hover-color)")+"; "},this.sliderHandleActiveColor=function(){return"background-color: "+this.setColorValueFromModelParameters("sliderHandleActiveColor","var(--widget-handle-active-color)")+"; "},this.valueBorderColor=function(){return"border-color: "+this.setColorValueFromModelParameters("valueBorderColor","var(--widget-border-color)")+"; "},this.textSize=function(){return"font-size: calc(7px + "+modelsParameters[t].textSize*getFontFactor()+"vw + 0.4vh); "},this.textColor=function(){return"color: "+this.setColorValueFromModelParameters("textColor","var(--widget-color)")+"; "},this.subTextColor=function(){return"color: "+this.setColorValueFromModelParameters("subTextColor","var(--widget-color)")+"; "},this.browseButtonTextColor=function(){const e=this.setColorValueFromModelParameters("browseButtonTextColor","var(--widget-button-text)");let o=" color: "+e+"; ";return o+=" border-color: "+e+"; ",o},this.browseButtonDefaultColor=function(){return" background-color: "+this.setColorValueFromModelParameters("browseButtonDefaultColor","var(--widget-button-color)")+"; "},this.browseButtonHoverColor=function(){return" background-color: "+this.setColorValueFromModelParameters("browseButtonHoverColor","var(--widget-button-hover-color)")+"; "},this.browseButtonActiveColor=function(){return" background-color: "+this.setColorValueFromModelParameters("browseButtonActiveColor","var(--widget-button-active-color)")+"; "},this.deleteButtonDefaultColor=function(){const e=this.setColorValueFromModelParameters("deleteButtonDefaultColor","var(--widget-delete-button-default-color)");let o=" background-color: "+e+"; ";return o+=" box-shadow: 0 0 2px 3px "+e+"; ",o},this.deleteButtonActiveColor=function(){const e=this.setColorValueFromModelParameters("deleteButtonActiveColor","var(--widget-delete-button-active-color)");let o=" background-color: "+e+"; ";return o+=" box-shadow: 0 0 2px 3px "+e+"; ",o},this.deleteButtonHoverColor=function(){const e=this.setColorValueFromModelParameters("deleteButtonHoverColor","var(--widget-delete-button-hover-color)");let o=" background-color: "+e+"; ";return o+=" box-shadow: 0 0 2px 3px "+e+"; ",o},this.listBackgroundColor=function(){return" background-color: "+this.setColorValueFromModelParameters("listBackgroundColor","var(--widget-select-drop-color)")+"; "},this.selectValueColor=function(){return" color: "+this.setColorValueFromModelParameters("selectValueColor","var(--widget-select-option-highlighted-text)")+"; "},this.selectValueBackgroundColor=function(){return" background-color: "+this.setColorValueFromModelParameters("selectValueBackgroundColor","var(--widget-select-option-highlighted-color)")+"; "},this.valueDefaultColor=function(){return" color: "+this.setColorValueFromModelParameters("valueDefaultColor","var(--widget-label-color)")+"; "},this.valueFocusColor=function(){return" color: "+this.setColorValueFromModelParameters("valueFocusColor","var(--widget-multiselect-checked-text)")+"; "},this.valueHoverColor=function(){return" color: "+this.setColorValueFromModelParameters("valueHoverColor","var(--widget-multiselect-hover-text)")+"; "},this.checkboxDefaultColor=function(){return" background-color: "+this.setColorValueFromModelParameters("checkboxDefaultColor","var(--widget-multiselect-color)")+"; "},this.checkboxFocusColor=function(){return" background-color: "+this.setColorValueFromModelParameters("checkboxFocusColor","var(--widget-multiselect-checked-color)")+"; "},this.checkboxHoverColor=function(){return" background-color: "+this.setColorValueFromModelParameters("checkboxHoverColor","var(--widget-multiselect-hover-color)")+"; "},this.checkboxHoverBorderColor=function(){return" border-color: "+this.setColorValueFromModelParameters("checkboxHoverBorderColor","var(--widget-multiselect-hover-border-color)")+"; "},this.checkboxFocusBorderColor=function(){return" border-color: "+this.setColorValueFromModelParameters("checkboxFocusBorderColor","var(--widget-multiselect-checked-border-color)")+"; "},this.checkboxWidth=function(){_.isUndefined(modelsParameters[t].checkboxWidth)&&(modelsParameters[t].checkboxWidth=7);return" width: "+modelsParameters[t].checkboxWidth+"rem; "},this.checkboxHeight=function(){_.isUndefined(modelsParameters[t].checkboxHeight)&&(modelsParameters[t].checkboxHeight=1.5);return" line-height: "+modelsParameters[t].checkboxHeight+"; "},this.checkboxBorder=function(){let e="border: none; ";if(modelsParameters[t].displayBorder){e=" border: 1.5px solid "+this.setColorValueFromModelParameters("checkboxBorderColor","var(--widget-multiselect-border-color)")+"; "}else e+="-webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0);",e+="-moz-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0);",e+="box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0);";return e},this.selectedValueColor=function(){return" color: "+this.setColorValueFromModelParameters("selectedValueColor","var(--widget-select-option-highlighted-text)")+"; "},this.selectedItemDefaultColor=function(){return" background-color: "+this.setColorValueFromModelParameters("selectedItemDefaultColor","var(--widget-select-option-highlighted-color)")+"; "},this.selectedItemHoverColor=function(){return" background-color: "+this.setColorValueFromModelParameters("selectedItemHoverColor","var(--widget-select-option-highlighted-color)")+"; "},this.valueAlign=function(){_.isUndefined(modelsParameters[t].ValueAlign)||delete modelsParameters[t].ValueAlign,_.isUndefined(modelsParameters[t].valueAlign)&&(modelsParameters[t].valueAlign="left");return" text-align: "+modelsParameters[t].valueAlign+"; "},this.tableBackgroundColor=function(e){_.isUndefined(modelsParameters[t].backgroundColor)&&(modelsParameters[t].backgroundColor={primary:"var(--widget-color-0)",secondary:"var(--widget-table-striped-odd)"});return" background-color: "+this.getColorValueFromCSSProperty(modelsParameters[t].backgroundColor[e])+"; "},this.thicknessBackgroundColor=function(){return' background-color="'+this.setColorValueFromModelParameters("thicknessBackgroundColor","var(--widget-segment-color)")+'" '},this.thicknessColor=function(){return' foreground-color="'+this.setColorValueFromModelParameters("thicknessColor","var(--widget-range-color)")+'" '},this.tipBackgroundColor=function(){return this.setColorValueFromModelParameters("tipBackgroundColor","var(--widget-button-color)")},this.tipBorderColor=function(){return this.setColorValueFromModelParameters("tipBorderColor","var(--widget-button-text)")}}baseWidget.prototype.getActuatorDescriptions=function(e=null){return[]},baseWidget.prototype.getByName=function(e){if(this.hasOwnProperty(e))return this[e]},baseWidget.prototype.getInteractive=function(){return this.bIsInteractive},baseWidget.prototype.setInteractive=function(e){e!=this.bIsInteractive&&(this.bIsInteractive=e,this.render())},baseWidget.prototype.rescale=function(){},baseWidget.prototype.render=function(){};class WidgetActuator{setValue(e){}getValue(){}addValueChangedHandler(e){}removeValueChangedHandler(e){}setCaption(e,o){}clearCaption(){}}class WidgetActuatorBase extends WidgetActuator{static NOOP_CALLBACK=function(e,o,t){};constructor(e){super(),this.widget=e}updateCallback=WidgetActuatorBase.NOOP_CALLBACK;addValueChangedHandler(e){this.updateDataFromWidget=e}removeValueChangedHandler(e){this.updateDataFromWidget=WidgetActuatorBase.NOOP_CALLBACK}}class WidgetActuatorDescription{static TRIGGER=0;static READ=1;static WRITE=2;static READ_WRITE=WidgetActuatorDescription.READ|WidgetActuatorDescription.WRITE;static FILE=4;constructor(e,o,t,r=null,l=null){this._name=e,this._summary=o,this._readwrite=t,this._schema=r,this._validator=l}get name(){return this._name}get summary(){return this._summary}get direction(){return this._readwrite}get jsonSchema(){return this._schema}get validator(){return this._validator}}class WidgetActuatorValidationError{constructor(e,o){this._msg=e,this._nested=o||[]}get msg(){return this._msg}get nested(){return this._nested}toString(){return this._print().join("\n")}_print(e=""){return[e+"- "+this._msg,...this._nested.flatMap(o=>o._print(e+"   "))]}compareTo(e){const o=this.msg.localeCompare(e.msg);if(0!==o)return o;const t=this.nested.length,r=t-e.nested.length;if(0!==r)return r;for(let o=0;o<t;o++){const t=this.nested[o].compareTo(e.nested[o]);if(0!==t)return t}return 0}}
function scoringWidgetsPluginClass(){var e=this,r=0;this.scoringFullCircularGauge=function(i,a,t,n){return r++,new e.scoringCircularGaugeWidget(i,r,t,n,"full")},this.scoringSemiCircularGauge=function(i,a,t,n){return r++,new e.scoringCircularGaugeWidget(i,r,t,n,"semi")},this.scoringArchCircularGauge=function(i,a,t,n){return r++,new e.scoringCircularGaugeWidget(i,r,t,n,"arch")},this.clear=function(){r=0},this.scoringCircularGaugeWidget=function(e,r,i,a,t){this.constructor(e,r,i,a,t);var n=this;this.enable=function(){},this.disable=function(){},this.rescale=function(){this.render()},this.render=function(){var a=document.createElement("div");a.setAttribute("style","text-align: center; height: inherit; width: inherit; cursor: inherit"),a.setAttribute("id","div-for-ng-gauge"+r),$("#"+e).html(a);var o=Math.min($("#div-for-ng-gauge"+r).width(),$("#div-for-ng-gauge"+r).height()),l="gaugeValues.val"+r,u=angular.element('<ng-gauge id="ng-gauge'+r+'" style="'+this.valueColor()+'" size="'+o+'" type="'+t+'" thick="'+modelsParameters[i].thick+'" min="'+modelsParameters[i].min+'" max="'+modelsParameters[i].max+'" value="'+l+'"" cap="round" label="'+modelsParameters[i].label+'" duration="'+modelsParameters[i].duration+'"'+this.thicknessColor()+this.thicknessBackgroundColor()+'" append="'+modelsParameters[i].unit+'"></ng-gauge>'),g=document.getElementById("div-for-ng-gauge"+r);angular.element(g).append(u),angular.element(document.body).injector().invoke(["$compile","$rootScope",function(e,a){var t=angular.element(u).scope();a.gaugeValues||(a.gaugeValues={}),a.gaugeValues["val"+r]=modelsHiddenParams[i].value,e(u)(t)}]),this.bIsInteractive?n.enable():n.disable()};const o=new WidgetActuatorDescription("value","Numeric value",WidgetActuatorDescription.READ,WidgetPrototypesManager.SCHEMA_NUMBER);this.getActuatorDescriptions=function(){return[o]},this.value={updateCallback:function(){},setValue:function(e){modelsHiddenParams[i].value=e,angular.element(document.body).injector().invoke(["$compile","$rootScope",function(i,a){a.gaugeValues["val"+r]=e,a.safeApply()}])},getValue:function(){return $("#ng-gauge"+r)[0].value},addValueChangedHandler:function(e){this.updateCallback=e,n.enable()},removeValueChangedHandler:function(e){n.disable()},setCaption:function(e,r){modelsParameters[i].inheritLabelFromData&&n.captionHelper(e,n.bIsInteractive,r)},clearCaption:function(){modelsParameters[i].label="",n.render()}},n.render()},this.scoringCircularGaugeWidget.prototype=baseWidget.prototype,this.pluginDefinition={name:"scoring",widgetsDefinitionList:{scoringFullCircularGauge:{factory:"scoringFullCircularGauge",title:"Full-circular gauge",icn:"full-circular-gauge",help:"wdg/wdg-scoring-gauge/"},scoringSemiCircularGauge:{factory:"scoringSemiCircularGauge",title:"Semi-circular gauge",icn:"semi-circular-gauge",help:"wdg/wdg-scoring-gauge/"},scoringArchCircularGauge:{factory:"scoringArchCircularGauge",title:"Arch-circular gauge",icn:"widgets icn-arch-circular-gauge",help:"wdg/wdg-scoring-gauge/"}}},this.constructor()}modelsHiddenParams.scoringFullCircularGauge={value:75},modelsHiddenParams.scoringSemiCircularGauge={value:75},modelsHiddenParams.scoringArchCircularGauge={value:75},modelsParameters.scoringFullCircularGauge={label:"",inheritLabelFromData:!0,min:0,max:100,unit:"",valueColor:"var(--widget-color)",thick:10,thicknessColor:"var(--widget-range-color)",duration:1500,thicknessBackgroundColor:"var(--widget-segment-color)"},modelsParameters.scoringSemiCircularGauge={label:"",inheritLabelFromData:!0,min:0,max:100,unit:"",valueColor:"var(--widget-color)",thick:10,thicknessColor:"var(--widget-range-color)",duration:1500,thicknessBackgroundColor:"var(--widget-segment-color)"},modelsParameters.scoringArchCircularGauge={label:"",inheritLabelFromData:!0,min:0,max:100,unit:"",valueColor:"var(--widget-color)",thick:10,thicknessColor:"var(--widget-range-color)",duration:1500,thicknessBackgroundColor:"var(--widget-segment-color)"},modelsLayout.scoringFullCircularGauge={height:"15vh",width:"11vw"},modelsLayout.scoringSemiCircularGauge={height:"15vh",width:"11vw"},modelsLayout.scoringArchCircularGauge={height:"15vh",width:"11vw"},scoringWidgetsPluginClass.prototype=basePlugin.prototype;var scoringWidgetsPlugin=new scoringWidgetsPluginClass;widgetsPluginsHandler.loadWidgetPlugin(scoringWidgetsPlugin);
function annotationMarkdownWidgetsPluginClass(){this.markdownAnnotationWidget=function(t,n,e,i){this.constructor(t,n,e,i);var a=this;_.isUndefined(modelsParameters[e].textAlign)&&(modelsHiddenParams[e].textAlign="left"),this.enable=function(){},this.disable=function(){},this.rescale=function(){this.render()},_.isUndefined(modelsParameters[e].centerVertically)&&(modelsParameters[e].centerVertically=!0),this.hasScrollBar=function(t){return t.get(0).scrollHeight>t.get(0).clientHeight},this.render=function(){var i=document.createElement("div"),o="",r='<div id="annotationMarkdownDiv'+n+'" class="defaultCSS" style="overflow: auto; background-color: transparent; box-shadow: none; width: inherit; height: inherit; color:'+modelsParameters[e].textColor+"; text-align: "+modelsParameters[e].textAlign+"; padding: 4px; resize: inherit; border-radius: 6px; "+this.fontSize()+this.valueFontFamily()+this.border()+'"><div style="'+o+'">'+marked.parse(modelsHiddenParams[e].text)+"</div></div>";i.innerHTML=r,i.setAttribute("style","width: inherit; height: inherit; background-color:"+modelsParameters[e].backgroundColor),$("#"+t).html(i);var d=a.hasScrollBar($("#annotationMarkdownDiv"+n));modelsParameters[e].centerVertically&&!d&&(o=" position: relative; top: 50%; -webkit-transform: translateY(-50%); -ms-transform: translateY(-50%); transform: translateY(-50%);",$("#annotationMarkdownDiv"+n+" div").attr("style",o))};const o=new WidgetActuatorDescription("text","Markdown content",WidgetActuatorDescription.READ,WidgetPrototypesManager.SCHEMA_STRING);this.getActuatorDescriptions=function(){return[o]},this.text={setValue:function(t){modelsHiddenParams[e].text=t,a.render()},getValue:function(){return modelsHiddenParams[e].text},addValueChangedHandler:function(t){a.enable()},removeValueChangedHandler:function(t){a.disable()}},a.render()},this.markdownAnnotationWidget.prototype=baseWidget.prototype,this.pluginDefinition={name:"annotation",widgetsDefinitionList:{annotationMarkdown:{factory:"markdownAnnotationWidget",title:"Markdown",icn:"markdown",help:"wdg/wdg-annotation-video/#markdown"}}},this.constructor()}modelsHiddenParams.annotationMarkdown={text:""},modelsParameters.annotationMarkdown={fontsize:.3,backgroundColor:"rgba(0, 0, 0, 0)",textColor:"var(--widget-color)",valueFontFamily:"var(--widget-font-family)",textAlign:"left",displayBorder:!1,centerVertically:!0},modelsLayout.annotationMarkdown={height:"30vh",width:"30vw",minWidth:"50px",minHeight:"32px"},annotationMarkdownWidgetsPluginClass.prototype=basePlugin.prototype;var annotationMarkdownWidgetsPlugin=new annotationMarkdownWidgetsPluginClass;widgetsPluginsHandler.loadWidgetPlugin(annotationMarkdownWidgetsPlugin);
function genericHtmlWidgetPluginClass(){this.genericHtmlWidget=function(t,e,i,n){this.constructor(t,e,i,n);var r=this;_.isUndefined(modelsParameters[i].textAlign)&&(modelsHiddenParams[i].textAlign="left"),this.enable=function(){},this.disable=function(){},this.rescale=function(){this.render()},_.isUndefined(modelsParameters[i].centerVertically)&&(modelsParameters[i].centerVertically=!0),this.hasScrollBar=function(t){return t.get(0).scrollHeight>t.get(0).clientHeight},this.render=function(){var n=document.createElement("div"),l="",a='<div id="htmlDiv'+e+'" class="defaultCSS" style="overflow: auto; background-color: transparent; box-shadow: none; width: inherit; height: inherit; color:'+modelsParameters[i].textColor+"; text-align: "+modelsParameters[i].textAlign+"; padding: 4px; resize: inherit; border-radius: 6px; "+this.fontSize()+this.valueFontFamily()+this.border()+'"><div style="'+l+'">'+modelsHiddenParams[i].html+"</div></div>";n.innerHTML=a,n.setAttribute("style","width: inherit; height: inherit; background-color:"+modelsParameters[i].backgroundColor),$("#"+t).html(n);var o=r.hasScrollBar($("#htmlDiv"+e));modelsParameters[i].centerVertically&&!o&&(l=" position: relative; top: 50%; -webkit-transform: translateY(-50%); -ms-transform: translateY(-50%); transform: translateY(-50%);",$("#htmlDiv"+e+" div").attr("style",l))};const l=new WidgetActuatorDescription("html","Html content",WidgetActuatorDescription.READ,WidgetPrototypesManager.SCHEMA_STRING);this.getActuatorDescriptions=function(){return[l]},this.html={setValue:function(t){modelsHiddenParams[i].html=t,r.render()},getValue:function(){return modelsHiddenParams[i].html},addValueChangedHandler:function(t){r.enable()},removeValueChangedHandler:function(t){r.disable()}},r.render()},this.genericHtmlWidget.prototype=baseWidget.prototype,this.pluginDefinition={name:"annotation",widgetsDefinitionList:{annotationHtml:{factory:"genericHtmlWidget",title:"Generic html",icn:"generic-html",help:"wdg/wdg-annotation-video/#generic-html"}}},this.constructor()}modelsHiddenParams.annotationHtml={html:""},modelsParameters.annotationHtml={fontsize:.3,backgroundColor:"rgba(0, 0, 0, 0)",textColor:"var(--widget-color)",valueFontFamily:"var(--widget-font-family)",textAlign:"left",displayBorder:!1,centerVertically:!0},modelsLayout.annotationHtml={height:"30vh",width:"30vw",minWidth:"50px",minHeight:"32px"},genericHtmlWidgetPluginClass.prototype=basePlugin.prototype;var genericHtmlWidgetPlugin=new genericHtmlWidgetPluginClass;widgetsPluginsHandler.loadWidgetPlugin(genericHtmlWidgetPlugin);
function kpiWidgetsPluginClass(){this.kpiCardWidget=function(e,t,a,i){this.constructor(e,t,a,i);var l=this,r="";this.enable=function(){},this.disable=function(){},this.rescale=function(){this.render()},this.render=function(){var i=document.createElement("div");modelsParameters[a].borderShadow?i.setAttribute("class","card-kpi-container card-shadow"):i.setAttribute("class","card-kpi-container ");var n='<div class="card-kpi">';n+='<div class="card-body">',n+='<div class="row align-items-center">';var s="";if(modelsParameters[a].displayLabel){const e=this.getTransformedText("label");s=(s+='<h5 class="card-mt-0 text-truncate"')+' style="text-align:center;'+this.labelFontSize()+this.labelColor()+this.labelFontFamily()+'">'+e,s+="</h5>"}var o="";o=(o=o+'<div id="card-value-'+t+'" class="card-value" style="text-align:center;')+this.valueFontSize()+this.valueColor()+this.valueFontFamily()+'"></div>',n="top"==modelsParameters[a].valuePosition?o+s:s+o,n+="</div>",n+="</div>",n+="</div>",i.innerHTML=n,$("#"+e).html(i),$("#card-value-"+t)[0].innerText=l.valueFormat(modelsHiddenParams[a].value),r='<span id ="unit-span'+t+'" style="text-align: left; color: '+modelsParameters[a].unitColor+"; font-size: calc(7px + "+modelsParameters[a].unitFontSize*getFontFactor()+'vw + 0.4vh);">'+modelsParameters[a].unit+"</span>",""!=modelsParameters[a].unit&&modelsParameters[a].displayUnit&&$("#card-value-"+t).append(r),this.bIsInteractive?l.enable():l.disable()};const n=new WidgetActuatorDescription("value","Current value",WidgetActuatorDescription.READ,WidgetPrototypesManager.SCHEMA_ANY_PRIMITIVE);this.getActuatorDescriptions=function(){return[n]},this.value={updateCallback:function(){},setValue:function(e){modelsHiddenParams[a].value=e,$("#card-value-"+t)[0].innerText=l.valueFormat(modelsHiddenParams[a].value),""!=modelsParameters[a].unit&&modelsParameters[a].displayUnit&&$("#card-value-"+t).append(r)},getValue:function(){return modelsHiddenParams[a].value},addValueChangedHandler:function(e){this.updateCallback=e,l.enable()},removeValueChangedHandler:function(e){l.disable()},setCaption:function(e,t){modelsParameters[a].inheritLabelFromData&&(l.captionHelper(e,l.bIsInteractive,t),l.render())},clearCaption:function(){modelsParameters[a].label="",l.render()}},l.render()},this.kpiCardWidget.prototype=baseWidget.prototype,this.pluginDefinition={name:"kpiCard",widgetsDefinitionList:{kpiCard:{factory:"kpiCardWidget",title:"KPI value",icn:"kpi"}}},this.constructor()}modelsHiddenParams.kpiCard={value:"--"},modelsParameters.kpiCard={label:"labelText",inheritLabelFromData:!0,displayLabel:!0,labelFontSize:.5,labelColor:"var(--widget-label-color)",labelFontFamily:"var(--widget-font-family)",valuePosition:"bottom",valueFontSize:2,valueColor:"var(--widget-color)",valueFontFamily:"var(--widget-font-family)",decimalDigits:3,unit:"unitText",displayUnit:!1,unitFontSize:.5,unitColor:"var(--widget-label-color)",borderShadow:!1},modelsLayout.kpiCard={height:"16vh",width:"18vw",minWidth:"64px",minHeight:"32px"},kpiWidgetsPluginClass.prototype=basePlugin.prototype;var kpiWidgetsPlugin=new kpiWidgetsPluginClass;widgetsPluginsHandler.loadWidgetPlugin(kpiWidgetsPlugin);
function advancedKpiWidgetsPluginClass(){this.advancedKpiCardWidget=function(a,e,t,i){this.constructor(a,e,t,i);var s=this;this.enable=function(){},this.disable=function(){},this.rescale=function(){this.render()},this.initEcharts=function(a){modelsTempParams[t].echartsInstance=echarts.init(document.getElementById(a))},this.getEchartsData=function(){let a=Date.now()+1e3;return{name:a.toString(),value:[a,modelsHiddenParams[t].value]}},this.pushEchartsListData=function(a){modelsTempParams[t].echartsListData.push(a)},this.shiftEchartsListData=function(){modelsTempParams[t].echartsListData.shift()},this.getEchartsListData=function(){return modelsTempParams[t].echartsListData},this.getEchartsOptions=function(){return{xAxis:{type:"time",boundaryGap:!1,axisLabel:!1,axisLine:!1,splitLine:{show:!1}},yAxis:{type:"value",boundaryGap:["",""],axisLabel:!1,axisLine:!1,splitLine:{show:!1}},visualMap:{type:"continuous",show:!1,realtime:!0,inRange:{color:s.graphColor()}},grid:{left:0,top:0,right:0,bottom:0},series:[{type:"line",smooth:.25,showSymbol:!1,areaStyle:{color:new echarts.graphic.LinearGradient(0,0,0,1,[{offset:0,color:s.graphColor()},{offset:1,color:"#ffffff"}])},data:modelsTempParams[t].echartsListData}],animationDuration:0,animationDurationUpdate:1e3,animationEasing:"linear",animationEasingUpdate:"linear"}},this.initEchartsOptions=function(){let a=this.getEchartsOptions();try{modelsTempParams[t].echartsInstance.setOption(a)}catch(a){console.log(a)}},this.setEchartsOptions=function(a){modelsTempParams[t].echartsInstance.setOption({series:[{data:a}]})},this.updateEcharts=function(a){if(i)_.isUndefined(modelsTempParams[t].windowValue)&&(modelsTempParams[t].windowValue=modelsHiddenParams[t].window),this.initEcharts(a),this.initEchartsOptions(),-1==modelsHiddenParams[t].window?(this.pushEchartsListData(this.getEchartsData()),this.setEchartsOptions(this.getEchartsListData())):modelsHiddenParams[t].window>=0&&(0==modelsTempParams[t].windowValue&&this.shiftEchartsListData(),this.pushEchartsListData(this.getEchartsData()),this.setEchartsOptions(this.getEchartsListData()),0!=modelsTempParams[t].windowValue&&--modelsTempParams[t].windowValue),s.enable();else{this.initEcharts(a),this.initEchartsOptions();var e=modelsTempParams[t].echartsInstance.getDataURL();modelsTempParams[t].echartsInstance.dispose(),$("#"+a).html('<img src="'+e+'"/>'),s.disable()}},this.render=function(){var n=document.createElement("div");modelsParameters[t].borderShadow?n.setAttribute("class","card-kpi-container card-shadow"):n.setAttribute("class","card-kpi-container");var r='<div class="card-kpi">';r=(r+='<div class="card-body">')+'<div id="items-'+e+'" class="row align-items-center">';var d="";d=(d=d+'<h5 id="advanced-card-label-'+e+'" class="card-mt-0 text-truncate"')+' style="text-align:center; margin-bottom: 4rem;'+this.labelFontSize()+this.labelColor()+this.labelFontFamily()+'"></h5>';var o="";o=(o=o+'<div id="advanced-card-value-'+e+'" class="card-value" style="text-align:center; margin-bottom: 1.7rem;')+this.valueFontSize()+this.valueColor()+this.valueFontFamily()+'"></div>';var l="";l=(l=l+'<div id="advanced-card-sub-label-'+e+'" class="card-value" style="text-align:center; margin-bottom: 2rem; ')+this.subLabelFontSize()+this.subLabelColor()+this.subLabelFontFamily()+'"></div>';var c="",h="echarts"+e;if(i&&(h+="c"),c=c+'<div id="'+h+'" style="text-align:left; height: 11.9vh; width: 100%; background-color: transparent"></div>',r="top"==modelsParameters[t].valuePosition?o+l+d+c:d+o+l+c,r+="</div>",r+="</div>",r+="</div>",n.innerHTML=r,$("#"+a).html(n),modelsParameters[t].displayLabel){const a=this.getTransformedText("label");$("#advanced-card-label-"+e)[0].innerHTML=a}else $("#advanced-card-label-"+e).hide();$("#advanced-card-value-"+e)[0].innerText=s.valueFormat(modelsHiddenParams[t].value),$("#advanced-card-sub-label-"+e)[0].innerText=s.valueFormat(modelsHiddenParams[t].subLabel),this.updateEcharts(h)};const n={$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:advancedKpiCardWidget",type:"object",properties:{value:{type:["string","number","boolean"]},subLabel:{type:["string","number","boolean"]}},required:["value","subLabel"]},r=new WidgetActuatorDescription("extendedValue","Current value and sub-label",WidgetActuatorDescription.READ,n);this.getActuatorDescriptions=function(){return[r]},this.extendedValue={updateCallback:function(){},setValue:function(a){modelsHiddenParams[t]=a},getValue:function(){return modelsHiddenParams[t]},addValueChangedHandler:function(a){this.updateCallback=a,s.enable()},removeValueChangedHandler:function(a){s.disable()},setCaption:function(a,e){modelsParameters[t].inheritLabelFromData&&(s.captionHelper(a,s.bIsInteractive,e),s.render())},clearCaption:function(){modelsParameters[t].label="",s.render()}},s.render()},this.advancedKpiCardWidget.prototype=baseWidget.prototype,this.pluginDefinition={name:"advancedKpiCard",widgetsDefinitionList:{advancedKpiCard:{factory:"advancedKpiCardWidget",title:"Advanced KPI value",icn:"kpi-advanced"}}},this.constructor()}modelsHiddenParams.advancedKpiCard={value:"--",subLabel:"--"},modelsParameters.advancedKpiCard={label:"labelText",inheritLabelFromData:!0,displayLabel:!0,labelFontSize:.5,labelColor:"var(--widget-label-color)",labelFontFamily:"var(--widget-font-family)",valuePosition:"bottom",valueFontSize:3,valueColor:"var(--widget-color)",valueFontFamily:"var(--widget-font-family)",decimalDigits:3,subLabelFontSize:.5,subLabelColor:"var(--widget-subtext-color)",subLabelFontFamily:"var(--widget-font-family)",borderShadow:!1,graphColor:"var(--widget-label-color)"},modelsTempParams.advancedKpiCard={echartsInstance:"",echartsListData:[]},modelsLayout.advancedKpiCard={height:"33vh",width:"14vw",minWidth:"64px",minHeight:"32px"},advancedKpiWidgetsPluginClass.prototype=basePlugin.prototype;var advancedKpiWidgetsPlugin=new advancedKpiWidgetsPluginClass;widgetsPluginsHandler.loadWidgetPlugin(advancedKpiWidgetsPlugin);
function doubleSliderWidgetsPluginClass(){this.doubleSliderFlatUiWidget=function(e,a,l,n){this.constructor(e,a,l,n);var i=this;this.enable=function(){},this.disable=function(){},this.getCleanedOptions=function(e){return{floor:e.minRange,ceil:e.maxRange,step:e.step,precision:e.precision,enforceStep:e.enforceStep,disableAnimation:e.disableAnimation,onEnd:e.onEnd}},this.updateMinValue=function(){i.bIsInteractive&&(i.minValue.updateCallback(i.minValue,i.minValue.getValue()),modelsHiddenParams[l].minValue=i.minValue.getValue())},this.updateMaxValue=function(){i.bIsInteractive&&(i.maxValue.updateCallback(i.maxValue,i.maxValue.getValue()),modelsHiddenParams[l].maxValue=i.maxValue.getValue())},this.rescale=function(){this.render()},_.isUndefined(modelsParameters[l].forceValuesToMinAndMax)&&(modelsParameters[l].forceValuesToMinAndMax=!1),this.render=function(){var n=document.createElement("div");n.setAttribute("style","display: table; height: inherit; width: inherit; cursor: inherit"),n.setAttribute("id","div-for-ng-slider"+a),$("#"+e).html(n);Math.min($("#div-for-ng-slider"+a).width(),$("#div-for-ng-slider"+a).height());var t="sliderValues.values_"+l,o="30%",r="labelText",d='<div><rzslider id="ng-slider'+a+'" ng-click="changeValue()" rz-slider-model="'+t+'.minValue"  rz-slider-high="'+t+'.maxValue"  rz-slider-options="getModel('+("sliderValues.params_"+l)+')" ></rzslider></div>',s="",u="calc(7px + 0.5vw + 0.4vh)";1==modelsParameters[l].displayLabel&&(_.isUndefined(modelsParameters[l].label)||(r=this.getTransformedText("label")),_.isUndefined(modelsParameters[l].labelWidthProportion)||(o=modelsParameters[l].labelWidthProportion),_.isUndefined(modelsParameters[l].labelFontSize)||(u=this.labelFontSize()),s='<span class="label-h-slider" id="h-slider-span" style="heigh: auto; width:'+o+"; "+u+this.labelColor()+this.labelFontFamily()+';">'+r+"</span>");var m=angular.element(s+'<div style="display: table-cell; vertical-align: middle; padding-bottom: 18px;"> '+d+"</div>");modelsParameters[l].onEnd=function(e,a,l,n){"max"==n&&i.updateMaxValue(),"min"==n&&i.updateMinValue()};var c=document.getElementById("div-for-ng-slider"+a);angular.element(c).append(m),angular.element(document.body).injector().invoke(["$compile","$rootScope",function(e,a){var n=angular.element(m).scope();a.sliderValues||(a.sliderValues={}),a.sliderValues["values_"+l]={minValue:modelsHiddenParams[l].minValue,maxValue:modelsHiddenParams[l].maxValue},a.getModel=function(e){var a=angular.copy(e);return i.bIsInteractive?(_.isUndefined(a.minRange)||(a.floor=a.minRange),_.isUndefined(a.maxRange)||(a.ceil=a.maxRange)):(a.ceil=a.maxRange,a.floor=a.minRange,a.readOnly=!0),a},a.changeValue=function(){},a.sliderValues["params_"+l]=i.getCleanedOptions(modelsParameters[l]),e(m)(n)}]),document.styleSheets[0].addRule("#ng-slider"+a+" > .rz-bar-wrapper > .rz-bar",this.sliderSegmentColor()),document.styleSheets[0].addRule("#ng-slider"+a+" > .rz-bar-wrapper > .rz-selection",this.sliderRangeColor()),document.styleSheets[0].addRule("#ng-slider"+a+" > .rz-pointer",this.sliderHandleDefaultColor()),document.styleSheets[0].addRule("#ng-slider"+a+" > .rz-pointer:hover",this.sliderHandleHoverColor()),document.styleSheets[0].addRule("#ng-slider"+a+" > .rz-pointer:active",this.sliderHandleActiveColor())};const t=new WidgetActuatorDescription("minValue","Selected minimum value",WidgetActuatorDescription.READ_WRITE,WidgetPrototypesManager.SCHEMA_NUMBER),o=new WidgetActuatorDescription("maxValue","Selected maximum value",WidgetActuatorDescription.READ_WRITE,WidgetPrototypesManager.SCHEMA_NUMBER),r=new WidgetActuatorDescription("minRange","Minimum allowed value",WidgetActuatorDescription.READ,WidgetPrototypesManager.SCHEMA_NUMBER),d=new WidgetActuatorDescription("maxRange","Maximum allowed value",WidgetActuatorDescription.READ,WidgetPrototypesManager.SCHEMA_NUMBER);this.getActuatorDescriptions=function(e){const a=e||modelsParameters[l],n=[t,o];return a&&a.rangeActuator&&(n.push(r),n.push(d)),n},this.minValue={updateCallback:function(){},setValue:function(e){var a=Number(e);modelsHiddenParams[l].minValue=a,angular.element(document.body).injector().invoke(["$compile","$rootScope",function(e,n){n.sliderValues["values_"+l].minValue=a,n.safeApply()}])},getValue:function(){var e=0;return angular.element(document.body).injector().invoke(["$compile","$rootScope",function(a,n){e=n.sliderValues["values_"+l].minValue}]),e},addValueChangedHandler:function(e){this.updateCallback=e,i.enable()},removeValueChangedHandler:function(e){i.disable()},setCaption:function(e,a){},clearCaption:function(){modelsParameters[l].label="",i.render()}},this.maxValue={updateCallback:function(){},setValue:function(e){var a=Number(e);modelsHiddenParams[l].maxValue=a,angular.element(document.body).injector().invoke(["$compile","$rootScope",function(e,n){n.sliderValues["values_"+l].maxValue=a,n.safeApply()}])},getValue:function(){var e;return angular.element(document.body).injector().invoke(["$compile","$rootScope",function(a,n){e=n.sliderValues["values_"+l].maxValue}]),e},addValueChangedHandler:function(e){this.updateCallback=e,i.enable()},removeValueChangedHandler:function(e){i.disable()},setCaption:function(e,a){},clearCaption:function(){modelsParameters[l].label="",i.render()}},i.maxRange={updateCallback:function(){},setValue:function(e){var a=Number(e);modelsParameters[l].maxRange=a,angular.element(document.body).injector().invoke(["$compile","$rootScope",function(e,a){a.sliderValues["params_"+l]=i.getCleanedOptions(modelsParameters[l]),a.safeApply()}]),modelsParameters[l].forceValuesToMinAndMax&&(i.maxValue.setValue(modelsParameters[l].maxRange),i.updateMaxValue())},getValue:function(){var e;return angular.element(document.body).injector().invoke(["$compile","$rootScope",function(a,n){e=modelsParameters[l].maxRange}]),e},addValueChangedHandler:function(e){this.updateCallback=e,i.enable()},removeValueChangedHandler:function(e){i.disable()}},i.minRange={updateCallback:function(){},setValue:function(e){var a=Number(e);modelsParameters[l].minRange=a,angular.element(document.body).injector().invoke(["$compile","$rootScope",function(e,a){a.sliderValues["params_"+l]=i.getCleanedOptions(modelsParameters[l]),a.safeApply()}]),modelsParameters[l].forceValuesToMinAndMax&&(i.minValue.setValue(modelsParameters[l].minRange),i.updateMinValue())},getValue:function(){var e;return angular.element(document.body).injector().invoke(["$compile","$rootScope",function(a,n){e=modelsParameters[l].minRange}]),e},addValueChangedHandler:function(e){this.updateCallback=e,i.enable()},removeValueChangedHandler:function(e){i.disable()}},i.render()},this.doubleSliderFlatUiWidget.prototype=baseWidget.prototype,this.pluginDefinition={name:"flatUiDoubleSlider",widgetsDefinitionList:{flatUiDoubleSlider:{factory:"doubleSliderFlatUiWidget",title:"Double slider",icn:"double-slider",help:"wdg/wdg-basics/#double-slider"}}},this.constructor()}modelsHiddenParams.flatUiDoubleSlider={minValue:25,maxValue:75},modelsParameters.flatUiDoubleSlider={label:"labelText",displayLabel:!0,labelFontSize:.5,labelColor:"var(--widget-label-color)",labelWidthProportion:"30%",minRange:0,maxRange:100,step:.1,precision:2,enforceStep:!1,disableAnimation:!1,rangeActuator:!1,forceValuesToMinAndMax:!1,sliderSegmentColor:"var(--widget-segment-color)",sliderRangeColor:"var(--widget-range-color)",sliderHandleDefaultColor:"var(--widget-handle-default-color)",sliderHandleHoverColor:"var(--widget-handle-hover-color)",sliderHandleActiveColor:"var(--widget-handle-active-color)"},modelsLayout.flatUiDoubleSlider={height:"8vh",width:"24vw",minWidth:"200px",minHeight:"24px"},doubleSliderWidgetsPluginClass.prototype=basePlugin.prototype;var doubleSliderWidgetsPlugin=new doubleSliderWidgetsPluginClass;widgetsPluginsHandler.loadWidgetPlugin(doubleSliderWidgetsPlugin);
function datePickerWidgetsPluginClass(){var e=this;this.datePickerWidget=function(e,t,a,i,l){this.constructor(e,t,a,i);var r=this;this.dateFieldShow=function(){var e=$("#ng-datepicker"+t);e.hasClass("daterangepicker-hide")&&e.removeClass("daterangepicker-hide")},this.dateFieldHide=function(){var e=$("#ng-datepicker"+t);e.hasClass("daterangepicker-hide")||e.addClass("daterangepicker-hide")},this.enable=function(){$("#"+a+"c").on("click",(function(e,t){widgetPreview.elevateZIndex(a,e),r.dateFieldShow()}))},this.disable=function(){r.dateFieldHide()},this.updateValue=function(e){r.dateValue.updateCallback(r.dateValue,r.dateValue.getValue()),r.dateFieldHide()},this.getShortDate=function(e){var t=String(e.getDate()).padStart(2,"0"),a=String(e.getMonth()+1).padStart(2,"0"),i=e.getFullYear();return e=i+"-"+a+"-"+t},this.rescale=function(){this.render()},this.render=function(){var i=document.createElement("div"),l=!1,d=" ",n="display: table;";modelsHiddenParams[a].visibility&&(l=!0,d="display: none; ",n=""),i.setAttribute("style",n+"text-align: left; height: inherit; width: inherit; cursor: inherit"),i.setAttribute("id","div-for-ng-datepicker"+t),$("#"+e).html(i);var o=$("#div-for-ng-datepicker"+t).height(),s="datepickerValues.val"+a,c="100%",p="labelText",u=($("#div-for-ng-datepicker"+t).width(),""),g="calc(7px + 0.5vw + 0.4vh)",h="calc(7px + 0.5vw + 0.4vh)";if(1==modelsParameters[a].displayLabel&&(_.isUndefined(modelsParameters[a].label)||(p=this.getTransformedText("label")),_.isUndefined(modelsParameters[a].labelWidthProportion)||(c=modelsParameters[a].labelWidthProportion,(100-parseInt(c))*$("#div-for-ng-datepicker"+t).width()/100),_.isUndefined(modelsParameters[a].labelFontSize)||(g=this.labelFontSize()),_.isUndefined(modelsParameters[a].valueFontSize)||(h="calc(7px + "+modelsParameters[a].valueFontSize*getFontFactor()+"vw + 0.4vh)"),u='<span class="value-span" id="date-label-span'+t+'" style="width:'+c+"; "+g+this.labelColor()+this.labelFontFamily()+'">'+p+"</span>",l)){var m=80*$("#div-for-ng-datepicker"+t).width()/100,v=20*$("#div-for-ng-datepicker"+t).height()/100;u='<span class="value-span" id="date-label-span'+t+'" style="width:'+m+"px;height:"+v+"px;text-align: center;padding-bottom: 0px; "+g+this.labelColor()+this.labelFontFamily()+'">'+p+"</span>"}var b="disabled",f="cursor: inherit; ";if(this.bIsInteractive){b="";f="cursor: pointer; "}var k=this.border(),P='<datepicker id="ng-datepicker'+t+'" date-format="yyyy-MM-dd" datepicker-show="'+l+'" selector="form-control"><div style="cursor: inherit"><input  id="'+("calender-input"+t)+'" class="value-input form-control " style="'+f+" height: "+o+"px; border-radius: 6px; "+d+k+"float: right; font-size: "+h+";"+this.valueColor()+this.valueFontFamily()+this.backgroundColor()+"padding-right: "+h.replace("(","(3*(").replace(")","))")+";text-align: "+modelsParameters[a].valueTextAlign+'; " ng-model="'+s+'.currentDate" '+b+' placeholder="Choose a date"/><span class="form-control-feedback" style="cursor: inherit; display: table;margin-top:0; top:0; padding-right: '+h+"; height: "+o+'px;"><i class="fa fa-lg fa-calendar" style="display: table-cell; vertical-align: middle; font-size:'+h+'"></i></span></div></datepicker>',y=u+'<div style="cursor: inherit; height: 100%"> '+P+"</div> ";if(l){var w="height: 100%; width: 100%";modelsParameters[a].displayLabel&&(w="height: 80%; width: 80%"),y='<div style="'+w+'"> '+P+"</div> "+u}var F=angular.element(y),S=document.getElementById("div-for-ng-datepicker"+t);angular.element(S).append(F),angular.element(document.body).injector().invoke(["$compile","$rootScope",function(e,t){var i=angular.element(F).scope();if(t.datepickerValues||(t.datepickerValues={}),t.datepickerValues["val"+a]||(t.datepickerValues["val"+a]={currentDate:r.getShortDate(new Date)}),modelsHiddenParams[a]){if(!modelsHiddenParams[a].value){var l=new Date;modelsHiddenParams[a].value=r.getShortDate(l)}t.datepickerValues["val"+a]={currentDate:modelsHiddenParams[a].value}}t.$watch("datepickerValues.val"+a,(function(){r.updateValue()}),!0),e(F)(i)}]),r.dateFieldHide(),this.bIsInteractive?r.enable():r.disable()};const d=new WidgetActuatorDescription("dateValue","Selected date as YYYY-MM-DD",WidgetActuatorDescription.READ_WRITE,{$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:datePickerWidgetSemi",type:"string",pattern:"^\\d\\d\\d\\d-[0-1]\\d-[0-3]\\d$"});this.getActuatorDescriptions=function(){return[d]},this.dateValue={updateCallback:function(){},setValue:function(e){var t=Date.parse(e);_.isNaN(t)||(modelsHiddenParams[a].value=r.getShortDate(new Date(t)),angular.element(document.body).injector().invoke(["$compile","$rootScope",function(e,t){t.datepickerValues["val"+a]&&(t.datepickerValues["val"+a].currentDate=modelsHiddenParams[a].value,t.safeApply())}]))},getValue:function(){var e=null;return angular.element(document.body).injector().invoke(["$compile","$rootScope",function(t,i){i.datepickerValues["val"+a]&&(e=i.datepickerValues["val"+a].currentDate,modelsHiddenParams[a].value=e)}]),e},addValueChangedHandler:function(e){this.updateCallback=e},removeValueChangedHandler:function(e){},setCaption:function(e,i){modelsParameters[a].inheritLabelFromData&&(r.captionHelper(e,r.bIsInteractive,i),$("#date-label-span"+t).text(modelsParameters[a].label))},clearCaption:function(){modelsParameters[a].label="",r.render()}},r.render()},this.datePickerWidgetSemi=function(t,a,i,l){return new e.datePickerWidget(t,a,i,l,"semi")},this.datePickerWidgetFull=function(t,a,i,l){return new e.datePickerWidget(t,a,i,l,"full")},this.datePickerWidget.prototype=baseWidget.prototype,this.pluginDefinition={name:"datepicker",widgetsDefinitionList:{datepickerSimple:{factory:"datePickerWidgetSemi",title:"Simple calender",icn:"calendar",help:"wdg/wdg-geo-time/#simple-calendar"}}},this.constructor()}modelsHiddenParams.datepickerSimple={value:"",visibility:!1},modelsHiddenParams.datepickerVisible={value:"",visibility:!0},modelsParameters.datepickerSimple={label:"labelText",inheritLabelFromData:!0,displayLabel:!0,labelFontSize:.5,labelColor:"var(--widget-label-color)",labelWidthProportion:"30%",valueFontSize:.5,valueColor:"var(--widget-color)",valueFontFamily:"var(--widget-font-family)",valueTextAlign:"left",displayBorder:!0,borderColor:"var(--widget-border-color)",backgroundColor:"var(--widget-input-color)"},modelsParameters.datepickerVisible={label:"labelText",inheritLabelFromData:!1,displayLabel:!0,labelFontSize:.5,labelColor:"var(--widget-label-color)",labelFontFamily:"var(--widget-font-family)",valueFontSize:.5,valueColor:"var(--widget-color)",valueFontFamily:"var(--widget-font-family)"},modelsLayout.datepickerSimple={height:"5vh",width:"19vw",minWidth:"150px",minHeight:"32px"},modelsLayout.datepickerVisible={height:"45vh",width:"22vw",minWidth:"150px",minHeight:"190px"},datePickerWidgetsPluginClass.prototype=basePlugin.prototype;var datePickerWidgetsPlugin=new datePickerWidgetsPluginClass;widgetsPluginsHandler.loadWidgetPlugin(datePickerWidgetsPlugin);
function dateRangePickerWidgetsPluginClass(){this.dateRangePickerWidget=function(e,a,t,i){this.constructor(e,a,t,i);const r=this;this.formatDateValue="",this.updateDateValue=function(e){this.bIsInteractive&&(r.endDateValue.updateCallback(r.endDateValue,r.endDateValue.getValue()),modelsHiddenParams[t].endDateValue=r.endDateValue.getValue(),r.startDateValue.updateCallback(r.startDateValue,r.startDateValue.getValue()),modelsHiddenParams[t].startDateValue=r.startDateValue.getValue())},this.rescale=function(){this.render()},this.render=function(){const i=document.createElement("div");i.setAttribute("style","display: table;text-align: left; height: inherit; width: inherit; cursor: inherit"),i.setAttribute("id","div-for-daterangepicker"+a),$("#"+e).html(i);let d="0%",l="labelText",n=$("#div-for-daterangepicker"+a).width(),s="",o="calc(7px + 0.5vw + 0.4vh)",u="calc(7px + 0.5vw + 0.4vh)";_.isUndefined(modelsParameters[t].inheritLabelFromData)||delete modelsParameters[t].inheritLabelFromData,1==modelsParameters[t].displayLabel&&(_.isUndefined(modelsParameters[t].label)||(l=this.getTransformedText("label")),_.isUndefined(modelsParameters[t].labelWidthProportion)||(d=modelsParameters[t].labelWidthProportion,n=(100-parseInt(d))*$("#div-for-daterangepicker"+a).width()/100),_.isUndefined(modelsParameters[t].labelFontSize)||(o=this.labelFontSize()),_.isUndefined(modelsParameters[t].valueFontSize)||(u="calc(7px + "+modelsParameters[t].valueFontSize*getFontFactor()+"vw + 0.4vh)"),s='<span class="value-span" id="date-label-span'+a+'" style="width:'+d+"; "+o+this.labelColor()+this.labelFontFamily()+';">'+l+"</span>");let c="disabled",m="cursor: inherit; ";this.bIsInteractive&&(c="",m="cursor: pointer; ");const g=this.border(),p=$("#div-for-daterangepicker"+a).height(),h=s+'<div style="height:100% width: '+n+'px;">'+('<div id="daterangepicker'+a+'" ><input type="text" autocomplete="off" '+c+' placeholder="Choose a date range" id="daterangepickerInput'+a+'" style="'+m+" height: "+p+"px; border-radius: 6px; "+g+"float: right;padding-right: "+u.replace("(","(3*(").replace(")","))")+";text-align: "+modelsParameters[t].valueTextAlign+"; font-size: "+u+"; "+this.valueColor()+this.valueFontFamily()+this.backgroundColor()+'" class="value-input form-control ng-pristine ng-untouched ng-valid ng-empty" /><span class="form-control-feedback" style="'+m+"height: "+p+"px; display:table; margin-top: 0; top:0; padding-right: "+u+'"><i class="fa fa-lg fa-calendar" style="display: table-cell; vertical-align: middle;'+m+"font-size: "+u+';" ></i></span></div>')+"</div>";i.innerHTML=h,modelsParameters[t].displayTimePicker?r.formatDateValue=modelsParameters[t].displayTimePicker24Hour?"YYYY-MM-DD hh:mm":"YYYY-MM-DD hh:mm A":r.formatDateValue="YYYY-MM-DD";let D="",P="";D=""!==modelsHiddenParams[t].startDateValue?modelsHiddenParams[t].startDateValue:moment().startOf("hour"),P=""!==modelsHiddenParams[t].endDateValue?modelsHiddenParams[t].endDateValue:moment().startOf("hour").add(32,"hour"),$('input[id="daterangepickerInput'+a+'"]').daterangepicker({opens:"right",singleDatePicker:!1,showDropdowns:!0,autoUpdateInput:!0,timePicker:modelsParameters[t].displayTimePicker,timePicker24Hour:modelsParameters[t].displayTimePicker24Hour,startDate:D,endDate:P,locale:{format:r.formatDateValue}}),$('input[id="daterangepickerInput'+a+'"]').on("apply.daterangepicker",(function(e,a){modelsHiddenParams[t].startDateValue=a.startDate.format(r.formatDateValue),modelsHiddenParams[t].endDateValue=a.endDate.format(r.formatDateValue),r.updateDateValue()}))};const d={$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:dateRangeWidget_date",type:"string",pattern:"^\\d\\d\\d\\d-[0-1]\\d-[0-3]\\d$"},l=new WidgetActuatorDescription("startDateValue","Selected start date as YYYY-MM-DD",WidgetActuatorDescription.READ_WRITE,d),n=new WidgetActuatorDescription("endDateValue","Selected end date as YYYY-MM-DD",WidgetActuatorDescription.READ_WRITE,d);this.getActuatorDescriptions=function(){return[l,n]},this.startDateValue={updateCallback:function(){},setValue:function(e){moment(e,r.formatDateValue,!0).isValid()&&(modelsHiddenParams[t].startDateValue=e,$('input[id="daterangepickerInput'+a+'"]').data("daterangepicker").setStartDate(modelsHiddenParams[t].startDateValue))},getValue:function(){return modelsHiddenParams[t].startDateValue},addValueChangedHandler:function(e){this.updateCallback=e},removeValueChangedHandler:function(e){},setCaption:function(e,a){},clearCaption:function(){modelsParameters[t].label="",r.render()}},this.endDateValue={updateCallback:function(){},setValue:function(e){moment(e,r.formatDateValue,!0).isValid()&&(modelsHiddenParams[t].endDateValue=e,$('input[id="daterangepickerInput'+a+'"]').data("daterangepicker").setEndDate(modelsHiddenParams[t].endDateValue))},getValue:function(){return modelsHiddenParams[t].endDateValue},addValueChangedHandler:function(e){this.updateCallback=e},removeValueChangedHandler:function(e){},setCaption:function(e,a){},clearCaption:function(){modelsParameters[t].label="",r.render()}},r.render()},this.dateRangePickerWidget.prototype=baseWidget.prototype,this.pluginDefinition={name:"dateRangePicker",widgetsDefinitionList:{dateRangePicker:{factory:"dateRangePickerWidget",title:"Date-range calendar",icn:"date-range-calendar",help:"wdg/wdg-geo-time/#advanced-calendar"}}},this.constructor()}modelsHiddenParams.dateRangePicker={startDateValue:"",endDateValue:""},modelsParameters.dateRangePicker={label:"labelText",displayLabel:!0,displayTimePicker:!1,displayTimePicker24Hour:!1,labelFontSize:.5,labelColor:"var(--widget-label-color)",labelFontFamily:"var(--widget-font-family)",labelWidthProportion:"25%",valueFontSize:.5,valueColor:"var(--widget-color)",valueFontFamily:"var(--widget-font-family)",valueTextAlign:"left",displayBorder:!0,borderColor:"var(--widget-border-color)",backgroundColor:"var(--widget-input-color)"},modelsLayout.dateRangePicker={height:"5vh",width:"24vw",minWidth:"170px",minHeight:"32px"},dateRangePickerWidgetsPluginClass.prototype=basePlugin.prototype;var dateRangePickerWidgetsPlugin=new dateRangePickerWidgetsPluginClass;widgetsPluginsHandler.loadWidgetPlugin(dateRangePickerWidgetsPlugin);
function timePickerWidgetsPluginClass(){this.timepickerWidget=function(e,i,t,a){this.constructor(e,i,t,a);var l=this;this.enable=function(){},this.disable=function(){},this.updateValue=function(e){l.timeValue.updateCallback(l.timeValue,l.timeValue.getValue()),modelsHiddenParams[t].timeValue=l.timeValue.getValue()},this.rescale=function(){this.render()},this.render=function(){var a=document.createElement("div");a.setAttribute("style","display: table;text-align: left; height: inherit; width: inherit; cursor: inherit"),a.setAttribute("id","div-for-ng-timepicker"+i),$("#"+e).html(a);var r="";r=this.bIsInteractive?"clockpicker ":" ";var n="0%",o="labelText",s=$("#div-for-ng-timepicker"+i).width(),d="",c="calc(7px + 0.5vw + 0.4vh)",u="calc(7px + 0.5vw + 0.4vh)";1==modelsParameters[t].displayLabel&&(_.isUndefined(modelsParameters[t].label)||(o=this.getTransformedText("label")),_.isUndefined(modelsParameters[t].labelWidthProportion)||(n=modelsParameters[t].labelWidthProportion,s=(100-parseInt(n))*$("#div-for-ng-timepicker"+i).width()/100),_.isUndefined(modelsParameters[t].labelFontSize)||(c=this.labelFontSize()),_.isUndefined(modelsParameters[t].valueFontSize)||(u="calc(7px + "+modelsParameters[t].valueFontSize*getFontFactor()+"vw + 0.4vh)"),d='<span class="value-span" id="time-label-span'+i+'" style="width:'+n+"; "+c+this.labelColor()+this.labelFontFamily()+';">'+o+"</span>");var m="disabled",p="cursor: inherit; ";this.bIsInteractive&&(m="",p="cursor: pointer; ");var g=this.border(),h=$("#div-for-ng-timepicker"+i).height(),f=d+'<div style="height:100% width: '+s+'px;">'+('<div id="clockpicker'+i+'" ><div class="'+r+'"><input autocomplete="off" '+m+' placeholder="Select Time" id="clockpickerInput'+i+'" style="'+p+" height: "+h+"px; border-radius: 6px; "+g+"float: right;padding-right: "+u.replace("(","(3*(").replace(")","))")+";text-align: "+modelsParameters[t].valueTextAlign+"; font-size: "+u+"; "+this.valueColor()+this.valueFontFamily()+this.backgroundColor()+'" class="value-input form-control ng-pristine ng-untouched ng-valid ng-empty"><span class="form-control-feedback" style="'+p+"height: "+h+"px; display:table; margin-top: 0; top:0; padding-right: "+u+'"><i class="fa fa-lg fa-clock-o" style="display: table-cell; vertical-align: middle;'+p+"font-size: "+u+';" ></i></span></div></div>')+"</div>";a.innerHTML=f,$("#clockpicker"+i).clockpicker({autoclose:!0,default:"12:00",init:function(){this.value=modelsHiddenParams[t].timeValue},beforeShow:function(){},afterShow:function(){},beforeHide:function(){},afterHide:function(){},beforeHourSelect:function(){},afterHourSelect:function(){},beforeDone:function(){},afterDone:function(){}}).find("input").change((function(){modelsHiddenParams[t].timeValue=this.value,l.updateValue()})),$("#clockpickerInput"+i)[0].value=modelsHiddenParams[t].timeValue,$("#check-minutes").click((function(e){e.stopPropagation(),input.clockpicker("show").clockpicker("toggleView","minutes")})),this.bIsInteractive?l.enable():l.disable()};const r=new WidgetActuatorDescription("timeValue","Selected time as MM:HH",WidgetActuatorDescription.READ_WRITE,{$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:timepickerWidget",type:"string",pattern:"^[0-2]\\d:[0-5]\\d$"});this.getActuatorDescriptions=function(){return[r]},this.timeValue={updateCallback:function(){},setValue:function(e){modelsHiddenParams[t].timeValue=e,$("#clockpickerInput"+i)[0].value=e},getValue:function(){return modelsHiddenParams[t].timeValue},addValueChangedHandler:function(e){this.updateCallback=e,l.enable()},removeValueChangedHandler:function(e){l.disable()},setCaption:function(e,a){modelsParameters[t].inheritLabelFromData&&(l.captionHelper(e,l.bIsInteractive,a),$("#time-label-span"+i).text(modelsParameters[t].label))},clearCaption:function(){modelsParameters[t].label="",l.render()}},l.render()},this.timepickerWidget.prototype=baseWidget.prototype,this.pluginDefinition={name:"timepicker",widgetsDefinitionList:{timepickerSimple:{factory:"timepickerWidget",title:"Simple clock",icn:"clock",help:"wdg/wdg-geo-time/#simple-clock"}}},this.constructor()}modelsHiddenParams.timepickerSimple={timeValue:""},modelsParameters.timepickerSimple={label:"labelText",inheritLabelFromData:!0,displayLabel:!0,labelFontSize:.5,labelColor:"var(--widget-label-color)",labelFontFamily:"var(--widget-font-family)",labelWidthProportion:"30%",valueFontSize:.5,valueColor:"var(--widget-color)",valueFontFamily:"var(--widget-font-family)",valueTextAlign:"left",displayBorder:!0,borderColor:"var(--widget-border-color)",backgroundColor:"var(--widget-input-color)"},modelsLayout.timepickerSimple={height:"5vh",width:"19vw",minWidth:"150px",minHeight:"32px"},timePickerWidgetsPluginClass.prototype=basePlugin.prototype;var timePickerWidgetsPlugin=new timePickerWidgetsPluginClass;widgetsPluginsHandler.loadWidgetPlugin(timePickerWidgetsPlugin);
function calendarD3WidgetPluginClass(){this.calendarD3Widget=function(t,e,a,n){this.constructor(t,e,a,n);var r=this;this.enable=function(){},this.disable=function(){},this.updateValue=function(t){r.SelectedDate.updateCallback(r.SelectedDate,r.SelectedDate.getValue())},this.rescale=function(){this.render()},this.render=function(){var n=document.createElement("div");n.setAttribute("style","display: table;text-align: left; height: inherit; width: inherit; cursor: inherit"),n.setAttribute("id","div-for-calendarD3"+e),$("#"+t).html(n);const i=n.getBoundingClientRect();var l=i.width,d=i.height,o=d3.timeFormat("%Y-%m-%d");if(!_.isUndefined(modelsHiddenParams[a].CalendarValues)&&modelsHiddenParams[a].CalendarValues.length)s=modelsHiddenParams[a].CalendarValues;else var s=d3.timeDay.range(new Date(2020,5,2),Date.now()).map(t=>({date:o(t),value:void 0}));var c=d3.timeParse("%Y-%m-%d");s=(s=s.map(t=>({date:c(t.date),value:t.value}))).sort((function(t,e){return t.date.getTime()-e.date.getTime()}));var u=d3.timeDay.range(s[0].date,s[s.length-1].date),g=_.difference(u.map((function(t){return t.getTime()})),s.map((function(t){return t.date.getTime()})));g.length>0&&(g.forEach((function(t){s.push({date:new Date(t),value:void 0})})),s=s.sort((function(t,e){return t.date.getTime()-e.date.getTime()}))),console.log(g.map((function(t){return new Date(t)})));var p,h,m,y,f,D,v,w,V,b,M,k,C,x,Y,P,H=modelsParameters[a].AllYearsVisible?"full":"single",W=t=>"SMTWTFS"[t],A="%b";d3.interpolateRdYlGn;f=s[s.length-1].date.getFullYear(),y=s[0].date.getFullYear(),D=f;let S=0,F=0;function E(){"single"===H?(p=s.filter(t=>D==t.date.getFullYear()).map(t=>t.date),h=s.filter(t=>D==t.date.getFullYear()).map(t=>t.value)):(p=s.map(t=>t.date),h=s.map(t=>t.value)),m=d3.range(p.length),Y=d3.groups(m,t=>p[t].getFullYear()).reverse(),v=t=>(t+6)%7,w=d3.timeMonday;let t=d/(((V=7)+2)*Y.length),e=(l-40)/53;P=Math.min(t,e),S=(l-(40+53*P))/2,(S<0||"single"===H)&&(S=0),F=(d-(b=P*(V+2))*Y.length)/2,(F<0||"single"===H)&&(F=0),M=d3.quantile(h,.9975),k=d3.scaleSequential([0,M],["#d5f4c7","red"]).unknown("none"),A=d3.timeFormat(A),C=d3.timeFormat("%B %-d, %Y"),x=k.tickFormat(100,"+%"),title=t=>`${C(p[t])}\n${x(h[t])}`}function T(t){const e=Math.max(0,Math.min(V,v(t.getDay()))),a=w.count(d3.timeYear(t),t);return`${0===e?`M${a*P},0`:e===V?`M${(a+1)*P},0`:`M${(a+1)*P},0V${e*P}H${a*P}`}V${V*P}`}E(),d3.selection.prototype.conditionalDraw=function(){var t=22*P+40,e=b*Y.length/2;return"single"===H?this.attr("x",t).attr("y",e).style("opacity",0).transition().duration(500):this};const L=d3.select(n).append("svg").attr("width",l).attr("height",b*Y.length+40).attr("viewBox",[0,0,l,b*Y.length+40]).attr("style","max-width: 100%; height: auto; height: intrinsic;").attr("font-family","sans-serif").attr("font-size",P);var R=d3.select("body").append("div").attr("class","tooltip").style("position","absolute").style("pointer-events","none").style("background","#fff").style("color","#000").style("border","2px solid #000").style("opacity",0);if("single"===H){var U=L.append("path").attr("d","M 1 1 L 12 10 L 1 19 L 1 1").style("fill-rule","evenodd").attr("transform","translate("+(28*P+40)+", "+b*Y.length+") ").attr("stroke-width","0.0").attr("stroke","black").attr("fill","#888888");U.on("click",(function(){j(1)}));var I=L.append("path").attr("d","M 12 1 L 1 10 L 12 19 L 12 1").style("fill-rule","evenodd").attr("transform","translate("+(22*P+40)+", "+b*Y.length+") ").attr("stroke-width","0.0").attr("stroke","black").attr("fill","#888888");I.on("click",(function(){j(-1)})),U.attr("opacity",.2)}async function j(t){var e=22*P+40,a=b*Y.length/2,n=D+t;n>f||n<y||(D=n,await L.selectAll(".year").selectAll("*").transition().duration(500).attr("x",e).attr("y",a).style("opacity",0).end(),L.selectAll(".year").remove(),n==y?(I.attr("opacity",.2),U.attr("opacity",1)):n==f?(I.attr("opacity",1),U.attr("opacity",.2)):(I.attr("opacity",1),U.attr("opacity",1)),E(),B())}B();o=d3.timeFormat("%Y-%m-%d");function B(){let t=L.selectAll("g").data(Y).join("g");t.attr("class","year").attr("transform",(t,e)=>"translate("+(40+S)+`,${b*e+1.5*P+F})`),t.append("text").conditionalDraw().attr("x",-5).attr("y",-5).attr("font-weight","bold").attr("text-anchor","end").text(([t])=>t).style("opacity",1),t.append("g").attr("text-anchor","end").selectAll("text").data(d3.range(7)).join("text").conditionalDraw().attr("x",-5).attr("y",t=>(v(t)+.5)*P).attr("dy","0.31em").text(W).style("opacity",1);t.append("g").selectAll("rect").data(([,t])=>t).join("rect").attr("width",P-1).attr("height",P-1).attr("fill",(function(t,e){return _.isUndefined(h[t])?modelsParameters[a].UndefinedValueColor:k(h[t])})).on("mouseover",(function(t,e){_.isUndefined(h[e])||(d3.select(this).attr("height",P-2).attr("width",P-2).attr("transform","translate(1,1)").style("stroke","black").style("stroke-width",1).style("stroke-opacity",1),R.style("opacity",1).html("<center>"+o(p[e])+"</center>Value : "+h[e]).style("left",t.pageX+10+"px").style("top",t.pageY+10+"px"))})).on("mouseout",(function(t,e){_.isUndefined(h[e])||(d3.select(this).style("stroke","black").style("stroke-width",0).style("stroke-opacity",0).attr("transform","translate(0,0)").attr("width",P-1).attr("height",P-1),R.style("opacity",0))})).on("click",(function(t,e){modelsHiddenParams[a].SelectedDate=o(p[e]),r.updateValue(),console.log(o(p[e]))})).conditionalDraw().style("opacity",1).attr("x",t=>w.count(d3.timeYear(p[t]),p[t])*P+.5).attr("y",t=>v(p[t].getDay())*P+.5);const e=t.append("g").selectAll("g").data(([,t])=>d3.timeMonths(d3.timeMonth(p[t[0]]),p[t[t.length-1]])).join("g");e.filter((t,e)=>e).append("path").attr("fill","none").attr("stroke","#fff").attr("stroke-width",2).attr("d",T),e.append("text").text(A).conditionalDraw().style("opacity",1).attr("x",t=>w.count(d3.timeYear(t),w.ceil(t))*P+3).attr("y",-5).style("opacity",1)}function T(t){const e=Math.max(0,Math.min(V,v(t.getDay()))),a=w.count(d3.timeYear(t),t);return`${0===e?`M${a*P},0`:e===V?`M${(a+1)*P},0`:`M${(a+1)*P},0V${e*P}H${a*P}`}V${V*P}`}};const i={$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:calendarD3Widget_input",type:"array",items:{type:"object",properties:{date:{type:"string"},value:{type:"number"}}}},l=new WidgetActuatorDescription("CalendarValues","Calendar Values Array[{date : YYYY-MM-DD, value : number}]",WidgetActuatorDescription.READ,i),d={$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:calendarD3Widget_dateSelected",type:"string"},o=new WidgetActuatorDescription("SelectedDate","Selected date as YYYY-MM-DD",WidgetActuatorDescription.WRITE,d);this.getActuatorDescriptions=function(){return[l,o]},this.CalendarValues={updateCallback:function(){},setValue:function(t){modelsHiddenParams[a].CalendarValues=t,r.render()},getValue:function(){return modelsHiddenParams[a].timeValue},addValueChangedHandler:function(t){this.updateCallback=t,r.enable()},removeValueChangedHandler:function(t){r.disable()}},this.SelectedDate={updateCallback:function(){},setValue:function(t){modelsHiddenParams[a].SelectedDate=t},getValue:function(){return modelsHiddenParams[a].SelectedDate},addValueChangedHandler:function(t){this.updateCallback=t},removeValueChangedHandler:function(t){}},r.render()},this.calendarD3Widget.prototype=baseWidget.prototype,this.pluginDefinition={name:"calendarD3",widgetsDefinitionList:{calendarD3:{factory:"calendarD3Widget",title:"Year Calenddar",icn:"year-calendar",help:"wdg/wdg-geo-time/#simple-clock"}}},this.constructor()}modelsHiddenParams.calendarD3={CalendarValues:[],SelectedDate:""},modelsParameters.calendarD3={AllYearsVisible:!0,UndefinedValueColor:"#F6F6F6"},modelsLayout.calendarD3={height:"5vh",width:"19vw",minWidth:"100px",minHeight:"100px"},calendarD3WidgetPluginClass.prototype=basePlugin.prototype;var calendarD3Plugin=new calendarD3WidgetPluginClass;widgetsPluginsHandler.loadWidgetPlugin(calendarD3Plugin);
function flatUiComplexWidgetsPluginClass(){this.selectFlatUiWidget=function(e,t,l,a){this.constructor(e,t,l,a);const i=this;this.bFirstExec=!0,this.tmpSelectedValue="",this.enable=function(){$("#select"+t).off("click").on("click",(function(e,t){modelsHiddenParams[l].selectedValue=i.selectedValue.getValue(),i.selectedValue.updateCallback(i.selectedValue,i.selectedValue.getValue())})),$("#select"+t).prop("disabled",!1),document.styleSheets[0].addRule("#s2id_select"+t+" > .select2-choice > .select2-chosen",this.selectedValueColor()),document.styleSheets[0].addRule("#s2id_select"+t+" > .select2-choice",this.selectedItemDefaultColor()),document.styleSheets[0].addRule("#s2id_select"+t+" > .select2-choice:hover",this.selectedItemHoverColor())},this.disable=function(){$("#select"+t).prop("disabled",!0)},this.rescale=function(){this.render()},this.render=function(){const a=document.createElement("div");a.setAttribute("id","select-widget-html"+t),a.setAttribute("class","select-widget-html");let s=Math.min($("#"+e).height(),$("#"+e).width()/2),o="";if(""!=modelsParameters[l].label&&modelsParameters[l].displayLabel){const a=this.getTransformedText("label");if(s=Math.min($("#"+e).height(),$("#"+e).width()/4),_.isUndefined(modelsParameters[l].selectWidthProportion))o='<span id="select-span'+t+'" class="select-span" style="max-width: 45%; '+this.labelFontSize()+this.labelColor()+this.labelFontFamily()+'">'+a+"</span>";else{const e=Math.max(0,100-parseFloat(modelsParameters[l].selectWidthProportion))+"%";o='<span id="select-span'+t+'" class="select-span" style="width:'+e+"; "+this.labelFontSize()+this.labelColor()+this.labelFontFamily()+'">'+a+"</span>"}}_.isUndefined(modelsParameters[l].selectValueFontSize)&&(modelsParameters[l].selectValueFontSize=modelsParameters[l].labelFontSize);let r=[];if(_.isUndefined(modelsParameters[l].isKeyValuePairs)&&(modelsParameters[l].isKeyValuePairs=!0),!_.isUndefined(modelsHiddenParams[l].value))if(0!=modelsHiddenParams[l].value.length)r=modelsHiddenParams[l].value;else if(0!=modelsHiddenParams[l].values.length){for(let e=0;e<modelsHiddenParams[l].values.length;e++)r[e]={},r[e].value=modelsHiddenParams[l].values[e];for(let e=0;e<modelsHiddenParams[l].keys.length;e++)r[e].key=modelsHiddenParams[l].keys[e]}o=o+'<select data-toggle="select" id="select'+t+'" class="select-div form-control select select-primary select-block mbl" style="height: '+s+'px;">';for(let e=0;e<r.length;e++)o=o+'<option value="'+r[e].value+'">'+r[e].key+"</option>";o+="</select>",a.innerHTML=o,a.setAttribute("id","select-div-container"+t),a.setAttribute("style","height: "+s+"px; "+this.selectFontSize()),$("#"+e).html(a),this.bIsInteractive?i.enable():i.disable(),""!=modelsHiddenParams[l].selectedValue&&($("#select"+t)[0].value=modelsHiddenParams[l].selectedValue),this.findInSelect(this.tmpSelectedValue)&&($("#select"+t)[0].value=this.tmpSelectedValue),$("#select"+t).select2(),i.bFirstExec=!1},this.findInSelect=function(e){let t={};return _.isUndefined(i.values)?_.isUndefined(i.keyValuePairs)||(t=i.keyValuePairs):t=i.values,bFind=_.find(t.selectionValues,(function(t){return t==e})),bFind};const s=new WidgetActuatorDescription("selectedValue","Selected value",WidgetActuatorDescription.READ_WRITE,WidgetPrototypesManager.SCHEMA_NUMBER),o=new WidgetActuatorDescription("selectedValue","Selected value",WidgetActuatorDescription.READ_WRITE,WidgetPrototypesManager.SCHEMA_STRING),r=new WidgetActuatorDescription("selectedValue","Selected value",WidgetActuatorDescription.READ_WRITE,WidgetPrototypesManager.SCHEMA_NUMBER_OR_STRING),n=new WidgetActuatorDescription("keys","Labels of the selectable options",WidgetActuatorDescription.READ,WidgetPrototypesManager.SCHEMA_STRING_ARRAY),d=new WidgetActuatorDescription("values","Selectable values. Must match 'keys'.",WidgetActuatorDescription.READ,WidgetPrototypesManager.SCHEMA_STRING_ARRAY),c=new WidgetActuatorDescription("values","Selectable values. Must match 'keys'.",WidgetActuatorDescription.READ,WidgetPrototypesManager.SCHEMA_NUMBER_ARRAY),u=new WidgetActuatorDescription("keyValuePairs","Array of selectable key-value objects; Key being the displayed label",WidgetActuatorDescription.READ,{$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:selectFlatUiWidget_keyValuePairs_isNumber",type:"array",items:{type:"object",properties:{key:{type:["string","number","boolean"]},value:{type:"number"}},required:["key"]}}),h=new WidgetActuatorDescription("keyValuePairs","Array of selectable key-value objects; Key being the displayed label",WidgetActuatorDescription.READ,{$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:selectFlatUiWidget_keyValuePairs",type:"array",items:{type:"object",properties:{key:{type:["string","number","boolean"]},value:{type:"string"}},required:["key"]}});this.getActuatorDescriptions=function(e=null){const t=e||modelsParameters[l],a=[];t&&t.isKeyValuePairs?a.push(t.isNumber?u:h):(a.push(n),a.push(t&&t.isNumber?c:d));let i=r;return t&&(i=t.isNumber?s:o),a.push(i),a},this.selectedValue={updateCallback:function(){},setValue:function(e){i.tmpSelectedValue=e;i.findInSelect(e)&&($("#select"+t)[0].value=e,modelsHiddenParams[l].selectedValue=e,i.render())},getValue:function(){return modelsParameters[l].isNumber?Number($("#select"+t)[0].value):$("#select"+t)[0].value},addValueChangedHandler:function(e){this.updateCallback=e,""!=$("#select"+t)[0].value&&e(this,$("#select"+t)[0].value),i.enable()},removeValueChangedHandler:function(e){i.disable()},setCaption:function(e,a){modelsParameters[l].inheritLabelFromData&&(i.captionHelper(e,i.bIsInteractive,a),$("#select-span"+t).text(modelsParameters[l].label))},clearCaption:function(){modelsParameters[l].label="",i.render()}},i.render(),modelsParameters[l].isKeyValuePairs?this.keyValuePairs={selectionValues:[],setValue:function(e){if(""==e)selectionValues=[],modelsHiddenParams[l].value=e,i.render();else{const t='"keyValuePairs" must be an array of key or an array of key/value pairs (in widget'+l+")",a='Example1: [{"key":"choice1"}, {"key":"choice2"}] \n or Example2: [{"key":"choice1", "value":"1"}, {"key":"choice2", "value":"2"}]';if(!Array.isArray(e))return void swal(t,a,"info");for(let l=0;l<e.length;l++){if(_.isUndefined(e[l].key))return void swal(t,a,"info");_.isUndefined(e[l].value)&&(e[l].value=e[l].key),this.selectionValues[l]=e[l].value}modelsHiddenParams[l].value=e,i.render()}},getValue:function(){return modelsHiddenParams[l].value},addValueChangedHandler:function(e){i.enable()},removeValueChangedHandler:function(e){i.disable()}}:(this.keys={selectionValues:[],setValue:function(e){if(""===e)selectionValues=[],modelsHiddenParams[l].value=e,i.render();else{const t='"keys" must be an array (in widget'+l+")",a='Example: ["choice1","choice2"]';if(!Array.isArray(e))return void swal(t,a,"info");if("object"==typeof e[0])return void swal(t,a,"info");for(let t=0;t<e.length;t++)this.selectionValues[t]=e[t];modelsHiddenParams[l].value=[],modelsHiddenParams[l].keys=e,i.render()}},getValue:function(){return modelsHiddenParams[l].value},addValueChangedHandler:function(e){i.enable()},removeValueChangedHandler:function(e){i.disable()}},this.values={selectionValues:[],setValue:function(e){if(""===e)selectionValues=[],modelsHiddenParams[l].value=e,i.render();else{const t='"value" must be an array (in widget'+l+")",a="Example: [1, 2]";if(_.isNull(e)&&(e=modelsHiddenParams[l].keys),!Array.isArray(e))return void swal(t,a,"info");if("object"==typeof e[0])return void swal(t,a,"info");for(let t=0;t<e.length;t++)this.selectionValues[t]=e[t];modelsHiddenParams[l].value=[],modelsHiddenParams[l].values=e,i.render()}},getValue:function(){return modelsHiddenParams[l].value},addValueChangedHandler:function(e){i.enable()},removeValueChangedHandler:function(e){i.disable()}})},this.selectFlatUiWidget.prototype=baseWidget.prototype,this.multiSelectFlatUiWidget=function(e,t,l,a){this.constructor(e,t,l,a);const i=this;this.enable=function(){$("#multi-select"+t).on("click",(function(e){i.selectedValue.updateCallback(i.selectedValue,i.selectedValue.getValue())})),$("#multi-select"+t)[0].style.opacity="1"},this.disable=function(){$("#multi-select"+t)[0].style.opacity="0.7"},this.rescale=function(){this.render()},this.hasScrollBar=function(e){return e.get(0).scrollHeight>e.get(0).clientHeight},this.render=function(){const a=document.createElement("div"),s=$("#"+e).height();a.setAttribute("style","width: inherit; height: "+s+"px; cursor: inherit;");let o='<div class="multi-select-div" id="multi-select'+t+'" style="height: '+s+"px; "+this.valueDefaultColor()+this.border()+'">';const r=modelsHiddenParams[l].value;let n="";if(n=this.bIsInteractive?"cursor: pointer; ":"cursor: inherit; ",_.isUndefined(modelsParameters[l].valueFontSize)&&(modelsParameters[l].valueFontSize=.4),Array.isArray(r))for(let e=0;e<r.length;e++)o+="<label >",o=o+'<input type="checkbox" value="'+r[e]+'" />',o=o+'<span id="multi-select-label'+t+'" style="'+n+this.valueFontFamily()+this.valueFontSize()+this.checkboxWidth()+this.checkboxHeight()+'" tabindex="-1">'+r[e]+"</span>",o+="</label>";o+="</div>",a.innerHTML=o,$("#"+e).html(a);i.hasScrollBar($("#multi-select"+t))||$("#multi-select"+t+".multi-select-div").css("align-content","center");const d=window.mobileAndTabletCheck();("ontouchstart"in document.documentElement||d)&&($("#multi-select"+t)[0].style.height="auto"),modelsParameters[l].resetPastSelection||_.isEmpty(modelsHiddenParams[l].selectedValue)||$("#multi-select"+t+" > label > input[type='checkbox']").each((function(){for(let e=0;e<modelsHiddenParams[l].selectedValue.length;e++)$(this).val()==modelsHiddenParams[l].selectedValue[e]&&$(this).attr("checked",!0)})),document.styleSheets[0].addRule("#multi-select-label"+t,this.valueDefaultColor()),document.styleSheets[0].addRule("#multi-select-label"+t,this.checkboxDefaultColor()),document.styleSheets[0].addRule("#multi-select-label"+t,this.checkboxBorder()),document.styleSheets[0].addRule("#multi-select-label"+t+":hover",this.valueHoverColor()),document.styleSheets[0].addRule("#multi-select-label"+t+":hover",this.checkboxHoverColor()),document.styleSheets[0].addRule("#multi-select-label"+t+":hover",this.checkboxHoverBorderColor()),document.styleSheets[0].addRule('input[type="checkbox"]:checked + #multi-select-label'+t,this.valueFocusColor()),document.styleSheets[0].addRule('input[type="checkbox"]:checked + #multi-select-label'+t,this.checkboxFocusColor()),document.styleSheets[0].addRule('input[type="checkbox"]:checked + #multi-select-label'+t,this.checkboxFocusBorderColor()),this.bIsInteractive?i.enable():i.disable()};const s=new WidgetActuatorDescription("value","Available choices",WidgetActuatorDescription.READ,WidgetPrototypesManager.SCHEMA_PRIMITIVE_ARRAY),o=new WidgetActuatorDescription("selectedValue","Currently selected choices",WidgetActuatorDescription.READ_WRITE,WidgetPrototypesManager.SCHEMA_STRING_ARRAY);this.getActuatorDescriptions=function(){return[s,o]},this.value={updateCallback:function(){},setValue:function(e){modelsHiddenParams[l].value=e,i.render(),i.selectedValue.updateCallback(i.selectedValue,i.selectedValue.getValue())},getValue:function(){return modelsParameters[l].isNumber?Number(modelsHiddenParams[l].value):modelsHiddenParams[l].value},addValueChangedHandler:function(e){this.updateCallback=e},removeValueChangedHandler:function(e){},setCaption:function(e,t){},clearCaption:function(){}},this.selectedValue={updateCallback:function(){},setValue:function(e){$("#multi-select"+t+" > label > input[type='checkbox']").each((function(){for(let t=0;t<e.length;t++)$(this).val()===e[t]&&$(this).attr("checked",!0)})),modelsHiddenParams[l].selectedValue=e},getValue:function(){const e=[];return $("#multi-select"+t+" > label > input[type='checkbox']:checked").each((function(){modelsParameters[l].isNumber?e.push(Number($(this).val())):e.push($(this).val())})),e},addValueChangedHandler:function(e){this.updateCallback=e},removeValueChangedHandler:function(e){},setCaption:function(e,t){},clearCaption:function(){}},i.render()},this.multiSelectFlatUiWidget.prototype=baseWidget.prototype,this.listFlatUiWidget=function(e,t,l,a){this.constructor(e,t,l,a);const i=this;this.enable=function(){let e=!1,l=!1;$("#list"+t).on("keyup",(function(e){l&&(65!=e.keyCode&&97!=e.keyCode&&17!=e.keyCode||(i.selectedValue.updateCallback(i.selectedValue,i.selectedValue.getValue()),l=!1))})),$("#list"+t).on("click keyup",(function(a){l=!1,a.ctrlKey?e||(e=!0,$("#list"+t).one("keyup",(function(t){i.selectedValue.updateCallback(i.selectedValue,i.selectedValue.getValue()),e=!1,l=!0}))):(i.selectedValue.updateCallback(i.selectedValue,i.selectedValue.getValue()),e||(e=!0,$("#list"+t).one("keyup",(function(t){65!=t.keyCode&&97!=t.keyCode&&17!=t.keyCode||(i.selectedValue.updateCallback(i.selectedValue,i.selectedValue.getValue()),e=!1,l=!0)}))))})),$("#list"+t)[0].style.opacity="1"},this.disable=function(){$("#list"+t)[0].style.opacity="0.7"},this.rescale=function(){this.render()},this.render=function(){const a=document.createElement("div");valueHeightPx=$("#"+e).height(),a.setAttribute("style","width: inherit; height: "+valueHeightPx+"px; cursor: inherit;");const s=this.border();let o='<select class="form-control" id="list'+t+'" multiple size="10" style="width: 100%; height: '+valueHeightPx+"px;/*background-color: rgba(255, 255, 255, 0)*/; border-radius: 6px; color: "+modelsParameters[l].listValueColor+"; "+s+"; "+this.valueFontFamily()+"box-sizing: border-box; font-size: calc(7px + "+modelsParameters[l].listValueFontSize*getFontFactor()+'vw + 0.4vh); cursor: inherit; max-width : 2000px">';const r=modelsHiddenParams[l].value;let n="";if(n=this.bIsInteractive?"cursor: pointer; ":"cursor: inherit; ",Array.isArray(r))for(let e=0;e<r.length;e++)o=o+'<option style="'+n+'">'+r[e]+"</option>";o+="</select>",a.innerHTML=o,$("#"+e).html(a);const d=window.mobileAndTabletCheck();("ontouchstart"in document.documentElement||d)&&($("#list"+t)[0].style.height="auto"),_.isEmpty(modelsHiddenParams[l].selectedValue)||$("#list"+t).val(modelsHiddenParams[l].selectedValue),document.styleSheets[0].addRule("#list"+t+" option",modelsParameters[l].listValueColor),document.styleSheets[0].addRule("#list"+t+" option",this.listBackgroundColor()),document.styleSheets[0].addRule("#list"+t+" option:checked",this.selectValueColor()),document.styleSheets[0].addRule("#list"+t+" option:checked",this.selectValueBackgroundColor()),this.bIsInteractive?i.enable():i.disable()};const s=new WidgetActuatorDescription("value","Available choices",WidgetActuatorDescription.READ,WidgetPrototypesManager.SCHEMA_PRIMITIVE_ARRAY),o=new WidgetActuatorDescription("selectedValue","Currently selected choices",WidgetActuatorDescription.READ_WRITE,{$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:listFlatUiWidget_selectedValue",anyOf:[{type:"string"},{type:"array",items:{type:"string"}}]});this.getActuatorDescriptions=function(){return[s,o]},this.value={updateCallback:function(){},setValue:function(e){modelsHiddenParams[l].value=e,i.render(),i.selectedValue.updateCallback(i.selectedValue,i.selectedValue.getValue())},getValue:function(){return modelsHiddenParams[l].value},addValueChangedHandler:function(e){this.updateCallback=e},removeValueChangedHandler:function(e){},setCaption:function(e,t){},clearCaption:function(){}},this.selectedValue={updateCallback:function(){},setValue:function(e){$("#list"+t).val(e),modelsHiddenParams[l].selectedValue=e},getValue:function(){const e=document.getElementById("list"+t),a=$("#list"+t).val(),i=e.selectedOptions;let s=0;if(Array.isArray(modelsHiddenParams[l].value)&&(s=modelsHiddenParams[l].value.length),0===i.length)return"";for(let e=0;e<i.length;e++)if(i[e].index<0||i[e].index>=s)return"";return a},addValueChangedHandler:function(e){this.updateCallback=e},removeValueChangedHandler:function(e){},setCaption:function(e,t){},clearCaption:function(){}},i.render()},this.listFlatUiWidget.prototype=baseWidget.prototype,this.tableFlatUiWidget=function(e,t,l,a){this.constructor(e,t,l,a);var i=this;this.enable=function(){$("#table"+t).editableTableWidget(),$("#table"+t+" td").on("change",(function(e,t){var a=$(this),s=a.parent(),o=a.index(),r=s.index(),n=.5;_.isUndefined(modelsParameters[l].tableValueFontSize)||(n=modelsParameters[l].tableValueFontSize),modelsParameters[l].headerLine&&(r+=1),_.isNaN(Number(t))||(t=Number(t)),modelsHiddenParams[l].value[r][o]=t,a.html('<span style="'+i.valueColor()+i.valueFontFamily()+" font-size: calc(7px + "+n*getFontFactor()+'vw)">'+t+"<span>"),i.value.updateCallback(i.value,i.value.getValue())}))},this.disable=function(){$("#table"+t+" td").on("change",(function(e,t){}))},this.buildTable=function(e){var t,a="",i=0,s=.5;_.isUndefined(modelsParameters[l].tableValueFontSize)||(s=modelsParameters[l].tableValueFontSize);var o=Array.isArray(e);if(o){var r=e[0];if(o=Array.isArray(r)){if(modelsParameters[l].headerLine){i=1,a+="<thead><tr>";for(var n=0;n<e[0].length;n++)a=a+'<th style="'+this.valueAlign()+'"><span style="'+this.valueColor()+this.valueFontFamily()+" font-size: calc(7px + "+s*getFontFactor()+'vw);"><b>'+e[0][n]+"</b></span></th>";a+="</tr></thead>"}a+="<tbody>";for(var d=i;d<e.length;d++){modelsParameters[l].striped?d%2!=0&&(a+='<tr style="'+this.tableBackgroundColor("secondary")+'">'):a+="<tr>";for(n=0;n<e[d].length;n++){var c=[];try{c=JSON.parse(modelsParameters[l].editableCols)}catch(e){}var u="";-1==_.indexOf(c,n)?t="false":(t="true",this.bIsInteractive&&(u="cursor: cell;")),a=a+'<td style="'+u+this.valueAlign()+'" data-editable="'+t+'"><span style="'+this.valueColor()+this.valueFontFamily()+" font-size: calc(7px + "+s*getFontFactor()+'vw)">'+e[d][n]+"</span></td>"}a+="</tr>"}a+="</tbody>"}else{a+="<tbody><tr>";for(d=i;d<e.length;d++)r=e[d],a=a+'<td style="'+this.valueAlign()+'"><span style="'+this.valueColor()+this.valueFontFamily()+" font-size: calc(7px + "+s*getFontFactor()+'vw)">'+r+"</span></td>";a+="</tr></tbody>"}}return a},this.rescale=function(){this.render()},this.render=function(){const a=document.createElement("div"),s="display: flex; align-items: center; cursor: "+(this.bIsInteractive?"auto":"inherit")+"; width: inherit; height: inherit; overflow: auto";a.setAttribute("style",s);let o='<table style="margin: 0; height: 90%; '+this.tableBackgroundColor("primary")+'" class="table';modelsParameters[l].bordered&&(o+=" table-bordered "),_.isUndefined(modelsParameters[l].noBorder)?modelsParameters[l].noBorder=!1:modelsParameters[l].noBorder&&(o+=" no-border "),o+=' table-responsive" id="table'+t+'" >';const r=modelsHiddenParams[l].value;let n=i.buildTable(r);""==n&&(n="<tbody><tr><td/><td/><td/></tr><tr><td/><td/><td/></tr></tbody>"),o+=n+"</table>",a.innerHTML=o,$("#"+e).html(a),this.bIsInteractive?i.enable():i.disable()};const s={$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:tableFlatUiWidget",anyOf:[{type:"array",items:{anyOf:[{type:"string"},{type:"number"},{type:"boolean"}]}},{type:"array",items:{type:"array",items:{anyOf:[{type:"string"},{type:"number"},{type:"boolean"}]}}}]},o=new WidgetActuatorDescription("value","Table content as an array or array of arrays",WidgetActuatorDescription.READ,s),r=new WidgetActuatorDescription("value","Table content as an array or array of arrays",WidgetActuatorDescription.READ_WRITE,s);this.getActuatorDescriptions=function(e=null){params=e||modelsParameters[l];let t=[];try{t=JSON.parse(params.editableCols)}catch(e){}return Array.isArray(t)&&t.length?[r]:[o]},this.value={updateCallback:function(){},setValue:function(e){modelsHiddenParams[l].value=e,i.render()},getValue:function(){return modelsHiddenParams[l].value},addValueChangedHandler:function(e){this.updateCallback=e},removeValueChangedHandler:function(e){},setCaption:function(e,t){},clearCaption:function(){}},i.render()},this.tableFlatUiWidget.prototype=baseWidget.prototype,this.pluginDefinition={name:"flatUi",widgetsDefinitionList:{flatUiSelect:{factory:"selectFlatUiWidget",title:"Select",icn:"select",help:"wdg/wdg-basics/#select"},flatUiMultiSelect:{factory:"multiSelectFlatUiWidget",title:"Multi-select",icn:"multi-select",help:"wdg/wdg-basics/#multi-select"},flatUiList:{factory:"listFlatUiWidget",title:"List",icn:"list",help:"wdg/wdg-basics/#list"},flatUiTable:{factory:"tableFlatUiWidget",title:"Table",icn:"board",help:"wdg/wdg-basics/#table"}}},this.constructor()}modelsHiddenParams.flatUiSelect={values:[],keys:[],value:[],selectedValue:""},modelsHiddenParams.flatUiMultiSelect={value:[],selectedValue:""},modelsHiddenParams.flatUiList={value:[],selectedValue:""},modelsHiddenParams.flatUiTable={value:null},modelsParameters.flatUiSelect={label:"labelText",inheritLabelFromData:!0,displayLabel:!0,labelFontSize:.5,labelColor:"var(--widget-label-color)",labelFontFamily:"var(--widget-font-family)",selectWidthProportion:"70%",isNumber:!1,selectValueFontSize:.5,selectedValueColor:"var(--widget-select-option-highlighted-text)",selectedItemDefaultColor:"var(--widget-select-option-highlighted-color)",selectedItemHoverColor:"var(--widget-select-option-highlighted-color)",isKeyValuePairs:!1},modelsParameters.flatUiMultiSelect={addControls:!1,resetPastSelection:!1,valueFontSize:.4,valueFontFamily:"var(--widget-font-family)",checkboxWidth:7,checkboxHeight:1.5,valueDefaultColor:"var(--widget-label-color)",checkboxDefaultColor:"var(--widget-multiselect-color)",checkboxBorderColor:"var(--widget-multiselect-border-color)",valueHoverColor:"var(--widget-multiselect-hover-text)",checkboxHoverColor:"var(--widget-multiselect-hover-color)",checkboxHoverBorderColor:"var(--widget-multiselect-hover-border-color)",valueFocusColor:"var(--widget-multiselect-checked-text)",checkboxFocusColor:"var(--widget-multiselect-checked-color)",checkboxFocusBorderColor:"var(--widget-multiselect-checked-border-color)",displayBorder:!0,borderColor:"var(--widget-border-color)",isNumber:!1},modelsParameters.flatUiList={addControls:!1,listValueFontSize:.5,listValueColor:"var(--widget-select-drop-text)",listBackgroundColor:"var(--widget-select-drop-color)",selectValueColor:"var(--widget-select-option-highlighted-text)",selectValueBackgroundColor:"var(--widget-select-option-highlighted-color)",valueFontFamily:"var(--widget-font-family)",borderColor:"var(--widget-border-color)",displayBorder:!0},modelsParameters.flatUiTable={headerLine:!1,tableValueFontSize:.5,striped:!0,valueColor:"var(--widget-table-value-color)",valueFontFamily:"var(--widget-font-family)",valueAlign:"left",bordered:!0,noBorder:!1,editableCols:"[]",backgroundColor:{primary:"var(--widget-color-0)",secondary:"var(--widget-table-striped-odd)"}},modelsLayout.flatUiSelect={height:"5vh",width:"19vw",minWidth:"40px",minHeight:"10px"},modelsLayout.flatUiMultiSelect={height:"16vh",width:"11vw",minWidth:"80px",minHeight:"75px"},modelsLayout.flatUiList={height:"16vh",width:"11vw",minWidth:"80px",minHeight:"75px"},modelsLayout.flatUiTable={height:"10vh",width:"11vw",minWidth:"88px",minHeight:"79px"},flatUiComplexWidgetsPluginClass.prototype=basePlugin.prototype;var flatUiComplexWidgetsPlugin=new flatUiComplexWidgetsPluginClass;widgetsPluginsHandler.loadWidgetPlugin(flatUiComplexWidgetsPlugin);
function flatUiBooleanWidgetsPluginClass(){this.checkboxFlatUiWidget=function(e,t,i,a){this.constructor(e,t,i,a);var l=this;this.enable=function(){$("#checkbox"+t).off("click").on("click",(function(e,t){l.value.updateCallback(l.value,l.value.getValue())})),$("#checkbox"+t).radiocheck("enable")},this.disable=function(){$("#checkbox"+t).unbind("click"),$("#checkbox"+t).radiocheck("disable")},this.rescale=function(){this.render()},this.render=function(){var a=20,s=20;_.isNull($(".icons").height())||(a=$(".icons").height()),_.isNull($(".icons").width())||(s=$(".icons").width()),_.isUndefined(modelsParameters[i].checkboxSize)&&(modelsParameters[i].checkboxSize=1);var o=modelsParameters[i].checkboxSize*s+12,c=modelsParameters[i].checkboxSize*a,d="",n=document.createElement("div");$("#"+e).height();if(""!=modelsParameters[i].label&&modelsParameters[i].displayLabel){const e=this.getTransformedText("label");d='<label class="checkbox" id="label'+t+'" style="cursor: inherit; display: flex; align-items: center; margin:auto; '+this.labelFontSize()+this.labelColor()+this.labelFontFamily()+"; padding-left: "+o+"px; line-height:"+c+'px; " for="checkbox'+t+'"><input type="checkbox" class="nohover" data-toggle="radio" style="zoom:'+modelsParameters[i].checkboxSize+'" value="" id="checkbox'+t+'" disabled></input>'+e+"</label>"}else d='<label class="checkbox" id="label'+t+'" style="cursor: inherit; display: flex; align-items: center; margin: auto;" for="checkbox'+t+'"><input type="checkbox" class="nohover" data-toggle="radio" style="zoom:'+modelsParameters[i].checkboxSize+' value="" id="checkbox'+t+'" disabled></input></label>';n.innerHTML=d,$("#"+e).html(n);modelsParameters[i].checkboxSize;n.setAttribute("style","width: inherit; cursor: inherit; display: flex; justify-content: center; align-items: center;"),$('[data-toggle="checkbox"]').radiocheck(),$('[data-toggle="radio"]').radiocheck(),1==modelsHiddenParams[i].value?$("#checkbox"+t).radiocheck("check"):0==modelsHiddenParams[i].value&&$("#checkbox"+t).radiocheck("uncheck"),document.styleSheets[0].addRule("#label"+t+" .icons *","zoom: "+modelsParameters[i].checkboxSize),document.styleSheets[0].addRule("#label"+t+" .icons .icon-checked",this.checkedColor()),document.styleSheets[0].addRule("#label"+t+" .icons .icon-unchecked",this.uncheckedColor()),this.bIsInteractive?l.enable():l.disable()};const s=new WidgetActuatorDescription("value","Current value",WidgetActuatorDescription.READ_WRITE,WidgetPrototypesManager.SCHEMA_BOOLEAN);this.getActuatorDescriptions=function(){return[s]},this.value={updateCallback:function(){},setValue:function(e){modelsHiddenParams[i].value=e,$("#checkbox"+t)[0].checked=e},getValue:function(){return $("#checkbox"+t)[0].checked},addValueChangedHandler:function(e){this.updateCallback=e,l.enable()},removeValueChangedHandler:function(e){l.disable()},setCaption:function(e,t){modelsParameters[i].inheritLabelFromData&&(l.captionHelper(e,l.bIsInteractive,t),l.render())},clearCaption:function(){modelsParameters[i].label="",l.render()}},l.render()},this.checkboxFlatUiWidget.prototype=baseWidget.prototype,this.switchFlatUiWidget=function(e,t,i,a){this.constructor(e,t,i,a);var l=this;this.enable=function(i){$("#switch"+t).on("click",(function(i,a){if(l.value.updateCallback(l.value,l.value.getValue()),$("#switch"+t)[0].checked){var s=$("#switch-label"+t).height(),o=$("#"+e).width(),c=Math.min(o,s)-8,d=$("#slide"+t).width()-c-8;document.styleSheets[0].addRule("#slide"+t+":before","transform: translateX("+d+"px);")}else document.styleSheets[0].addRule("#slide"+t+":before","transform: translateX(0px);")})),$("#switch"+t).prop("disabled",!1)},this.disable=function(){$("#switch"+t).unbind("click"),$("#switch"+t).prop("disabled",!0)},this.updateSwitchStatus=function(){if(1==modelsHiddenParams[i].value){if(!$("#switch"+t)[0].checked){$("#switch"+t).prop("checked",!0);var a=$("#switch-label"+t).height(),l=$("#"+e).width(),s=Math.min(l,a)-8,o=$("#slide"+t).width()-s-8;document.styleSheets[0].addRule("#slide"+t+":before","transform: translateX("+o+"px);"),document.styleSheets[0].addRule("input:checked + #slide"+t,this.switchOnColor()),document.styleSheets[0].addRule("input:focus + #slide"+t,this.switchOnColor())}}else 0==modelsHiddenParams[i].value&&$("#switch"+t)[0].checked&&($("#switch"+t).prop("checked",!1),document.styleSheets[0].addRule("#slide"+t+":before","transform: translateX(0px);"))},this.rescale=function(){this.render()},this.render=function(){var a=1;_.isUndefined(modelsParameters[i].switchWidthProportion)||(a=Math.min(1,parseFloat(modelsParameters[i].switchWidthProportion)/100));var s=$("#"+e).height(),o=Math.min(s,260);o=Math.min(o,a*$("#"+e).width()/3),o=Math.ceil(o);var c,d=$("#"+e).width(),n=document.createElement("div");(n.setAttribute("id","switch-widget-html"+t),n.setAttribute("class","switch-widget-html"),_.isUndefined(modelsParameters[i].switchWidthProportion))?c='<div class="switch-div" style="width: 100%;">':c='<div class="switch-div" style="width: '+(Math.min(100,parseFloat(modelsParameters[i].switchWidthProportion))+"%")+';">';var r="";if(r=this.bIsInteractive?"cursor: pointer;":"cursor: inherit;",c=(c=(c=c+'<label id="switch-label'+t+'" class="switch-label" style="height:'+o+'px;">')+'<input type="checkbox" id="switch'+t+'">')+'<div id="slide'+t+'"class="slider round" style="'+r+'">',c+="</div>",c+="</label>",c+="</div>",""!=modelsParameters[i].label&&modelsParameters[i].displayLabel){const e=this.getTransformedText("label");c=c+'<span id="switch-span'+t+'" class="switch-span" style="'+this.labelFontSize()+this.labelColor()+this.labelFontFamily()+'">'+e+"</span>"}n.innerHTML=c,$("#"+e).html(n),n.setAttribute("style","height: "+s+"px;"),document.styleSheets[0].addRule("input + #slide"+t,this.switchOffColor()),document.styleSheets[0].addRule("input:checked + #slide"+t,this.switchOnColor()),document.styleSheets[0].addRule("input:focus + #slide"+t,this.switchShadowColor());var h=Math.min(d,o)-8;if(document.styleSheets[0].addRule("#slide"+t+":before","width: "+h+"px;"),document.styleSheets[0].addRule("#slide"+t+":before","height: "+h+"px;"),null==modelsHiddenParams[i].value&&(modelsHiddenParams[i].value=!1),1==modelsHiddenParams[i].value){$("#switch"+t).prop("checked",!0);var u=$("#slide"+t).width()-h-8;document.styleSheets[0].addRule("#slide"+t+":before","transform: translateX("+u+"px);")}else 0==modelsHiddenParams[i].value&&($("#switch"+t).prop("checked",!1),document.styleSheets[0].addRule("#slide"+t+":before","transform: translateX(0px);"));this.bIsInteractive?l.enable():l.disable(),$("#switch"+t)[0].checked=modelsHiddenParams[i].value};const s=new WidgetActuatorDescription("value","Current value",WidgetActuatorDescription.READ_WRITE,WidgetPrototypesManager.SCHEMA_BOOLEAN);this.getActuatorDescriptions=function(){return[s]},this.value={updateCallback:function(){},setValue:function(e){modelsHiddenParams[i].value=e,l.updateSwitchStatus()},getValue:function(){return $("#switch"+t)[0].checked},addValueChangedHandler:function(e){this.updateCallback=e},removeValueChangedHandler:function(e){},setCaption:function(e,t){modelsParameters[i].inheritLabelFromData&&(l.captionHelper(e,l.bIsInteractive,t),l.render())},clearCaption:function(){modelsParameters[i].label="",l.render()}},l.render()},this.switchFlatUiWidget.prototype=baseWidget.prototype,this.pluginDefinition={name:"flatUiBoolean",widgetsDefinitionList:{flatUiCheckbox:{factory:"checkboxFlatUiWidget",title:"Checkbox",icn:"checkbox",help:"wdg/wdg-basics/#checkbox"},flatUiSwitch:{factory:"switchFlatUiWidget",title:"Switch",icn:"switch",help:"wdg/wdg-basics/#switch"}}},this.constructor()}modelsHiddenParams.flatUiCheckbox={value:!1},modelsHiddenParams.flatUiSwitch={value:!1},modelsParameters.flatUiCheckbox={label:"labelText",inheritLabelFromData:!0,displayLabel:!0,labelFontSize:.5,labelColor:"var(--widget-label-color)",labelFontFamily:"var(--widget-font-family)",checkboxSize:1,checkedColor:"var(--widget-input-checked-color)",uncheckedColor:"var(--widget-input-unchecked-color)"},modelsParameters.flatUiSwitch={label:"labelText",inheritLabelFromData:!0,displayLabel:!0,labelFontSize:.5,labelColor:"var(--widget-label-color)",labelFontFamily:"var(--widget-font-family)",switchWidthProportion:"30%",switchOnColor:"var(--widget-input-checked-color)",switchOffColor:"var(--widget-input-unchecked-color)"},modelsLayout.flatUiCheckbox={height:"5vh",width:"9vw",minWidth:"32px",minHeight:"24px"},modelsLayout.flatUiSwitch={height:"5vh",width:"10vw",minWidth:"50px",minHeight:"24px"},flatUiBooleanWidgetsPluginClass.prototype=basePlugin.prototype;var flatUiBooleanWidgetsPlugin=new flatUiBooleanWidgetsPluginClass;widgetsPluginsHandler.loadWidgetPlugin(flatUiBooleanWidgetsPlugin);
function flatUiAddressCompletionWidgetsPluginClass(){this.hereAutocompleteValueFlatUiWidget=function(e,t,a,i){this.constructor(e,t,a,i);var s=this;this.updateValue=function(e){if(!_.contains([9,16,17,18,20,33,34,35,36,37,38,39,40],e.which)&&(10==e.which||13==e.which||27==e.which)){var i=$("#ac-value"+t)[0].value;modelsHiddenParams[a].value=i,s.value.updateCallback(s.value,i),e.preventDefault()}},this.enable=function(){$("#ac-value"+t).prop("disabled",!1),$("#ac-value"+t).bind("typeahead:selected",(function(e,t,i){modelsHiddenParams[a].value=t.word,s.value.updateCallback(s.value,t.word)})),$("#ac-value"+t).on("keyup",(function(e,t){s.updateValue(e)})),$("#ac-value"+t).on("click",(function(e,t){widgetPreview.elevateZIndex(a,e)})),s.initTypeahead()},this.disable=function(){$("#ac-value"+t).prop("disabled",!0)},this.formatHereSuggestTable=function(e){var t=[];if(_.isUndefined(e))return t;if(_.isEmpty(e))return t;if(_.isUndefined(e.suggestions))return t;if(_.isEmpty(e.suggestions))return t;for(var a=0;a<e.suggestions.length;a++)t[a]=[],t[a][0]=e.suggestions[a].address.houseNumber,t[a][1]=e.suggestions[a].address.street,t[a][2]=e.suggestions[a].address.postalCode,t[a][3]=e.suggestions[a].address.city,t[a][4]=e.suggestions[a].address.county,t[a][5]=e.suggestions[a].address.state,t[a][6]=e.suggestions[a].address.country;return t},this.formatSuggestWords=function(e){var t,a,i,s=[];if(e.length<1)return"";for(var l=0;l<e.length;l++){s[l]="",i=!0;for(var o=0;o<=6;o++)a=i?"":", ",t=e[l][o],_.isNull(t)||_.isUndefined(t)||(s[l]=s[l]+a+t,i=!1)}var n=[];if(_.isArray(s))for(l=0;l<s.length;l++)n[l]={word:s[l]};return n},this.initTypeahead=function(){var e="";_.isUndefined(modelsParameters[a].countryIsoCodes)||(e="&country="+modelsParameters[a].countryIsoCodes),$("#ac-value"+t).typeahead("destroy"),$("#ac-value"+t).typeahead(null,{name:"suggestions",displayKey:"word",source:function(t,a){$.ajax({url:"https://xdashgateway.azure-api.net/autocomplete/suggest.json?query="+t+"&language=fr"+e,method:"GET",dataType:"json",success:function(e){var t=s.formatHereSuggestTable(e),i=s.formatSuggestWords(t);_.isUndefined(i)||a($.map(i,(function(e){return e})))}})}})},this.rescale=function(){this.render()},this.render=function(){let i=Math.min($("#"+e).height(),$("#"+e).width()/2);const l=document.createElement("div");l.setAttribute("id","ac-value-widget-html"+t),l.setAttribute("class","ac-value-widget-html");let o="";if(""!=modelsParameters[a].label&&modelsParameters[a].displayLabel){let s="";if(i=Math.min($("#"+e).height(),$("#"+e).width()/4),_.isUndefined(modelsParameters[a].valueWidthProportion))s="max-width: 45%; ";else{s="width: "+(Math.max(0,100-parseFloat(modelsParameters[a].valueWidthProportion))+"%")+"; "}const l=this.getTransformedText("label");o+='<span id ="ac-value-span'+t+'" class="ac-value-span" style="'+this.labelFontSize()+this.labelColor()+this.labelFontFamily()+s+'">'+l+"</span>"}const n=this.border();o+='<div id="ac-value-no-input-group">',o+='<input id="ac-value'+t+'" type="text" placeholder="Type an address" autocomplete="off" spellcheck="false" class="value-input form-control" style="height: '+i+"px; "+n+"; float: right; "+this.valueFontSize()+this.valueColor()+this.valueFontFamily()+this.backgroundColor()+'text-align: left;">',o+="</input>",o+="</div>",l.innerHTML=o,this.bIsInteractive?l.setAttribute("style","height: "+i+"px; cursor: text;"):l.setAttribute("style","height: "+i+"px;"),$("#"+e).html(l),$("#ac-value"+t)[0].value=modelsHiddenParams[a].value,this.bIsInteractive?s.enable():s.disable()};const l=new WidgetActuatorDescription("value","Current value",WidgetActuatorDescription.READ_WRITE,WidgetPrototypesManager.SCHEMA_STRING);this.getActuatorDescriptions=function(){return[l]},this.value={updateCallback:function(){},setValue:function(e){modelsHiddenParams[a].value=e,$("#ac-value"+t)[0].value=modelsHiddenParams[a].value},getValue:function(){return modelsHiddenParams[a].value},addValueChangedHandler:function(e){this.updateCallback=e,s.enable()},removeValueChangedHandler:function(e){s.disable()},setCaption:function(e,i){modelsParameters[a].inheritLabelFromData&&(s.captionHelper(e,s.bIsInteractive,i),$("#ac-value-span"+t).text(modelsParameters[a].label))},clearCaption:function(){modelsParameters[a].label="",s.render()}},s.render()},this.hereAutocompleteValueFlatUiWidget.prototype=baseWidget.prototype,this.pluginDefinition={name:"flatUiAddressCompletion",widgetsDefinitionList:{flatUiHereAutocompleteValue:{factory:"hereAutocompleteValueFlatUiWidget",title:"Address auto-completion",iconWidth:70,icn:"address-autocompletion",help:"wdg/wdg-geo-time/#address-autocompletion"}}},this.constructor()}modelsHiddenParams.flatUiHereAutocompleteValue={value:""},modelsParameters.flatUiHereAutocompleteValue={label:"labelText",inheritLabelFromData:!0,displayLabel:!0,labelFontSize:.5,labelColor:"var(--widget-label-color)",labelFontFamily:"var(--widget-font-family)",valueWidthProportion:"70%",valueFontSize:.5,valueColor:"var(--widget-color)",valueFontFamily:"var(--widget-font-family)",displayBorder:!0,borderColor:"var(--widget-border-color)",backgroundColor:"var(--widget-input-color)",countryIsoCodes:"FRA"},modelsLayout.flatUiHereAutocompleteValue={height:"5vh",width:"19vw",minWidth:"150px",minHeight:"32px"},flatUiAddressCompletionWidgetsPluginClass.prototype=basePlugin.prototype;var flatUiAddressCompletionWidgetsPlugin=new flatUiAddressCompletionWidgetsPluginClass;widgetsPluginsHandler.loadWidgetPlugin(flatUiAddressCompletionWidgetsPlugin);
function flatUiWidgetsPluginClass(){const e=this;!function(e){e.fn.addSliderSegments=function(){return this.each((function(){var t=e(this),a=t.slider("option"),i=(a.max-a.min)/a.step;if("vertical"===a.orientation){for(var l="",r=1;r<=i-1;r++)l+='<div class="ui-slider-segment" style="top:'+100/i*r+'%;"></div>';t.prepend(l)}else{var o='<div class="ui-slider-segment" style="margin-left: '+(100/i+"%")+';"></div>';t.prepend(o.repeat(i-1))}}))}}(jQuery),this.buttonFlatUiWidget=function(e,t,a,i){this.constructor(e,t,a,i);const l=this;this.numberOfTriggers=modelsParameters[a].numberOfTriggers,this.enable=function(){},this.disable=function(){},this.readFileEvt=function(){const e=$("#button"+t+"_select_file");e.on("change",(function(e){const t=new FileReader,i=e.target.files[0],l=i.size;let r="";r=l<1024?l+" bytes":l<1048576?(l/1024).toFixed(1)+" KB":(l/1048576).toFixed(1)+" MB";const o={type:i.type,size:r,name:i.name};t.addEventListener("load",(function(e){const t=e.target.result;t instanceof ArrayBuffer?(o.content=btoa([].reduce.call(new Uint8Array(t),(function(e,t){return e+String.fromCharCode(t)}),"")),o.isBinary=!0):(o.content=t,o.isBinary=!1),updateDataNodeFileFromWidget(a,o)})),modelsParameters[a].binaryFileInput?t.readAsArrayBuffer(i):t.readAsText(i)})),$("#button"+t).mousedown((function(t){t.preventDefault(),e.trigger("click")}))},this.rescale=function(){this.render()},this.render=function(){const i=document.createElement("div");i.setAttribute("id","button-widget-html"+t),i.setAttribute("class","button-widget-html");const r=Math.min($("#"+e).height(),$("#"+e).width()/2);let o=.5;_.isUndefined(modelsParameters[a].buttonFontSize)||(o=modelsParameters[a].buttonFontSize);const n='style="height: inherit; font-size: calc(7px + '+o*getFontFactor()+"vw + 0.4vh); "+this.buttonFontFamily()+'" class="btn btn-table-cell btn-lg '+a+"widgetCustomColor";this.setButtonColorStyle();let s="";const d=this.getTransformedText("text");let u=d;if(this.displayIcon()){u='<i class="'+this.fontAwesomeIcon()+'"></i>'+" "+d}if(this.bIsInteractive){if(modelsParameters[a].fileInput||modelsParameters[a].binaryFileInput){s+="<a "+n+'" id="button'+t+'">'+u+("<input onclick=\"displaySpinnerOnInputFileButton('"+t+'\')" type="file" style="display : none;" id="button'+t+'_select_file"></input>')+"</a>"}else s+="<a onclick=\"updateDataNodeFromWidgetwithspinButton( '"+a+"', '"+t+"')\" "+n+'" id="button'+t+'">'+u+"</a>";l.enable()}else s+="<a "+n+' /*disabled*/" id="button'+t+'">'+u+"</a>",l.disable();i.innerHTML=s,i.setAttribute("style","height: "+r+"px;"),$("#"+e).html(i),(modelsParameters[a].fileInput||modelsParameters[a].binaryFileInput)&&l.readFileEvt()},this.getActuatorDescriptions=function(e=null){const t=e||modelsParameters[a],i=[];if(t&&t.numberOfTriggers){const e=t.fileInput||t.binaryFileInput;for(let a=1;a<=t.numberOfTriggers;a++){const t="trigger"+a;e?i.push(new WidgetActuatorDescription(t,"File content",WidgetActuatorDescription.FILE)):i.push(new WidgetActuatorDescription(t,"Node to trigger/re-evaluate",WidgetActuatorDescription.TRIGGER,WidgetPrototypesManager.SCHEMA_ANYTHING))}}return i};for(let e=1;e<=this.numberOfTriggers;e++){this["trigger"+e]={updateCallback:function(){},addValueChangedHandler:function(e){this.updateCallback=e,l.enable()},removeValueChangedHandler:function(e){l.disable()}}}l.render()},this.buttonFlatUiWidget.prototype=baseWidget.prototype,this.horizontalSliderFlatUiWidget=function(e,t,a,i){this.constructor(e,t,a,i);var l=this;l.updateValue=function(e){var i=Number($("#hslider-value"+t)[0].value);$("#slider"+t).slider({value:i}),modelsHiddenParams[a].value=i,l.value.updateCallback(l.value,l.value.getValue()),e.preventDefault()},this.enable=function(){$("#slider"+t).on("slidestop",(function(e,t){l.value.setValue(t.value),l.value.updateCallback(l.value,t)})),$("#slider"+t).on("slide",(function(e,t){l.value.setValue(t.value)})),$("#slider"+t).slider("enable"),modelsParameters[a].validationOnFocusOut&&$("#hslider-value"+t).on("focusout",(function(e,t){l.updateValue(e)})),modelsParameters[a].displayValue&&($("#hslider-value"+t).prop("disabled",!1),$("#hslider-value"+t).on("keypress",(function(e,t){13==e.which&&l.updateValue(e)})))},this.disable=function(){$("#slider"+t).on("slide",(function(e,t){})),$("#slider"+t).on("slidestop",(function(e,t){})),$("#slider"+t).slider("disable"),modelsParameters[a].displayValue&&$("#hslider-value"+t).prop("disabled",!0)},this.insertLabel=function(e){const t=this.getTransformedText("label"),i=document.createElement("span");i.setAttribute("class","label-h-slider"),i.setAttribute("id","h-slider-span"),_.isUndefined(modelsParameters[a].labelWidthProportion)?i.setAttribute("style","width: 20%; "+this.labelFontSize()+this.labelColor()+this.labelFontFamily()):i.setAttribute("style","width:"+modelsParameters[a].labelWidthProportion+"; "+this.labelFontSize()+this.labelColor()+this.labelFontFamily()),i.innerHTML=t,e.appendChild(i)},this.insertValue=function(i){var l;l=modelsParameters[a].displayLabel?Math.min($("#"+e).height(),$("#"+e).width()/6):Math.min($("#"+e).height(),$("#"+e).width()/8);var r=document.createElement("div");r.setAttribute("class","h-slider-value-div"),r.setAttribute("id","div-for-hslider-value"+t),_.isUndefined(modelsParameters[a].valueWidthProportion)?r.setAttribute("style","width:30%;"):r.setAttribute("style","width:"+modelsParameters[a].valueWidthProportion+";");var o="";o=this.bIsInteractive?"cursor: text;":"cursor: inherit;";var n='<input id="hslider-value'+t+'" type="text" placeholder="" class="hslider-input form-control" style="height: '+l+"px; "+this.valueFontSize()+this.valueColor()+this.valueFontFamily()+o+'" disabled></input>';r.innerHTML=n,i.appendChild(r)},this.rescale=function(){this.render()},this.render=function(){var i=document.createElement("div");i.setAttribute("class","sliderInput"),i.setAttribute("style","display: table");var r=document.createElement("div");r.setAttribute("id","h-slider-div"),_.isUndefined(modelsParameters[a].sliderWidthProportion)?r.setAttribute("style","width:50%;"):r.setAttribute("style","width:"+modelsParameters[a].sliderWidthProportion+";");var o=document.createElement("div");o.setAttribute("id","slider"+t),r.appendChild(o),modelsParameters[a].displayLabel&&this.insertLabel(i),i.appendChild(r),modelsParameters[a].displayValue&&this.insertValue(i),$("#"+e).html(i);var n=$("#slider"+t);n.length>0&&n.slider({min:modelsParameters[a].min,max:modelsParameters[a].max,step:modelsParameters[a].step,value:modelsHiddenParams[a].value,orientation:"horizontal",range:"min"}).addSliderSegments(),$("#slider"+t).addClass("h-slider-div-div"),document.styleSheets[0].addRule("#slider"+t,this.sliderSegmentColor()),document.styleSheets[0].addRule("#slider"+t+" > .ui-slider-range",this.sliderRangeColor()),document.styleSheets[0].addRule("#slider"+t+" > .ui-slider-handle",this.sliderHandleDefaultColor()),document.styleSheets[0].addRule("#slider"+t+" > .ui-slider-handle:hover",this.sliderHandleHoverColor()),document.styleSheets[0].addRule("#slider"+t+" > .ui-slider-handle:active",this.sliderHandleActiveColor()),document.styleSheets[0].addRule("#hslider-value"+t,this.valueBorderColor()),this.bIsInteractive?l.enable():l.disable(),modelsParameters[a].displayValue&&(modelsParameters[a].min>modelsHiddenParams[a].value?$("#hslider-value"+t)[0].value=modelsParameters[a].min:$("#hslider-value"+t)[0].value=modelsHiddenParams[a].value)};const r=new WidgetActuatorDescription("value","Current value",WidgetActuatorDescription.READ_WRITE,WidgetPrototypesManager.SCHEMA_NUMBER),o=new WidgetActuatorDescription("min","Value lower bound",WidgetActuatorDescription.READ,WidgetPrototypesManager.SCHEMA_NUMBER),n=new WidgetActuatorDescription("max","Value upper bound",WidgetActuatorDescription.READ,WidgetPrototypesManager.SCHEMA_NUMBER);this.getActuatorDescriptions=function(e=null){const t=e||modelsParameters[a],i=[r];return t&&t.rangeActuator&&(i.push(o),i.push(n)),i},this.value={updateCallback:function(){},setValue:function(e){modelsHiddenParams[a].value=e,$("#slider"+t).slider({value:e}),modelsParameters[a].displayValue&&($("#hslider-value"+t)[0].value=e)},getValue:function(){return modelsHiddenParams[a].value},addValueChangedHandler:function(e){this.updateCallback=e,l.enable()},removeValueChangedHandler:function(e){l.disable()},setCaption:function(e,t){modelsParameters[a].inheritLabelFromData&&(l.captionHelper(e,l.bIsInteractive,t),l.render())},clearCaption:function(){modelsParameters[a].label="",l.render()}},this.max={updateCallback:function(){},setValue:function(e){const t=Number(e);modelsParameters[a].max=t,l.render()},getValue:function(){return modelsParameters[a].max},addValueChangedHandler:function(e){this.updateCallback=e,l.enable()},removeValueChangedHandler:function(e){l.disable()}},this.min={updateCallback:function(){},setValue:function(e){const t=Number(e);modelsParameters[a].min=t,l.render()},getValue:function(){return modelsParameters[a].min},addValueChangedHandler:function(e){this.updateCallback=e,l.enable()},removeValueChangedHandler:function(e){l.disable()}},l.render()},this.horizontalSliderFlatUiWidget.prototype=baseWidget.prototype,this.verticalSliderFlatUiWidget=function(e,t,a,i){this.constructor(e,t,a,i);var l=this;this.enable=function(e){$("#vertical-slider"+t).on("slidestop",(function(e,t){l.value.setValue(t.value),l.value.updateCallback(l.value,t)})),$("#vertical-slider"+t).on("slide",(function(e,t){l.value.setValue(t.value)})),$("#vertical-slider"+t).slider("enable")},this.disable=function(){$("#vertical-slider"+t).on("slidestop",(function(e,t){})),$("#vertical-slider"+t).on("slide",(function(e,t){})),$("#vertical-slider"+t).slider("disable")},this.insertLabel=function(e){const t=this.getTransformedText("label"),a=document.createElement("div");a.setAttribute("class","v-slider-div");const i=document.createElement("span");i.setAttribute("class","v-slider-span label-v-slider"),i.setAttribute("style",this.labelFontSize()+this.labelColor()+this.labelFontFamily()),i.innerHTML=t,a.appendChild(i),e.appendChild(a)},this.rescale=function(){this.render()},this.render=function(){var i=document.createElement("div");i.setAttribute("class","sliderInput");var r=document.createElement("div");r.setAttribute("id","vertical-slider"+t),r.setAttribute("class","v-slider-div-div"),r.setAttribute("style","height: calc(100% - 24px);"),i.appendChild(r),modelsParameters[a].displayLabel&&""!=modelsParameters[a].label&&(r.setAttribute("style","height: 80%;"),this.insertLabel(i)),$("#"+e).html(i);var o=$("#vertical-slider"+t);o.length>0&&o.slider({min:modelsParameters[a].min,max:modelsParameters[a].max,step:modelsParameters[a].step,value:modelsHiddenParams[a].value,orientation:"vertical",range:"min"}).addSliderSegments(o.slider("option").max,"vertical"),document.styleSheets[0].addRule("#vertical-slider"+t,this.sliderSegmentColor()),document.styleSheets[0].addRule("#vertical-slider"+t+" > .ui-slider-range",this.sliderRangeColor()),document.styleSheets[0].addRule("#vertical-slider"+t+" > .ui-slider-handle",this.sliderHandleDefaultColor()),document.styleSheets[0].addRule("#vertical-slider"+t+" > .ui-slider-handle:hover",this.sliderHandleHoverColor()),document.styleSheets[0].addRule("#vertical-slider"+t+" > .ui-slider-handle:active",this.sliderHandleActiveColor()),this.bIsInteractive?l.enable():l.disable()};const r=new WidgetActuatorDescription("value","Current value",WidgetActuatorDescription.READ_WRITE,WidgetPrototypesManager.SCHEMA_NUMBER),o=new WidgetActuatorDescription("min","Value lower bound",WidgetActuatorDescription.READ,WidgetPrototypesManager.SCHEMA_NUMBER),n=new WidgetActuatorDescription("max","Value upper bound",WidgetActuatorDescription.READ,WidgetPrototypesManager.SCHEMA_NUMBER);this.getActuatorDescriptions=function(e=null){const t=e||modelsParameters[a],i=[r];return t&&t.rangeActuator&&(i.push(o),i.push(n)),i},this.value={updateCallback:function(){},setValue:function(e){modelsHiddenParams[a].value=e,$("#vertical-slider"+t).slider({value:e})},getValue:function(){return modelsHiddenParams[a].value},addValueChangedHandler:function(e){this.updateCallback=e,l.enable()},removeValueChangedHandler:function(e){l.disable()},setCaption:function(e,t){modelsParameters[a].inheritLabelFromData&&(l.captionHelper(e,l.bIsInteractive,t),l.render())},clearCaption:function(){modelsParameters[a].label="",l.render()}},this.max={updateCallback:function(){},setValue:function(e){const t=Number(e);modelsParameters[a].max=t},getValue:function(){return modelsParameters[a].max},addValueChangedHandler:function(e){this.updateCallback=e,l.enable()},removeValueChangedHandler:function(e){l.disable()}},this.min={updateCallback:function(){},setValue:function(e){const t=Number(e);modelsParameters[a].min=t},getValue:function(){return modelsParameters[a].min},addValueChangedHandler:function(e){this.updateCallback=e,l.enable()},removeValueChangedHandler:function(e){l.disable()}},l.render()},this.verticalSliderFlatUiWidget.prototype=baseWidget.prototype,this.progressBarFlatUiWidget=function(e,t,a,i){this.constructor(e,t,a,i);var l=this;this.enable=function(){modelsParameters[a].displayValue&&$("#progress-bar-value"+t).prop("disabled",!1)},this.disable=function(){modelsParameters[a].displayValue&&$("#progress-bar-value"+t).prop("disabled",!0)},this.insertLabel=function(e){const t=this.getTransformedText("label"),i=document.createElement("span");i.setAttribute("class","label-progress-bar"),i.setAttribute("id","progress-bar-span"),_.isUndefined(modelsParameters[a].labelWidthProportion)?i.setAttribute("style","width: 20%; "+this.labelFontSize()+this.labelColor()+this.labelFontFamily()):i.setAttribute("style","width:"+modelsParameters[a].labelWidthProportion+"; "+this.labelFontSize()+this.labelColor()+this.labelFontFamily()),i.innerHTML=t,e.appendChild(i)},this.insertValue=function(i){var l;l=modelsParameters[a].displayLabel?Math.min($("#"+e).height(),$("#"+e).width()/6):Math.min($("#"+e).height(),$("#"+e).width()/8);var r=document.createElement("div");r.setAttribute("class","progress-bar-value-div"),r.setAttribute("id","div-for-progress-bar-value"+t),_.isUndefined(modelsParameters[a].valueWidthProportion)?r.setAttribute("style","width:30%;"):r.setAttribute("style","width:"+modelsParameters[a].valueWidthProportion+";");var o="";o=this.bIsInteractive?"cursor: text;":"cursor: inherit;";var n='<input id="progress-bar-value'+t+'" type="text" placeholder="" class="hslider-input form-control" style="height: '+l+"px; "+this.valueFontSize()+this.valueColor()+this.valueFontFamily()+o+'" disabled></input>';r.innerHTML=n,i.appendChild(r)},this.updateProgressBarWidth=function(){if(!_.isUndefined(modelsHiddenParams[a].value)){var e,i=modelsHiddenParams[a].value,l=$("#progress-bar"+t+" div"),r=modelsParameters[a].min,o=modelsParameters[a].max;e=i<=r?0:Math.ceil((i-r)/(o-r)*100),l.css("width",e+"%")}},this.updateProgressBarValue=function(){modelsParameters[a].displayValue&&(modelsParameters[a].min>modelsHiddenParams[a].value?$("#progress-bar-value"+t)[0].value=modelsParameters[a].min:$("#progress-bar-value"+t)[0].value=modelsHiddenParams[a].value)},this.rescale=function(){this.render()},this.render=function(){var i=document.createElement("div");i.setAttribute("class","progress-bar-widget");var r=document.createElement("div");r.setAttribute("id","progress-bar-div"),_.isUndefined(modelsParameters[a].progressBarWidthProportion)?r.setAttribute("style","width:50%;"):r.setAttribute("style","width:"+modelsParameters[a].progressBarWidthProportion+";");var o=document.createElement("div");o.setAttribute("id","progress-bar"+t),o.setAttribute("class","progress");var n=document.createElement("div");n.setAttribute("class","progress-bar"),n.setAttribute("role","progressbar"),o.appendChild(n),r.appendChild(o),modelsParameters[a].displayLabel&&this.insertLabel(i),i.appendChild(r),modelsParameters[a].displayValue&&this.insertValue(i),$("#"+e).html(i),$("#progress-bar"+t).addClass("progress-bar-div-div"),document.styleSheets[0].addRule("#progress-bar"+t,this.progressBarSegmentColor()),document.styleSheets[0].addRule("#progress-bar"+t+" > .progress-bar",this.progressBarRangeColor()),this.bIsInteractive?l.enable():l.disable(),this.updateProgressBarWidth(),this.updateProgressBarValue()};const r=new WidgetActuatorDescription("value","Current progress",WidgetActuatorDescription.READ,WidgetPrototypesManager.SCHEMA_NUMBER),o=new WidgetActuatorDescription("min","Base progress value",WidgetActuatorDescription.READ,WidgetPrototypesManager.SCHEMA_NUMBER),n=new WidgetActuatorDescription("max","Final progress value",WidgetActuatorDescription.READ,WidgetPrototypesManager.SCHEMA_NUMBER);this.getActuatorDescriptions=function(e=null){const t=e||modelsParameters[a],i=[r];return t&&t.rangeActuator&&(i.push(o),i.push(n)),i},this.value={updateCallback:function(){},setValue:function(e){modelsHiddenParams[a].value=e,modelsParameters[a].displayValue&&($("#progress-bar-value"+t)[0].value=e),l.render()},getValue:function(){return modelsHiddenParams[a].value},addValueChangedHandler:function(e){this.updateCallback=e,l.enable()},removeValueChangedHandler:function(e){l.disable()},setCaption:function(e,t){modelsParameters[a].inheritLabelFromData&&(l.captionHelper(e,l.bIsInteractive,t),l.render())},clearCaption:function(){modelsParameters[a].label="",l.render()}},this.max={updateCallback:function(){},setValue:function(e){const t=Number(e);modelsParameters[a].max=t,l.render()},getValue:function(){return modelsParameters[a].max},addValueChangedHandler:function(e){this.updateCallback=e,l.enable()},removeValueChangedHandler:function(e){l.disable()}},this.min={updateCallback:function(){},setValue:function(e){const t=Number(e);modelsParameters[a].min=t,l.render()},getValue:function(){return modelsParameters[a].min},addValueChangedHandler:function(e){this.updateCallback=e,l.enable()},removeValueChangedHandler:function(e){l.disable()}},l.render()},this.progressBarFlatUiWidget.prototype=baseWidget.prototype,this.valueFlatUiWidgetModel=function(e,t,a,i,l,r){const o=l;o.updateValue=function(e){const i=$("#"+r+t)[0].value;modelsHiddenParams[a].value=i,o.value.updateCallback(o.value,o.value.getValue(),!0),e.preventDefault()},o.enable=function(){$("#"+r+t).prop("disabled",!1),modelsParameters[a].validationButton&&$("#"+r+"-valid-btn"+t).prop("disabled",!1),$("#"+r+t).on("keypress",(function(e,t){13==e.which&&o.updateValue(e)})),modelsParameters[a].validationOnFocusOut?$("#"+r+t).on("focusout",(function(e,t){o.updateValue(e)})):$("#"+r+t).on("focusout",(function(e,t){})),$("#"+r+"-valid-btn"+t).off("click").on("click",(function(e,t){o.updateValue(e)}))},o.disable=function(){modelsParameters[a].validationButton},o.rescale=function(){this.render()},o.render=function(){let i=Math.min($("#"+e).height(),$("#"+e).width()/2);const l=document.createElement("div");l.setAttribute("id",r+"-widget-html"+t),l.setAttribute("class","value-widget-html");let n="";if(""!=modelsParameters[a].label&&modelsParameters[a].displayLabel){const l=this.getTransformedText("label");if(i=Math.min($("#"+e).height(),$("#"+e).width()/4),_.isUndefined(modelsParameters[a].valueWidthProportion))n='<span id ="'+r+"-span"+t+'" class="value-span" style="max-width: 45%;'+ +this.labelFontSize()+this.labelColor()+this.labelFontFamily()+'">'+l+"</span>";else{const e=Math.max(0,100-parseFloat(modelsParameters[a].valueWidthProportion))+"%";n='<span id ="'+r+"-span"+t+'" class="value-span" style="width:'+e+"; "+this.labelFontSize()+this.labelColor()+this.labelFontFamily()+'">'+l+"</span>"}}let s,d="disabled ";switch(d="",r){case"value":case"text-input":s=modelsParameters[a].isPassword?"password":"text";break;case"numeric-input":s="number";break;case"value-display":s="text"}let u="",c="";"value-display"===r&&(u="readonly ",c="opacity: 1; ");let m="",p="",h="";modelsParameters[a].validationButton?(m='<div class="input-group">',p="border-bottom-right-radius: 0; border-top-right-radius: 0; ",h='<span class="input-group-btn"><button id="'+r+"-valid-btn"+t+'" class="/*ui-value-button*/ btn btn-primary" type="button" style="height:'+i+"px; width:"+i+'px; "><span class="fa fa-check" style="color: #ffffff"/></button></span>'):(m='<div id="value-no-input-group">',p="float: right;"),n+=m,n+="<input "+u+' id="'+r+t+'" type='+s+' placeholder="" class="value-input form-control" style="height: '+i+"px; "+c+this.valueColor()+this.backgroundColor()+this.valueFontFamily()+this.border()+this.valueFontSize()+p+" text-align:"+modelsParameters[a].valueTextAlign+';"</input>',n+=h,n+="</div>","text-input"!=r&&""!=modelsParameters[a].unit&&modelsParameters[a].displayUnit&&(n=n+'<span id ="unit-span'+t+'" class="value-span" style="max-width: 45%; font-size: calc(7px + '+modelsParameters[a].unitFontSize*getFontFactor()+'vw + 0.4vh);">'+modelsParameters[a].unit+"</span>"),l.innerHTML=n,"value-display"!==r&&(document.styleSheets[0].addRule("#"+r+"-valid-btn"+t,this.validationButtonBorderColor()),document.styleSheets[0].addRule("#"+r+"-valid-btn"+t,this.validationButtonDefaultColor()),document.styleSheets[0].addRule("#"+r+"-valid-btn"+t+":hover"," outline: none; "+this.validationButtonHoverColor()),document.styleSheets[0].addRule("#"+r+"-valid-btn"+t+":focus"," outline: none; "),document.styleSheets[0].addRule("#"+r+"-valid-btn"+t+":active",this.validationButtonActiveColor())),this.bIsInteractive?l.setAttribute("style","height: "+i+"px; cursor: auto;"):l.setAttribute("style","height: "+i+"px;"),$("#"+e).html(l),$("#"+r+t)[0].value=o.valueFormat(modelsHiddenParams[a].value),this.bIsInteractive?o.enable():o.disable()},o.value={updateCallback:function(){},setValue:function(e){modelsHiddenParams[a].value=e,$("#"+r+t)[0].value=o.valueFormat(e)},getValue:function(){switch(r){case"value":case"value-display":return modelsParameters[a].isNumber?Number(modelsHiddenParams[a].value):modelsHiddenParams[a].value;case"text-input":return modelsHiddenParams[a].value;case"numeric-input":return Number(modelsHiddenParams[a].value)}},addValueChangedHandler:function(e){this.updateCallback=e,o.enable()},removeValueChangedHandler:function(e){o.disable()},setCaption:function(e,i){modelsParameters[a].inheritLabelFromData&&(o.captionHelper(e,o.bIsInteractive,i),$("#"+r+"-span"+t).text(modelsParameters[a].label))},clearCaption:function(){modelsParameters[a].label="",o.render()}},o.render()},this.valueFlatUiWidget=function(t,a,i,l){this.constructor(t,a,i,l),e.valueFlatUiWidgetModel(t,a,i,l,this,"value");const r=new WidgetActuatorDescription("value","Current number",WidgetActuatorDescription.READ_WRITE,WidgetPrototypesManager.SCHEMA_NUMBER),o=new WidgetActuatorDescription("value","Current string",WidgetActuatorDescription.READ_WRITE,WidgetPrototypesManager.SCHEMA_STRING);this.getActuatorDescriptions=function(e){return[(e=e||modelsParameters[i])&&e.isNumber?r:o]}},this.valueFlatUiWidget.prototype=baseWidget.prototype,this.textInputFlatUiWidget=function(t,a,i,l){this.constructor(t,a,i,l),e.valueFlatUiWidgetModel(t,a,i,l,this,"text-input");const r=new WidgetActuatorDescription("value","Current string",WidgetActuatorDescription.READ_WRITE,WidgetPrototypesManager.SCHEMA_STRING);this.getActuatorDescriptions=()=>[r]},this.textInputFlatUiWidget.prototype=baseWidget.prototype,this.numericInputFlatUiWidget=function(t,a,i,l){this.constructor(t,a,i,l),e.valueFlatUiWidgetModel(t,a,i,l,this,"numeric-input");const r=new WidgetActuatorDescription("value","Current number",WidgetActuatorDescription.READ_WRITE,WidgetPrototypesManager.SCHEMA_NUMBER);this.getActuatorDescriptions=()=>[r]},this.numericInputFlatUiWidget.prototype=baseWidget.prototype,this.valueDisplayFlatUiWidget=function(t,a,i,l){this.constructor(t,a,i,l),e.valueFlatUiWidgetModel(t,a,i,l,this,"value-display");const r=new WidgetActuatorDescription("value","Displayed value",WidgetActuatorDescription.READ,WidgetPrototypesManager.SCHEMA_NUMBER_OR_STRING);this.getActuatorDescriptions=()=>[r]},this.valueDisplayFlatUiWidget.prototype=baseWidget.prototype,this.pluginDefinition={name:"flatUi",widgetsDefinitionList:{flatUiHorizontalSlider:{factory:"horizontalSliderFlatUiWidget",title:"Horizontal slider",icn:"horizontal-slider",help:"wdg-basics/#horizontal-slider"},flatUiVerticalSlider:{factory:"verticalSliderFlatUiWidget",title:"Vertical slider",icn:"vertical-slider",help:"wdg/wdg-basics/#vertical-slider"},flatUiProgressBar:{factory:"progressBarFlatUiWidget",title:"Progress bar",icn:"progress-bar",help:"wdg-basics/#progress-bar"},flatUiValue:{factory:"valueFlatUiWidget",title:"Value",icn:"value",help:"wdg/wdg-basics/#value"},flatUiTextInput:{factory:"textInputFlatUiWidget",title:"Text Input",icn:"text-input",help:"wdg/wdg-basics/#text-input"},flatUiNumericInput:{factory:"numericInputFlatUiWidget",title:"Numeric Input",icn:"numeric-input",help:"wdg/wdg-basics/#numeric-input"},flatUiValueDisplay:{factory:"valueDisplayFlatUiWidget",title:"Value Display",icn:"value",help:"wdg/wdg-basics/#value-display"},flatUiButton:{factory:"buttonFlatUiWidget",title:"Push button",icn:"button",help:"wdg/wdg-basics/#push-button"}}},this.constructor()}String.prototype.repeat=function(e){return new Array(Math.round(e)+1).join(this)},modelsHiddenParams.flatUiHorizontalSlider={value:0},modelsHiddenParams.flatUiVerticalSlider={value:0},modelsHiddenParams.flatUiProgressBar={value:0},modelsHiddenParams.flatUiValue={value:""},modelsHiddenParams.flatUiTextInput={value:""},modelsHiddenParams.flatUiNumericInput={value:""},modelsHiddenParams.flatUiValueDisplay={value:""},modelsParameters.flatUiHorizontalSlider={label:"labelText",inheritLabelFromData:!0,displayLabel:!0,labelFontSize:.5,labelColor:"var(--widget-label-color)",labelFontFamily:"var(--widget-font-family)",rangeActuator:!1,min:0,max:100,step:1,displayValue:!0,validationOnFocusOut:!0,valueFontSize:.5,valueFontFamily:"var(--widget-font-family)",valueBorderColor:"var(--widget-border-color)",labelWidthProportion:"20%",sliderWidthProportion:"60%",valueWidthProportion:"20%",sliderRangeColor:"var(--widget-range-color)",sliderSegmentColor:"var(--widget-segment-color)",sliderHandleDefaultColor:"var(--widget-handle-default-color)",sliderHandleHoverColor:"var(--widget-handle-hover-color)",sliderHandleActiveColor:"var(--widget-handle-active-color)",valueColor:"var(--widget-color)"},modelsParameters.flatUiVerticalSlider={label:"labelText",inheritLabelFromData:!0,displayLabel:!0,labelFontSize:.5,labelColor:"var(--widget-label-color)",labelFontFamily:"var(--widget-font-family)",rangeActuator:!1,min:0,max:100,step:1,sliderRangeColor:"var(--widget-range-color)",sliderSegmentColor:"var(--widget-segment-color)",sliderHandleDefaultColor:"var(--widget-handle-default-color)",sliderHandleHoverColor:"var(--widget-handle-hover-color)",sliderHandleActiveColor:"var(--widget-handle-active-color)"},modelsParameters.flatUiProgressBar={label:"labelText",inheritLabelFromData:!0,displayLabel:!0,labelFontSize:.5,labelColor:"var(--widget-label-color)",labelFontFamily:"var(--widget-font-family)",rangeActuator:!1,min:0,max:100,displayValue:!1,valueFontSize:.5,valueFontFamily:"var(--widget-font-family)",labelWidthProportion:"20%",progressBarWidthProportion:"60%",valueWidthProportion:"20%",progressBarRangeColor:"var(--widget-range-color)",progressBarSegmentColor:"var(--widget-segment-color)",valueColor:"var(--widget-color)"},modelsParameters.flatUiValue={label:"labelText",inheritLabelFromData:!0,displayLabel:!0,labelFontSize:.5,labelColor:"var(--widget-label-color)",labelFontFamily:"var(--widget-font-family)",valueWidthProportion:"70%",validationButton:!1,validationBtnDefaultColor:"var(--widget-button-primary-color)",validationBtnActiveColor:"var(--widget-button-active-color)",validationBtnHoverColor:"var(--widget-button-hover-color)",validationOnFocusOut:!0,isNumber:!1,isPassword:!1,decimalDigits:3,valueFontSize:.5,valueColor:"var(--widget-input-text)",valueFontFamily:"var(--widget-font-family)",valueTextAlign:"left",displayBorder:!0,borderColor:"var(--widget-border-color)",unit:"unitText",displayUnit:!1,unitFontSize:.5},modelsParameters.flatUiTextInput={label:"labelText",inheritLabelFromData:!0,displayLabel:!0,labelFontSize:.5,labelColor:"var(--widget-label-color)",labelFontFamily:"var(--widget-font-family)",valueWidthProportion:"70%",validationButton:!1,validationBtnDefaultColor:"var(--widget-button-primary-color)",validationBtnActiveColor:"var(--widget-button-active-color)",validationBtnHoverColor:"var(--widget-button-hover-color)",validationOnFocusOut:!0,isPassword:!1,valueFontSize:.5,valueColor:"var(--widget-input-text)",valueFontFamily:"var(--widget-font-family)",valueTextAlign:"left",displayBorder:!0,borderColor:"var(--widget-border-color)",backgroundColor:"var(--widget-input-color)"},modelsParameters.flatUiNumericInput={label:"labelText",inheritLabelFromData:!0,displayLabel:!0,labelFontSize:.5,labelColor:"var(--widget-label-color)",labelFontFamily:"var(--widget-font-family)",valueWidthProportion:"70%",validationButton:!1,validationBtnDefaultColor:"var(--widget-button-primary-color)",validationBtnActiveColor:"var(--widget-button-active-color)",validationBtnHoverColor:"var(--widget-button-hover-color)",validationOnFocusOut:!0,valueFontSize:.5,valueColor:"var(--widget-input-text)",valueFontFamily:"var(--widget-font-family)",valueTextAlign:"left",displayBorder:!0,borderColor:"var(--widget-border-color)",backgroundColor:"var(--widget-input-color)",unit:"unitText",displayUnit:!1,unitFontSize:.5},modelsParameters.flatUiValueDisplay={label:"labelText",inheritLabelFromData:!0,displayLabel:!0,labelFontSize:.5,labelColor:"var(--widget-label-color)",labelFontFamily:"var(--widget-font-family)",valueWidthProportion:"70%",decimalDigits:3,valueFontSize:.5,valueColor:"var(--widget-input-text)",valueFontFamily:"var(--widget-font-family)",valueTextAlign:"left",displayBorder:!0,borderColor:"var(--widget-border-color)",backgroundColor:"var(--widget-input-color)",unit:"unitText",displayUnit:!1,unitFontSize:.5},modelsParameters.flatUiButton={text:"Push button",numberOfTriggers:1,fileInput:!1,binaryFileInput:!1,buttonFontSize:.3,displayIcon:!1,fontAwesomeIcon:"",buttonFontFamily:"var(--widget-font-family)",buttonTextColor:"var(--widget-button-primary-text)",buttonDefaultColor:"var(--widget-button-primary-color)",buttonActiveColor:"var(--widget-button-active-color)",buttonHoverColor:"var(--widget-button-hover-color)"},modelsLayout.flatUiHorizontalSlider={height:"5vh",width:"24vw",minWidth:"200px",minHeight:"24px"},modelsLayout.flatUiVerticalSlider={height:"20vh",width:"5vw",minWidth:"32px",minHeight:"50px"},modelsLayout.flatUiProgressBar={height:"5vh",width:"24vw",minWidth:"200px",minHeight:"24px"},modelsLayout.flatUiValue={height:"5vh",width:"19vw",minWidth:"150px",minHeight:"24px"},modelsLayout.flatUiTextInput={height:"5vh",width:"19vw",minWidth:"150px",minHeight:"24px"},modelsLayout.flatUiNumericInput={height:"5vh",width:"19vw",minWidth:"150px",minHeight:"24px"},modelsLayout.flatUiValueDisplay={height:"5vh",width:"19vw",minWidth:"150px",minHeight:"24px"},modelsLayout.flatUiButton={height:"6vh",width:"8vw",minWidth:"55px",minHeight:"24px"},flatUiWidgetsPluginClass.prototype=basePlugin.prototype;var flatUiWidgetsPlugin=new flatUiWidgetsPluginClass;widgetsPluginsHandler.loadWidgetPlugin(flatUiWidgetsPlugin);
function saveToFileButtonWidgetsPluginClass(){this.buttonSaveToFileWidget=function(t,e,i,o){this.constructor(t,e,i,o);var n=this;this.enable=function(){},this.disable=function(){},this.saveFile=function(){const t=modelsParameters[i].fileName;let e=modelsHiddenParams[i].value;if(!e)return;e="data:text/plain;charset=utf-8,"+e;const o=encodeURI(e),n=document.createElement("a");n.setAttribute("href",o),n.setAttribute("download",t),n.click()},this.rescale=function(){this.render()},this.render=function(){var o=document.createElement("div");o.setAttribute("id","button-save-to-file-widget-html"+e),o.setAttribute("class","button-widget-html");var a=Math.min($("#"+t).height(),$("#"+t).width()/2),l=.5;_.isUndefined(modelsParameters[i].buttonFontSize)||(l=modelsParameters[i].buttonFontSize);var s='style="text-align: center; vertical-align: middle;font-size: calc(7px + '+l*getFontFactor()+"vw + 0.4vh); height: "+a+"px; display:table-cell; "+this.buttonFontFamily()+'" class="btn btn-block btn-lg '+i+"widgetCustomColor";this.setButtonColorStyle();const r=this.getTransformedText("text");var u;u="<a "+s+'" id="button-save-to-file'+e+'">  '+r+"  </a>",o.innerHTML=u,o.setAttribute("style","height: "+a+"px;"),$("#"+t).html(o),$("#button-save-to-file"+e).on("click",(function(){n.saveFile()}))};const a=new WidgetActuatorDescription("value","File content",WidgetActuatorDescription.READ,WidgetPrototypesManager.SCHEMA_STRING);this.getActuatorDescriptions=function(){return[a]},this.value={updateCallback:function(){},setValue:function(t){modelsHiddenParams[i].value=t},getValue:function(){return modelsHiddenParams[i].value},addValueChangedHandler:function(t){this.updateCallback=t,n.enable()},removeValueChangedHandler:function(t){n.disable()}},n.render()},this.buttonSaveToFileWidget.prototype=baseWidget.prototype,this.pluginDefinition={name:"saveToFileButton",widgetsDefinitionList:{saveToFileButton:{factory:"buttonSaveToFileWidget",title:"Save to file button",icn:"export-to-file",help:"wdg/wdg-basics/#save-to-file-button"}}},this.constructor()}modelsHiddenParams.saveToFileButton={value:""},modelsParameters.saveToFileButton={text:"Save to file",fileName:"export.txt",buttonFontSize:.5,buttonFontFamily:"var(--widget-font-family)",buttonTextColor:"var(--widget-button-primary-text)",buttonDefaultColor:"var(--widget-button-primary-color)",buttonActiveColor:"var(--widget-button-active-color)",buttonHoverColor:"var(--widget-button-hover-color)"},modelsLayout.saveToFileButton={height:"5vh",width:"8vw",minWidth:"55px",minHeight:"50px"},saveToFileButtonWidgetsPluginClass.prototype=basePlugin.prototype;var saveToFileButtonWidgetsPlugin=new saveToFileButtonWidgetsPluginClass;widgetsPluginsHandler.loadWidgetPlugin(saveToFileButtonWidgetsPlugin);
function loadFileWidgetsPluginClass(){this.loadFileWidget=function(idDivContainer,idWidget,idInstance,bInteractive){this.constructor(idDivContainer,idWidget,idInstance,bInteractive);const self=this;function _getFileSize(e){return e<1024?e+" bytes":e<1048576?(e/1024).toFixed(1)+" KB":(e/1048576).toFixed(1)+" MB"}function _getFileExtension(e){return e.split(".").pop()}function _processTextFile(fileExtension,fileData){const extensions=["json","xprjson"];return extensions.includes(fileExtension)?JSON.parse(JSON.stringify(eval("("+fileData+")")),null,2):fileData}function _processBinaryFile(e){return btoa([].reduce.call(new Uint8Array(e),(e,t)=>e+String.fromCharCode(t),""))}function _checkFileSize(e){if(e>104857600)throw new Error("Unable to load file due to large size over 100MB")}function _handleFileError(e,t){const i=new PNotify({title:"Unzip file",text:"Error reading "+e.name+": "+t,type:"error",styling:"bootstrap3"});return $(".ui-pnotify-container").on("click",()=>i.remove()),console.error("Error reading "+e.name+": "+t),-1}this.enable=function(){},this.disable=function(){},this.updateValue=function(e){},this.readFile=async function(e){try{_checkFileSize(e.size)}catch(t){return _handleFileError(e,t.message)}const t={type:e.type,size:_getFileSize(e.size),name:e.name,content:""},i=_getFileExtension(e.name),a=["txt","json","xprjson","xml","svg","html","css","js","ts","md","csv"],d=[];if(i&&["","application/json"].includes(t.type)&&(t.type=i),"zip"===i)try{const i=await JSZip.loadAsync(e);for(const e in i.files){const t=i.files[e];if(t.dir)continue;const n=_getFileExtension(e);if(!(t._data.uncompressedSize>73400320))if(n&&a.includes(n)){const i=await t.async("string");d.push({name:e,content:_processTextFile(n,i)})}else{const i=await t.async("uint8array");d.push({name:e,content:_processBinaryFile(i)})}}t.content=d,modelsHiddenParams[idInstance].outputFile=t,updateDataNodeFileFromWidget(idInstance,t)}catch(t){return _handleFileError(e,t)}else{const a=new FileReader;a.addEventListener("load",(function(e){const a=e.target.result;if(a instanceof ArrayBuffer)t.content=_processBinaryFile(a),t.isBinary=!0;else{const e=_processTextFile(i,a);t.content=e,t.isBinary=!1}modelsHiddenParams[idInstance].outputFile=t,updateDataNodeFileFromWidget(idInstance,t)})),modelsParameters[idInstance].binaryFileInput?a.readAsArrayBuffer(e):a.readAsText(e)}},this.rescale=function(){this.render()},this.render=function(){const e=document.createElement("div");e.setAttribute("id","load-file-widget-html"+idWidget),_.isUndefined(modelsParameters[idInstance].displayBrowseButton)&&(modelsParameters[idInstance].displayBrowseButton=!0),modelsParameters[idInstance].displayBorder?e.setAttribute("class","load-file-widget-html load-file-widget-html--border"):e.setAttribute("class","load-file-widget-html");let t="";if(modelsParameters[idInstance].displayLabel){const e=this.getTransformedText("label");t+='<div id="load-file-label'+idWidget+'" class="label-wrapper" style="'+this.labelFontSize()+this.labelColor()+this.labelFontFamily()+" text-align: "+modelsParameters[idInstance].labelAlign+'">',t+="<p>"+e+"</p>",t+="</div>"}if(t+='<div id="drag-area'+idWidget+'" class="drag-area">',t+='<div id="drag-area-icon'+idWidget+'" class="drag-area__icon-wrapper">',t+='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor">\n          <path d="M28.992 21.44c-0.704-0.512-1.536-0.768-2.176-0.896v-10.752c0-0.192-0.064-0.32-0.192-0.448l-8.512-8.448c-0.128-0.128-0.256-0.192-0.448-0.192h-11.84c-0.32 0-0.64 0.256-0.64 0.64v29.312c0 0.32 0.256 0.576 0.64 0.576h20.352c0.32 0 0.64-0.256 0.64-0.576v-2.624h0.704c0.512 0 1.344-0.192 1.984-0.768 0.704-0.576 1.152-1.472 1.152-2.88-0.064-1.344-0.768-2.368-1.664-2.944zM24.704 9.088h-6.912v-6.912l6.912 6.912zM25.664 30.208h-19.392v-28.352h10.432v7.68c0 0.32 0.256 0.576 0.64 0.576h8.32v7.872c-0.064-0.064-0.064-0.128-0.128-0.192-0.896-1.28-2.432-2.368-4.992-2.368-3.712 0-5.44 2.048-6.016 3.456-2.624 0.192-4.864 1.92-4.864 4.352s1.792 4.736 4.8 4.736h11.2v2.24zM28.736 26.496c-0.448 0.384-0.96 0.512-1.28 0.512h-12.928c-2.368 0-3.712-1.792-3.712-3.712 0-1.728 1.792-3.264 4.16-3.264 0.256 0 0.512-0.192 0.576-0.448 0.256-0.96 1.6-3.008 5.056-3.008 2.112 0 3.392 0.896 4.096 1.92 0.768 1.024 0.96 2.176 0.96 2.496 0 0.064 0 0.128 0.064 0.192 0.064 0.192 0.256 0.384 0.512 0.384 0.192 0 0.384 0.064 0.576 0.128 0.512 0.128 1.088 0.32 1.6 0.64 0.704 0.448 1.152 1.152 1.152 2.112-0.064 1.088-0.384 1.728-0.832 2.048z"></path>\n          <path d="M20.992 19.712c-0.192-0.192-0.576-0.192-0.768 0l-2.048 2.048c-0.192 0.192-0.192 0.576 0 0.768s0.576 0.192 0.768 0l1.088-1.088v3.648c0 0.32 0.256 0.576 0.576 0.576s0.512-0.256 0.512-0.576v-3.648l1.088 1.088c0.192 0.192 0.576 0.192 0.768 0s0.192-0.576 0-0.768l-1.984-2.048z"></path>\n        </svg>',t+="</div>",t+='<div id="drag-area-text'+idWidget+'" class="drag-area__text-wrapper">',t+='<span style="'+this.labelFontFamily()+this.textSize()+this.textColor()+'">Drag & drop file here</span>',t+='<span style="'+this.labelFontFamily()+this.textSize()+this.subTextColor()+'">Limit 100MB per file</span>',t+="</div>",modelsParameters[idInstance].displayBrowseButton&&(t+='<div id="browse-btn'+idWidget+'" class="drag-area__browse-btn-wrapper">',t+='<input type="file" name="file" id="browse-btn-input'+idWidget+'_select_file" />',t+='<label id="browse-btn-label'+idWidget+'" style="'+this.labelFontFamily()+this.textSize()+this.browseButtonTextColor()+'" for="browse-btn-input'+idWidget+'_select_file">Browse files</label>',t+="</div>",t+="</div>"),e.innerHTML=t,$("#"+idDivContainer).html(e),document.styleSheets[0].addRule("#drag-area"+idWidget," background-color: "+modelsParameters[idInstance].backgroundColor),document.styleSheets[0].addRule("#load-file-widget-html"+idWidget," border-color: "+modelsParameters[idInstance].borderColor),document.styleSheets[0].addRule("#load-file-widget-html"+idWidget," background-color: "+modelsParameters[idInstance].labelBackgroundColor),document.styleSheets[0].addRule("#browse-btn-label"+idWidget,this.browseButtonDefaultColor()),document.styleSheets[0].addRule("#browse-btn-label"+idWidget+":hover",this.browseButtonHoverColor()),document.styleSheets[0].addRule("#browse-btn-label"+idWidget+":active",this.browseButtonActiveColor()),this.addFileDiv=function(e,t){let i='<div id="loaded-file'+idWidget+'" class="loaded-file">';i+='<div class="loaded-file__icon-wrapper">',i+='<i class="fa fa-file" aria-hidden="true"></i>',i+="</div>",i+='<div class="loaded-file__info-file-wrapper">',i+='<span id="file-name-'+idWidget+'" title="'+e+'" class="loaded-file__info-file-wrapper__name" style="'+this.labelFontFamily()+this.textSize()+this.textColor()+'">'+e+"</span>",i+='<span id="file-size-'+idWidget+'" title="'+t+'" class="loaded-file__info-file-wrapper__size" style="'+this.labelFontFamily()+this.textSize()+this.subTextColor()+'">'+t+"</span>",i+="</div>",i+='<div id="close-file-btn'+idWidget+'" class="loaded-file__close-btn-wrapper">',i+='<i class="fa fa-times" aria-hidden="true"></i>',i+="</div>",i+="</div>",$("#load-file-widget-html"+idWidget).append(i),document.styleSheets[0].addRule("#close-file-btn"+idWidget+" > i",this.deleteButtonDefaultColor()),document.styleSheets[0].addRule("#close-file-btn"+idWidget+" > i:hover",this.deleteButtonHoverColor()),document.styleSheets[0].addRule("#close-file-btn"+idWidget+" > i:active",this.deleteButtonActiveColor()),document.styleSheets[0].addRule("#close-file-btn"+idWidget+" > i","color: "+modelsParameters[idInstance].deleteButtonIconColor),document.styleSheets[0].addRule("#close-file-btn"+idWidget+" > i:hover","color: "+modelsParameters[idInstance].deleteButtonIconHoverColor),$("#close-file-btn"+idWidget).on("click",(function(){$("#browse-btn-input"+idWidget+"_select_file").val(""),$("#loaded-file"+idWidget).remove(),delete modelsTempParams[idInstance].fileName,delete modelsTempParams[idInstance].fileSize,modelsHiddenParams[idInstance].outputFile={},updateDataNodeFileFromWidget(idInstance,{}),self.render()}))},_.isUndefined(modelsHiddenParams[idInstance].outputFile)||(_.isEmpty(modelsHiddenParams[idInstance].outputFile)?(updateDataNodeFileFromWidget(idInstance,{}),delete modelsTempParams[idInstance].fileName,delete modelsTempParams[idInstance].fileSize):updateDataNodeFileFromWidget(idInstance,modelsHiddenParams[idInstance].outputFile)),!_.isUndefined(modelsTempParams[idInstance].fileName)&&!_.isUndefined(modelsTempParams[idInstance].fileSize)){const e=modelsTempParams[idInstance].fileName,t=modelsTempParams[idInstance].fileSize;self.addFileDiv(e,t)}this.addSpinner=function(){const e=document.getElementById("load-file-widget-html"+idWidget),t=document.createElement("div"),i=document.createElement("i");t.setAttribute("id","icon-wrapper"+idWidget),t.setAttribute("class","load-spinner-wrapper"),i.setAttribute("class","fa fa-spinner fa-spin load-spinner-wrapper__icon"),t.append(i),e.append(t)},this.removeSpinner=function(){document.getElementById("icon-wrapper"+idWidget).remove()},this.readFileEvent=async function(e){this.addSpinner();let t={};"change"==e.type?t=e.target.files[0]:"drop"==e.type&&(t=e.originalEvent.dataTransfer.files[0]);if(-1!=await self.readFile(t)){const e=t.name,i=_getFileSize(t.size);modelsTempParams[idInstance].fileName=e,modelsTempParams[idInstance].fileSize=i,$("#loaded-file"+idWidget).length?($("#file-name-"+idWidget).text(e),$("#file-size-"+idWidget).text(i)):self.addFileDiv(e,i)}this.removeSpinner()},this.displayFile=(modelsTempParams[idInstance].counter=0,$("#drag-area"+idWidget).on("dragenter",(function(e){e.preventDefault(),e.stopPropagation(),modelsTempParams[idInstance].counter++,$("#drag-area"+idWidget).css({opacity:".5"})})),$("#drag-area"+idWidget).on("dragover",(function(e){e.preventDefault(),e.stopPropagation()})),$("#drag-area"+idWidget).on("dragleave",(function(e){e.preventDefault(),e.stopPropagation(),modelsTempParams[idInstance].counter--,0===modelsTempParams[idInstance].counter&&$("#drag-area"+idWidget).css({opacity:""})})),$("#drag-area"+idWidget).on("drop",(function(e){$("#drag-area"+idWidget).css({opacity:""}),e.originalEvent.dataTransfer&&e.originalEvent.dataTransfer.files.length&&(e.preventDefault(),e.stopPropagation(),self.readFileEvent(e))})),void $("#browse-btn-input"+idWidget+"_select_file").on("change",(function(e){self.readFileEvent(e)})));const i=document.getElementById(idDivContainer),a=i.clientWidth,d=a<290,n=a<240,l=document.getElementById("drag-area"+idWidget),o=document.getElementById("drag-area-text"+idWidget),s=document.getElementById("drag-area-icon"+idWidget);if(this.updateWidgetContent=function(){d?document.styleSheets[0].addRule(`#loaded-file${idWidget} .loaded-file__icon-wrapper`,"display: none"):document.styleSheets[0].addRule(`#loaded-file${idWidget} .loaded-file__icon-wrapper`,"display: block"),s.classList.toggle("drag-area__icon-wrapper--hidden",d),l.classList.toggle("drag-area--column",n),o.children[0].textContent=n?"Drag & Drop":"Drag & drop file here",o.children[1].classList.toggle("drag-area__text-wrapper__span--hidden",n)},bInteractive)this.updateWidgetContent();else{new ResizeObserver(()=>{this.updateWidgetContent()}).observe(i)}};const _OUTPUT_DESCRIPTOR=new WidgetActuatorDescription("outputFile","File content",WidgetActuatorDescription.FILE);this.getActuatorDescriptions=function(){return[_OUTPUT_DESCRIPTOR]},this.outputFile={updateCallback:function(){},setValue:function(e){},getValue:function(){return modelsHiddenParams[idInstance].outputFile},addValueChangedHandler:function(e){this.updateCallback=e,self.enable()},removeValueChangedHandler:function(e){self.disable()},setCaption:function(e,t){modelsParameters[idInstance].inheritLabelFromData&&(self.captionHelper(e,self.bIsInteractive,t),self.render())},clearCaption:function(){modelsParameters[idInstance].label="",self.render()}},self.render()},this.loadFileWidget.prototype=baseWidget.prototype,this.pluginDefinition={name:"loadFile",widgetsDefinitionList:{loadFile:{factory:"loadFileWidget",title:"Load file",icn:"load-file",help:"wdg/wdg-basics/#load-file"}}},this.constructor()}modelsHiddenParams.loadFile={outputFile:""},modelsParameters.loadFile={label:"Choose a file",displayLabel:!0,labelFontSize:.1,labelColor:"var(--widget-label-color)",labelFontFamily:"var(--widget-font-family)",labelAlign:"left",textColor:"var(--widget-color)",subTextColor:"var(--widget-color)",textSize:.1,binaryFileInput:!1,displayBorder:!0,borderColor:"var(--widget-border-color)",backgroundColor:"var(--widget-dropzone-background-color)",displayBrowseButton:!0,labelBackgroundColor:"var(--widget-dropzone-label-background-color)",browseButtonTextColor:"var(--widget-button-text)",browseButtonDefaultColor:"var(--widget-button-color)",browseButtonActiveColor:"var(--widget-button-active-color)",browseButtonHoverColor:"var(--widget-button-hover-color)",deleteButtonDefaultColor:"var(--widget-delete-button-default-color)",deleteButtonActiveColor:"var(--widget-delete-button-active-color)",deleteButtonHoverColor:"var(--widget-delete-button-hover-color)",deleteButtonIconColor:"var(--widget-delete-button-icon-color)",deleteButtonIconHoverColor:"var(--widget-delete-button-icon-hover-color)"},modelsLayout.loadFile={height:"15vh",width:"20vw",minWidth:"95px",minHeight:"70px"},loadFileWidgetsPluginClass.prototype=basePlugin.prototype;var loadFileWidgetsPlugin=new loadFileWidgetsPluginClass;widgetsPluginsHandler.loadWidgetPlugin(loadFileWidgetsPlugin);
function getLedSvg(t,e,i){var a="#008400",r="#00b700";switch(t){case"off":a=modelsParameters[i].offColor;var o=w3color(a);o.darker(5),r=o.toHexString();break;case"on":r=modelsParameters[i].onColor;var s=w3color(r);s.darker(10),a=s.toHexString();break;case"inactive":a="#e6e6e6",r="#a6a6a6"}return'<svg xmlns="http://www.w3.org/2000/svg" xmlns: xlink="http://www.w3.org/1999/xlink" viewBox="-1 -1 51 51"  preserveAspectRatio="xMinYMin meet" class="svg-content"><title>LED '+t+'</title><defs><linearGradient y2="0.154336" y1="1.1441" xlink: href="#linearGradient6506_'+e+'" x2="0.566583" x1="0.577235" id="linearGradient6650_'+e+'"/><linearGradient y2="0.846351" y1="0.057496" xlink: href="#linearGradient5756_'+e+'" x2="0.609143" x1="0.532859" id="linearGradient6646_'+e+'"/><linearGradient y2="1" y1="0.019227" xlink: href="#linearGradient5742_'+e+'" x2="0.500488" x1="0.496181" id="linearGradient6644_'+e+'"/><linearGradient id="linearGradient6506_'+e+'"><stop stop-color="#ffffff" stop-opacity="0" offset="0" id="stop6508_'+e+'" /><stop stop-color="#ffffff" stop-opacity="0.87451" offset="1" id="stop6510_'+e+'" /></linearGradient><linearGradient id="linearGradient5756_'+e+'"><stop stop-color="#828282" offset="0" id="stop5758_'+e+'" /><stop stop-color="#929292" stop-opacity="0.352941" offset="1" id="stop5760_'+e+'" /></linearGradient><linearGradient id="linearGradient5742_'+e+'"><stop stop-color="#adadad" offset="0" id="stop5744_'+e+'" /><stop stop-color="#f0f0f0" offset="1" id="stop5746_'+e+'" /></linearGradient><linearGradient y2="0.553776" x2="0.632943" y1="1" x1="1" id="svg_1_'+e+'"><stop offset="0" stop-opacity="0.984375" stop-color="'+a+'" /><stop offset="0.984505" stop-opacity="0.980469" stop-color="'+r+'" /></linearGradient></defs><g><title>Layer 1</title><g id="layer1_'+e+'"><g transform="matrix(31.25, 0, 0, 31.25, -625.023, -1325)" id="g9447_'+e+'"><path fill="url(#linearGradient6644_'+e+')" stroke-width="0.8" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="4" id="path6596_'+e+'" d="m21.60074,43.19165c0,0.441601 -0.3584,0.799999 -0.800001,0.799999c-0.441599,0 -0.799999,-0.358398 -0.799999,-0.799999c0,-0.441601 0.3584,-0.799999 0.799999,-0.799999c0.441601,0 0.800001,0.358398 0.800001,0.799999z" /><path fill="url(#linearGradient6646_'+e+')" stroke-width="0.8" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="4" id="path6598_'+e+'" d="m21.44627,43.191471c0,0.35638 -0.28924,0.645618 -0.64562,0.645618c-0.35638,0 -0.64562,-0.289238 -0.64562,-0.645618c0,-0.35638 0.28924,-0.645611 0.64562,-0.645611c0.35638,0 0.64562,0.28923 0.64562,0.645611z" /><path fill="url(#svg_1_'+e+')" stroke-width="0.8" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="4" id="path6600_'+e+'" d="m21.378719,43.191639c0,0.31905 -0.25893,0.577991 -0.57798,0.577991c-0.31905,0 -0.57799,-0.258942 -0.57799,-0.577991c0,-0.319038 0.25894,-0.577969 0.57799,-0.577969c0.31905,0 0.57798,0.25893 0.57798,0.577969z" /><path transform="rotate(-34.3336, 20.5508, 42.8652)" fill="url(#linearGradient6650_'+e+')" stroke-width="0.8" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="4" id="path6602_'+e+'" d="m20.7453,42.86636c0,0.065899 -0.087271,0.11937 -0.194811,0.11937c-0.107529,0 -0.194809,-0.053471 -0.194809,-0.11937c0,-0.06588 0.08728,-0.119358 0.194809,-0.119358c0.10754,0 0.194811,0.053478 0.194811,0.119358z" /></g></g></g></svg>'}function ledWidgetsPluginClass(){this.statusLedWidget=function(t,e,i,a){this.constructor(t,e,i,a);var r=this;this.enable=function(){},this.disable=function(){},this.backwardCompatibility=function(){modelsParameters[i].redAtStateOff&&delete modelsParameters[i].redAtStateOff,_.isUndefined(modelsParameters[i].onColor)&&(modelsParameters[i].onColor="#00b700"),_.isUndefined(modelsParameters[i].offColor)&&(modelsParameters[i].offColor="#004d00")},this.backwardCompatibility(),this.insertLabel=function(t){const a=this.getTransformedText("label"),r=$("<span>",{class:"led-span",id:"led-span"+e,html:a});let o="height: inherit; "+this.labelFontSize()+this.labelColor()+this.labelFontFamily();_.isUndefined(modelsParameters[i].labelWidthProportion)?o+=" width: 20%; ":o+=modelsParameters[i].labelWidthProportion+"; ",r.attr("style",o),t.append(r[0])},this.rescale=function(){this.render()},this.render=function(){var a,o=document.createElement("div");a=this.bIsInteractive?modelsHiddenParams[i].status?"on":"off":"inactive";var s=1;modelsParameters[i].displayLabel&&(s=(100-Number(modelsParameters[i].labelWidthProportion.replace("%","")))/100);var n=0,l=0;$("#"+t).width()*s>$("#"+t).height()?n=$("#"+t).height()-2:(n=$("#"+t).width()*s-2,l=($("#"+t).height()-n-2)/2),o.setAttribute("class","led-widget-html"),o.setAttribute("style","height: inherit");var d=document.createElement("div");d.setAttribute("class","svg-container"),d.setAttribute("style","display: inline-block; margin-top: "+l+"px; cursor: inherit; width:"+n+"px; height: "+n+"px");var c=getLedSvg(a,e,i);d.innerHTML=c,o.appendChild(d),modelsParameters[i].displayLabel&&this.insertLabel(o),$("#"+t).html(o),this.bIsInteractive?r.enable():r.disable()};const o=new WidgetActuatorDescription("status","Current status (boolean)",WidgetActuatorDescription.READ,WidgetPrototypesManager.SCHEMA_BOOLEAN);this.getActuatorDescriptions=function(){return[o]},this.status={updateCallback:function(){},setValue:function(t){t!=modelsHiddenParams[i].status&&(modelsHiddenParams[i].status=t,r.render())},getValue:function(){return modelsHiddenParams[i]},addValueChangedHandler:function(t){this.updateCallback=t,r.enable()},removeValueChangedHandler:function(t){r.disable()},setCaption:function(t,e){modelsParameters[i].inheritLabelFromData&&r.captionHelper(t,r.bIsInteractive,e)},clearCaption:function(){modelsParameters[i].label="",r.render()}},r.render()},this.statusLedWidget.prototype=baseWidget.prototype,this.pluginDefinition={name:"led",widgetsDefinitionList:{ledStatus:{factory:"statusLedWidget",title:"Status led",icn:"status"}}},this.constructor()}modelsHiddenParams.ledStatus={status:!1},modelsParameters.ledStatus={label:"labelText",inheritLabelFromData:!0,displayLabel:!0,labelFontSize:.5,labelColor:"var(--widget-label-color)",labelFontFamily:"var(--widget-font-family)",labelWidthProportion:"60%",onColor:"#00b700",offColor:"#004d00"},modelsLayout.ledStatus={height:"10vh",width:"10vw",minWidth:"40px",minHeight:"40px"},ledWidgetsPluginClass.prototype=basePlugin.prototype;var ledWidgetsPlugin=new ledWidgetsPluginClass;widgetsPluginsHandler.loadWidgetPlugin(ledWidgetsPlugin);
function annotationWidgetsPluginClass(){this.iconInfoAnnotationWidget=function(e,t,i,a){this.constructor(e,t,i,a);var n=this;this.enable=function(){},this.disable=function(){},this.rescale=function(){this.render()},this.render=function(){var a=20;_.isNull($(".icons").height())||(a=$(".icons").height()),_.isNull($(".icons").width())||$(".icons").width();var n=$("#"+e).height(),o=$("#"+e).width(),r=modelsParameters[i].iconSize*a,s=(n-a*modelsParameters[i].iconSize)/2,d=document.createElement("div"),l='<i class="fa fa-'+modelsParameters[i].iconSign+'" style="line-height:normal;zoom:'+modelsParameters[i].iconSize+'"></i>';d.innerHTML=l,d.setAttribute("class","btn"),d.setAttribute("id","annotationiconInfo"+t),d.setAttribute("style","width: "+o+"px; height:"+n+"px; cursor: pointer; margin: auto; color:"+modelsParameters[i].iconColor+"; line-height:"+r+"px;padding-top: "+s+"px; "),$("#"+e).html(d);const c=this.getTransformedText("text");$("#annotationiconInfo"+t).bt(c,{fill:this.tipBackgroundColor(),cssStyles:{color:modelsParameters[i].textColor,fontWeight:modelsParameters[i].fontWeight,fontSize:modelsParameters[i].fontSize,fontFamily:modelsParameters[i].fontFamily},width:modelsParameters[i].tipWidth,shrinkToFit:!0,padding:modelsParameters[i].textPadding,cornerRadius:modelsParameters[i].cornerRadius,spikeLength:modelsParameters[i].spikeLength,spikeGirth:modelsParameters[i].spikeGirth,strokeStyle:this.tipBorderColor(),shadowColor:"rgba(0,0,0,.9)",positions:modelsParameters[i].tipPositions,trigger:modelsParameters[i].tipEventTrigger})};const o=new WidgetActuatorDescription("value","Hover text of the icon",WidgetActuatorDescription.READ,WidgetPrototypesManager.SCHEMA_STRING);this.getActuatorDescriptions=function(e=null){const t=e||modelsParameters[i];return t&&t.enableActuator?[o]:[]},this.value={setValue:function(e){modelsParameters[i].text=e,$("#annotationiconInfo"+t)[0].value=e},getValue:function(){return $("#annotationiconInfo"+t)[0].value},addValueChangedHandler:function(e){n.enable()},removeValueChangedHandler:function(e){n.disable()}},n.render()},this.iconInfoAnnotationWidget.prototype=baseWidget.prototype,this.labelAnnotationWidget=function(e,t,i,a){this.constructor(e,t,i,a);var n=this;_.isUndefined(modelsParameters[i].textAlign)&&(modelsParameters[i].textAlign="left"),this.enable=function(){},this.disable=function(){},this.rescale=function(){this.render()},_.isUndefined(modelsParameters[i].centerVertically)&&(modelsParameters[i].centerVertically=!0),this.render=function(){var a=document.createElement("div"),n="table",o="table-cell";if(!modelsParameters[i].centerVertically)n="flex",o="table";const r=this.getTransformedText("text");var s='<div id="annotationLabelTextArea'+t+'" style="max-width: 2000px; background-color: transparent;  box-shadow: none; width: inherit;  height: inherit; white-space: pre-wrap; color:'+modelsParameters[i].textColor+"; text-align: "+modelsParameters[i].textAlign+"; background-color: "+modelsParameters[i].backgroundColor+"; padding: 4px; resize: inherit; margin: auto; vertical-align: middle ; border-radius: 6px; "+this.fontSize()+this.valueFontFamily()+this.border()+"display: "+o+'" readonly>'+r+"</textarea>";a.innerHTML=s,a.setAttribute("style","width: inherit; height: inherit; display: "+n+"; justify-content: center;"),$("#"+e).html(a)};const o=new WidgetActuatorDescription("value","Label text",WidgetActuatorDescription.READ,WidgetPrototypesManager.SCHEMA_ANY_PRIMITIVE);this.getActuatorDescriptions=function(e=null){const t=e||modelsParameters[i];return t&&t.enableActuator?[o]:[]},this.value={setValue:function(e){modelsParameters[i].text=e,$("#annotationLabelTextArea"+t)[0].value=e},getValue:function(){return $("#annotationLabelTextArea"+t)[0].value},addValueChangedHandler:function(e){n.enable()},removeValueChangedHandler:function(e){n.disable()}},n.render()},this.labelAnnotationWidget.prototype=baseWidget.prototype,this.imageAnnotationWidget=function(e,t,i,a){this.constructor(e,t,i,a);var n=this;if(_.isUndefined(modelsHiddenParams[i].ratio)){var o=$("#"+e),r=o.width(),s=o.height();modelsHiddenParams[i].ratio=r/s}this.enable=function(){},this.disable=function(){},this.renderOriginalSize=function(){var a=modelsHiddenParams[i].widthPx,n=modelsHiddenParams[i].heightPx,o=$("#"+i);o.width(unitW(a+2)),o.height(unitH(n+2));var r=$("#"+e);r.width(unitW(a)),r.height(unitH(n)),r.css("left","0px"),r.css("top","0px"),r.css("position","absolute"),$("#imgContainer"+t).attr("style","width: "+unitW(a)+"; height: "+unitH(n)+";")},this.rescale=function(){this.render()},this.render=function(){var a=document.createElement("div");a.setAttribute("style","width: inherit; height: inherit; margin: auto; position: absolute; top: 0; left: 0"),a.setAttribute("id","imgContainer"+t);var o="";if(""!=modelsHiddenParams[i].fileContentBase64){o=o+'<img id="img'+t+'" style="position: relative;';var r=$("#"+e);o+="width: inherit; height: inherit; ",modelsParameters[i].keepRatio?o+="object-fit: contain; ":o+="object-fit: fill; ",r.width(inheritWcWidthFromIdInst(i)),r.height(inheritWcHeightFromIdInst(i)),r.css("left","0px"),r.css("top","0px"),r.css("position","absolute"),a.setAttribute("style","width: inherit; height: inherit; margin: auto;"),n.bIsInteractive||(o+=" opacity: 0.75"),o=o+'" src="data:'+modelsHiddenParams[i].mimeType+";base64,"+modelsHiddenParams[i].fileContentBase64+'">',o+="</img>"}if(!n.bIsInteractive&&!modelsParameters[i].hideImageURL){o=(o=o+'<div id="image_drop_zone'+t+'" style="z-index: 1000000; position: absolute; display: table; top: 20px; left:20px; height: calc(100%-40px); width: calc(100%-40px)">')+'<div id="image_drop_zone_new'+t+'" style="; cursor: pointer; display: table-cell; vertical-align: middle"><a><center id="image_import_handle'+t+'">Click here to import your image file</center></a></div>',o+="</div>";var s=document.getElementById("_otherUse"),d='<input type="file" id="image-file'+t+'" name="files[]" accept=".jpg,.jpeg,.png,.gif" style="padding-bottom: 15px; display: none" required="">';s.insertAdjacentHTML("beforeend",d)}(a.innerHTML=o,$("#"+e).html(a),n.bIsInteractive||modelsParameters[i].hideImageURL)||document.getElementById("image_import_handle"+t).addEventListener("click",(function(e){return e.stopPropagation(),document.getElementById("image-file"+t).addEventListener("change",(function(e){e.stopPropagation();var t=new FileReader;return t.addEventListener("load",(function(e){e.stopPropagation();var t=e.target;modelsHiddenParams[i].mimeType=getRealMimeType(t.result),modelsHiddenParams[i].fileContentBase64=encodeURIComponent(base64ArrayBuffer(t.result));var a=new Image;return a.onload=function(){modelsHiddenParams[i].widthPx=a.width,modelsHiddenParams[i].heightPx=a.height,modelsHiddenParams[i].ratio=a.width/a.height,n.renderOriginalSize()},a.src="data:"+modelsHiddenParams[i].mimeType+";base64,"+modelsHiddenParams[i].fileContentBase64,n.render(),!1}),!1),t.readAsArrayBuffer(e.target.files[0]),modelsParameters[i].hideImageURL=!0,!1}),!1),$("#image-file"+t).trigger("click"),!1}),!0)};const d=new WidgetActuatorDescription("base64Image","Image encoded as a data URL",WidgetActuatorDescription.READ,{$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:imageAnnotationWidget",type:"string",pattern:'^data:image/([a-zA-Z]*);base64,([^"]*)$'});this.getActuatorDescriptions=function(e=null){const t=e||modelsParameters[i];return t&&t.enableActuator?[d]:[]},this.base64Image={setValue:function(e){if(""!=e){var t=new RegExp('^data:image/([a-zA-Z]*);base64,([^"]*)$').exec(e);null==t||3!=t.length?modelsHiddenParams[i].fileContentBase64=e:(modelsHiddenParams[i].mimeType=t[1],modelsHiddenParams[i].fileContentBase64=t[2]),n.render()}},getValue:function(){return modelsHiddenParams[i].fileContentBase64},addValueChangedHandler:function(e){n.enable()},removeValueChangedHandler:function(e){n.disable()}},n.render()},this.imageAnnotationWidget.prototype=baseWidget.prototype,this.videoAnnotationWidget=function(e,t,i,a){this.constructor(e,t,i,a);var n=this;n.showCropBar=!1,n.cropPercentage=100;const o="btn btn-xs btn-block btn-primary "+i+"widgetCustomColor",r="btn btn-xs btn-block btn-primary disabled "+i+"widgetCustomColor";this.enable=function(){$("#video-capture-button-"+t).attr("class",o),$("#video-crop-button-"+t).attr("class",o),$("#video-screenshot-button-"+t).attr("class",o)},this.disable=function(){$("#video-capture-button-"+t).attr("class",r),$("#video-crop-button-"+t).attr("class",r),$("#video-screenshot-button-"+t).attr("class",r)},this.placeCanvas=function(){if(n.canvas&&n.video){const e=n.video.videoWidth,t=n.video.videoHeight,i=n.video.clientWidth,a=n.video.clientHeight;if(e&&t&&i&&a){const o=e/t;let r=Math.round(o*a),s=a;r>i&&(r=i,s=Math.min(a,Math.round(i/o)));const d=Math.round((i-r)/2),l=Math.round((a-s)/2);n.canvas.style.left=d.toString()+"px",n.canvas.style.top=l.toString()+"px"}}},this.handleSuccess=function(e){n.video.srcObject=e,n.video.addEventListener("loadeddata",(function(){n.canvas.width=n.video.videoWidth,n.canvas.height=n.video.videoHeight,n.drawCanvas(),n.placeCanvas()}))},this.handleError=function(e){swal("Annotation Video Widget","navigator.getUserMedia error: "+e,"error")},this.toggleCrop=function(){n.showCropBar=!n.showCropBar,$("#video-crop-button-"+t).toggleClass(i+"widgetCustomColor"),$("#video-crop-button-"+t).toggleClass("btn-warning"),n.showCropBar?$("#cropbar"+t).show():$("#cropbar"+t).hide(),n.drawCanvas(),n.placeCanvas()},this.captureWindow=function(){const e=n.canvas.width,t=n.canvas.height;let i=e,a=t,o=n.ratio;if(!o){if(!n.showCropBar||100===n.cropPercentage)return{x:0,y:0,width:i,height:a};o=e/t}i=Math.round(o*a),i>e&&(i=e,a=i/o),n.showCropBar&&100!==n.cropPercentage&&(i=i*n.cropPercentage/100,a=a*n.cropPercentage/100),i=Math.min(Math.round(i),e),a=Math.min(Math.round(a),t),i=Math.max(1,i),a=Math.max(1,a);return{x:Math.round((e-i)/2),y:Math.round((t-a)/2),width:i,height:a}},this.drawCanvas=function(){const e=n.canvas.width,t=n.canvas.height,i=n.canvas.getContext("2d");if(i.clearRect(0,0,e,t),this.bIsInteractive&&n.video.srcObject&&(n.showCropBar||n.ratio)){const e=n.captureWindow();i.globalAlpha=.6,i.strokeStyle="#FFFF00",i.lineWidth=3,i.strokeRect(e.x,e.y,e.width,e.height)}},this.screenshot=function(){const e=n.captureWindow(),t=document.createElement("canvas");t.width=e.width,t.height=e.height;t.getContext("2d").drawImage(n.video,e.x,e.y,e.width,e.height,0,0,e.width,e.height);const a=t.toDataURL("image/jpeg");modelsHiddenParams[i].screenshotBase64=a,modelsHiddenParams[i].screenshotMimeType="image/jpeg",modelsHiddenParams[i].screenshotData=a.replace("data:image/jpeg;base64,","")},this.handleSliderColors=function(){var e="#slider-crop"+t;$(e).find("div").css("background-color",modelsParameters[i].buttonDefaultColor),$(e).find("a").css("background-color",modelsParameters[i].buttonActiveColor),$(e).find("a").hover((function(){$(this).css("background-color",modelsParameters[i].buttonHoverColor)}),(function(){$(this).css("background-color",modelsParameters[i].buttonActiveColor)}))},this.rescale=function(){this.render()},this.render=function(){const a=document.createElement("div");let o="border: 1px solid black; ";this.bIsInteractive||(o+="background-color: lightgrey; opacity: 0.2 "),videoHeightPx=$("#"+e).height()-45;let r='<div id="videoContainer'+t+'" style="text-align: center; align: center; width: inherit; height: inherit;">';if(r+='<div style="display: flex;">',r=r+'<div style="margin: 0 auto; position: relative; height: '+(videoHeightPx+2)+"px; "+o+'; flex: 100%;">',r=r+'<video id="video'+t+'" class="videostream" style="position: absolute; top: 0; left: 0;" width="100%" height="'+videoHeightPx+'px" autoplay></video>',r=r+'<canvas id="canvas'+t+'" style="max-width: 100%; max-height: 100%; position: absolute; top: 0; left: 0; z-index: 10;"></canvas>',r+="</div>",r=r+'<div id="cropbar'+t+'" style="flex: 5px;" hidden><div class="v-slider-div-div" id="slider-crop'+t+'" style="height: '+(videoHeightPx+2)+'px;"></div></div>',r+="</div>",r+='<div style="display:table; width:100%"><div class="container"><div style="margin: 0px" class="row">',r=r+'<div class="col-3" style="padding: 1px"><button id="video-capture-button-'+t+'">start</button></div>',r=r+'<div class="col-6" style="padding: 1px"><button id="video-screenshot-button-'+t+'">screenshot</button></div>',r=r+'<div class="col-3" style="padding: 1px"><button id="video-crop-button-'+t+'">crop</button></div>',r+="</div></div></div></div>",a.innerHTML=r,a.setAttribute("style","width: inherit; height: inherit; text-align:center; align: center"),$("#"+e).html(a),this.setButtonColorStyle(),this.bIsInteractive?n.enable():n.disable(),$("#slider-crop"+t).slider({orientation:"vertical",range:"min",min:0,max:100,value:100,slide:function(e,t){n.cropPercentage=t.value,n.drawCanvas()}}),$("#cropbar"+t).hide(),this.handleSliderColors(),n.video=document.getElementById("video"+t),n.canvas=document.getElementById("canvas"+t),modelsParameters[i].enforceCaptureRatio?n.ratio=modelsParameters[i].captureRatio:n.ratio&&delete n.ratio,this.bIsInteractive){const e=document.getElementById("video-capture-button-"+t);e.onclick=function(){n.video.srcObject?n.video.paused?(n.video.play(),e.textContent="stop"):(n.video.pause(),e.textContent="start"):navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"},audio:!1}).then(t=>{n.handleSuccess(t),e.textContent="stop"}).catch(n.handleError)};document.getElementById("video-crop-button-"+t).onclick=function(){n.toggleCrop()};document.getElementById("video-screenshot-button-"+t).onclick=function(){_.isUndefined(n.video)||(modelsParameters[i].pauseOnCapture&&(n.video.pause(),e.textContent="start"),n.screenshot(),n.base64Image.updateCallback(n.base64Image,n.base64Image.getValue()),n.mimeType.updateCallback(n.mimeType,n.mimeType.getValue()),n.imageData.updateCallback(n.imageData,n.imageData.getValue()))}}};const s=new WidgetActuatorDescription("base64Image","Sceenshot as a data URL",WidgetActuatorDescription.WRITE,WidgetPrototypesManager.SCHEMA_STRING),d=new WidgetActuatorDescription("mimeType","MIME type of the screenshot",WidgetActuatorDescription.WRITE,WidgetPrototypesManager.SCHEMA_STRING),l=new WidgetActuatorDescription("imageData","Sceenshot image raw data encoded as base 64",WidgetActuatorDescription.WRITE,WidgetPrototypesManager.SCHEMA_STRING);this.getActuatorDescriptions=function(){return[s,d,l]},this.base64Image={updateCallback:function(){},setValue:function(e){},getValue:function(){return modelsHiddenParams[i].screenshotBase64},addValueChangedHandler:function(e){this.updateCallback=e,n.enable()},removeValueChangedHandler:function(e){n.disable()}},this.mimeType={updateCallback:function(){},setValue:function(e){},getValue:function(){return modelsHiddenParams[i].screenshotMimeType},addValueChangedHandler:function(e){this.updateCallback=e,n.enable()},removeValueChangedHandler:function(e){n.disable()}},this.imageData={updateCallback:function(){},setValue:function(e){},getValue:function(){return modelsHiddenParams[i].screenshotData},addValueChangedHandler:function(e){this.updateCallback=e,n.enable()},removeValueChangedHandler:function(e){n.disable()}},n.render()},this.videoAnnotationWidget.prototype=baseWidget.prototype,this.pluginDefinition={name:"annotation",widgetsDefinitionList:{annotationIconInfo:{factory:"iconInfoAnnotationWidget",title:"Info",icn:"info"},annotationLabel:{factory:"labelAnnotationWidget",title:"Label",icn:"label",help:"wdg/wdg-annotation-video/#label"},annotationImage:{factory:"imageAnnotationWidget",title:"Image",icn:"image",help:"wdg/wdg-annotation-video/#image"},annotationVideo:{factory:"videoAnnotationWidget",title:"Camera",icn:"camera",help:"wdg/wdg-annotation-video/#camera"}}},this.constructor()}modelsHiddenParams.annotationIconInfo={},modelsHiddenParams.annotationLabel={},modelsHiddenParams.annotationImage={fileContentBase64:"",mimeType:"",widthPx:100,heightPx:100,ratio:1},modelsHiddenParams.annotationVideo={screenshotBase64:"",screenshotMimeType:"",screenshotData:""},modelsParameters.annotationIconInfo={text:"Type texte",enableActuator:!1,fontSize:"medium",fontWeight:"bold",fontFamily:"var(--widget-font-family)",textColor:"var(--widget-button-text)",textPadding:10,tipBackgroundColor:"var(--widget-button-color)",tipBorderColor:"var(--widget-button-text)",tipWidth:200,tipPositions:["right"],tipEventTrigger:"hover",iconColor:"var(--widget-label-color)",iconSize:1,iconSign:"info-circle",cornerRadius:10,spikeLength:15,spikeGirth:5},modelsParameters.annotationLabel={text:"Type texte",enableActuator:!1,fontsize:.5,backgroundColor:"rgba(0, 0, 0, 0)",textColor:"var(--widget-label-color)",valueFontFamily:"var(--widget-font-family)",textAlign:"left",displayBorder:!1,borderColor:"var(--widget-border-color)",centerVertically:!0},modelsParameters.annotationImage={keepRatio:!0,hideImageURL:!1,enableActuator:!1},modelsParameters.annotationVideo={enforceCaptureRatio:!1,captureRatio:1,pauseOnCapture:!1,buttonTextColor:"var(--widget-button-text)",buttonDefaultColor:"var(--widget-button-color)",buttonActiveColor:"var(--widget-button-active-color)",buttonHoverColor:"var(--widget-button-active-color)"},modelsLayout.annotationIconInfo={height:"4vh",width:"2vw"},modelsLayout.annotationLabel={height:"5vh",width:"12vw",minWidth:"5px",minHeight:"5px"},modelsLayout.annotationImage={height:"20vh",width:"17vw"},modelsLayout.annotationVideo={height:"30vh",width:"20vw"},annotationWidgetsPluginClass.prototype=basePlugin.prototype;var annotationWidgetsPlugin=new annotationWidgetsPluginClass;widgetsPluginsHandler.loadWidgetPlugin(annotationWidgetsPlugin);
const USE_PLOTLY_VALIDATION=!0,colorway=["var(--widget-color-2)","var(--widget-color-5)","var(--widget-color-6)","var(--widget-color-7)"],textColor="var(--widget-color)",axisParams={title:"",tickfont:{color:textColor}},plotlyColorParams={paper_bgcolor:"rgba(0,0,0,0)",plot_bgcolor:"rgba(0,0,0,0)",colorway:colorway,legend:{font:{color:textColor}}},_SCHEMA_PLOTLY_DATA={$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:plotly_data",type:"array",items:{type:"object",properties:{type:{type:"string"}},required:["type"]}},_SCHEMA_PLOTLY_LAYOUT={$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:plotly_layout",type:"object"};modelsParameters.plotlyLine={numberOfAxis:1,layout:{title:"",xaxis:{title:"x",tickfont:{color:textColor}},yaxis:{title:"y",tickfont:{color:textColor}},paper_bgcolor:"rgba(0,0,0,0)",plot_bgcolor:"rgba(0,0,0,0)",colorway:colorway,legend:{font:{color:textColor}},showlegend:!0,margin:{l:50,r:50,b:100,t:100,pad:4}},hideModeBar:!1},modelsParameters.plotlyBar={numberOfAxis:1,layout:{title:"",barmode:"group",xaxis:{title:"x",tickfont:{color:textColor}},yaxis:{title:"y",tickfont:{color:textColor}},paper_bgcolor:"rgba(0,0,0,0)",plot_bgcolor:"rgba(0,0,0,0)",colorway:colorway,legend:{font:{color:textColor}},showlegend:!0,margin:{l:50,r:50,b:100,t:100,pad:4}},hideModeBar:!1},modelsParameters.plotlyPie={layout:{title:"",paper_bgcolor:"rgba(0,0,0,0)",plot_bgcolor:"rgba(0,0,0,0)",colorway:colorway,legend:{font:{color:textColor}},showlegend:!0,margin:{l:50,r:50,b:100,t:100,pad:4}},hideModeBar:!1},modelsParameters.plotly3dSurface={layout:{title:"",scene:{xaxis:{title:"x"},yaxis:{title:"y"},zaxis:{title:"z"}},paper_bgcolor:"rgba(0,0,0,0)",plot_bgcolor:"rgba(0,0,0,0)",showlegend:!0,margin:{l:50,r:50,b:100,t:100,pad:4}},hideModeBar:!1},modelsParameters.plotlyGeneric={hideModeBar:!1},modelsParameters.plotlyRealTime={hideModeBar:!1},modelsHiddenParams.plotlyLine={...modelsParameters.plotlyLine,data:[{type:"scatter",x:[0,1,2],y:[0,4,0],name:"trace 0"}],selection:[{}]},modelsHiddenParams.plotlyBar={...modelsParameters.plotlyBar,data:[{type:"bar",x:["first","second"],y:[1,2]}],selection:[{}]},modelsHiddenParams.plotlyPie={...modelsParameters.plotlyPie,data:[{type:"pie",labels:["half1","half2"],values:[.5,.5],sort:!1}],selection:[{}]},modelsHiddenParams.plotly3dSurface={...modelsParameters.plotly3dSurface,data:[{type:"surface",x:[1,2,3],y:[1,2,3],z:[[4,5,6],[16,19,20],[10,18,23]]}],selection:[{}]},modelsHiddenParams.plotlyRealTime={...modelsParameters.plotlyRealTime,data:[{y:[],mode:"lines"}],selection:[{}]},modelsHiddenParams.plotlyGeneric={data:[{}],layout:[{}],selection:[{}]},modelsTempParams.plotlyLine={lastEditTimeStamp:0,pngCache:""},modelsTempParams.plotlyBar={lastEditTimeStamp:0,pngCache:""},modelsTempParams.plotlyPie={lastEditTimeStamp:0,pngCache:""},modelsTempParams.plotly3dSurface={lastEditTimeStamp:0,pngCache:""},modelsTempParams.plotlyGeneric={lastEditTimeStamp:0,pngCache:""},modelsTempParams.plotlyRealTime={lastEditTimeStamp:0,pngCache:""},modelsLayout.plotlyLine={height:"30vh",width:"30vw",minWidth:"100px",minHeight:"100px"},modelsLayout.plotlyBar={height:"30vh",width:"30vw",minWidth:"100px",minHeight:"100px"},modelsLayout.plotlyPie={height:"30vh",width:"30vw",minWidth:"100px",minHeight:"100px"},modelsLayout.plotly3dSurface={height:"30vh",width:"30vw",minWidth:"378px",minHeight:"305px"},modelsLayout.plotlyGeneric={height:"30vh",width:"30vw",minWidth:"50px",minHeight:"32px"},modelsLayout.plotlyRealTime={height:"30vh",width:"30vw",minWidth:"100px",minHeight:"100px"};const _SCHEMA_PLOTLY_NUMERIC_DATA={$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:plotly_numeric_data",anyOf:[{type:"number"},{type:"array",items:{type:"number"}}]},_SCHEMA_PLOTLY_ANY_DATA={$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:plotly_any_data",anyOf:[{type:"string"},{type:"number"},{type:"boolean"},{type:"array",items:{anyOf:[{type:"string"},{type:"number"},{type:"boolean"}]}}]};function _createPlotlyAnyDataDescriptor(e){return new WidgetActuatorDescription(e,"Array of values to plot",WidgetActuatorDescription.READ,_SCHEMA_PLOTLY_ANY_DATA)}function _createPlotlyNumericDataDescriptor(e){return new WidgetActuatorDescription(e,"Array of numeric values to plot",WidgetActuatorDescription.READ,_SCHEMA_PLOTLY_NUMERIC_DATA)}function _isAxisLinear(e,t){return e&&e[t]&&"linear"===e[t].type}function plotlyWidgetsPluginClass(){var e=0;function t(e,t,a,o){this.bIsInteractive=o;var i="plotly"+t;o&&(i+="c");var r=this;_.isUndefined(modelsParameters[a].hideModeBar)&&(modelsParameters[a].hideModeBar=!1),this.getColorValueFromCSSProperty=function(e){var t=e;if(t.includes("var(--")){var a=e.substring(4,e.length-1);t=window.getComputedStyle(document.documentElement).getPropertyValue(a)}return t},this.checkNested=function(e,t,...a){return void 0!==e&&(!(0!=a.length||!e.hasOwnProperty(t))||this.checkNested(e[t],...a))},this.getTransformedText=function(e){if(e){if(!($("<div>").html(e).children().length>0)){e=(new DOMParser).parseFromString("<!doctype html><body>"+e,"text/html").body.textContent}}return e},this.render=function(){const t=modelsParameters[a].layout;if(_.isUndefined(t)||_.isUndefined(t.title)||(_.isUndefined(t.title.text)?t.title=this.getTransformedText(t.title):t.title.text=this.getTransformedText(t.title.text)),modelsHiddenParams[a].layout){let e=JSON.parse(JSON.stringify(modelsHiddenParams[a].layout));modelsHiddenParams[a].layout=e,modelsParameters[a].layout&&(e=JSON.parse(JSON.stringify(modelsParameters[a].layout))),this.checkNested(e,"colorway")&&(modelsHiddenParams[a].layout.colorway=e.colorway.map(e=>this.getColorValueFromCSSProperty(e))),["xaxis","yaxis","zaxis"].forEach(t=>{this.checkNested(e,t,"tickfont","color")&&(modelsHiddenParams[a].layout[t].tickfont.color=this.getColorValueFromCSSProperty(e[t].tickfont.color))}),this.checkNested(e,"legend","font","color")&&(modelsHiddenParams[a].layout.legend.font.color=this.getColorValueFromCSSProperty(e.legend.font.color)),this.checkNested(e,"paper_bgcolor")&&(modelsHiddenParams[a].layout.paper_bgcolor=this.getColorValueFromCSSProperty(e.paper_bgcolor)),this.checkNested(e,"plot_bgcolor")&&(modelsHiddenParams[a].layout.plot_bgcolor=this.getColorValueFromCSSProperty(e.plot_bgcolor))}if(this.bIsInteractive){$("#"+i).html(""),_.isUndefined(modelsHiddenParams[a].layout)||_.isNull(modelsHiddenParams[a].layout)||modelsHiddenParams[a].layout.autosize&&(delete modelsHiddenParams[a].layout.width,delete modelsHiddenParams[a].layout.height);var o={};modelsParameters[a].hideModeBar&&(o={displayModeBar:!1}),Plotly.newPlot(i,modelsHiddenParams[a].data,modelsHiddenParams[a].layout,o),this.setSelectionActuator()}else{$("#"+i).html(""),$("#"+i).html('<img id="png-export-'+i+'"></img>');var r,l=$("#png-export-"+i);const t=6e3;if(Date.now()-modelsTempParams[a].lastEditTimeStamp<t){l.attr("src",modelsTempParams[a].pngCache);var s=document.getElementById(e);return l[0].style.minHeight=parseInt(s.parentNode.style.minHeight)-3+"px",l[0].style.minWidth=parseInt(s.parentNode.style.minWidth)-3+"px",l[0].style.width=parseFloat(s.parentNode.style.width)-1+"vw",l[0].style.height=parseFloat(s.parentNode.style.height)-1+"vh",void(l[0].style.margin="3px")}Plotly.newPlot(i,modelsHiddenParams[a].data,modelsHiddenParams[a].layout).then((function(t){Plotly.toImage(t,{height:$("#"+e).height(),width:$("#"+e).width()}).then((function(e){r=e,Plotly.purge(t),l.attr("src",r),t.style.minHeight=t.parentNode.style.minHeight,t.style.minWidth=t.parentNode.style.minWidth,t.style.width=t.parentNode.style.width,t.style.height=t.parentNode.style.height,l[0].style.minHeight=parseInt(t.parentNode.style.minHeight)-3+"px",l[0].style.minWidth=parseInt(t.parentNode.style.minWidth)-3+"px",l[0].style.width=parseFloat(t.parentNode.style.width)-1+"vw",l[0].style.height=parseFloat(t.parentNode.style.height)-1+"vh",l[0].style.margin="3px",modelsTempParams[a].lastEditTimeStamp=Date.now(),modelsTempParams[a].pngCache=r}))}))}},this.setSelectionActuator=function(){this.bIsInteractive=o;var e="plotly"+t;if(o){e+="c";var a=document.getElementById(e);a.on("plotly_selected",(function(e){if(!_.isUndefined(e)){var t=Array(a.data.length).fill(null).map(()=>[]),o=Array(a.data.length).fill(null).map(()=>[]);e.points.forEach((function(e){if(!_.isUndefined(e.pointNumber)){var i=e.curveNumber,r=e.pointNumber;t[i].push(r),_.isUndefined(a.data[i].customdata)||o[i].push(a.data[i].customdata[r])}if(!_.isUndefined(e.pointNumbers)){i=e.pointNumbers.curveNumber;pointNumbers.forEach((function(e){t[i].push(e),_.isUndefined(a.data[i].customdata)||o[i].push(a.data[i].customdata[e])}))}}));var i=t.map((function(e,t){return{trace:t,selection:e,customdata:o[t]}}));r.selection.setValue(i),r.selection.updateCallback(r.selection,r.selection.getValue())}})),a.on("plotly_deselect",(function(){r.selection.setValue({range:{}}),r.selection.updateCallback(r.selection,r.selection.getValue())}))}},r.render(),this.getByName=function(e){if(this.hasOwnProperty(e))return this[e]},this.getInteractive=function(){return this.bIsInteractive},this.setInteractive=function(e){e!=this.bIsInteractive&&(this.bIsInteractive=e,this.render())},this.rescale=function(){this.bIsInteractive?Plotly.Plots.resize($("#"+i)[0]):this.render()}}this.createWidget=function(t,a,o,i){switch(function(e,t,a){var o=document.createElement("div"),i="plotly"+t;a&&(i+="c"),o.setAttribute("id",i),o.setAttribute("class","js-plotly-plot"),o.setAttribute("style","text-align:center; height: inherit; width: inherit; background-color: transparent"),$("#"+e).html(o)}(t,e+=1,i),a){case"plotlyLine":return new this.linePlotlyWidget(t,e,o,i);case"plotlyBar":return new this.barPlotlyWidget(t,e,o,i);case"plotlyPie":return new this.piePlotlyWidget(t,e,o,i);case"plotly3dSurface":return new this.d3surfacePlotlyWidget(t,e,o,i);case"plotlyGeneric":return new this.genericPlotlyWidget(t,e,o,i);case"plotlyRealTime":return new this.realTimePlotlyWidget(t,e,o,i)}},this.copyWidget=function(e,t,a,o,i){return this.createWidget(e,t,o,i)},this.clear=function(){e=0},this.linePlotlyWidget=function(e,t,a,o){this.constructor(e,t,a,o);var i=this;this.numberOfAxis=modelsParameters[a].numberOfAxis,_.isUndefined(modelsParameters[a].layout)||(modelsParameters[a].layout={...plotlyColorParams,...modelsParameters[a].layout},["xaxis","yaxis"].forEach(e=>{_.isUndefined(modelsParameters[a].layout[e])||(modelsParameters[a].layout[e]={...axisParams,...modelsParameters[a].layout[e]})})),modelsHiddenParams[a].data.length>this.numberOfAxis&&modelsHiddenParams[a].data.splice(this.numberOfAxis,modelsHiddenParams[a].data.length),this.getActuatorDescriptions=function(e=null){const t=e||modelsParameters[a],o=[t&&_isAxisLinear(t.layout,"xaxis")?_createPlotlyNumericDataDescriptor("x"):_createPlotlyAnyDataDescriptor("x")];if(t&&t.numberOfAxis){const e=_isAxisLinear(t.layout,"yaxis");for(let a=1;a<=t.numberOfAxis;a++){const t="y"+a;o.push(e?_createPlotlyNumericDataDescriptor(t):_createPlotlyAnyDataDescriptor(t))}}return o},this.x={setValue:function(e){if(_.isUndefined(e))swal("Invalid data value","value in x axis is undefined !","error");else{if(!Array.isArray(e)){if("number"!=typeof e&&"string"!=typeof e&&"bigint"!=typeof e)return void swal("Invalid data type","x axis must be an array !","error");e=[e],console.log("value in x axis is converted to an array.")}modelsHiddenParams[a].data[0].x=e,modelsHiddenParams[a].layout=modelsParameters[a].layout,i.render()}},getValue:function(){return modelsHiddenParams[a].data[0].x},addValueChangedHandler:function(e){},removeValueChangedHandler:function(e){},setCaption:function(e,t){modelsParameters[a].layout.xaxis.title=e,modelsHiddenParams[a].layout=modelsParameters[a].layout}};for(let e=1;e<=this.numberOfAxis;e++){const t="y"+e;e>1&&_.isUndefined(modelsHiddenParams[a].data[e-1])&&(modelsHiddenParams[a].data[e-1]={x:[],y:[],name:"caption "+(e-1)}),this[t]={index:e-1,setValue:function(e){const t=this.index+1;if(_.isUndefined(e))swal("Invalid data value","value in y"+t+" axis is undefined !","error");else{if(!Array.isArray(e)){if("number"!=typeof e&&"string"!=typeof e&&"bigint"!=typeof e)return void swal("Invalid data type","y"+t+" axis must be an array !","error");e=[e],console.log("value in y"+t+" axis is converted to an array.")}modelsHiddenParams[a].data[this.index].y=e,modelsHiddenParams[a].data[this.index].x=modelsHiddenParams[a].data[0].x,modelsHiddenParams[a].layout=modelsParameters[a].layout,i.render()}},getValue:function(){return modelsHiddenParams[a].data[this.index].y},addValueChangedHandler:function(e){},removeValueChangedHandler:function(e){},setCaption:function(e,t){1==modelsParameters[a].numberOfAxis?(modelsParameters[a].layout.yaxis.title=e,modelsHiddenParams[a].layout=modelsParameters[a].layout):(modelsHiddenParams[a].data[this.index].name=e,modelsParameters[a].layout.yaxis.title="",modelsHiddenParams[a].layout=modelsParameters[a].layout)}}}},this.linePlotlyWidget.prototype=t.prototype,this.barPlotlyWidget=function(e,t,a,o){this.constructor(e,t,a,o);const i=this;this.numberOfAxis=modelsParameters[a].numberOfAxis,_.isUndefined(modelsParameters[a].layout)||(modelsParameters[a].layout={...plotlyColorParams,...modelsParameters[a].layout},["xaxis","yaxis"].forEach(e=>{_.isUndefined(modelsParameters[a].layout[e])||(modelsParameters[a].layout[e]={...axisParams,...modelsParameters[a].layout[e]})})),this.getActuatorDescriptions=function(e=null){const t=e||modelsParameters[a],o=[];if(t&&t.numberOfAxis){const e=_isAxisLinear(t.layout,"xaxis"),a=_isAxisLinear(t.layout,"yaxis");for(let i=1;i<=t.numberOfAxis;i++)o.push(e?_createPlotlyNumericDataDescriptor("x"+i):_createPlotlyAnyDataDescriptor("x"+i)),o.push(a?_createPlotlyNumericDataDescriptor("y"+i):_createPlotlyAnyDataDescriptor("y"+i))}return o},modelsHiddenParams[a].data.length>this.numberOfAxis&&modelsHiddenParams[a].data.splice(this.numberOfAxis,modelsHiddenParams[a].data.length),delete this.x;for(let e=1;e<=2;e++){const t=1===e?"x":"y";for(let e=1;e<=this.numberOfAxis;e++){const o=t+e;e>1&&"x"===t&&_.isUndefined(modelsHiddenParams[a].data[e-1])&&(modelsHiddenParams[a].data[e-1]={x:[],y:[],type:"bar"}),this[o]={index:e-1,strAxis:t,setValue:function(e){modelsHiddenParams[a].data[this.index][this.strAxis]=e,modelsHiddenParams[a].layout=modelsParameters[a].layout,i.render()},getValue:function(){return modelsHiddenParams[a].data[this.index][this.strAxis]},addValueChangedHandler:function(e){},removeValueChangedHandler:function(e){},setCaption:function(e,t){1==modelsParameters[a].numberOfAxis?(modelsParameters[a].layout[this.strAxis+"axis"].title=e,modelsHiddenParams[a].layout=modelsParameters[a].layout):modelsHiddenParams[a].data[this.index].name=e}}}}},this.barPlotlyWidget.prototype=t.prototype,this.piePlotlyWidget=function(e,t,a,o){this.constructor(e,t,a,o);var i=this;_.isUndefined(modelsParameters[a].layout)||(modelsParameters[a].layout={...plotlyColorParams,...modelsParameters[a].layout});const r=new WidgetActuatorDescription("labels","Array of labels",WidgetActuatorDescription.READ,WidgetPrototypesManager.SCHEMA_STRING_ARRAY),l=new WidgetActuatorDescription("values","Array of numeric values",WidgetActuatorDescription.READ,WidgetPrototypesManager.SCHEMA_NUMBER_ARRAY);this.getActuatorDescriptions=function(){return[r,l]},this.labels={setValue:function(e){modelsHiddenParams[a].data[0].labels=e,modelsHiddenParams[a].layout=modelsParameters[a].layout,i.render()},getValue:function(){return modelsHiddenParams[a].data[0].labels},addValueChangedHandler:function(e){},removeValueChangedHandler:function(e){}},this.values={setValue:function(e){modelsHiddenParams[a].data[0].values=e,modelsHiddenParams[a].layout=modelsParameters[a].layout,i.render()},getValue:function(){return modelsHiddenParams[a].data[0].values},addValueChangedHandler:function(e){},removeValueChangedHandler:function(e){}}},this.piePlotlyWidget.prototype=t.prototype,this.d3surfacePlotlyWidget=function(e,t,a,o){this.constructor(e,t,a,o);const i=this;_.isUndefined(modelsParameters[a].layout)||(modelsParameters[a].layout={...plotlyColorParams,...modelsParameters[a].layout},delete modelsParameters[a].layout.colorway,delete modelsParameters[a].layout.legend);const r=new WidgetActuatorDescription("x","1d array for the grid's Xs",WidgetActuatorDescription.READ,WidgetPrototypesManager.SCHEMA_NUMBER_ARRAY),l=new WidgetActuatorDescription("y","1d array for the grid's Ys",WidgetActuatorDescription.READ,WidgetPrototypesManager.SCHEMA_NUMBER_ARRAY),s=new WidgetActuatorDescription("z","2d array of arrays for the grid's Zs",WidgetActuatorDescription.READ,WidgetPrototypesManager.SCHEMA_NUMBER_ARRAY_2D);this.getActuatorDescriptions=function(){return[r,l,s]},this.x={setValue:function(e){modelsHiddenParams[a].data[0].x=e,modelsHiddenParams[a].layout=modelsParameters[a].layout,i.render()},getValue:function(){return modelsHiddenParams[a].data[0].x},addValueChangedHandler:function(e){},removeValueChangedHandler:function(e){},setCaption:function(e,t){modelsParameters[a].layout.scene.xaxis.title=e,modelsHiddenParams[a].layout=modelsParameters[a].layout}},this.y={setValue:function(e){modelsHiddenParams[a].data[0].y=e,modelsHiddenParams[a].layout=modelsParameters[a].layout,i.render()},getValue:function(){return modelsHiddenParams[a].data[0].y},addValueChangedHandler:function(e){},removeValueChangedHandler:function(e){},setCaption:function(e,t){modelsParameters[a].layout.scene.yaxis.title=e,modelsHiddenParams[a].layout=modelsParameters[a].layout}},this.z={setValue:function(e){modelsHiddenParams[a].data[0].z=e,i.render()},getValue:function(){return modelsHiddenParams[a].data[0].z},addValueChangedHandler:function(e){},removeValueChangedHandler:function(e){},setCaption:function(e,t){modelsParameters[a].layout.scene.zaxis.title=e,modelsHiddenParams[a].layout=modelsParameters[a].layout}}},this.d3surfacePlotlyWidget.prototype=t.prototype,this.genericPlotlyWidget=function(e,t,a,o){this.constructor(e,t,a,o);const i=this,r=new WidgetActuatorDescription("data","Plotly data array",WidgetActuatorDescription.READ,void 0,e=>(Plotly.validate(e,{})||[]).map(e=>new WidgetActuatorValidationError(e.msg))),l=new WidgetActuatorDescription("layout","Plotly layout object",WidgetActuatorDescription.READ,void 0,e=>(Plotly.validate([],e)||[]).map(e=>new WidgetActuatorValidationError(e.msg))),s=new WidgetActuatorDescription("selection","Plotly selection",WidgetActuatorDescription.WRITE);this.getActuatorDescriptions=function(){return[r,l,s]},this.data={setValue:function(e){modelsHiddenParams[a].data=e,i.render()},getValue:function(){return modelsHiddenParams[a].data},addValueChangedHandler:function(e){},removeValueChangedHandler:function(e){}},this.layout={setValue:function(e){modelsHiddenParams[a].layout=e,i.render()},getValue:function(){return modelsHiddenParams[a].layout},addValueChangedHandler:function(e){},removeValueChangedHandler:function(e){}},this.selection={setValue:function(e){modelsHiddenParams[a].selection=e},getValue:function(){return modelsHiddenParams[a].selection},addValueChangedHandler:function(e){this.updateCallback=e},removeValueChangedHandler:function(e){}}},this.genericPlotlyWidget.prototype=t.prototype,this.realTimePlotlyWidget=function(e,t,a,o){var i=this;this.numberOfAxis=1;const r=new WidgetActuatorDescription("layout","Plotly layout object",WidgetActuatorDescription.READ,void 0,e=>(Plotly.validate([],e)||[]).map(e=>new WidgetActuatorValidationError(e.msg))),l=new WidgetActuatorDescription("y1","Numeric value to add to the plot",WidgetActuatorDescription.READ,WidgetPrototypesManager.SCHEMA_NUMBER);this.getActuatorDescriptions=function(){const e=[];return e.push(l),e.push(r),e},modelsHiddenParams[a].data.length>this.numberOfAxis&&modelsHiddenParams[a].data.splice(this.numberOfAxis,modelsHiddenParams[a].data.length);for(let e=1;e<=this.numberOfAxis;e++){const i="y"+e;e>1&&_.isUndefined(modelsHiddenParams[a].data[e-1])&&(modelsHiddenParams[a].data[e-1]={x:[],y:[],name:"caption "+(e-1)}),this[i]={index:e-1,setValue:function(e){new Date;var a="plotly"+t;o&&(a+="c"),Plotly.extendTraces(a,{y:[[e]]},[this.index])},getValue:function(){return modelsHiddenParams[a].data[this.index].y},addValueChangedHandler:function(e){},removeValueChangedHandler:function(e){},setCaption:function(e,t){}}}this.layout={setValue:function(e){modelsHiddenParams[a].layout=e,i.render()},getValue:function(){return modelsHiddenParams[a].layout},addValueChangedHandler:function(e){},removeValueChangedHandler:function(e){}},this.constructor(e,t,a,o)},this.realTimePlotlyWidget.prototype=t.prototype,this.pluginDefinition={name:"plotly",widgetsDefinitionList:{plotlyLine:{factory:"linePlotlyWidget",title:"Plotly line",icn:"plotly-line",help:"wdg/wdg-plots/#plotly-line"},plotlyBar:{factory:"barPlotlyWidget",title:"Plotly bar",icn:"plotly-bar",help:"wdg/wdg-plots/#plotly-bar"},plotlyPie:{factory:"piePlotlyWidget",title:"Plotly pie",icn:"plotly-pie",help:"wdg/wdg-plots/#plotly-pie"},plotly3dSurface:{factory:"d3surfacePlotlyWidget",title:"Plotly 3D surface",icn:"plotly-3D",help:"wdg/wdg-plots/#plotly-3d-surface"},plotlyGeneric:{factory:"genericPlotlyWidget",title:"Plotly generic",icn:"plotly-javascript-generic",help:"wdg/wdg-plots/#plotly-generic"},plotlyRealTime:{factory:"realTimePlotlyWidget",title:"Plotly real-time",icn:"plotly-real-time"}}}}var plotlyWidgetsPlugin=new plotlyWidgetsPluginClass;widgetsPluginsHandler.loadWidgetPlugin(plotlyWidgetsPlugin);
function pyodideWidgetsPluginClass(){var t=document.createElement("div");t.setAttribute("style","height: 1in; width: 1in; left: 100%; position: fixed; top: 100%;"),t.setAttribute("id","hiddenDivDpi"),document.body.appendChild(t);var e=document.getElementById("hiddenDivDpi").offsetWidth,i=document.getElementById("hiddenDivDpi").offsetHeight;function n(t,e){var i=document.createElement("div");i.setAttribute("id",e),i.setAttribute("style","text-align:center; height: inherit; width: inherit; background-color: transparent"),$("#"+t).html(i)}this.genericPlotlyPythonWidget=function(t,e,i,o){this.constructor(t,e,i,o);var d=this;this.rescale=function(){},this.render=async function(){var d="plotlyPython"+e;o&&(d+="c"),n(t,d);let a=modelsHiddenParams[i].fig;if(a&&"OK"==datanodesManager.getDataNodeByName(a).status()){let e='fig = globalScope["'+a+'"]\n';e+="\n# convert figure to JSON\nfig_json = fig.to_json(\nvalidate=True,\npretty=False)\nfig_json\n";try{const i=await pyodideManager.runPythonScript(e),n=JSON.parse(i);if(o)Plotly.newPlot(d,n.data,n.layout,n.config);else{$("#"+d).html(""),$("#"+d).html('<img id="png-export-'+d+'"></img>');var l,r=$("#png-export-"+d);Plotly.newPlot(d,n.data,n.layout,n.config).then((function(e){Plotly.toImage(e,{height:$("#"+t).height(),width:$("#"+t).width()}).then((function(t){l=t,Plotly.purge(e),r.attr("src",l),e.style.minHeight=e.parentNode.style.minHeight,e.style.minWidth=e.parentNode.style.minWidth,e.style.width=e.parentNode.style.width,e.style.height=e.parentNode.style.height,r[0].style.minHeight=parseInt(e.parentNode.style.minHeight)+"px",r[0].style.minWidth=parseInt(e.parentNode.style.minWidth)+"px",r[0].style.width=parseFloat(e.parentNode.style.width)+"vw",r[0].style.height=parseFloat(e.parentNode.style.height)+"vh"}))}))}}catch(t){console.log(t)}}};const a=new WidgetActuatorDescription("fig","Plotly figure object",WidgetActuatorDescription.READ);this.getActuatorDescriptions=function(){return[a]},this.fig={setValue:function(t){modelsHiddenParams[i].fig=t,d.render()},getValue:function(){return modelsHiddenParams[i].fig},addValueChangedHandler:function(t){},removeValueChangedHandler:function(t){}},pyodideManager.loadPyodideLibs({standardLibs:[],micropipLibs:["plotly"]}),d.render()},this.genericPlotlyPythonWidget.prototype=baseWidget.prototype,this.genericMatplotlibWidget=function(t,o,d,a){this.constructor(t,o,d,a);var l=this;this.render=async function(){var l="innerMatplotlib"+o;a&&(l+="c"),n(t,l);let r=modelsHiddenParams[d].fig;if(r&&"OK"==datanodesManager.getDataNodeByName(r).status()){let t='fig = globalScope["'+r+'"]\n';t=t+"fig.set_size_inches("+$("#"+l).width()/e+","+$("#"+l).height()/i+")\n",t+="\nimport io, base64\nbuf = io.BytesIO()\nfig.savefig(buf, format='png')\nbuf.seek(0)\nimg_str = 'data:image/png;base64,' + base64.b64encode(buf.read()).decode('UTF-8')\nimg_str\n";try{const e=await pyodideManager.runPythonScript(t);$("#"+l).html('<img id="png-export-'+l+'"></img>');var s=$("#png-export-"+l),g=e;s.attr("src",g),s[0].style.width="inherit",s[0].style.height="inherit"}catch(t){console.log(t)}}};const r=new WidgetActuatorDescription("fig","Matplotlib figure object",WidgetActuatorDescription.READ);this.getActuatorDescriptions=function(){return[r]},this.fig={setValue:function(t){modelsHiddenParams[d].fig=t,l.render()},getValue:function(){return modelsHiddenParams[d].fig},addValueChangedHandler:function(t){},removeValueChangedHandler:function(t){}},pyodideManager.loadPyodideLibs({standardLibs:["matplotlib"],micropipLibs:[]}),l.render()},this.genericMatplotlibWidget.prototype=baseWidget.prototype,this.pluginDefinition={name:"pyodide",widgetsDefinitionList:{plotlyPyGeneric:{factory:"genericPlotlyPythonWidget",title:"Plotly Python generic",icn:"plotly-python-generic",help:"wdg/wdg-plots/#plotly-python-generic"},matplotlib:{factory:"genericMatplotlibWidget",title:"Matplotlib generic",icn:"matplolib-generic",help:"wdg/wdg-plots/#matplotlib"}}},this.constructor()}modelsParameters.plotlyPyGeneric={},modelsParameters.matplotlib={},modelsHiddenParams.plotlyPyGeneric={fig:""},modelsHiddenParams.matplotlib={fig:""},modelsLayout.plotlyPyGeneric={height:"30vh",width:"30vw",minWidth:"50px",minHeight:"32px"},modelsLayout.matplotlib={height:"30vh",width:"30vw",minWidth:"50px",minHeight:"32px"},pyodideWidgetsPluginClass.prototype=basePlugin.prototype;var pyodideWidgetsPlugin=new pyodideWidgetsPluginClass;widgetsPluginsHandler.loadWidgetPlugin(pyodideWidgetsPlugin);
function vegaWidgetsPluginClass(){let e;this.genericVegaWidget=function(t,i,n,a){void 0!==window.xdash&&void 0===e&&(e=null,fetch("assets/data/vega_json_schema_v5.json").then(e=>e.json()).then(t=>{e=t,e.$id=WidgetPrototypesManager.ID_URI_SCHEME+"xdash:vega"}).catch(e=>console.error(e))),this.constructor(t,i,n,a);var r=this;this.rescale=function(){},this.render=function(){var e=JSON.parse(JSON.stringify(modelsHiddenParams[n].spec));if(function(e,t,i){var n=document.createElement("div"),a="vega"+t;i&&(a+="c"),n.setAttribute("id",a),n.setAttribute("style","text-align:center; height: inherit; width: inherit; background-color: transparent"),$("#"+e).html(n)}(t,i,a),modelsParameters[n].inheritWidthAndHeight&&(a?(e.width=$("#vega"+i+"c").width(),e.height=$("#vega"+i+"c").height()):(e.width=$("#vega"+i).width(),e.height=$("#vega"+i).height())),a)return new vega.View(vega.parse(e),{renderer:"canvas",container:"#vega"+i+"c",hover:!0}).runAsync();new vega.View(vega.parse(e),{renderer:"none"}).toCanvas().then((function(e){var t=e.toDataURL("image/png");$("#vega"+i).html('<img src="'+t+'"/>')})).catch((function(e){console.error(e)}))};const s=new WidgetActuatorDescription("spec","Vega JSON specification",WidgetActuatorDescription.READ,e);this.getActuatorDescriptions=function(){return[s]},this.spec={setValue:function(e){e!=modelsHiddenParams[n].spec&&(modelsHiddenParams[n].spec=JSON.parse(JSON.stringify(e)),r.render())},getValue:function(){return modelsHiddenParams[n].spec},addValueChangedHandler:function(e){},removeValueChangedHandler:function(e){}},r.render()},this.genericVegaWidget.prototype=baseWidget.prototype,this.pluginDefinition={name:"vega",widgetsDefinitionList:{vegaGeneric:{factory:"genericVegaWidget",title:"Vega generic",icn:"vega-generic-javascript",help:"wdg/wdg-plots/#vega"}}},this.constructor()}modelsParameters.vegaGeneric={inheritWidthAndHeight:!0},modelsHiddenParams.vegaGeneric={spec:{marks:[{type:"text",encode:{update:{text:{value:"Write then connect your Vega spec"}}}}]}},modelsLayout.vegaGeneric={height:"30vh",width:"30vw",minWidth:"50px",minHeight:"32px"},vegaWidgetsPluginClass.prototype=basePlugin.prototype;var vegaWidgetsPlugin=new vegaWidgetsPluginClass;widgetsPluginsHandler.loadWidgetPlugin(vegaWidgetsPlugin);
modelsParameters.echartsGeneric={};const echartsDefaultColors=["var(--widget-color-2)","var(--widget-color-5)","var(--widget-color-6)","var(--widget-color-7)"];function echartsWidgetsPluginClass(){this.genericEchartsWidget=function(e,t,i,n){this.constructor(e,t,i,n);var r=this;this.rescale=function(){this.render()},this.updateValue=function(e){modelsHiddenParams[i].selection&&(modelsHiddenParams[i].selection=e,_.isUndefined(r.selection.updateCallback)||r.selection.updateCallback(r.selection,r.selection.getValue()))},this.getColorValueFromCSSProperty=function(e){var t=e;if(t.includes("var(--")){var i=e.substring(4,e.length-1);t=window.getComputedStyle(document.documentElement).getPropertyValue(i)}return t},this.render=function(){var o=JSON.parse(JSON.stringify(modelsHiddenParams[i].option));if(o.hasOwnProperty("color")||(o.color=echartsDefaultColors),o.color=o.color.map(e=>this.getColorValueFromCSSProperty(e)),function(e,t,i){var n=document.createElement("div"),r="echarts"+t;i&&(r+="c"),n.setAttribute("id",r),n.setAttribute("style","text-align:center; height: inherit; width: inherit; background-color: transparent"),$("#"+e).html(n)}(e,t,n),n){var a=echarts.init(document.getElementById("echarts"+t+"c"));try{a.setOption(o)}catch(e){console.log(e)}a.on("datazoom",e=>{r.updateValue({start:e.start,end:e.end})})}else{a=echarts.init(document.getElementById("echarts"+t));try{a.setOption(o)}catch(e){console.log(e)}var s=a.getDataURL();a.dispose(),$("#echarts"+t).html('<img src="'+s+'"/>')}};const o=new WidgetActuatorDescription("option","Chart definition",WidgetActuatorDescription.READ,WidgetPrototypesManager.SCHEMA_ANY_OBJECT),a=new WidgetActuatorDescription("selection","Current selection",WidgetActuatorDescription.WRITE,WidgetPrototypesManager.SCHEMA_ANY_OBJECT);this.getActuatorDescriptions=function(){return[o,a]},this.option={setValue:function(e){e==modelsHiddenParams[i].option||""==e||_.isUndefined(e)||(modelsHiddenParams[i].option=e,r.render())},getValue:function(){return modelsHiddenParams[i].option},addValueChangedHandler:function(e){},removeValueChangedHandler:function(e){}},this.selection={setValue:function(e){modelsHiddenParams[i].selection=e},getValue:function(){return modelsHiddenParams[i].selection},addValueChangedHandler:function(e){this.updateCallback=e},removeValueChangedHandler:function(e){}},r.render()},this.genericEchartsWidget.prototype=baseWidget.prototype,this.pluginDefinition={name:"echarts",widgetsDefinitionList:{echartsGeneric:{factory:"genericEchartsWidget",title:"Echarts generic",icn:"echarts-generic-javascript",help:"wdg/wdg-plots/#echarts"}}},this.constructor()}modelsHiddenParams.echartsGeneric={option:{color:echartsDefaultColors},selection:{}},modelsLayout.echartsGeneric={height:"30vh",width:"30vw",minWidth:"50px",minHeight:"32px"},echartsWidgetsPluginClass.prototype=basePlugin.prototype;var echartsWidgetsPlugin=new echartsWidgetsPluginClass;widgetsPluginsHandler.loadWidgetPlugin(echartsWidgetsPlugin);
modelsHiddenParams.hereMaps={inputGeoJson:{},mapMatchingResult:{},heatMapData:{}},modelsHiddenParams.openStreetMaps={geoJson:{geoJsonLayers:[],geoJsonBounds:[]},choropleth:{choroplethLayers:[],choroplethBounds:[]},lineHeatMap:{lineHeatMapLayers:[],lineHeatMapBounds:[]},heatMap:{heatMapData:[],heatMapBuffer:[]},imageOverlay:{imageData:[]},svgOverlay:{svgData:[],svgElements:[]},legends:[],colors:["#800080","#FF00FF","#000080","#0000FF","#008080","#00FFFF","#FFFF00","#800000","#6666ff","#cc6699","#66ff66","#666699","#996633","#ff0000","#669999","#ffff99"]},modelsTempParams.openStreetMaps={geoJson:{geoJsonLayers:[]},choropleth:{choroplethLayers:[]},lineHeatMap:{lineHeatMapLayers:[]},heatMap:{heatMapLayers:[]},imageOverlay:{imageLayers:[]},svgOverlay:{svgLayers:[]},mapObj:null},modelsParameters.openStreetMaps={geoJson:{numberOfLayers:1},choropleth:{numberOfLayers:0},heatMap:{numberOfLayers:0,sampledDisplay:!1,densityHeatMap:!1},lineHeatMap:{numberOfLayers:0},imageOverlay:{numberOfLayers:0},svgOverlay:{numberOfLayers:0},defaultCenter:{latitude:48.872063,longitude:2.331773,zoom:16},offlineSupport:!1,tileServer:"MapboxStreets",drawingFeatures:!1,drawingFeaturesOptions:{point:!0,line:!0,polygone:!0,rectangle:!0,modal:!1},captureClickEvent:!1,markerCluster:!0},modelsLayout.openStreetMaps={height:"35vh",width:"35vw"};const _SCHEMA_SELECTED_POINT={$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:leaflet_imageOverlay",type:"object",properties:{lat:{type:"number"},lag:{type:"number"}},required:["lat","lag"]},_SCHEMA_IMAGE_OVERLAY={$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:leaflet_imageOverlay",type:"object",properties:{imageUrl:{type:"string"},imageBounds:{type:"array",items:{type:"array",items:{type:"number"},minItems:2,maxItems:2},minItems:2,maxItems:2},title:{type:"string"},addAs:{enum:["overlay","baseLayer"]}},required:["imageUrl","imageBounds","title","addAs"]},_SCHEMA_SVG_POINT_OVERLAY={$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:leaflet_svgPointOverlay",type:"object",properties:{data:{anyOf:[{type:"object",properties:{lat:{type:"number"},lng:{type:"number"},direction:{type:"number"}},required:["lat","lng"]},{type:"object",properties:{lat:{type:"number"},lng:{type:"number"},rotation:{type:"number"}},required:["lat","lng"]}]},config:{type:"object",properties:{title:{type:"string"},addAs:{enum:["overlay","baseLayer"]},disableAutoscale:{type:"boolean"},marker:{enum:["arrow","triangle","emptyTriangle","fullTriangle","circle"]},length:{type:"number"},color:{type:"string"}},required:["title","length"]}},required:["data","config"]},_SCHEMA_SVG_OVERLAY={$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:leaflet_svgOverlay",type:"object",properties:{data:{type:"array",items:{anyOf:[{type:"object",properties:{lat:{type:"number"},lng:{type:"number"},direction:{type:"number"}},required:["lat","lng"]},{type:"object",properties:{lat:{type:"number"},lng:{type:"number"},rotation:{type:"number"}},required:["lat","lng"]}]}},config:{type:"object",properties:{title:{type:"string"},addAs:{enum:["overlay","baseLayer"]},disableAutoscale:{type:"boolean"},marker:{enum:["arrow","triangle","emptyTriangle","fullTriangle","circle"]},length:{type:"number"},color:{type:"string"}},required:["title","length"]}},required:["data","config"]},__SCHEMA_VALUED_COORD={$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:leaflet__valued_coord",anyOf:[{type:"object",properties:{lat:{type:"number",minimum:-90,maximum:90},lng:{type:"number",minimum:-180,maximum:180}},required:["lat","lng"],minProperties:3,maxProperties:3,additionalProperties:{type:"number"}},{type:"array",items:[{type:"number",minimum:-90,maximum:90},{type:"number",minimum:-180,maximum:180},{type:"number"}],minItems:3,maxItems:3}]},__SCHEMA_COORD={$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:leaflet__coord",anyOf:[{type:"object",properties:{lat:{type:"number",minimum:-90,maximum:90},lng:{type:"number",minimum:-180,maximum:180}},required:["lat","lng"]},{type:"array",items:[{type:"number",minimum:-90,maximum:90},{type:"number",minimum:-180,maximum:180}],minItems:2,maxItems:2}]},__SCHEMA_HEATMAP_DENSITY_CONFIG={$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:leaflet__heatmap_density_config",type:"object",properties:{minOpacity:{type:"number",minimum:0,maximum:1},maxZoom:{type:"number",minimum:0},radius:{type:"number",minimum:0},blur:{type:"number",minimum:0},disableAutoscale:{type:"boolean"},colorScale:{type:"string"},reverseColorScale:{type:"boolean"}}},__SCHEMA_HEATMAP_CONFIG={$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:leaflet__heatmap_config",type:"object",properties:{opacity:{type:"number",minimum:0,maximum:1},radius:{type:"number",minimum:0},max:{type:"number"},min:{type:"number"},disableAutoscale:{type:"boolean"},addTextLabel:{type:"boolean"},colorScale:{type:"string"},reverseColorScale:{type:"boolean"}}},_SCHEMA_HEATMAP_DENSITY=[{$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:leaflet_heatmap_density",type:"object",properties:{data:{type:"array",items:{$ref:__SCHEMA_VALUED_COORD.$id}},config:{$ref:__SCHEMA_HEATMAP_DENSITY_CONFIG.$id}},required:["data"]},__SCHEMA_VALUED_COORD,__SCHEMA_HEATMAP_DENSITY_CONFIG],_SCHEMA_HEATMAP_DENSITY_SAMPLED=[{$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:leaflet_heatmap_density_sampled",type:"object",properties:{data:{$ref:__SCHEMA_VALUED_COORD.$id},config:{$ref:__SCHEMA_HEATMAP_DENSITY_CONFIG.$id}},required:["data"]},__SCHEMA_VALUED_COORD,__SCHEMA_HEATMAP_DENSITY_CONFIG],_SCHEMA_HEATMAP=[{$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:leaflet_heatmap",type:"object",properties:{data:{type:"array",items:{$ref:__SCHEMA_VALUED_COORD.$id}},config:{$ref:__SCHEMA_HEATMAP_CONFIG.$id}},required:["data"]},__SCHEMA_VALUED_COORD,__SCHEMA_HEATMAP_CONFIG],_SCHEMA_HEATMAP_SAMPLED=[{$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:leaflet_heatmap_sampled",type:"object",properties:{data:{$ref:__SCHEMA_VALUED_COORD.$id},config:{$ref:__SCHEMA_HEATMAP_CONFIG.$id}},required:["data"]},__SCHEMA_VALUED_COORD,__SCHEMA_HEATMAP_CONFIG],__SCHEMA_GEOJSON_COORD={$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:leaflet_geojson_coord",anyOf:[{type:"array",items:[{type:"number",minimum:-180,maximum:180},{type:"number",minimum:-90,maximum:90}],minItems:2,maxItems:2},{type:"array",items:[{type:"number",minimum:-180,maximum:180},{type:"number",minimum:-90,maximum:90},{type:"number"}],minItems:3,maxItems:3}]},__SCHEMA_GEOJSON_COORDINATES={$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:leaflet_geojson_coordinates",type:"array",items:{$ref:__SCHEMA_GEOJSON_COORD.$id}},_SCHEMA_LINE_HEATMAP=[{$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:leaflet_line_heatmap",type:"object",properties:{data:{type:"array",items:{type:"object",properties:{coordinates:{type:"array",items:{$ref:__SCHEMA_GEOJSON_COORD.$id},minItems:2}},required:["coordinates"],patternProperties:{"^(?!coordinates).*$":{type:"number"}},minProperties:2,maxProperties:2}},config:{type:"object",properties:{opacity:{type:"number",minimum:0,maximum:1},weight:{type:"number",minimum:0},max:{type:"number"},min:{type:"number"},disableAutoscale:{type:"boolean"},colorScale:{type:"string"},reverseColorScale:{type:"boolean"}},required:["weight"]}},required:["data","config"]},__SCHEMA_GEOJSON_COORD],__SCHEMA_GEOJSON_GEOMETRY_PRIMITIVE={$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:leaflet_geojson_geometry_primitive",anyOf:[{type:"object",properties:{type:{const:"Point"},coordinates:{$ref:__SCHEMA_GEOJSON_COORD.$id}},required:["type","coordinates"]},{type:"object",properties:{type:{const:"LineString"},coordinates:{$ref:__SCHEMA_GEOJSON_COORDINATES.$id}},required:["type","coordinates"]},{type:"object",properties:{type:{const:"Polygon"},coordinates:{type:"array",items:{$ref:__SCHEMA_GEOJSON_COORDINATES.$id}}},required:["type","coordinates"]}]},__SCHEMA_GEOJSON_GEOMETRY_ALL={$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:leaflet_geojson_geometry_all",anyOf:[{$ref:__SCHEMA_GEOJSON_GEOMETRY_PRIMITIVE.$id},{type:"object",properties:{type:{const:"MultiPoint"},coordinates:{$ref:__SCHEMA_GEOJSON_COORDINATES.$id}},required:["type","coordinates"]},{type:"object",properties:{type:{const:"MultiLineString"},coordinates:{type:"array",items:{$ref:__SCHEMA_GEOJSON_COORDINATES.$id}}},required:["type","coordinates"]},{type:"object",properties:{type:{const:"MultiPolygon"},coordinates:{type:"array",items:{type:"array",items:{$ref:__SCHEMA_GEOJSON_COORDINATES.$id}}}},required:["type","coordinates"]},{type:"object",properties:{type:{const:"GeometryCollection"},geometries:{type:"array",items:{$ref:__SCHEMA_GEOJSON_GEOMETRY_PRIMITIVE.$id}}},required:["type","geometries"]}]},_SCHEMA_CHOROPLETH=[{$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:leaflet_choropleth",type:"object",properties:{data:{type:"array",items:{type:"object",properties:{geometry:{$ref:__SCHEMA_GEOJSON_GEOMETRY_ALL.$id}},required:["geometry"],patternProperties:{"^(?!geometry).*$":{type:"number"}},minProperties:2,maxProperties:2}},config:{type:"object",properties:{opacity:{type:"number",minimum:0,maximum:1},weight:{type:"number",minimum:0},max:{type:"number"},min:{type:"number"},disableAutoscale:{type:"boolean"},colorScale:{type:"string"},reverseColorScale:{type:"boolean"}}}},required:["data"]},__SCHEMA_GEOJSON_COORD,__SCHEMA_GEOJSON_COORDINATES,__SCHEMA_GEOJSON_GEOMETRY_PRIMITIVE,__SCHEMA_GEOJSON_GEOMETRY_ALL],_SCHEMA_GEOJSON=[{$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:leaflet_geojson",type:"object",properties:{type:{const:"FeatureCollection"},features:{type:"array",items:{type:"object",properties:{type:{const:"Feature"},id:{type:"string"},geometry:{$ref:__SCHEMA_GEOJSON_GEOMETRY_ALL.$id},properties:{type:"object",properties:{description:{type:"string"},style:{type:"object",properties:{color:{type:"string"},weight:{type:"number"},opacity:{type:"number"}},additionalProperties:{$ref:WidgetPrototypesManager.SCHEMA_ANY_PRIMITIVE.$id}}}}},if:{properties:{geometry:{type:"object",properties:{type:{const:"Point"}},required:["type"]}}},then:{properties:{properties:{type:"object",properties:{awesomeMarker:{type:"object",properties:{icon:{type:"string"},prefix:{type:"string"},markerColor:{type:"string"},iconColor:{type:"string"},spin:{type:"boolean"},extraClasses:{type:"string"}},required:["icon"]},comment:{type:"string"},html:{type:"string"}},anyOf:[{not:{required:["comment"]}},{not:{required:["html"]}}]}}},required:["type","geometry","properties"]}},properties:{type:"object",properties:{description:{type:"string"}}}},required:["type","features"]},__SCHEMA_GEOJSON_COORD,__SCHEMA_GEOJSON_COORDINATES,__SCHEMA_GEOJSON_GEOMETRY_PRIMITIVE,__SCHEMA_GEOJSON_GEOMETRY_ALL,WidgetPrototypesManager.SCHEMA_ANY_PRIMITIVE],_SCHEMA_SELECTED_GEOJSON=[{$schema:WidgetPrototypesManager.SCHEMA_VERSION,$id:WidgetPrototypesManager.ID_URI_SCHEME+"xdash:leaflet_selected_geojson",type:"object",properties:{type:{const:"FeatureCollection"},features:{type:"array",items:{type:"object",required:["type","geometry","properties"],properties:{type:{const:"Feature"},geometry:{$ref:__SCHEMA_GEOJSON_GEOMETRY_PRIMITIVE.$id},properties:{type:"object",properties:{layerId:{type:"number"}},required:["layerId"]}},if:{properties:{geometry:{type:"object",properties:{type:{const:"Polygon"}},required:["type"]}}},then:{properties:{geometry:{type:"object",properties:{isRectangle:{type:"boolean"},isCut:{type:"boolean"}},required:["isRectangle","isCut"]}}}}}},required:["type","features"]},__SCHEMA_GEOJSON_COORD,__SCHEMA_GEOJSON_COORDINATES,__SCHEMA_GEOJSON_GEOMETRY_PRIMITIVE,WidgetPrototypesManager.SCHEMA_ANY_PRIMITIVE];function mapWidgetsPluginClass(){var e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("xmlns","http://www.w3.org/2000/svg"),e.setAttribute("width","0"),e.setAttribute("height","0");e.innerHTML='<defs><marker id="styledArrow" markerUnits="strokeWidth" markerWidth="12" markerHeight="12" viewBox="0 0 12 12" refX="6" refY="6" orient="auto"><path d="M2,2 L10,6 L2,10 L6,6 L2,2" style="fill: black;"></path></marker></defs>';var a=document.createElement("div");a.setAttribute("style","width:0px; height:0px; margin:0px; padding: 0px"),a.setAttribute("id","hiddenDiv"),a.appendChild(e),document.body.appendChild(a),this.openStreetMapsWidget=function(e,a,t,r){var o=modelsParameters[t].drawingFeatures,s=modelsParameters[t].captureClickEvent,n=modelsParameters[t].markerCluster,i={drawCircle:!1,drawCircleMarker:!1,drawMarker:!0,drawPolyline:!0,drawPolygon:!0,drawRectangle:!0};o&&(i={drawCircle:!1,drawCircleMarker:!1,drawMarker:modelsParameters[t].drawingFeaturesOptions.point,drawPolyline:modelsParameters[t].drawingFeaturesOptions.line,drawPolygon:modelsParameters[t].drawingFeaturesOptions.polygone,drawRectangle:modelsParameters[t].drawingFeaturesOptions.rectangle}),this.constructor(e,a,t,r);var l=this,d=(d3.select("body"),[0,25,50,75,100]);function m(e,a,t,r){var o=(a-e)/8;return r(Math.floor((t-e)/o)*(1/8))}if(this.numberOfGeoJsonLayers=modelsParameters[t].geoJson.numberOfLayers,modelsParameters[t].choropleth?this.numberOfChoroplethLayers=modelsParameters[t].choropleth.numberOfLayers:this.numberOfChoroplethLayers=0,modelsParameters[t].lineHeatMap?this.numberOfLineHeatMapLayers=modelsParameters[t].lineHeatMap.numberOfLayers:this.numberOfLineHeatMapLayers=0,this.numberOfHeatMapLayers=modelsParameters[t].heatMap.numberOfLayers,_.isUndefined(modelsHiddenParams[t].heatMap.heatMapBuffer)&&(modelsHiddenParams[t].heatMap.heatMapBuffer=[]),_.isUndefined(modelsParameters[t].imageOverlay)?(this.numberOfImageLayers=0,modelsParameters[t].imageOverlay={numberOfLayers:0}):this.numberOfImageLayers=modelsParameters[t].imageOverlay.numberOfLayers,_.isUndefined(modelsHiddenParams[t].imageOverlay)&&(modelsHiddenParams[t].imageOverlay={imageData:[]}),_.isUndefined(modelsParameters[t].svgOverlay)?(this.numberOfSvgLayers=0,modelsParameters[t].svgOverlay={numberOfLayers:0}):this.numberOfSvgLayers=modelsParameters[t].svgOverlay.numberOfLayers,_.isUndefined(modelsHiddenParams[t].svgOverlay)&&(modelsHiddenParams[t].svgOverlay={svgData:[],svgElements:[]}),_.isUndefined(modelsParameters[t].lineHeatMap)?(this.numberOfLineHeatMapLayers=0,modelsParameters[t].lineHeatMap={numberOfLayers:0}):this.numberOfLineHeatMapLayers=modelsParameters[t].lineHeatMap.numberOfLayers,_.isUndefined(modelsHiddenParams[t].lineHeatMap)&&(modelsHiddenParams[t].lineHeatMap={lineHeatMapLayers:[],lineHeatMapBounds:[]}),_.isUndefined(modelsParameters[t].choropleth)?(this.numberOfChoroplethLayers=0,modelsParameters[t].choropleth={numberOfLayers:0}):this.numberOfChoroplethLayers=modelsParameters[t].choropleth.numberOfLayers,_.isUndefined(modelsHiddenParams[t].choropleth)&&(modelsHiddenParams[t].choropleth={choroplethLayers:[],choroplethBounds:[]}),_.isUndefined(l.mapLayers)&&(l.mapLayers=jQuery.extend(!0,{},modelsTempParams.openStreetMaps)),this.configStore=[],modelsHiddenParams[t].geoJson.geoJsonLayers.length>l.numberOfGeoJsonLayers&&modelsHiddenParams[t].geoJson.geoJsonLayers.splice(l.numberOfGeoJsonLayers),modelsHiddenParams[t].geoJson.geoJsonBounds.length>l.numberOfGeoJsonLayers&&modelsHiddenParams[t].geoJson.geoJsonBounds.splice(l.numberOfGeoJsonLayers),l.mapLayers.geoJson.geoJsonLayers.length>l.numberOfGeoJsonLayers&&l.mapLayers.geoJson.geoJsonLayers.splice(l.numberOfGeoJsonLayers),modelsHiddenParams[t].choropleth.choroplethLayers.length>l.numberOfChoroplethLayers&&modelsHiddenParams[t].choropleth.choroplethLayers.splice(l.numberOfChoroplethLayers),modelsHiddenParams[t].choropleth.choroplethBounds.length>l.numberOfChoroplethLayers&&modelsHiddenParams[t].choropleth.choroplethBounds.splice(l.numberOfChoroplethLayers),l.mapLayers.choropleth.choroplethLayers.length>l.numberOfChoroplethLayers&&l.mapLayers.choropleth.choroplethLayers.splice(l.numberOfChoroplethLayers),modelsHiddenParams[t].lineHeatMap.lineHeatMapLayers.length>l.numberOfLineHeatMapLayers&&modelsHiddenParams[t].lineHeatMap.lineHeatMapLayers.splice(l.numberOfLineHeatMapLayers),modelsHiddenParams[t].lineHeatMap.lineHeatMapBounds.length>l.numberOfLineHeatMapLayers&&modelsHiddenParams[t].lineHeatMap.lineHeatMapBounds.splice(l.numberOfLineHeatMapLayers),l.mapLayers.lineHeatMap.lineHeatMapLayers.length>l.numberOfLineHeatMapLayers&&l.mapLayers.lineHeatMap.lineHeatMapLayers.splice(l.numberOfLineHeatMapLayers),modelsHiddenParams[t].heatMap.heatMapData.length>l.numberOfHeatMapLayers&&(modelsHiddenParams[t].heatMap.heatMapData.splice(l.numberOfHeatMapLayers),modelsHiddenParams[t].legends.splice(l.numberOfHeatMapLayers)),modelsHiddenParams[t].heatMap.heatMapBuffer.length>l.numberOfHeatMapLayers&&(modelsHiddenParams[t].heatMap.heatMapBuffer.splice(l.numberOfHeatMapLayers),modelsHiddenParams[t].legends.splice(l.numberOfHeatMapLayers)),l.mapLayers.heatMap.heatMapLayers.length>l.numberOfHeatMapLayers&&l.mapLayers.heatMap.heatMapLayers.splice(l.numberOfHeatMapLayers),modelsHiddenParams[t].imageOverlay.imageData.length>l.numberOfImageLayers&&modelsHiddenParams[t].imageOverlay.imageData.splice(l.numberOfImageLayers),l.mapLayers.imageOverlay.imageLayers.length>l.numberOfImageLayers&&l.mapLayers.imageOverlay.imageLayers.splice(l.numberOfImageLayers),modelsHiddenParams[t].svgOverlay.svgData.length>l.numberOfSvgLayers&&(modelsHiddenParams[t].svgOverlay.svgData.splice(l.numberOfSvgLayers),modelsHiddenParams[t].svgOverlay.svgElements.splice(l.numberOfSvgLayers)),l.mapLayers.svgOverlay.svgLayers.length>l.numberOfSvgLayers&&l.mapLayers.svgOverlay.svgLayers.splice(l.numberOfSvgLayers),this.getColorScale=function(e,a,t,r){var o=d3.interpolateYlOrRd;return _.isUndefined(e)||_.isUndefined(d3[e])||!e.includes("interpolate")||(o=d3[e]),!_.isUndefined(a)&&a?d3.scaleSequential().interpolator(o).domain([r,t]):d3.scaleSequential().interpolator(o).domain([t,r])},this.goToFirstRadioButton=function(){if("play"==tabActive&&l.numberOfHeatMapLayers>0){var e=0;_.isUndefined($("input[name='leaflet-base-layers']"))||(e=$("input[name='leaflet-base-layers']").length);for(var a=0;a<e;a++)if($.contains(document.getElementById(t+"c"),$("input[name='leaflet-base-layers']")[a])&&!_.isUndefined(modelsHiddenParams[t])&&modelsHiddenParams[t].legends!=[]){$("input[name='leaflet-base-layers']")[a].click();var r=_.keys(modelsHiddenParams[t].legends)[0];return l.showLegend(r),l.currentBaseLayer=r,void document.removeEventListener("play-tab-loaded",l.goToFirstRadioButton)}}},this.updateValue=function(e){modelsHiddenParams[t].selectedGeoJson&&(modelsHiddenParams[t].selectedGeoJson.features?modelsHiddenParams[t].selectedGeoJson.features.push(e):modelsHiddenParams[t].selectedGeoJson={type:"FeatureCollection",features:[e]},l.selectedGeoJson.updateCallback(l.selectedGeoJson,l.selectedGeoJson.getValue()))},this.getGeoJsonPoint=function(e,a){var t=[];if("polygon"!==e.geometry.type&&"Polygon"!==e.geometry.type||!e.geometry.isCut){if("LineString"===e.geometry.type||"lineString"===e.geometry.type){for(var r=0;r<a._latlngs.length;r++){var o=a._latlngs[r];t.push([o.lng,o.lat])}return t}if("polygon"!==e.geometry.type&&"Polygon"!==e.geometry.type||e.geometry.isCut)return"Point"===e.geometry.type||"point"===e.geometry.type?t=[a._latlng.lng,a._latlng.lat]:[];var s=a._latlngs?a._latlngs[0]:a.pm._layers[0]._latlngs[0];for(r=0;r<s.length;r++){o=s[r];t.push([o.lng,o.lat])}return[t]}return(s=a._latlngs?a._latlngs:a.pm._layers[0]._latlngs).forEach((function(e){for(var a=[],r=0;r<e.length;r++)a.push([e[r].lng,e[r].lat]);t.push(a)})),t},this.getGeoJsonPoint1=function(e,a,t){var r=[],o=[];"rectangle"===e||"Polygon"===e&&t||"polygon"===e||"Polygon"===e&&!t?r=a[0]:"LineString"===e?r=a:"Point"===e&&(r=[],o=[a[1],a[0]]);for(var s=0;s<r.length;s++)o.push([r[s][1],r[s][0]]);return o},this.getLayerInformation=function(e){var a={title:"",description:"",timeStamp:""};if(modelsHiddenParams[t].selectedGeoJson){for(var r=0;r<modelsHiddenParams[t].selectedGeoJson.features.length;r++)modelsHiddenParams[t].selectedGeoJson.features[r].properties.layerId==e&&modelsHiddenParams[t].selectedGeoJson.features[r].properties.information&&(a.title=modelsHiddenParams[t].selectedGeoJson.features[r].properties.information.title,a.description=modelsHiddenParams[t].selectedGeoJson.features[r].properties.information.description,a.timeStamp=modelsHiddenParams[t].selectedGeoJson.features[r].properties.information.timeStamp);l.selectedGeoJson.updateCallback(l.selectedGeoJson,l.selectedGeoJson.getValue())}return a},this.updateLayerInformation=function(e,a){if(modelsHiddenParams[t].selectedGeoJson){for(var r=0;r<modelsHiddenParams[t].selectedGeoJson.features.length;r++)modelsHiddenParams[t].selectedGeoJson.features[r].properties.layerId==e&&(modelsHiddenParams[t].selectedGeoJson.features[r].properties.information=a);l.selectedGeoJson.updateCallback(l.selectedGeoJson,l.selectedGeoJson.getValue())}},this.editList=function(e){if(modelsHiddenParams[t].selectedGeoJson){for(var a=e.map._layers,r=Object.keys(a),o=0;o<r.length;o++)for(var s=0;s<modelsHiddenParams[t].selectedGeoJson.features.length;s++)if(modelsHiddenParams[t].selectedGeoJson.features[s].properties.layerId==a[r[o]]._leaflet_id){var n=l.getGeoJsonPoint(modelsHiddenParams[t].selectedGeoJson.features[s],a[r[o]]);modelsHiddenParams[t].selectedGeoJson.features[s].geometry.coordinates=n}l.selectedGeoJson.updateCallback(l.selectedGeoJson,l.selectedGeoJson.getValue())}},this.rotateLayer=function(e){var a=e.layer._drawnByGeoman?e.layer._leaflet_id:e.layer.feature.properties.layerId;if(modelsHiddenParams[t].selectedGeoJson){for(var r=0;r<modelsHiddenParams[t].selectedGeoJson.features.length;r++)if(modelsHiddenParams[t].selectedGeoJson.features[r].properties.layerId==a){var o=l.getGeoJsonPoint(modelsHiddenParams[t].selectedGeoJson.features[r],e.layer);modelsHiddenParams[t].selectedGeoJson.features[r].geometry.coordinates=o}l.selectedGeoJson.updateCallback(l.selectedGeoJson,l.selectedGeoJson.getValue())}},this.deleteLayer=function(e){var a=e.layer._drawnByGeoman?e.layer._leaflet_id:e.layer.feature.properties.layerId;if(modelsHiddenParams[t].selectedGeoJson){for(var r=0;r<modelsHiddenParams[t].selectedGeoJson.features.length;r++)modelsHiddenParams[t].selectedGeoJson.features[r].properties.layerId==a&&modelsHiddenParams[t].selectedGeoJson.features.splice(r,1);l.selectedGeoJson.updateCallback(l.selectedGeoJson,l.selectedGeoJson.getValue())}},s&&(this.selectedPoint={updateCallback:function(){},getValue:function(){return modelsHiddenParams[t].selectedPoint},setValue:function(e){},addValueChangedHandler:function(e){this.updateCallback=e},removeValueChangedHandler:function(e){},setCaption:function(e){},clearCaption:function(){modelsParameters[t].label="",l.render()}}),o&&(this.selectedGeoJson={updateCallback:function(){},getValue:function(){return modelsHiddenParams[t].selectedGeoJson},setValue:function(e){modelsHiddenParams[t].selectedGeoJson=e},addValueChangedHandler:function(e){"None"!==widgetConnector.widgetsConnection[t].sliders.selectedGeoJson.dataNode&&(this.updateCallback=e,l.addDrawingFeatures())},removeValueChangedHandler:function(e){},setCaption:function(e){},clearCaption:function(){modelsParameters[t].label="",l.render()}}),this.modal=function(e){if(modelsParameters[t].drawingFeaturesOptions.modal){var a=l.getLayerInformation(e.leafletId),r=['<div class="modal-header"><h4>{title} </h4></div>','<h5 class="pull-left" style="padding-left: 10px"><a>Please add a title and a short description</a></h5>','<div class="modal-body">','<div class="row">{content}</div>',"</div>",'<div class="modal-footer">','<input id="dialog-ok" type="submit" class="bouton {OK_CLS}" value="Ok">','<input id="dialog-ok" type="submit" class="bouton  {CANCEL_CLS}" value="Cancel">',"</div>"].join(""),o=["<table>","<body>","<tr>",'<td style="width: 40%;padding-top: 20px;">Title</td>','<td style="width: 60%;padding-top: 20px;">','<textarea type="text" class="form-control"  style="width:190px;max-width: 200px ;max-height: 40px  ;color: #34495e" rows="1" id="modalInput1"  placeholder="Enter title">',a.title,"</textarea>","</td>","</tr>","<tr>",'<td style="width: 30%;padding-top: 20px;">Description</td>','<td style="width: 70%;padding-top: 20px;">','<textarea type="text" class="form-control"  style="width:190px;max-width: 200px ;max-height: 70px  ;color: #34495e" rows="2" id="modalInput2"  placeholder="Enter Description">',a.description,"</textarea>","</td>","</tr>","</body>","</table>"].join("");e.type,l.map.openModal({leafletId:e.leafletId||"NA",content:o,template:r,okText:"Ok",title:a.title,description:a.description,cancelText:"Cancel",OK_CLS:"modal-ok",CANCEL_CLS:"modal-cancel",MODAL_CONTENT_CLS:"modal-content modal-content-black",width:350,onShow:function(a){var t=a.modal;L.DomEvent.on(t._container.querySelector(".modal-ok"),"click",(function(){e.title=document.getElementById("modalInput1").value,e.description=document.getElementById("modalInput2").value;var a=new Date;e.timeStamp=a.toISOString(),l.updateLayerInformation(e.leafletId,e),t.hide()})).on(t._container.querySelector(".modal-cancel"),"click",(function(){t.hide()}))}})}},this.addDrawingFeatures=function(){var e=new L.FeatureGroup;if(l.map.addLayer(e),this.bIsInteractive){if(modelsHiddenParams[t].selectedGeoJson)if(modelsHiddenParams[t].selectedGeoJson.features){for(var a=0;a<modelsHiddenParams[t].selectedGeoJson.features.length;a++){var r=l.getGeoJsonPoint1(modelsHiddenParams[t].selectedGeoJson.features[a].geometry.type,modelsHiddenParams[t].selectedGeoJson.features[a].geometry.coordinates,modelsHiddenParams[t].selectedGeoJson.features[a].geometry.isRectangle),o=null;"LineString"===modelsHiddenParams[t].selectedGeoJson.features[a].geometry.type?o=L.polyline(r):"Point"===modelsHiddenParams[t].selectedGeoJson.features[a].geometry.type?o=L.marker(r):"Polygon"===modelsHiddenParams[t].selectedGeoJson.features[a].geometry.type&&(o=(modelsHiddenParams[t].selectedGeoJson.features[a].geometry.isRectangle,L.geoJSON(modelsHiddenParams[t].selectedGeoJson.features[a],{}))),o&&(o.on("click",(function(e){console.log("click pol leaflet_id",e.target._leaflet_id),l.modal({leafletId:e.target._leaflet_id})})),e.addLayer(o),modelsHiddenParams[t].selectedGeoJson.features[a].properties.layerId=o._leaflet_id)}l.selectedGeoJson.updateCallback(l.selectedGeoJson,l.selectedGeoJson.getValue())}else modelsHiddenParams[t].selectedGeoJson.type="FeatureCollection",modelsHiddenParams[t].selectedGeoJson.features=[],l.selectedGeoJson.updateCallback(l.selectedGeoJson,l.selectedGeoJson.getValue());else modelsHiddenParams[t].selectedGeoJson={type:"FeatureCollection",features:[]},l.selectedGeoJson.updateCallback(l.selectedGeoJson,l.selectedGeoJson.getValue());l.map.on("pm:globaleditmodetoggled",(function(e){console.log("pm:globaleditmodetoggled",e),l.editList(e)})),l.map.on("pm:globaldragmodetoggled",(function(e){console.log("pm:globaldragmodetoggled",e),l.editList(e)})),l.map.on("pm:rotateend",(function(e){console.log("pm:rotateend",e),l.rotateLayer(e)})),l.map.on("pm:remove",(function(e){console.log("pm:remove",e),l.deleteLayer(e)})),l.map.on("pm:cut",(function(e){console.log("pm:cut",e);for(var a=e.originalLayer._drawnByGeoman?e.originalLayer._leaflet_id:e.originalLayer.feature.properties.layerId,r=0;r<modelsHiddenParams[t].selectedGeoJson.features.length;r++)modelsHiddenParams[t].selectedGeoJson.features[r].properties.layerId==a&&(modelsHiddenParams[t].selectedGeoJson.features[r].properties.layerId=e.layer._leaflet_id,modelsHiddenParams[t].selectedGeoJson.features[r].geometry.coordinates=e.layer.feature.geometry.coordinates,modelsHiddenParams[t].selectedGeoJson.features[r].geometry.isCut=!0);l.selectedGeoJson.updateCallback(l.selectedGeoJson,l.selectedGeoJson.getValue())})),l.map.on("pm:create",a=>{console.log("pm:create",a),e.addLayer(a.layer);var r=[];if(modelsHiddenParams[t].selectedGeoJson)if("Polygon"==a.shape){for(var o=0;o<a.layer._latlngs[0].length;o++){var s=a.layer._latlngs[0][o];r.push([s.lng,s.lat])}l.updateValue({type:"Feature",geometry:{type:"Polygon",coordinates:[r],isRectangle:!1,isCut:!1},properties:{layerId:a.layer._leaflet_id}})}else if("Line"==a.shape){for(o=0;o<a.layer._latlngs.length;o++){s=a.layer._latlngs[o];r.push([s.lng,s.lat])}l.updateValue({type:"Feature",geometry:{type:"LineString",coordinates:r},properties:{layerId:a.layer._leaflet_id}})}else if("Rectangle"==a.shape){for(o=0;o<a.layer._latlngs[0].length;o++){s=a.layer._latlngs[0][o];r.push([s.lng,s.lat])}l.updateValue({type:"Feature",geometry:{type:"Polygon",coordinates:[r],isRectangle:!0,isCut:!1},properties:{layerId:a.layer._leaflet_id}})}else"Marker"==a.shape&&(r=[a.layer._latlng.lng,a.layer._latlng.lat],l.updateValue({type:"Feature",geometry:{type:"Point",coordinates:r},properties:{layerId:a.layer._leaflet_id}}))})}else modelsHiddenParams[t].selectedGeoJson={type:"FeatureCollection",features:[]},l.selectedGeoJson.updateCallback(l.selectedGeoJson,l.selectedGeoJson.getValue())},this.render=function(){var r=document.createElement("div");r.setAttribute("id","openStreetMap"+a),r.setAttribute("style","width: inherit; height: inherit"),document.addEventListener("play-tab-loaded",l.goToFirstRadioButton),$("#"+e).html(r),l.map=L.map("openStreetMap"+a,{preferCanvas:!0}).setView([modelsParameters[t].defaultCenter.latitude,modelsParameters[t].defaultCenter.longitude],modelsParameters[t].defaultCenter.zoom),modelsTempParams[t].mapObj=l.map,s&&this.bIsInteractive&&l.map.on("click",(function(e){modelsHiddenParams[t].selectedPoint,modelsHiddenParams[t].selectedPoint={lat:e.latlng.lat,lag:e.latlng.lng},l.selectedPoint.updateCallback(l.selectedPoint,l.selectedPoint.getValue())})),this.bIsInteractive||(l.map.dragging.disable(),l.map.touchZoom.disable(),l.map.doubleClickZoom.disable(),l.map.scrollWheelZoom.disable(),l.map.boxZoom.disable(),l.map.keyboard.disable());var n={};n.MapboxStreets={url:"https://xdashgateway.azure-api.net/mapbox/tiles?z={z}&x={x}&y={y}",attribution:'Imagery © <a href="http://mapbox.com">Mapbox</a>',maxZoom:18,id:"streets-v11",tileSize:512,zoomOffset:-1},n.MapboxDark={url:"https://xdashgateway.azure-api.net/mapbox/tilesgeneral?z={z}&x={x}&y={y}&id={id}",attribution:'Imagery © <a href="http://mapbox.com">Mapbox</a>',maxZoom:18,id:"dark-v10",tileSize:512,zoomOffset:-1},n.HereSatelliteDay={url:"https://xdashgateway.azure-api.net/here{s}/maptile?z={z}&x={x}&y={y}&lg=eng",attribution:'Map &copy; 1987-2014 <a href="http://developer.here.com">HERE</a>',id:" satellite.day",maxZoom:20,subdomains:"1234"},n.HereTerrainDay={url:"https://xdashgateway.azure-api.net/here{s}/maptile?z={z}&x={x}&y={y}&lg=eng",attribution:'Map &copy; 1987-2014 <a href="http://developer.here.com">HERE</a>',id:"terrain.day",maxZoom:20,subdomains:"1234"},n.HereHybridDay={url:"https://xdashgateway.azure-api.net/here{s}/maptile?z={z}&x={x}&y={y}&lg=eng",attribution:'Map &copy; 1987-2014 <a href="http://developer.here.com">HERE</a>',id:" HERE.hybridDay",maxZoom:20,subdomains:"1234"},"true"!=xDashConfig.xDashBasicVersion&&(n.EsriWorldImagery={url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",attribution:"Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community",id:"Esri.WorldImagery",maxZoom:19},n["GeoportailFrance.orthos"]={url:"https://wxs.ign.fr/{apikey}/geoportail/wmts?REQUEST=GetTile&SERVICE=WMTS&VERSION=1.0.0&STYLE={style}&TILEMATRIXSET=PM&FORMAT={format}&LAYER=ORTHOIMAGERY.ORTHOPHOTOS&TILEMATRIX={z}&TILEROW={y}&TILECOL={x}",attribution:'<a target="_blank" href="https://www.geoportail.gouv.fr/">Geoportail France</a>',minZoom:2,maxZoom:19,apikey:"choisirgeoportail",format:"image/jpeg",style:"normal"});var d="MapboxStreets";_.isUndefined(modelsParameters[t].tileServer)||_.contains(_.keys(n),modelsParameters[t].tileServer)&&(d=modelsParameters[t].tileServer);var m={url:n[d].url,maxZoom:n[d].maxZoom,attribution:'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, '+n[d].attribution};if(_.isUndefined(n[d].subdomains)||(m.subdomains=n[d].subdomains),_.isUndefined(n[d].id)||(m.id=n[d].id),_.isUndefined(n[d].apikey)||(m.apikey=n[d].apikey),_.isUndefined(n[d].format)||(m.format=n[d].format),_.isUndefined(n[d].style)||(m.style=n[d].style),_.isUndefined(n[d].tileSize)||(m.tileSize=n[d].tileSize),_.isUndefined(n[d].zoomOffset)||(m.zoomOffset=n[d].zoomOffset),_.isUndefined(n[d].accessToken)||(m.accessToken=n[d].accessToken),modelsParameters[t].offlineSupport){m.attribution='Progress: <span id="leafletProgress'+a+'"></span> / <span id="leafletTotal'+a+'"></span>. Current storage: <span id="leafletStorage'+a+'"></span> files.Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, '+n[d].attribution,l.baseLayer=L.tileLayer.offline(n[d].url,m),l.baseLayer.addTo(l.map);var p=[];if(modelsParameters[t].defaultCenter.zoom<=n[d].maxZoom)for(var y=0;y<n[d].maxZoom-modelsParameters[t].defaultCenter.zoom;y++)p[y]=modelsParameters[t].defaultCenter.zoom+y;else p=modelsParameters[t].defaultCenter.zoom;var c,g=L.control.savetiles(l.baseLayer,{zoomlevels:p,confirm:function(e,a){window.confirm("Save "+e._tilesforSave.length)&&a()},confirmRemoval:function(e,a){window.confirm("Remove all the tiles?")&&a()},saveText:'<i class="icon-download-alt icon" aria-hidden="true"></i>',rmText:'<i class="icon-trash icon" aria-hidden="true"></i>'});g.addTo(l.map),l.baseLayer.on("storagesize",(function(e){document.getElementById("leafletStorage"+a).innerHTML=e.storagesize})),g.setPosition("topright"),l.baseLayer.on("savestart",(function(e){c=0,document.getElementById("leafletTotal"+a).innerHTML=e._tilesforSave.length})),l.baseLayer.on("savetileend",(function(e){c++,document.getElementById("leafletProgress"+ +a).innerHTML=c})),l.baseLayer.on("loadend",(function(e){swal("","Saved all tiles","info")})),l.baseLayer.on("tilesremoved",(function(e){document.getElementById("leafletProgress"+ +a).innerHTML="",document.getElementById("leafletTotal"+a).innerHTML="",swal("","Removed all tiles","info")}))}else l.baseLayer=L.tileLayer(n[d].url,m),l.baseLayer.addTo(l.map);L.control.scale().addTo(l.map),l.map.zoomControl.setPosition("topright"),l.ctrl=L.control.layers({},{},{position:"topright",collapsed:!0,autoZIndex:!0}).addTo(l.map),o&&l.map.pm.addControls(i);try{for(y=0;y<l.numberOfGeoJsonLayers;y++)_.isUndefined(modelsHiddenParams[t].geoJson.geoJsonLayers[y])||_.isUndefined(modelsHiddenParams[t].geoJson.geoJsonLayers[y])||l.addGeoJson(modelsHiddenParams[t].geoJson.geoJsonLayers[y],y+1);for(y=0;y<l.numberOfChoroplethLayers;y++)_.isUndefined(modelsHiddenParams[t].choropleth.choroplethLayers[y])||_.isUndefined(modelsHiddenParams[t].choropleth.choroplethLayers[y])||l.addChoropleth(modelsHiddenParams[t].choropleth.choroplethLayers[y],y+1);for(y=0;y<l.numberOfLineHeatMapLayers;y++)_.isUndefined(modelsHiddenParams[t].lineHeatMap.lineHeatMapLayers[y])||_.isUndefined(modelsHiddenParams[t].lineHeatMap.lineHeatMapLayers[y])||l.addLineHeatMap(modelsHiddenParams[t].lineHeatMap.lineHeatMapLayers[y],y+1);for(y=0;y<l.numberOfHeatMapLayers;y++)modelsHiddenParams[t].heatMap.heatMapBuffer[y]=[],_.isUndefined(modelsHiddenParams[t].heatMap.heatMapData[y])||_.isUndefined(modelsHiddenParams[t].heatMap.heatMapData[y])||l.drawHeatMap(modelsHiddenParams[t].heatMap.heatMapData[y],y+1);for(y=0;y<l.numberOfImageLayers;y++)_.isUndefined(modelsHiddenParams[t].imageOverlay.imageData[y])||_.isUndefined(modelsHiddenParams[t].imageOverlay.imageData[y])||l.addImageOverlay(modelsHiddenParams[t].imageOverlay.imageData[y],y+1);for(y=0;y<l.numberOfSvgLayers;y++)_.isUndefined(modelsHiddenParams[t].svgOverlay.svgData[y])||_.isUndefined(modelsHiddenParams[t].svgOverlay.svgData[y])||l.addSvgOverlay(modelsHiddenParams[t].svgOverlay.svgData[y],y+1,!1)}catch(e){console.error(e)}l.map.on("baselayerchange",(function(e){l.showLegend(e.name),l.currentBaseLayer=e.name}))},this.showLegend=function(e){var a=_.keys(modelsHiddenParams[t].legends);if(_.has(modelsHiddenParams[t].legends,e)){var r=_.without(a,e);_.each(r,(function(e){l.map.removeControl(modelsHiddenParams[t].legends[e])})),modelsHiddenParams[t].legends[e].addTo(l.map),o&&(l.map.pm.removeControls(),l.map.pm.addControls(i))}},this.rescale=function(){try{l.map.invalidateSize()}catch(e){console.log(e.message)}},this.addGeoJson=function(e,a){if(modelsHiddenParams[t].geoJson.geoJsonBounds[a-1]=null,!(_.isUndefined(e)||(_.isEmpty(l.mapLayers.geoJson.geoJsonLayers[a-1])||(l.ctrl.removeLayer(l.mapLayers.geoJson.geoJsonLayers[a-1]),l.map.removeLayer(l.mapLayers.geoJson.geoJsonLayers[a-1])),_.isEmpty(e)||e=={}||_.isUndefined(e.features)||_.isEmpty(e.features)))){var r="Trace"+a;_.isUndefined(e.properties)||_.isUndefined(e.properties.description)||(r=e.properties.description);var o={color:modelsHiddenParams[t].colors[a-1],weight:4,opacity:1},s=L.geoJSON(e,{style:function(e){return _.isUndefined(e.properties)?o:(_.isUndefined(e.properties.description)||(r=e.properties.description),_.isUndefined(e.properties.style)?o:e.properties.style)},onEachFeature:function(e,a){if("Point"==e.geometry.type&&e.properties)if(e.properties.comment)if(e.properties.openPopup){a.bindPopup(e.properties.comment,{autoClose:!1,autoPan:!1}).on("add",(function(e){e.target.openPopup()}))}else a.bindPopup(e.properties.comment);else if(e.properties.html)e.properties.openPopup?(mk=a.bindPopup(e.properties.html,{autoClose:!1,autoPan:!1}),mk.on("add",(function(e){e.target.openPopup()}))):a.bindPopup(e.properties.html);else{var t=jQuery.extend(!0,{},e.properties);t.awesomeMarker&&delete t.awesomeMarker,e.properties.openPopup?(mk=a.bindPopup(syntaxHighlight(JSON.stringify(t)),{autoClose:!1,autoPan:!1}),mk.on("add",(function(e){e.target.openPopup()}))):a.bindPopup(syntaxHighlight(JSON.stringify(t)))}},pointToLayer:function(e,a){if("Point"==e.geometry.type){if(e.properties&&e.properties.awesomeMarker){var t=L.AwesomeMarkers.icon(e.properties.awesomeMarker);return L.marker(a,{icon:t})}return L.marker(a)}}});if(n){var i=L.markerClusterGroup();i.addLayer(s),l.mapLayers.geoJson.geoJsonLayers[a-1]=i}else l.mapLayers.geoJson.geoJsonLayers[a-1]=s;l.map.addLayer(l.mapLayers.geoJson.geoJsonLayers[a-1]),l.ctrl.addOverlay(l.mapLayers.geoJson.geoJsonLayers[a-1],r);try{var d=geojsonExtent(e),m=L.latLng(d[1],d[0]),p=L.latLng(d[3],d[2]),y=L.latLngBounds(m,p);modelsHiddenParams[t].geoJson.geoJsonBounds[a-1]=y;var c=!1;_.isUndefined(e.properties)||_.isUndefined(e.properties.disableAutoscale)||(c=e.properties.disableAutoscale),c||l.map.fitBounds(l.globalLayersBounds())}catch(e){console.log(e)}}},this.addChoropleth=function(e,a){if(_.isUndefined(e))return;if(_.isEmpty(e))return;if(e=={})return;var r=l.convertToChoroplethObject(e);if(modelsHiddenParams[t].choropleth.choroplethBounds[a-1]=null,_.isEmpty(l.mapLayers.choropleth.choroplethLayers[a-1])||(l.ctrl.removeLayer(l.mapLayers.choropleth.choroplethLayers[a-1]),l.map.removeLayer(l.mapLayers.choropleth.choroplethLayers[a-1])),_.isUndefined(r.features))return;if(_.isEmpty(r.features))return;var o=_.without(_.keys(e.data[0]),"geometry")[0];_.isUndefined(r.properties)||_.isUndefined(r.properties.description)||(o=r.properties.description);var s=_.max(_.pluck(e.data,o)),n=_.min(_.pluck(e.data,o)),i=4,d=.7;let p;try{_.isUndefined(e.config.max)||(s=e.config.max),_.isUndefined(e.config.min)||(n=e.config.min),_.isUndefined(e.config.weight)||(i=e.config.weight),_.isUndefined(e.config.opacity)||(d=e.config.opacity),p=l.getColorScale(e.config.colorScale,e.config.reverseColorScale,0,1)}catch(e){}l.createChoroplethLegend(n,s,o,p),l.showLegend(o),l.mapLayers.choropleth.choroplethLayers[a-1]=L.geoJSON(r,{style:function(e){return{weight:i,opacity:d,color:"white",dashArray:"3",fillOpacity:d,fillColor:m(n,s,e.properties.density,p)}}}).addTo(l.map),l.ctrl.addBaseLayer(l.mapLayers.choropleth.choroplethLayers[a-1],o);var y=!1;try{y=e.config.disableAutoscale}catch(e){}try{if(!y){var c=geojsonExtent(r),g=L.latLng(c[1],c[0]),u=L.latLng(c[3],c[2]),f=L.latLngBounds(g,u);modelsHiddenParams[t].choropleth.choroplethBounds[a-1]=f,l.map.fitBounds(f)}}catch(e){console.log(e)}},this.convertToChoroplethObject=function(e){let a=[];const t=e.data;if(t.length){const e=_.without(_.keys(t[0]),"geometry")[0];a=t.map((a,t)=>({type:"Feature",id:t,properties:{},geometry:a.geometry,properties:{density:a[e]}}))}return{type:"FeatureCollection",features:a}},this.createChoroplethLegend=function(e,a,r,o){_.isUndefined(modelsHiddenParams[t].legends[r])||l.map.removeControl(modelsHiddenParams[t].legends[r]),modelsHiddenParams[t].legends[r]=L.control({position:"topright"}),modelsHiddenParams[t].legends[r].onAdd=function(t){for(var r,s,n=(a-e)/8,i=L.DomUtil.create("div","info legend"),l=[e,e+n,e+2*n,e+3*n,e+4*n,e+5*n,e+6*n,a],d=[],p=0;p<l.length;p++)r=l[p],s=l[p+1],d.push('<i style="background:'+m(e,a,r+1,o)+'"></i> <span>'+d3.format("~s")(r)+(s?"&ndash;"+d3.format("~s")(s):"+")+"</span>");return i.innerHTML=d.join("<br>"),i}},this.convertToGeoJSONObject=function(e){var a=[],t="";return _.each(e.data,(function(r){var o=Object.keys(r);_.each(o,(function(e){"coordinates"!=e&&(t=e)}));var s,n,i,d={type:"Feature",geometry:{type:"LineString",coordinates:r.coordinates},properties:{style:{color:l.getColorScale(e.config.colorScale,e.config.reverseColorScale,0,100)((s=r[t],n=e.config.min,i=100*(s-n)/(e.config.max-n),i>100&&(i=100),i<0&&(i=0),i)),weight:e.config.weight,opacity:e.config.opacity}}};a.push(d)})),{type:"FeatureCollection",features:a,properties:{description:t}}},this.addLineHeatMap=function(e,a){if(!_.isUndefined(e)&&!_.isEmpty(e)&&e!={}){var r=l.convertToGeoJSONObject(e);if(modelsHiddenParams[t].lineHeatMap.lineHeatMapBounds[a-1]=null,_.isEmpty(l.mapLayers.lineHeatMap.lineHeatMapLayers[a-1])||(l.ctrl.removeLayer(l.mapLayers.lineHeatMap.lineHeatMapLayers[a-1]),l.map.removeLayer(l.mapLayers.lineHeatMap.lineHeatMapLayers[a-1])),!_.isUndefined(r.features)&&!_.isEmpty(r.features)){var o="Trace"+a;_.isUndefined(r.properties)||_.isUndefined(r.properties.description)||(o=r.properties.description);var s={color:modelsHiddenParams[t].colors[a-1],weight:4,opacity:1},n=_.max(_.pluck(e.data,o)),i=_.min(_.pluck(e.data,o));try{_.isUndefined(e.config.max)||(n=e.config.max),_.isUndefined(e.config.min)||(i=e.config.min)}catch(e){}var m=l.getColorScale(e.config.colorScale,e.config.reverseColorScale,0,100);l.createLegend(m,100,d,i,n,o),l.showLegend(o),l.mapLayers.lineHeatMap.lineHeatMapLayers[a-1]=L.geoJSON(r,{style:function(e){return _.isUndefined(e.properties)?s:(_.isUndefined(e.properties.description)||(o=e.properties.description),_.isUndefined(e.properties.style)?s:e.properties.style)},onEachFeature:function(e,a){"Point"==e.geometry.type&&e.properties&&a.bindPopup(syntaxHighlight(JSON.stringify(e.properties)))}}).addTo(l.map),l.ctrl.addBaseLayer(l.mapLayers.lineHeatMap.lineHeatMapLayers[a-1],o);var p=!1;try{p=e.config.disableAutoscale}catch(e){}if(!p)try{var y=geojsonExtent(r),c=L.latLng(y[1],y[0]),g=L.latLng(y[3],y[2]),u=L.latLngBounds(c,g);modelsHiddenParams[t].lineHeatMap.lineHeatMapBounds[a-1]=u,l.map.fitBounds(l.globalLayersLineHeatBounds())}catch(e){console.log(e)}}}},this.addImageOverlay=function(e,a){if(_.isUndefined(e))return;if(_.isEmpty(e))return;if(e=={})return;const t=e.imageUrl,r=e.imageBounds,o=e.title,s=e.addAs;_.isEmpty(l.mapLayers.imageOverlay.imageLayers[a-1])||(l.ctrl.removeLayer(l.mapLayers.imageOverlay.imageLayers[a-1]),l.map.removeLayer(l.mapLayers.imageOverlay.imageLayers[a-1])),l.mapLayers.imageOverlay.imageLayers[a-1]=L.imageOverlay(t,r).addTo(l.map),"overlay"==s?l.ctrl.addOverlay(l.mapLayers.imageOverlay.imageLayers[a-1],o):l.ctrl.addBaseLayer(l.mapLayers.imageOverlay.imageLayers[a-1],o)},this.globalLayersBounds=function(){for(var e=L.latLngBounds(l.map.getCenter()),a=0;a<l.numberOfGeoJsonLayers;a++)null!=modelsHiddenParams[t].geoJson.geoJsonBounds[a]&&e.extend(modelsHiddenParams[t].geoJson.geoJsonBounds[a]);return e},this.globalLayersLineHeatBounds=function(){for(var e=L.latLngBounds(l.map.getCenter()),a=0;a<l.numberOfLineHeatMapLayers;a++)null!=modelsHiddenParams[t].lineHeatMap.lineHeatMapBounds[a]&&e.extend(modelsHiddenParams[t].lineHeatMap.lineHeatMapBounds[a]);return e},this.createSvgOverlay=function(e,a){var t=l.createOneCircle,r=e.config.marker;switch(r){case"arrow":t=l.createOneArrow;break;case"triangle":case"emptyTriangle":case"fullTriangle":t=l.createOneTriangle;break;default:r="circle",t=l.createOneCircle}return l.createObjectsOverlay(e,a,r,t)},this.appendSvgOverlay=function(e,a){switch(e.config.marker){case"arrow":return l.appendArrowsOverlay(e,a)}},this.appendArrowsOverlay=function(e,a){var r=e.data[0],o=L.latLng([r.lat,r.lng]),s=l.map.latLngToLayerPoint(o).x,n=l.map.latLngToLayerPoint(o).y,i=0,d="black";_.isUndefined(r.direction)||(i=r.direction),_.isUndefined(r.rotation)||(i=r.rotation),_.isUndefined(r.color)||(d=r.color);var m=l.createOneArrow(s,n,i,modelsHiddenParams[t].svgOverlay.svgElements[a-1].reductionFactor,modelsHiddenParams[t].svgOverlay.svgElements[a-1].lengthInPx,d);modelsHiddenParams[t].svgOverlay.svgElements[a-1].SVG.innerHTML=modelsHiddenParams[t].svgOverlay.svgElements[a-1].SVG.innerHTML+m},this.createObjectsOverlay=function(e,a,r,o){modelsHiddenParams[t].svgOverlay.svgElements[a-1]={},modelsHiddenParams[t].svgOverlay.svgElements[a-1].currentZoom=l.map.getZoom(),[modelsHiddenParams[t].svgOverlay.svgElements[a-1].reductionFactor,modelsHiddenParams[t].svgOverlay.svgElements[a-1].lengthInPx]=l.computeDimensions(e);var s="",n=e.config.color||"#000";e.data.forEach((function(e){var i=L.latLng([e.lat,e.lng]),d=0;_.isUndefined(e.direction)||(d=e.direction),_.isUndefined(e.rotation)||(d=e.rotation);var m=l.map.latLngToContainerPoint(i).x,p=l.map.latLngToContainerPoint(i).y;s+=o(m,p,d,modelsHiddenParams[t].svgOverlay.svgElements[a-1].reductionFactor,modelsHiddenParams[t].svgOverlay.svgElements[a-1].lengthInPx,r,n)}));var i=document.createElementNS("http://www.w3.org/2000/svg","svg");i.setAttribute("xmlns","http://www.w3.org/2000/svg");var d="0 0 "+l.map.getSize().x+" "+l.map.getSize().y;return i.setAttribute("viewBox",d),modelsHiddenParams[t].svgOverlay.svgElements[a-1].SVG=i,modelsHiddenParams[t].svgOverlay.svgElements[a-1].SVG.innerHTML=s,L.svgOverlay(modelsHiddenParams[t].svgOverlay.svgElements[a-1].SVG,l.map.getBounds())},this.computeDimensions=function(e){const a=e.config.length,t=l.map.getBounds(),r=t.getSouthWest(),o=t.getNorthEast(),s=l.map.latLngToContainerPoint(r).y-l.map.latLngToContainerPoint(o).y,n=L.latLng(o.lat,r.lng),i=a/l.map.distance(r,n);return[i,s*i]},this.autoscaleSvg=function(e){var a,t,r,o=[],s=[];_.isEmpty(e.data)||(e.data.forEach((function(e){o.push(e.lat),s.push(e.lng)})),o.length>1?(a=L.latLng(_.max(o),_.max(s)),t=L.latLng(_.min(o),_.min(s)),r=L.latLngBounds(a,t),l.map.fitBounds(r)):l.map.setView(L.latLng(o[0],s[0]),l.map.getZoom()))},this.createOneArrow=function(e,a,t,r,o,s){var n='<line x1="'+e+'" y1="'+a+'" x2="'+e+'" y2="'+(a-o)+'" stroke="#000" stroke-width="'+50*r+'" marker-end="url(#styledArrow)" ';return n=n+'transform="rotate('+t+" "+e+" "+a+')"  />'},this.createOneCircle=function(e,a,t,r,o){var s='<circle cx="'+e+'" cy="'+a+'" stroke="#000" r="'+50*r+'"';return s+="/>"},this.rotationPoint=function(e,a,t,r,o){var s=Math.PI/180*o,n=Math.cos(s),i=Math.sin(s);return[n*(t-e)+i*(r-a)+e,n*(r-a)-i*(t-e)+a]},this.getTrianglePoints=function(e,a,t){var r=e.y,o=e.x-0,s=e.y,n=e.x-a,i=e.y-a/2,d=e.x,m=e.y+a/2,p=e.x,y=l.rotationPoint(o,r,n,s,t),c=l.rotationPoint(o,r,d,i,t),g=l.rotationPoint(o,r,p,m,t);return y[1]+" "+y[0]+" "+c[1]+" "+c[0]+" "+g[1]+" "+g[0]},this.createOneTriangle=function(e,a,t,r,o,s,n){var i=l.getTrianglePoints({x:a,y:e},o,t),d='<polygon points="'+i+'"  style="fill:'+n+";stroke:"+n+";stroke-width:"+50*r+'"   />';return"emptyTriangle"==s&&(d='<polygon points="'+i+'"  fill="none" style="stroke:'+n+";stroke-width:"+50*r+'"   />'),d},this.addSvgOverlay=function(e,a,r){if(!_.isUndefined(e)&&!_.isEmpty(e)&&e!={}&&!_.isUndefined(e.data)){var o=e.config.title,s=e.config.addAs,n=e.config.disableAutoscale;if(!_.isUndefined(modelsHiddenParams[t].svgOverlay.svgElements[a-1])&&!_.isUndefined(modelsHiddenParams[t].svgOverlay.svgElements[a-1].currentZoom)){var i=l.map.getZoom();modelsHiddenParams[t].svgOverlay.svgElements[a-1].currentZoom!=i&&(r=!1)}r?l.appendSvgOverlay(e,a):(n||l.autoscaleSvg(e),_.isEmpty(l.mapLayers.svgOverlay.svgLayers[a-1])||(l.ctrl.removeLayer(l.mapLayers.svgOverlay.svgLayers[a-1]),l.map.removeLayer(l.mapLayers.svgOverlay.svgLayers[a-1])),l.mapLayers.svgOverlay.svgLayers[a-1]=L.layerGroup().addLayer(l.createSvgOverlay(e,a)).addTo(l.map),"overlay"==s?l.ctrl.addOverlay(l.mapLayers.svgOverlay.svgLayers[a-1],o):l.ctrl.addBaseLayer(l.mapLayers.svgOverlay.svgLayers[a-1],o))}},this.psetSvg=function(e,a){if(!_.isUndefined(e)&&!_.isEmpty(e)&&!_.isEmpty(e.data)){var t,r=e.data;t=_.isUndefined(e.config)?{data:[r]}:{data:[r],config:e.config},_.isEmpty(l.mapLayers.svgOverlay.svgLayers[a-1])?l.addSvgOverlay(t,a,!1):l.addSvgOverlay(t,a,!0)}},this.createLabelIcon=function(e,a){return L.divIcon({className:e,html:a})},this.drawHeatMap2=function(e,a){if(_.isEmpty(l.mapLayers.heatMap.heatMapLayers[a-1])||(l.ctrl.removeLayer(l.mapLayers.heatMap.heatMapLayers[a-1]),l.map.removeLayer(l.mapLayers.heatMap.heatMapLayers[a-1]),l.mapLayers.heatMap.heatMapLayers[a-1].remove(),delete l.mapLayers.heatMap.heatMapLayers[a-1]),_.isUndefined(e))return;if(_.isEmpty(e))return;if(_.isUndefined(e.data))return;if(heatMapData=e.data,_.isEmpty(heatMapData)||0==heatMapData.length){var t=L.layerGroup([]);return l.mapLayers.heatMap.heatMapLayers[a-1]=t.addTo(l.map),l.ctrl.addBaseLayer(l.mapLayers.heatMap.heatMapLayers[a-1],"none"),void(_.isUndefined($("input[name='leaflet-base-layers']")[l.numberOfHeatMapLayers-1])||$("input[name='leaflet-base-layers']")[l.numberOfHeatMapLayers-1].click())}let r,o,s,n=.8,i=5,m=!1,p=!1;try{heatMapConfig=e.config,n=heatMapConfig.opacity||n,i=heatMapConfig.radius||i,r=heatMapConfig.max,o=heatMapConfig.min,m=heatMapConfig.disableAutoscale,p=heatMapConfig.addTextLabel,s=l.getColorScale(heatMapConfig.colorScale,heatMapConfig.reverseColorScale,0,100)}catch(e){}const y=[];let c=-Number.MAX_VALUE,g=Number.MAX_VALUE;const u=[],f=[],h=[],M=_.keys(heatMapData[0])[2];for(var H=0;H<heatMapData.length;H++)y[H]=_.values(heatMapData[H]),u[H]=y[H][0],f[H]=y[H][1],null!==y[H][2]&&(y[H][2]>c&&(c=y[H][2]),y[H][2]<g&&(g=y[H][2]));for(_.isUndefined(r)&&(r=1==heatMapData.length?1:c),_.isUndefined(o)&&(o=1==heatMapData.length?0:g),H=0;H<heatMapData.length;H++)null!==y[H][2]&&(y[H][2]>r?h[H]=100:y[H][2]<o?h[H]=0:h[H]=100*(y[H][2]-o)/(r-o));var O=[],v="#000000";for(H=0;H<y.length;H++)v=null!==h[H]?s(h[H]):"#000000",O.push(L.circle([u[H],f[H]],{stroke:!1,color:v,fillColor:v,fillOpacity:n,radius:i,stroke:!1})),p&&O.push(L.marker(new L.LatLng(u[H],f[H]),{icon:l.createLabelIcon("boldWhiteHeatMapLabel",nFormatter(y[H][2]))}));l.configStore[a-1]={color:s,fillOpacity:n,radius:i,minValue:o,maxValue:r};t=L.layerGroup(O);if(l.mapLayers.heatMap.heatMapLayers[a-1]=t.addTo(l.map),l.ctrl.addBaseLayer(l.mapLayers.heatMap.heatMapLayers[a-1],M),!m){var P=L.latLng(_.max(u),_.max(f)),E=L.latLng(_.min(u),_.min(f)),b=L.latLngBounds(P,E);l.map.fitBounds(b)}l.map.invalidateSize(),l.createLegend(s,100,d,o,r,M),l.showLegend(M),_.isUndefined($("input[name*='leaflet-base-layers']")[l.numberOfHeatMapLayers-1])||$("input[name*='leaflet-base-layers']")[l.numberOfHeatMapLayers-1].click()},this.createLegend=function(e,a,r,o,s,n){o=Number(o),s=Number(s);_.isUndefined(modelsHiddenParams[t].legends[n])||l.map.removeControl(modelsHiddenParams[t].legends[n]),modelsHiddenParams[t].legends[n]=L.control({position:"topleft"}),modelsHiddenParams[t].legends[n].onAdd=function(t){for(var i=L.DomUtil.create("div","scaleLegend"),l="",d=0;d<a;d++)l=l+'<rect height="10" x="'+4*d+'" width="4" style="fill: '+e(d)+';"></rect>';var m,p='<svg id="legend" width="450" height="50"><g class="key" transform="translate(25,16)">'+l,y=o;m=nFormatter(o,2);for(d=0;d<r.length;d++)p=p+'<g class="tick" transform="translate('+4*r[d]+',0)" style="opacity: 1;"><line y2="-1" x2="0"></line><text dy="0em" y="-4" x="0" style="text-anchor: middle;">'+m+"</text></g>",y+=(s-o)/4,m=nFormatter(y,2);return p=(p+='<path class="domain" d="M0,-1V0H400V-1"></path>')+'<text class="" y="21">'+n+"</text>",p+="</g></svg>",i.innerHTML=p,i}},this.drawHeatMap1=function(e,a){if(_.isEmpty(l.mapLayers.heatMap.heatMapLayers[a-1])||(l.ctrl.removeLayer(l.mapLayers.heatMap.heatMapLayers[a-1]),l.map.removeLayer(l.mapLayers.heatMap.heatMapLayers[a-1]),l.mapLayers.heatMap.heatMapLayers[a-1].remove(),delete l.mapLayers.heatMap.heatMapLayers[a-1]),!(_.isUndefined(e)||_.isEmpty(e)||_.isUndefined(e.data)||(heatMapData=e.data,_.isUndefined(heatMapData.length)))){for(var t=[],r=Number.MIN_VALUE,o=[],s=[],n=_.keys(heatMapData[0])[2],i=0;i<heatMapData.length;i++)t[i]=_.values(heatMapData[i]),o[i]=t[i][0],s[i]=t[i][1],t[i][2]>r&&(r=t[i][2]);1==heatMapData.length&&(r=1),r=1;var d,m,p,y,c,g=null,u=!1;try{heatMapConfig=e.config,d=heatMapConfig.minOpacity,m=heatMapConfig.maxZoom,p=heatMapConfig.radius,y=heatMapConfig.blur,u=heatMapConfig.disableAutoscale,g=new Object,c=l.getColorScale(heatMapConfig.colorScale,heatMapConfig.reverseColorScale,0,1),d3.range(11).forEach(e=>g[.1*e]=c(.1*e))}catch(e){g=null}if(l.mapLayers.heatMap.heatMapLayers[a-1]=L.meanLayer(t,{minOpacity:d,maxZoom:m,max:r,radius:p,blur:y,gradient:g}).addTo(l.map),l.ctrl.addBaseLayer(l.mapLayers.heatMap.heatMapLayers[a-1],n),!u){var f=L.latLng(_.max(o),_.max(s)),h=L.latLng(_.min(o),_.min(s)),M=L.latLngBounds(f,h);l.map.fitBounds(M)}l.map.invalidateSize()}},_.isUndefined(modelsParameters[t].heatMap.densityHeatMap)||modelsParameters[t].heatMap.densityHeatMap?this.drawHeatMap=l.drawHeatMap1:this.drawHeatMap=l.drawHeatMap2,this.clearHeatMapLayer=function(e){l.mapLayers.heatMap.heatMapLayers[e-1].clearLayers()},this.psetHeatMap=function(e,a){if(!_.isUndefined(e)&&!_.isEmpty(e)&&!_.isEmpty(e.data)){var r,o=e.data;r=_.isUndefined(e.config)?{data:[o]}:{data:[o],config:e.config};var s=_.values(e.data);if(_.isEmpty(l.mapLayers.heatMap.heatMapLayers[a-1]))l.drawHeatMap(r,a);else{if(_.isUndefined(modelsParameters[t].heatMap.densityHeatMap))l.mapLayers.heatMap.heatMapLayers[a-1].addLatLng(s);else if(modelsHiddenParams[t].heatMap.densityHeatMap)l.mapLayers.heatMap.heatMapLayers[a-1].addLatLng(s);else{const n=r.config||{},i={circleFillOpacity:n.opacity,circleRadius:n.radius,maxValue:n.max,minValue:n.min},d=l.configStore[a-1],m={circleFillOpacity:d.fillOpacity,circleRadius:d.radius,maxValue:d.maxValue,minValue:d.minValue};if(!(void 0!==i.circleFillOpacity&&i.circleFillOpacity!==m.circleFillOpacity||void 0!==i.circleRadius&&i.circleRadius!==m.circleRadius||void 0!==i.maxValue&&i.maxValue!==m.maxValue||void 0!==i.minValue&&i.minValue!==m.minValue)){let e=100*(s[2]-l.configStore[a-1].minValue)/(l.configStore[a-1].maxValue-l.configStore[a-1].minValue);e<0&&(e=0),e>100&&(e=100),modelsHiddenParams[t].heatMap.heatMapBuffer[a-1].push(o);const r=L.circle([o.lat,o.lng],{color:l.configStore[a-1].color(e),fillColor:l.configStore[a-1].color(e),fillOpacity:l.configStore[a-1].fillOpacity,radius:l.configStore[a-1].radius,stroke:!1});l.mapLayers.heatMap.heatMapLayers[a-1].addLayer(r)}else{l.configStore[a-1].minValue=r.config.min,l.configStore[a-1].maxValue=r.config.max,l.configStore[a-1].radius=r.config.radius,l.configStore[a-1].fillOpacity=r.config.opacity,l.clearHeatMapLayer(a),modelsHiddenParams[t].heatMap.heatMapBuffer[a-1].push(o);const s={data:modelsHiddenParams[t].heatMap.heatMapBuffer[a-1],config:e.config};l.drawHeatMap(s,a)}}_.isUndefined(e.config)||_.isUndefined(e.config.disableAutoscale)?l.map.setView(o):e.config.disableAutoscale||l.map.setView(o)}}},modelsParameters[t].geoJson.numberOfLayers>0)for(let e=1;e<=l.numberOfGeoJsonLayers;e++){_.isUndefined(modelsHiddenParams[t].geoJson.geoJsonLayers[e-1])&&(modelsHiddenParams[t].geoJson.geoJsonLayers[e-1]={}),_.isUndefined(l.mapLayers.geoJson.geoJsonLayers[e-1])&&(l.mapLayers.geoJson.geoJsonLayers[e-1]={});this["geoJson"+e]={layerIndex:e,updateCallback:function(){},setValue:function(e){modelsHiddenParams[t].geoJson.geoJsonLayers[this.layerIndex-1]=e,l.addGeoJson(e,this.layerIndex)},getValue:function(){return modelsHiddenParams[t].geoJson.geoJsonLayers[e-1]},addValueChangedHandler:function(e){this.updateCallback=e},removeValueChangedHandler:function(e){}}}if(modelsParameters[t].choropleth&&modelsParameters[t].choropleth.numberOfLayers>0)for(let e=1;e<=l.numberOfChoroplethLayers;e++){_.isUndefined(modelsHiddenParams[t].choropleth.choroplethLayers[e-1])&&(modelsHiddenParams[t].choropleth.choroplethLayers[e-1]={}),_.isUndefined(l.mapLayers.choropleth.choroplethLayers[e-1])&&(l.mapLayers.choropleth.choroplethLayers[e-1]={});this["choropleth"+e]={layerIndex:e,updateCallback:function(){},setValue:function(e){modelsHiddenParams[t].choropleth.choroplethLayers[this.layerIndex-1]=e,l.addChoropleth(e,this.layerIndex)},getValue:function(){return modelsHiddenParams[t].choropleth.choroplethLayers[e-1]},addValueChangedHandler:function(e){this.updateCallback=e},removeValueChangedHandler:function(e){}}}if(modelsParameters[t].lineHeatMap&&modelsParameters[t].lineHeatMap.numberOfLayers>0)for(let e=1;e<=l.numberOfLineHeatMapLayers;e++){_.isUndefined(modelsHiddenParams[t].lineHeatMap.lineHeatMapLayers[e-1])&&(modelsHiddenParams[t].lineHeatMap.lineHeatMapLayers[e-1]={}),_.isUndefined(l.mapLayers.lineHeatMap.lineHeatMapLayers[e-1])&&(l.mapLayers.lineHeatMap.lineHeatMapLayers[e-1]={});this["lineHeatMap"+e]={layerIndex:e,updateCallback:function(){},setValue:function(e){modelsHiddenParams[t].lineHeatMap.lineHeatMapLayers[this.layerIndex-1]=e,l.addLineHeatMap(e,this.layerIndex)},getValue:function(){return modelsHiddenParams[t].lineHeatMap.lineHeatMapLayers[e-1]},addValueChangedHandler:function(e){this.updateCallback=e},removeValueChangedHandler:function(e){}}}if(modelsParameters[t].heatMap.numberOfLayers>0)for(let e=1;e<=l.numberOfHeatMapLayers;e++){const a="heatMapData"+e,r="heatMapPoint"+e;_.isUndefined(modelsHiddenParams[t].heatMap.heatMapData[e-1])&&(modelsHiddenParams[t].heatMap.heatMapData[e-1]={}),_.isUndefined(modelsHiddenParams[t].heatMap.heatMapBuffer[e-1])&&(modelsHiddenParams[t].heatMap.heatMapBuffer[e-1]=[]),_.isUndefined(l.mapLayers.heatMap.heatMapLayers[e-1])&&(l.mapLayers.heatMap.heatMapLayers[e-1]={}),modelsParameters[t].heatMap.sampledDisplay?this[r]={layerIndex:e,updateCallback:function(){},setValue:function(e){l.bIsInteractive&&l.psetHeatMap(e,this.layerIndex)},getValue:function(){},addValueChangedHandler:function(e){this.updateCallback=e},removeValueChangedHandler:function(e){}}:this[a]={layerIndex:e,updateCallback:function(){},setValue:function(e){e!=modelsHiddenParams[t].heatMap.heatMapData[this.layerIndex-1]&&(modelsHiddenParams[t].heatMap.heatMapData[this.layerIndex-1]=e,l.drawHeatMap(e,this.layerIndex))},getValue:function(){return modelsHiddenParams[t].heatMap.heatMapData[this.layerIndex-1]},addValueChangedHandler:function(e){this.updateCallback=e},removeValueChangedHandler:function(e){}}}if(l.numberOfImageLayers>0)for(let e=1;e<=l.numberOfImageLayers;e++){const a="imageOverlay"+e;_.isUndefined(modelsHiddenParams[t].imageOverlay.imageData[e-1])&&(modelsHiddenParams[t].imageOverlay.imageData[e-1]={}),_.isUndefined(l.mapLayers.imageOverlay.imageLayers[e-1])&&(l.mapLayers.imageOverlay.imageLayers[e-1]={}),this[a]={layerIndex:e,updateCallback:function(){},setValue:function(e){e!=modelsHiddenParams[t].imageOverlay.imageData[this.layerIndex-1]&&(modelsHiddenParams[t].imageOverlay.imageData[this.layerIndex-1]=e,l.addImageOverlay(e,this.layerIndex))},getValue:function(){return modelsHiddenParams[t].imageOverlay.imageData[this.layerIndex-1]},addValueChangedHandler:function(e){this.updateCallback=e},removeValueChangedHandler:function(e){}}}if(l.numberOfSvgLayers>0)for(let e=1;e<=l.numberOfSvgLayers;e++){const a="svgOverlay"+e,r="svgPoint"+e;_.isUndefined(modelsHiddenParams[t].svgOverlay.svgData[e-1])&&(modelsHiddenParams[t].svgOverlay.svgData[e-1]={}),_.isUndefined(l.mapLayers.svgOverlay.svgLayers[e-1])&&(l.mapLayers.svgOverlay.svgLayers[e-1]={}),modelsParameters[t].svgOverlay.sampledDisplay?this[r]={layerIndex:e,updateCallback:function(){},setValue:function(e){l.bIsInteractive&&l.psetSvg(e,this.layerIndex)},getValue:function(){},addValueChangedHandler:function(e){this.updateCallback=e},removeValueChangedHandler:function(e){}}:this[a]={layerIndex:e,updateCallback:function(){},setValue:function(e){modelsHiddenParams[t].svgOverlay.svgData[this.layerIndex-1]=e,l.addSvgOverlay(e,this.layerIndex,!1)},getValue:function(){return modelsHiddenParams[t].svgOverlay.svgData[this.layerIndex-1]},addValueChangedHandler:function(e){this.updateCallback=e},removeValueChangedHandler:function(e){}}}const p=new WidgetActuatorDescription("selectedPoint","Selected coordinates",WidgetActuatorDescription.WRITE,_SCHEMA_SELECTED_POINT),y=new WidgetActuatorDescription("selectedGeoJson","Drawn GeoJSON figure",WidgetActuatorDescription.WRITE,_SCHEMA_SELECTED_GEOJSON);this.getActuatorDescriptions=function(e=null){const a=e||modelsParameters[t],r=[];if(a){if(a.captureClickEvent&&r.push(p),a.drawingFeatures&&r.push(y),a.geoJson&&a.geoJson.numberOfLayers)for(let e=1;e<=a.geoJson.numberOfLayers;e++)r.push(new WidgetActuatorDescription("geoJson"+e,"GeoJSON features",WidgetActuatorDescription.READ,_SCHEMA_GEOJSON));if(a.lineHeatMap&&a.lineHeatMap.numberOfLayers)for(let e=1;e<=a.lineHeatMap.numberOfLayers;e++)r.push(new WidgetActuatorDescription("lineHeatMap"+e,"Lines colored by values",WidgetActuatorDescription.READ,_SCHEMA_LINE_HEATMAP));if(a.choropleth&&a.choropleth.numberOfLayers)for(let e=1;e<=a.choropleth.numberOfLayers;e++)r.push(new WidgetActuatorDescription("choropleth"+e,"Choropleth data",WidgetActuatorDescription.READ,_SCHEMA_CHOROPLETH));if(a.heatMap&&a.heatMap.numberOfLayers)for(let e=1;e<=a.heatMap.numberOfLayers;e++)if(a.heatMap.sampledDisplay){const t="heatMapPoint"+e;a&&!a.densityHeatMap?r.push(new WidgetActuatorDescription(t,"Cumulative heatmap",WidgetActuatorDescription.READ,_SCHEMA_HEATMAP_SAMPLED)):r.push(new WidgetActuatorDescription(t,"Cumulative density heatmap",WidgetActuatorDescription.READ,_SCHEMA_HEATMAP_DENSITY_SAMPLED))}else{const t="heatMapData"+e;a&&!a.densityHeatMap?r.push(new WidgetActuatorDescription(t,"Heatmap",WidgetActuatorDescription.READ,_SCHEMA_HEATMAP)):r.push(new WidgetActuatorDescription(t,"Density heatmap",WidgetActuatorDescription.READ,_SCHEMA_HEATMAP_DENSITY))}if(a.imageOverlay&&a.imageOverlay.numberOfLayers)for(let e=1;e<=a.imageOverlay.numberOfLayers;e++)r.push(new WidgetActuatorDescription("imageOverlay"+e,"Image to place on the map",WidgetActuatorDescription.READ,_SCHEMA_IMAGE_OVERLAY));if(a.svgOverlay&&a.svgOverlay.numberOfLayers)for(let e=1;e<=a.svgOverlay.numberOfLayers;e++)a.svgOverlay.sampledDisplay?r.push(new WidgetActuatorDescription("svgPoint"+e,"Place a symbol on the map",WidgetActuatorDescription.READ,_SCHEMA_SVG_POINT_OVERLAY)):r.push(new WidgetActuatorDescription("svgOverlay"+e,"Place symbols on the map",WidgetActuatorDescription.READ,_SCHEMA_SVG_OVERLAY))}return r},l.render()},this.openStreetMapsWidget.prototype=baseWidget.prototype,this.pluginDefinition={name:"Maps",widgetsDefinitionList:{openStreetMaps:{factory:"openStreetMapsWidget",title:"Leaflet maps",icn:"map",help:"wdg/wdg-geo-time/#leaflet-maps"}}},this.constructor()}mapWidgetsPluginClass.prototype=basePlugin.prototype;var mapWidgetsPlugin=new mapWidgetsPluginClass;widgetsPluginsHandler.loadWidgetPlugin(mapWidgetsPlugin);
function foliumWidgetPluginClass(){this.foliumMapWidget=function(i,t,e,n){this.constructor(i,t,e,n);var l=this;this.enable=function(){},this.disable=function(){},this.rescale=function(){this.render()},this.hasScrollBar=function(i){return i.get(0).scrollHeight>i.get(0).clientHeight},this.render=function(){let l=document.createElement("div"),o="folium-map"+t;if(n&&(o+="c"),l.setAttribute("id",o),modelsHiddenParams[e].map){l.innerHTML=modelsHiddenParams[e].map;try{div1=l.firstElementChild,"DIV"==div1.tagName&&(div1.style.height="100%",div2=div1.firstElementChild,"DIV"==div2.tagName&&(div2.style.height="100%",div2.style["padding-bottom"]=null,div3=div2.firstElementChild,"DIV"==div3.tagName&&(div3.style.height="100%")))}catch(i){console.log(i)}}l.setAttribute("style","width: inherit; height: inherit; background-color:"+modelsParameters[e].backgroundColor),$("#"+i).html(l)};const o=new WidgetActuatorDescription("_repr_html_","Folium Map _repr_html_",WidgetActuatorDescription.READ,WidgetPrototypesManager.SCHEMA_STRING);this.getActuatorDescriptions=function(){return[o]},this._repr_html_={setValue:function(i){modelsHiddenParams[e].map=i,l.render()},getValue:function(){return modelsHiddenParams[e].map},addValueChangedHandler:function(i){l.enable()},removeValueChangedHandler:function(i){l.disable()}},l.render()},this.foliumMapWidget.prototype=baseWidget.prototype,this.pluginDefinition={name:"Maps",widgetsDefinitionList:{foliumMaps:{factory:"foliumMapWidget",title:"Folium Map",icn:"folium",help:""}}},this.constructor()}modelsHiddenParams.foliumMaps={map:""},modelsParameters.foliumMaps={backgroundColor:"rgba(0, 0, 0, 0)"},modelsLayout.foliumMaps={height:"30vh",width:"30vw",minWidth:"50px",minHeight:"32px"},foliumWidgetPluginClass.prototype=basePlugin.prototype;var foliumWidgetPlugin=new foliumWidgetPluginClass;widgetsPluginsHandler.loadWidgetPlugin(foliumWidgetPlugin);
var scalingManager=function(h,t,e){var i=this;function w(h){switch(i.method){case"scaleTwSp":return i.scaleTwSp(h);case"scaleTwSpWS":return i.scaleTwSpWS(h);case"scaleTwSd":return i.scaleTwSd(h);case"scaleTwh":return i.scaleTwh(h);case"scaleTwhS":return i.scaleTwhS(h);case"scaleIdent":default:return i.scaleIdent(h)}}return i.srcDash=h,i.tgDash=t,i.method=e,this.scaleTwSp=function(h){if(_.isUndefined(i.srcDash))return h;var t={},e=i.tgDash,w=i.srcDash;return t.widthVw=h.widthVw/w.widthVw*e.widthVw,t.leftVw=h.leftVw/w.widthVw*e.widthVw,t.heightVh=h.heightVh*(w.heightPx/w.widthPx)*(e.widthPx/e.heightPx)*(e.heightVh/w.heightVh),t.topVh=h.topVh*(w.heightPx/w.widthPx)*(e.widthPx/e.heightPx)*(e.heightVh/w.heightVh),t},this.scaleTwSpWS=function(h){if(_.isUndefined(i.srcDash))return h;var t={},e=i.tgDash,w=i.srcDash;return t.widthVw=h.widthVw/w.scrollWidthVw*e.widthVw,t.leftVw=h.leftVw/w.scrollWidthVw*e.widthVw,t.heightVh=h.heightVh*(w.heightPx/w.scrollWidthPx)*(e.widthPx/e.heightPx)*(e.heightVh/w.heightVh),t.topVh=h.topVh*(w.heightPx/w.scrollWidthPx)*(e.widthPx/e.heightPx)*(e.heightVh/w.heightVh),t},this.scaleTwSd=function(h){if(_.isUndefined(i.srcDash))return h;var t={},e=i.tgDash,w=i.srcDash;return t.widthVw=h.widthVw/w.widthVw*e.widthVw,t.leftVw=h.leftVw/w.widthVw*e.widthVw,h.widthPx=h.widthVw/w.widthVw*w.widthPx,h.heightPx=h.heightVh/w.heightVh*w.heightPx,h.topPx=h.topVh/w.heightVh*w.heightPx,t.heightPx=h.heightPx,t.topPx=h.topPx,t},this.scaleTwh=function(h){if(_.isUndefined(i.srcDash))return h;var t={},e=i.tgDash,w=i.srcDash;return t.widthVw=h.widthVw/w.widthVw*e.widthVw,t.leftVw=h.leftVw/w.widthVw*e.widthVw,t.heightVh=h.heightVh/w.heightVh*e.heightVh,t.topVh=h.topVh/w.heightVh*e.heightVh,t},this.scaleTwhS=function(h){if(_.isUndefined(i.srcDash))return h;var t={},e=i.tgDash,w=i.srcDash;return t.widthVw=h.widthVw/w.scrollWidthVw*e.widthVw,t.leftVw=h.leftVw/w.scrollWidthVw*e.widthVw,t.heightVh=h.heightVh/w.scrollHeightVh*e.heightVh,t.topVh=h.topVh/w.scrollHeightVh*e.heightVh,t},this.scaleIdent=function(h){if(_.isUndefined(i.srcDash))return h;var t={};i.tgDash,i.srcDash;return t.widthVw=h.widthVw,t.leftVw=h.leftVw,t.heightVh=h.heightVh,t.topVh=h.topVh,t},{setMethod:function(h){i.method=h},scale:w,applyRescale:function(h){var t,e,i,V,s,d,r,n;if(h.nodeType==Node.ELEMENT_NODE)for(t=h.style.width,s=rmUnit(t),V=h.style.left,d=rmUnit(V),e=h.style.height,r=rmUnit(e),i=h.style.top,n=w({widthVw:s,leftVw:d,heightVh:r,topVh:rmUnit(i)}),h.style.width=n.widthVw+"vw",h.style.left=n.leftVw+"vw",h.style.height=n.heightVh+"vh",h.style.top=n.topVh+"vh",wcChildren=h.getElementsByTagName("div"),k=0;k<wcChildren.length;k++)-1!=wcChildren[k].id.search("WidgetContainer")&&(wcChildren[k].style.width=n.widthVw-100/document.documentElement.clientWidth*2+"vw",wcChildren[k].style.height=n.heightVh-100/document.documentElement.clientHeight*2+"vh")}}};
var inputHandler={encodeInputPars:function(a){return btoa(JSON.stringify(a))},decodeInputPars:function(a){try{return JSON.parse(atob(a))}catch(a){return console.log(a),null}},patchInputVariables:function(a,t){return _.each(t,t=>{a=function(a,t,e){let n=!1;_.isUndefined(a.data.datanodes)&&(a.data.datanodes=a.data.datasources);for(var d=0;d<a.data.datanodes.length;d++)a.data.datanodes[d].name==t&&(n=!0,"JSON_var_plugin"==a.data.datanodes[d].type?a.data.datanodes[d].settings.json_var=JSON.stringify(e):console.log("patchVariableDataNode failed : dataNode "+t+"  is not a variable"));return n||console.log("patchVariableDataNode failed : unable to find dataNode "+t),a}(a,t.dsName,t.dsVal)}),a}};
var rescaleHelper=function(e,t,i){var o=this;function s(){switch(o.mode){case"edit":return"";case"preview":return"c"}}function r(){var e="";switch(o.mode){case"edit":break;case"preview":e="c"}if(o.rows){const t=o.cols*o.rows;switch(o.scalingMethod){case"scaleTwhS":for(let i=1;i<=t;i++)$("#dpr"+i+e)[0].style.height="100%";break;case"scaleTwSp":for(let t=1;t<=o.rows;t++){const i=o.cellProportion[t],s=(t-1)*o.cols+1,r=$("#dpr"+s+e).width(),n=Math.floor(i*r)+2;for(let t=0;t<o.cols;t++)$("#dpr"+(s+t)+e)[0].style.height=n+"px"}break;case"scaleTwh":case"scaleIdent":for(let e=1;e<=o.rows;e++){o.cols;for(let e=0;e<o.cols;e++);}}switch(o.mode){case"edit":layoutMgr.updateMaxTopAndLeft()}}}function n(){let e=null;const t=$("#dpr1"+s());switch(o.rows){case 0:break;case 1:if(e={widthPx:t.width()+2,heightPx:t.height()+2,widthVw:100*(t.width()+2)/document.documentElement.clientWidth,heightVh:100*(t.height()+2)/document.documentElement.clientHeight},"undefined"!=typeof layoutMgr){const t=layoutMgr.getHeightCols();e.rowHeightPercent=t.length?t[0]:100}break;default:if(e={widthPx:t.width()+16,heightPx:t.height()+2,widthVw:100*(t.width()+16)/document.documentElement.clientWidth,heightVh:100*(t.height()+2)/document.documentElement.clientHeight},"undefined"!=typeof layoutMgr){const t=layoutMgr.getHeightCols();e.rowHeightPercent=t.length?t[0]:100}}return e}function d(){switch(o.rows){case 0:o.cellProportion=1;break;default:o.cellProportion=[];for(let e=1;e<=o.rows;e++){const t=1+(e-1)*o.cols,i=$("#dpr"+t+s());o.cellProportion[e]=i.height()/i.width()}}}return o.dashboardDimensions=e,o.scalingMethod=t,o.mode=i,o.cellProportion=1,o.rows=0,o.cols=1,{setDimensions:function(e){o.dashboardDimensions=e},setScalingMethod:function(e){o.scalingMethod=e},setRows:function(e){o.rows=e},setCols:function(e){o.cols=e},getCols:function(){return o.cols},resizeDashboard:function(e){r();var t=function(){switch(o.mode){case"edit":return widgetEditor.getCurrentDashZoneDims();case"preview":return widgetPreview.getCurrentDashZoneDims()}}(o.mode);_.isUndefined(e)||(t=e);var i=new scalingManager(o.dashboardDimensions,t,o.scalingMethod);o.dashboardDimensions=t;const n=function(){switch(o.mode){case"edit":return document.getElementById("drop-zone");case"preview":return document.getElementById("dashboard-zone")}}(o.mode);for(let e=0;e<n.childNodes.length;e++){const t=n.childNodes[e];if(t.id=="DropperDroite"+s(o.mode))for(let e=0;e<t.childNodes.length;e++){const s=t.childNodes[e];if(""===s.id)return;if($("#"+s.id).hasClass("device-col"))for(let e=0;e<s.childNodes.length;e++){let t;t="edit"==o.mode?s.childNodes[e].childNodes[0]:s.childNodes[e],i.applyRescale(t)}else{let e;e="edit"==o.mode?s.childNodes[0]:s,i.applyRescale(e)}}}},resizeWidgetOnMediaChange:function(e,t){const i=function(){switch(o.mode){case"edit":return widgetEditor.getWidgetsRelativeDims().width;case"preview":return widgetPreview.getWidgetsRelativeDims().width}}(),s=function(){switch(o.mode){case"edit":return widgetEditor.getWidgetsRelativeDims().height;case"preview":return widgetPreview.getWidgetsRelativeDims().height}}(),r=function(){switch(o.mode){case"edit":return widgetEditor.getWidgetsRelativeDims().left;case"preview":return widgetPreview.getWidgetsRelativeDims().left}}(),n=function(){switch(o.mode){case"edit":return widgetEditor.getWidgetsRelativeDims().top;case"preview":return widgetPreview.getWidgetsRelativeDims().top}}(),d=$("#"+t)[0];let c=0,h=0,l=0,a=0;switch(o.mode){case"edit":c=$(d.parentNode.parentNode).width()*i[e]+2,h=$(d.parentNode.parentNode).height()*s[e]+2,l=$(d.parentNode.parentNode).width()*r[e],a=$(d.parentNode.parentNode).height()*n[e];break;case"preview":c=$(d.parentNode).width()*i[e]+2,h=$(d.parentNode).height()*s[e]+2,l=$(d.parentNode).width()*r[e],a=$(d.parentNode).height()*n[e]}const g=rmUnit(unitW(c)),w=rmUnit(unitH(h)),u=rmUnit(unitW(l)),m=rmUnit(unitH(a));d.style.left=u+"vw",d.style.top=m+"vh",d.style.width=g+"vw",d.style.height=w+"vh"},getCurrentDropperDims:n,resizeDashboardCols:r,mediaChangeProjection:function(e,t,i){var o,s=e,r=isMediaChanged(e.media);return r.bChanged,o=r.lastMedia,i?(s.widthVw=e.colDims.widthVw,s.widthPx=e.colDims.widthPx,s.scrollWidthVw=e.colDims.widthVw,s.scrollWidthPx=e.colDims.widthPx,s.heightVh=e.colDims.heightVh,s.heightPx=e.colDims.heightPx,s.scrollHeightVh=e.colDims.heightVh,s.scrollHeightPx=e.colDims.heightPx,{lastMedia:o,referenceFrame:s,targetFrame:t=n()}):{lastMedia:o,referenceFrame:s,targetFrame:t}},setCellProportion:function(e){o.cellProportion=e},updateCellsProportions:d,computeRelativeColHeigth:function(e){var t=100,i=e.heightPx;if(_.isUndefined(e.colDims.heightPx))return 100;switch(t=e.colDims.heightPx,o.scalingMethod){case"scaleTwhS":return 100;case"scaleTwSp":return Math.ceil((t+2)/i*100);case"scaleTwh":case"scaleIdent":return Math.ceil((t+2)/i*100)}},deserialize:function(e){if(!_.isUndefined(e)){if(e.colDims)switch(o.rows){case 0:o.cellProportion=1;break;default:o.cellProportion=[];for(let t=1;t<=o.rows;t++)o.cellProportion[t]=e.colDims.heightPx/e.colDims.widthPx}switch(e.scalingMethod){case"scaleTwSp":break;case"scaleTwh":case"scaleIdent":for(var t=1;t<=o.rows;t++)for(var i=(t-1)*o.cols+1,r=0;r<o.cols;r++)$("#dpr"+(i+r)+s())[0].style.height=e.colDims.heightVh+"vh";d()}}}}};
function gridMgrClass(){var t=20,i=20;this.getGrid=function(){return $("#DropperDroite")[0].classList.contains("show-grid")?{sizeX:t,sizeY:i}:null},this.updateGrid=function(){!function(){widgetEditor.updateSnapshotDashZoneDims();const r=widgetEditor.getSnapshotDashZoneDims();t=(r.widthPx-22)/48,i=(r.heightPx-4)/24,t=Math.max(1,Math.round(t)),i=Math.max(1,Math.round(i))}();const r=`${t}px ${i}px`;$(".dropperR:not(#DropperDroitec), .dropperR:not(#DropperDroitec) .device-col").each((function(){this.style["background-size"]=r}))}}var gridMgr=new gridMgrClass;
const keyShift=5,minLeftCst=10,minTopCst=10,minHeightCst=10,minWidthCst=10,MULTIPLE_HEIGHT=!1;class LayoutMgrClass{constructor(){this.drprD=$("#DropperDroite")[0],this.rows=0,this.cols=0,this.heightCols=[],this.newHeightCols=[],this.maxTopCst=15*this.drprD.offsetHeight,0==this.maxTopCst&&(this.maxTopCst=15*$("#DropperDroite").height()),this.maxLeftCst=panelDash.fullScreenWidth-10,this.scalingHelper=void 0,this.rowNames=[],this.defaultRow={},this.dashBgColor="",this.dashboardTheme="default",this.$rootScope=angular.element(document.body).scope().$root}findAllCells(){return $("#DropperDroite [id^='dpr']")}updateButtonState(){const e=this._readRows(),t=e?this._readCols():0;0===e?($("#select-cols").attr("disabled",!0),$("#height-row-button").attr("disabled",!0),$("#select-cols")[0].value="1"):($("#select-cols").attr("disabled",!1),$("#height-row-button").attr("disabled",!1));const s=this.rows!==e||this.cols!==t||!angular.equals(this.heightCols,this.newHeightCols);$("#buttonDevice")[0].disabled=!s}isRowColMode(){return this.rows>=1}getDefaultContainer(){return this.isRowColMode()?$("#dpr1")[0]:this.drprD}setScalingHelper(e){this.scalingHelper=e}updateMaxTopAndLeft(){const e=$(this.drprD);0===this.rows?(e.hasClass("overflow-type1")||(e.addClass("overflow-type1"),e.removeClass("overflow-type2"),e.removeClass("overflow-type3")),this.maxLeftCst=panelDash.fullScreenWidth-10,this.maxTopCst=15*this.drprD.offsetHeight,0==this.maxTopCst&&(this.maxTopCst=15*$("#DropperDroite").height())):1===this.rows?(e.hasClass("overflow-type2")||(e.addClass("overflow-type2"),e.removeClass("overflow-type1"),e.removeClass("overflow-type3")),this.maxLeftCst=this.drprD.offsetWidth-10-14,this.maxTopCst=this.drprD.childNodes[0].offsetHeight-10):this.rows>1&&(e.hasClass("overflow-type3")||(e.addClass("overflow-type3"),e.removeClass("overflow-type1"),e.removeClass("overflow-type2")),this.maxLeftCst=this.drprD.offsetWidth-10-14,this.maxTopCst=this.drprD.childNodes[0].offsetHeight*this.rows-10)}_updateNewHeightCols(e){if(0===e)this.newHeightCols=[];else{const t=100;if(1!==this.newHeightCols.length)this.newHeightCols=[t];else if(e!==this.rows&&1===this.heightCols.length){const e=this.heightCols[0],s=this.newHeightCols[0],o=this.rows*e;e===s&&o>=99&&o<=101&&(this.newHeightCols=[t])}}}configureRowHeight(){const e=this._readRows();if(!e)return;this._updateNewHeightCols(e);let t="";for(let e=0;e<1;e++)t+='<div class="Row">',t+='<div class="CellH"><label style="font-size: calc(8px + 0.4vw);font-weight: bold;">Height (%) of rows</label></div>',t+='<div class="Cell">',t+='<input type="number" min="15" max="150" name="height-cols_'+e+'" style="height:25px;width:100%" id="heightCols_'+e+'" value='+this.newHeightCols[e]+" />",t+="</div>",t+="</div>";t+="</div>";const s=document.createElement("div");s.innerHTML=t,s.setAttribute("style","display: inline-block");const o=this;new DialogBoxForToolboxEdit(s,"Configuration of each height's row","OK","Cancel",(function(){for(let e=0;e<1;e++){const t=parseInt($("#heightCols_"+e).val(),10);void 0!==t&&t>0&&(o.newHeightCols[e]=t)}}))}getRows(){return this.rows}getHeightCols(){return[...this.heightCols]}_readRows(){const e=$("#select-rows").val();return parseInt(e,10)}_readCols(){const e=$("#select-cols").val();return parseInt(e,10)}applyCells(){const e=this._readRows(),t=e?this._readCols():0;$("#DropperDroite")[0].scrollTo({top:0,left:0,behavior:"auto"}),this._updateNewHeightCols(e),angular.element(document.body).injector().invoke(["UndoManagerService","EditorActionFactory",(s,o)=>{const i=o.createUpdateLayoutAction(e,t,this.newHeightCols);s.execute(i)}]),this._updateExportOptions(),this.updateDashBgColor(),this._updateRowNames()}setLayout(e,t,s,o=!1){const i=this.rows!==e||this.cols!==t,l=!angular.equals(this.heightCols,s);if(this.rows=e,this.cols=t,this.newHeightCols=[...s],this.heightCols=[...s],i){this.cleanColumns(),this.scalingHelper.setRows(this.rows),this.scalingHelper.setCols(this.cols);const e=this._getClassType(this.cols);this._createColumn(e),0!==this.rows&&_.each(widgetEditor.modelsId,e=>{const t=document.getElementById(e);this.putWidgetInTheRightCol(t,10,10)})}else l&&(this._applyHeights(),this.scalingHelper.updateCellsProportions());if(o&&this.rows){const e=$("#dpr1");parseInt(e.css("min-height"))>e.height()&&swal(e[0].style.height+" is too small considering the size of your screen!","The minimum allowed height '"+e.css("min-height")+"' will be applied.","warning")}this.updateMaxTopAndLeft(),widgetEditor.updateSnapshotDashZoneDims(),$("select[name=select-rows]")[0].value=this.rows,$("select[name=select-cols]")[0].value=this.cols||1,this.updateButtonState()}getCols(){return this.cols}_getClassType(e){let t="";return 0===e?t="":1===e?t="col-md-12":2===e?t="col-md-6":3===e?t="col-md-4":4===e&&(t="col-md-3"),t}getTargetDivLayoutPx(e){return this.isRowColMode()?getElementLayoutPx(e):{top:10,left:10,height:this.maxTopCst,width:this.maxLeftCst}}cleanColumns(){const e=this.findAllCells();e.each((e,t)=>{const s=$(t).position(),o=s.top,i=s.left,l=[];t.childNodes.forEach(e=>l.push(e)),l.forEach(e=>{const t=e.firstChild,s=$(t).position(),l=s.top,a=s.left;$(e).appendTo($("#DropperDroite")),t.style.top=unitH(o+l),t.style.left=unitW(i+a)})}),e.remove(),this.drprD.classList.remove("has-device-col")}_getRowHeight(e){return void 0!==this.heightCols[0]?this.heightCols[0]:void 0!==this.heightCols[1]?this.heightCols[1]:100}_createColumn(e){this._createCols(e),this._applyHeights(),this.scalingHelper.updateCellsProportions()}_applyHeights(){for(let e=0;e<this.rows;e++){const t=this._getRowHeight(e),s=e*this.cols+1,o=s+this.cols;for(let e=s;e<o;e++)$("#dpr"+e)[0].style.height=t+"%"}}_createCols(e){if(this.rows){this.drprD.classList.add("has-device-col");const t=this.rows*this.cols;for(let s=1;s<=t;s++){const t=document.createElement("div");t.setAttribute("class",e+" device-col drop-zone-col"),t.setAttribute("id","dpr"+s),this.drprD.appendChild(t)}gridMgr.updateGrid()}}putWidgetInDrprD(e){if(this.isRowColMode()&&e&&e.parentNode){const t=e.parentNode.parentNode;if(t&&t.id.startsWith("dpr")){const s=e.offsetLeft+t.offsetLeft,o=e.offsetTop+t.offsetTop;$(this.drprD).append(e.parentNode),e.style.left=unitW(s),e.style.top=unitH(o)}}}putWidgetInTheRightCol(e,t,s){if(this.isRowColMode()){const o=e.offsetLeft;for(let i=1;i<=this.cols;i++){const l=o-t>=$("#dpr"+i)[0].offsetLeft;if((1===i||l)&&(i===this.cols||o-t<$("#dpr"+(i+1))[0].offsetLeft)){this._putWidgetInTheRightRow(e,i,t,s);break}}}}_putWidgetInTheRightRow(e,t,s,o){const i=e.offsetTop-o;for(let l=0;l<this.rows;l++){const a=this.cols*l+t,h=$("#dpr"+a)[0],r=i<h.offsetTop+h.offsetHeight,n=i>=h.offsetTop;if((r||l===this.rows-1)&&(n||0===l)){this._dropWidgetAndUpdatePosition(e,h,s,o);break}}}_dropWidgetAndUpdatePosition(e,t,s,o){t.append(e.parentNode);const i=e.offsetLeft-t.offsetLeft,l=e.offsetTop-t.offsetTop;e.style.left=unitW(i),e.style.top=unitH(l);const a=t.offsetWidth-s,h=t.offsetHeight-o;e.offsetTop>h-e.offsetHeight&&(e.style.top=unitH(h-e.offsetHeight)),e.offsetLeft>a-e.offsetWidth&&(e.style.left=unitW(a-e.offsetWidth))}makeColsTrasparent(){for(let e=1;e<=this.rows*this.cols;e++)$("#dpr"+e+"c").hasClass("col-invisible")||$("#dpr"+e+"c").addClass("col-invisible")}clear(){this.clearCols()}clearCols(){this.cols=0,this.rows=0,this.scalingHelper.setRows(this.rows),this.scalingHelper.setCols(this.cols),$("select[name=select-rows]")[0].value=this.rows,$("select[name=select-cols]")[0].value=1,this.heightCols=[],this.newHeightCols=[],this.rowNames=[],this.defaultRow={},this.updateMaxTopAndLeft()}onInputDashBgColor(){this.dashBgColor=$("#inputDashBgColor")[0].value,$(".dropperR").css("background-color",this.dashBgColor),this.$rootScope.updateFlagDirty(!0)}updateDashBgColor(){$("#inputDashBgColor").val(this.dashBgColor),$(".dropperR").css("background-color",this.dashBgColor)}resetDashBgColor(){this.dashBgColor="",$("#inputDashBgColor").val(""),$(".dropperR").css("background-color","")}serializeDashBgColor(){return{backgroundColor:this.dashBgColor}}deserializeDashBgColor(e){_.isUndefined(e.backgroundColor)||(this.dashBgColor=e.backgroundColor,this.updateDashBgColor())}onChangeDashboardTheme(e){this.dashboardTheme=e,$("html").attr("data-theme",this.dashboardTheme),$("#current-theme").attr("data-theme",this.dashboardTheme),widgetEditor.resizeDashboard(),this.$rootScope.updateFlagDirty(!0)}updateDashboardTheme(){$("html").attr("data-theme",this.dashboardTheme),$("#current-theme").attr("data-theme",this.dashboardTheme),widgetEditor.resizeDashboard()}resetDashboardTheme(){this.dashboardTheme="default",this.updateDashboardTheme()}serializeDashboardTheme(){return{theme:this.dashboardTheme}}deserializeDashboardTheme(e){_.isUndefined(e.theme)||(this.dashboardTheme=e.theme,this.updateDashboardTheme())}_updateExportOptions(){const e=htmlExport.exportOptions||"",t=this.getRows();0!=t||["adjustToFullWidth","ajustToTargetWindow","keepOriginalWidth"].includes(e)?t>=1&&!["projectToTargetWindow","rowToPage","rowToTab","customNavigation"].includes(e)&&(htmlExport.exportOptions="projectToTargetWindow"):htmlExport.exportOptions="adjustToFullWidth"}serializeExportOptions(){return htmlExport.exportOptions}deserializeExportOptions(e){_.isUndefined(e)||(htmlExport.exportOptions=e),this._updateExportOptions()}configureRowName(){const e=this.getRows();if(!e)return;this._updateRowNames();const t=Array.from({length:e},(e,t)=>`\n            <div class="dashboard-form__group dashboard-form__group--inline">\n                <div class="dashboard-form__label">\n                    <label>row ${t+1}</label>\n                </div>\n                <input type="text" name="row_${t+1}" id="row_${t+1}" value="${this.rowNames[t]}" />\n            </div>\n        `).join(""),s=document.createElement("div");s.innerHTML=t,s.setAttribute("style","display: inline-block; width: 100%;"),new DialogBoxForToolboxEdit(s,"Configuration of each row's name","OK","Cancel",function(){const e=this.rowNames.length;for(let t=0;t<e;t++){const e=$("#row_"+(t+1)).val();this.rowNames[t]=e}}.bind(this))}_updateRowNames(){const e=this.getRows();this.rowNames.length=e;for(let t=0;t<e;t++)this.rowNames[t]||(this.rowNames[t]="Page "+(t+1))}_getRowNames(){return this._updateRowNames(),this.rowNames}getRowNamesObj(){return this._getRowNames().map((e,t)=>({id:t+1,name:e}))}serializeRowNames(){return{pageNames:this._getRowNames()}}deserializeRowNames(e){_.isUndefined(e.pageNames)||(this.rowNames=e.pageNames)}_getDefaultRow(){if(!_.isEmpty(this.defaultRow))return this.defaultRow;return{id:"1",name:this._getRowNames()[0]}}getDefaultRowID(){const e=this._getDefaultRow(),t=this.getRows();return e.id<t?e.id:"1"}setDefaultRow(e){this.defaultRow=e}serializeDefaultRow(){return{defaultPage:htmlExport.exportOptions.includes("customNavigation")?this._getDefaultRow():{}}}deserializeDefaultRow(e){_.isUndefined(e.defaultPage)||(this.defaultRow=e.defaultPage)}deserialize(e,t){if(_.isUndefined(e))this.cols=0,this.rows=0,this.heightCols=[],this.newHeightCols=[],e={cols:{valueRow:"none",valueCol:"1",maxCells:0,maxCols:0,classType:""}};else{this.cols=e.cols.maxCols;const s=e.cols.maxCells;if(this.rows=s/(this.cols?this.cols:1),_.isUndefined(e.cols.valueRow))if(_.isUndefined(e.cols.value))e.cols.valueRow="none";else switch(e.cols.value){case"none":e.cols.valueRow="none";break;case"1":case"3":e.cols.valueRow="1";break;case"6":e.cols.valueRow="6";break;default:e.cols.valueRow="none"}if(_.isUndefined(e.cols.valueCol))if(_.isUndefined(e.cols.value))e.cols.valueCol="1";else switch(e.cols.value){case"none":case"1":e.cols.valueCol="1";break;case"3":case"6":e.cols.valueCol="3";break;default:e.cols.valueCol="1"}this.scalingHelper.setRows(this.rows),this.scalingHelper.setCols(this.cols),$("select[name=select-rows]")[0].value=this.rows,$("select[name=select-cols]")[0].value=this.cols?this.cols:1,this.cleanColumns();const o=this._getClassType(this.cols);this._createColumn(o),this.updateButtonState(),_.isUndefined(t)}return e}updateColHeight(e){if(this.heightCols=[],this.newHeightCols=[],_.isUndefined(e)||null===e.colDims)return;let t;t=_.isUndefined(e.colDims.rowHeightPercent)?this.scalingHelper.computeRelativeColHeigth(e):e.colDims.rowHeightPercent;for(let e=0;e<1;e++)this.heightCols.push(t),this.newHeightCols.push(t);this.updateMaxTopAndLeft(),this._applyHeights()}serializeCols(){const e={},t=this._getClassType(this.cols),s=this.rows?this.rows.toString():"none",o=this.rows&&this.cols?this.cols.toString():"1",i=this.rows*this.cols,l={valueRow:s,valueCol:o,maxCells:i,maxCols:this.cols,classType:t};for(let t=1;t<=i;t++){const s={},o=$("#dpr"+t)[0];if(o.hasChildNodes())for(let e=0;e<o.childNodes.length;e++){const t=o.childNodes[e];s["component"+e]=t.childNodes[0].id}e["dpr"+t]=s}return{cols:l,droppers:e}}deserializeCols(e,t){const s={};if(0==t.cols.maxCells){const t=_.values(e);_.each(t,e=>{s[e]="DropperDroite"})}else{const e=t.droppers,o=_.keys(e);for(let t=0;t<o.length;t++){const i=_.values(e[o[t]]);_.each(i,e=>{s[e]=o[t]})}}return s}}var layoutMgr=new LayoutMgrClass;$("select[name=select-rows]").on("change",(function(e){layoutMgr.updateButtonState()})),$("select[name=select-cols]").on("change",(function(e){layoutMgr.updateButtonState()}));
function enforceConstraints(t,e){var i=t.top,n=t.left,h=t.height,o=t.width,d=e.top+minTopCst,m=e.left+minLeftCst,s=e.height-2*minTopCst,f=e.width-2*minLeftCst;return w_b=i+h,w_r=n+o,c_b=d+s,c_r=m+f,h>s&&(h=s,w_b=i+s),o>f&&(o=f,w_r=n+f),i<d&&(i=d),n<m&&(n=m),w_b>c_b&&(i=c_b-h,w_b=c_b),w_r>c_r&&(n=c_r-o,w_r=c_r),{top:i,left:n,width:o,height:h}}function computeMaxWidthPx(t,e){var i=t.left,n=e.width-2*minLeftCst;return e.left+minLeftCst+n-i+minLeftCst}function computeMaxHeightPx(t,e){var i=t.top;return e.height-2*minTopCst+(e.top+minTopCst)-i+minTopCst}function computeContainerRelativeLayout(t,e){var i=t.height,n=t.width;return e?{top:minTopCst,left:minLeftCst,width:n-2*minLeftCst,height:i-2*minTopCst}:{top:0,left:0,width:n,height:i}}function computeRelativePxLayout(t,e){var i=t.top,n=t.left,h=t.height,o=t.width;return{top:i-e.top,left:n-e.left,width:o,height:h}}function pxToViewPort(t){var e={};return e.topVh=unitH(t.top),e.leftVw=unitW(t.left),e.heightVh=unitH(t.height),e.widthVw=unitW(t.width),e}function getElementLayoutPx(t){return{top:t.offsetTop,left:t.offsetLeft,height:t.offsetHeight,width:t.offsetWidth}}function getElementLayoutWithMarginPx(t){return{top:t.top+minTopCst,left:t.left+minLeftCst,height:t.height,width:t.width}}function getWidgetLayoutPx(t){return{top:t.offsetTop-minTopCst,left:t.offsetLeft-minLeftCst,height:t.offsetHeight,width:t.offsetWidth}}function applyLayoutStyleFromPx(t,e){var i=pxToViewPort(e);t.style.left=i.leftVw,t.style.top=i.topVh,t.style.width=i.widthVw,t.style.height=i.heightVh}function computeMainDivLayout(t,e){var i=widgetDefaultLayout.get();_.isUndefined(t)||_.isUndefined(t.left)||_.isUndefined(t.top)?(i.left=unitH(minLeftCst),i.top=unitW(minTopCst)):(i.left=t.left,i.top=t.top);var n=e.toString();return _.isUndefined(t)||_.isUndefined(t.width)||_.isUndefined(t.height)?(_.isUndefined(modelsLayout[n])||_.isUndefined(modelsLayout[n].width)||_.isUndefined(modelsLayout[n].height)||(i.width=modelsLayout[n].width,i.height=modelsLayout[n].height,_.isUndefined(modelsLayout[n].minWidth)||(i.minWidth=modelsLayout[n].minWidth,i.width=Math.max(parseFloat(i.minWidth)*(100/document.documentElement.clientWidth),parseFloat(i.width))+"vw"),_.isUndefined(modelsLayout[n].minHeight)||(i.minHeight=modelsLayout[n].minHeight,i.height=Math.max(parseFloat(i.minHeight)*(100/document.documentElement.clientHeight),parseFloat(i.height))+"vh")),i):(i.width=t.width,i.height=t.height,_.isUndefined(t.minWidth)?_.isUndefined(modelsLayout[n])||_.isUndefined(modelsLayout[n].minWidth)||(i.minWidth=modelsLayout[n].minWidth,i.width=Math.max(parseFloat(i.minWidth)*(100/document.documentElement.clientWidth),parseFloat(i.width))+"vw"):(i.minWidth=t.minWidth,i.width=Math.max(parseFloat(i.minWidth)*(100/document.documentElement.clientWidth),parseFloat(i.width))+"vw"),_.isUndefined(t.minHeight)?_.isUndefined(modelsLayout[n])||_.isUndefined(modelsLayout[n].minHeight)||(i.minHeight=modelsLayout[n].minHeight,i.height=Math.max(parseFloat(i.minHeight)*(100/document.documentElement.clientHeight),parseFloat(i.height))+"vh"):(i.minHeight=t.minHeight,i.height=Math.max(parseFloat(i.minHeight)*(100/document.documentElement.clientHeight),parseFloat(i.height))+"vh"),i)}function applyLayout(t,e){t.style.left=e.leftVw,t.style.top=e.topVh,t.style.width=e.widthVw,t.style.height=e.heightVh,_.isUndefined(e.minWidth)||(t.style.minWidth=e.minWidth),_.isUndefined(e.minHeight)||(t.style.minHeight=e.minHeight)}function enforceMinConsistency(t){return t.minWidth>t.width&&(t.minWidth=t.width),t.minHeight>t.height&&(t.minHeight=t.height),t}
function initEditWidget(){var t=$("#DropperDroite")[0],e=[],i=[],o=[],a=[],d=[],r=[],n=new Map;var s,l="",c="scaleTwh",g=new rescaleHelper(s,c,"edit");layoutMgr.setScalingHelper(g);var p=new Set;function h(t){t.removeAttribute("data-x"),t.removeAttribute("data-y"),t.removeAttribute("data-x0"),t.removeAttribute("data-y0"),t.removeAttribute("data-height"),t.removeAttribute("data-width"),t.removeAttribute("data-height0"),t.removeAttribute("data-width0"),t.removeAttribute("data-minRatioX"),t.removeAttribute("data-minRatioY"),t.removeAttribute("data-maxRatioX"),t.removeAttribute("data-maxRatioY"),t.removeAttribute("data-display-x"),t.removeAttribute("data-display-y")}function m(t){return{left:parseFloat(t.getAttribute("data-x0"))||0,top:parseFloat(t.getAttribute("data-y0"))||0,height:parseFloat(t.getAttribute("data-height0"))||1,width:parseFloat(t.getAttribute("data-width0"))||1}}if($("#DropperDroite")[0].hasChildNodes())for(var u=$("#DropperDroite")[0],f=u.childNodes.length-1;f>=0;f--)"menuWidget"!=u.childNodes[f].id&&u.childNodes[f].remove();function b(t){if(t.parentNode&&t.parentNode.parentNode){const e=t.parentNode.parentNode.id;if(e&&e.startsWith("dpr"))return e}return"DropperDroite"}function w(t,e){if("DropperDroite"===t)return e;{const i=$("#"+t).offset();return{...e,top:e.top+i.top,left:e.left+i.left}}}function v(t,e){if("DropperDroite"===t)return e;{const i=$("#"+t).offset();return{...e,top:e.top-i.top,left:e.left-i.left}}}function A(t,e,i){let[o,a]=t,[d,r]=e;return[Math.round((o-d)/i.sizeX)*i.sizeX+d,Math.round((a-r)/i.sizeY)*i.sizeY+r]}var D=null,M=[];interact("#DropperDroite").draggable({cursorChecker:(t,e,i,o)=>o?"pointer":"default",listeners:{start(t){M=[...p],(D=document.createElement("div")).classList.add("dragged-editor-selection-lasso"),document.body.appendChild(D);const e=t.clientX0+window.pageXOffset,i=t.clientY0+window.pageYOffset;D.style.left=e+"px",D.style.top=i+"px",D.style.width="0px",D.style.height="0px",D.setAttribute("data-x",e),D.setAttribute("data-y",i),D.setAttribute("data-x0",e),D.setAttribute("data-y0",i)},move(t){const e=parseFloat(D.getAttribute("data-x0"))||0,i=parseFloat(D.getAttribute("data-y0"))||0;let o=parseFloat(D.getAttribute("data-x"))||0,a=parseFloat(D.getAttribute("data-y"))||0;o+=t.dx,a+=t.dy,D.setAttribute("data-x",o),D.setAttribute("data-y",a);const d=Math.min(e,o),r=Math.max(e,o),s=Math.min(i,a),l=Math.max(i,a);D.style.left=d+"px",D.style.width=r-d+"px",D.style.top=s+"px",D.style.height=l-s+"px",p.clear();t.ctrlKey&&M.forEach(t=>p.add(t));for(const t of n.keys())if(!p.has(t)){const e=$("#"+t);if(e){const i=e.offset(),o=i.left,a=i.top,n=o+e.width(),c=a+e.height();o>=d&&o<=r&&n>=d&&n<=r&&a>=s&&a<=l&&c>=s&&c<=l&&p.add(t)}}H()},end(){M=[],D&&(D.parentNode.removeChild(D),D=null)}}}).on("tap",(function(){F()}));var W=null;interact("#DropperDroite .drop-zone-col").dropzone({accept:".drag-drop-new, .drag-drop-move",ondropactivate(t){t.target.classList.add("drop-possible")},ondragenter(t){t.target.classList.add("drop-over"),W=t.target},ondragleave(t){t.target.classList.remove("drop-over"),W=null},ondrop(t){},ondropdeactivate(t){t.target.classList.remove("drop-possible"),t.target.classList.remove("drop-over"),W=null}}),interact("#DropperDroite").dropzone({accept:".drag-drop-new",ondropactivate(t){t.target.classList.add("drop-possible")},ondragenter(t){t.target.classList.add("drop-over")},ondragleave(t){t.target.classList.remove("drop-over")},ondrop(t){},ondropdeactivate(t){t.target.classList.remove("drop-possible"),t.target.classList.remove("drop-over")}});var E=null,C=null;function I(){angular.element(document.body).injector().invoke(["EventCenterService",t=>{t.sendEvent(EVENTS_EDITOR_ADD_REMOVE_WIDGET)}])}function S(t){_.isUndefined($("#"+t)[0])||(o[t]=$("#"+t).width()/$("#"+$("#"+t)[0].parentNode.parentNode.id).width(),a[t]=$("#"+t).height()/$("#"+$("#"+t)[0].parentNode.parentNode.id).height(),d[t]=$("#"+t).position().left/$("#"+$("#"+t)[0].parentNode.parentNode.id).width(),r[t]=$("#"+t).position().top/$("#"+$("#"+t)[0].parentNode.parentNode.id).height(),l=getMedia())}function T(){layoutMgr.updateMaxTopAndLeft();var t=$("#drop-zone")[0].getElementsByTagName("div");s=P(),g.setDimensions(s),g.setScalingMethod(c);var e,o=isMediaChanged(l);if(e=o.bChanged,l=o.lastMedia,e)!function(){g.resizeDashboardCols();for(var t=$("#drop-zone")[0].getElementsByTagName("div"),e=0;e<t.length;e++)if($("#"+t[e].id).hasClass("drsElement")&&"Widget"!=t[e].id.substring(0,6)){var i=t[e],o=i.id;g.resizeWidgetOnMediaChange(o,o);for(var a=i.childNodes.length-1;a>=0;a--)if(i.childNodes[a].id.match("WidgetContainer")){wcId=i.childNodes[a].id;break}widgetContainer.replaceWidget(i)}}();else for(var a=0;a<t.length;a++)if(t[a].id&&$("#"+t[a].id).hasClass("drsElement")&&"Widget"!=t[a].id.substring(0,6)){var d=t[a].id;rescaleWidget(i,d),n.get(d).widgetObj=i[d]}}function N(){flatUiWidgetsPlugin.clear(),plotlyWidgetsPlugin.clear(),mapWidgetsPlugin.clear();for(const[t,e]of n)_.isUndefined(models[t])||delete models[t],_.isUndefined(modelsParameters[t])||delete modelsParameters[t],_.isUndefined(modelsHiddenParams[t])||delete modelsHiddenParams[t],_.isUndefined(modelsTempParams[t])||delete modelsTempParams[t];n.clear();for(const t in i)delete i[t];if(e.length=0,bFirstExec=!0,F(),I(),storage={},$("#DropperDroite")[0].hasChildNodes())for(var t=$("#DropperDroite")[0],o=t.childNodes.length-1;o>=0;o--)"menuWidget"!=t.childNodes[o].id&&t.childNodes[o].remove()}function z(){var t;for(t in layoutMgr.clear(),o)delete o[t];for(t in a)delete a[t];for(t in d)delete d[t];for(t in r)delete r[t];l="",c="scaleTwh",N(),widgetConnector.clear(),widgetPreview.clear()}function P(){return{widthPx:$("#drop-zone").width(),heightPx:$("#drop-zone").height(),scrollWidthPx:$("#drop-zone")[0].scrollWidth,scrollHeightPx:$("#drop-zone")[0].scrollHeight,widthVw:100*$("#drop-zone").width()/document.documentElement.clientWidth,heightVh:100*$("#drop-zone").height()/document.documentElement.clientHeight,scrollWidthVw:100*$("#drop-zone")[0].scrollWidth/document.documentElement.clientWidth,scrollHeightVh:100*$("#drop-zone")[0].scrollHeight/document.documentElement.clientHeight,scalingMethod:c,media:getMedia(),colDims:g.getCurrentDropperDims()}}function R(t){p.delete(t.id),H()}function F(){p.clear(),H()}function H(){!function(){for(const t of n.keys())$("#"+t).removeClass("widget-selected"),$("#"+t).removeClass("widget-selected-last");let t=null;p.forEach(e=>{t=$("#"+e),t.addClass("widget-selected")}),t&&t.addClass("widget-selected-last")}(),angular.element(document.body).injector().invoke(["EventCenterService",t=>{t.sendEvent(EVENTS_EDITOR_SELECTION_CHANGED)}])}function L(){angular.element(document.body).injector().invoke(["EventCenterService",t=>{t.sendEvent(EVENTS_EDITOR_WIDGET_MOVED)}])}return interact(".drag-drop-new").draggable({cursorChecker:(t,e,i,o)=>o?"grabbing":"grab",listeners:{start(t){const e=t.target;C=e.id,(E=e.cloneNode(!0)).id="dragged-new-widget",E.classList.add("dragged-new-widget"),document.body.appendChild(E);const i=e.getBoundingClientRect();y=i.top+window.pageYOffset,x=i.left+window.pageXOffset,E.style.left=x+"px",E.style.top=y+"px",E.setAttribute("data-x",x),E.setAttribute("data-y",y)},move(t){let e=parseFloat(E.getAttribute("data-x"))||0,i=parseFloat(E.getAttribute("data-y"))||0;e+=t.dx,i+=t.dy,E.setAttribute("data-x",e),E.setAttribute("data-y",i);const o=gridMgr.getGrid();if(o){let t="DropperDroite";W&&W.id&&(t=W.id);const a=$("#"+t).offset();[e,i]=A([e,i],[a.left,a.top],o)}E.style.left=e+"px",E.style.top=i+"px"},end(t){let e=parseFloat(E.getAttribute("data-x"))||0,i=parseFloat(E.getAttribute("data-y"))||0;E.parentNode.removeChild(E),h(E),E=null;const o=t.relatedTarget;if(o&&o.id){const t=o.id;if("DropperDroite"===t||t.startsWith("dpr")){const a=o.getBoundingClientRect();e-=a.left-window.pageXOffset,i-=a.top-window.pageYOffset;const d=gridMgr.getGrid();d&&([e,i]=A([e,i],[0,0],d)),layout={top:unitH(i),left:unitW(e)},angular.element(document.body).injector().invoke(["UndoManagerService","EditorActionFactory",(e,i)=>{const o=i.createCreateWidgetdAction(C,t,layout);e.execute(o)}])}}C=null}}}).on("tap",(function(t){if(t&&t.currentTarget&&t.currentTarget.id){const e=t.currentTarget.id;angular.element(document.body).injector().invoke(["UndoManagerService","EditorActionFactory",(t,i)=>{const o=i.createCreateWidgetdAction(e);t.execute(o)}])}})),interact("#DropperDroite .drag-drop-move").resizable({edges:{left:!0,right:!0,bottom:!0,top:!0},margin:7,listeners:{start(t){const e=t.target.id;e&&n.has(e)&&!p.has(e)&&(p.clear(),p.add(e),H()),p.forEach(e=>{const i=document.getElementById(e),o=i.offsetLeft,a=i.offsetTop,d=i.offsetHeight||1,r=i.offsetWidth||1;i.setAttribute("data-x0",o),i.setAttribute("data-y0",a),i.setAttribute("data-height0",d),i.setAttribute("data-width0",r),i.setAttribute("data-x",o),i.setAttribute("data-y",a),i.setAttribute("data-height",d),i.setAttribute("data-width",r);const n=parseInt(i.style["min-width"]||minWidthCst+"px",10),s=parseInt(i.style["min-height"]||minHeightCst+"px",10);i.setAttribute("data-minRatioX",n/r),i.setAttribute("data-minRatioY",s/d);const l=b(i);let c=1/0,g=1/0;if("DropperDroite"!==l){const e=document.getElementById(l);if(!t.edges.left){const t=e.offsetWidth-o-minLeftCst;c=Math.min(c,t/r)}if(!t.edges.top){const t=e.offsetHeight-a-minTopCst;g=Math.min(g,t/d)}}if(t.edges.left){const t=o+r-minLeftCst;c=Math.min(c,t/r)}if(t.edges.top){const t=a+d-minTopCst;g=Math.min(g,t/d)}i.setAttribute("data-maxRatioX",c),i.setAttribute("data-maxRatioY",g)})},move(t){const e=m(t.target),i=t.edges.left||t.edges.right,o=t.edges.top||t.edges.bottom,a=t.edges.left,d=t.edges.top;let r=i?t.rect.width/e.width:1,n=o?t.rect.height/e.height:1;if(t.shiftKey&&i&&o){const t=Math.max(r,n);r=n=t}const s=gridMgr.getGrid();p.forEach(e=>{const l=document.getElementById(e),c=m(l),g=parseFloat(l.getAttribute("data-minRatioX"))||0,p=parseFloat(l.getAttribute("data-minRatioY"))||0,h=parseFloat(l.getAttribute("data-maxRatioX"))||1/0,u=parseFloat(l.getAttribute("data-maxRatioY"))||1/0,f={...c};let y=r,b=n;if(t.shiftKey&&i&&o){y=b=Math.max(y,b)}if(s){const t=f.width*y,e=f.height*b,r=f.left+(a?c.width-t:t),n=f.top+(d?c.height-e:e),[l,g]=A([r,n],[0,0],s);i&&(y=(t+(l-r)*(a?-1:1))/f.width),o&&(b=(e+(g-n)*(d?-1:1))/f.height)}y=Math.min(y,h),b=Math.min(b,u),y=Math.max(y,g),b=Math.max(b,p),i&&(f.width*=y,a&&(f.left-=f.width-c.width)),o&&(f.height*=b,d&&(f.top-=f.height-c.height)),l.style.left=f.left+"px",l.style.top=f.top+"px",l.style.width=f.width+"px",l.style.height=f.height+"px",l.setAttribute("data-x",f.left),l.setAttribute("data-y",f.top),l.setAttribute("data-height",f.height),l.setAttribute("data-width",f.width)}),L()},end(t){const e=new Map;p.forEach(t=>{const i=document.getElementById(t);let o={left:parseFloat(i.getAttribute("data-x"))||0,top:parseFloat(i.getAttribute("data-y"))||0,height:parseFloat(i.getAttribute("data-height"))||0,width:parseFloat(i.getAttribute("data-width"))||0};const a=m(i);angular.equals(a,o)||(widgetContainer.moveResizeWidget(i,a,!1,!0),e.set(t,o)),h(i)}),e.size>0&&angular.element(document.body).injector().invoke(["UndoManagerService","EditorActionFactory",(t,i)=>{const o=i.createSetGeometryAction(e,"Resize widget"+(e.size>1?"s":""));t.execute(o)}])}}}).draggable({cursorChecker:(t,e,i,o)=>o?"grabbing":"grab",listeners:{start(t){const e=t.target.id;e&&n.has(e)&&!p.has(e)&&(p.clear(),p.add(e),H()),p.forEach(t=>{const e=document.getElementById(t),i=e.offsetLeft,o=e.offsetTop,a=e.offsetHeight||1,d=e.offsetWidth||1;e.setAttribute("data-x0",i),e.setAttribute("data-y0",o),e.setAttribute("data-height0",a),e.setAttribute("data-width0",d),e.setAttribute("data-x",i),e.setAttribute("data-y",o)})},move(t){let e="DropperDroite";W&&W.id&&(e=W.id);const i=gridMgr.getGrid();p.forEach(o=>{const a=document.getElementById(o),d=b(a),r={left:parseFloat(a.getAttribute("data-x"))||0,top:parseFloat(a.getAttribute("data-y"))||0,height:parseFloat(a.getAttribute("data-height0"))||0,width:parseFloat(a.getAttribute("data-width0"))||0};r.left+=t.dx,r.top+=t.dy,a.setAttribute("data-x",r.left),a.setAttribute("data-y",r.top);let n=r;if("DropperDroite"!==d&&(n=w(d,n)),"DropperDroite"===e)i&&([n.left,n.top]=A([n.left,n.top],[0,0],i)),n.left=Math.max(minLeftCst,n.left),n.top=Math.max(minTopCst,n.top);else{const t=$("#"+e),o=t.offset(),a={left:o.left,top:o.top,height:t.height(),width:t.width()};i&&([n.left,n.top]=A([n.left,n.top],[a.left,a.top],i)),n=enforceConstraints(n,a)}const s=v(e,n);a.setAttribute("data-display-x",s.left),a.setAttribute("data-display-y",s.top),"DropperDroite"!==d&&(n=v(d,n)),a.style.left=n.left+"px",a.style.top=n.top+"px",a.style.width=n.width+"px",a.style.height=n.height+"px"}),L()},end(t){const e=new Map,i=t.relatedTarget;let o="DropperDroite";i&&i.id&&(o=i.id);const a=gridMgr.getGrid();layoutMgr.isRowColMode()&&"DropperDroite"===o?p.forEach(t=>{const e=document.getElementById(t),i=m(e);widgetContainer.moveResizeWidget(e,i,!1,!1),h(e)}):(p.forEach(t=>{const i=document.getElementById(t),d=b(i);let r=parseFloat(i.getAttribute("data-x"))||0,n=parseFloat(i.getAttribute("data-y"))||0;const s=m(i);let l={left:r,top:n};o!==d&&(l=w(d,l),l=v(o,l)),a&&([l.left,l.top]=A([l.left,l.top],[0,0],a)),angular.equals(s,l)||(widgetContainer.moveResizeWidget(i,s,!1,!1),e.set(t,l)),h(i)}),e.size>0&&angular.element(document.body).injector().invoke(["UndoManagerService","EditorActionFactory",(t,i)=>{const a=i.createDropToCellAction(o,e,"Move widget"+(e.size>1?"s":""));t.execute(a)}]))}}}).on("tap",(function(t){const e=t.ctrlKey,i=t.currentTarget.id;i&&n.has(i)&&(e?p.has(i)?p.delete(i):p.add(i):(p.clear(),p.add(i)),H(),t.preventDefault(),t.stopImmediatePropagation())})),{addWidget:function(t,e,o,a,d){const r=widgetFactory.build(t,e,o,a,d);if(i[r.instanceId]=r.widgetObj,n.set(r.instanceId,r),"createWidget"!=i[r.instanceId].constructor.name)return I(),p.clear(),p.add(r.instanceId),H(),r;widgetInstance.deleteWidget(r.divModel)},deleteWidget:function(t){const e=n.get(t).divModel;widgetInstance.deleteWidget(e),R(e),e.remove(),I()},widgetObject:i,widgetContainers:n,modelsId:e,serialize:function(){var t,e,i,o;i={};var a={},d={};for([t,e]of n)i={top:$("#"+e.id)[0].style.top,left:$("#"+e.id)[0].style.left,height:$("#"+e.id)[0].style.height,width:$("#"+e.id)[0].style.width,minHeight:$("#"+e.id)[0].style.minHeight,minWidth:$("#"+e.id)[0].style.minWidth,"z-index":$("#"+e.id)[0].style["z-index"]},d={id:e.id,instanceId:e.instanceId,modelJsonId:e.modelJsonId,widgetTypeName:e.widgetTitle},"annotationLabel"==e.modelJsonId||"annotationImage"==e.modelJsonId?a[t]={layout:i,container:d,modelParameters:modelsParameters[t],modelHiddenParams:modelsHiddenParams[t]}:(emptyModelsHiddenParams=jQuery.extend(!0,{},modelsHiddenParams[e.modelJsonId]),"perfectWidgetsSimpleMeter"!=e.modelJsonId&&"perfectWidgetsTachometer"!=e.modelJsonId&&"perfectWidgetsMultiSwitch"!=e.modelJsonId&&"perfectWidgetsSimpleCompass"!=e.modelJsonId&&"perfectWidgetsSimpleCircleWind"!=e.modelJsonId||Object.keys(modelsParameters[t]).forEach(e=>{o=e.replace(".","_"),modelsParameters[t][o]=modelsParameters[t][e],delete modelsParameters[t][e]}),a[t]={layout:i,container:d,modelParameters:modelsParameters[t],modelHiddenParams:emptyModelsHiddenParams});return a},deserialize:function(t,i,o){z(),s=P();var a,d,r,n=0;_.isUndefined(i)||_.isUndefined(i.scalingMethod)||(c=i.scalingMethod),g.setDimensions(s),g.setScalingMethod(c),o=layoutMgr.deserialize(o,i),g.deserialize(i),layoutMgr.updateColHeight(i),g.resizeDashboardCols();var p=i,h=s;if(_.isUndefined(i))p=s;else{_.isUndefined(i.media)&&(i.media="large");var m=g.mediaChangeProjection(i,s,layoutMgr.getRows());l=m.lastMedia,p=m.referenceFrame,h=m.targetFrame}var u,f,y=new scalingManager(p,h,c),b="",w=layoutMgr.deserializeCols(t,o);for(u in t){if(!_.isEmpty(t[u].modelParameters)){let e=t[u].container.modelJsonId,i=t[u].modelParameters;"perfectWidgetsSimpleMeter"!=e&&"perfectWidgetsTachometer"!=e&&"perfectWidgetsMultiSwitch"!=e&&"perfectWidgetsSimpleCompass"!=e&&"perfectWidgetsSimpleCircleWind"!=e||Object.keys(i).forEach(t=>{f=t.replace("_","."),i[f]=i[t],delete i[t]}),modelsParameters[u]=i}"annotationLabel"!=t[u].container.modelJsonId&&"annotationImage"!=t[u].container.modelJsonId||_.isEmpty(t[u].modelHiddenParams)||(modelsHiddenParams[u]=t[u].modelHiddenParams),e[n]=u,d={topVh:rmUnit(t[u].layout.top),leftVw:rmUnit(t[u].layout.left),widthVw:rmUnit(t[u].layout.width),heightVh:rmUnit(t[u].layout.height)},a={top:(r=y.scale(d)).topVh+"vh",left:r.leftVw+"vw",width:r.widthVw+"vw",height:r.heightVh+"vh"},b=_.isUndefined(t[u].container.widgetTypeName)?t[u].container.modelJsonId:t[u].container.widgetTypeName;var v=document.getElementById(w[u]);widgetEditor.addWidget(t[u].container.modelJsonId,v,t[u].container.instanceId,a,t[u].layout["z-index"],b),n+=1}for(u in t)S(t[u].container.instanceId);s=P(),g.setDimensions(s)},rescale:T,resizeDashboard:function(){s=P(),g.setDimensions(s),g.setScalingMethod(c),g.resizeDashboard(),T()},clear:z,reset:N,getCurrentDashZoneDims:P,getSnapshotDashZoneDims:function(){return s},updateSnapshotDashZoneDims:function(){s=P()},computeDropperMaxWidth:function(){panelDash.fullScreenWidth=Math.ceil((t.offsetWidth+25)/.75*.975-25)},setLastMedia:function(t){l=t},getWidgetsRelativeDims:function(){return{width:o,height:a,left:d,top:r}},setScalingMethod:function(t){c=t,g.setScalingMethod(c)},widthRatioModels:o,heightRatioModels:a,leftRatioModels:d,topRatioModels:r,selectWidget:function(t){p.add(t.id),H()},selectAllWidgets:function(){p.clear();for(const t of n.keys())p.add(t);H()},unselectWidget:R,unselectAllWidgets:F,getSelectedActive:function(){let t=null;for(t of p);return t},getSelection:function(){return[...p]},getContainer:function(t){return document.getElementById(b(t))},MAIN_CONTAINER_ID:"DropperDroite",DATA_ATTR_DISPLAY_X:"data-display-x",DATA_ATTR_DISPLAY_Y:"data-display-y",showHideWidgMenu:function(t){let e=!0;const i=t.parentElement.parentElement,o=i.id;let a=[],d=widgetConnector.widgetsConnection;_.isUndefined(d[o])||_.each(_.keys(d[o].sliders),t=>{let e=d[o].sliders[t].dataNode;-1===a.indexOf(e)&&a.push(e)}),document.getElementById("openGraphFromWidget").setAttribute("name",JSON.stringify(a));const r="menuWidget";$("#"+r)[0].getAttribute("name")!==o&&($("#"+r).attr("name",o),e=!1);const n=angular.element(document.getElementById("dashboard-editor")).scope().vm;n.menuWidgetVisible?e&&(n.menuWidgetVisible=!1):n.menuWidgetVisible=!0;const s=b(i),l=$("#DropperDroite")[0].offsetHeight,c=$("#"+s)[0].offsetTop,g=$("#"+s)[0].offsetLeft,p=$("#"+o)[0].clientWidth,h=$("#"+o)[0].clientHeight,m=$("#"+o)[0].offsetTop,u=$("#"+o)[0].offsetLeft,f=h-10,y=layoutMgr.getRows();let w,v;"DropperDroite"!==s?(v=l*y,w=l-(h+m+c)):(v=l,w=l-(m+h)),y<=1&&c+m+30+443>=l&&w+f+443>=l?($("#"+r)[0].style.bottom="10px",$("#"+r)[0].style.top="auto",document.styleSheets[0].addRule("#menuWidget::after","top: -5px; transform: rotate(0deg)")):c+m+30+443>=v?($("#"+r)[0].style.bottom=(f+w).toString()+"px",$("#"+r)[0].style.top="auto",document.styleSheets[0].addRule("#menuWidget::after","top: 443px; transform: rotate(180deg)")):($("#"+r)[0].style.top=(c+m+30).toString()+"px",$("#"+r)[0].style.bottom="auto",document.styleSheets[0].addRule("#menuWidget::after","top: -5px; transform: rotate(0deg)")),(p+u).toString()<=247.047&&0==g?($("#"+r)[0].style.left="7px",document.styleSheets[0].addRule("#menuWidget::after","left: "+(u+p-30)+"px")):($("#"+r)[0].style.left=(p+u+g-247.047).toString()+"px",document.styleSheets[0].addRule("#menuWidget::after","left: auto; right: 20px")),$("#"+r)[0].style.right="auto"}}}var widgetEditor=initEditWidget();
var widgetDefaultLayoutClass=function(){var t={left:"0vw",top:"0vh",height:"5vh",width:"10vw",minWidth:"20px",minHeight:"20px"};this.get=function(){return jQuery.extend(!0,{},t)}},widgetDefaultLayout=new widgetDefaultLayoutClass;
function widgetInstanceClass(){this.createWidget=function(e,d,t){return _.isUndefined(modelsParameters[t])&&(modelsParameters[t]=jQuery.extend(!0,{},modelsParameters[d])),_.isUndefined(models[t])&&(models[t]=jQuery.extend(!0,{},models[d])),_.isUndefined(modelsHiddenParams[t])&&(modelsHiddenParams[t]=jQuery.extend(!0,{},modelsHiddenParams[d])),_.isUndefined(modelsTempParams[t])&&(modelsTempParams[t]=jQuery.extend(!0,{},modelsTempParams[d])),new widgetsPluginsHandler.createWidget(e,d,t,!1)},this.deleteWidget=function(e){delete widgetConnector.widgetsConnection[e.id];const d=e.parentNode;if(d){for(;d.hasChildNodes();)d.removeChild(d.lastChild);d.parentNode&&d.parentNode.removeChild(d),delete widgetEditor.widgetObject[e.id];for(let d=widgetEditor.modelsId.length-1;d>=0;d--)if(widgetEditor.modelsId[d]===e.id){widgetEditor.modelsId.splice(d,1);break}delete widgetEditor.widthRatioModels[e.id],delete widgetEditor.heightRatioModels[e.id],delete widgetEditor.leftRatioModels[e.id],delete widgetEditor.topRatioModels[e.id],widgetEditor.widgetContainers.delete(e.id)}const t=e.id;_.isUndefined(modelsParameters[t])||delete modelsParameters[t],_.isUndefined(models[t])||delete models[t],_.isUndefined(modelsHiddenParams[t])||delete modelsHiddenParams[t],_.isUndefined(modelsTempParams[t])||delete modelsTempParams[t]}}var widgetInstance=new widgetInstanceClass;
function widgetContainerClass(){var t=100;function e(t){return t.sort((t,e)=>t.divModel.style.zIndex-e.divModel.style.zIndex)}function i(t){const e=[],i=[];for(const[n,o]of widgetEditor.widgetContainers)t.includes(n)?e.push(o):i.push(o);return[e,i]}function n(t){let e=1;const i=new Map;return t.forEach(t=>i.set(t.instanceId,e++)),i}this.getWidgetContainerId=function(){t+=1;return"WidgetContainer"+parseInt(t)},this.putAndGetTargetDiv=function(t,e){return e||(e=layoutMgr.getDefaultContainer()),e.appendChild(t),e},this.computeAndApplyContainerDivLayout=function(t,e){var i=parseFloat(t.style.width.substring(0,t.style.width.length-2))-100/document.documentElement.clientWidth*2,n=parseFloat(t.style.height.substring(0,t.style.height.length-2))-100/document.documentElement.clientHeight*2;e.style.width=i.toString()+"vw",e.style.height=n.toString()+"vh",""!=t.style.minWidth&&(e.style.minWidth=parseFloat(t.style.minWidth)-5+"px",e.style.width=Math.max(parseFloat(e.style.minWidth)*(100/document.documentElement.clientWidth),parseFloat(e.style.width))+"vw"),""!=t.style.minHeight&&(e.style.minHeight=parseFloat(t.style.minHeight)-5+"px",e.style.height=Math.max(parseFloat(e.style.minHeight)*(100/document.documentElement.clientHeight),parseFloat(e.style.height))+"vh")},this.replaceWidget=function(t){for(var e,i=t.childNodes.length-1;i>=0;i--)if(t.childNodes[i].id.match("WidgetContainer")){e=t.childNodes[i].id,t.removeChild(t.childNodes[i]);break}t.style.top=unitH(t.offsetTop),t.style.left=unitW(t.offsetLeft),t.style.height=unitH(t.offsetHeight),t.style.width=unitW(t.offsetWidth),t.setAttribute("item-width",t.offsetWidth),t.setAttribute("item-height",t.offsetHeight);var n=document.createElement("div");n.style.height=unitH(t.offsetHeight-2),n.style.width=unitW(t.offsetWidth-2),n.style.minWidth=parseFloat(t.style.minWidth)-5+"px",n.style.minHeight=parseFloat(t.style.minHeight)-5+"px",t.appendChild(n),n.id=e;var o=t.id.substring(0,t.id.length-1),d=t.id,s=widgetEditor.widgetContainers.get(d).widgetTitle;return widgetEditor.widgetObject[d]=widgetsPluginsHandler.copyWidget(e,o,widgetEditor.widgetObject[d],d,!1),widgetEditor.widgetContainers.set(d,{id:d,instanceId:d,modelJsonId:o,name:d,divContainer:n,divModel:t,widgetObj:widgetEditor.widgetObject[d],widgetTitle:s}),n},this.getMinWidth=function(t){var e=32;return""!=t.style.minWidth&&(e=parseFloat(rmUnit(t.style.minWidth))),e},this.getMinHeight=function(t){var e=32;return""!=t.style.minHeight&&(e=parseFloat(rmUnit(t.style.minHeight))),e},this.getMaxWidth=function(t){const e=getElementLayoutPx(t),i=widgetEditor.getContainer(t),n=getElementLayoutPx(i);return computeMaxWidthPx(e,n)},this.getMaxHeight=function(t){const e=getElementLayoutPx(t),i=widgetEditor.getContainer(t),n=getElementLayoutPx(i);return computeMaxHeightPx(e,n)},this.getFloatingState=function(t){return layoutMgr.isRowColMode()&&"DropperDroite"===t.parentNode.parentNode.id?"FLOATING":"FIXED"},this.translateWidgetPx=function(t,e){var i=getElementLayoutPx(t),n={top:i.top+e.top,left:i.left+e.left,width:i.width,height:i.height};this.moveResizeWidget(t,n)},this.constrainLayout=function(t,e){let i;if(layoutMgr.isRowColMode()){const e=widgetEditor.getContainer(t);"FIXED"===this.getFloatingState(t)?(i=getElementLayoutPx(e),i=computeContainerRelativeLayout(i)):i="DropperDroite"===e.id?{left:0,top:0,width:layoutMgr.maxLeftCst,height:layoutMgr.maxTopCst}:getElementLayoutPx(e)}else i={left:0,top:0,width:layoutMgr.maxLeftCst,height:layoutMgr.maxTopCst};return enforceConstraints(e,i)},this.moveResizeWidget=function(t,e,i,n){let o=null;if(!i){if(null==t.parentNode.parentNode)return null;o=this.constrainLayout(t,e),t.style.top=unitH(o.top),t.style.left=unitW(o.left),t.style.height=unitH(o.height),t.style.width=unitW(o.width),n&&widgetContainer.replaceWidget(t)}const d=$(t),s=$(t.parentNode.parentNode);return n&&(widgetEditor.widthRatioModels[t.id]=d.width()/s.width(),widgetEditor.heightRatioModels[t.id]=d.height()/s.height()),widgetEditor.leftRatioModels[t.id]=d.position().left/s.width(),widgetEditor.topRatioModels[t.id]=d.position().top/s.height(),o},this.highlightWidgets=function(t){t.forEach(t=>{const e=widgetEditor.widgetContainers.get(t);e&&e.divContainer&&$(e.divContainer).fadeOut(30).fadeIn(140)})},this.duplicateWidgetWithConnection=function(t,e){return e=this.duplicateWidget(t,e),_.isUndefined(widgetConnector.widgetsConnection[t.id])||widgetConnector.duplicateConnection(e,t),e},this.duplicateWidget=function(t,e){const i=t.id.substring(0,t.id.length-1),n=getElementLayoutPx(t),o={top:n.top+20,left:n.left+20,width:n.width,height:n.height},d=this.constrainLayout(t,o);let s={};s.top=unitH(d.top),s.left=unitW(d.left),s.height=unitH(d.height),s.width=unitW(d.width),e||(e=widgetFactory.createUniqueInstanceId(i)),modelsHiddenParams[e]=jQuery.extend(!0,{},modelsHiddenParams[t.id]),modelsParameters[e]=jQuery.extend(!0,{},modelsParameters[t.id]);const r=widgetEditor.getContainer(t);return widgetEditor.addWidget(i,r,e,s),e},this.getMaxZIndex=function(){let t=null;for(const e of widgetEditor.widgetContainers.values()){const i=e.divModel.style.zIndex;if(void 0!==i){const e=parseInt(i,10);!isNaN(e)&&(null===t||t<e)&&(t=e)}}return t},this.setZIndices=function(t){const e=widgetEditor.widgetContainers;for(const[i,n]of t){const t=e.get(i);t&&t.divModel.style.zIndex!==n&&(t.divModel.style.zIndex=n)}},this.getZIndices=function(){const t=new Map;for(const[e,i]of widgetEditor.widgetContainers)t.set(e,i.divModel.style.zIndex);return t},this.putWidgetAtForeground=function(t){const[o,d]=i(t),s=n([...e(d),...e(o)]);this.setZIndices(s)},this.putWidgetAtBackground=function(t){const[o,d]=i(t),s=n([...e(o),...e(d)]);this.setZIndices(s)}}widgetContainer=new widgetContainerClass;
function widgetFactoryClass(){this.build=function(e,t,i,d,n){var a,o;(_.isUndefined(i)||null===i)&&(i=widgetFactory.createUniqueInstanceId(e)),[a,o,t]=function(e,t,i){var d=document.createElement("div"),n=(t=widgetContainer.putAndGetTargetDiv(d,t),computeMainDivLayout(i,e));d.style.zIndex=(widgetContainer.getMaxZIndex()||0)+1;var a=convertViewportToPx(n),o=layoutMgr.getTargetDivLayoutPx(t),r=computeContainerRelativeLayout(o),l=enforceConstraints(a,r);a=enforceMinConsistency(a);var s=pxToViewPort(l);s.minHeight=a.minHeight,s.minWidth=a.minWidth,applyLayout(d,s);var c=document.createElement("div");return widgetContainer.computeAndApplyContainerDivLayout(d,c),d.appendChild(c),[d,c,t]}(e,t,d),a.id=i,$("#"+a.id).addClass("drsElement"),$("#"+a.id).addClass("drag-drop-move"),$("#"+a.id).addClass("_cloned"),$("#"+a.id).addClass("widget widget__layout--item"),$("#"+a.id)[0].setAttribute("item-width",$("#"+a.id).width()),$("#"+a.id)[0].setAttribute("item-height",$("#"+a.id).height());const r=document.createElement("div");r.classList.add("widget-overlay"),a.appendChild(r);let l=$('<ul class="actions__list" style="padding:0"></ul>').appendTo(a);$('<li id="li_'+a.id+'" onclick="widgetEditor.showHideWidgMenu(this)" style="z-index:999999;margin:0"><a id="ed_a_'+a.id+'" tilte="edit widget"><i id="showHideWidgetMenu" class="basic icn-edit"></i></a></li>').appendTo(l);var s=widgetContainer.getWidgetContainerId();o.id=s,_.isUndefined(n)||(a.style.zIndex=n);var c=widgetsPluginsHandler.widgetToolbarDefinitions[e].title;_.isUndefined(c)&&(c=""),c=c+"("+i+")",$("div#"+a.id).wrap("<a id=DIV_"+a.id+" title='"+c.replace("_"," ")+"'></a>");var g=widgetInstance.createWidget(s,e.toString(),i);return{id:i,instanceId:i,modelJsonId:e,name:i,divContainer:o,divModel:a,widgetObj:g,widgetTitle:c}},this.createUniqueInstanceId=function(e){const t=widgetEditor.modelsId.length,i=new Set(widgetEditor.modelsId),d=[..."ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",..."कखगघङचछजझञटठडढणतथदधनपफबभमयरलवशषसहक्षत्रज्ञ",..."अआइईउऊऋएऐओऔकखगघङचछजझञटठडढणतथदधनपफबभमयरलवशषसह",..."あいうえおかきくけこさしすせそたちつてとなにぬねのはひふへほまみむめもやゆよらりるれろわをん",..."БГДЁЖИЙЛПФЦЧШЩЪЫЭЮЯ",..."أبتثجحخدذرزسشصضطظعغفقكلمنهوي",..."אבגדהוזחטיכךלמםנןסעפףצץקרשת",..."βΓΔδεζηΘθκΛλμΞξΠπΣτΦφχΨψΩω",..."一二三四五六七八九十百千万亿中人天地日月金木水火风雷"].map(t=>{return e+(i=t).charAt(Math.floor(Math.random()*i.length));var i}).find(e=>!i.has(e));if(d)i.add(d),widgetEditor.modelsId[t]=d;else{const e=new PNotify({title:"Annotation label",text:"The number of label instances is reached",type:"warning",delay:1800,styling:"bootstrap3"});$(".ui-pnotify-container").on("click",(function(){e.remove()}))}return d}}var widgetFactory=new widgetFactoryClass;
function navigationHelperClass(){this.gotoMyProjects=function(){var e=angular.element(document.body),o=e.scope().$root,n=e.scope().$state;o.toggleMenuOptionDisplay("cards"),n.go("modules.cards.layout",{action:"myProjects"})},this.openDemoProject=function(e,o){var n=e,t=angular.element(document.body),a=t.scope().$root,i=t.scope().$state;if(a.showNotifications=!1,a.origin="openProject",a.loadingBarStart(),a.toggleMenuOptionDisplay("none"),i.go("modules",{}),a.isLiveDemo=!1,!a.xDashFullVersion){angular.element(document.getElementById("dash-ctrl")).scope().closeLeftSidePanel(),a.isLiveDemo=!0}a.moduleOpened=!1;(new FileMngrFct).ReadFile("template",n+".xprjson",(async function(e,t,i){"success"===i?(await xdash.openProjectManager(e),a.loadingBarStop(),a.currentProject.name=n,_.isFunction(o)&&o(),a.origin="projectEdition"):swal(e,t,i)}))}}var navHelper=new navigationHelperClass;
var widgetConnector=function(){var e=[];function t(){const e=angular.element(document.body).injector();e&&e.has("EventCenterService")&&e.invoke(["EventCenterService",e=>{e.sendEvent(EVENTS_EDITOR_CONNECTIONS_CHANGED)}])}function n(){for(const t in e)widgetEditor.widgetContainers.get(e[t].id)||delete e[t];for(const[t,n]of widgetEditor.widgetContainers)if(e[t]){if(widgetEditor.widgetObject[t]){if(!_.isNull(e[t].widgetObjEdit)&&!_.isNull(widgetEditor.widgetObject[t])){let n=e[t].widgetObjEdit.numberOfTriggers-widgetEditor.widgetObject[t].numberOfTriggers;for(;n>0;){let i=Object.keys(e[t].sliders);delete e[t].sliders[i[i.length-1]],n--}}e[t].widgetObjEdit=widgetEditor.widgetObject[t]}}else e[t]={name:t,id:t,instanceId:t,modelJsonId:n.modelJsonId,sliders:[],widgetObjEdit:widgetEditor.widgetObject[t],widgetObjConnect:null};t()}function i(){for(const t in e)d(t);t()}function d(t){const n=e[t];for(const e in n.sliders){const t=n.sliders[e];t.dataNode="None",t.dataFields.length=0}}function o(){for(const t in e)delete e[t];i()}return{widgetsConnection:e,updateWidgetsConnections:n,effectiveSliders:function(){let t=[];return _.each(_.keys(e),n=>{let i=_.keys(e[n].sliders);for(let e=0;e<i.length;e++)_.isEmpty(i[e])||t.push(i[e])}),_.uniq(t)},resetSingleMatchingBox:i,serialize:function(){const t={};for(const n in e){t[n]={};for(const i in e[n].sliders)t[n][i]=jQuery.extend(!0,{},e[n].sliders[i])}return t},deserialize:function(i){o(),n();for(var d=[],r=0;r<datanodesManager.getAllDataNodes().length;r++)d[r]=datanodesManager.getAllDataNodes()[r].name();for(const t in e)for(const n in i[t])_.isUndefined(i[t][n].dataNode)&&(i[t][n].dataNode=i[t][n].dataSource,delete i[t][n].dataSource),e[t].sliders[n]=i[t][n];for(let t in e)try{widgetPreview.plotConstantData(t,!1)}catch(e){console.error(e)}t()},clear:o,duplicateConnection:function(n,i){e[n]=jQuery.extend(!0,{},e[i.id]),e[n].id=n,e[n].name=n,e[n].instanceId=n,t()},refreshDatanodeConsumers:function(t,n,i,d){for(const o in e){const r=e[o];for(const e in r.sliders){const s=r.sliders[e];if("None"!=s.name){let a=null;null!=r.widgetObjEdit?a=r.widgetObjEdit.getByName(s.name):null!=r.widgetObjConnect&&(a=r.widgetObjConnect.getByName(s.name)),null!=a&&(s.dataNode===n?"Python_pyodide_plugin"==datanodesManager.getDataNodeByName(n).type()&&"fig"===e?widgetPreview.setDataOnWidget(o,e,a,n,i,d,!1):widgetPreview.setDataOnWidget(o,e,a,t,i,d,!1):s.dataNode)}}}}}}();
function displaySpinnerOnInputFileButton(e){const t=this,n=document.getElementById("button"+e),o=document.getElementById("button"+e+"_select_file"),a=document.createElement("i");let i;this.disableButton=function(){n.classList.add("disabled"),a.setAttribute("id","icon"+e),a.setAttribute("class","fa fa-spinner fa-spin"),n.append(a)},this.enableButton=function(){n.classList.remove("disabled"),a&&a.remove()},this.disableButton(),o.onchange=function(){clearTimeout(i),document.body.focus(),t.enableButton()},document.body.onfocus=function(){i=setTimeout(()=>{t.enableButton(),document.body.onfocus=null},200)}}function updateDataSourceFromWidget(e,t){if(_.isUndefined(widgetConnector.widgetsConnection[e]))return;const n=widgetConnector.widgetsConnection[e].sliders,o=[];if(!_.isUndefined(n)){for(const e in n){const t=n[e].dataNode;"None"!==t&&o.push(datanodesManager.getDataNodeByName(t).name())}o.length>0&&datanodesManager.getDataNodeByName(o[0]).schedulerStart(o,o[0],"triggerButton")}}function updateDataNodeFromWidgetwithspinButton(e,t){if(_.isUndefined(widgetConnector.widgetsConnection[e]))return;const n=widgetConnector.widgetsConnection[e].sliders,o=[];if(!_.isUndefined(n)){for(let e in n){const t=n[e].dataNode;"None"!=t&&o.push(datanodesManager.getDataNodeByName(t).name())}if(o.length>0){const n=document.getElementById("button"+t),a=document.createElement("i");a.setAttribute("id","icon"+t),datanodesManager.getDataNodeByName(o[0]).schedulerStart(o,o[0],"triggerButton");const i=setInterval((function(){const d=[];o.forEach(e=>{"Pending"==datanodesManager.getDataNodeByName(e).status()&&($("#button"+t).attr("class","btn btn-table-cell btn-lg disabled"),d.push(!0),$(a).hasClass("fa fa-spinner fa-spin")||a.setAttribute("class","fa fa-spinner fa-spin"),n.contains(a)||n.append(a))}),0==d.length&&($("#button"+t).attr("class","btn btn-table-cell btn-lg "+e+"widgetCustomColor "),document.getElementById("icon"+t).remove(),a.remove(),clearInterval(i))}),100)}}}function updateDataNodeFileFromWidget(e,t){if(!_.isUndefined(widgetConnector.widgetsConnection[e])){var n=widgetConnector.widgetsConnection[e].sliders;if(!_.isUndefined(n))for(var o in n){let e=n[o].dataNode;"None"!=e&&datanodesManager.getDataNodeByName(e).isSetFileValid()&&datanodesManager.getDataNodeByName(e).setFile(t)}}}
var widgetPreview=function(){var e,t=[],n="scaleTwh",o=0,i=1,d=new rescaleHelper(e,n,"preview"),a=[],s=[],l=[],r=[],c="",g={};function u(){return{widthPx:$("#dashboard-zone").width(),heightPx:$("#dashboard-zone").height(),scrollWidthPx:$("#dashboard-zone")[0].scrollWidth,scrollHeightPx:$("#dashboard-zone")[0].scrollHeight,widthVw:100*$("#dashboard-zone").width()/document.documentElement.clientWidth,heightVh:100*$("#dashboard-zone").height()/document.documentElement.clientHeight,scrollWidthVw:100*$("#dashboard-zone")[0].scrollWidth/document.documentElement.clientWidth,scrollHeightVh:100*$("#dashboard-zone")[0].scrollHeight/document.documentElement.clientHeight,scalingMethod:n}}function f(){for(let e in t)for(let n of widgetConnector.effectiveSliders())null!=t[e]&&null!=t[e].getByName(n)&&(slider=t[e].getByName(n),slider.addValueChangedHandler(v))}function C(e,n){_.each(_.keys(e.dashboard),e=>{let o=document.getElementById(e+"c"),i=e.substring(0,e.length-1),d=o.firstElementChild.id;t[e]=n?widgetsPluginsHandler.createWidget(d,i,e,!0):widgetsPluginsHandler.copyWidget(d,i,null,e,!0),function(e){$("#"+e+"c")[0].style.position="absolute",$("#"+e+"c")[0].style.border="1px solid rgba(255, 255, 255, 0)"}(e),null!=widgetConnector.widgetsConnection[e]&&(widgetConnector.widgetsConnection[e].widgetObjEdit=null,widgetConnector.widgetsConnection[e].widgetObjConnect=t[e],m(e,!1))}),d.updateCellsProportions(),_.each(_.keys(t),e=>{!function(e,t){a[e]=$("#"+t).width()/$("#"+$("#"+t)[0].parentNode.id).width(),s[e]=$("#"+t).height()/$("#"+$("#"+t)[0].parentNode.id).height(),l[e]=$("#"+t).position().left/$("#"+$("#"+t)[0].parentNode.id).width(),r[e]=$("#"+t).position().top/$("#"+$("#"+t)[0].parentNode.id).height(),c=getMedia()}(e,e+"c")})}function m(e,t){var n=null;if(_.isUndefined(widgetConnector.widgetsConnection[e]))console.log("connection of "+e+" is undefned");else for(var o in widgetConnector.widgetsConnection[e].sliders)if(b(e),"None"!=widgetConnector.widgetsConnection[e].sliders[o].name&&(n=null,null!=widgetConnector.widgetsConnection[e].widgetObjEdit?n=widgetConnector.widgetsConnection[e].widgetObjEdit.getByName(widgetConnector.widgetsConnection[e].sliders[o].name):null!=widgetConnector.widgetsConnection[e].widgetObjConnect&&(n=widgetConnector.widgetsConnection[e].widgetObjConnect.getByName(widgetConnector.widgetsConnection[e].sliders[o].name)),null!=n))if("None"!=widgetConnector.widgetsConnection[e].sliders[o].dataNode){let i=widgetConnector.widgetsConnection[e].sliders[o].dataNode;if("None"!=i)if(_.isUndefined(datanodesManager.getDataNodeByName(i)))msg="Invalid connection with data",p(e,o,msg);else{let d=datanodesManager.getDataNodeByName(i).latestData(),a=datanodesManager.getDataNodeByName(i).name(),s=datanodesManager.getDataNodeByName(i).status(),l=datanodesManager.getDataNodeByName(i).last_updated();"Python_pyodide_plugin"==datanodesManager.getDataNodeByName(a).type()&&"fig"==o?y(e,o,n,a,s,l,t):y(e,o,n,d,s,l,t)}else msg="Invalid connection with data",p(e,o,msg)}else $("#collapse-matching-box").hasClass("collapse in")&&widgetPreview.clearDataFromWidget(e,o,n,!0)}function p(e,t,n){if(!g[e]){var o=widgetConnector.widgetsConnection[e].instanceId+"c";_.isUndefined($("#"+o)[0])||"3px groove #e40000"!=$("#"+o)[0].style.border&&(w=parseFloat($("#"+o)[0].style.width)+1,h=parseFloat($("#"+o)[0].style.height)+1,$("#"+o)[0].style.width=w+"vw",$("#"+o)[0].style.height=h+"vh",$("#"+o)[0].style.border="3px groove #e40000",$("#"+o)[0].style.borderRadius="6px",$("#"+o)[0].style.background="rgba(255, 0, 0, 0.26)",$("#"+o).append('<br/><span style="color:red">'+n+' "'+widgetConnector.widgetsConnection[e].sliders[t].dataNode+'" !</span>')),g[e]=!0}}function b(e){var t=widgetConnector.widgetsConnection[e].instanceId+"c";if(!_.isUndefined($("#"+t)[0])&&"1px solid rgba(255, 255, 255, 0)"!=$("#"+t)[0].style.border){w=parseFloat($("#"+t)[0].style.width)-1,h=parseFloat($("#"+t)[0].style.height)-1,$("#"+t)[0].style.width=w+"vw",$("#"+t)[0].style.height=h+"vh",$("#"+t)[0].style.border="1px solid rgba(255, 255, 255, 0)",$("#"+t)[0].style.borderRadius="",$("#"+t)[0].style.background="";for(var n=0;n<$("#"+t)[0].childNodes.length;n++)"span"==$("#"+t)[0].childNodes[n].localName&&$("#"+t)[0].childNodes[n].remove()}g[e]=!1}function y(e,t,n,o,i,d,a){if(_.isUndefined(o)&&"never"!=d||"Error"==i)return msg="Invalid data",void p(e,t,msg);if(b(e),!_.isUndefined(o)&&!_.isNull(o)){const i=widgetConnector.widgetsConnection[e].sliders[t];let d=o,s=i.dataNode;for(let e=0;e<i.dataFields.length;e++){const t=i.dataFields[e];"string"==typeof t&&t.includes(" ... ")||(s=t,"object"==typeof d&&(d=_.isNull(d)||_.isUndefined(d)?o[s]:d[s]))}if(null===d)widgetPreview.clearDataFromWidget(e,t,n,!0);else if("D"===i.name.substring(0,1))try{n.setText(d)}catch(e){console.log("setText got exception with data '"+i.dataNode+"'. "+e)}else{if(!_.isUndefined(n.setCaption))try{n.setCaption(s,a)}catch(e){console.log("setCaption got exception with data '"+i.dataNode+"'. "+e)}if(!_.isUndefined(n.setValue))try{n.setValue(d)}catch(e){console.log("setValue got exception with data '"+i.dataNode+"'. "+e)}}}}function v(e,t,n){var o=null;if(0==datanodesManager.getAllDataNodes().length);else{var i=!1;for(var d in widgetConnector.widgetsConnection)for(var a in widgetConnector.widgetsConnection[d].sliders)if(null!=widgetConnector.widgetsConnection[d].widgetObjConnect&&null!=widgetConnector.widgetsConnection[d].widgetObjConnect.getByName(widgetConnector.widgetsConnection[d].sliders[a].name)&&e==widgetConnector.widgetsConnection[d].widgetObjConnect.getByName(widgetConnector.widgetsConnection[d].sliders[a].name)){i=!0,o=widgetConnector.widgetsConnection[d].sliders[a];break}if(i&&"None"!=o.dataNode){let t=datanodesManager.getDataNodeByName(o.dataNode);if(_.isUndefined(t))console.log("data was removed or data index was modified!");else if(t.isSetValueValid()&&!_.isUndefined(e.getValue))try{t.setValue(o.dataFields,e.getValue(),n)}catch(e){console.log("setValue got exception with data: "+t.name()+". "+e.message)}else console.log("setValue is not possible with data: "+t.name())}}}function N(){e=u(),d.setDimensions(e);var n,o=isMediaChanged(c);n=o.bChanged,c=o.lastMedia,n?_.each(_.keys(t),e=>{let n=e+"c";d.resizeWidgetOnMediaChange(e,n),function(e){let n=e+"c";for(var o=document.getElementById(n),i=o.id.substring(0,o.id.length-2),d=(e=o.id.substring(0,o.id.length-1),o.firstElementChild),a=o.childNodes.length-1;a>=0;a--)o.removeChild(o.childNodes[a]);var s=document.createElement("div");s.style.height=unitH(o.offsetHeight-2),s.style.width=unitW(o.offsetWidth-2),s.style.minWidth=parseFloat(o.style.minWidth)-5+"px",s.style.minHeight=parseFloat(o.style.minHeight)-5+"px",o.appendChild(s),s.id=d.id;var l=d.id;t[e]=widgetsPluginsHandler.copyWidget(l,i,t[e],e,!0),g[e]=!1}(e),null!=widgetConnector.widgetsConnection[e]&&(widgetConnector.widgetsConnection[e].widgetObjConnect=t[e],m(e))}):_.each(_.keys(t),e=>{rescaleWidget(t,e)})}function x(){for(var e in t)delete t[e];for(var e in $("#dashboard-zone").html(""),a)delete a[e];for(var e in s)delete s[e];for(var e in l)delete l[e];for(var e in r)delete r[e];c=""}return{loadPlayMode:function(){x(),e=widgetEditor.getSnapshotDashZoneDims(),d.setDimensions(e),d.setScalingMethod(n),d.setRows(o),d.setCols(i),C(function(){var e=xdash.serialize();e.scaling=widgetEditor.getSnapshotDashZoneDims();var t=document.getElementById("dashboard-zone"),n=document.createElement("div");return n.id="DropperDroitec",n.className="dropperR",n.style.zIndex=0,n.style.borderRadius="10px",t.appendChild(n),reconstructFoundations.buildDivsFromXprjson(e),e}(),!1),0!=datanodesManager.getAllDataNodes().length&&f()},renderDashboardWidgets:C,updateDataFromWidget:v,resizeDashboard:function(e){if("undefined"!=typeof execOutisdeEditor&&execOutisdeEditor){var t=0;switch($("#nav-menu")[0]&&(t=parseInt($("#nav-menu")[0].style.height),isNaN(t)&&(t=0)),jsonContent.exportOptions){case"rowToPage":rowToPageRuntime.rowToPagePrepareRescale(o,i);break;case"rowToTab":rowToTabRuntime.rowToTabPrepareRescale(o,i);break;case"customNavigation":customNavigationRuntime.customNavigationPrepareRescale(o,i);break;case"keepOriginalWidth":$("#dashboard-zone")[0].style.height=scalingSrc.scrollHeightPx+t+"px";break;default:$("#dashboard-zone")[0].style.height=document.body.clientHeight-t+"px"}}d.setScalingMethod(n),d.setRows(o),d.setCols(i),d.resizeDashboard(e),N(),"undefined"!=typeof execOutsideEditor&&execOutsideEditor&&"rowToPage"==jsonContent.exportOptions&&setTimeout(rowToPageRuntime.rowToPageFinishRescale,500,o,i)},resizeDashboardCols:function(){d.resizeDashboardCols()},widget:t,plotConstantData:m,assignValueChangeHandlers:f,rescale:N,clear:function(){x(),htmlExport.exportOptions="ajustToTargetWindow"},deserialize:function(e){let t;for(t in _.each(_.keys(e),e=>{let t=e.substring(0,e.length-1),n=e+"c";null==widgetConnector.widgetsConnection[e]&&(widgetConnector.widgetsConnection[e]={name:n,id:n,instanceId:e,modelJsonId:t,sliders:[],widgetObjEdit:null,widgetObjConnect:null})}),widgetConnector.widgetsConnection)for(var n in e[t])_.isUndefined(e[t][n].dataNode)&&(e[t][n].dataNode=e[t][n].dataSource,delete e[t][n].dataSource),widgetConnector.widgetsConnection[t].sliders[n]=e[t][n];for(t in widgetConnector.widgetsConnection)try{widgetPreview.plotConstantData(t,!1),widgetConnector.widgetsConnection[t].widgetObjEdit=null}catch(e){}},setDataOnWidget:y,clearDataFromWidget:function(e,t,n,o){"D"===widgetConnector.widgetsConnection[e].sliders[t].name.substring(0,1)?n.setText(""):(!_.isUndefined(n.clearCaption)&&o&&n.clearCaption(),_.isUndefined(n.setValue)||n.setValue(null))},getCurrentDashZoneDims:u,getSnapshotDashZoneDims:function(){return e},getWidgetsRelativeDims:function(){return{width:a,height:s,left:l,top:r}},setScalingInformation:function(e,t,a,s){null!=e&&(d.setDimensions(e),null!=e.colDims&&d.deserialize(e)),null!=t&&(n=t,d.setScalingMethod(n)),null!=a&&(o=a,d.setRows(o)),null!=s&&(i=s,d.setCols(i))},getCols:function(){return d.getCols()},mediaChangeProjection:function(e,t,n){return d.mediaChangeProjection(e,t,n)},toPng:function(){var e=function(){var e,n,o=0,i=0,d=$("#dashboard-zone").offset().left,a=$("#dashboard-zone").offset().top,s=$("#dashboard-zone").height();for(var l in t)(e=$("#"+l+"c").offset().left-d+$("#"+l+"c").width())>o&&(o=e),(n=$("#"+l+"c").offset().top-a+$("#"+l+"c").height())>i&&(i=n),i>s&&(i=s);return{right:o,bottom:i}}(),n=document.getElementById("dashboard-zone"),o=n.style.height,i=n.style.width;n.style.height=e.bottom+"px",n.style.width=e.right+"px",html2canvas(n,{allowTaint:!1,useCORS:!0}).then((function(t){var d=Canvas2Image.convertToPNG(t,e.right,e.bottom),a=document.createElement("a");a.setAttribute("download",$("#projectName")[0].value+".png"),a.setAttribute("href",d.src.replace("image/png","image/octet-stream")),a.click(),n.style.height=o,n.style.width=i}))},elevateZIndex:function(e,n){var o=0;_.each(Object.keys(t),(function(e){var t=Number($("#"+e+"c")[0].style["z-index"]);t>o&&(o=t)})),$("#"+e+"c")[0].style["z-index"]=o+1}}}();
var pyodideLib={serialize:function(){const{standardLibs:i,micropipLibs:d}=pyodideManager.getProjectLibs();return{pyodideStandard:i.sort(),pyodideMicropip:d.sort()}},deserialize:async function(i){_.isUndefined(i.data.datanodes)&&(i.data.datanodes=i.data.datasources);const d=i.data.datanodes;let a=!1,o={standardLibs:[],micropipLibs:[]};if(d.forEach(i=>{"Python_pyodide_plugin"===i.type&&(a=!0)}),a){const i=pyodideManager.getDefaultLibs();for(const d in o)o[d]=_.union(o[d],i[d])}if(!_.isUndefined(i.libraries)){const{pyodideStandard:d,pyodideMicropip:a}=i.libraries,e={standardLibs:d,micropipLibs:a};for(const i in o)o[i]=_.union(o[i],e[i])}await pyodideManager.loadPyodideLibs(o)}};
var reconstructFoundations=function(){var e=401;function t(e){var t=document.getElementById("DropperDroitec");_.isUndefined(e.scaling)?(t.style.width="100",t.style.height="100"):(t.style.width=e.scaling.widthVw,t.style.height=e.scaling.heightVh),function(e){var t,i,n;if(_.isUndefined(e.device)?(t="",i=0,n=0):(t=e.device.cols.classType,i=e.device.cols.maxCells,n=e.device.cols.maxCols),0!=i)for(var r=document.getElementById("DropperDroitec"),o=i/n,a=1;a<=o;a++)for(var d=1+(a-1)*n;d<=a*n;d++){var s=document.createElement("div");s.setAttribute("class",t+" device-col"),s.setAttribute("id","dpr"+d+"c"),s.style.height=e.scaling.colDims.heightVh+"vh",r.appendChild(s),$("#dpr"+d+"c").hasClass("col-invisible")||$("#dpr"+d+"c").addClass("col-invisible")}}(e)}function i(t,i){var n=document.getElementById(i),r=function(t){var i=document.createElement("div");i.id=t.container.instanceId+"c",i.style.top=t.layout.top,i.style.left=t.layout.left,i.style.width=t.layout.width,i.style.height=t.layout.height,_.isUndefined(t.layout["z-index"])||(i.style["z-index"]=t.layout["z-index"]);i.style.position="absolute",i.style.cursor="default";var n=document.createElement("div");return n.id="WidgetContainer"+e+"c",e++,n.style.width=rmUnit(t.layout.width)-100/document.documentElement.clientWidth*2+"vw",n.style.height=rmUnit(t.layout.height)-100/document.documentElement.clientHeight*2+"vh",i.appendChild(n),i}(t);n.appendChild(r)}function n(e){reconstructFoundations.buildDivsFromXprjson(e);var t=e.exportOptions;_.isUndefined(e)||_.isUndefined(e.meta)||(document.title=e.meta.name),RuntimeDashboard.loadDashboard(e,t)}function r(e){var t=findGetParameter("inputParams");if(null!=t){var i=inputHandler.decodeInputPars(t);e=inputHandler.patchInputVariables(e,i)}}return{buildDivsFromXprjson:function(e){t(e),function(e){var t;if(!!_.isEmpty(e.device)||!!_.isEmpty(e.device.droppers))for(t in e.dashboard)i(e.dashboard[t],"DropperDroitec");else for(var n in e.device.droppers){var r=_.values(e.device.droppers[n]);for(var o in r)i(e.dashboard[r[o]],n+"c")}}(e)},loadXprjson:function(e){var t=findGetParameter("projectUrl");if(null==t){var i=e;e=r(e),n(i)}else $.get(t,(function(e){})).done((function(i){var o;try{o=JSON.parse(i),e=r(o),n(o)}catch(e){swal("Unable to parse "+t+" project",e,"error"),$(".wrapperloading").hide()}})).fail((function(e,t){datanodesManager.showLoadingIndicator(!1),swal("Error in loading xprjson from URL","Server response : "+e.status,"error")}))}}}();
var runtimeToolbar={toolbar:['<div class="top-nav" ng-if="showNavBar">','   <nav class="top-nav__menu" id="nav-menu">','       <ul class="top-nav__nav">','           <li class="top-nav__nav-item">','               <a class="top-nav__brand" target="_blank" href="'+xDashConfig.urlWebSite+'" title="Chalk\'it website">',"                   Powered by Chalk'it",'                   <img src="'+xDashConfig.urlBaseForExport+'assets/img/chalk-it-icon.svg" />',"               </a>","           </li>",'           <li ng-if="showPagination && (exportOptions == \'rowToPage\')" class="top-nav__nav-item top-nav__nav-item--row-to-page">\n                  <button class="top-nav__btn top-nav__btn--rounded" ng-click="rowToPageChange(\'previous\')">\n                    <i class="fa fa-chevron-left" aria-hidden="true"></i>\n                  </button>\n                  <div class="top-nav__title">Page {{pageNumber}} / {{totalPages}}</div>\n                  <button class="top-nav__btn top-nav__btn--rounded" ng-click="rowToPageChange(\'next\')">\n                    <i class="fa fa-chevron-right" aria-hidden="true"></i>\n                  </button>\n                </li>\n                <li ng-if="showPagination && (exportOptions == \'rowToTab\')" class="top-nav__nav-item top-nav__nav-item--row-to-tab">\n                  <div class="top-nav__btn-wrapper" ng-repeat="pageName in pageNames">\n                    <button id="btn-page-{{$index + 1}}" class="btn btn-rounded-fill primary" ng-class="{\'cancel\': pageNumber != $index + 1}"  ng-click="rowToTabChange($index + 1)">\n                      {{pageName}}\n                    </button>\n                  </div>\n                </li>',"       </ul>","       <ul class='top-nav__nav top-nav__nav--right'>",'            <li class="top-nav__nav-item dropdown" ng-if="navBarNotification">','                <a class="dropdown-toggle info-number" data-toggle="dropdown" aria-expanded="false">','                    <i class="fa fa-envelope-o" aria-hidden="true"></i>','                    <span class="badge bg-red">{{nbNotifications}}</span>',"                </a>",'                <ul id="menu1" class="dropdown-menu list-unstyled top-nav__msg-list" role="menu">',"                    <form>",'                        <li class="top-nav__msg-item" ng-if="nbNotifications">','                            <div class="text-center">','                                <div ng-show="!searchFrom" style="display: inline-block; width:80%;margin:13px">','                                    <h3 style="margin:0; line-height:normal"> Notifications list</h3>',"                                </div>","                            </div>","                        </li>",'                        <li class="top-nav__msg-item" ng-if="nbNotifications>shownNotificationsMax">','                            <div class="text-center">',"                                <strong>..too many notifications! Please acquit a few to display more.</strong>","                            </div>","                        </li>",'                        <li class="top-nav__msg-item" ng-repeat="notification in listNotifications | limitTo:- 100 |orderBy:-$index " ',"                            ng-show=\"!notification.hide&&(notification.dataNode.indexOf(notificationFilterDataValue)>=0||notificationFilterDataValue=='')\">",'                            <a class="top-nav__msg-link" ng-click="hideNotificationFromNavBar(notification)" title="Click to acquit this notification">','                                <span class="image"><img ng-src="{{urlBase+notification.img}}" alt="error Message"></span>',"                                <span>","                                    <span>{{notification.title || 'Error'}}</span>","                                <span class=\"data\">{{'Data: '}} {{notification.dataNode}}</span>","                                </span>","                                <span class=\"message\">{{notification.text + '. '}}</span>",'                                <span class="time">{{notification.time}}</span>',"                            </a>","                        </li>",'                        <li class="top-nav__msg-item text-center" ng-if="nbNotifications">','                            <a ng-click="clearAllNotifications()">',"                                <strong>Clear All Notifications</strong>",'                                <i class="fa fa-angle-right"></i>',"                            </a>","                        </li>","                    </form>","                </ul>","            </li>","        </ul>","    </nav>","</div>",""]};
var customNavigationRuntime=function(){const o=this;function e(){return o.grid}function t(e){o.grid=e}return o.jsonContent={},o.grid={rows:1,cols:1},{customNavigationPrepareRescale:function(o,s){let{rows:n,cols:r}=e();n=Number(o)||1,r=Number(s)||1,t({rows:n,cols:r}),n>1&&$("[id^=dpr][id$=c]").show()},customNavigationModeInit:function(o){const s=Number(o.pages.defaultPage.id);let{rows:n,cols:r}=e();if(n=Number(o.device.cols.valueRow)||1,r=Number(o.device.cols.valueCol)||1,t({rows:n,cols:r}),n>1)if($("[id^=dpr][id$=c]").hide(),r>1){const o=s*r;for(let e=o-r+1;e<=o;e++)$("#dpr"+e+"c").show()}else $("#dpr"+s+"c").show()},setJsonContent:function(e){o.jsonContent=e},customNavigationGoToPage:function(s){angular.element(document.body).scope().$root.pageNumber=s;const n=o.jsonContent;let r="",{rows:c,cols:i}=e();if(_.isEmpty(n)?(c=layoutMgr.getRows()||1,i=layoutMgr.getCols()||1,r=htmlExport.exportOptions):(c=Number(n.device.cols.valueRow)||1,i=Number(n.device.cols.valueCol)||1,r=n.exportOptions),t({rows:c,cols:i}),c>1)if("projectToTargetWindow"==r){$("#dpr"+s*i+"c")[0].scrollIntoView()}else if($("[id^=dpr][id$=c]").hide(),i>1){const o=s*i;for(let e=o-i+1;e<=o;e++)$("#dpr"+e+"c").show()}else $("#dpr"+s+"c").show()}}}();
var xDashApi={setVariable:function(a,e,t){datanodesManager.getDataNodeByName(a).setValue([],e,!1,t)},setVariables:function(a,e){let t=datanodesManager.getDataNodeByName(a[0]);for(let t=0;t<a.length;t++){let n=datanodesManager.getDataNodeByName(a[t]),o=e[t];n.setValue([],o,!1,!0)}t.schedulerStart(a,a[0],"setValue")},getVariable:function(a){var e=datanodesManager.getDataNodeByName(a);return _.isUndefined(e)?void 0:e.latestData()},setVariableProperty:function(a,e,t){datanodesManager.getDataNodeByName(a).setValue(e,t)},executeDataNode:function(a){datanodesManager.getDataNodeByName(a).schedulerStart(void 0,void 0,"vignette")},executeDataNodes:function(a){let e=[];for(let t=0;t<a.length;t++)e.push(datanodesManager.getDataNodeByName(a[t]));datanodesManager.getDataNodeByName(a[0]).schedulerStart(a,a[0],"vignette")},viewProject:function(a,e,t){var n=xDashConfig.urlBaseForExport,o=!1;"999"==xDashConfig.version.minor&&(o=!0);var i="";o||(i="-"+xDashConfig.version.fullVersion);var r=n+"index-view"+i+".html?projectUrl="+a+"&inputParams="+inputHandler.encodeInputPars(e);t?window.open(r,"_blank"):window.location=r},viewPage:function(a,e,t){var n=a+"?inputParams="+inputHandler.encodeInputPars(e);t?window.open(n,"_blank"):window.location=n},goToPage:function(a){customNavigationRuntime.customNavigationGoToPage(a)}};
var xdash=function(){var e=xDashConfig.version.fullVersion;const t=angular.element(document.body).scope().$root;function a(){angular.element(document.body).injector().invoke(["UndoManagerService",e=>{e.clear()}]),datanodesManager.clear(),widgetEditor.clear(),xdashNotifications.clearAllNotifications(),widgetConnector.clear(),widgetPreview.clear(),$("#projectName")[0].value="",$(".tab--active").removeClass("changed"),t.currentPrjDirty="";angular.element(document.getElementById("library__wrap")).scope().resetPyodideLibs(),layoutMgr.resetDashBgColor(),layoutMgr.resetDashboardTheme();angular.element(document.getElementById("help__wrap")).scope().initFrame()}function o(){return{version:e,date:Date(),name:"",description:"",groupName:"",tags:[],schedulerLogOff:offSchedLogUser}}async function n(e){try{return $("#projectName")[0].value=e.meta.name,_.isUndefined(e.meta.description)||(t.currentProject.description=e.meta.description),_.isUndefined(e.meta.tags)||(t.currentProject.tags=e.meta.tags),_.isUndefined(e.meta.groupName)||(t.currentProject.groupName=e.meta.groupName),_.isUndefined(e.meta.schedulerLogOff)?offSchedLogUser=!0:offSchedLogUser=e.meta.schedulerLogOff,await pyodideLib.deserialize(e),e.data.version=e.meta.version,datanodesManager.load(e.data,!0)?(angular.element(document.body).injector().invoke(["UndoManagerService",e=>{e.clear()}]),function(e,t,a,o){const n=e.droppers;let r=[];"datasources"in o?_.isUndefined(o.datasources)||(r=o.datasources.map(e=>e.name)):_.isUndefined(o.datanodes)||(r=o.datanodes.map(e=>e.name));if(_.isEmpty(n)){const e=_.keys(t);_.each(e,e=>{i(e,t,a,o,r)})}else{const e=_.keys(n);_.each(e,e=>{const l=_.keys(n[e]);_.each(l,l=>{let s=n[e][l];n[e][l]=i(s,t,a,o,r)})})}}(e.device,e.dashboard,e.connections,e.data),widgetEditor.deserialize(e.dashboard,e.scaling,e.device),widgetConnector.deserialize(e.connections),widgetPreview.clear(),widgetEditor.unselectAllWidgets(),layoutMgr.deserializeDashBgColor(e.device),layoutMgr.deserializeDashboardTheme(e.device),_.isUndefined(e.pages)||(layoutMgr.deserializeRowNames(e.pages),layoutMgr.deserializeDefaultRow(e.pages)),layoutMgr.deserializeExportOptions(e.exportOptions),_.isUndefined(e.navBarNotification)?htmlExport.navBarNotification=!1:htmlExport.navBarNotification=e.navBarNotification,!0):(a(),!1)}catch(e){return console.log(e),!1}}function i(e,t,a,o,n){if(e.includes("flatUiValue")&&!e.includes("flatUiValueDisplay")){let i="",r="";"datasources"in o?_.isUndefined(a[e].value.dataSource)||(r=a[e].value.dataSource):_.isUndefined(a[e].value.dataNode)||(r=a[e].value.dataNode);(""===r||n.includes(r))&&!_.isUndefined(t[e].modelParameters.isNumber)?(t[e].modelParameters.isNumber?(_.isUndefined(t[e].modelParameters.isPassword)||delete t[e].modelParameters.isPassword,i="flatUiNumericInput"):i="flatUiTextInput",delete t[e].modelParameters.isNumber):i="flatUiValueDisplay",_.isUndefined(t[e].container.id)||(t[e].container.id=t[e].container.id.replace("flatUiValue",i)),_.isUndefined(t[e].container.instanceId)||(t[e].container.instanceId=t[e].container.instanceId.replace("flatUiValue",i)),_.isUndefined(t[e].container.modelJsonId)||(t[e].container.modelJsonId=t[e].container.modelJsonId.replace("flatUiValue",i)),_.isUndefined(t[e].container.widgetTypeName)||(t[e].container.widgetTypeName=t[e].container.widgetTypeName.replace("flatUiValue",i)),_.isUndefined(t[e].modelParameters.decimalDigits)||delete t[e].modelParameters.decimalDigits;let l=e;return t[e=e.replace("flatUiValue",i)]=t[l],delete t[l],a[e]=a[l],delete a[l],e}return e}function r(e,t){let a="Previous";t&&"datanode"!=e||(a="Cancel"),(new FileMngrFct).GetFileList(e,l,!1,a,null)}function l(e,t,a,o){if("error"==a)swal(e,t,a);else if("success"==a){let a=t,n="files";"project"==a?n="projects":"datanode"==a&&(n="xdsjson"),contentElement=function(e,t){var a=document.createElement("div");a.classList.add("dashboard-form");var o='<label for="selectFile">'+t+"</label>";if(o+='<select class="multiple h-full" name="select-file" id="selectFile" size="10">',!_.isUndefined(e.FileList))for(let t=0;t<e.FileList.length;t++)_.isUndefined(e.FileList[t].Name)||(o=0==t?o+'<option selected value ="'+e.FileList[t].Name+'">'+e.FileList[t].Name+"</option>":o+'<option value ="'+e.FileList[t].Name+'">'+e.FileList[t].Name+"</option>");return o+="</select>",a.innerHTML=o,a}(e,"Please select a "+a+": "),new DialogBox(contentElement,"List of available "+n+" on server","Open",o,(function(){let e=$("#selectFile")[0];if(-1==e.selectedIndex)return!0;{datanodesManager.showLoadingIndicator(!0);let t=e.options[e.selectedIndex].value;swal.close(),(new FileMngrFct).ReadFile(a,t,s)}}))}}function s(e,t,a){if("error"==a)swal(e,t,a);else{let a=e,o=t;"project"==o?d(a):"datanode"==o&&xdsjson.openJsonManager(a)}datanodesManager.showLoadingIndicator(!1)}async function d(e){let t;try{t=JSON.parse(e)}catch(e){return void swal("Unable to load file","Project loading will be interrupted.","error")}var o;o=t,angular.element(document.body).injector().invoke(["$rootScope",function(e){e.currentProject={name:o.meta.name}}]);let i=!1,r=async function(e){if(a(),i=await n(t),datanodesManager.showLoadingIndicator(!1),document.removeEventListener("widgets-tab-loaded",r),t=void 0,!i)return swal("Unable to load your project","Project loading will be interrupted.","error"),!1};document.addEventListener("widgets-tab-loaded",r),"widgets"==tabActive&&("edit-dashboard"==modeActive?await r():showEditMode(!0,r))}return $(window).bind("beforeunload",(function(){return function(){let e=angular.element(document.body).scope().$root;if(""!==e.currentProject.name){let t=angular.element(document.getElementById("headerbar-ctrl")).scope();if($(".tab--active").hasClass("changed")){fileManager.getFileListExtended("project",e.currentProject.name,void 0,(function(){t.closeProject(e.currentProject.name,!0),console.log("Your project is saved before closing")}),!0)}else t.closeProject(e.currentProject.name),console.log("Your project was closed")}}(),"Are you sure you want to leave the page ?"})),{openFile:function(e,t){"project"==e?fileText="project":"datanode"==e&&(fileText="xdsjson"),"local"===t?function(e){let t=FileMngr.GetFileExt(e);if(window.File&&window.FileReader&&window.FileList&&window.Blob){let a=document.createElement("input");a.type="file",a.setAttribute("accept",t),$(a).on("change",(function(t){"project"==e&&swal.close();let a=t.target.files;if(a&&a.length>0){let t=a[0],o=new FileReader;datanodesManager.showLoadingIndicator(!0),o.addEventListener("load",(function(t){let a=t.target;"project"==e?d(a.result):"datanode"==e&&xdsjson.openJsonManager(a.result)})),o.readAsText(t)}})),$(a).trigger("click")}else swal("Unable to load a file in this browser.","","error")}(e):"server"===t&&r(e,!0)},openFromServer:r,serialize:function(){const e=o();e.name=$("#projectName")[0].value||"Untitled",t.currentProject&&(e.description=t.currentProject.description,e.tags=t.currentProject.tags,e.groupName=t.currentProject.groupName);const a=datanodesManager.serialize(),n=pyodideLib.serialize();let i;i=t.moduleOpened||"widgets"!=tabActive||"edit-dashboard"!=modeActive||"full"!=editorStatus?widgetEditor.getSnapshotDashZoneDims():widgetEditor.getCurrentDashZoneDims();const r=widgetEditor.serialize(),l=layoutMgr.serializeCols(),s=layoutMgr.serializeDashBgColor(),d=layoutMgr.serializeDashboardTheme(),c=widgetConnector.serialize(),u=layoutMgr.serializeRowNames(),g=layoutMgr.serializeDefaultRow(),m=layoutMgr.serializeExportOptions();return navBarNotification=htmlExport.navBarNotification,{meta:e,data:a,libraries:n,scaling:i,device:{...l,...s,...d},dashboard:r,connections:c,exportOptions:m,pages:{...u,...g},checkExportOptions:!0,navBarNotification:navBarNotification}},initMeta:o,openProjectManager:d,deserialize:n,clear:a,pageLoad:!0,readFileFromServer:function(e,t){let a=new FileMngrFct,o=angular.element(document.body),n=o.scope().$root,i=o.scope().$state;n.origin="openProject",n.showNotifications=!1,n.toggleMenuOptionDisplay("none"),i.go("modules",{}),n.moduleOpened=!1,a.ReadFile(t,e+".xprjson",(function(a,o,i){if("success"===i){xdash.openProjectManager(a);let o=new PNotify({title:e,text:"Your "+t+" "+e+" is ready!",type:"success",delay:1800,styling:"bootstrap3"});$(".ui-pnotify-container").on("click",(function(){o.remove()})),n.loadingBarStop(),n.currentProject.name=e}else swal(a,o,i)}))},readFileFromUrl:function(e,t){let a;$.get(t,(function(e){a=e})).done((function(){let t=angular.element(document.body),o=t.scope().$root,n=t.scope().$state;o.origin="openProject",o.showNotifications=!1,o.toggleMenuOptionDisplay("none"),n.go("modules",{}),o.moduleOpened=!1,s(a,e)})).fail((function(e,t){datanodesManager.showLoadingIndicator(!1),swal("Error in loading xprjson from URL","Server response : "+e.status,"error")}))}}}();
var htmlExport=function(){var e=function(e,t,n,r){var o=n.createDocumentType("html",null,null),i=n.createDocument(null,"html",o),a=i.documentElement,s=a.appendChild(i.createElement("head")),d=s.appendChild(i.createElement("title")),p=s.appendChild(i.createElement("meta")),c=a.appendChild(i.createElement("body"));c.setAttribute("ng-app","xCLOUD"),a.setAttribute("lang","en"),d.appendChild(i.createTextNode(r)),p.setAttribute("charset",window.document.characterSet),p.setAttribute("name","viewport"),p.setAttribute("content","width=device-width, initial-scale=1");var l=window.document.createElement("head");l.innerHTML=e;var u=window.document.createElement("body");u.innerHTML=t;for(var h=0;h<l.childNodes.length;h++)s.appendChild(i.importNode(l.childNodes.item(h),!0));for(var x=0;x<u.childNodes.length;x++)c.appendChild(i.importNode(u.childNodes.item(x),!0));var m,v=((m=document.createElement("div")).setAttribute("id","dashboard-zone"),m.setAttribute("class","panel-body"),m.setAttribute("style","padding: 0px"),m.innerHTML='<div id="DropperDroitec" class="dropperR" style="position:relative;z-index:0;border-radius:10px" ng-app="xCLOUD"></div>',m);return c.appendChild(i.importNode(v,!0)),i};function t(t,n){var r=window.document.implementation,o=function(){for(var e=[],t=0;t<exportHeaderCss.length;t++){var n=xDashConfig.urlBaseForExport;e.push('<link rel="stylesheet" href="'+n+exportHeaderCss[t]+'"></link>')}for(t=0;t<exportHeaderJs.length;t++)e.push('<script charset="UTF-8" src="'+xDashConfig.urlBaseForExport+exportHeaderJs[t]+'"><\/script>');return e.join("\n")}(),i=function(e){var t=[],n=[],r=[],o=[],i=[];let a,s=htmlExport.navBarNotification;_.isUndefined(e.navBarNotification)||(s=e.navBarNotification);for(var d=0;d<exportBodyJs.length;d++)t.push('<script src="'+xDashConfig.urlBaseForExport+exportBodyJs[d]+'"><\/script>');var p="jsonContent = "+JSON.stringify(e,null,"  ");a="rowToPage"==e.exportOptions||"rowToTab"==e.exportOptions||s,n.push("","<script>","",'tabActive = "play";',"execOutsideEditor = true;",'urlBase = "'+xDashConfig.urlBaseForExport+'";','navBarNotification = "'+s+'" ;','showNavBar = "'+a+'" ;',"$(function()","{","");var c=p+";";return r.push(""),o.push("reconstructFoundations.loadXprjson(jsonContent);","});","<\/script>",""),a&&i.push(...runtimeToolbar.toolbar),t.join("\n")+n.join("\n")+c+r.join("\n")+o.join("\n")+i.join("\n")}(_.isUndefined(n)?xdash.serialize():n),a=e(o,i,r,t);return(new XMLSerializer).serializeToString(a)}function n(e){var n,r,o;_.isUndefined(e)||(r=e[0],o=e[1]),_.isUndefined($("#select-export-settings")[0])||(htmlExport.exportOptions=$("#select-export-settings")[0].value),_.isUndefined($("#check-scale-export")[0])||(htmlExport.checkExportOptions=$("#check-scale-export")[0].checked),n=_.isUndefined(o)?$("#projectName")[0].value:o;var i=window.open("about:blank","_blank"),a=t(n,r);i.document.write(a),i.document.close(),i.focus()}return{previewDashboardCallback:n,previewDashboard:function(e,t,r){var o;_.isUndefined(e)||_.isUndefined(t)||(o=[e,t]),(htmlExport.checkExportOptions||r)&&n(o)},saveDashboard:function(){!function(){var e=$("#projectName")[0].value;_.isUndefined($("#select-export-settings")[0])||(htmlExport.exportOptions=$("#select-export-settings")[0].value);_.isUndefined($("#check-scale-export")[0])||(htmlExport.checkExportOptions=$("#check-scale-export")[0].checked);!function(e){var t=angular.element(document.body).scope().$root;t.infoPage={isPrivatePage:"True"===t.securedLink,name:e,title:"HTML page export",btnTxt:"Save",exportPage:!0,isManagePageOpen:!0}}(e)}()},exportOptions:"ajustToTargetWindow",checkExportOptions:!0,navBarNotification:!1,createDashboardDocument:t}}();
var widgetsEditorToolboxDefinition={"collapse-basic":{name:"Basic inputs & controls",widgets:["flatUiNumericInput","flatUiTextInput","flatUiCheckbox","flatUiSwitch","flatUiHorizontalSlider","flatUiVerticalSlider","flatUiDoubleSlider","flatUiButton","loadFile","saveToFileButton","flatUiSelect","flatUiMultiSelect","flatUiList","flatUiTable"]},"collapse-gauges":{name:"Basic displays",widgets:["flatUiValueDisplay","kpiCard","advancedKpiCard","ledStatus","flatUiProgressBar","scoringFullCircularGauge","scoringSemiCircularGauge","scoringArchCircularGauge"]},"collapse-plotly":{name:"Plots",widgets:["plotlyLine","plotlyBar","plotlyPie","plotly3dSurface","plotlyGeneric","plotlyPyGeneric","matplotlib","plotlyRealTime","vegaGeneric","echartsGeneric"]},"collapse-geotime":{name:"Geo & Time",widgets:["openStreetMaps","foliumMaps","flatUiHereAutocompleteValue","datepickerSimple","dateRangePicker","calendarD3","timepickerSimple"]},"collapse-annotations":{name:"Annotation & Video",widgets:["annotationIconInfo","annotationLabel","annotationImage","annotationMarkdown","annotationHtml","annotationVideo"]}};
function widgetToolboxClass(){var e=[],i=function(){let e=[],i=[],t=[],o=_.keys(widgetsEditorToolboxDefinition);for(let n=0;n<o.length;n++){i=[],e=widgetsEditorToolboxDefinition[o[n]].widgets,_.each(e,e=>{i.push(widgetsPluginsHandler.widgetToolbarDefinitions[e].title)});for(let o=0;o<e.length;o++)t.push({name:e[o],title:i[o]})}return t}();var t=function(){for(var i=e.length>0,t=i?["collapse-search_results"]:_.keys(widgetsEditorToolboxDefinition),o=i?["Search Results"]:_.pluck(widgetsEditorToolboxDefinition,"name"),n="",l=[],s=[],d=[],r=0;r<t.length;r++){l=[],s=[],d=[],l=i?e:widgetsEditorToolboxDefinition[t[r]].widgets,_.each(l,e=>{_.isUndefined(widgetsPluginsHandler.widgetToolbarDefinitions[e])?(swal("Widget plugin loader Error","Did not find the definition of delcared widget "+e,"error"),l=_.without(l,e)):(s.push(widgetsPluginsHandler.widgetToolbarDefinitions[e].title),d.push(widgetsPluginsHandler.widgetToolbarDefinitions[e].icn))});var a=p(t,o,r);n=[n,a=u(a=w(a,s,l,d))].join("\n")}$("#widgetGroups").html(""),$("#widgetGroups")[0].insertAdjacentHTML("beforeend",n);var g=angular.element(document.body).scope().$root;let c=angular.element(document.getElementById("widget__wrap")).scope();function p(e,i,t){return['<div class="widget__groups--wrapper " ng-class="{open:displayedWdgtIndex=='+t+'}">','    <div ng-click="toggleWidgetLibDisplay('+t+')" class="widget__groups--wrapper--top btn--collapse" id="'+e[r]+'">',"        <h3>"+i[r]+"</h3>","        <a>",'            <i class="basic icn-miniarrowbottom"></i>',"        </a>","    </div>",'    <div id="widget__groups--wrapper--icons" class="widget__groups--wrapper--icons">'].join("\n")}function w(e,i,t,o){var n=[],l=0;for(l=0;l<t.length;l++)n[l]=['        <a href="#" title="Click to clone" class="icons__item drag-drop-new" id="'+t[l]+'">','           <i class="widgets icn-'+o[l]+'"> </i>',"               <label>"+i[l]+"</label>","         </a>"].join("\n");for(l=0;l<n.length;l++)e=[e,n[l]].join("\n");return e}function u(e){return e=[e,"  </div>","</div>"].join("\n")}c.myWidgetHTML=$("#widgetGroups").html(),i&&(document.getElementById("widget__groups--wrapper--icons").style.overflow="visible"),i&&0!=c.displayedWdgtIndex&&c.toggleWidgetLibDisplay(0),g.safeApply()};t(),$("#inputSearchWidget").on("input",(function(o){var n=$(this).val(),l=[],s=!1;for(let e=0;e<i.length;e++)n.length>0&&i[e].title.toLowerCase().match(n)&&-1===l.indexOf(i[e].title)&&(l.push(i[e].name),s=!0);s?(e=l,t()):(e=[],t())}))}var WTBC=new widgetToolboxClass;
!function(e){e.fn.hasVScrollBar=function(){return this.get(0).scrollHeight>this.height()},e.fn.hasHScrollBar=function(){return this.get(0).scrollWidth>this.width()},e.fn.computeRatio=function(){return this.get(0).scrollWidth/this.width()}}(jQuery);var RuntimeDashboard=function(){var e;function a(a,o){e=jQuery.extend(!0,{},a.scaling);var s=0;switch($("#nav-menu")[0]&&(s=parseInt($("#nav-menu")[0].style.height),isNaN(s)&&(s=0)),o){case"keepOriginalWidth":$("#dashboard-zone")[0].style.width=e.scrollWidthPx+"px",$("#dashboard-zone")[0].style.height=e.scrollHeightPx+s+"px",e.scalingMethod="scaleTwSp";break;case"adjustToFullWidth":$("#dashboard-zone")[0].style.width="100%",$("#dashboard-zone")[0].style.height=document.body.clientHeight-s+"px",e.scalingMethod="scaleTwSpWS";break;case"ajustToTargetWindow":$("#dashboard-zone")[0].style.width="100%",$("#dashboard-zone")[0].style.height=document.body.clientHeight-s+"px",e.scalingMethod="scaleTwh";break;case"projectToTargetWindow":case"customNavigation":case"rowToTab":case"rowToPage":$("#dashboard-zone")[0].style.width="100%",$("#dashboard-zone")[0].style.height=document.body.clientHeight-s-1+"px",e.scalingMethod="scaleTwhS";break;default:$("#dashboard-zone")[0].style.width="100%",$("#dashboard-zone")[0].style.height="100%"}if($("#dashboard-zone")[0].style.margin="auto",$("#dashboard-zone")[0].style["overflow-x"]="hidden",$("#dashboard-zone")[0].style["overflow-y"]="hidden",$("#DropperDroitec")[0].style.height="100%",$("#DropperDroitec")[0].style.width="100%",$("#DropperDroitec")[0].style["overflow-y"]="auto",_.isUndefined(a.device))a.device={cols:{valueRow:"none",valueCol:"1",maxCells:0,maxCols:0,classType:""}};else{if(_.isUndefined(a.device.cols.valueRow))if(_.isUndefined(a.device.cols.value))a.device.cols.valueRow="none";else switch(a.device.cols.value){case"none":a.device.cols.valueRow="none";break;case"1":case"3":a.device.cols.valueRow="1";break;case"6":a.device.cols.valueRow="6";break;default:a.device.cols.valueRow="none"}if(_.isUndefined(a.device.cols.valueCol))if(_.isUndefined(a.device.cols.value))a.device.cols.valueCol="1";else switch(a.device.cols.value){case"none":case"1":a.device.cols.valueCol="1";break;case"3":case"6":a.device.cols.valueCol="3";break;default:a.device.cols.valueCol="1"}}const i=a.device.cols.maxCols,t=a.device.cols.maxCells/(i||1);var d=jQuery.extend(!0,{},e),r=widgetPreview.getCurrentDashZoneDims();widgetPreview.setScalingInformation(d,e.scalingMethod,t,i),widgetPreview.resizeDashboardCols();var n=widgetPreview.mediaChangeProjection(d,r,t);d=n.referenceFrame,r=n.targetFrame,widgetPreview.setScalingInformation(d,e.scalingMethod,t,i),widgetPreview.resizeDashboard(r)}return{initContainers:a,loadDashboard:async function(e,o){var s=$("<textarea />").html(JSON.stringify(e.data)).text(),i="";try{i=JSON.parse(s)}catch(e){return void swal("JSON Parse error",e.message,"error")}for(var t in await pyodideLib.deserialize(e),datanodesManager.load(i,!0),a(e,o),e.dashboard)if(_.isEmpty(e.dashboard[t].modelParameters)||(modelsParameters[t]=e.dashboard[t].modelParameters),_.isEmpty(e.dashboard[t].modelHiddenParams)||(modelsHiddenParams[t]=e.dashboard[t].modelHiddenParams),_.isUndefined(modelsTempParams[t])){var d=t.substring(0,t.length-1);modelsTempParams[t]=jQuery.extend(!0,{},modelsTempParams[d])}switch(!!_.isUndefined(e.meta.schedulerLogOff)||e.meta.schedulerLogOff,$("html").attr("data-theme",e.device.theme),widgetPreview.deserialize(e.connections),widgetPreview.renderDashboardWidgets(e,!0),$(".dropperR").css("background-color",e.device.backgroundColor),e.exportOptions){case"rowToPage":rowToPageRuntime.rowToPageModeInit(e);break;case"rowToTab":rowToTabRuntime.rowToTabModeInit(e);break;case"customNavigation":customNavigationRuntime.customNavigationModeInit(e);break;case"projectToTargetWindow":customNavigationRuntime.setJsonContent(e)}setTimeout(()=>{widgetPreview.assignValueChangeHandlers()},2e3)}}}();
var xdashNotifications=function(){var t=angular.element(document.body).scope().$root;return t.PnotifyStatus=!1,{addNotification:function(e,a){e.title&&e.text&&e.type&&(t.listNotifications.unshift(e),t.nbNotifications++,a||t.PnotifyStatus||(t.PnotifyStatus=!0,setTimeout((function(){t.PnotifyStatus=!1,function(t){let e=new PNotify({title:t.title,text:t.text,type:t.type,delay:1800,styling:"bootstrap3"});$(".ui-pnotify-container").on("click",(function(){e.remove()}))}(e)}),300)),t.safeApply())},manageNotification:function(t,e,a,n){var i="",o="",s="",c=!0;switch(t){case"warning":i="warning",o="Warning",s="assets/img/flat-icon/warning.png";break;case"success":i="success",o="Success",s="assets/img/flat-icon/success.png";break;case"error":i="error",o="Error",s="assets/img/flat-icon/error.png";break;case"info":i="info",o="Info",s="assets/img/flat-icon/info-custom.png";break;default:i="info",o="Info",s="assets/img/flat-icon/info.png"}if(_.isUndefined(datanodesManager.getDataNodeByName(e)))console.log("notification is not possible before dataNode creation.");else{if(_.isUndefined(datanodesManager.getDataNodeByName(e).__notifications)&&(datanodesManager.getDataNodeByName(e).__notifications=[]),n){c=!1;var r="none";datanodesManager.getDataNodeByName(e).__notifications.length>0&&(r=datanodesManager.getDataNodeByName(e).__notifications[0].type),"error"!==r&&"warning"!==r&&"info"!==r||(c=!0)}if(c){datanodesManager.getDataNodeByName(e).__notifications.unshift({type:i,title:o,text:a,kind:"dataNode",dataNode:e,img:s,time:(new Date).timeNow()});var d=!1,f="";null!==datanodesManager.getDataNodeByName(e).execInstance()&&(f=datanodesManager.getDataNodeByName(e).execInstance().getSchedulerCallOrigin()),datanodesManager.getDataNodeByName(e).sampleTime()<"60"&&"timer"==f&&(d=!0),xdashNotifications.addNotification({type:i,title:o,text:a,kind:"dataNode",dataNode:e,img:s,time:(new Date).timeNow()},d)}}},clearAllNotifications:function(){t.listNotifications=[],t.nbNotifications=0,t.safeApply()}}}();
var urlQueryEntry={process:function(e){if(!e&&xdash.pageLoad){xdash.pageLoad=!1;let e=findGetParameter("project");if(null==e){let e=findGetParameter("projectUrl");if(null==e){let e=findGetParameter("template");null!=e&&xdash.readFileFromServer(e,"template")}else xdash.readFileFromUrl("project",e)}else xdash.readFileFromServer(e,"project")}}};
var datanodesManager=function(){var e,n={},t=new DatanodeDependency;"undefined"==typeof execOutsideEditor?this.execOutsideEditor=!1:execOutsideEditor?this.execOutsideEditor=!0:this.execOutsideEditor=!1,this.execOutsideEditor||(e=new GraphVisu(t));var a=new TimeManager,o=new FreeboardUI,i=new DatanodesListModel(n,o,t,a),d=new JSONEdit,s={},r=new JSEditor,c=new PluginEditor(r);function l(e){if(e.sampleTime()&&a.unregisterDatanode(e.name()),t.hasSuccessors(e.name())){let n=Array.from(t.getSuccessors(e.name())).toString();n=n.replaceAll(",",", "),swal("Deleting dataNode side effects",'This dataNode "'+e.name()+'" is still used in dataNode(s) "'+n+'".\n It must be changed.',"warning")}var n=angular.element(document.body).scope().$root;i.deleteDatanode(e),i.datanodes.remove(e),n.alldatanodes=datanodesManager.getAllDataNodes(),n.filtredNodes=n.alldatanodes.length,n.showNotifications=!1,n.updateFlagDirty(!0),n.safeApply(),t.updateDisconnectedGraphsList(e.name(),"delete"),offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("All disconnected Graphs after delete: ",t.getAllDisconnectedGraphs())}function u(e){var n=!1,t=[];for(var a in widgetConnector.widgetsConnection)for(var o in widgetConnector.widgetsConnection[a].sliders)"None"!=widgetConnector.widgetsConnection[a].sliders[o].name&&widgetConnector.widgetsConnection[a].sliders[o].dataNode===e&&(n=!0,t.push(a));return n||(t=[]),[n,_.uniq(t)]}function g(e,n,t){if([bFoundConnection,prop]=u(e.name()),"datanode"==n&&bFoundConnection){let n=[];for(let e=0;e<prop.length;e++)n.push(widgetConnector.widgetsConnection[prop[e]].instanceId);swal({title:"Are you sure?",text:"This dataNode will be deleted and connections with widget(s) '"+n.join("\n")+"' may be removed!",type:"warning",showCancelButton:!0,showConfirmButton:!1,showConfirmButton1:!0,confirmButtonText:"Yes",cancelButtonText:"Abandon",closeOnConfirm:!0,closeOnConfirm1:!0,closeOnCancel:!0},(function(n){if(n){if(l(e),angular.element(document.body).scope().$root.bIsPlayMode)for(key in widgetConnector.widgetsConnection)widgetPreview.plotConstantData(key,!1)}}))}else{var a=angular.element(document.body).scope().$root;a.isPopupWindow=!0,a.popupTitle="Confirm Delete",a.popupText="Are you sure you want to delete this "+t,a.popupAction=function(){"datanode"==n&&l(e)}}}return ko.bindingHandlers.pluginEditor={init:function(e,t,a,o,i){var d=ko.unwrap(t()),s="";"datanode"==d.type&&(n,s="DataNode"),$(e).click((function(n){if("delete"==d.operation)g(o,d.type,s);else if("refresh"==d.operation)o.schedulerStart(void 0,void 0,"refresh");else if("stop"==d.operation)null!=o.execInstance()&&o.execInstance().stopOperation(o.name());else if("showTooltip"==d.operation)"datanode"==d.type&&($(e).tooltip("fixTitle"),$(e).tooltip("show"));else if("hide"==d.operation)"data-preview"==d.type&&$(e).parent().parent().parent().remove();else{"datanode"==d.type&&("add"==d.operation?{}:(o.type(),o.settings().name=o.name()))}}))}},ko.virtualElements.allowedBindings.datanodeTypeSettings=!0,ko.bindingHandlers.datanodeTypeSettings={update:function(e,n,t,a,o){processPluginSettings(e,n,t,a,o)}},{initialize:function(e){ko.applyBindings(i),o.showLoadingIndicator(!1),document.querySelectorAll(".docsLink").forEach((function(e){e.href=xDashConfig.urlDoc+"index.html"})),urlQueryEntry.process(e)},load:function(e,n,t){return i.load(e,n,t),!i.error()},serialize:function(){return i.serialize()},loadDatanodePlugin:function(e){_.isUndefined(e.display_name)&&(e.display_name=e.type_name),e.settings.unshift({name:"name",display_name:"Name",type:"text",required:!0}),n[e.type_name]=e,i._datanodeTypes.valueHasMutated()},getDataNodePluginTypes:function(){return n},setAssetRoot:function(e){r.setAssetRoot(e)},showLoadingIndicator:function(e){o.showLoadingIndicator(e)},foundDatanode:function(e){var n=i.datanodes();return datanode=_.find(n,(function(n){return n.name()===e})),!!datanode},getDataNodeByName:function(e){var n=i.datanodes();if(datanode=_.find(n,(function(n){return n.name()===e})),datanode)return datanode},getDatasourceByName:function(e){return datanodesManager.getDataNodeByName(e)},getAllDataNodes:function(){return i.datanodes()},getAllDataSources:function(){return datanodesManager.getAllDataNodes()},clear:function(){return schedulerProfiling={},i.clear()},showDepGraph:function(n){e.showDepGraph(n),angular.element(document.getElementById("dependency__graph--container")).scope().getUniqTypes()},editNodeFromGraph:function(e){angular.element(document.getElementById("dependency__graph--container")).scope().editNodeFromGraph(e)},selectNodeFromTagList:function(n){e.selectNodeFromTagList(n)},selectConnectedWithWidget:function(n){e.selectConnectedWithWidget(n)},closeGraph:function(){e.closeGraph()},isSingletonNode:function(e){return t.isSingletonNode(e)},RemoveUnusedDatanodes:function(){var e=[],n=t.getAllsingletonNodes();for(let t in n)[bFoundConnection,prop]=u(n[t]),bFoundConnection||e.push(n[t]);offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("zombie: ",e);var a=[],o=xdsjson.getDataList(e,"Unused data is a singleton node that is not connected to any widget.<br>Please check data to be deleted : ");new DialogBoxForData(o,"List of unused data","Delete","Cancel",(function(){for(var n=0;n<e.length;n++)$("#data-checkbox-"+n).is(":checked")&&(a[n]=e[n],l(datanodesManager.getDataNodeByName(e[n])),!0)}))},stopSchedule:function(){var e=i.datanodes();for(var n in Object.keys(t.getExtraStartNodes()).length&&t.clearExtraStartNodes(),e)if(null!=e[n].execInstance()){e[n].execInstance().stopAllOperations(),swal("Scheduler progress","scheduler is stopped!","success");break}},isConnectedWithWidgt:u,previewWidget:function(e){var n=[];$("#widgets-preview-top > div").each((e,t)=>{n.push(t.id),$("#"+t.id).hide()}),$("#widget-preview-zone-"+e).show()},deleteDataNode:function(e,n,t){g(e,n,t)},createPluginEditor:function(e,n,t,a){!function(e,n,t,a){c.createPluginEditor(e,n,t,a)}(e,n,t,a)},settingsSavedCallback:function(e,o,d,s){return!!c.saveSettings(s,d,(function(){return function(e,o,d){var s;if("add"==o.operation){if("datanode"==o.type){if(datanodesManager.foundDatanode(d.settings.name))return swal("A dataNode with name '"+d.settings.name+"' adready exists.","Please specify a different name","error"),!0;(s=new DatanodeModel(i,n,t,a)).name(d.settings.name),s.settings(d.settings),s.type(d.type);const e="icn-"+d.iconType.replace(/\.[^/.]+$/,"");if(s.iconType(e),s.error())return!0;s.isSchedulerStartSafe(!0),i.addDatanode(s),t.updateDisconnectedGraphsList(s.name(),"add"),offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("All disconnected Graphs after add: ",t.getAllDisconnectedGraphs()),_.isUndefined(d.settings.sampleTime)||0==d.settings.sampleTime?s.schedulerStart(void 0,void 0,"unidentified"):(s.sampleTime(d.settings.sampleTime),a.registerDatanode(s.sampleTime(),s.name(),"unidentified")),angular.element(document.body).injector().invoke(["$rootScope",function(e){}]);var r=angular.element(document.body).scope().$root;r.alldatanodes=datanodesManager.getAllDataNodes(),r.showNotifications=!1,r.safeApply()}}else if("edit"==o.operation){if("datanode"==o.type){if(e.isSettingNameChanged(d.settings.name)){if(datanodesManager.foundDatanode(d.settings.name))return swal("A dataNode with name '"+d.settings.name+"' adready exists.","Please specify a different name","error"),!0;if(t.hasSuccessors(e.name())){var c=Array.from(t.getSuccessors(e.name()));swal("Renaming dataNode side effects",'Old name "'+e.name()+'" is used in dataNode(s) "'+c+'" and should be changed by the new one "'+d.settings.name+'".',"warning"),t.addNode(e.name())}null!=e.execInstance()&&e.execInstance().stopOperation(e.name()),i.renameDatanodeData(e.name(),d.settings.name)}t.renameNode(e.name(),d.settings.name),e.name(d.settings.name),_.isUndefined(d.settings.sampleTime)||e.isSettingSampleTimeChanged(d.settings.sampleTime)&&e.sampleTime(d.settings.sampleTime)}e.type(d.type),e.settings(d.settings);const n="icn-"+d.iconType.replace(/\.[^/.]+$/,"");if(e.iconType(n),e.error())return!0;"datanode"==o.type&&(t.computeAllDisconnectedGraphs(),offSchedLogUser||xDashConfig.disableSchedulerLog||console.log("All disconnected Graphs after rename: ",t.getAllDisconnectedGraphs()),_.isUndefined(d.settings.sampleTime)?e.schedulerStart(void 0,void 0,"edit"):0!=e.sampleTime()?a.registerDatanode(e.sampleTime(),e.name(),"edit"):a.isRegisteredDatanode(e.name())&&(a.unregisterDatanode(e.name()),e.schedulerStart(void 0,void 0,"edit")))}return!1}(e,o,d)}))},getOldSettingsCallback:function(e){!function(e){if(_.isFunction(e.getSavedSettings)){var n=e.getSavedSettings();if(!_.isUndefined(n))e.settings(n[1]),e.statusCallback(n[0]),e.name()!==n[1].name&&i.renameDatanodeData(e.name(),n[1].name),t.renameNode(e.name(),n[1].name),e.name(n[1].name),n[1]}}(e)},getDataNodeNewSettings:function(){return c.getNewSettings()},getJsonEd:function(){return d},setJsonEditor:function(e){s=e},getJsonEditor:function(){return s}}}();
!function(){var n=!1;datanodesManager.loadDatanodePlugin({type_name:"JSON_var_plugin",display_name:"Variable",icon_type:"json-variable.svg",description:"JavaScript workspace variable",external_scripts:[""],settings:[{name:"json_var",display_name:"Variable",type:"json",description:"JSON, array or primitive data type variable (with read/write permissions)"}],newInstance:function(r,t,a,i){return t(new e(r,a,i)),!n}});var e=function(e,r,t){n=!1;var a=this,i={},s=e,o=e,u="None";a.onSettingsChanged=function(n){return s=n,a.isJsonParsingSuccess()},a.isJsonParsingSuccess=function(){t("Pending");try{return i=JSON.parse(s.json_var),!0}catch(n){return swal("JSON Parse error",n.message,"error"),t("Error","Error in JSON parse"),!1}},a.isSettingNameChanged=function(n){return s.name!=n},a.getSavedSettings=function(){return[u,o]},a.updateNow=function(){return t("OK"),u="OK",o=s,r(i),!0},a.onDispose=function(){},this.isSetValueValid=function(){return!0},a.isSetFileValid=function(){return!0},a.isInternetNeeded=function(){return!1},a.setFile=function(n){return"application/json"===n.type?n.isBinary?s.json_var=atob(n.content):s.json_var=n.content:s.json_var=JSON.stringify(n),a.isJsonParsingSuccess()},a.setValue=function(n,e){if(0==n.length)return i=e,void(s.json_var=JSON.stringify(i));if(1==n.length)i[n[0]]=e;else{for(var r,t=0;t<n.length-1;t++)r=0==t?i[n[t]]:r[n[t]];r[n[n.length-1]]=e}s.json_var=JSON.stringify(i)},a.getValue=function(n){if(0==n.length)return i;if(1==n.length)return i[n[0]];for(var e,r=0;r<n.length-1;r++)e=0==r?i[n[r]]:e[n[r]];return e[n[n.length-1]]};try{i=JSON.parse(s.json_var),n=!1}catch(e){swal("JSON Parse error",e.message,"error"),n=!0}}}();
!function(){var e=!1;datanodesManager.loadDatanodePlugin({type_name:"JSON_delay_plugin",display_name:"Delay",icon_type:"delay.svg",description:"JavaScript one-step delay operator",external_scripts:[""],settings:[{name:"json_init",display_name:"init value",type:"json",description:"Initial value (JSON, array or primitive data type)"},{name:"json_input",display_name:"Input signal",type:"calculated",description1:"Write JavaScript formula to define JSON, array or primitive data type input to be delayed.",description2:"Browse and select a dataNode from workspace to use it in the formula."}],newInstance:function(n,r,a,i){return r(new t(n,a,i)),!e}});var t=function(t,n,r){e=!1;var a={},i={},o={},s=!0,u=t;this.onSettingsChanged=function(e){u=e;try{a=JSON.parse(u.json_init),u}catch(e){return swal("JSON Parse error",e.message,"error"),r("Error"),!1}return!0},this.isSettingNameChanged=function(e){return u.name!=e},this.updateNow=function(){if(r("Pending"),s)try{s=!1,a=JSON.parse(u.json_init)}catch(e){return swal("JSON Parse error",e.message,"error"),r("Error"),n(void 0,"Error"),!1}return i=a,a="object"==typeof o?jQuery.extend(!0,{},o):o,r("OK"),n(i),"OK",u,!0},this.onDispose=function(){},this.isSetValueValid=function(){return!1},this.isSetFileValid=function(){return!1},this.isInternetNeeded=function(){return!1},this.onCalculatedValueChanged=function(e,t){o=t}}}();
!function(){var t=!1;datanodesManager.loadDatanodePlugin({type_name:"JSON_formula_plugin",display_name:"Script (client-side)",icon_type:"json-formula.svg",description:"JavaScript Script (client-side) plugin",external_scripts:[""],settings:[{name:"autoStart",display_name:"AUTO START",description:"DataNode is executed automatically at start (project load, its creation/modification).",type:"boolean",default_value:!0},{name:"explicitTrig",display_name:"Explicit trigger",description:"DataNode is executed only if triggered explicitly (no execution when its predecessors are updated). It is executed automatically once when AutoStart is “YES”.",type:"boolean",default_value:!1},{name:"json_var_formula",display_name:"Javascript formula",type:"calculated",description1:"Write Javascript formula that returns a JSON, array or primitive data type ouptput",description2:"Browse and select a dataNode from workspace to use it in the formula."}],newInstance:function(i,n,a,r,o){if(!n(new e(i,a,r,o)))return!t}});var e=function(e,i,n,a){t=!1;var r={},o=e,s=e,u="None";this.onSettingsChanged=function(t){return o=t,!0},this.isSettingNameChanged=function(t){return o.name!=t},this.getSavedSettings=function(){return[u,s]},this.updateNow=function(e,l){return o.explicitTrig&&e?{notTobeExecuted:!0}:o.autoStart||l||e?(n("Pending"),_.isNull(r)||_.isUndefined(r)?(t=!0,text="Formula is null or undefined",n("Error",text),i(r,"Error"),!1):_.isObject(r)&&_.isEmpty(r)&&_.isEmpty(o.json_var_formula)?(t=!0,text="Formula is empty",a("warning",o.name,text,"Formula error"),n("Error",text),i(r,"Error"),!1):(t=!1,u="OK",s=o,n("OK"),i(r),!0)):{notTobeExecuted:!0}},this.onDispose=function(){},this.isSetValueValid=function(){return!1},this.isSetFileValid=function(){return!1},this.isInternetNeeded=function(){return!1},this.onCalculatedValueChanged=function(t,e){r=e}}}();
!function(){var e=function(e,a,s,r,n){t=!1;var o,i,d=e,u="JSON",l="",p="",c="",y={};function m(){var e=d.url;switch(p=d.url,d.resp_data_type){case"JSON":u="json";break;case"binary":u="binary";break;case"text":u="text"}if(_.isUndefined(d.use_jsonp)||(d.use_jsonp=!1),d.use_jsonp&&(u="JSONP"),_.isUndefined(d.use_thingproxy)||(d.use_thingproxy?d.use_xproxy=!0:d.use_xproxy=!1),d.use_xproxy)switch(d.method){case"GET":p=xServConfig.urlxProxy+"Get";break;case"POST":p=xServConfig.urlxProxy+"Post";break;case"PUT":p=xServConfig.urlxProxy+"Put";break;case"DELETE":p=xServConfig.urlxProxy+"Delete"}if("calculated"!=r&&(l=d.body),l){try{y=JSON.parse(l),"GET"==d.method&&(l="")}catch(e){return swal("JSON Parse error",e.message,"error"),!1}_.isUndefined(y)||_.isNull(y)||_.isUndefined(y.urlAppend)||(d.use_xproxy?e=d.url+y.urlAppend:p+=y.urlAppend)}if(d.use_xproxy){var a={};if(_.each(d.headers,(function(e){var t=e.name,s=e.value;a[t]=s})),!_.isUndefined(y)&&!_.isNull(y)&&(_.isUndefined(y.headersFromDatasourceWS)||(y.headersFromDataNodeWS=y.headersFromDatasourceWS,delete y.headersFromDatasourceWS),!_.isUndefined(y.headersFromDataNodeWS)))for(var t in y.headersFromDataNodeWS)a[t]=y.headersFromDataNodeWS[t];var s="";if(l){let e=JSON.parse(l);_.isUndefined(e)||_.isNull(e)||(_.isUndefined(e.headersFromDatasourceWS)||delete e.headersFromDatasourceWS,_.isUndefined(e.headersFromDataNodeWS)||delete e.headersFromDataNodeWS),_.isUndefined(e)||_.isNull(e)||_.isUndefined(e.urlAppend)||delete e.urlAppend,s=JSON.stringify(e)}l={URL:e,Body:s,Headers:JSON.stringify(a)},l=JSON.stringify(l)}else if(l)try{let e=JSON.parse(l);_.isUndefined(e)||_.isNull(e)||(_.isUndefined(e.headersFromDatasourceWS)||delete e.headersFromDatasourceWS,_.isUndefined(e.headersFromDataNodeWS)||delete e.headersFromDataNodeWS),_.isUndefined(e)||_.isNull(e)||_.isUndefined(e.urlAppend)||delete e.urlAppend,l=JSON.stringify(e)}catch(e){return swal("Data Parse error",e.message,"error"),!1}function n(){let e=JSON.parse(l),a=JSON.parse(e.Headers);a["ProxyCode-Hash"]=d.proxyHash,a["ProxyCode-Sig"]=d.proxySig,e.Headers=JSON.stringify(a),l=JSON.stringify(e)}if(d.use_xproxy&&(u="JSON"),d.use_xproxy){_.isUndefined(d.proxyHash)&&(d.proxyHash=""),_.isUndefined(d.proxySig)&&(d.proxySig="");let a=new FileMngrFct;if(proxyHashTemp=a.Hash4Proxy(e,"xdash"),""!==d.proxyHash&&d.proxyHash.localeCompare(proxyHashTemp))n();else{d.proxyHash=proxyHashTemp;let e=JSON.stringify({Hash:d.proxyHash});i=$.ajax({url:xServConfig.urlxProxy+"Sign",type:"POST",contentType:"application/json; charset=utf-8",dataType:"json",data:e,success:function(e){var a=jQuery.parseJSON(e.d);return a.Success?(d.proxySig=a.Msg,n(),!0):(swal("Proxy signing error",a.Msg,"error"),d.proxySig="",!1)},error:function(e,a,t){return swal("Proxy signing error",e.statusText,"error"),d.proxySig="",!1}})}}return!0}function f(e,t,r){var i=null,u="",l=d.method;d.use_xproxy&&(l="POST"),o=$.ajax({url:e,dataType:t,type:l||"GET",data:r,responseType:"arraybuffer",beforeSend:function(e){try{if(d.use_xproxy)e.setRequestHeader("Content-Type","application/json");else if(_.each(d.headers,(function(a){var t=a.name,s=a.value;_.isUndefined(t)||_.isUndefined(s)||e.setRequestHeader(t,s)})),!_.isUndefined(y)&&!_.isNull(y)&&(_.isUndefined(y.headersFromDatasourceWS)||(y.headersFromDataNodeWS=y.headersFromDatasourceWS,delete y.headersFromDatasourceWS),!_.isUndefined(y.headersFromDataNodeWS)))for(var a in y.headersFromDataNodeWS)e.setRequestHeader(a,y.headersFromDataNodeWS[a])}catch(e){swal("Error",e.message,"error")}},success:function(e,t,r){if("Stop"==datanodesManager.getDataNodeByName(d.name).schedulerStatus())return s("None","Request is aborted"),a(void 0,"None"),n("info",d.name,"Response status 0 : abort"),!1;o=void 0;var i=r.getResponseHeader("Content-Type");if(_.isNull(i))return s("OK"),a(null),"OK",!0;if(i.match("application/json")){c=e;var l=[],p=0;for(var y in e)l[p]=y,p++;if(1==l.length&&"d"==l[0]){try{e=JSON.parseMore(e.d)}catch(e){return s("Error","Data parse error"),"Error",n("error",d.name,"Data parse error : "+e.message),void(bFinishTick=!0)}if(d.use_xproxy){if(!e.Success){var m="";return m=_.isUndefined(e.Message)?'xProxy returned error at dataNode "'+d.name+'"':'xProxy returned error at dataNode "'+d.name+'" : "'+e.Message+'"',u="Response status "+r.status+" :"+m,n("error",d.name,u),"Error",s("Error",u),!1}if(!_.isUndefined(e.Body))if(_.isUndefined(e.Headers["Content-Type"])){if(_.isNull(e.Body))return s("OK"),a(null),n("success",d.name,e.Message),"OK",!0}else{var f=e.Headers["Content-Type"];if(f.match("application/json"))try{e=JSON.parseMore(e.Body)}catch(e){return s("Error","Data parse error"),"Error",n("error",d.name,"Data parse error : "+e.message),void(bFinishTick=!0)}else if(f.match("text"))e={content:e.Body,type:f};else if(f.match("image")){e="base64ImageDetected"+e.Body}else e={content:e.Body,type:f};u="Response status "+r.status+" : "+r.statusText,n("success",d.name,u)}}else u="Response status "+r.status+" : "+r.statusText,n("success",d.name,u)}else u="Response status "+r.status+" : "+r.statusText,n("success",d.name,u)}else if(i.match("image")){e="base64ImageDetected"+base64ArrayBuffer(e),u="Response status "+r.status+" : "+r.statusText,n("success",d.name,u)}else if(i.match("text"))e={content:e,type:i},u="Response status "+r.status+" : "+r.statusText,n("success",d.name,u);else{e={content:base64ArrayBuffer(e),type:i},u="Response status "+r.status+" : "+r.statusText,n("success",d.name,u)}return s("OK"),a(e),"OK",!0},error:function(e,t,r){var i="error",l="Error";if(o=void 0,"abort"===t&&(i="info",l="None"),u=(u="Response status "+e.status+" : "+e.statusText)+". Ajax status: "+t,"Error",_.isUndefined(e.responseText))n(i,d.name,u);else{var p="",c=e.responseText.search("type"),y=e.responseText.search(">");p=-1!=c&&-1!=y?e.responseText.slice(c,y):e.responseText,n(i,d.name,u+". "+p)}return s(l,u),a(void 0,l),!1},complete:function(e,a){clearInterval(i)}}),i=setInterval((function(){navigator.onLine||_.isUndefined(o)||(datanodesManager.getDataNodeByName(d.name).completeExecution("NOP"),datanodesManager.getDataNodeByName(d.name).schedulerStatus("Stop"),n("error",d.name,"Internet is disconnected. Request of '"+d.name+"' wil be aborted"),o.abort())}),1e3)}this.getRestResponseData=function(){return c},this.updateNow=function(e,a){return d.explicitTrig&&e?{notTobeExecuted:!0}:d.autoStart||a||e?(a&&d.sampleTime>0&&(d.autoStart=!0),s("Pending"),function(e,a,t){o&&4!=o.readyState&&o.abort();i&&4!=i.readyState?i.done((function(){f(e,a,t=l)})):f(e,a,t)}(p,u,l),!0):{notTobeExecuted:!0}},this.onDispose=function(){},this.onSettingsChanged=function(e,a){"OK"===a&&(a,d),d=e;for(var t=0;t<d.headers.length;t++)""===d.headers[t].name&&d.headers.splice(t,t+1);var s=m();return s&&d,s},this.isSettingNameChanged=function(e){return d.name!=e},this.isSettingSampleTimeChanged=function(e){return d.sampleTime!=e},this.getXHR=function(){return o},this.isSetValueValid=function(){return!1},this.isSetFileValid=function(){return!1},this.isInternetNeeded=function(){return!0},t=!m(),"calculated"==r&&(this.onCalculatedValueChanged=function(e,a){l=JSON.stringify(a),m()})};function a(){if(_.isUndefined($("input#table-row-value-headers0")[0]))console.log("headers table is empty");else{var e=$("input#table-row-value-headers0"),a=$("input#table-row-value-headers1");switch($("select#select-option-req_data_type").val()){case"JSON":e[0].value="Content-Type",a[0].value="application/json";break;case"none":e[0].value="",a[0].value=""}var t=new CustomEvent("change");$("input#table-row-value-headers0")[0].dispatchEvent(t),$("input#table-row-value-headers1")[0].dispatchEvent(t)}}var t=!1;datanodesManager.loadDatanodePlugin({type_name:"REST_web-service_from_datasource",display_name:"REST Web-service",icon_type:"web-service-datasource.svg",description:"REST Web-service from dataNode workspace",settings:[{name:"url",display_name:"URL",type:"text",required:!0},{name:"use_xproxy",display_name:"Use xProxy",description:"xProxy allows your browser to call cross-domain REST APIs (which solves browser CORS policy issues). Keep this parameter to true, unless your distant REST API allows your browser to be called in a cross-origin context.",type:"boolean",default_value:!0},{name:"sampleTime",display_name:"Sample time",type:"number",suffix:"seconds",default_value:0},{name:"autoStart",display_name:"AUTO START",description:"DataNode is executed automatically at start (project load, its creation/modification).",type:"boolean",default_value:!0},{name:"explicitTrig",display_name:"Explicit trigger",description:"DataNode is executed only if triggered explicitly (no execution when its predecessors are updated). It is executed automatically once when AutoStart is “YES”.",type:"boolean",default_value:!1},{name:"req_data_type",display_name:"Request data-type",type:"option",description:"Choose the web-service request data-type that prefill automatically the first header.",options:[{name:"JSON",value:"JSON"},{name:"none",value:"none"}]},{name:"resp_data_type",display_name:"Response data-type",type:"option",description:"Choose the response data-type expected from the web-service.",options:[{name:"JSON",value:"JSON"},{name:"binary",value:"binary"},{name:"text",value:"text"}]},{name:"method",display_name:"Method",type:"option",options:[{name:"GET",value:"GET"},{name:"POST",value:"POST"},{name:"PUT",value:"PUT"},{name:"DELETE",value:"DELETE"}]},{name:"body",display_name:"Body",type:"calculated",description1:"Insert the body of the request. Normally only used if method is POST. If the method is GET, the content of urlAppend object will be appended to the URL. The content of headersFromDataNodeWS will be injected to headers",description2:"Browse and select a dataNode from workspace to use it in the body."},{name:"headers",display_name:"Headers",type:"array",settings:[{name:"name",display_name:"Name",type:"text"},{name:"value",display_name:"Value",type:"text"}],default_value:[{name:"Content-Type",value:"application/json"}],description:"The first header is 'READ ONLY' and reserved for Request Data-Type."}],newInstance:function(a,s,r,n,o){return s(new e(a,r,n,"calculated",o)),!t},preFillBody:function(){a()}}),xDashConfig.jsonEditorDatanodes&&datanodesManager.loadDatanodePlugin({type_name:"REST_web-service_from_JSON_editor",display_name:"REST Web-service from JSON editor",icon_type:"web-service-json-editor.svg",description:"REST Web-service from JSON editor",settings:[{name:"url",display_name:"URL",type:"text",required:!0},{name:"use_xproxy",display_name:"Use xProxy",description:"If that also fails due to CORS policy, you can use xProxy, which can solve many connection problems to APIs.",type:"boolean",default_value:!0},{name:"sampleTime",display_name:"Sample time",type:"number",suffix:"seconds",default_value:0},{name:"autoStart",display_name:"AUTO START",description:"DataNode is executed automatically at start (project load, its creation/modification).",type:"boolean",default_value:!0},{name:"req_data_type",display_name:"Request data-type",type:"option",description:"Choose the web-service request data-type that prefill automatically the first header.",options:[{name:"JSON",value:"JSON"},{name:"none",value:"none"}]},{name:"resp_data_type",display_name:"Response data-type",type:"option",description:"Choose the response data-type expected from the web-service.",options:[{name:"JSON",value:"JSON"},{name:"binary",value:"binary"},{name:"text",value:"text"}]},{name:"method",display_name:"Method",type:"option",options:[{name:"GET",value:"GET"},{name:"POST",value:"POST"},{name:"PUT",value:"PUT"},{name:"DELETE",value:"DELETE"}]},{name:"body",display_name:"Body",type:"json",description:'The body of the request. Normally only used if method is POST. If the method is GET, the content of "urlAppend" object it will be appended to the URL.'},{name:"headers",display_name:"Headers",type:"array",settings:[{name:"name",display_name:"Name",type:"text"},{name:"value",display_name:"Value",type:"text"}],default_value:[{name:"Content-Type",value:"application/json"}],description:"The first header is 'READ ONLY' and reserved for Request Data-Type."}],newInstance:function(a,s,r,n,o){return s(new e(a,r,n,"JSON",o)),!t},preFillBody:function(){a()}})}();
!function(){var e=!1;datanodesManager.loadDatanodePlugin({type_name:"Generic_file_reader_plugin",display_name:"Generic text file reader",icon_type:"text-file-reader.svg",description:"Read text files",external_scripts:[""],settings:[{name:"data_path",display_name:"Data file",description:"Browse to select file.",type:"browseText",required:!0}],newInstance:function(t,i,r,a){return i(new n(t,r,a)),!e}});var n=function(n,t,i){e=!1;var r,a=this,o=n,u=n,s="None";a.onSettingsChanged=function(e,n){return"OK"===n&&(s=n,u=o),o=e,a.isFileReadingSuccess()},a.isFileReadingSuccess=function(){return i("Pending"),null==(r=a.readFileContent())?(i("Error","Error in file struct"),!1):(u=o,!0)},a.isSettingNameChanged=function(e){return o.name!=e},a.getSavedSettings=function(){return[s,u]},a.updateNow=function(){return s="OK",i("OK"),t(r),!0},a.onDispose=function(){},a.isSetValueValid=function(){return!1},a.isSetFileValid=function(){return!0},a.isInternetNeeded=function(){return!1},a.readFileContent=function(){return _.isUndefined(o.content)?null:{content:o.content}},a.setFile=function(e){return o.content=e.content,o.data_path=e.name,a.isFileReadingSuccess()},r=a.readFileContent(),e=null==r}}();
!function(){var e=!1;datanodesManager.loadDatanodePlugin({type_name:"Generic_binary_file_reader",display_name:"Generic binary file reader",icon_type:"file-reader.svg",description:"Read binary files",external_scripts:[""],settings:[{name:"data_path",display_name:"Data file",description:"Browse to select file.",type:"browseBinary",required:!0}],newInstance:function(t,i,r,a){return i(new n(t,r,a)),!e}});var n=function(n,t,i){e=!1;var r,a=this,o=n,s=n,u="None";a.onSettingsChanged=function(e,n){return"OK"===n&&(u=n,s=o),o=e,a.isFileReadingSuccess()},a.isFileReadingSuccess=function(){return i("Pending"),null==(r=a.readFileContent())?(i("Error","Error in file struct"),!1):(s=o,!0)},a.isSettingNameChanged=function(e){return o.name!=e},a.getSavedSettings=function(){return[u,s]},a.updateNow=function(){return u="OK",i("OK"),t(r),!0},a.onDispose=function(){},a.isSetValueValid=function(){return!1},a.isSetFileValid=function(){return!0},a.isInternetNeeded=function(){return!1},a.readFileContent=function(){return _.isUndefined(o.content)?null:{content:o.content}},a.setFile=function(e){return o.content=e,o.data_path=e.name,a.isFileReadingSuccess()},r=a.readFileContent(),e=null==r}}();
!function(){var e=!1;datanodesManager.loadDatanodePlugin({type_name:"CSV_file_reader_plugin",display_name:"CSV file reader",icon_type:"csv-reader.svg",description:"Read CSV files",external_scripts:[],settings:[{name:"data_path",display_name:"Data file",description:"Browse to select CSV data file.",type:"browseText",required:!0},{name:"delimiter",display_name:"Delimiter",description:"The delimiting character. Leave auto to auto-detect.",type:"option",options:[{name:"auto",value:""},{name:"comma",value:","},{name:"semi-colon",value:";"},{name:"colon",value:":"},{name:"tabulation",value:"\t"},{name:"space",value:" "}]},{name:"eol",display_name:"Line endings",description:"The newline sequence. Leave auto to auto-detect.",type:"option",options:[{name:"auto",value:""},{name:"\\n",value:"\n"},{name:"\\r",value:"\r"},{name:"\\r\\n",value:"\r\n"}]},{name:"quote_char",display_name:"Quote Char",description:"The character used to quote fields. The quoting of all fields is not mandatory. Any field which is not quoted will correctly read.",type:"option",options:[{name:'"',value:'"'},{name:"'",value:"'"},{name:"empty",value:""}]},{name:"head",display_name:"Header line",description:"If true, the first row after metaData of parsed data will be interpreted as field names.",type:"boolean",default_value:!0},{name:"nb_meta_lines",display_name:"Number of metaData lines",type:"number",default_value:0,description:"If 0 no metaData exist before the header line. Otherwise metaData will be placed inside 'meta' object."},{name:"nb_subheader_lines",display_name:"Number of subheader lines",type:"number",default_value:0,description:"If 0 no subheader exist after the header line. Otherwise subheader will be placed inside 'subheader' object."},{name:"skip_empty_lines",display_name:"Skip empty lines",type:"boolean",default_value:!0},{name:"dynamic_typing",display_name:"Dynamic typing",description:"If true, numeric and boolean data will be converted to their type instead of remaining strings.",type:"boolean",default_value:!0},{name:"pluck",display_name:"Row to array",description:"If true, each row will be placed in an array.",type:"boolean",default_value:!0},{name:"embedding_object",display_name:"Embedd in content object",description:"If true, parsed file will be placed inside a top level 'content' object. It's true when metaData exist.",type:"boolean",default_value:!1}],newInstance:function(a,t,i,r){return t(new n(a,i,r)),!e}});var n=function(n,a,t){e=!1;var i,r=this,s=n,l=n,o="None";r.onSettingsChanged=function(e,n){return"OK"===n&&(o=n,l=s),s=e,r.isFileParsingSuccess()},r.isFileParsingSuccess=function(){return t("Pending"),null==(i=r.parseFileContent())?(t("Error","Error in file parse"),!1):(l=s,!0)},r.isSettingNameChanged=function(e){return s.name!=e},r.getSavedSettings=function(){return[o,l]},r.updateNow=function(){return o="OK",t("OK"),a(i),!0},r.onDispose=function(){},r.isSetValueValid=function(){return!1},r.isSetFileValid=function(){return!0},r.isInternetNeeded=function(){return!1},r.parseFileContent=function(){papaSettings={delimiter:s.delimiter,newline:s.eol,quoteChar:s.quote_char,header:s.head,dynamicTyping:s.dynamic_typing,skipEmptyLines:s.skip_empty_lines};var e={},n={},a=s.content;if(_.isUndefined(a))return null;if(_.isUndefined(s.nb_meta_lines)&&(s.nb_meta_lines=0),_.isUndefined(s.nb_subheader_lines)&&(s.nb_subheader_lines=0),s.nb_meta_lines>0){let n=a.split("\n");var t=n.splice(0,s.nb_meta_lines);for(let n=0;n<t.length;n++)e["metaLine"+n]=t[n];a=n.join("\n")}if(s.nb_subheader_lines>0){let e=a.split("\n");var i=e.splice(1,s.nb_subheader_lines);for(let e=0;e<i.length;e++)n["subheaderLine"+e]=i[e],""!==s.delimiter&&(n["subheaderLine"+e]=n["subheaderLine"+e].split(s.delimiter));a=e.join("\n")}if(r.parserResults=Papa.parse(a,papaSettings),0==r.parserResults.errors.length){var l=r.parserResults.data,o={};if(s.pluck)for(let e=0;e<r.parserResults.meta.fields.length;e++)colName=r.parserResults.meta.fields[e],o[colName]=_.pluck(l,colName);else o=l;return(s.embedding_object||s.nb_meta_lines>0||s.nb_subheader_lines>0)&&(o={content:o},s.embedding_object=!0,s.nb_meta_lines>0&&(o.meta=e),s.nb_subheader_lines>0&&(o.subheader=n)),o}return _.isUndefined(r.parserResults.errors[0].row)?swal("Parser error : "+r.parserResults.errors[0].type,r.parserResults.errors[0].message+" in '"+s.data_path+"'.","error"):swal("Parser error : "+r.parserResults.errors[0].type,r.parserResults.errors[0].message+" in line '"+r.parserResults.errors[0].row+"' of "+s.data_path+"'.","error"),null},r.setFile=function(e){return s.data_path=e.name,e.isBinary?s.content=atob(e.content):s.content=e.content,r.isFileParsingSuccess()},i=r.parseFileContent(),e=null==i}}();
!function(){var e=!1;datanodesManager.loadDatanodePlugin({type_name:"CSV_file_player_plugin",display_name:"CSV file player",icon_type:"csv-player.svg",description:"Play csv files",external_scripts:[],settings:[{name:"data_path",display_name:"Data file",description:"Browse to select CSV data file.",type:"browseText",required:!0},{name:"delimiter",display_name:"Delimiter",description:"The delimiting character. Leave auto to auto-detect.",type:"option",options:[{name:"auto",value:""},{name:"comma",value:","},{name:"semi-colon",value:";"},{name:"colon",value:":"},{name:"tabulation",value:"\t"},{name:"space",value:" "}]},{name:"eol",display_name:"Line endings",description:"The newline sequence. Leave auto to auto-detect.",type:"option",options:[{name:"auto",value:""},{name:"\\n",value:"\n"},{name:"\\r",value:"\r"},{name:"\\r\\n",value:"\r\n"}]},{name:"quote_char",display_name:"Quote Char",description:"The character used to quote fields. The quoting of all fields is not mandatory. Any field which is not quoted will correctly read.",type:"option",options:[{name:'"',value:'"'},{name:"'",value:"'"},{name:"empty",value:""}]},{name:"head",display_name:"Header line",description:"If true, the first row after metaData of parsed data will be interpreted as field names.",type:"boolean",default_value:!0},{name:"nb_meta_lines",display_name:"Number of metaData lines",type:"number",default_value:0,description:"If 0 no metaData exist before the header line. Otherwise metaData will be placed inside 'meta' object."},{name:"nb_subheader_lines",display_name:"Number of subheader lines",type:"number",default_value:0,description:"If 0 no subheader exist after the header line. Otherwise subheader will be placed inside 'subheader' object."},{name:"skip_empty_lines",display_name:"Skip empty lines",type:"boolean",default_value:!0},{name:"dynamic_typing",display_name:"Dynamic typing",description:"If true, numeric and boolean data will be converted to their type instead of remaining strings.",type:"boolean",default_value:!0},{name:"sampleTime",display_name:"Sample time",type:"number",suffix:"seconds",default_value:1},{name:"time_included",display_name:"Time included",description:"If true, the first row will be considered as time vector.",type:"boolean",default_value:!1},{name:"playback",display_name:"Playback",description:"If true, data will be played back.",type:"boolean",default_value:!0}],newInstance:function(a,t,i,r){return t(new n(a,i,r)),!e}});var n=function(n,a,t){e=!1;var i,r=this,s=n,l=n,o="None",u={},d=0,p=0,m={},c=0;r.onSettingsChanged=function(e,n){return"OK"===n&&(o=n,l=s),s=e,r.isFileParsingSuccess()},r.isFileParsingSuccess=function(){return c=0,t("Pending"),null==(i=r.parseFileContent())?(t("Error","Error in file parse"),!1):(l=s,!0)},r.isSettingNameChanged=function(e){return s.name!=e},this.isSettingSampleTimeChanged=function(e){return s.sampleTime!=e},r.getSavedSettings=function(){return[o,l]},r.updateNow=function(){return function(){for(var e=0;e<d;e++)s.nb_meta_lines>0||s.nb_subheader_lines>0?m[u[e]]=i.content[u[e]][c]:m[u[e]]=i[u[e]][c];c<p-1?c++:s.playback&&(c=0),o="OK",t("OK");var n={};s.nb_meta_lines>0&&(n.content=m,n.meta=i.meta),s.nb_subheader_lines>0&&(n.content=m,n.subheader=i.subheader),s.nb_meta_lines>0||s.nb_subheader_lines>0?a(n):a(m)}(),!0},r.onDispose=function(){},r.isSetValueValid=function(){return!1},r.isSetFileValid=function(){return!0},r.isInternetNeeded=function(){return!1},r.parseFileContent=function(){papaSettings={delimiter:s.delimiter,newline:s.eol,quoteChar:s.quote_char,header:s.head,dynamicTyping:s.dynamic_typing,skipEmptyLines:s.skip_empty_lines};var e={},n={},a=s.content;if(_.isUndefined(a))return null;if(_.isUndefined(s.nb_meta_lines)&&(s.nb_meta_lines=0),_.isUndefined(s.nb_subheader_lines)&&(s.nb_subheader_lines=0),s.nb_meta_lines>0){let n=a.split("\n");var t=n.splice(0,s.nb_meta_lines);for(let n=0;n<t.length;n++)e["metaLine"+n]=t[n];a=n.join("\n")}if(s.nb_subheader_lines>0){let e=a.split("\n");var l=e.splice(1,s.nb_subheader_lines);for(let e=0;e<l.length;e++)n["subheaderLine"+e]=l[e],""!==s.delimiter&&(n["subheaderLine"+e]=n["subheaderLine"+e].split(s.delimiter));a=e.join("\n")}if(r.parserResults=Papa.parse(a,papaSettings),0==r.parserResults.errors.length){var o=r.parserResults.data;d=r.parserResults.meta.fields.length,i={},m={},d>0&&(p=o.length);for(let e=0;e<d;e++){var c=r.parserResults.meta.fields[e];i[c]=_.pluck(o,c),u[e]=c}return s.nb_meta_lines>0&&(i.content=i,i.meta=e),s.nb_subheader_lines>0&&(i.content=i,i.subheader=n),i}return _.isUndefined(r.parserResults.errors[0].row)?swal("Parser error : "+r.parserResults.errors[0].type,r.parserResults.errors[0].message+" in '"+s.data_path+"'.","error"):swal("Parser error : "+r.parserResults.errors[0].type,r.parserResults.errors[0].message+" in line '"+r.parserResults.errors[0].row+"' of "+s.data_path+"'.","error"),null},r.setFile=function(e){return s.content=e,s.data_path=e.name,r.isFileParsingSuccess()},i=r.parseFileContent(),e=null==i}}();
!function(){var n=!1;datanodesManager.loadDatanodePlugin({type_name:"Unzip_file_plugin",display_name:"Unzip file",icon_type:"file-reader.svg",description:"unzip files",external_scripts:[""],settings:[{name:"data_path",display_name:"Data file",description:"Browse to select zipped file.",type:"unzip",required:!0}],newInstance:function(t,i,r,a){return i(new e(t,r,a)),!n}});var e=function(e,t,i){n=!1;var r,a=this,u=e,o=e,s="None";a.onSettingsChanged=function(n,e){return"OK"===e&&(s=e,o=u),u=n,a.isFileReadingSuccess()},a.isFileReadingSuccess=function(){return i("Pending"),null==(r=a.readFileContent())?(i("Error","Error in file struct"),!1):(o=u,!0)},a.isSettingNameChanged=function(n){return u.name!=n},a.getSavedSettings=function(){return[s,o]},a.updateNow=function(){return s="OK",i("OK"),t(r),!0},a.onDispose=function(){},a.isSetValueValid=function(){return!1},a.isSetFileValid=function(){return!0},a.isInternetNeeded=function(){return!1},a.readFileContent=function(){return _.isUndefined(u.content)?null:u.content},a.setFile=function(n){return u.content=n.content,u.data_path=n.name,a.isFileReadingSuccess()},r=a.readFileContent(),n=null==r}}();
!function(){var e=function(e,n,i){t=!1;var a=e;this.updateNow=function(e,t){if(!a.autoStart&&!t&&!e)return{notTobeExecuted:!0};t&&a.sampleTime>0&&(a.autoStart=!0),i("Pending");var o=new Date,r={numeric_value:o.getTime(),full_string_value:o.toLocaleString(),date_string_value:o.toLocaleDateString(),time_string_value:o.toLocaleTimeString(),date_object:o};return i("OK"),n(r),!0},this.onDispose=function(){},this.onSettingsChanged=function(e,t){return"OK"===t&&(t,a),a=e,!0},this.isSettingNameChanged=function(e){return a.name!=e},this.isSettingSampleTimeChanged=function(e){return a.sampleTime!=e},this.isSetValueValid=function(){return!1},this.isSetFileValid=function(){return!1},this.isInternetNeeded=function(){return!1}},t=!1;datanodesManager.loadDatanodePlugin({type_name:"Clock_web-service",display_name:"Clock",icon_type:"clock.svg",description:"Clock trigger",settings:[{name:"sampleTime",display_name:"Sample time",type:"number",suffix:"seconds",default_value:1},{name:"autoStart",display_name:"AUTO START",description:"DataNode is executed automatically at start (project load, its creation/modification).",type:"boolean",default_value:!0}],newInstance:function(n,i,a,o){return i(new e(n,a,o)),!t}})}();
!function(){datanodesManager.loadDatanodePlugin({type_name:"mqtt",display_name:"MQTT",icon_type:"mqtt.svg",description:"MQTT (Message Queuing Telemetry Transport) ISO standard publish-subscribe",external_scripts:["https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.js"],settings:[{name:"topic",display_name:"Topic",type:"text",description:"For IBM quickstart, replace only DEVICEID with the device id string found in the upper right corner. For Watson IoT platform, replace DEVICEID with your specific device mac address or with '+' to listen to all devices in your organization. For all other MQTT servers, enter your own topic search string.",required:!0,default_value:"iot-2/type/+/id/DEVICEID/evt/+/fmt/json"},{name:"server",display_name:"Server",type:"text",description:"For IBM quickstart use 'quickstart.internetofthings.ibmcloud.com', or type '[OrganizationID].messaging.internetofthings.ibmcloud.com' for Watson IoT, or enter any other MQTT server available.",required:!0,default_value:"quickstart.messaging.internetofthings.ibmcloud.com"},{name:"port",display_name:"Port",type:"number",description:"Typically either 8883 or 443 for secure, or 1883 for insecure communication.",required:!0,default_value:8883},{name:"use_encryption",display_name:"Use Encryption",type:"boolean",description:"Use TLS encryption to connect to the MQTT Server securely (datanodesManager.io requires all brokers to use encryption).",default_value:!0},{name:"client_id",display_name:"Client Id",type:"text",default_value:"quickstart",required:!0,description:"For IBM quickstart, use default 'quickstart'. For Watson IoT, enter your Organization ID. For all other MQTT servers, set a clientID which will be passed as 'a:clientID:ApiKey:Timestamp'."},{name:"api_key",display_name:"API Key/Username",description:"Not required for IBM quickstart, required for Watson IoT Platform connections.",type:"text",required:!1,default_value:""},{name:"api_auth_token",display_name:"API Auth Token/Password",description:"Not required for IBM quickstart, required for Watson IoT Platform connections.",type:"text",required:!1,default_value:""},{name:"json_data",display_name:"JSON messages?",type:"boolean",description:"If the messages on your topic are in JSON format they will be parsed so the individual fields can be used in datanodesManager widgets.",default_value:!0}],newInstance:function(n,t,r,o,i){t(new e(n,r,o,i))}});var e=function(e,n,t,r){error=!1;var o={},i=e;function a(){console.log("Subscribing to topic: "+i.topic),s.subscribe(i.topic)}this.onSettingsChanged=function(e){var s="";try{t("Pending"),c.disconnect()}catch(e){s="Could not disconnect client: "+e,r("error",i.name,s,"JSON file parse error"),t("Error","Could not disconnect client"),n({},"Error")}o={},i=e;var c=new Paho.MQTT.Client(i.server,i.port,"a:"+i.client_id+":"+i.api_key+(new Date).getTime().toString());c.connect({onSuccess:a,userName:i.api_key,password:i.api_auth_token,useSSL:i.use_encryption,timeout:10,cleanSession:!0,onFailure:function(e){s="Connection failed: "+e.errorMessage,r("error",i.name,s,"JSON file parse error"),t("Error","Connection failed"),n({},"Error")}})},this.isSettingNameChanged=function(e){return i.name!=e},this.updateNow=function(){var e="";console.log("Forcing Update"),t("Pending");try{o.disconnect()}catch(o){e="Could not disconnect client: "+o,r("error",i.name,e,"JSON file parse error"),t("Error","Could not disconnect client"),n({},"Error")}var o=new Paho.MQTT.Client(i.server,i.port,"a:"+i.client_id+":"+i.api_key+(new Date).getTime().toString());o.connect({onSuccess:a,userName:i.api_key,password:i.api_auth_token,useSSL:i.use_encryption,timeout:10,cleanSession:!0,onFailure:function(o){e="Connection failed: "+o.errorMessage,r("error",i.name,e,"JSON file parse error"),t("Error","Connection failed"),n({},"Error")}})},this.onDispose=function(){s.isConnected()&&s.disconnect(),s={}},this.isSetValueValid=function(){return!1},this.isSetFileValid=function(){return!1},this.isInternetNeeded=function(){return!0},console.log("Creating Paho client at timestamp="+(new Date).getTime().toString());var s=new Paho.MQTT.Client(i.server,i.port,"a:"+i.client_id+":"+i.api_key+(new Date).getTime().toString());s.onConnectionLost=function(e){console.log("Connection Lost"),0!==e.errorCode&&console.log("onConnectionLost: "+e.errorMessage),new Paho.MQTT.Client(i.server,i.port,"a:"+i.client_id+":"+i.api_key+(new Date).getTime().toString()).connect({onSuccess:a,userName:i.api_key,password:i.api_auth_token,useSSL:i.use_encryption,timeout:10,cleanSession:!0,onFailure:function(e){var o="Connection failed: "+e.errorMessage;r("error",i.name,o,"JSON file parse error"),t("Error","Connection failed"),n({},"Error")}})},s.onMessageArrived=function(e){var r=e.destinationName.split("/")[4],a="";a=i.json_data?JSON.parse(e.payloadString):e.payloadString,o[r]=a,t("OK"),n(o)},s.connect({onSuccess:a,userName:i.api_key,password:i.api_auth_token,useSSL:i.use_encryption,timeout:10,cleanSession:!0,onFailure:function(e){var o="Connection failed: "+e.errorMessage;r("error",i.name,o,"JSON file parse error"),t("Error","Connection failed"),n({},"Error")}})}}();
!function(){var e=function(e,n,t,r,a){var o,i="",s=e,c=!0,l=new Array,E=!0,d="",y=!1,u=!0,f={debug:!0,automaticOpen:!0,reconnectInterval:1e3,maxReconnectInterval:3e4,reconnectDecay:1.5,timeoutInterval:2e3,maxReconnectAttempts:4,binaryType:"arraybuffer"},A=function(){console.info("Connected to server ",i),r("success",s.name,"Connected to server "+i),y=!0,u=!0,_.isUndefined(s.init_value)||(c=!0),a("Ready")},p=function(){console.info("WebSocket Connection is closed..."),r("info",s.name,"WebSocket Connection is closed..."),y&&a("Stop"),y=!1},S=function(e){console.debug("WebSocket  (%s) OnError ",i,e),u&&(r("error",s.name,"WebSocket  ("+i+") error"),u=!1),a("NotReady"),y=!1},T=function(e){d=e.data,E?(E=!1,console.info("WebSocket received ",e.data),l="string"==typeof e.data||e.data instanceof String?e.data:g(e.data,s.decoding_options),t("OK"),n(l),console.info("Data processed ",l)):a("Ready")};function R(){o&&o.close(),console.log(s),i="ws://"+s.host+":"+s.port,(o=new ReconnectingWebSocket(i,[],f)).onopen=A,o.onerror=S,o.onmessage=T,o.onclose=p}function m(e,n=!0){_.isUndefined(o)||1!==o.readyState||(1==n?o.send(JSON.stringify(e)):o.send(e))}function g(e,n){if("JSON"===n.toUpperCase()){try{e=JSON.parse(e)}catch(e){console.log(e)}return e}var t,r,a,o=e.byteLength,i=new DataView(e),s=0,c=0;switch(n.toUpperCase()){case"ARRAYBUFFER2STRING":r=String.fromCharCode.apply(null,new Uint8Array(e));break;case"INT8ARRAY":for(a=Int8Array.BYTES_PER_ELEMENT,t=o/Int8Array.BYTES_PER_ELEMENT,t=Math.floor(t),r=new Array(t),s=0,c=0;s<t;s++,c+=a)r[s]=i.getInt8(c);break;case"UINT8ARRAY":for(a=Uint8Array.BYTES_PER_ELEMENT,t=o/Uint8Array.BYTES_PER_ELEMENT,t=Math.floor(t),r=new Array(t),s=0,c=0;s<t;s++,c+=a)r[s]=i.getUint8(c);break;case"INT16ARRAY":for(a=Int16Array.BYTES_PER_ELEMENT,t=o/Int16Array.BYTES_PER_ELEMENT,t=Math.floor(t),r=new Array(t),s=0,c=0;s<t;s++,c+=a)r[s]=i.getInt16(c,!0);break;case"UINT16ARRAY":for(a=Uint16Array.BYTES_PER_ELEMENT,t=o/Uint16Array.BYTES_PER_ELEMENT,t=Math.floor(t),r=new Array(t),s=0,c=0;s<t;s++,c+=a)r[s]=i.getUint16(c,!0);break;case"INT32ARRAY":for(a=Int32Array.BYTES_PER_ELEMENT,t=o/Int32Array.BYTES_PER_ELEMENT,t=Math.floor(t),r=new Array(t),s=0,c=0;s<t;s++,c+=a)r[s]=i.getInt32(c,!0);break;case"UINT32ARRAY":for(a=Uint32Array.BYTES_PER_ELEMENT,t=o/Uint32Array.BYTES_PER_ELEMENT,t=Math.floor(t),r=new Array(t),s=0,c=0;s<t;s++,c+=a)r[s]=i.getUint32(c,!0);break;case"FLOAT32ARRAY":for(a=Float32Array.BYTES_PER_ELEMENT,t=o/Float32Array.BYTES_PER_ELEMENT,t=Math.floor(t),r=new Array(t),s=0,c=0;s<t;s++,c+=a)r[s]=i.getFloat32(c,!0);break;case"FLOAT64ARRAY":for(a=Float64Array.BYTES_PER_ELEMENT,t=o/Float64Array.BYTES_PER_ELEMENT,t=Math.floor(t),r=new Array(t),s=0,c=0;s<t;s++,c+=a)r[s]=i.getFloat64(c,!0);break;default:for(a=Uint8Array.BYTES_PER_ELEMENT,t=o/Uint8Array.BYTES_PER_ELEMENT,t=Math.floor(t),r=new Array(t),s=0,c=0;s<t;s++,c+=a)r[s]=i.getUint8(c)}return r}this.onSettingsChanged=function(e,n){return"OK"===n&&(n,s),s.host!=e.host||s.port!=e.port||!y||!_.isUndefined(e.init_value)&&s.init_value!=e.init_value?(s=e,E=!0,a("Wait"),R()):s=e,s,!0},this.isSettingNameChanged=function(e){return s.name!=e},this.updateNow=function(e,a){if(!s.autoStart&&!a&&!e)return{notTobeExecuted:!0};var i;if(a&&(s.autoStart=!0),E){if(1===o.readyState&&(t("Pending"),!_.isUndefined(s.init_value)&&c&&(c=!1,"none"!=s.init_value)))if(function(e){try{JSON.parse(e)}catch(e){return!1}return!0}(s.init_value)){try{i=jQuery.extend(!0,{},JSON.parse(s.init_value))}catch(e){return r("error",s.name,"JSON Parse error"+e.message),t("Error","JSON Parse error"),n(void 0,"Error"),!1}m(i,!0)}else m(i=s.init_value,!1)}else t("Pending"),console.info("WebSocket received ",d),l="string"==typeof d||d instanceof String?d:g(d,s.decoding_options),t("OK"),n(l),console.info("Data processed ",l);return!0},this.onDispose=function(){o&&o.close()},this.onstop=function(){o&&o.close()},this.isSetValueValid=function(){return!1},this.isSetFileValid=function(){return!1},a("Wait"),E=!0,R()};datanodesManager.loadDatanodePlugin({type_name:"WS-receive-plugin",display_name:"WebSocket Receive",icon_type:"websocket.svg",description:"Websocket client to receive data in Chalk'it",external_scripts:[""],settings:[{name:"host",display_name:"Remote IP address",type:"text",description:"IP address or hostname of your remote WebSocket sender.",required:!0},{name:"port",display_name:"Remote IP port",type:"number",description:"The port to connect to your remote WebSocket sender.",required:!0},{name:"autoStart",display_name:"AUTO START",description:"DataNode is executed automatically at start (project load, its creation/modification).",type:"boolean",default_value:!0},{name:"init_value",display_name:"initializing token",type:"option",description:"This token is sent before the exchange begin. Normally only used if send to xMOD",options:[{name:"None",value:"none"},{name:"xMOD",value:"ws_init"}]},{name:"decoding_options",display_name:"Decoding options",description:"Decoding options applied on Response data.",type:"option",options:[{name:"JSON",value:"JSON"},{name:"Int8Array",value:"Int8Array"},{name:"Uint8Array",value:"Uint8Array"},{name:"Int16Array",value:"Int16Array"},{name:"Uint16Array",value:"Uint16Array"},{name:"Int32Array",value:"Int32Array"},{name:"Uint32Array",value:"Uint32Array"},{name:"Float32Array",value:"Float32Array"},{name:"Float64Array",value:"Float64Array"},{name:"Text",value:"Text"},{name:"ArrayBuffer2String",value:"ArrayBuffer2String"}]}],newInstance:function(n,t,r,a,o,i){return t(new e(n,r,a,o,i)),!0}})}();
!function(){var e=function(e,n,i,o,r){var a,s="",c=e,u=!0,d={},l=!1,p=!0,m={debug:!0,automaticOpen:!0,reconnectInterval:1e3,maxReconnectInterval:3e4,reconnectDecay:1.5,timeoutInterval:2e3,maxReconnectAttempts:4,binaryType:"arraybuffer"},f=function(){console.info("Connected to server ",s),o("success",c.name,"Connected to server "+s),p=!0,l=!0,_.isUndefined(c.init_value)||(u=!0),r("Ready")},y=function(){console.info("WebSocket Connection is closed..."),o("info",c.name,"WebSocket Connection is closed..."),l&&r("Stop"),l=!1},S=function(e){console.debug("WebSocket  (%s) OnError ",s,e),p&&(o("error",c.name,"WebSocket  ("+s+") error"),p=!1),r("NotReady")},g=function(e){};function h(){a&&a.close(),console.log(c),s="ws://"+c.host+":"+c.port,(a=new ReconnectingWebSocket(s,[],m)).onopen=f,a.onerror=S,a.onmessage=g,a.onclose=y}function v(e,t=!0){_.isUndefined(a)||1!==a.readyState||a.send(e)}this.onSettingsChanged=function(e,t){return"OK"===t&&(t,c),c.host!=e.host||c.port!=e.port||!l||!_.isUndefined(e.init_value)&&c.init_value!=e.init_value?(c=e,r("Wait"),h()):c=e,c,!0},this.isSettingNameChanged=function(e){return c.name!=e},this.isSettingSampleTimeChanged=function(e){return c.sampleTime!=e},this.updateNow=function(e,r){if(c.explicitTrig&&e)return{notTobeExecuted:!0};if(!c.autoStart&&!r&&!e)return{notTobeExecuted:!0};var s;if(r&&c.sampleTime>0&&(c.autoStart=!0),1===a.readyState){if(i("Pending"),!_.isUndefined(c.init_value)&&u&&(u=!1,"none"!=c.init_value))if(function(e){try{JSON.parse(e)}catch(e){return!1}return!0}(c.init_value)){try{s=jQuery.extend(!0,{},JSON.parse(c.init_value))}catch(e){return o("error",c.name,"Data Parse error"+e.message),i("Error","Data Parse error"),n(void 0,"Error"),!1}v(s,!0)}else v(s=c.init_value,!1);if(_.isNull(d)||_.isUndefined(d))return i("Error","script is null or undefined"),o("error",c.name,"script is null or undefined."),!1;if(_.isObject(d)&&_.isEmpty(d)&&_.isEmpty(c.json_input))return i("Error","JS script error"),t=!0,o("error",c.name,"JS script error: script cannot be empty."),!1;v(d),i("OK"),n(d)}return!0},this.onDispose=function(){a&&a.close()},this.onstop=function(){a&&a.close()},this.isSetValueValid=function(){return!1},this.isSetFileValid=function(){return!1},this.isInternetNeeded=function(){return!0},this.onCalculatedValueChanged=function(e,t){d=JSON.stringify(t)},r("Wait"),h()},t=!1;datanodesManager.loadDatanodePlugin({type_name:"WS-send-plugin",display_name:"WebSocket Send",icon_type:"websocket.svg",description:"Websocket client to send data to Chalk'it",external_scripts:[""],settings:[{name:"host",display_name:"Remote IP address",type:"text",description:"IP address or hostname of your remote WebSocket receiver.",required:!0},{name:"port",display_name:"Remote IP port",type:"number",description:"The port to connect to your remote WebSocket receiver.",required:!0},{name:"sampleTime",display_name:"Sample time",type:"number",default_value:0,suffix:"seconds",description:"Refresh rate for sending data. Data will be sent even if control values are not changed"},{name:"autoStart",display_name:"AUTO START",description:"DataNode is executed automatically at start (project load, its creation/modification).",type:"boolean",default_value:!0},{name:"explicitTrig",display_name:"Explicit trigger",description:"DataNode is executed only if triggered explicitly (no execution when its predecessors are updated). It is executed automatically once when AutoStart is “YES”.",type:"boolean",default_value:!1},{name:"init_value",display_name:"initializing token",type:"option",description:"This token is sent before the exchange begin. Normally only used if exchange with xMOD",options:[{name:"None",value:"none"},{name:"xMOD",value:"ws_init"}]},{name:"json_input",display_name:"JSON/Javascript input",type:"calculated",description1:"Can be literal JSON. Input to be sent.",description2:"Browse and select a dataNode from workspace to send it by web socket."}],newInstance:function(n,i,o,r,a,s){return i(new e(n,o,r,a,s)),!t}})}();
"true"!=xDashConfig.xDashBasicVersion&&function(){var o=function(o,t,n,i,a){error=!1;this.errorState=!1;var r,s,c,l=o,u=o,d="None",g={lat:0,lng:0};function p(o){g={lat:o.coords.latitude,lng:o.coords.longitude},console.log(g),a("Ready")}function f(o){var e;1==o.code?(console.log("Error: Access is denied !"),e="Error: Access is denied !",i("error",l.name,e),a("NotReady")):2==o.code?(console.log("Error: Position is unavailable !"),e="Error: Position is unavailable !",i("error",l.name,e),a("NotReady")):3==o.code&&(console.log("Error: Timeout expired !"),e="Error: Timeout expired !",i("error",l.name,e),a("NotReady"))}this.onSettingsChanged=function(o,e){return"OK"===e&&(d=e,u=l),l=o,!0},this.isSettingNameChanged=function(o){return l.name!=o},this.getSavedSettings=function(){return[d,u]},this.updateNow=function(o,e){if(!l.autoStart&&!e&&!o)return{notTobeExecuted:!0};n("Pending"),"watchPosition"==c&&(n("OK"),t(g))},this.onDispose=function(){"watchPosition"==c&&s.clearWatch(r)},this.isSetValueValid=function(){return!1},function(){if(s=navigator.geolocation){a("Wait");r=s.watchPosition(p,f,{maximumAge:0,timeout:5e3,enableHighAccuracy:!0}),c="watchPosition"}else console.log("Sorry, browser does not support geolocation"),swal("Browser support","Sorry, browser does not support geolocation","error"),e=!0}()},e=!1;datanodesManager.loadDatanodePlugin({type_name:"Geolocation-plugin",display_name:"Geolocation",icon_type:"geolocation.svg",description:"A geolocation plugin",external_scripts:[""],settings:[{name:"autoStart",display_name:"Auto start",description:"DataNode is executed automatically at start (project load, its creation/modification).",type:"boolean",default_value:!0}],newInstance:function(t,n,i,a,r,s){return n(new o(t,i,a,r,s)),!e}})}();
!function(){var e=!1;function t(e,t,n,a){var o=t.settings.name;e||(e='#example: create 2 datanodes py_a a,d py_b then use them as follow:\n# Example: add the values of 2 datanodes.\n# return dataNodes["py_a"] + dataNodes["py_b"];\n');var i=$('<div id="code-window-js" class="code-window cancel__box cancel__box--xl"></div>'),r=$('<div class="code-mirror-wrapper" id="codeWrapper"></div>'),d=$('<div class="cancel__box__bottom"></div>'),s=$('<div class="cancel__box__body"></div>'),l=$('<div class="cancel__box__top"><div class="code-window-header cm-s-ambiance">This Python script will be re-evaluated according to Chalk\'it execution engine rules, if one of the referenced input <code><span class="cm-def">dataNodes</span></code> is updated. The value you <code><span class="cm-keyword">return</span></code> will update the Chalk\'it workspace. You can assume this script is wrapped in a function with a <code><span class="cm-def">dataNodes</span></code> parameter containing the defined input dataNodes. <br>Press <code><span class="cm-keyword">ctrl-space</span></code> to activate autocompletion.</div>'),c=$('<div class="cancel__box__container"></div>');s.append([r]),c.append([l,s,d]),i.append([c]);var p=$('<div id="codeWindowContainer" class="cancel__container open"></div>');function u(e,t){t.pick(),e.execCommand("autocomplete")}p.append($('<div class="cancel__overlay"></div>')),p.append(i),$("body").append(p);var g=datanodesManager.getAllDataNodes().sort((e,t)=>e.name().localeCompare(t.name())),m=CodeMirror(r.get(0),{value:e,mode:{name:"python",globalVars:!0},theme:"eclipse",version:3,indentUnit:2,lineNumbers:!0,matchBrackets:!0,autoCloseBrackets:!0,lineWrapping:!1,showCursorWhenSelecting:!0,extraKeys:{"Ctrl-Space":"autocomplete","Alt-C":e=>e.toggleComment()},hintOptions:{hint:JSEditorCompletion.createCompletionFct(g),completeSingle:!1,extraKeys:{Tab:u,Right:u,Left:function(e,t){const n=e.getCursor(),a=n.line,o=e.getLine(a),i=n.ch,r=JSEditorCompletion.getPrecedingPathLength(o,i);r&&(e.replaceRange("",CodeMirror.Pos(a,i-r),CodeMirror.Pos(a,i)),t.close(),e.execCommand("autocomplete"))}}}});if([bFoundConnection,prop]=datanodesManager.isConnectedWithWidgt(o),bFoundConnection){var h='<div style="display: table-cell; padding: 10px"><span>Connected widget(s): </span></div>';_.each(prop,e=>{h=h+'<div style="display: table-cell; padding: 10px"><input type="radio" id="'+e+'_radio" name="dataWidgetRadio" value="'+e+'" onchange="datanodesManager.previewWidget(this.value)"><label for="'+e+'_radio">'+e+"</label></div>"});var w=$('<button id="dialog-widget" class="btn btn-rounded-fill primary" js-reset-toggle="">Show widget</button>').click((function(){if("Show widget"==$("#dialog-widget").text()){$("#code-window-js").width("80%"),$("#dialog-widget").text("Hide widget");var e="";_.each(prop,t=>{e=e+'<div id="widget-preview-zone-'+t+'" ></div>'});var t=$('<div id="code-widget-window-js"  style="width: 49%;float: right;z-index:5000;overflow:auto;height:100%"><div id="widgets-selection-header" class="code-window-header cm-s-ambiance" style="position:relative"><div style="display: table-row">'+h+'</div></div><div id="widgets-preview-top" class="code-widget-window-preview" style="display:flex; justify-content:center; background-color:white; border:1px dashed rgba(0, 0, 0, 0.5);"> '+e+"</div></div>");r.append(t),$("#"+prop[0]+"_radio").prop("checked",!0);_.each(prop,e=>{!function(e){var t=[];$("#widgets-preview-top > div").each((e,n)=>{t.push(n.id),$("#"+n.id).hide()}),$("#widget-preview-zone-"+e).show();var n=Math.min($("#"+e).height(),$("#code-widget-window-js").height()-40-$("#widgets-selection-header").height()),a=Math.min($("#"+e).width(),$("#code-widget-window-js").width()-100);$("#widget-preview-zone-"+e).width(a),$("#widget-preview-zone-"+e).height(n);var o=e.substring(0,e.length-1),i=widgetsPluginsHandler.copyWidget("widget-preview-zone-"+e,o,null,e,!0);null!=widgetConnector.widgetsConnection[e]&&(widgetConnector.widgetsConnection[e].widgetObjEdit=null,widgetConnector.widgetsConnection[e].widgetObjConnect=i)}(e)});var n=prop[0];datanodesManager.previewWidget(n),$(".code-mirror-wrapper")[0].childNodes[0].style.float="left",$(".code-mirror-wrapper")[0].childNodes[0].style.width="50%"}else $("#dialog-widget").text("Show widget"),_.each(prop,e=>{null!=widgetConnector.widgetsConnection[e]&&(widgetConnector.widgetsConnection[e].widgetObjEdit=null,widgetConnector.widgetsConnection[e].widgetObjConnect=null)}),$("#code-widget-window-js").remove(),$("#code-window-js").width("80%"),$(".code-mirror-wrapper")[0].childNodes[0].style.float="unset",$(".code-mirror-wrapper")[0].childNodes[0].style.width="unset"}));d.append(w);var v=$('<button id="apply-widget" class="btn btn-rounded-fill primary" js-reset-toggle="">Apply</button>').click((function(){t.settings[n.name]=m.getValue(),angular.element(document.getElementById("dash-datanode-ctrl")).scope().saveDataNodeSettings(!0)}));d.append(v)}var f=$('<button id="dialog-cancel" class="btn btn-rounded-fill primary" js-reset-toggle="">Close </button>').click((function(){if(a){var e=m.getValue();a(e),i.remove()}$("#codeWindowContainer").remove()}));d.append(f)}datanodesManager.loadDatanodePlugin({type_name:"Python_pyodide_plugin",display_name:"Script (Pyodide)",icon_type:"python.svg",description:"Python script (in client-side) plugin",external_scripts:[],settings:[{name:"autoStart",display_name:"AUTO START",description:"DataNode is executed automatically at start (project load, its creation/modification).",type:"boolean",default_value:!0},{name:"explicitTrig",display_name:"Explicit trigger",description:"DataNode is executed only if triggered explicitly (no execution when its predecessors are updated). It is executed automatically once when AutoStart is “YES”.",type:"boolean",default_value:!1},{name:"content",display_name:"Python script",type:"custom2",implementation:function(e,n,a,o){var i=$('<textarea autocorrect="off" autocomplete="off" spellcheck="false" class="calculated-value-input" style="display:none; width:78%"></textarea>');i.change((function(){o.settings[n.name]=$(this).val()})),i.val(""),n.name in a&&i.val(a[n.name]);var r=$('<div class="codemirror-wrapper__top"></div>'),d=$('<div class="calculated-setting-row codemirror-wrapper"></div>');d.append(r);var s=function(e,t,n){t||(t='#example: create 2 datanodes py_a a,d py_b then use them as follow:\n# Example: add the values of 2 datanodes.\n# return dataNodes["py_a"] + dataNodes["py_b"];\n');var a=$('<div class="codemirror-wrapper__content"></div>');function o(e,t){t.pick(),e.execCommand("autocomplete")}e.append(a);var i=datanodesManager.getAllDataNodes().sort((e,t)=>e.name().localeCompare(t.name())),r=CodeMirror(a.get(0),{value:t,mode:{name:"python",globalVars:!0},theme:"eclipse",version:3,indentUnit:2,lineNumbers:!0,matchBrackets:!0,autoCloseBrackets:!0,lineWrapping:!1,showCursorWhenSelecting:!0,extraKeys:{"Ctrl-Space":"autocomplete","Alt-C":e=>e.toggleComment()},hintOptions:{hint:JSEditorCompletion.createCompletionFct(i),completeSingle:!1,extraKeys:{Tab:o,Right:o,Left:function(e,t){const n=e.getCursor(),a=n.line,o=e.getLine(a),i=n.ch,r=JSEditorCompletion.getPrecedingPathLength(o,i);r&&(e.replaceRange("",CodeMirror.Pos(a,i-r),CodeMirror.Pos(a,i)),t.close(),e.execCommand("autocomplete"))}}}});r.doc.cm.on("change",(function(){var e=r.getValue();n(e)}));var d=r.getValue();return setTimeout((function(){r.refresh()}),1),n(d),r}(d,i.val(),(function(e){i.val(e),i.change()}));d.append(i),n.name in a&&i.val(a[n.name]);var l=$('<a>Full Screen view<i class="basic icn-full-screen""></i></a>').mousedown((function(e){e.preventDefault(),t(i.val(),o,n,(function(e){s.setValue(e),i.val(e),i.change()}))}));r.append(l),$(e).append(d)},description:"Python script to evaluate."}],newInstance:function(t,a,o,i,r){if(!a(new n(t,o,i,r)))return!e}});var n=function(t,n,a,o){var i,r=this,d=t;r.onSettingsChanged=function(t,n){return"OK"===n&&(n,d),d=t,r.runScriptSettings(),!e&&(d,!0)},r.isSettingNameChanged=function(e){return d.name!=e},r.updateNow=function(t,s,l){if(d.explicitTrig&&t)return{notTobeExecuted:!0};if(!d.autoStart&&!s&&!t)return{notTobeExecuted:!0};a("Pending");let c={};for(let e of l)c[e]=datanodesManager.getDataNodeByName(e).latestData();if(_.isUndefined(c)){return o("error",d.name,"The value of arguments is undefined"),a("Error","Arguments error"),n(void 0,"Error"),e=!0,!1}return r.runScript(i,c),!0},r.runScriptSettings=function(){if(e=!1,_.isEmpty(d.args))i=d.content;else{let e=d.args;e+="\n",i=e+d.content,d.content=i,d.args=""}return(_.isNull(i)||_.isUndefined(i)||""==i)&&(e=!0,swal("Script error","No python script was provided.","error")),angular.element(document.body).injector().invoke(["$rootScope",function(e){return!e.UserProfile}])||(i=i.replaceAll("datasources","dataNodes")),!0},r.errorAllTheThings=function(e,t=null,i="error",s="Error"){o(i,d.name,e),a(s,t||e),n(void 0,s),r.error=!0,r.pastStatus="Error"},r.runScript=async function(e,t){if(_.isEmpty(d.args))e=d.content;else{let t=d.args.replaceAll("return","args=");t+="\n",e=t+d.content}var i="";i=function(e,t,n,a){return e+="def runScript(dataNodes):\n",e+=function(e){return e.split(/\r?\n/).map(e=>"  "+e).join("\n")+"\n"}(t="global globalScope\n"+t+"\n"),e+="import json\n",e+="import js\n",_.isEmpty(n)?e+="dataNodes = {};\n":(e+="dataNodes = {}\n",_.each(_.keys(n),t=>{"Python_pyodide_plugin"==datanodesManager.getDataNodeByName(t).type()?t!=a&&(e=e+'dataNodes["'+t+'"] = globalScope["'+t+'"]\n'):e=e+'dataNodes["'+t+'"] = json.loads(js.JSON.stringify(js.datanodesManager.getDataNodeByName("'+t+'").latestData()))\n'})),e=e+"\nimport os\nimport sys\nimport json\n\ndef is_jsonable(x):\n  try:\n    json.dumps(x)\n    return True\n  except (TypeError, OverflowError):\n    return False\n\nsys.stdout = open(os.devnull,'w')\nresult = runScript(dataNodes);\nsys.stdout = sys.__stdout__\nglobalScope['"+a+"']=result\nif is_jsonable(result):\n  resRet = json.dumps(result)\nelse:\n  if (str(type(result)) == \"<class 'pandas.core.frame.DataFrame'>\"):\n    resRet =  json.dumps(result.to_html(notebook=True, max_rows=4))\n  else :\n    resRet = json.dumps(str(type(result)));\n\nresRet\n"}(i,e=e.replaceAll("datasources","dataNodes"),t,d.name);const{standardLibs:s,micropipLibs:l}=pyodideManager.getProjectLibs(),c=_.isEqual(s,["matplotlib"]),p=_.isEqual(l,["plotly"]);if(c&&p||c&&!l.length||p&&!s.length||!l.length&&!s.length){const e=pyodideManager.getDefaultLibs();await pyodideManager.loadPyodideLibs(e)}try{i=i.replace("xDashApi","js.xDashApi");const e=await pyodideManager.runPythonScript(i);u=e,data={},_.isUndefined(u)||("PyProxyClass"==u.constructor.name?data=u.toJs():data=JSON.parseMore(u)),"Stop"==datanodesManager.getDataNodeByName(d.name).schedulerStatus()?(a("None","Request is aborted"),n(void 0,"None"),o("info",d.name,"Response status 0 : abort")):(o("success",d.name,""),a("OK"),n(data),r.error=!1,r.pastStatus="OK",r.pastSettings=d)}catch(e){!function(e){const t=e;let n=t;n=t,"abort"===e?r.errorAllTheThings(n,t,"info","None"):r.errorAllTheThings(n,t)}(e)}var u;return!0},r.onDispose=function(){},this.getXHR=function(){},this.isSetValueValid=function(){return!1},r.isSetFileValid=function(){return!1},r.onCalculatedValueChanged=function(e,t){calculatedValue=t},r.runScriptSettings()}}();